cscope 15 $HOME/program/fxtools -q 0000008220 0001456471
	@fxtools.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~<zlib.h
>

4 
	~<°döt.h
>

5 
	~"utûs.h
"

6 
	~"fxtoﬁs.h
"

7 
	~"k£q.h
"

8 
	~"ht¶ib/ht¶ib/ßm.h
"

9 
	~"ht¶ib/ht¶ib/Áidx.h
"

11 
	#_Œ_t
 

	)

13 
	$KSEQ_INIT
(
gzFûe
, 
gzªad
)

15 
	$ußge
()

17 
	`Ârötf
(
°dîr
, "Program: fxtools (fastaánd fastq dataÅools)\n");

18 
	`Ârötf
(
°dîr
, "Usage: fxtools <command> [options]\n\n");

19 
	`Ârötf
(
°dîr
, "Command: filter (fl) filter fa/fq sequences with specifiedÜength bound.\n");

20 
	`Ârötf
(
°dîr
, " fq2fa (qa) convert FASTQ format dataÅo FASTA format data.\n");

21 
	`Ârötf
(
°dîr
, " fa2fq (aq) convert FASTA format dataÅo FASTQ format data.\n");

22 
	`Ârötf
(
°dîr
, "Ñe-co (rc) convert DNA sequence(fa/fq)Åo itsÑeverse-complementary sequence.\n");

23 
	`Ârötf
(
°dîr
, " seq-display (sd) displayá specifiedÑegion of FASTA/FASTQ file.\n");

24 
	`Ârötf
(
°dîr
, " cigar-parse (cp)ÖarseÅhe given cigar(stdout).\n");

25 
	`Ârötf
(
°dîr
, "Üength-parse (lp)ÖarseÅheÜength of sequences in fa/fq file.\n");

26 
	`Ârötf
(
°dîr
, " merge-fa (mf) mergeÅheÑeads with sameÑeadÇame in fasta/fastq file.\n");

27 
	`Ârötf
(
°dîr
, "Érror-parse (ep)Öarse indelánd mismatchÉrror based on CIGARánd NM in bam file.\n");

29 
	`Ârötf
(
°dîr
, "\n");

31 
	}
}

33 
	$fxt_fûãr
(
¨gc
, * 
¨gv
[])

35 i‡(
¨gc
 != 4)

37 
	`Ârötf
(
°dîr
, "\n");

38 
	`Ârötf
(
°dîr
, "Usage: fxtools filter <in.fa/fq> <lower-bound> <upper-bound>(-1 for NO bound)\n");

39 
	`Ârötf
(
°dîr
, "\n");

40 
	`exô
(-1);

42 
gzFûe
 
öÂ
;

43 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
öÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

44 
öÂ
 = 
	`gz›í
(
¨gv
[1], "r");

45 i‡(
öÂ
 =
NULL
)

47 
	`Ârötf
(
°dîr
, "[fxt_fûãr] C™'à›í %s.\n", 
¨gv
[1]);

48 
	`exô
(-1);

50 
k£q_t
 *
£q
;

51 
£q
 = 
	`k£q_öô
(
öÂ
);

52 
öt64_t
 
low
 = 
	`©oi
(
¨gv
[2]);

53 
öt64_t
 
uµî
 = 
	`©oi
(
¨gv
[3]);

54 
	`k£q_ªad
(
£q
) >= 0)

56 i‡((
low
 !-1 && (
öt64_t
)
£q
->£q.
l
 <ÜowË|| (
uµî
 != -1 && (int64_t)seq->seq.l > upper))

58 i‡(
£q
->
quÆ
.
l
 != 0)

60 
	`Ârötf
(
°dout
, "@%s\n", 
£q
->
«me
.
s
);

61 
	`Ârötf
(
°dout
, "%s\n", 
£q
->£q.
s
);

62 
	`Ârötf
(
°dout
, "+\n");

63 
	`Ârötf
(
°dout
, "%s\n", 
£q
->
quÆ
.
s
);

67 
	`Ârötf
(
°dout
, ">%s\n", 
£q
->
«me
.
s
);

68 
	`Ârötf
(
°dout
, "%s\n", 
£q
->£q.
s
);

72 
	`gz˛o£
(
öÂ
);

74 
	}
}

76 
	$fxt_fq2Á
(
¨gc
, *
¨gv
[])

78 i‡(
¨gc
 != 3)

80 
	`Ârötf
(
°dîr
, "\n"); fprintf(stderr, "Usage: fxtools fq2fa <in.fq> <out.fa>\n\n");

81 
	`exô
(-1);

83 
gzFûe
 
öÂ
;

84 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
öÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

85 
öÂ
 = 
	`gz›í
(
¨gv
[1], "r");

86 i‡(
öÂ
 =
NULL
)

88 
	`Ârötf
(
°dîr
, "[fxt_fq2Á] C™'à›í %s.\n", 
¨gv
[1]);

89 
	`exô
(-1);

91 
k£q_t
 *
£q
;

92 
£q
 = 
	`k£q_öô
(
öÂ
);

93 
FILE
 *
outÂ
 = 
	`f›í
(
¨gv
[2], "w");

95 
	`k£q_ªad
(
£q
) >= 0)

97 
	`Ârötf
(
outÂ
, ">%s\n", 
£q
->
«me
.
s
);

98 
	`Ârötf
(
outÂ
, "%s\n", 
£q
->£q.
s
);

101 
	`gz˛o£
(
öÂ
);

102 
	`f˛o£
(
outÂ
);

104 
	}
}

106 
	$fxt_Á2fq
(
¨gc
, *
¨gv
[])

108 i‡(
¨gc
 != 3)

110 
	`Ârötf
(
°dîr
, "\n"); fprintf(stderr, "Usage: fxtools fa2fq <in.fa> <out.fq>\n\n");

111 
	`exô
(-1);

113 
gzFûe
 
öÂ
;

114 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
öÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

115 
öÂ
 = 
	`gz›í
(
¨gv
[1], "r");

116 i‡(
öÂ
 =
NULL
)

118 
	`Ârötf
(
°dîr
, "[fxt_Á2fq] C™'à›í %s.\n", 
¨gv
[1]);

119 
	`exô
(-1);

121 
k£q_t
 *
£q
;

122 
£q
 = 
	`k£q_öô
(
öÂ
);

123 
FILE
 *
outÂ
 = 
	`f›í
(
¨gv
[2], "w");

125 
öt64_t
 
i
;

126 
	`k£q_ªad
(
£q
) >= 0)

128 
	`Ârötf
(
outÂ
, "@%s\n", 
£q
->
«me
.
s
);

129 
	`Ârötf
(
outÂ
, "%s\n", 
£q
->£q.
s
);

130 
	`Ârötf
(
outÂ
, "+\n");

131 
i
 = 0; i < (
öt64_t
)
£q
->£q.
l
; ++iË
	`Ârötf
(
outÂ
, "!");

132 
	`Ârötf
(
outÂ
, "\n");

135 
	`gz˛o£
(
öÂ
);

136 
	`f˛o£
(
outÂ
);

138 
	}
}

140 
	$fxt_ª_co
(
¨gc
, *
¨gv
[])

142 i‡(
¨gc
 != 3)

144 
	`Ârötf
(
°dîr
, "\n");

145 
	`Ârötf
(
°dîr
, "Usage: fxtoolsÑe-co in.fa/fq out.fa\n"); fprintf(stderr, "\n");

148 
gzFûe
 
ªadÂ
;

149 
k£q_t
 *
ªad_£q
;

150 
£q_Àn
 = 100000;

151 *
£q
 = (*)
	`mÆloc
(
£q_Àn
*());

152 
öt8_t
 *
£q_n
 = (öt8_t*)
	`mÆloc
(
£q_Àn
*(int8_t));

153 
FILE
 *
out
 = 
	`f›í
(
¨gv
[2], "w");

155 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
ªadÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

156 
ªadÂ
 = 
	`gz›í
(
¨gv
[1], "r");

157 
ªad_£q
 = 
	`k£q_öô
(
ªadÂ
);

159 
Àn
, 
i
;

161 (
Àn
 = 
	`k£q_ªad
(
ªad_£q
)) > 0)

163 i‡(
Àn
 > 
£q_Àn
)

165 
£q_Àn
 <<= 1;

166 
£q
 = (*)
	`ªÆloc
(£q, 
£q_Àn
*());

167 
£q_n
 = (
öt8_t
*)
	`ªÆloc
(£q_n, 
£q_Àn
*());

168 i‡(
£q
 =
NULL
 || 
£q_n
 == NULL)

170 
	`Ârötf
(
°dîr
, "memory isÇotÉnough.\n");

171 
	`exô
(-1);

174 
£q
 = 
ªad_£q
->£q.
s
;

175 
i
 = 0; i < 
Àn
; i++)

176 
£q_n
[
i
] = 
¡_èbÀ
[()
£q
[i]];

177 
	`Ârötf
(
out
, ">%s_ª-co:\n", 
ªad_£q
->
«me
.
s
);

178 
i
 = 
Àn
 - 1; i>=0; i--)

180 i‡(
£q_n
[
i
] != 4)

181 
	`Ârötf
(
out
, "%c", 
¡_ch¨
[3-()
£q_n
[
i
]]);

183 
	`Ârötf
(
out
, "N");

185 
	`Ârötf
(
out
, "\n");

188 
	`gz˛o£
(
ªadÂ
);

189 
	`k£q_de°roy
(
ªad_£q
);

190 
	`f˛o£
(
out
);

193 
	}
}

195 
	$fxt_£q_dis
(
¨gc
, *
¨gv
[])

197 i‡(
¨gc
 != 3)

199 
	`Ârötf
(
°dîr
, "\n");

200 
	`Ârötf
(
°dîr
, "Usage: fxtools seq-display <in.fa/fq> <reg(chr/read_name:start_pos(1-based)-end_pos)\n");

201 
	`Ârötf
(
°dîr
, "\n");

202 
	`exô
(-1);

204 
Áidx_t
 *
Ái
 = 
	`Ái_lﬂd
(
¨gv
[1]);

205 i‡–!
Ái
 ) {

206 
	`Ârötf
(
°dîr
, "CouldÇŸÜﬂd faòödex o‡%s\n", 
¨gv
[1]);

207 
	`Ârötf
(
°dîr
, "Buûdög faòödex o‡%s\n", 
¨gv
[1]);

208 i‡(
	`Ái_buûd
(
¨gv
[
›töd
]) != 0) {

209 
	`Ârötf
(
°dîr
, "CouldÇŸ buûd faòödex %s.Ái\n", 
¨gv
[
›töd
]);

210  
EXIT_FAILURE
;

214 
exô_°©us
 = 
EXIT_SUCCESS
;

216 
	`¥ötf
(">%s\n", 
¨gv
[
›töd
]);

217 
£q_Àn
;

218 *
£q
 = 
	`Ái_„tch
(
Ái
, 
¨gv
[
›töd
], &
£q_Àn
);

219 i‡–
£q_Àn
 < 0 ) {

220 
	`Ârötf
(
°dîr
, "FaûedÅÿ„tch sequí˚ i¿%s\n", 
¨gv
[
›töd
]);

221 
exô_°©us
 = 
EXIT_FAILURE
;

222  
exô_°©us
;

224 
size_t
 
i
, 
£q_sz
 = 
£q_Àn
;

225 
i
=0; i<
£q_sz
; i+=60)

227 
size_t
 
Àn
 = 
i
 + 60 < 
£q_sz
 ? 60 : seq_sz - i;

228 i‡(
	`fwrôe
(
£q
 + 
i
, 1, 
Àn
, 
°dout
) <Üen ||

229 
	`putch¨
('\n'Ë=
EOF
) {

230 
	`îr_Áèl_c‹e
("faidx", "failedÅo write output");

233 
	`‰ì
(
£q
);

234 
	`Ái_de°roy
(
Ái
);

235 
	}
}

237 
	$fxt_£q_dis
(
¨gc
, *
¨gv
[])

239 i‡(
¨gc
 != 3)

241 
	`Ârötf
(
°dîr
, "\n");

242 
	`Ârötf
(
°dîr
, "Usage: fxtools seq-display <in.fa/fq> <reg(chr/read_name:start_pos(1-based)-end_pos)\n");

243 
	`Ârötf
(
°dîr
, "\n");

244 
	`exô
(-1);

246 
gzFûe
 
öÂ
;

247 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
öÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

248 
öÂ
 = 
	`gz›í
(
¨gv
[1], "r");

249 i‡(
öÂ
 =
NULL
)

251 
	`Ârötf
(
°dîr
, "[fxt_£q_dis] C™'à›í %s.\n", 
¨gv
[1]);

252 
	`exô
(-1);

254 
«me
[1024]; 
uöt64_t
 
°¨t
; 
Àn
;

255 
	`°r˝y
(
«me
, 
¨gv
[2]); 
°¨t
 = 
	`©ﬁ
◊rgv[3]); 
Àn
 = 
	`©oi
(argv[4]);

256 
k£q_t
 *
£q
;

257 
£q
 = 
	`k£q_öô
(
öÂ
);

258 
	`k£q_ªad
(
£q
) >= 0)

260 i‡(
	`°rcmp
(
£q
->
«me
.
s
,Çame) == 0) {

261 i‡(
°¨t
 > 
£q
->£q.
l
) {

262 
	`Ârötf
(
°dîr
, "[fxt_£q_dis] Eº‹: START_POS i†l⁄ggîÅh™ÅhêÀngth o‡chr/ªad. (%Œd > %Œd)\n", (
_Œ_t
)
°¨t
, (_Œ_t)
£q
->£q.
l
);

263 
	`exô
(-1);

264 } i‡(
°¨t
 + 
Àn
 - 1 > 
£q
->£q.
l
) {

265 
	`Ârötf
(
°dîr
, "[fxt_£q_dis] Eº‹: START_POS+LEN i†l⁄ggîÅh™ÅhêÀngth o‡chr/ªad. (%Œd > %Œd)\n", (
_Œ_t
)
°¨t
+
Àn
-1, (_Œ_t)
£q
->£q.
l
);

267 
£q
->£q.
s
[
°¨t
+
Àn
-1] = '\0';

269 
	`Ârötf
(
°dout
, "%s\n", 
£q
->£q.
s
+
°¨t
-1);

270 
	`gz˛o£
(
öÂ
);

274 
	`gz˛o£
(
öÂ
);

275 
	`Ârötf
(
°dîr
, "[fxt_£q_dis] Eº‹: C™'àföd %†ö %s.\n", 
«me
, 
¨gv
[1]);

277 
	}
}

279 
	$fxt_cig¨_∑r£
(
¨gc
, *
¨gv
[])

281 i‡(
¨gc
 != 2)

283 
	`Ârötf
(
°dîr
, "\n"); fprintf(stderr, "Usage: fxtools cigar-parse <input-cigar>\n\n");

286 
cig¨_Àn
, 
i
, 
£q_Àn
, 
ªf_Àn
;

287 
c
;

288 
x
, 
›
[11] = {0};

289 *
s
, *
t
;

291 
cig¨_Àn
 = 
£q_Àn
 = 
ªf_Àn
 = 0;

292 
s
 = 
¨gv
[1]; *s; )

294 
x
 = 
	`°πﬁ
(
s
, &
t
, 10);

301 
c
 = 
	`touµî
(*
t
);

302 
c
)

304 'M': 
›
[
CMATCH
]+=
x
, 
£q_Àn
+=x, 
ªf_Àn
+=x; ;

305 'I': 
›
[
CINS
]+=
x
, 
£q_Àn
+=x; ;

306 'D': 
›
[
CDEL
]+=
x
, 
ªf_Àn
+=x; ;

307 'N': 
›
[
CREF_SKIP
]+=
x
, 
ªf_Àn
+=x; ;

308 'S': 
›
[
CSOFT_CLIP
]+=
x
, 
£q_Àn
+=x; ;

309 'H': 
›
[
CHARD_CLIP
]+=
x
; ;

310 'P': 
›
[
CPAD
]+=
x
; ;

311 '=': 
›
[
CEQUAL
]+=
x
, 
£q_Àn
+=x, 
ªf_Àn
+=x; ;

312 'X': 
›
[
CDIFF
]+=
x
, 
£q_Àn
+=x, 
ªf_Àn
+=x; ;

313 'B': 
›
[
CBACK
]+=
x
; ;

314 'V': 
›
[
CINV
]+=
x
, 
£q_Àn
+=x, 
ªf_Àn
+=x; ;

315 : 
	`Ârötf
(
°dîr
, "[fxtoﬁ†cig¨-∑r£] Cig¨ ERROR 2.\n"); 
	`exô
(-1); ;

318 ++
cig¨_Àn
;

319 
s
 = 
t
+1;

321 
i
 = 0; i < 11; ++i)

323 i‡(
›
[
i
] !0Ë
	`Ârötf
(
°dout
, "%ld%c\t", op[i], 
CIGAR_STR
[i]);

325 
	`Ârötf
(
°dout
, "\n£q-Àn: %d\ƒef-Àn: %d\n", 
£q_Àn
, 
ªf_Àn
);

327 
	}
}

329 
	$fxt_Àn_∑r£
(
¨gc
, *
¨gv
[])

331 i‡(
¨gc
 != 2)

333 
	`Ârötf
(
°dîr
, "\n");

334 
	`Ârötf
(
°dîr
, "Usage: fxtoolsÜength-parse <in.fa/fq>\n");

335 
	`Ârötf
(
°dîr
, "\n");

336 
	`exô
(-1);

338 
gzFûe
 
öÂ
;

339 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
öÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

340 
öÂ
 = 
	`gz›í
(
¨gv
[1], "r");

341 i‡(
öÂ
 =
NULL
)

343 
	`Ârötf
(
°dîr
, "[fxt_Àn_∑r£] C™'à›í %s.\n", 
¨gv
[1]);

344 
	`exô
(-1);

346 
k£q_t
 *
£q
;

347 
£q
 = 
	`k£q_öô
(
öÂ
);

348 
	`k£q_ªad
(
£q
) >= 0)

350 
	`Ârötf
(
°dout
, "%s\t%d\n", 
£q
->
«me
.
s
, ()£q->£q.
l
);

353 
	`gz˛o£
(
öÂ
);

355 
	}
}

357 
	$fxt_mîge_Á
(
¨gc
, *
¨gv
[])

359 i‡(
¨gc
 != 3) {

360 
	`Ârötf
(
°dîr
, "\n");

361 
	`Ârötf
(
°dîr
, "Usage: fxtools merge_fa <in.fa/fq> <out.fa/fq>\n");

362 
	`Ârötf
(
°dîr
, "\n");

363 
	`exô
(-1);

365 
gzFûe
 
öÂ
;

366 i‡(
	`°rcmp
(
¨gv
[1],"-"Ë=0 || såcmp◊rgv[1], "°dö"Ë=0Ë
öÂ
 = 
	`gzd›í
(
	`fûío
(
°dö
), "r");

367 
öÂ
 = 
	`gz›í
(
¨gv
[1], "r");

368 i‡(
öÂ
 =
NULL
)

370 
	`Ârötf
(
°dîr
, "[fxt_mîge_Á] C™'à›í %s.\n", 
¨gv
[1]);

371 
	`exô
(-1);

373 
k£q_t
 *
£q
 = 
	`k£q_öô
(
öÂ
);

374 
FILE
 *
outÂ
 = 
	`f›í
(
¨gv
[2], "w");

375 
ªad_«me
[1024];

376 *
ªad_£q
 = (*)
	`ˇŒoc
(10, 1);

377 *
ªad_quÆ
 = (*)
	`ˇŒoc
(10, 1);

378 
w_£q_n
=0;

380 
	`k£q_ªad
(
£q
) >= 0)

382 i‡(
	`°rcmp
(
£q
->
«me
.
s
, 
ªad_«me
) == 0) {

383 
w_£q_n
 +
£q
->£q.
l
;

384 
ªad_£q
 = (*)
	`ªÆloc
‘ód_£q, 
w_£q_n
+
£q
->£q.
l
);

385 
	`°rˇt
(
ªad_£q
, 
£q
->£q.
s
);

386 
ªad_£q
[
w_£q_n
] = 0;

387 i‡(
£q
->
quÆ
.
l
 > 0) {

388 
ªad_quÆ
 = (*)
	`ªÆloc
‘ód_quÆ, 
w_£q_n
+
£q
->£q.
l
);

389 
	`°rˇt
(
ªad_quÆ
, 
£q
->
quÆ
.
s
);

390 
ªad_quÆ
[
w_£q_n
] = 0;

393 i‡(
w_£q_n
 > 0) {

394 i‡(
£q
->
quÆ
.
l
 > 0) {

395 
	`Ârötf
(
outÂ
, "@%s\n", 
ªad_«me
);

396 
	`Ârötf
(
outÂ
, "%s\n", 
ªad_£q
);

397 
	`Ârötf
(
outÂ
, "+\n");

398 
	`Ârötf
(
outÂ
, "%s\n", 
ªad_quÆ
);

400 
	`Ârötf
(
outÂ
, ">%s\n", 
ªad_«me
);

401 
	`Ârötf
(
outÂ
, "%s\n", 
ªad_£q
);

404 
w_£q_n
 = 
£q
->£q.
l
;

405 
	`°r˝y
(
ªad_«me
, 
£q
->
«me
.
s
);

406 
ªad_£q
 = (*)
	`ªÆloc
‘ód_£q, 
w_£q_n
+
£q
->£q.
l
);

407 
	`°r˝y
(
ªad_£q
, 
£q
->£q.
s
);

408 
ªad_£q
[
w_£q_n
] = 0;

409 i‡(
£q
->
quÆ
.
l
 > 0) {

410 
ªad_quÆ
 = (*)
	`ªÆloc
‘ód_quÆ, 
w_£q_n
+
£q
->£q.
l
);

411 
	`°r˝y
(
ªad_quÆ
, 
£q
->
quÆ
.
s
);

412 
ªad_quÆ
[
w_£q_n
] = 0;

416 i‡(
w_£q_n
 > 0) {

417 i‡(
£q
->
quÆ
.
l
 > 0) {

418 
	`Ârötf
(
outÂ
, "@%s\n", 
ªad_«me
);

419 
	`Ârötf
(
outÂ
, "%s\n", 
ªad_£q
);

420 
	`Ârötf
(
outÂ
, "+\n");

421 
	`Ârötf
(
outÂ
, "%s\n", 
ªad_quÆ
);

423 
	`Ârötf
(
outÂ
, ">%s\n", 
ªad_«me
);

424 
	`Ârötf
(
outÂ
, "%s\n", 
ªad_£q
);

427 
	`gz˛o£
(
öÂ
);

428 
	`f˛o£
(
outÂ
);

430 
	}
}

432 
	#bam_unm≠
(
b
Ë((b)->
c‹e
.
Êag
 & 
BAM_FUNMAP
)

	)

434 
	$fxt_îr‹_∑r£
(
¨gc
, *
¨gv
[])

436 i‡(
¨gc
 != 2)

438 
	`Ârötf
(
°dîr
, "\n"); fprintf(stderr, "Usage: fxtoolsÉrror-parse <input.bam> >Érror.out\n\n");

441 
	`Ârötf
(
°dout
, "READ_NAME\tREAD_LEN\tINS\tDEL\tMIS\tMATCH\tCLIP\tSKIP\n");

442 
tﬁ_n
=0, 
unm≠
=0, 
tﬁ_Àn
=0, 
tﬁ_ös
=0, 
tﬁ_dñ
=0, 
tﬁ_mis
=0, 
tﬁ_m©ch
=0, 
tﬁ_˛ù
=0, 
tﬁ_skù
=0;

443 
i
, 
£q_Àn
, 
md
, 
ös
, 
dñ
, 
mis
, 
m©ch
, 
˛ù
, 
skù
;

445 
ßmFûe
 *
ö
; 
bam_hdr_t
 *
h
; 
bam1_t
 *
b
;

446 i‡((
ö
 = 
	`ßm_›í
(
¨gv
[
›töd
], "rb")Ë=
NULL
Ë
	`îr_Áèl_c‹e
(
__func__
, "Cannot open \"%s\"\n",árgv[optind]);

447 i‡((
h
 = 
	`ßm_hdr_ªad
(
ö
)Ë=
NULL
Ë
	`îr_Áèl
(
__func__
, "Couldn'àªad hódî f‹ \"%s\"\n", 
¨gv
[
›töd
]);

448 
b
 = 
	`bam_öô1
();

450 
	`ßm_ªad1
(
ö
, 
h
, 
b
) >= 0) {

451 
tﬁ_n
++;

452 
£q_Àn
 = 
b
->
c‹e
.
l_q£q
;

453 
md
 = 0, 
ös
 = 0, 
dñ
 = 0, 
mis
 = 0, 
m©ch
 = 0, 
˛ù
 = 0, 
skù
 = 0;

454 i‡(!
	`bam_unm≠
(
b
)) {

455 
uöt32_t
 *
cig¨
 = 
	`bam_gë_cig¨
(
b
); 
cig¨_Àn
 = b->
c‹e
.
n_cig¨
;

456 
i
 = 0; i < 
cig¨_Àn
; ++i) {

457 
uöt32_t
 
c
 = 
cig¨
[
i
];

458 
Àn
 = 
	`bam_cig¨_›Àn
(
c
);

459 
	`bam_cig¨_›
(
c
)) {

460 
BAM_CMATCH
: 
m©ch
 +
Àn
; ;

461 
BAM_CINS
: 
ös
 +
Àn
; ;

462 
BAM_CDEL
: 
dñ
 +
Àn
; ;

463 
BAM_CREF_SKIP
: 
skù
 +
Àn
; ;

464 
BAM_CSOFT_CLIP
: 
˛ù
 +
Àn
; ;

465 
BAM_CHARD_CLIP
: 
˛ù
 +
Àn
; ;

466  : 
	`îr_Áèl_sim∂e
("Cigar ERROR.\n");

469 
uöt8_t
 *
p
 = 
	`bam_aux_gë
(
b
, "NM");

470 i‡(
p
 =0Ë∞
	`bam_aux_gë
(
b
, "nM");

471 i‡(
p
 == 0) {

472 
	`îr_Áèl_c‹e
(
__func__
, "%†Nÿ\"NM\"Åag.\n", 
	`bam_gë_q«me
(
b
));

475 
md
 = 
	`bam_aux2i
(
p
);

476 
mis
 = 
md
 - 
ös
 - 
dñ
;

477 
m©ch
 = m©ch - 
mis
;

478 } 
unm≠
++;

479 
tﬁ_Àn
 +
£q_Àn
; 
tﬁ_ös
 +
ös
; 
tﬁ_dñ
 +
dñ
; 
tﬁ_mis
 +
mis
; 
tﬁ_m©ch
 +
m©ch
; 
tﬁ_˛ù
 +
˛ù
; 
tﬁ_skù
 +
skù
;

481 
	`Ârötf
(
°dout
, "%s\t%d\t%d\t%d\t%d\t%d\t%d\t%d\n", 
	`bam_gë_q«me
(
b
), 
£q_Àn
, 
ös
, 
dñ
, 
mis
, 
m©ch
, 
˛ù
, 
skù
);

483 
	`Ârötf
(
°dout
, "%s\t%Œd\t%Œd\t%Œd\t%Œd\t%Œd\t%Œd\t%Œd\n", "TŸÆ", 
tﬁ_Àn
, 
tﬁ_ös
, 
tﬁ_dñ
, 
tﬁ_mis
, 
tﬁ_m©ch
, 
tﬁ_˛ù
, 
tﬁ_skù
);

484 
	`Ârötf
(
°dout
, "TŸÆ m≠≥dÑód: %Œd\nTŸÆ unm≠≥dÑód: %Œd\nTŸÆÑód: %Œd\n", 
tﬁ_n
-
unm≠
, unmap,Åol_n);

486 
	}
}

488 
	$maö
(
¨gc
, *
¨gv
[])

490 i‡(
¨gc
 < 2Ë 
	`ußge
();

491 i‡(
	`°rcmp
(
¨gv
[1], "fûãr"Ë=0 || såcmp◊rgv[1], "Ê"Ë=0Ë
	`fxt_fûãr
(
¨gc
-1,árgv+1);

492 i‡(
	`°rcmp
(
¨gv
[1], "fq2Á"Ë=0 || såcmp◊rgv[1], "qa"Ë=0Ë
	`fxt_fq2Á
(
¨gc
-1,árgv+1);

493 i‡(
	`°rcmp
(
¨gv
[1], "Á2fq"Ë=0 || såcmp◊rgv[1], "aq"Ë=0Ë
	`fxt_Á2fq
(
¨gc
-1,árgv+1);

494 i‡(
	`°rcmp
(
¨gv
[1], "ª-co"Ë=0 || såcmp◊rgv[1], "rc"Ë=0Ë
	`fxt_ª_co
(
¨gc
-1,árgv+1);

495 i‡(
	`°rcmp
(
¨gv
[1], "£q-di•œy"Ë=0 || såcmp◊rgv[1], "sd"Ë=0Ë
	`fxt_£q_dis
(
¨gc
-1,árgv+1);

496 i‡(
	`°rcmp
(
¨gv
[1], "cig¨-∑r£"Ë=0 || såcmp◊rgv[1], "˝"Ë=0Ë
	`fxt_cig¨_∑r£
(
¨gc
-1,árgv+1);

497 i‡(
	`°rcmp
(
¨gv
[1], "Àngth-∑r£"Ë=0 || såcmp◊rgv[1], "Õ"Ë=0Ë
	`fxt_Àn_∑r£
(
¨gc
-1,árgv+1);

498 i‡(
	`°rcmp
(
¨gv
[1], "mîge-Á"Ë=0 || såcmp◊rgv[1], "mf"Ë=0Ë
	`fxt_mîge_Á
(
¨gc
-1,árgv+1);

499 i‡(
	`°rcmp
(
¨gv
[1], "îr‹-∑r£"Ë=0 || såcmp◊rgv[1], "ï"Ë=0Ë
	`fxt_îr‹_∑r£
(
¨gc
-1,árgv+1);

500 {
	`Ârötf
(
°dîr
, "unknow comm™d [%s].\n", 
¨gv
[1]);  1; }

503 
	}
}

	@fxtools.h

3 
	#CIGAR_STR
 "MIDNSHP=XBV"

	)

8 
	#CMATCH
 0

	)

10 
	#CINS
 1

	)

12 
	#CDEL
 2

	)

14 
	#CREF_SKIP
 3

	)

17 
	#CSOFT_CLIP
 4

	)

19 
	#CHARD_CLIP
 5

	)

21 
	#CPAD
 6

	)

23 
	#CEQUAL
 7

	)

25 
	#CDIFF
 8

	)

26 
	#CBACK
 9

	)

27 
	#CINV
 10

	)

29 
öt8_t
 
	g¡_èbÀ
[128] = {

40 
	g¡_ch¨
[5] = { 'A', 'C', 'G', 'T', 'N' };

	@htslib/bcf_sr_sort.c

25 
	~<°rögs.h
>

27 
	~"bcf_§_s‹t.h
"

28 
	~"ht¶ib/khash_°r2öt.h
"

30 
	#SR_REF
 1

	)

31 
	#SR_SNP
 2

	)

32 
	#SR_INDEL
 4

	)

33 
	#SR_OTHER
 8

	)

34 
	#SR_SCORE
(
§t
,
a
,
b
Ë(§t)->
sc‹e
[(◊)<<4)|(b)]

	)

37 
ölöe
 
kbô£t_t
 *
	$kbs_ªsize
(
kbô£t_t
 *
bs
, 
size_t
 
ni
)

39 i‡–!
bs
 )  
	`kbs_öô
(
ni
);

40 
size_t
 
n
 = (
ni
 + 
KBS_ELTBITS
-1) / KBS_ELTBITS;

41 i‡–
n
==
bs
->n )  bs;

43 
bs
 = (
kbô£t_t
 *Ë
	`ªÆloc
(bs, (kbô£t_tË+ 
n
 * ());

44 i‡–
bs
==
NULL
 )  NULL;

45 i‡–
n
 > 
bs
->n )

46 
	`mem£t
(
bs
->
b
 + bs->
n
, 0, (n - bs->n) *  ());

47 
bs
->
n
 =Ç;

48 
bs
->
b
[
n
] = ~0UL;

49  
bs
;

50 
	}
}

53 
ölöe
 
	$kbs_logiˇl_™d
(
kbô£t_t
 *
bs1
, kbô£t_à*
bs2
)

57 
i
, 
n
 = 
bs1
->n;

59 
i
=0; i<
n
; i++Ëi‡–
bs1
->
b
[i] & 
bs2
->b[i] )  1;

61 
	}
}

64 
ölöe
 
	$kbs_bôwi£_‹
(
kbô£t_t
 *
d°
, kbô£t_à*
§c
)

66 
i
;

67 
i
=0; i<
d°
->
n
; i++Ëd°->
b
[i] |
§c
->b[i];

68 
	}
}

71 
	$bcf_§_öô_sc‹es
(
§_s‹t_t
 *
§t
)

73 
i
,
jbô
,
kbô
;

77 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_ANY
 ) sπ->∑ú |(
BCF_SR_PAIR_SNPS
 | 
BCF_SR_PAIR_INDELS
 | 
BCF_SR_PAIR_SNP_REF
 | 
BCF_SR_PAIR_INDEL_REF
);

78 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_SNPS
 ) 
	`SR_SCORE
(§t,
SR_SNP
,SR_SNP) = 3;

79 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_INDELS
 ) 
	`SR_SCORE
(§t,
SR_INDEL
,SR_INDEL) = 3;

80 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_SNP_REF
 )

82 
	`SR_SCORE
(
§t
,
SR_SNP
,
SR_REF
) = 2;

83 
	`SR_SCORE
(
§t
,
SR_REF
,
SR_SNP
) = 2;

85 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_INDEL_REF
 )

87 
	`SR_SCORE
(
§t
,
SR_INDEL
,
SR_REF
) = 2;

88 
	`SR_SCORE
(
§t
,
SR_REF
,
SR_INDEL
) = 2;

90 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_ANY
 )

92 
i
=0; i<256; i++)

93 i‡–!
§t
->
sc‹e
[
i
] ) srt->score[i] = 1;

97 
i
=0; i<256; i++)

99 i‡–
§t
->
sc‹e
[
i
] ) ;

100 
max
 = 0;

101 
jbô
=0; jbit<4; jbit++)

103 
j
 = 1<<
jbô
;

104 i‡–!(
i
 & (
j
<<4)) ) ;

105 
kbô
=0; kbit<4; kbit++)

107 
k
 = 1<<
kbô
;

108 i‡–!(
i
 & 
k
) ) ;

109 i‡–
max
 < 
	`SR_SCORE
(
§t
,
j
,
k
) ) max = SR_SCORE(srt,j,k);

112 
§t
->
sc‹e
[
i
] = 
max
;

114 
	}
}

115 
	$mu…i_is_exa˘
(
v¨_t
 *
av¨
, v¨_à*
bv¨
)

117 i‡–
av¨
->
«…
 !
bv¨
->nalt )  0;

119 
Æí
 = 
	`°æí
(
av¨
->
°r
);

120 
bÀn
 = 
	`°æí
(
bv¨
->
°r
);

121 i‡–
Æí
 !
bÀn
 )  0;

123 *
abeg
 = 
av¨
->
°r
;

124  *
abeg
 )

126 *
´nd
 = 
abeg
;

127  *
´nd
 && *aend!=',' )áend++;

129 *
bbeg
 = 
bv¨
->
°r
;

130  *
bbeg
 )

132 *
bíd
 = 
bbeg
;

133  *
bíd
 && *bend!=',' ) bend++;

134 i‡–
bíd
 - 
bbeg
 =
´nd
 - 
abeg
 && !
	`°∫ˇ£cmp
(abeg,bbeg,bend-bbeg) ) ;

135 
bbeg
 = *
bíd
 ? bend+1 : bend;

137 i‡–!*
bbeg
 )  0;

139 
abeg
 = *
´nd
 ?áend+1 :áend;

142 
	}
}

143 
	$mu…i_is_sub£t
(
v¨_t
 *
av¨
, v¨_à*
bv¨
)

145 *
abeg
 = 
av¨
->
°r
;

146  *
abeg
 )

148 *
´nd
 = 
abeg
;

149  *
´nd
 && *aend!=',' )áend++;

151 *
bbeg
 = 
bv¨
->
°r
;

152  *
bbeg
 )

154 *
bíd
 = 
bbeg
;

155  *
bíd
 && *bend!=',' ) bend++;

156 i‡–
bíd
 - 
bbeg
 =
´nd
 - 
abeg
 && !
	`°∫ˇ£cmp
(abeg,bbeg,bend-bbeg) )  1;

157 
bbeg
 = *
bíd
 ? bend+1 : bend;

159 
abeg
 = *
´nd
 ?áend+1 :áend;

162 
	}
}

163 
öt32_t
 
	$∑úög_sc‹e
(
§_s‹t_t
 *
§t
, 
iv£t
, 
jv£t
)

165 
v¨£t_t
 *
iv
 = &
§t
->
v£t
[
iv£t
];

166 
v¨£t_t
 *
jv
 = &
§t
->
v£t
[
jv£t
];

170 
i
,
j
;

171 
uöt32_t
 
mö
 = 
UINT32_MAX
;

172 
i
=0; i<
iv
->
nv¨
; i++)

174 
v¨_t
 *
iv¨
 = &
§t
->
v¨
[
iv
->v¨[
i
]];

175 
j
=0; j<
jv
->
nv¨
; j++)

177 
v¨_t
 *
jv¨
 = &
§t
->
v¨
[
jv
->v¨[
j
]];

178 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_EXACT
 )

180 i‡–
iv¨
->
ty≥
 !
jv¨
->type ) ;

181 i‡–!
	`°rcmp
(
iv¨
->
°r
,
jv¨
->°rËË 
UINT32_MAX
;

182 i‡–
	`mu…i_is_exa˘
(
iv¨
,
jv¨
ËË 
UINT32_MAX
;

185 i‡–
iv¨
->
ty≥
==
jv¨
->ty≥ && !
	`°rcmp
(iv¨->
°r
,jv¨->°rËË 
UINT32_MAX
;

186 i‡–
iv¨
->
ty≥
 & 
jv¨
->ty≥ && 
	`mu…i_is_sub£t
(iv¨,jv¨ËË 
UINT32_MAX
;

188 
uöt32_t
 
sc‹e
 = 
	`SR_SCORE
(
§t
,
iv¨
->
ty≥
,
jv¨
->type);

189 i‡–!
sc‹e
 )  0;

190 i‡–
mö
>
sc‹e
 ) min = score;

193 i‡–
§t
->
∑ú
 & 
BCF_SR_PAIR_EXACT
 )  0;

195 
	`as£π
–
mö
!=
UINT32_MAX
 );

197 
uöt32_t
 
˙t
 = 0;

198 
i
=0; i<
iv
->
nv¨
; i++Ë
˙t
 +
§t
->
v¨
[iv->v¨[i]].
nvcf
;

199 
j
=0; j<
jv
->
nv¨
; j++Ë
˙t
 +
§t
->
v¨
[jv->v¨[j]].
nvcf
;

201  (1<<(28+
mö
)Ë+ 
˙t
;

202 
	}
}

203 
	$ªmove_v£t
(
§_s‹t_t
 *
§t
, 
jv£t
)

205 i‡–
jv£t
+1 < 
§t
->
nv£t
 )

207 
v¨£t_t
 
tmp
 = 
§t
->
v£t
[
jv£t
];

208 
	`memmove
(&
§t
->
v£t
[
jv£t
], &§t->v£t[jv£t+1], (
v¨£t_t
)*(§t->
nv£t
 - jvset - 1));

209 
§t
->
v£t
[§t->
nv£t
-1] = 
tmp
;

211 *
jm©
 = 
§t
->
pm©
 + 
jv£t
*§t->
ngΩ
;

212 
	`memmove
(
jm©
, &jm©[
§t
->
ngΩ
],()*(§t->
nv£t
 - 
jv£t
 - 1)*srt->ngrp);

214 
	`memmove
(&
§t
->
˙t
[
jv£t
], &§t->˙t[jv£t+1], ()*(§t->
nv£t
 - jvset - 1));

216 
§t
->
nv£t
--;

217 
	}
}

218 
	$mîge_v£ts
(
§_s‹t_t
 *
§t
, 
iv£t
, 
jv£t
)

220 
i
,
j
;

221 i‡–
iv£t
 > 
jv£t
 ) { 
i
 = ivset; ivset = jvset; jvset = i; }

223 
v¨£t_t
 *
iv
 = &
§t
->
v£t
[
iv£t
];

224 
v¨£t_t
 *
jv
 = &
§t
->
v£t
[
jv£t
];

226 
	`kbs_bôwi£_‹
(
iv
->
mask
,
jv
->mask);

228 
i
 = 
iv
->
nv¨
;

229 
iv
->
nv¨
 +
jv
->nvar;

230 
	`hts_ex∑nd
(, 
iv
->
nv¨
, iv->
mv¨
, iv->
v¨
);

231 
j
=0; j<
jv
->
nv¨
; j++,
i
++Ë
iv
->
v¨
[i] = jv->var[j];

233 *
im©
 = 
§t
->
pm©
 + 
iv£t
*§t->
ngΩ
;

234 *
jm©
 = 
§t
->
pm©
 + 
jv£t
*§t->
ngΩ
;

235 
i
=0; i<
§t
->
ngΩ
; i++Ë
im©
[i] +
jm©
[i];

236 
§t
->
˙t
[
iv£t
] +§t->˙t[
jv£t
];

238 
	`ªmove_v£t
(
§t
, 
jv£t
);

240  
iv£t
;

241 
	}
}

242 
	$push_v£t
(
§_s‹t_t
 *
§t
, 
iv£t
)

244 
v¨£t_t
 *
iv
 = &
§t
->
v£t
[
iv£t
];

245 
i
,
j
;

246 
i
=0; i<
§t
->
§
->
ƒódîs
; i++)

248 
vcf_buf_t
 *
buf
 = &
§t
->
vcf_buf
[
i
];

249 
buf
->
ƒec
++;

250 
	`hts_ex∑nd
(
bcf1_t
*,
buf
->
ƒec
,buf->
mªc
,buf->
ªc
);

251 
buf
->
ªc
[buf->
ƒec
-1] = 
NULL
;

253 
i
=0; i<
iv
->
nv¨
; i++)

255 
v¨_t
 *
v¨
 = &
§t
->v¨[ 
iv
->v¨[
i
] ];

256 
j
=0; j<
v¨
->
nvcf
; j++)

258 
jvcf
 = 
v¨
->
vcf
[
j
];

259 
vcf_buf_t
 *
buf
 = &
§t
->
vcf_buf
[
jvcf
];

260 
buf
->
ªc
[buf->
ƒec
-1] = 
v¨
->ªc[
j
];

263 
	`ªmove_v£t
(
§t
, 
iv£t
);

264 
	}
}

266 
	$cmp°rögp
(c⁄° *
p1
, c⁄° *
p2
)

268  
	`°rcmp
(* (* c⁄° *Ë
p1
, * (* c⁄° *Ë
p2
);

269 
	}
}

270 
	$debug_v£ts
(
§_s‹t_t
 *
§t
)

272 
i
,
j
,
k
;

273 
i
=0; i<
§t
->
nv£t
; i++)

275 
	`Ârötf
(
°dîr
,"dbg_v£à%d:", 
i
);

276 
j
=0; j<
§t
->
v£t
[
i
].
mask
->
n
; j++Ë
	`Ârötf
(
°dîr
,"%c%lu",j==0?' ':':',§t->v£t[i].mask->
b
[j]);

277 
	`Ârötf
(
°dîr
,"\t");

278 
j
=0; j<
§t
->
v£t
[
i
].
nv¨
; j++)

280 
v¨_t
 *
v¨
 = &
§t
->v¨[§t->
v£t
[
i
].v¨[
j
]];

281 
	`Ârötf
(
°dîr
,"\t%s",
v¨
->
°r
);

282 
k
=0; k<
v¨
->
nvcf
; k++)

283 
	`Ârötf
(
°dîr
,"%c%d", 
k
==0?':':',',
v¨
->
vcf
[k]);

285 
	`Ârötf
(
°dîr
,"\n");

287 
	}
}

288 
	$debug_vbuf
(
§_s‹t_t
 *
§t
)

290 
i
, 
j
;

291 
j
=0; j<
§t
->
vcf_buf
[0].
ƒec
; j++)

293 
	`Ârötf
(
°dîr
,"dbg_vbu‡%d:\t", 
j
);

294 
i
=0; i<
§t
->
§
->
ƒódîs
; i++)

296 
vcf_buf_t
 *
buf
 = &
§t
->
vcf_buf
[
i
];

297 
	`Ârötf
(
°dîr
,"\t%d", 
buf
->
ªc
[
j
] ? buf->ªc[j]->
pos
+1 : 0);

299 
	`Ârötf
(
°dîr
,"\n");

301 
	}
}

302 *
	$gΩ_¸óã_key
(
§_s‹t_t
 *
§t
)

304 i‡–!
§t
->
°r
.
l
 )  
	`°rdup
("");

305 
i
;

306 
	`hts_ex∑nd
(*,
§t
->
noff
,§t->
mch¨p
,§t->
ch¨p
);

307 
i
=0; i<
§t
->
noff
; i++)

309 
§t
->
ch¨p
[
i
] = sπ->
°r
.
s
 + sπ->
off
[i];

310 i‡–
i
>0 ) 
§t
->
ch¨p
[i][-1] = 0;

312 
	`qs‹t
(
§t
->
ch¨p
, sπ->
noff
, (*§t->ch¨p), 
cmp°rögp
);

313 *
ªt
 = (*Ë
	`mÆloc
(
§t
->
°r
.
l
 + 1), *
±r
 =Ñet;

314 
i
=0; i<
§t
->
noff
; i++)

316 
Àn
 = 
	`°æí
(
§t
->
ch¨p
[
i
]);

317 
	`mem˝y
(
±r
, 
§t
->
ch¨p
[
i
], 
Àn
);

318 
±r
 +
Àn
 + 1;

319 
±r
[-1] = 
i
+1==
§t
->
noff
 ? 0 : ';';

321  
ªt
;

322 
	}
}

323 
	$bcf_§_s‹t_£t
(
bcf_§s_t
 *
ªadîs
, 
§_s‹t_t
 *
§t
, c⁄° *
chr
, 
mö_pos
)

325 i‡–!
§t
->
gΩ_°r2öt
 )

328 i‡–!
§t
->
∑ú
 )

330 i‡–
ªadîs
->
cﬁœp£
==
COLLAPSE_NONE
 )Ñódîs->cﬁœp£ = 
BCF_SR_PAIR_EXACT
;

331 
	`bcf_§_£t_›t
(
ªadîs
, 
BCF_SR_PAIR_LOGIC
,Ñódîs->
cﬁœp£
);

333 
	`bcf_§_öô_sc‹es
(
§t
);

334 
§t
->
gΩ_°r2öt
 = 
	`khash_°r2öt_öô
();

335 
§t
->
v¨_°r2öt
 = 
	`khash_°r2öt_öô
();

337 
k
;

338 
	`khash_t
(
°r2öt
Ë*
hash
;

339 
hash
 = 
§t
->
gΩ_°r2öt
;

340 
k
=0; k < 
	`kh_íd
(
hash
); k++)

341 i‡–
	`kh_exi°
(
hash
,
k
ËË
	`‰ì
((*)
	`kh_key
(hash,k));

342 
hash
 = 
§t
->
v¨_°r2öt
;

343 
k
=0; k < 
	`kh_íd
(
hash
); k++)

344 i‡–
	`kh_exi°
(
hash
,
k
ËË
	`‰ì
((*)
	`kh_key
(hash,k));

345 
	`kh_˛ór
(
°r2öt
, 
§t
->
gΩ_°r2öt
);

346 
	`kh_˛ór
(
°r2öt
, 
§t
->
v¨_°r2öt
);

347 
§t
->
ngΩ
 = sπ->
nv¨
 = sπ->
nv£t
 = 0;

349 
gΩ_t
 
gΩ
;

350 
	`mem£t
(&
gΩ
,0,(
gΩ_t
));

353 
úódî
,
iv¨
,
úec
,
igΩ
,
iv£t
;

354 
úódî
=0; iªadî<
ªadîs
->
ƒódîs
; ireader++)

356 
§t
->
vcf_buf
[
úódî
].
ƒec
 = 0;

358 
bcf_§_t
 *
ªadî
 = &
ªadîs
->ªadîs[
úódî
];

359 
rid
 = 
	`bcf_hdr_«me2id
(
ªadî
->
hódî
, 
chr
);

360 
gΩ
.
nv¨
 = 0;

361 
	`hts_ex∑nd
(,
ªadî
->
nbuf„r
,
§t
->
moff
,§t->
off
);

362 
§t
->
noff
 = 0;

363 
§t
->
°r
.
l
 = 0;

364 
úec
=1; iªc<=
ªadî
->
nbuf„r
; irec++)

366 
bcf1_t
 *
löe
 = 
ªadî
->
buf„r
[
úec
];

367 i‡–
löe
->
rid
!Ùid ||Üöe->
pos
!=
mö_pos
 ) ;

369 i‡–
§t
->
°r
.
l
 ) 
	`kputc
(';',&srt->str);

370 
§t
->
off
[§t->
noff
++] = sπ->
°r
.
l
;

371 
size_t
 
beg
 = 
§t
->
°r
.
l
;

372 
iv¨
=1; iv¨<
löe
->
n_ÆÀÀ
; ivar++)

374 i‡–
iv¨
>1 ) 
	`kputc
(',',&
§t
->
°r
);

375 
	`kputs
(
löe
->
d
.
ÆÀÀ
[0],&
§t
->
°r
);

376 
	`kputc
('>',&
§t
->
°r
);

377 
	`kputs
(
löe
->
d
.
ÆÀÀ
[
iv¨
],&
§t
->
°r
);

379 i‡–
löe
->
n_ÆÀÀ
==1 )

381 
	`kputs
(
löe
->
d
.
ÆÀÀ
[0],&
§t
->
°r
);

382 
	`kput¢
(">.",2,&
§t
->
°r
);

387 *
v¨_°r
 = 
beg
 + 
§t
->
°r
.
s
;

388 
ªt
, 
v¨_idx
 = 0, 
v¨_íd
 = 
§t
->
°r
.
l
;

391 
ªt
 = 
	`khash_°r2öt_gë
(
§t
->
v¨_°r2öt
, 
v¨_°r
, &
iv¨
);

392 i‡–
ªt
==-1 ) ;

394 
v¨_t
 *
v¨
 = &
§t
->v¨[
iv¨
];

395 i‡–
v¨
->
vcf
[v¨->
nvcf
-1] !
úódî
 ) ;

397 
§t
->
°r
.
l
 = 
v¨_íd
;

398 
	`kputw
(
v¨_idx
, &
§t
->
°r
);

399 
v¨_°r
 = 
beg
 + 
§t
->
°r
.
s
;

400 
v¨_idx
++;

402 i‡–
ªt
==-1 )

404 
iv¨
 = 
§t
->
nv¨
++;

405 
	`hts_ex∑nd0
(
v¨_t
,
§t
->
nv¨
,§t->
mv¨
,§t->
v¨
);

406 
§t
->
v¨
[
iv¨
].
nvcf
 = 0;

407 
	`khash_°r2öt_£t
(
§t
->
v¨_°r2öt
, 
	`°rdup
(
v¨_°r
), 
iv¨
);

408 
	`‰ì
(
§t
->
v¨
[
iv¨
].
°r
);

410 
v¨_t
 *
v¨
 = &
§t
->v¨[
iv¨
];

411 
v¨
->
«…
 = 
löe
->
n_ÆÀÀ
 - 1;

412 
v¨
->
ty≥
 = 
	`bcf_gë_v¨ü¡_ty≥s
(
löe
);

413 
§t
->
°r
.
s
[
v¨_íd
] = 0;

414 i‡–
ªt
==-1 )

415 
v¨
->
°r
 = 
	`°rdup
(
v¨_°r
);

417 
mvcf
 = 
v¨
->mvcf;

418 
v¨
->
nvcf
++;

419 
	`hts_ex∑nd0
(*, 
v¨
->
nvcf
, v¨->
mvcf
, v¨->
vcf
);

420 i‡–
mvcf
 !
v¨
->mvc‡Ëv¨->
ªc
 = (
bcf1_t
 **Ë
	`ªÆloc
(var->rec,(bcf1_t*)*var->mvcf);

421 
v¨
->
vcf
[v¨->
nvcf
-1] = 
úódî
;

422 
v¨
->
ªc
[v¨->
nvcf
-1] = 
löe
;

424 
gΩ
.
nv¨
++;

425 
	`hts_ex∑nd
(
v¨_t
,
gΩ
.
nv¨
,gΩ.
mv¨
,gΩ.
v¨
);

426 
gΩ
.
v¨
[gΩ.
nv¨
-1] = 
iv¨
;

428 *
gΩ_key
 = 
	`gΩ_¸óã_key
(
§t
);

429 
ªt
 = 
	`khash_°r2öt_gë
(
§t
->
gΩ_°r2öt
, 
gΩ_key
, &
igΩ
);

430 i‡–
ªt
==-1 )

432 
igΩ
 = 
§t
->
ngΩ
++;

433 
	`hts_ex∑nd0
(
gΩ_t
, 
§t
->
ngΩ
, sπ->
mgΩ
, sπ->
gΩ
);

434 
	`‰ì
(
§t
->
gΩ
[
igΩ
].
v¨
);

435 
§t
->
gΩ
[
igΩ
] = grp;

436 
§t
->
gΩ
[
igΩ
].
key
 = 
gΩ_key
;

437 
	`khash_°r2öt_£t
(
§t
->
gΩ_°r2öt
, 
gΩ_key
, 
igΩ
);

438 
	`mem£t
(&
gΩ
,0,(
gΩ_t
));

441 
	`‰ì
(
gΩ_key
);

442 
§t
->
gΩ
[
igΩ
].
nvcf
++;

444 
	`‰ì
(
gΩ
.
v¨
);

447 
iv¨
=0; iv¨<
§t
->
nv¨
; ivar++)

449 
§t
->
v¨
[
iv¨
].
mask
 = 
	`kbs_ªsize
(§t->v¨[iv¨].mask, sπ->
ngΩ
);

450 
	`kbs_˛ór
(
§t
->
v¨
[
iv¨
].
mask
);

452 
igΩ
=0; igΩ<
§t
->
ngΩ
; igrp++)

454 
iv¨
=0; iv¨<
§t
->
gΩ
[
igΩ
].
nv¨
; ivar++)

456 
i
 = 
§t
->
gΩ
[
igΩ
].
v¨
[
iv¨
];

457 
	`kbs_ö£π
(
§t
->
v¨
[
i
].
mask
, 
igΩ
);

462 
iv¨
=0; iv¨<
§t
->
nv¨
; ivar++)

464 
iv£t
 = 
§t
->
nv£t
++;

465 
	`hts_ex∑nd0
(
v¨£t_t
, 
§t
->
nv£t
, sπ->
mv£t
, sπ->
v£t
);

467 
v¨£t_t
 *
v£t
 = &
§t
->v£t[
iv£t
];

468 
v£t
->
nv¨
 = 1;

469 
	`hts_ex∑nd0
(
v¨_t
, 
v£t
->
nv¨
, v£t->
mv¨
, v£t->
v¨
);

470 
v£t
->
v¨
[v£t->
nv¨
-1] = 
iv¨
;

471 
v¨_t
 *
v¨
 = &
§t
->v¨[
iv¨
];

472 
v£t
->
˙t
 = 
v¨
->
nvcf
;

473 
v£t
->
mask
 = 
	`kbs_ªsize
(v£t->mask, 
§t
->
ngΩ
);

474 
	`kbs_˛ór
(
v£t
->
mask
);

475 
	`kbs_bôwi£_‹
(
v£t
->
mask
, 
v¨
->mask);

477 
ty≥
 = 0;

478 i‡–
v¨
->
ty≥
==
VCF_REF
 )Åy≥ |
SR_REF
;

481 i‡–
v¨
->
ty≥
 & 
VCF_SNP
 )Åy≥ |
SR_SNP
;

482 i‡–
v¨
->
ty≥
 & 
VCF_MNP
 )Åy≥ |
SR_SNP
;

483 i‡–
v¨
->
ty≥
 & 
VCF_INDEL
 )Åy≥ |
SR_INDEL
;

484 i‡–
v¨
->
ty≥
 & 
VCF_OTHER
 )Åy≥ |
SR_OTHER
;

486 
v¨
->
ty≥
 =Åype;

491 
	`hts_ex∑nd
(, 
§t
->
ngΩ
*§t->
nv£t
, sπ->
mpm©
, sπ->
pm©
);

492 
	`hts_ex∑nd
(, 
§t
->
nv£t
, sπ->
m˙t
, sπ->
˙t
);

493 
	`mem£t
(
§t
->
pm©
, 0, (*§t->pm©)*§t->
ngΩ
*§t->
nv£t
);

494 
iv£t
=0; iv£t<
§t
->
nv£t
; ivset++)

496 
v¨£t_t
 *
v£t
 = &
§t
->v£t[
iv£t
];

497 
igΩ
=0; igΩ<
§t
->
ngΩ
; igΩ++Ë§t->
pm©
[
iv£t
*srt->ngrp+igrp] = 0;

498 
§t
->
˙t
[
iv£t
] = 
v£t
->cnt;

502  
§t
->
nv£t
 )

506 
imax
 = 0;

507 
iv£t
=1; iv£t<
§t
->
nv£t
; ivset++)

508 i‡–
§t
->
˙t
[
imax
] < sπ->˙t[
iv£t
] ) imax = ivset;

510 
ùaú
 = -1;

511 
uöt32_t
 
max_sc‹e
 = 0;

512 
iv£t
=0; iv£t<
§t
->
nv£t
; ivset++)

514 i‡–
	`kbs_logiˇl_™d
(
§t
->
v£t
[
imax
].
mask
,§t->v£t[
iv£t
].mask) ) ;

515 
uöt32_t
 
sc‹e
 = 
	`∑úög_sc‹e
(
§t
, 
imax
, 
iv£t
);

517 i‡–
max_sc‹e
 < 
sc‹e
 ) { max_sc‹êsc‹e; 
ùaú
 = 
iv£t
; }

521 i‡–
ùaú
!=-1 && i∑ú!=
imax
 )

523 
imax
 = 
	`mîge_v£ts
(
§t
, imax, 
ùaú
);

527 
	`push_v£t
(
§t
, 
imax
);

530 
§t
->
chr
 = chr;

531 
§t
->
pos
 = 
mö_pos
;

532 
	}
}

534 
	$bcf_§_s‹t_√xt
(
bcf_§s_t
 *
ªadîs
, 
§_s‹t_t
 *
§t
, c⁄° *
chr
, 
mö_pos
)

536 
i
,
j
;

537 i‡–
ªadîs
->
ƒódîs
 == 1 )

539 
§t
->
n§
 = 1;

540 i‡–!
§t
->
m§
 )

542 
§t
->
vcf_buf
 = (
vcf_buf_t
*Ë
	`ˇŒoc
(1,(vcf_buf_t));

543 
§t
->
m§
 = 1;

545 
bcf_§_t
 *
ªadî
 = &
ªadîs
->readers[0];

546 
	`as£π
–
ªadî
->
buf„r
[1]->
pos
==
mö_pos
 );

547 
bcf1_t
 *
tmp
 = 
ªadî
->
buf„r
[0];

548 
j
=1; j<=
ªadî
->
nbuf„r
; j++Ëªadî->
buf„r
[j-1] =Ñeader->buffer[j];

549 
ªadî
->
buf„r
[Ñódî->
nbuf„r
 ] = 
tmp
;

550 
ªadî
->
nbuf„r
--;

551 
ªadîs
->
has_löe
[0] = 1;

554 i‡–
§t
->
n§
 !
ªadîs
->
ƒódîs
 )

556 
§t
->
§
 = 
ªadîs
;

557 i‡–
§t
->
n§
 < 
ªadîs
->
ƒódîs
 )

559 
§t
->
vcf_buf
 = (
vcf_buf_t
*Ë
	`ªÆloc
(§t->vcf_buf,
ªadîs
->
ƒódîs
*(vcf_buf_t));

560 
	`mem£t
(
§t
->
vcf_buf
 + sπ->
n§
, 0, (
vcf_buf_t
)*(
ªadîs
->
ƒódîs
 - srt->nsr));

561 i‡–
§t
->
m§
 < sπ->
n§
 ) srt->msr = srt->nsr;

563 
§t
->
n§
 = 
ªadîs
->
ƒódîs
;

564 
§t
->
chr
 = 
NULL
;

566 i‡–!
§t
->
chr
 || sπ->
pos
!=
mö_pos
 || 
	`°rcmp
(§t->chr,chrËË
	`bcf_§_s‹t_£t
(
ªadîs
, srt, chr, min_pos);

568 i‡–!
§t
->
vcf_buf
[0].
ƒec
 )  0;

572 
ƒë
 = 0;

573 
i
=0; i<
§t
->
§
->
ƒódîs
; i++)

575 
vcf_buf_t
 *
buf
 = &
§t
->
vcf_buf
[
i
];

577 i‡–
buf
->
ªc
[0] )

579 
bcf_§_t
 *
ªadî
 = &
§t
->
§
->
ªadîs
[
i
];

580 
j
=1; j<=
ªadî
->
nbuf„r
; j++)

581 i‡–
ªadî
->
buf„r
[
j
] =
buf
->
ªc
[0] ) ;

583 
	`as£π
–
j
<=
ªadî
->
nbuf„r
 );

585 
bcf1_t
 *
tmp
 = 
ªadî
->
buf„r
[0];

586 
ªadî
->
buf„r
[0] =Ñódî->buf„r[
j
++];

587 ; 
j
<=
ªadî
->
nbuf„r
; j++Ëªadî->
buf„r
[j-1] =Ñeader->buffer[j];

588 
ªadî
->
buf„r
[Ñódî->
nbuf„r
 ] = 
tmp
;

589 
ªadî
->
nbuf„r
--;

591 
ƒë
++;

592 
§t
->
§
->
has_löe
[
i
] = 1;

595 
§t
->
§
->
has_löe
[
i
] = 0;

597 
buf
->
ƒec
--;

598 i‡–
buf
->
ƒec
 > 0 )

599 
	`memmove
(
buf
->
ªc
, &buf->ªc[1], buf->
ƒec
*(
bcf1_t
*));

601  
ƒë
;

602 
	}
}

603 
	$bcf_§_s‹t_ªmove_ªadî
(
bcf_§s_t
 *
ªadîs
, 
§_s‹t_t
 *
§t
, 
i
)

605 
	`‰ì
(
§t
->
vcf_buf
[
i
].
ªc
);

606 i‡–
i
+1 < 
§t
->
n§
 )

607 
	`memmove
(&
§t
->
vcf_buf
[
i
], &§t->vcf_buf[i+1], (§t->
n§
 - i - 1)*(
vcf_buf_t
));

608 
	`mem£t
(
§t
->
vcf_buf
 + sπ->
n§
 - 1, 0, (
vcf_buf_t
));

609 
	}
}

610 
§_s‹t_t
 *
	$bcf_§_s‹t_öô
(
§_s‹t_t
 *
§t
)

612 i‡–!
§t
 )  
	`ˇŒoc
(1,(
§_s‹t_t
));

613 
	`mem£t
(
§t
,0,(
§_s‹t_t
));

614  
§t
;

615 
	}
}

616 
	$bcf_§_s‹t_de°roy
(
§_s‹t_t
 *
§t
)

618 i‡–
§t
->
v¨_°r2öt
 ) 
	`khash_°r2öt_de°roy_‰ì
(srt->var_str2int);

619 i‡–
§t
->
gΩ_°r2öt
 ) 
	`khash_°r2öt_de°roy_‰ì
(srt->grp_str2int);

620 
i
;

621 
i
=0; i<
§t
->
n§
; i++Ë
	`‰ì
(§t->
vcf_buf
[i].
ªc
);

622 
	`‰ì
(
§t
->
vcf_buf
);

623 
i
=0; i<
§t
->
mv¨
; i++)

625 
	`‰ì
(
§t
->
v¨
[
i
].
°r
);

626 
	`‰ì
(
§t
->
v¨
[
i
].
vcf
);

627 
	`‰ì
(
§t
->
v¨
[
i
].
ªc
);

628 
	`kbs_de°roy
(
§t
->
v¨
[
i
].
mask
);

630 
	`‰ì
(
§t
->
v¨
);

631 
i
=0; i<
§t
->
mgΩ
; i++)

632 
	`‰ì
(
§t
->
gΩ
[
i
].
v¨
);

633 
	`‰ì
(
§t
->
gΩ
);

634 
i
=0; i<
§t
->
mv£t
; i++)

636 
	`kbs_de°roy
(
§t
->
v£t
[
i
].
mask
);

637 
	`‰ì
(
§t
->
v£t
[
i
].
v¨
);

639 
	`‰ì
(
§t
->
v£t
);

640 
	`‰ì
(
§t
->
°r
.
s
);

641 
	`‰ì
(
§t
->
off
);

642 
	`‰ì
(
§t
->
ch¨p
);

643 
	`‰ì
(
§t
->
˙t
);

644 
	`‰ì
(
§t
->
pm©
);

645 
	`mem£t
(
§t
,0,(*srt));

646 
	}
}

	@htslib/bcf_sr_sort.h

34 #i‚de‡
__BCF_SR_SORT_H__


35 
	#__BCF_SR_SORT_H__


	)

37 
	~"ht¶ib/syn˚d_bcf_ªadî.h
"

38 
	~"ht¶ib/kbô£t.h
"

42 
	mƒec
, 
	mmªc
;

43 
bcf1_t
 **
	mªc
;

45 
	tvcf_buf_t
;

49 *
	m°r
;

50 
	mty≥
;

51 
	m«…
;

52 
	mnvcf
, 
	mmvcf
, *
	mvcf
;

53 
bcf1_t
 **
	mªc
;

54 
kbô£t_t
 *
	mmask
;

56 
	tv¨_t
;

60 *
	mkey
;

61 
	mnv¨
, 
	mmv¨
, *
	mv¨
;

62 
	mnvcf
;

64 
	tgΩ_t
;

68 
	mnv¨
, 
	mmv¨
, *
	mv¨
;

69 
	m˙t
;

70 
kbô£t_t
 *
	mmask
;

72 
	tv¨£t_t
;

76 
uöt8_t
 
	msc‹e
[256];

77 
	mnv¨
, 
	mmv¨
;

78 
v¨_t
 *
	mv¨
;

79 
	mnv£t
, 
	mmv£t
;

80 
	mmpm©
, *
	mpm©
;

81 
	mngΩ
, 
	mmgΩ
;

82 
	mm˙t
, *
	m˙t
;

83 
gΩ_t
 *
	mgΩ
;

84 
v¨£t_t
 *
	mv£t
;

85 
vcf_buf_t
 *
	mvcf_buf
;

86 
bcf_§s_t
 *
	m§
;

87 *
	mgΩ_°r2öt
;

88 *
	mv¨_°r2öt
;

89 
k°rög_t
 
	m°r
;

90 
	mmoff
, 
	mnoff
, *
	moff
, 
	mmch¨p
;

91 **
	mch¨p
;

92 c⁄° *
	mchr
;

93 
	mpos
, 
	mn§
, 
	mm§
;

94 
	m∑ú
;

96 
	t§_s‹t_t
;

98 
§_s‹t_t
 *
bcf_§_s‹t_öô
(§_s‹t_à*
§t
);

99 
bcf_§_s‹t_√xt
(
bcf_§s_t
 *
ªadîs
, 
§_s‹t_t
 *
§t
, c⁄° *
chr
, 
pos
);

100 
bcf_§_s‹t_de°roy
(
§_s‹t_t
 *
§t
);

101 
bcf_§_s‹t_ªmove_ªadî
(
bcf_§s_t
 *
ªadîs
, 
§_s‹t_t
 *
§t
, 
i
);

	@htslib/bgzf.c

26 
	~<c⁄fig.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<î∫o.h
>

32 
	~<uni°d.h
>

33 
	~<as£π.h
>

34 
	~<±hªad.h
>

35 
	~<sys/ty≥s.h
>

36 
	~<öây≥s.h
>

38 
	~"ht¶ib/hts.h
"

39 
	~"ht¶ib/bgzf.h
"

40 
	~"ht¶ib/hfûe.h
"

41 
	~"ht¶ib/thªad_poﬁ.h
"

42 
	~"¸am/poﬁed_Æloc.h
"

44 
	#BGZF_CACHE


	)

45 
	#BGZF_MT


	)

47 
	#BLOCK_HEADER_LENGTH
 18

	)

48 
	#BLOCK_FOOTER_LENGTH
 8

	)

65 c⁄° 
uöt8_t
 
	gg_magic
[19] = "\037\213\010\4\0\0\0\0\0\377\6\0\102\103\2\0\0\0";

67 #ifde‡
BGZF_CACHE


69 
	msize
;

70 
uöt8_t
 *
	mblock
;

71 
öt64_t
 
	míd_off£t
;

72 } 
	tˇche_t
;

73 
	~"ht¶ib/khash.h
"

74 
	$KHASH_MAP_INIT_INT64
(
ˇche
, 
ˇche_t
)

77 #ifde‡
BGZF_MT


79 
	sbgzf_job
 {

80 
BGZF
 *
Â
;

81 
comp_d©a
[
BGZF_MAX_BLOCK_SIZE
];

82 
size_t
 
comp_Àn
;

83 
uncomp_d©a
[
BGZF_MAX_BLOCK_SIZE
];

84 
size_t
 
uncomp_Àn
;

85 
îrcode
;

86 
öt64_t
 
block_addªss
;

87 
hô_eof
;

88 } 
	tbgzf_job
;

90 
	emèux_cmd
 {

91 
NONE
 = 0,

92 
SEEK
,

93 
HAS_EOF
,

94 
CLOSE
,

97 
	sbgzf_mèux_t
 {

99 
poﬁ_Æloc_t
 *
job_poﬁ
;

100 
bgzf_job
 *
cuº_job
;

103 
n_thªads
;

104 
own_poﬁ
;

105 
hts_çoﬁ
 *
poﬁ
;

108 
hts_çoﬁ_¥o˚ss
 *
out_queue
;

111 
±hªad_t
 
io_èsk
;

112 
±hªad_muãx_t
 
job_poﬁ_m
;

113 
jobs_≥ndög
;

114 
Êush_≥ndög
;

115 *
‰ì_block
;

116 
hô_eof
;

119 
îrcode
;

120 
uöt64_t
 
block_addªss
;

121 
eof
;

122 
±hªad_muãx_t
 
comm™d_m
;

123 
±hªad_c⁄d_t
 
comm™d_c
;

124 
mèux_cmd
 
comm™d
;

125 } 
	tmèux_t
;

130 
uöt64_t
 
uaddr
;

131 
uöt64_t
 
ˇddr
;

133 
	tbgzidx1_t
;

135 
	s__bgzidx_t


137 
noffs
, 
moffs
;

138 
bgzidx1_t
 *
offs
;

139 
uöt64_t
 
ublock_addr
;

142 
	`bgzf_ödex_de°roy
(
BGZF
 *
Â
);

143 
	`bgzf_ödex_add_block
(
BGZF
 *
Â
);

144 
	`mt_de°roy
(
mèux_t
 *
mt
);

146 
ölöe
 
	$∑ckI¡16
(
uöt8_t
 *
buf„r
, 
uöt16_t
 
vÆue
)

148 
buf„r
[0] = 
vÆue
;

149 
buf„r
[1] = 
vÆue
 >> 8;

150 
	}
}

152 
ölöe
 
	$u≈ackI¡16
(c⁄° 
uöt8_t
 *
buf„r
)

154  
buf„r
[0] | buffer[1] << 8;

155 
	}
}

157 
ölöe
 
	$∑ckI¡32
(
uöt8_t
 *
buf„r
, 
uöt32_t
 
vÆue
)

159 
buf„r
[0] = 
vÆue
;

160 
buf„r
[1] = 
vÆue
 >> 8;

161 
buf„r
[2] = 
vÆue
 >> 16;

162 
buf„r
[3] = 
vÆue
 >> 24;

163 
	}
}

165 c⁄° *
	$bgzf_zîr
(
î∫um
, 
z_°ªam
 *
zs
)

167 
buf„r
[32];

177 i‡(
zs
 && zs->
msg
)  zs->msg;

180 
î∫um
) {

181 
Z_ERRNO
:

182  
	`°ªº‹
(
î∫o
);

183 
Z_STREAM_ERROR
:

185 
Z_DATA_ERROR
:

187 
Z_MEM_ERROR
:

189 
Z_BUF_ERROR
:

191 
Z_VERSION_ERROR
:

193 
Z_OK
:

195 
	`¢¥ötf
(
buf„r
, (buf„r), "[%d] unknown", 
î∫um
);

196  
buf„r
;

198 
	}
}

200 
BGZF
 *
	$bgzf_ªad_öô
(
hFILE
 *
hÂr
)

202 
BGZF
 *
Â
;

203 
uöt8_t
 
magic
[18];

204 
ssize_t
 
n
 = 
	`h≥ek
(
hÂr
, 
magic
, 18);

205 i‡(
n
 < 0Ë 
NULL
;

207 
Â
 = (
BGZF
*)
	`ˇŒoc
(1, (BGZF));

208 i‡(
Â
 =
NULL
)  NULL;

210 
Â
->
is_wrôe
 = 0;

211 
Â
->
uncom¥es£d_block
 = 
	`mÆloc
(2 * 
BGZF_MAX_BLOCK_SIZE
);

212 i‡(
Â
->
uncom¥es£d_block
 =
NULL
Ë{ 
	`‰ì
(fp);  NULL; }

213 
Â
->
com¥es£d_block
 = (*)Â->
uncom¥es£d_block
 + 
BGZF_MAX_BLOCK_SIZE
;

214 
Â
->
is_com¥es£d
 = (
n
==18 && 
magic
[0]==0x1f && magic[1]==0x8b);

215 
Â
->
is_gzù
 = ( !Â->
is_com¥es£d
 || ((
magic
[3]&4Ë&& 
	`memcmp
(&magic[12], "BC\2\0",4)==0) ) ? 0 : 1;

216 #ifde‡
BGZF_CACHE


217 
Â
->
ˇche
 = 
	`kh_öô
(cache);

219  
Â
;

220 
	}
}

223 
	$mode2Àvñ
(c⁄° *
mode
)

225 
i
, 
com¥ess_Àvñ
 = -1;

226 
i
 = 0; 
mode
[i]; ++i)

227 i‡(
mode
[
i
] >= '0' && mode[i] <= '9') ;

228 i‡(
mode
[
i
]Ë
com¥ess_Àvñ
 = ()mode[i] - '0';

229 i‡(
	`°rchr
(
mode
, 'u')Ë
com¥ess_Àvñ
 = -2;

230  
com¥ess_Àvñ
;

231 
	}
}

232 
BGZF
 *
	$bgzf_wrôe_öô
(c⁄° *
mode
)

234 
BGZF
 *
Â
;

235 
Â
 = (
BGZF
*)
	`ˇŒoc
(1, (BGZF));

236 i‡(
Â
 =
NULL
Ë
mem_Áû
;

237 
Â
->
is_wrôe
 = 1;

238 
com¥ess_Àvñ
 = 
	`mode2Àvñ
(
mode
);

239 i‡–
com¥ess_Àvñ
==-2 )

241 
Â
->
is_com¥es£d
 = 0;

242  
Â
;

244 
Â
->
is_com¥es£d
 = 1;

246 
Â
->
uncom¥es£d_block
 = 
	`mÆloc
(2 * 
BGZF_MAX_BLOCK_SIZE
);

247 i‡(
Â
->
uncom¥es£d_block
 =
NULL
Ë
mem_Áû
;

248 
Â
->
com¥es£d_block
 = (*)Â->
uncom¥es£d_block
 + 
BGZF_MAX_BLOCK_SIZE
;

250 
Â
->
com¥ess_Àvñ
 = com¥ess_Àvñ < 0? 
Z_DEFAULT_COMPRESSION
 : compress_level;

251 i‡(
Â
->
com¥ess_Àvñ
 > 9ËÂ->com¥ess_Àvñ = 
Z_DEFAULT_COMPRESSION
;

252 i‡–
	`°rchr
(
mode
,'g') )

255 
Â
->
is_gzù
 = 1;

256 
Â
->
gz_°ªam
 = (
z_°ªam
*)
	`ˇŒoc
(1,(z_stream));

257 i‡(
Â
->
gz_°ªam
 =
NULL
Ë
mem_Áû
;

258 
Â
->
gz_°ªam
->
zÆloc
 = 
NULL
;

259 
Â
->
gz_°ªam
->
z‰ì
 = 
NULL
;

260 
Â
->
gz_°ªam
->
msg
 = 
NULL
;

262 
ªt
 = 
	`deÊ©eInô2
(
Â
->
gz_°ªam
, fp->
com¥ess_Àvñ
, 
Z_DEFLATED
, 15|16, 8, 
Z_DEFAULT_STRATEGY
);

263 i‡(
ªt
!=
Z_OK
) {

264 i‡(
hts_vîbo£
 >= 1) {

265 
	`Ârötf
(
°dîr
, "[E::%s] deflateInit2 failed: %s\n",

266 
__func__
, 
	`bgzf_zîr
(
ªt
, 
Â
->
gz_°ªam
));

268 
Áû
;

271  
Â
;

273 
mem_Áû
:

274 i‡(
hts_vîbo£
 >= 1) {

275 
	`Ârötf
(
°dîr
, "[E::%s] %s\n", 
__func__
, 
	`°ªº‹
(
î∫o
));

277 
Áû
:

278 i‡(
Â
 !
NULL
) {

279 
	`‰ì
(
Â
->
uncom¥es£d_block
);

280 
	`‰ì
(
Â
->
gz_°ªam
);

281 
	`‰ì
(
Â
);

283  
NULL
;

284 
	}
}

286 
BGZF
 *
	$bgzf_›í
(c⁄° *
∑th
, c⁄° *
mode
)

288 
BGZF
 *
Â
 = 0;

289 
	`as£π
(
	`com¥essBound
(
BGZF_BLOCK_SIZE
Ë< 
BGZF_MAX_BLOCK_SIZE
);

290 i‡(
	`°rchr
(
mode
, 'r')) {

291 
hFILE
 *
Âr
;

292 i‡((
Âr
 = 
	`h›í
(
∑th
, 
mode
)) == 0)  0;

293 
Â
 = 
	`bgzf_ªad_öô
(
Âr
);

294 i‡(
Â
 =0Ë{ 
	`h˛o£_abru±ly
(
Âr
);  
NULL
; }

295 
Â
->Â = 
Âr
;

296 } i‡(
	`°rchr
(
mode
, 'w') || strchr(mode, 'a')) {

297 
hFILE
 *
Âw
;

298 i‡((
Âw
 = 
	`h›í
(
∑th
, 
mode
)) == 0)  0;

299 
Â
 = 
	`bgzf_wrôe_öô
(
mode
);

300 i‡(
Â
 =
NULL
)  NULL;

301 
Â
->Â = 
Âw
;

303 { 
î∫o
 = 
EINVAL
;  0; }

305 
Â
->
is_be
 = 
	`ed_is_big
();

306  
Â
;

307 
	}
}

309 
BGZF
 *
	$bgzf_d›í
(
fd
, c⁄° *
mode
)

311 
BGZF
 *
Â
 = 0;

312 
	`as£π
(
	`com¥essBound
(
BGZF_BLOCK_SIZE
Ë< 
BGZF_MAX_BLOCK_SIZE
);

313 i‡(
	`°rchr
(
mode
, 'r')) {

314 
hFILE
 *
Âr
;

315 i‡((
Âr
 = 
	`hd›í
(
fd
, 
mode
)) == 0)  0;

316 
Â
 = 
	`bgzf_ªad_öô
(
Âr
);

317 i‡(
Â
 =0Ë{ 
	`h˛o£_abru±ly
(
Âr
);  
NULL
; }

318 
Â
->Â = 
Âr
;

319 } i‡(
	`°rchr
(
mode
, 'w') || strchr(mode, 'a')) {

320 
hFILE
 *
Âw
;

321 i‡((
Âw
 = 
	`hd›í
(
fd
, 
mode
)) == 0)  0;

322 
Â
 = 
	`bgzf_wrôe_öô
(
mode
);

323 i‡(
Â
 =
NULL
)  NULL;

324 
Â
->Â = 
Âw
;

326 { 
î∫o
 = 
EINVAL
;  0; }

328 
Â
->
is_be
 = 
	`ed_is_big
();

329  
Â
;

330 
	}
}

332 
BGZF
 *
	$bgzf_h›í
(
hFILE
 *
hÂ
, c⁄° *
mode
)

334 
BGZF
 *
Â
 = 
NULL
;

335 
	`as£π
(
	`com¥essBound
(
BGZF_BLOCK_SIZE
Ë< 
BGZF_MAX_BLOCK_SIZE
);

336 i‡(
	`°rchr
(
mode
, 'r')) {

337 
Â
 = 
	`bgzf_ªad_öô
(
hÂ
);

338 i‡(
Â
 =
NULL
)  NULL;

339 } i‡(
	`°rchr
(
mode
, 'w') || strchr(mode, 'a')) {

340 
Â
 = 
	`bgzf_wrôe_öô
(
mode
);

341 i‡(
Â
 =
NULL
)  NULL;

343 { 
î∫o
 = 
EINVAL
;  0; }

345 
Â
->Â = 
hÂ
;

346 
Â
->
is_be
 = 
	`ed_is_big
();

347  
Â
;

348 
	}
}

350 
	$bgzf_com¥ess
(*
_d°
, 
size_t
 *
dÀn
, c⁄° *
§c
, size_à
¶í
, 
Àvñ
)

352 
uöt32_t
 
¸c
;

353 
z_°ªam
 
zs
;

354 
uöt8_t
 *
d°
 = (uöt8_t*)
_d°
;

357 
zs
.
zÆloc
 = 
NULL
; zs.
z‰ì
 = NULL;

358 
zs
.
msg
 = 
NULL
;

359 
zs
.
√xt_ö
 = (
Byãf
*)
§c
;

360 
zs
.
avaû_ö
 = 
¶í
;

361 
zs
.
√xt_out
 = 
d°
 + 
BLOCK_HEADER_LENGTH
;

362 
zs
.
avaû_out
 = *
dÀn
 - 
BLOCK_HEADER_LENGTH
 - 
BLOCK_FOOTER_LENGTH
;

363 
ªt
 = 
	`deÊ©eInô2
(&
zs
, 
Àvñ
, 
Z_DEFLATED
, -15, 8, 
Z_DEFAULT_STRATEGY
);

364 i‡(
ªt
!=
Z_OK
) {

365 i‡(
hts_vîbo£
 >= 1) {

366 
	`Ârötf
(
°dîr
, "[E::%s] deflateInit2 failed: %s\n",

367 
__func__
, 
	`bgzf_zîr
(
ªt
, &
zs
));

371 i‡((
ªt
 = 
	`deÊ©e
(&
zs
, 
Z_FINISH
)Ë!
Z_STREAM_END
) {

372 i‡(
hts_vîbo£
 >= 1) {

373 
	`Ârötf
(
°dîr
, "[E::%s] deflate failed: %s\n",

374 
__func__
, 
	`bgzf_zîr
(
ªt
,Ñë =
Z_DATA_ERROR
 ? &
zs
 : 
NULL
));

378 i‡((
ªt
 = 
	`deÊ©eEnd
(&
zs
)Ë!
Z_OK
) {

379 i‡(
hts_vîbo£
 >= 1) {

380 
	`Ârötf
(
°dîr
, "[E::%s] deflateEnd failed: %s\n",

381 
__func__
, 
	`bgzf_zîr
(
ªt
, 
NULL
));

385 *
dÀn
 = 
zs
.
tŸÆ_out
 + 
BLOCK_HEADER_LENGTH
 + 
BLOCK_FOOTER_LENGTH
;

387 
	`mem˝y
(
d°
, 
g_magic
, 
BLOCK_HEADER_LENGTH
);

388 
	`∑ckI¡16
(&
d°
[16], *
dÀn
 - 1);

390 
¸c
 = 
	`¸c32
(¸c32(0L, 
NULL
, 0L), (
Byãf
*)
§c
, 
¶í
);

391 
	`∑ckI¡32
((
uöt8_t
*)&
d°
[*
dÀn
 - 8], 
¸c
);

392 
	`∑ckI¡32
((
uöt8_t
*)&
d°
[*
dÀn
 - 4], 
¶í
);

394 
	}
}

396 
	$bgzf_gzù_com¥ess
(
BGZF
 *
Â
, *
_d°
, 
size_t
 *
dÀn
, c⁄° *
§c
, size_à
¶í
, 
Àvñ
)

398 
uöt8_t
 *
d°
 = (uöt8_t*)
_d°
;

399 
z_°ªam
 *
zs
 = 
Â
->
gz_°ªam
;

400 
Êush
 = 
¶í
 ? 
Z_PARTIAL_FLUSH
 : 
Z_FINISH
;

401 
zs
->
√xt_ö
 = (
Byãf
*)
§c
;

402 
zs
->
avaû_ö
 = 
¶í
;

403 
zs
->
√xt_out
 = 
d°
;

404 
zs
->
avaû_out
 = *
dÀn
;

405 
ªt
 = 
	`deÊ©e
(
zs
, 
Êush
);

406 i‡(
ªt
 =
Z_STREAM_ERROR
) {

407 i‡(
hts_vîbo£
 >= 1) {

408 
	`Ârötf
(
°dîr
, "[E::%s] deflate failed: %s\n",

409 
__func__
, 
	`bgzf_zîr
(
ªt
, 
NULL
));

413 i‡(
zs
->
avaû_ö
 != 0) {

414 i‡(
hts_vîbo£
 >= 1) {

415 
	`Ârötf
(
°dîr
, "[E::%s] deflate blockÅooÜarge for output buffer:\n",

416 
__func__
);

420 *
dÀn
 = *dÀ¿- 
zs
->
avaû_out
;

422 
	}
}

425 
	$deÊ©e_block
(
BGZF
 *
Â
, 
block_Àngth
)

427 
size_t
 
comp_size
 = 
BGZF_MAX_BLOCK_SIZE
;

428 
ªt
;

429 i‡–!
Â
->
is_gzù
 )

430 
ªt
 = 
	`bgzf_com¥ess
(
Â
->
com¥es£d_block
, &
comp_size
, fp->
uncom¥es£d_block
, 
block_Àngth
, fp->
com¥ess_Àvñ
);

432 
ªt
 = 
	`bgzf_gzù_com¥ess
(
Â
, fp->
com¥es£d_block
, &
comp_size
, fp->
uncom¥es£d_block
, 
block_Àngth
, fp->
com¥ess_Àvñ
);

434 i‡–
ªt
 != 0 )

436 i‡(
hts_vîbo£
 >= 3) {

437 
	`Ârötf
(
°dîr
, "[E::%s] com¥essi⁄Éº‹ %d\n", 
__func__
, 
ªt
);

439 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

442 
Â
->
block_off£t
 = 0;

443  
comp_size
;

444 
	}
}

446 
	$bgzf_uncom¥ess
(
uöt8_t
 *
d°
, 
size_t
 *
dÀn
, c⁄° uöt8_à*
§c
, size_à
¶í
) {

447 
z_°ªam
 
zs
;

448 
zs
.
zÆloc
 = 
NULL
;

449 
zs
.
z‰ì
 = 
NULL
;

450 
zs
.
msg
 = 
NULL
;

451 
zs
.
√xt_ö
 = (
Byãf
*)
§c
;

452 
zs
.
avaû_ö
 = 
¶í
;

453 
zs
.
√xt_out
 = (
Byãf
*)
d°
;

454 
zs
.
avaû_out
 = *
dÀn
;

456 
ªt
 = 
	`öÊ©eInô2
(&
zs
, -15);

457 i‡(
ªt
 !
Z_OK
) {

458 i‡(
hts_vîbo£
 >= 1) {

459 
	`Ârötf
(
°dîr
, "[E::%s] inflateInit2 failed: %s\n",

460 
__func__
, 
	`bgzf_zîr
(
ªt
, &
zs
));

464 i‡((
ªt
 = 
	`öÊ©e
(&
zs
, 
Z_FINISH
)Ë!
Z_STREAM_END
) {

465 i‡(
hts_vîbo£
 >= 1) {

466 
	`Ârötf
(
°dîr
, "[E::%s] inflate failed: %s\n",

467 
__func__
, 
	`bgzf_zîr
(
ªt
,Ñë =
Z_DATA_ERROR
 ? &
zs
 : 
NULL
));

469 i‡((
ªt
 = 
	`öÊ©eEnd
(&
zs
)Ë!
Z_OK
) {

470 i‡(
hts_vîbo£
 >= 2) {

471 
	`Ârötf
(
°dîr
, "[E::%s] inflateEnd failed: %s\n",

472 
__func__
, 
	`bgzf_zîr
(
ªt
, 
NULL
));

477 i‡((
ªt
 = 
	`öÊ©eEnd
(&
zs
)Ë!
Z_OK
) {

478 i‡(
hts_vîbo£
 >= 1) {

479 
	`Ârötf
(
°dîr
, "[E::%s] inflateEnd failed: %s\n",

480 
__func__
, 
	`bgzf_zîr
(
ªt
, 
NULL
));

484 *
dÀn
 = *dÀ¿- 
zs
.
avaû_out
;

486 
	}
}

489 
	$öÊ©e_block
(
BGZF
* 
Â
, 
block_Àngth
)

491 
size_t
 
dÀn
 = 
BGZF_MAX_BLOCK_SIZE
;

492 
ªt
 = 
	`bgzf_uncom¥ess
(
Â
->
uncom¥es£d_block
, &
dÀn
,

493 (
Byãf
*)
Â
->
com¥es£d_block
 + 18, 
block_Àngth
 - 18);

494 i‡(
ªt
 < 0) {

495 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

499  
dÀn
;

500 
	}
}

502 
	$öÊ©e_gzù_block
(
BGZF
 *
Â
, 
ˇched
)

504 
ªt
 = 
Z_OK
;

507 i‡–!
ˇched
 && 
Â
->
gz_°ªam
->
avaû_out
!=0 )

509 
Â
->
gz_°ªam
->
avaû_ö
 = 
	`hªad
(Â->Â, fp->
com¥es£d_block
, 
BGZF_BLOCK_SIZE
);

510 i‡–
Â
->
gz_°ªam
->
avaû_ö
<=0 )  fp->gz_stream->avail_in;

511 i‡–
Â
->
gz_°ªam
->
avaû_ö
==0 ) ;

512 
Â
->
gz_°ªam
->
√xt_ö
 = fp->
com¥es£d_block
;

514 
ˇched
 = 0;

517 
Â
->
gz_°ªam
->
√xt_out
 = (
Byãf
*)Â->
uncom¥es£d_block
 + fp->
block_off£t
;

518 
Â
->
gz_°ªam
->
avaû_out
 = 
BGZF_MAX_BLOCK_SIZE
 - fp->
block_off£t
;

519 
Â
->
gz_°ªam
->
msg
 = 
NULL
;

520 
ªt
 = 
	`öÊ©e
(
Â
->
gz_°ªam
, 
Z_NO_FLUSH
);

521 i‡(
ªt
 < 0 &&Ñë !
Z_BUF_ERROR
) {

522 i‡(
hts_vîbo£
 >= 1) {

523 
	`Ârötf
(
°dîr
, "[E::%s] inflate failed: %s\n",

524 
__func__
,

525 
	`bgzf_zîr
(
ªt
,Ñë =
Z_DATA_ERROR
 ? 
Â
->
gz_°ªam
 : 
NULL
));

527 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

530 
have
 = 
BGZF_MAX_BLOCK_SIZE
 - 
Â
->
gz_°ªam
->
avaû_out
;

531 i‡–
have
 )  have;

533  
Â
->
gz_°ªam
->
avaû_out
 == 0 );

535 
ªt
 !
Z_STREAM_END
);

536  
BGZF_MAX_BLOCK_SIZE
 - 
Â
->
gz_°ªam
->
avaû_out
;

537 
	}
}

540 
	$check_hódî
(c⁄° 
uöt8_t
 *
hódî
)

542 i‡–
hódî
[0] != 31 || header[1] != 139 || header[2] != 8 )  -2;

543  ((
hódî
[3] & 4) != 0

544 && 
	`u≈ackI¡16
((
uöt8_t
*)&
hódî
[10]) == 6

545 && 
hódî
[12] == 'B' && header[13] == 'C'

546 && 
	`u≈ackI¡16
((
uöt8_t
*)&
hódî
[14]) == 2) ? 0 : -1;

547 
	}
}

549 #ifde‡
BGZF_CACHE


550 
	$‰ì_ˇche
(
BGZF
 *
Â
)

552 
khöt_t
 
k
;

553 
	`khash_t
(
ˇche
Ë*
h
 = (khash_t(ˇche)*)
Â
->cache;

554 i‡(
Â
->
is_wrôe
) ;

555 
k
 = 
	`kh_begö
(
h
); k < 
	`kh_íd
(h); ++k)

556 i‡(
	`kh_exi°
(
h
, 
k
)Ë
	`‰ì
(
	`kh_vÆ
(h, k).
block
);

557 
	`kh_de°roy
(
ˇche
, 
h
);

558 
	}
}

560 
	$lﬂd_block_‰om_ˇche
(
BGZF
 *
Â
, 
öt64_t
 
block_addªss
)

562 
khöt_t
 
k
;

563 
ˇche_t
 *
p
;

565 
	`khash_t
(
ˇche
Ë*
h
 = (khash_t(ˇche)*)
Â
->cache;

566 
k
 = 
	`kh_gë
(
ˇche
, 
h
, 
block_addªss
);

567 i‡(
k
 =
	`kh_íd
(
h
))  0;

568 
p
 = &
	`kh_vÆ
(
h
, 
k
);

569 i‡(
Â
->
block_Àngth
 !0ËÂ->
block_off£t
 = 0;

570 
Â
->
block_addªss
 = block_address;

571 
Â
->
block_Àngth
 = 
p
->
size
;

573 
	`mem˝y
(
Â
->
uncom¥es£d_block
, 
p
->
block
, 
BGZF_MAX_BLOCK_SIZE
);

574 i‡–
	`h£ek
(
Â
->Â, 
p
->
íd_off£t
, 
SEEK_SET
) < 0 )

577 
	`Ârötf
(
°dîr
,"CouldÇŸ h£ekÅÿ%"
PRId64
"\n", 
p
->
íd_off£t
);

578 
	`exô
(1);

580  
p
->
size
;

581 
	}
}

583 
	$ˇche_block
(
BGZF
 *
Â
, 
size
)

585 
ªt
;

586 
khöt_t
 
k
;

587 
ˇche_t
 *
p
;

589 
	`khash_t
(
ˇche
Ë*
h
 = (khash_t(ˇche)*)
Â
->cache;

590 i‡(
BGZF_MAX_BLOCK_SIZE
 >
Â
->
ˇche_size
) ;

591 i‡((
	`kh_size
(
h
Ë+ 1Ë* 
BGZF_MAX_BLOCK_SIZE
 > (
uöt32_t
)
Â
->
ˇche_size
) {

595 
k
 = 
	`kh_begö
(
h
); k < 
	`kh_íd
(h); ++k)

596 i‡(
	`kh_exi°
(
h
, 
k
)) ;

597 i‡(
k
 < 
	`kh_íd
(
h
)) {

598 
	`‰ì
(
	`kh_vÆ
(
h
, 
k
).
block
);

599 
	`kh_dñ
(
ˇche
, 
h
, 
k
);

602 
k
 = 
	`kh_put
(
ˇche
, 
h
, 
Â
->
block_addªss
, &
ªt
);

603 i‡(
ªt
 == 0) ;

604 
p
 = &
	`kh_vÆ
(
h
, 
k
);

605 
p
->
size
 = 
Â
->
block_Àngth
;

606 
p
->
íd_off£t
 = 
Â
->
block_addªss
 + 
size
;

607 
p
->
block
 = (
uöt8_t
*)
	`mÆloc
(
BGZF_MAX_BLOCK_SIZE
);

608 
	`mem˝y
(
	`kh_vÆ
(
h
, 
k
).
block
, 
Â
->
uncom¥es£d_block
, 
BGZF_MAX_BLOCK_SIZE
);

609 
	}
}

611 
	$‰ì_ˇche
(
BGZF
 *
Â
Ë{
	}
}

612 
	$lﬂd_block_‰om_ˇche
(
BGZF
 *
Â
, 
öt64_t
 
block_addªss
Ë{ 0;
	}
}

613 
	$ˇche_block
(
BGZF
 *
Â
, 
size
Ë{
	}
}

622 
off_t
 
	$bgzf_hãŒ
(
BGZF
 *
Â
) {

623 i‡(
Â
->
mt
) {

624 
	`±hªad_muãx_lock
(&
Â
->
mt
->
job_poﬁ_m
);

625 
off_t
 
pos
 = 
Â
->
block_addªss
 + fp->
block_˛ígth
;

626 
	`±hªad_muãx_u∆ock
(&
Â
->
mt
->
job_poﬁ_m
);

627  
pos
;

629  
	`hãŒ
(
Â
->fp);

631 
	}
}

633 
	$bgzf_ªad_block
(
BGZF
 *
Â
)

635 
hts_çoﬁ_ªsu…
 *
r
;

637 i‡(
Â
->
mt
) {

638 
agaö
:

639 i‡(
Â
->
mt
->
hô_eof
) {

641 
Â
->
block_Àngth
 = 0;

644 
r
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
Â
->
mt
->
out_queue
);

645 
bgzf_job
 *
j
 = 
r
 ? (bgzf_job *)
	`hts_çoﬁ_ªsu…_d©a
‘Ë: 
NULL
;

647 i‡(!
j
 || j->
îrcode
 =
BGZF_ERR_MT
) {

648 i‡(!
Â
->
mt
->
‰ì_block
) {

649 
Â
->
uncom¥es£d_block
 = 
	`mÆloc
(2 * 
BGZF_MAX_BLOCK_SIZE
);

650 i‡(
Â
->
uncom¥es£d_block
 =
NULL
)  -1;

651 
Â
->
com¥es£d_block
 = (*)Â->
uncom¥es£d_block
 + 
BGZF_MAX_BLOCK_SIZE
;

653 
	`mt_de°roy
(
Â
->
mt
);

654 
Â
->
mt
 = 
NULL
;

655 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

657 
sögÀ_thªaded
;

660 i‡(
j
->
îrcode
) {

661 
Â
->
îrcode
 = 
j
->errcode;

665 i‡(
j
->
hô_eof
) {

666 i‡(!
Â
->
œ°_block_eof
 && !Â->
no_eof_block
) {

667 
Â
->
no_eof_block
 = 1;

668 i‡(
hts_vîbo£
>1)

669 
	`Ârötf
(
°dîr
, "[W::%s] EOF m¨kî i†ab£¡. Thêöpuài†¥obablyÅrunˇãd.\n", 
__func__
);

671 
Â
->
mt
->
hô_eof
 = 1;

677 i‡(!
j
->
hô_eof
 && j->
uncomp_Àn
 == 0) {

678 
Â
->
œ°_block_eof
 = 1;

679 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

680 
agaö
;

684 i‡(
Â
->
block_Àngth
 !0ËÂ->
block_off£t
 = 0;

685 
Â
->
block_addªss
 = 
j
->block_address;

686 
Â
->
block_˛ígth
 = 
j
->
comp_Àn
;

687 
Â
->
block_Àngth
 = 
j
->
uncomp_Àn
;

689 
Â
->
œ°_block_eof
 = (Â->
block_Àngth
 == 0);

691 i‡–
j
->
uncomp_Àn
 && j->
Â
->
idx_buûd_Ÿf
 )

693 
	`bgzf_ödex_add_block
(
j
->
Â
);

694 
j
->
Â
->
idx
->
ublock_addr
 +j->
uncomp_Àn
;

699 i‡(
Â
->
mt
->
cuº_job
) {

700 
	`±hªad_muãx_lock
(&
Â
->
mt
->
job_poﬁ_m
);

701 
	`poﬁ_‰ì
(
Â
->
mt
->
job_poﬁ
, fp->mt->
cuº_job
);

702 
	`±hªad_muãx_u∆ock
(&
Â
->
mt
->
job_poﬁ_m
);

704 
Â
->
uncom¥es£d_block
 = 
j
->
uncomp_d©a
;

705 
Â
->
mt
->
cuº_job
 = 
j
;

706 i‡(
Â
->
mt
->
‰ì_block
) {

707 
	`‰ì
(
Â
->
mt
->
‰ì_block
);

708 
Â
->
mt
->
‰ì_block
 = 
NULL
;

711 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

715 
uöt8_t
 
hódî
[
BLOCK_HEADER_LENGTH
], *
com¥es£d_block
;

716 
cou¡
, 
size
, 
block_Àngth
, 
ªmaöög
;

718 
sögÀ_thªaded
:

719 
size
 = 0;

722 i‡–!
Â
->
is_com¥es£d
 )

724 
cou¡
 = 
	`hªad
(
Â
->Â, fp->
uncom¥es£d_block
, 
BGZF_MAX_BLOCK_SIZE
);

725 i‡(
cou¡
 < 0)

727 
Â
->
îrcode
 |
BGZF_ERR_IO
;

730 i‡(
cou¡
 == 0)

732 
Â
->
block_Àngth
 = 0;

735 i‡(
Â
->
block_Àngth
 !0ËÂ->
block_off£t
 = 0;

736 
Â
->
block_addªss
 +
cou¡
;

737 
Â
->
block_Àngth
 = 
cou¡
;

742 
öt64_t
 
block_addªss
;

743 
block_addªss
 = 
	`bgzf_hãŒ
(
Â
);

744 i‡–
Â
->
is_gzù
 && fp->
gz_°ªam
 )

746 
cou¡
 = 
	`öÊ©e_gzù_block
(
Â
, 0);

747 i‡–
cou¡
<0 )

749 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

752 
Â
->
block_Àngth
 = 
cou¡
;

753 
Â
->
block_addªss
 = block_address;

756 i‡(
Â
->
ˇche_size
 && 
	`lﬂd_block_‰om_ˇche
(Â, 
block_addªss
))  0;

761 
cou¡
 = 
	`hªad
(
Â
->Â, 
hódî
, (header));

762 i‡(
cou¡
 == 0) {

763 i‡(!
Â
->
œ°_block_eof
 && !Â->
no_eof_block
 && !Â->
is_gzù
) {

764 
Â
->
no_eof_block
 = 1;

765 i‡(
hts_vîbo£
 > 1) {

766 
	`Ârötf
(
°dîr
, "[W::%s] EOF m¨kî i†ab£¡. Thêöpuài†¥obablyÅrunˇãd.\n", 
__func__
);

769 
Â
->
block_Àngth
 = 0;

772 
ªt
;

773 i‡–
cou¡
 !(
hódî
Ë|| (
ªt
=
	`check_hódî
(header))==-2 )

775 
Â
->
îrcode
 |
BGZF_ERR_HEADER
;

778 i‡–
ªt
==-1 )

781 
uöt8_t
 *
cblock
 = (uöt8_t*)
Â
->
com¥es£d_block
;

782 
	`mem˝y
(
cblock
, 
hódî
, (header));

783 
cou¡
 = 
	`hªad
(
Â
->Â, 
cblock
+(
hódî
), 
BGZF_BLOCK_SIZE
 - (header)) + (header);

784 
nskù
 = 10;

788 i‡–
hódî
[3] & 0x4 )

790 
nskù
 +
	`u≈ackI¡16
(&
cblock
[nskip]) + 2;

792 i‡–
hódî
[3] & 0x8 )

794  
nskù
<
cou¡
 && 
cblock
[nskip] )Çskip++;

795 
nskù
++;

797 i‡–
hódî
[3] & 0x10 )

799  
nskù
<
cou¡
 && 
cblock
[nskip] )Çskip++;

800 
nskù
++;

802 i‡–
hódî
[3] & 0x2 ) 
nskù
 += 2;

807 i‡–
nskù
 >
cou¡
 )

809 
Â
->
îrcode
 |
BGZF_ERR_HEADER
;

813 
Â
->
is_gzù
 = 1;

814 
Â
->
gz_°ªam
 = (
z_°ªam
*Ë
	`ˇŒoc
(1,(z_stream));

815 
ªt
 = 
	`öÊ©eInô2
(
Â
->
gz_°ªam
, -15);

816 i‡(
ªt
 !
Z_OK
)

818 i‡(
hts_vîbo£
 >= 1) {

819 
	`Ârötf
(
°dîr
, "[E::%s] inflateInit2 failed: %s",

820 
__func__
, 
	`bgzf_zîr
(
ªt
, 
Â
->
gz_°ªam
));

822 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

825 
Â
->
gz_°ªam
->
avaû_ö
 = 
cou¡
 - 
nskù
;

826 
Â
->
gz_°ªam
->
√xt_ö
 = 
cblock
 + 
nskù
;

827 
cou¡
 = 
	`öÊ©e_gzù_block
(
Â
, 1);

828 i‡–
cou¡
<0 )

830 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

833 
Â
->
block_Àngth
 = 
cou¡
;

834 
Â
->
block_addªss
 = block_address;

835 i‡–
Â
->
idx_buûd_Ÿf
 )  -1;

838 
size
 = 
cou¡
;

839 
block_Àngth
 = 
	`u≈ackI¡16
((
uöt8_t
*)&
hódî
[16]) + 1;

840 i‡(
block_Àngth
 < 
BLOCK_HEADER_LENGTH
)

842 
Â
->
îrcode
 |
BGZF_ERR_HEADER
;

845 
com¥es£d_block
 = (
uöt8_t
*)
Â
->compressed_block;

846 
	`mem˝y
(
com¥es£d_block
, 
hódî
, 
BLOCK_HEADER_LENGTH
);

847 
ªmaöög
 = 
block_Àngth
 - 
BLOCK_HEADER_LENGTH
;

848 
cou¡
 = 
	`hªad
(
Â
->Â, &
com¥es£d_block
[
BLOCK_HEADER_LENGTH
], 
ªmaöög
);

849 i‡(
cou¡
 !
ªmaöög
) {

850 
Â
->
îrcode
 |
BGZF_ERR_IO
;

853 
size
 +
cou¡
;

854 i‡((
cou¡
 = 
	`öÊ©e_block
(
Â
, 
block_Àngth
)) < 0) {

855 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[E::%s] inÊ©e_blockÉº‹ %d\n", 
__func__
, 
cou¡
);

856 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

859 
Â
->
œ°_block_eof
 = (
cou¡
 == 0);

860 i‡–
cou¡
 ) ;

862 i‡(
Â
->
block_Àngth
 !0ËÂ->
block_off£t
 = 0;

863 
Â
->
block_addªss
 = block_address;

864 
Â
->
block_Àngth
 = 
cou¡
;

865 i‡–
Â
->
idx_buûd_Ÿf
 )

867 
	`bgzf_ödex_add_block
(
Â
);

868 
Â
->
idx
->
ublock_addr
 +
cou¡
;

870 
	`ˇche_block
(
Â
, 
size
);

872 
	}
}

874 
ssize_t
 
	$bgzf_ªad
(
BGZF
 *
Â
, *
d©a
, 
size_t
 
Àngth
)

876 
ssize_t
 
byãs_ªad
 = 0;

877 
uöt8_t
 *
ouçut
 = (uöt8_t*)
d©a
;

878 i‡(
Àngth
 <= 0)  0;

879 
	`as£π
(
Â
->
is_wrôe
 == 0);

880 
byãs_ªad
 < 
Àngth
) {

881 
c›y_Àngth
, 
avaûabÀ
 = 
Â
->
block_Àngth
 - fp->
block_off£t
;

882 
uöt8_t
 *
buf„r
;

883 i‡(
avaûabÀ
 <= 0) {

884 
ªt
 = 
	`bgzf_ªad_block
(
Â
);

885 i‡(
ªt
 != 0) {

886 i‡(
hts_vîbo£
 >= 2) {

887 
	`Ârötf
(
°dîr
, "[E::%s] bgzf_ªad_blockÉº‹ %dá·î %zd o‡%zu byãs\n", 
__func__
, 
ªt
, 
byãs_ªad
, 
Àngth
);

889 
Â
->
îrcode
 |
BGZF_ERR_ZLIB
;

892 
avaûabÀ
 = 
Â
->
block_Àngth
 - fp->
block_off£t
;

893 i‡(
avaûabÀ
 <= 0) ;

895 
c›y_Àngth
 = 
Àngth
 - 
byãs_ªad
 < 
avaûabÀ
?Üength - bytes_read :ávailable;

896 
buf„r
 = (
uöt8_t
*)
Â
->
uncom¥es£d_block
;

897 
	`mem˝y
(
ouçut
, 
buf„r
 + 
Â
->
block_off£t
, 
c›y_Àngth
);

898 
Â
->
block_off£t
 +
c›y_Àngth
;

899 
ouçut
 +
c›y_Àngth
;

900 
byãs_ªad
 +
c›y_Àngth
;

903 i‡(
Â
->
block_off£t
 =Â->
block_Àngth
) {

904 
Â
->
block_addªss
 = 
	`bgzf_hãŒ
(fp);

905 
Â
->
block_off£t
 = fp->
block_Àngth
 = 0;

909 
Â
->
uncom¥es£d_addªss
 +
byãs_ªad
;

911  
byãs_ªad
;

912 
	}
}

914 
ssize_t
 
	$bgzf_øw_ªad
(
BGZF
 *
Â
, *
d©a
, 
size_t
 
Àngth
)

916 
ssize_t
 
ªt
 = 
	`hªad
(
Â
->Â, 
d©a
, 
Àngth
);

917 i‡(
ªt
 < 0Ë
Â
->
îrcode
 |
BGZF_ERR_IO
;

918  
ªt
;

919 
	}
}

921 #ifde‡
BGZF_MT


923 *
	$bgzf_ícode_func
(*
¨g
) {

924 
bgzf_job
 *
j
 = (bgzf_job *)
¨g
;

926 
j
->
comp_Àn
 = 
BGZF_MAX_BLOCK_SIZE
;

927 
ªt
 = 
	`bgzf_com¥ess
(
j
->
comp_d©a
, &j->
comp_Àn
,

928 
j
->
uncomp_d©a
, j->
uncomp_Àn
,

929 
j
->
Â
->
com¥ess_Àvñ
);

930 i‡(
ªt
 != 0)

931 
j
->
îrcode
 |
BGZF_ERR_ZLIB
;

933  
¨g
;

934 
	}
}

939 *
	$bgzf_decode_func
(*
¨g
) {

940 
bgzf_job
 *
j
 = (bgzf_job *)
¨g
;

942 
j
->
uncomp_Àn
 = 
BGZF_MAX_BLOCK_SIZE
;

943 
ªt
 = 
	`bgzf_uncom¥ess
(
j
->
uncomp_d©a
, &j->
uncomp_Àn
,

944 
j
->
comp_d©a
+18, j->
comp_Àn
-18);

945 i‡(
ªt
 != 0)

946 
j
->
îrcode
 |
BGZF_ERR_ZLIB
;

948  
¨g
;

949 
	}
}

955 *
	$bgzf_nul_func
(*
¨g
Ë{ árg; 
	}
}

963 *
	$bgzf_mt_wrôî
(*
vp
) {

964 
BGZF
 *
Â
 = (BGZF *)
vp
;

965 
mèux_t
 *
mt
 = 
Â
->mt;

966 
hts_çoﬁ_ªsu…
 *
r
;

969 (
r
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
mt
->
out_queue
))) {

970 
bgzf_job
 *
j
 = (bgzf_job *)
	`hts_çoﬁ_ªsu…_d©a
(
r
);

971 
	`as£π
(
j
);

973 i‡(
	`hwrôe
(
Â
->Â, 
j
->
comp_d©a
, j->
comp_Àn
) != j->comp_len) {

974 
Â
->
îrcode
 |
BGZF_ERR_IO
;

975 
îr
;

987 i‡(++
mt
->
Êush_≥ndög
 % 512 == 0)

988 i‡(
	`hÊush
(
Â
->fp) != 0)

989 
îr
;

992 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

995 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

996 
	`poﬁ_‰ì
(
mt
->
job_poﬁ
, 
j
);

997 
mt
->
jobs_≥ndög
--;

998 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1001 i‡(
	`hÊush
(
Â
->fp) != 0)

1002 
îr
;

1004 
	`hts_çoﬁ_¥o˚ss_de°roy
(
mt
->
out_queue
);

1006  
NULL
;

1008 
îr
:

1009 
	`hts_çoﬁ_¥o˚ss_de°roy
(
mt
->
out_queue
);

1011 
	}
}

1023 
	$bgzf_mt_ªad_block
(
BGZF
 *
Â
, 
bgzf_job
 *
j
)

1025 
uöt8_t
 
hódî
[
BLOCK_HEADER_LENGTH
], *
com¥es£d_block
;

1026 
cou¡
, 
size
 = 0, 
block_Àngth
, 
ªmaöög
;

1033 
öt64_t
 
block_addªss
;

1034 
block_addªss
 = 
	`hãŒ
(
Â
->fp);

1036 i‡(
Â
->
ˇche_size
 && 
	`lﬂd_block_‰om_ˇche
(Â, 
block_addªss
))  0;

1037 
cou¡
 = 
	`h≥ek
(
Â
->Â, 
hódî
, (header));

1038 i‡(
cou¡
 == 0)

1040 
ªt
;

1041 i‡–
cou¡
 !(
hódî
Ë|| (
ªt
=
	`check_hódî
(header))==-2 )

1043 
j
->
îrcode
 |
BGZF_ERR_HEADER
;

1046 i‡(
ªt
 == -1) {

1047 
j
->
îrcode
 |
BGZF_ERR_MT
;

1051 
cou¡
 = 
	`hªad
(
Â
->Â, 
hódî
, (header));

1052 i‡(
cou¡
 !(
hódî
))

1055 
size
 = 
cou¡
;

1056 
block_Àngth
 = 
	`u≈ackI¡16
((
uöt8_t
*)&
hódî
[16]) + 1;

1057 i‡(
block_Àngth
 < 
BLOCK_HEADER_LENGTH
) {

1058 
j
->
îrcode
 |
BGZF_ERR_HEADER
;

1061 
com¥es£d_block
 = (
uöt8_t
*)
j
->
comp_d©a
;

1062 
	`mem˝y
(
com¥es£d_block
, 
hódî
, 
BLOCK_HEADER_LENGTH
);

1063 
ªmaöög
 = 
block_Àngth
 - 
BLOCK_HEADER_LENGTH
;

1064 
cou¡
 = 
	`hªad
(
Â
->Â, &
com¥es£d_block
[
BLOCK_HEADER_LENGTH
], 
ªmaöög
);

1065 i‡(
cou¡
 !
ªmaöög
) {

1066 
j
->
îrcode
 |
BGZF_ERR_IO
;

1069 
size
 +
cou¡
;

1070 
j
->
comp_Àn
 = 
block_Àngth
;

1071 
j
->
uncomp_Àn
 = 
BGZF_MAX_BLOCK_SIZE
;

1072 
j
->
block_addªss
 = block_address;

1073 
j
->
Â
 = fp;

1074 
j
->
îrcode
 = 0;

1077 
	}
}

1080 
	$bgzf_check_EOF_comm⁄
(
BGZF
 *
Â
)

1082 
uöt8_t
 
buf
[28];

1083 
off_t
 
off£t
 = 
	`hãŒ
(
Â
->fp);

1084 i‡(
	`h£ek
(
Â
->Â, -28, 
SEEK_END
) < 0) {

1085 i‡(
î∫o
 =
ESPIPE
Ë{ 
	`h˛óªº
(
Â
->fp);  2; }

1088 i‡–
	`hªad
(
Â
->Â, 
buf
, 28) != 28 )  -1;

1089 i‡–
	`h£ek
(
Â
->Â, 
off£t
, 
SEEK_SET
) < 0 )  -1;

1090  (
	`memcmp
("\037\213\010\4\0\0\0\0\0\377\6\0\102\103\2\0\033\0\3\0\0\0\0\0\0\0\0\0", 
buf
, 28) == 0)? 1 : 0;

1091 
	}
}

1096 
	$bgzf_mt_eof
(
BGZF
 *
Â
) {

1097 
mèux_t
 *
mt
 = 
Â
->mt;

1099 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1100 
mt
->
eof
 = 
	`bgzf_check_EOF_comm⁄
(
Â
);

1101 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1102 
	`±hªad_c⁄d_sig«l
(&
mt
->
comm™d_c
);

1103 
	}
}

1112 
	$bgzf_mt_£ek
(
BGZF
 *
Â
) {

1113 
mèux_t
 *
mt
 = 
Â
->mt;

1115 
	`hts_çoﬁ_¥o˚ss_ª£t
(
mt
->
out_queue
, 0);

1116 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1117 
mt
->
comm™d
 = 
NONE
;

1118 
mt
->
îrcode
 = 0;

1120 i‡(
	`h£ek
(
Â
->Â, 
mt
->
block_addªss
, 
SEEK_SET
) < 0)

1121 
mt
->
îrcode
 = 
BGZF_ERR_IO
;

1123 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1124 
	`±hªad_c⁄d_sig«l
(&
mt
->
comm™d_c
);

1125 
	}
}

1127 *
	$bgzf_mt_ªadî
(*
vp
) {

1128 
BGZF
 *
Â
 = (BGZF *)
vp
;

1129 
mèux_t
 *
mt
 = 
Â
->mt;

1131 
ª°¨t
:

1132 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1133 
bgzf_job
 *
j
 = 
	`poﬁ_Æloc
(
mt
->
job_poﬁ
);

1134 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1135 
j
->
îrcode
 = 0;

1136 
j
->
uncomp_Àn
 = 0;

1137 
j
->
hô_eof
 = 0;

1139 
	`bgzf_mt_ªad_block
(
Â
, 
j
) == 0) {

1141 
	`hts_çoﬁ_di•©ch
(
mt
->
poﬁ
, mt->
out_queue
, 
bgzf_decode_func
, 
j
);

1144 
	`±hªad_muãx_lock
(&
mt
->
comm™d_m
);

1145 
mt
->
comm™d
) {

1146 
SEEK
:

1147 
	`bgzf_mt_£ek
(
Â
);

1148 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1149 
ª°¨t
;

1151 
HAS_EOF
:

1152 
	`bgzf_mt_eof
(
Â
);

1155 
CLOSE
:

1156 
	`±hªad_c⁄d_sig«l
(&
mt
->
comm™d_c
);

1157 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1158 
	`hts_çoﬁ_¥o˚ss_de°roy
(
mt
->
out_queue
);

1159 
	`±hªad_exô
(
NULL
);

1164 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1167 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1168 
j
 = 
	`poﬁ_Æloc
(
mt
->
job_poﬁ
);

1169 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1170 
j
->
îrcode
 = 0;

1171 
j
->
uncomp_Àn
 = 0;

1172 
j
->
hô_eof
 = 0;

1175 i‡(
j
->
îrcode
 =
BGZF_ERR_MT
) {

1178 
	`hts_çoﬁ_di•©ch
(
mt
->
poﬁ
, mt->
out_queue
, 
bgzf_nul_func
, 
j
);

1179 
	`hts_çoﬁ_¥o˚ss_ªf_de¸
(
mt
->
out_queue
);

1180 
	`±hªad_exô
(&
j
->
îrcode
);

1187 
j
->
hô_eof
 = 1;

1188 
	`hts_çoﬁ_di•©ch
(
mt
->
poﬁ
, mt->
out_queue
, 
bgzf_nul_func
, 
j
);

1189 i‡(
j
->
îrcode
 != 0) {

1190 
	`hts_çoﬁ_¥o˚ss_de°roy
(
mt
->
out_queue
);

1191 
	`±hªad_exô
(&
j
->
îrcode
);

1200 
	`±hªad_muãx_lock
(&
mt
->
comm™d_m
);

1201 i‡(
mt
->
comm™d
 =
NONE
)

1202 
	`±hªad_c⁄d_waô
(&
mt
->
comm™d_c
, &mt->
comm™d_m
);

1203 
mt
->
comm™d
) {

1205 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1208 
SEEK
:

1209 
	`bgzf_mt_£ek
(
Â
);

1210 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1211 
ª°¨t
;

1213 
HAS_EOF
:

1214 
	`bgzf_mt_eof
(
Â
);

1215 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1218 
CLOSE
:

1219 
	`±hªad_c⁄d_sig«l
(&
mt
->
comm™d_c
);

1220 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1221 
	`hts_çoﬁ_¥o˚ss_de°roy
(
mt
->
out_queue
);

1222 
	`±hªad_exô
(
NULL
);

1225 
	}
}

1227 
	$bgzf_thªad_poﬁ
(
BGZF
 *
Â
, 
hts_çoﬁ
 *
poﬁ
, 
qsize
) {

1229 i‡(!
Â
->
is_com¥es£d
)

1232 
mèux_t
 *
mt
;

1233 
mt
 = (
mèux_t
*)
	`ˇŒoc
(1, (mtaux_t));

1234 i‡(!
mt
)  -1;

1235 
Â
->
mt
 = mt;

1237 
mt
->
poﬁ
 =Öool;

1238 
mt
->
n_thªads
 = 
	`hts_çoﬁ_size
(
poﬁ
);

1239 i‡(!
qsize
)

1240 
qsize
 = 
mt
->
n_thªads
*2;

1241 i‡(!(
mt
->
out_queue
 = 
	`hts_çoﬁ_¥o˚ss_öô
(mt->
poﬁ
, 
qsize
, 0))) {

1242 
	`‰ì
(
mt
);

1245 
	`hts_çoﬁ_¥o˚ss_ªf_ö¸
(
mt
->
out_queue
);

1247 
mt
->
job_poﬁ
 = 
	`poﬁ_¸óã
((
bgzf_job
));

1249 
	`±hªad_muãx_öô
(&
mt
->
job_poﬁ_m
, 
NULL
);

1250 
	`±hªad_muãx_öô
(&
mt
->
comm™d_m
, 
NULL
);

1251 
	`±hªad_c⁄d_öô
(&
mt
->
comm™d_c
, 
NULL
);

1252 
mt
->
Êush_≥ndög
 = 0;

1253 
mt
->
jobs_≥ndög
 = 0;

1254 
mt
->
‰ì_block
 = 
Â
->
uncom¥es£d_block
;

1255 
	`±hªad_¸óã
(&
mt
->
io_èsk
, 
NULL
,

1256 
Â
->
is_wrôe
 ? 
bgzf_mt_wrôî
 : 
bgzf_mt_ªadî
, fp);

1259 
	}
}

1261 
	$bgzf_mt
(
BGZF
 *
Â
, 
n_thªads
, 
n_sub_blks
)

1264 i‡(!
Â
->
is_com¥es£d
 || fp->
is_gzù
)

1267 i‡(
n_thªads
 < 1)  -1;

1268 
hts_çoﬁ
 *
p
 = 
	`hts_çoﬁ_öô
(
n_thªads
);

1269 i‡(!
p
)

1272 i‡(
	`bgzf_thªad_poﬁ
(
Â
, 
p
, 0) != 0) {

1273 
	`hts_çoﬁ_de°roy
(
p
);

1277 
Â
->
mt
->
own_poﬁ
 = 1;

1280 
	}
}

1282 
	$mt_de°roy
(
mèux_t
 *
mt
)

1284 
	`±hªad_muãx_lock
(&
mt
->
comm™d_m
);

1285 
mt
->
comm™d
 = 
CLOSE
;

1286 
	`±hªad_c⁄d_sig«l
(&
mt
->
comm™d_c
);

1287 
	`hts_çoﬁ_wake_di•©ch
(
mt
->
out_queue
);

1288 
	`±hªad_muãx_u∆ock
(&
mt
->
comm™d_m
);

1291 
	`hts_çoﬁ_¥o˚ss_de°roy
(
mt
->
out_queue
);

1292 
	`±hªad_joö
(
mt
->
io_èsk
, 
NULL
);

1294 
	`±hªad_muãx_de°roy
(&
mt
->
job_poﬁ_m
);

1295 
	`±hªad_muãx_de°roy
(&
mt
->
comm™d_m
);

1296 
	`±hªad_c⁄d_de°roy
(&
mt
->
comm™d_c
);

1297 i‡(
mt
->
cuº_job
)

1298 
	`poﬁ_‰ì
(
mt
->
job_poﬁ
, mt->
cuº_job
);

1300 i‡(
mt
->
own_poﬁ
)

1301 
	`hts_çoﬁ_de°roy
(
mt
->
poﬁ
);

1303 
	`poﬁ_de°roy
(
mt
->
job_poﬁ
);

1305 
	`‰ì
(
mt
);

1306 
	`fÊush
(
°dîr
);

1307 
	}
}

1309 
	$mt_queue
(
BGZF
 *
Â
)

1311 
mèux_t
 *
mt
 = 
Â
->mt;

1314 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1315 
bgzf_job
 *
j
 = 
	`poﬁ_Æloc
(
mt
->
job_poﬁ
);

1316 
mt
->
jobs_≥ndög
++;

1317 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1319 
j
->
Â
 = fp;

1320 
j
->
îrcode
 = 0;

1321 
j
->
uncomp_Àn
 = 
Â
->
block_off£t
;

1322 
	`mem˝y
(
j
->
uncomp_d©a
, 
Â
->
uncom¥es£d_block
, j->
uncomp_Àn
);

1325 
	`hts_çoﬁ_di•©ch
(
mt
->
poﬁ
, mt->
out_queue
, 
bgzf_ícode_func
, 
j
);

1327 
Â
->
block_off£t
 = 0;

1329 
	}
}

1331 
	$mt_Êush_queue
(
BGZF
 *
Â
)

1333 
mèux_t
 *
mt
 = 
Â
->mt;

1340 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1341 
mt
->
jobs_≥ndög
 != 0) {

1342 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1343 
	`u¶ìp
(10000);

1344 
	`±hªad_muãx_lock
(&
mt
->
job_poﬁ_m
);

1346 
	`±hªad_muãx_u∆ock
(&
mt
->
job_poﬁ_m
);

1349 i‡(
	`hts_çoﬁ_¥o˚ss_Êush
(
mt
->
out_queue
) != 0)

1352  (
Â
->
îrcode
 == 0)? 0 : -1;

1353 
	}
}

1355 
	$œzy_Êush
(
BGZF
 *
Â
)

1357 i‡(
Â
->
mt
)

1358  
Â
->
block_off£t
 ? 
	`mt_queue
(fp) : 0;

1360  
	`bgzf_Êush
(
Â
);

1361 
	}
}

1365 
	$bgzf_mt
(
BGZF
 *
Â
, 
n_thªads
, 
n_sub_blks
)

1368 
	}
}

1370 
ölöe
 
	$œzy_Êush
(
BGZF
 *
Â
)

1372  
	`bgzf_Êush
(
Â
);

1373 
	}
}

1377 
	$bgzf_Êush
(
BGZF
 *
Â
)

1379 i‡(!
Â
->
is_wrôe
)  0;

1380 #ifde‡
BGZF_MT


1381 i‡(
Â
->
mt
) {

1382 
ªt
 = 0;

1383 i‡(
Â
->
block_off£t
Ë
ªt
 = 
	`mt_queue
(fp);

1384  
ªt
 ?Ñë : 
	`mt_Êush_queue
(
Â
);

1387 
Â
->
block_off£t
 > 0) {

1388 
block_Àngth
;

1389 i‡–
Â
->
idx_buûd_Ÿf
 )

1391 
	`bgzf_ödex_add_block
(
Â
);

1392 
Â
->
idx
->
ublock_addr
 +Â->
block_off£t
;

1394 
block_Àngth
 = 
	`deÊ©e_block
(
Â
, fp->
block_off£t
);

1395 i‡(
block_Àngth
 < 0) {

1396 i‡(
hts_vîbo£
 >3Ë
	`Ârötf
(
°dîr
, "[E::%s] deÊ©e_blockÉº‹ %d\n", 
__func__
, 
block_Àngth
);

1399 i‡(
	`hwrôe
(
Â
->Â, fp->
com¥es£d_block
, 
block_Àngth
) != block_length) {

1400 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] hwrôêîr‹ (wr⁄g size)\n", 
__func__
);

1401 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1404 
Â
->
block_addªss
 +
block_Àngth
;

1407 
	}
}

1409 
	$bgzf_Êush_åy
(
BGZF
 *
Â
, 
ssize_t
 
size
)

1411 i‡(
Â
->
block_off£t
 + 
size
 > 
BGZF_BLOCK_SIZE
Ë 
	`œzy_Êush
(fp);

1413 
	}
}

1415 
ssize_t
 
	$bgzf_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
)

1417 i‡–!
Â
->
is_com¥es£d
 )

1418  
	`hwrôe
(
Â
->Â, 
d©a
, 
Àngth
);

1420 c⁄° 
uöt8_t
 *
öput
 = (c⁄° uöt8_t*)
d©a
;

1421 
ssize_t
 
ªmaöög
 = 
Àngth
;

1422 
	`as£π
(
Â
->
is_wrôe
);

1423 
ªmaöög
 > 0) {

1424 
uöt8_t
* 
buf„r
 = (uöt8_t*)
Â
->
uncom¥es£d_block
;

1425 
c›y_Àngth
 = 
BGZF_BLOCK_SIZE
 - 
Â
->
block_off£t
;

1426 i‡(
c›y_Àngth
 > 
ªmaöög
) copy_length =Ñemaining;

1427 
	`mem˝y
(
buf„r
 + 
Â
->
block_off£t
, 
öput
, 
c›y_Àngth
);

1428 
Â
->
block_off£t
 +
c›y_Àngth
;

1429 
öput
 +
c›y_Àngth
;

1430 
ªmaöög
 -
c›y_Àngth
;

1431 i‡(
Â
->
block_off£t
 =
BGZF_BLOCK_SIZE
) {

1432 i‡(
	`œzy_Êush
(
Â
) != 0)  -1;

1435  
Àngth
 - 
ªmaöög
;

1436 
	}
}

1438 
ssize_t
 
	$bgzf_block_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
)

1440 i‡–!
Â
->
is_com¥es£d
 )

1441  
	`hwrôe
(
Â
->Â, 
d©a
, 
Àngth
);

1442 c⁄° 
uöt8_t
 *
öput
 = (c⁄° uöt8_t*)
d©a
;

1443 
ssize_t
 
ªmaöög
 = 
Àngth
;

1444 
	`as£π
(
Â
->
is_wrôe
);

1445 
uöt64_t
 
cuºít_block
;

1446 
uöt64_t
 
ublock_size
;

1447 
ªmaöög
 > 0) {

1448 
cuºít_block
 = 
Â
->
idx
->
moffs
 - fp->idx->
noffs
;

1449 
ublock_size
 = 
Â
->
idx
->
offs
[
cuºít_block
+1].
uaddr
-fp->idx->offs[current_block].uaddr;

1450 
uöt8_t
* 
buf„r
 = (uöt8_t*)
Â
->
uncom¥es£d_block
;

1451 
c›y_Àngth
 = 
ublock_size
 - 
Â
->
block_off£t
;

1452 i‡(
c›y_Àngth
 > 
ªmaöög
) copy_length =Ñemaining;

1453 
	`mem˝y
(
buf„r
 + 
Â
->
block_off£t
, 
öput
, 
c›y_Àngth
);

1454 
Â
->
block_off£t
 +
c›y_Àngth
;

1455 
öput
 +
c›y_Àngth
;

1456 
ªmaöög
 -
c›y_Àngth
;

1457 i‡(
Â
->
block_off£t
 =
ublock_size
) {

1458 i‡(
	`œzy_Êush
(
Â
) != 0)  -1;

1459 
Â
->
idx
->
noffs
--;

1462  
Àngth
 - 
ªmaöög
;

1463 
	}
}

1466 
ssize_t
 
	$bgzf_øw_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
)

1468 
ssize_t
 
ªt
 = 
	`hwrôe
(
Â
->Â, 
d©a
, 
Àngth
);

1469 i‡(
ªt
 < 0Ë
Â
->
îrcode
 |
BGZF_ERR_IO
;

1470  
ªt
;

1471 
	}
}

1473 
	$bgzf_˛o£
(
BGZF
* 
Â
)

1475 
ªt
, 
block_Àngth
;

1476 i‡(
Â
 == 0)  -1;

1477 i‡(
Â
->
is_wrôe
 && fp->
is_com¥es£d
) {

1478 i‡(
	`bgzf_Êush
(
Â
) != 0)  -1;

1479 
Â
->
com¥ess_Àvñ
 = -1;

1480 
block_Àngth
 = 
	`deÊ©e_block
(
Â
, 0);

1481 i‡(
block_Àngth
 < 0) {

1482 i‡(
hts_vîbo£
 >3Ë
	`Ârötf
(
°dîr
, "[E::%s] deÊ©e_blockÉº‹ %d\n", 
__func__
, 
block_Àngth
);

1485 i‡(
	`hwrôe
(
Â
->Â, fp->
com¥es£d_block
, 
block_Àngth
) < 0

1486 || 
	`hÊush
(
Â
->fp) != 0) {

1487 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] fûêwrôêîr‹\n", 
__func__
);

1488 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1492 #ifde‡
BGZF_MT


1493 i‡(
Â
->
mt
) {

1494 i‡(!
Â
->
mt
->
‰ì_block
)

1495 
Â
->
uncom¥es£d_block
 = 
NULL
;

1496 
	`mt_de°roy
(
Â
->
mt
);

1499 i‡–
Â
->
is_gzù
 )

1501 i‡(
Â
->
gz_°ªam
 =
NULL
Ë
ªt
 = 
Z_OK
;

1502 i‡(!
Â
->
is_wrôe
Ë
ªt
 = 
	`öÊ©eEnd
(Â->
gz_°ªam
);

1503 
ªt
 = 
	`deÊ©eEnd
(
Â
->
gz_°ªam
);

1504 i‡(
ªt
 !
Z_OK
 && 
hts_vîbo£
 >= 1)

1505 
	`Ârötf
(
°dîr
, "[E::%s] inflateEnd/deflateEnd failed: %s\n",

1506 
__func__
, 
	`bgzf_zîr
(
ªt
, 
NULL
));

1507 
	`‰ì
(
Â
->
gz_°ªam
);

1509 
ªt
 = 
	`h˛o£
(
Â
->fp);

1510 i‡(
ªt
 != 0)  -1;

1511 
	`bgzf_ödex_de°roy
(
Â
);

1512 
	`‰ì
(
Â
->
uncom¥es£d_block
);

1513 
	`‰ì_ˇche
(
Â
);

1514 
	`‰ì
(
Â
);

1516 
	}
}

1518 
	$bgzf_£t_ˇche_size
(
BGZF
 *
Â
, 
ˇche_size
)

1520 i‡(
Â
ËÂ->
ˇche_size
 = cache_size;

1521 
	}
}

1523 
	$bgzf_check_EOF
(
BGZF
 *
Â
) {

1524 
has_eof
;

1526 i‡(
Â
->
mt
) {

1527 
	`±hªad_muãx_lock
(&
Â
->
mt
->
comm™d_m
);

1528 
Â
->
mt
->
comm™d
 = 
HAS_EOF
;

1529 
	`±hªad_c⁄d_sig«l
(&
Â
->
mt
->
comm™d_c
);

1530 
	`hts_çoﬁ_wake_di•©ch
(
Â
->
mt
->
out_queue
);

1531 
	`±hªad_c⁄d_waô
(&
Â
->
mt
->
comm™d_c
, &Â->mt->
comm™d_m
);

1532 
has_eof
 = 
Â
->
mt
->
eof
;

1533 
	`±hªad_muãx_u∆ock
(&
Â
->
mt
->
comm™d_m
);

1535 
has_eof
 = 
	`bgzf_check_EOF_comm⁄
(
Â
);

1538 
Â
->
no_eof_block
 = (
has_eof
 == 0);

1540  
has_eof
;

1541 
	}
}

1543 
öt64_t
 
	$bgzf_£ek
(
BGZF
* 
Â
, 
öt64_t
 
pos
, 
whîe
)

1545 
block_off£t
;

1546 
öt64_t
 
block_addªss
;

1548 i‡(
Â
->
is_wrôe
 || 
whîe
 !
SEEK_SET
 || fp->
is_gzù
) {

1549 
Â
->
îrcode
 |
BGZF_ERR_MISUSE
;

1552 
block_off£t
 = 
pos
 & 0xFFFF;

1553 
block_addªss
 = 
pos
 >> 16;

1555 i‡(
Â
->
mt
) {

1569 
	`±hªad_muãx_lock
(&
Â
->
mt
->
comm™d_m
);

1570 
Â
->
mt
->
hô_eof
 = 0;

1571 
Â
->
mt
->
comm™d
 = 
SEEK
;

1572 
Â
->
mt
->
block_addªss
 = block_address;

1573 
	`±hªad_c⁄d_sig«l
(&
Â
->
mt
->
comm™d_c
);

1574 
	`hts_çoﬁ_wake_di•©ch
(
Â
->
mt
->
out_queue
);

1575 
	`±hªad_c⁄d_waô
(&
Â
->
mt
->
comm™d_c
, &Â->mt->
comm™d_m
);

1577 
Â
->
block_Àngth
 = 0;

1578 
Â
->
block_addªss
 = block_address;

1579 
Â
->
block_off£t
 = block_offset;

1581 
	`±hªad_muãx_u∆ock
(&
Â
->
mt
->
comm™d_m
);

1583 i‡(
	`h£ek
(
Â
->Â, 
block_addªss
, 
SEEK_SET
) < 0) {

1584 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1587 
Â
->
block_Àngth
 = 0;

1588 
Â
->
block_addªss
 = block_address;

1589 
Â
->
block_off£t
 = block_offset;

1593 
	}
}

1595 
	$bgzf_is_bgzf
(c⁄° *
‚
)

1597 
uöt8_t
 
buf
[16];

1598 
n
;

1599 
hFILE
 *
Â
;

1600 i‡((
Â
 = 
	`h›í
(
‚
, "r")) == 0)  0;

1601 
n
 = 
	`hªad
(
Â
, 
buf
, 16);

1602 i‡(
	`h˛o£
(
Â
) < 0)  0;

1603 i‡(
n
 != 16)  0;

1604  
	`check_hódî
(
buf
) == 0? 1 : 0;

1605 
	}
}

1607 
	$bgzf_com¥essi⁄
(
BGZF
 *
Â
)

1609  (!
Â
->
is_com¥es£d
)? 
no_com¥essi⁄
 : (Â->
is_gzù
)? 
gzù
 : 
bgzf
;

1610 
	}
}

1612 
	$bgzf_gëc
(
BGZF
 *
Â
)

1614 i‡(
Â
->
block_off£t
+1 < fp->
block_Àngth
) {

1615 
Â
->
uncom¥es£d_addªss
++;

1616  ((*)
Â
->
uncom¥es£d_block
)[Â->
block_off£t
++];

1619 
c
;

1620 i‡(
Â
->
block_off£t
 >Â->
block_Àngth
) {

1621 i‡(
	`bgzf_ªad_block
(
Â
) != 0)  -2;

1622 i‡(
Â
->
block_Àngth
 == 0)  -1;

1624 
c
 = ((*)
Â
->
uncom¥es£d_block
)[Â->
block_off£t
++];

1625 i‡(
Â
->
block_off£t
 =Â->
block_Àngth
) {

1626 
Â
->
block_addªss
 = 
	`bgzf_hãŒ
(fp);

1627 
Â
->
block_off£t
 = 0;

1628 
Â
->
block_Àngth
 = 0;

1630 
Â
->
uncom¥es£d_addªss
++;

1631  
c
;

1632 
	}
}

1634 #i‚de‡
kroundup32


1635 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

1638 
	$bgzf_gëlöe
(
BGZF
 *
Â
, 
dñim
, 
k°rög_t
 *
°r
)

1640 
l
, 
°©e
 = 0;

1641 
°r
->
l
 = 0;

1643 i‡(
Â
->
block_off£t
 >Â->
block_Àngth
) {

1644 i‡(
	`bgzf_ªad_block
(
Â
Ë!0Ë{ 
°©e
 = -2; ; }

1645 i‡(
Â
->
block_Àngth
 =0Ë{ 
°©e
 = -1; ; }

1647 *
buf
 = 
Â
->
uncom¥es£d_block
;

1648 
l
 = 
Â
->
block_off£t
;Ü < fp->
block_Àngth
 && 
buf
[l] !
dñim
; ++l);

1649 i‡(
l
 < 
Â
->
block_Àngth
Ë
°©e
 = 1;

1650 
l
 -
Â
->
block_off£t
;

1651 i‡(
°r
->
l
 +Ü + 1 >°r->
m
) {

1652 
°r
->
m
 = så->
l
 +Ü + 2;

1653 
	`kroundup32
(
°r
->
m
);

1654 
°r
->
s
 = (*)
	`ªÆloc
(°r->s, så->
m
);

1656 
	`mem˝y
(
°r
->
s
 + så->
l
, 
buf
 + 
Â
->
block_off£t
,Ü);

1657 
°r
->
l
 +=Ü;

1658 
Â
->
block_off£t
 +
l
 + 1;

1659 i‡(
Â
->
block_off£t
 >Â->
block_Àngth
) {

1660 
Â
->
block_addªss
 = 
	`bgzf_hãŒ
(fp);

1661 
Â
->
block_off£t
 = 0;

1662 
Â
->
block_Àngth
 = 0;

1664 } 
°©e
 == 0);

1665 i‡(
°r
->
l
 =0 && 
°©e
 < 0)  state;

1666 
Â
->
uncom¥es£d_addªss
 +
°r
->
l
 + 1;

1667 i‡–
dñim
=='\n' && 
°r
->
l
>0 && så->
s
[str->l-1]=='\r' ) str->l--;

1668 
°r
->
s
[°r->
l
] = 0;

1669  
°r
->
l
;

1670 
	}
}

1672 
	$bgzf_ödex_de°roy
(
BGZF
 *
Â
)

1674 i‡–!
Â
->
idx
 ) ;

1675 
	`‰ì
(
Â
->
idx
->
offs
);

1676 
	`‰ì
(
Â
->
idx
);

1677 
Â
->
idx
 = 
NULL
;

1678 
Â
->
idx_buûd_Ÿf
 = 0;

1679 
	}
}

1681 
	$bgzf_ödex_buûd_öô
(
BGZF
 *
Â
)

1683 
	`bgzf_ödex_de°roy
(
Â
);

1684 
Â
->
idx
 = (
bgzidx_t
*Ë
	`ˇŒoc
(1,(bgzidx_t));

1685 i‡–!
Â
->
idx
 )  -1;

1686 
Â
->
idx_buûd_Ÿf
 = 1;

1688 
	}
}

1690 
	$bgzf_ödex_add_block
(
BGZF
 *
Â
)

1692 
Â
->
idx
->
noffs
++;

1693 i‡–
Â
->
idx
->
noffs
 > fp->idx->
moffs
 )

1695 
Â
->
idx
->
moffs
 = fp->idx->
noffs
;

1696 
	`kroundup32
(
Â
->
idx
->
moffs
);

1697 
Â
->
idx
->
offs
 = (
bgzidx1_t
*Ë
	`ªÆloc
(Â->idx->offs, fp->idx->
moffs
*(bgzidx1_t));

1698 i‡–!
Â
->
idx
->
offs
 )  -1;

1700 
Â
->
idx
->
offs
[ fp->idx->
noffs
-1 ].
uaddr
 = fp->idx->
ublock_addr
;

1701 
Â
->
idx
->
offs
[ fp->idx->
noffs
-1 ].
ˇddr
 = fp->
block_addªss
;

1703 
	}
}

1705 
ölöe
 
	$hwrôe_uöt64
(
uöt64_t
 
x
, 
hFILE
 *
f
)

1707 i‡(
	`ed_is_big
()Ë
x
 = 
	`ed_sw≠_8
(x);

1708 i‡(
	`hwrôe
(
f
, &
x
, (x)) != (x))  -1;

1710 
	}
}

1712 * 
	$gë_«me_suffix
(c⁄° *
b«me
, c⁄° *
suffix
)

1714 
size_t
 
Àn
 = 
	`°æí
(
b«me
Ë+ såÀn(
suffix
) + 1;

1715 *
buff
 = 
	`mÆloc
(
Àn
);

1716 i‡(!
buff
Ë 
NULL
;

1717 
	`¢¥ötf
(
buff
, 
Àn
, "%s%s", 
b«me
, 
suffix
);

1718  
buff
;

1719 
	}
}

1721 
	$bgzf_ödex_dump_hfûe
(
BGZF
 *
Â
, 
hFILE
 *
idx
, c⁄° *
«me
)

1727 
i
, 
ßve_î∫o
;

1729 i‡(!
Â
->
idx
) {

1730 i‡(
hts_vîbo£
 > 1) {

1731 
	`Ârötf
(
°dîr
, "[E::%s] Called for BGZF handle withÇo index",

1732 
__func__
);

1733 
î∫o
 = 
EINVAL
;

1738 i‡(
	`bgzf_Êush
(
Â
) != 0)  -1;

1740 i‡(
	`hwrôe_uöt64
(
Â
->
idx
->
noffs
 - 1, idxË< 0Ë
Áû
;

1741 
i
=1; i<
Â
->
idx
->
noffs
; i++)

1743 i‡(
	`hwrôe_uöt64
(
Â
->
idx
->
offs
[
i
].
ˇddr
, idxË< 0Ë
Áû
;

1744 i‡(
	`hwrôe_uöt64
(
Â
->
idx
->
offs
[
i
].
uaddr
, idxË< 0Ë
Áû
;

1748 
Áû
:

1749 
ßve_î∫o
 = 
î∫o
;

1750 i‡(
hts_vîbo£
 > 1) {

1751 
	`Ârötf
(
°dîr
, "[E::%s] Error writingÅo %s : %s\n",

1752 
__func__
, 
«me
 ?Çamê: "ödex", 
	`°ªº‹
(
î∫o
));

1754 
î∫o
 = 
ßve_î∫o
;

1756 
	}
}

1758 
	$bgzf_ödex_dump
(
BGZF
 *
Â
, c⁄° *
b«me
, c⁄° *
suffix
)

1760 c⁄° *
«me
 = 
b«me
, *
msg
 = 
NULL
;

1761 *
tmp
 = 
NULL
;

1762 
hFILE
 *
idx
 = 
NULL
;

1763 
ßve_î∫o
;

1765 i‡(!
Â
->
idx
) {

1766 i‡(
hts_vîbo£
 > 1) {

1767 
	`Ârötf
(
°dîr
, "[E::%s] Called for BGZF handle withÇo index",

1768 
__func__
);

1769 
î∫o
 = 
EINVAL
;

1774 i‡–
suffix
 )

1776 
tmp
 = 
	`gë_«me_suffix
(
b«me
, 
suffix
);

1777 i‡–!
tmp
 )  -1;

1778 
«me
 = 
tmp
;

1781 
idx
 = 
	`h›í
(
«me
, "wb");

1782 i‡–!
idx
 ) {

1783 
msg
 = "Error opening";

1784 
Áû
;

1787 i‡(
	`bgzf_ödex_dump_hfûe
(
Â
, 
idx
, 
«me
Ë!0Ë
Áû
;

1789 i‡(
	`h˛o£
(
idx
) < 0)

1791 
idx
 = 
NULL
;

1792 
msg
 = "Error on closing";

1793 
Áû
;

1796 
	`‰ì
(
tmp
);

1799 
Áû
:

1800 
ßve_î∫o
 = 
î∫o
;

1801 i‡(
hts_vîbo£
 > 1 && 
msg
 !
NULL
)

1803 
	`Ârötf
(
°dîr
, "[E::%s] %s %s : %s\n",

1804 
__func__
, 
msg
, 
«me
, 
	`°ªº‹
(
î∫o
));

1806 i‡(
idx
Ë
	`h˛o£_abru±ly
(idx);

1807 
	`‰ì
(
tmp
);

1808 
î∫o
 = 
ßve_î∫o
;

1810 
	}
}

1812 
ölöe
 
	$hªad_uöt64
(
uöt64_t
 *
x±r
, 
hFILE
 *
f
)

1814 i‡(
	`hªad
(
f
, 
x±r
, (*xptr)) != (*xptr))  -1;

1815 i‡(
	`ed_is_big
()Ë
	`ed_sw≠_8p
(
x±r
);

1817 
	}
}

1819 
	$bgzf_ödex_lﬂd_hfûe
(
BGZF
 *
Â
, 
hFILE
 *
idx
, c⁄° *
«me
)

1821 
ßve_î∫o
;

1822 
Â
->
idx
 = (
bgzidx_t
*Ë
	`ˇŒoc
(1,(bgzidx_t));

1823 i‡(
Â
->
idx
 =
NULL
Ë
Áû
;

1824 
uöt64_t
 
x
;

1825 i‡(
	`hªad_uöt64
(&
x
, 
idx
Ë< 0Ë
Áû
;

1827 
Â
->
idx
->
noffs
 = fp->idx->
moffs
 = 
x
 + 1;

1828 
Â
->
idx
->
offs
 = (
bgzidx1_t
*Ë
	`mÆloc
(Â->idx->
moffs
*(bgzidx1_t));

1829 i‡(
Â
->
idx
->
offs
 =
NULL
Ë
Áû
;

1830 
Â
->
idx
->
offs
[0].
ˇddr
 = fp->idx->offs[0].
uaddr
 = 0;

1832 
i
;

1833 
i
=1; i<
Â
->
idx
->
noffs
; i++)

1835 i‡(
	`hªad_uöt64
(&
Â
->
idx
->
offs
[
i
].
ˇddr
, idxË< 0Ë
Áû
;

1836 i‡(
	`hªad_uöt64
(&
Â
->
idx
->
offs
[
i
].
uaddr
, idxË< 0Ë
Áû
;

1841 
Áû
:

1842 
ßve_î∫o
 = 
î∫o
;

1843 i‡(
hts_vîbo£
 > 1)

1845 
	`Ârötf
(
°dîr
, "[E::%s] ErrorÑeading %s : %s\n",

1846 
__func__
, 
«me
 ?Çamê: "ödex", 
	`°ªº‹
(
î∫o
));

1848 i‡(
Â
->
idx
) {

1849 
	`‰ì
(
Â
->
idx
->
offs
);

1850 
	`‰ì
(
Â
->
idx
);

1851 
Â
->
idx
 = 
NULL
;

1853 
î∫o
 = 
ßve_î∫o
;

1855 
	}
}

1857 
	$bgzf_ödex_lﬂd
(
BGZF
 *
Â
, c⁄° *
b«me
, c⁄° *
suffix
)

1859 
ßve_î∫o
;

1860 c⁄° *
«me
 = 
b«me
, *
msg
 = 
NULL
;

1861 *
tmp
 = 
NULL
;

1862 
hFILE
 *
idx
 = 
NULL
;

1863 i‡–
suffix
 )

1865 
tmp
 = 
	`gë_«me_suffix
(
b«me
, 
suffix
);

1866 i‡–!
tmp
 )  -1;

1867 
«me
 = 
tmp
;

1870 
idx
 = 
	`h›í
(
«me
, "rb");

1871 i‡–!
idx
 ) {

1872 
msg
 = "Error opening";

1873 
Áû
;

1876 i‡(
	`bgzf_ödex_lﬂd_hfûe
(
Â
, 
idx
, 
«me
Ë!0Ë
Áû
;

1878 i‡(
	`h˛o£
(
idx
) != 0) {

1879 
idx
 = 
NULL
;

1880 
msg
 = "Error closing";

1881 
Áû
;

1884 
	`‰ì
(
tmp
);

1887 
Áû
:

1888 
ßve_î∫o
 = 
î∫o
;

1889 i‡(
hts_vîbo£
 > 1 && 
msg
 !
NULL
) {

1890 
	`Ârötf
(
°dîr
, "[E::%s] %s %s : %s\n",

1891 
__func__
, 
msg
, 
«me
, 
	`°ªº‹
(
î∫o
));

1893 i‡(
idx
Ë
	`h˛o£_abru±ly
(idx);

1894 
	`‰ì
(
tmp
);

1895 
î∫o
 = 
ßve_î∫o
;

1897 
	}
}

1899 
	$bgzf_u£ek
(
BGZF
 *
Â
, 
uoff£t
, 
whîe
)

1901 i‡–!
Â
->
is_com¥es£d
 )

1903 i‡(
	`h£ek
(
Â
->Â, 
uoff£t
, 
SEEK_SET
) < 0)

1905 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1908 
Â
->
block_Àngth
 = 0;

1909 
Â
->
block_addªss
 = 
uoff£t
;

1910 
Â
->
block_off£t
 = 0;

1911 i‡(
	`bgzf_ªad_block
(
Â
) < 0) {

1912 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1915 
Â
->
uncom¥es£d_addªss
 = 
uoff£t
;

1919 i‡–!
Â
->
idx
 )

1921 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1926 
ûo
 = 0, 
ihi
 = 
Â
->
idx
->
noffs
 - 1;

1927  
ûo
<=
ihi
 )

1929 
i
 = (
ûo
+
ihi
)*0.5;

1930 i‡–
uoff£t
 < 
Â
->
idx
->
offs
[
i
].
uaddr
 ) 
ihi
 = i - 1;

1931 i‡–
uoff£t
 >
Â
->
idx
->
offs
[
i
].
uaddr
 ) 
ûo
 = i + 1;

1934 
i
 = 
ûo
-1;

1935 i‡(
	`h£ek
(
Â
->Â, fp->
idx
->
offs
[
i
].
ˇddr
, 
SEEK_SET
) < 0)

1937 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1940 
Â
->
block_Àngth
 = 0;

1941 
Â
->
block_addªss
 = fp->
idx
->
offs
[
i
].
ˇddr
;

1942 
Â
->
block_off£t
 = 0;

1943 i‡–
	`bgzf_ªad_block
(
Â
) < 0 ) {

1944 
Â
->
îrcode
 |
BGZF_ERR_IO
;

1947 i‡–
uoff£t
 - 
Â
->
idx
->
offs
[
i
].
uaddr
 > 0 )

1949 
Â
->
block_off£t
 = 
uoff£t
 - fp->
idx
->
offs
[
i
].
uaddr
;

1950 
	`as£π
–
Â
->
block_off£t
 <Â->
block_Àngth
 );

1952 
Â
->
uncom¥es£d_addªss
 = 
uoff£t
;

1954 
	}
}

1956 
	$bgzf_uãŒ
(
BGZF
 *
Â
)

1958  
Â
->
uncom¥es£d_addªss
;

1959 
	}
}

	@htslib/bgzip.c

25 
	~<c⁄fig.h
>

27 
	~<°dlib.h
>

28 
	~<°rög.h
>

29 
	~<°dio.h
>

30 
	~<f˙é.h
>

31 
	~<uni°d.h
>

32 
	~<î∫o.h
>

33 
	~<°d¨g.h
>

34 
	~<gë›t.h
>

35 
	~<sys/°©.h
>

36 
	~"ht¶ib/bgzf.h
"

37 
	~"ht¶ib/hts.h
"

39 c⁄° 
	gWINDOW_SIZE
 = 64 * 1024;

41 
	$îr‹
(c⁄° *
f‹m©
, ...)

43 
va_li°
 
≠
;

44 
	`va_°¨t
(
≠
, 
f‹m©
);

45 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
≠
);

46 
	`va_íd
(
≠
);

47 
	`exô
(
EXIT_FAILURE
);

48 
	}
}

50 
	$c⁄fúm_ovîwrôe
(c⁄° *
‚
)

52 
ßve_î∫o
 = 
î∫o
;

53 
ªt
 = 0;

55 i‡(
	`ißây
(
STDIN_FILENO
)) {

56 
c
;

57 
	`Ârötf
(
°dîr
, "[bgzù] %†ÆªadyÉxi°s; dÿyou wishÅÿovîwrôê(y o∏n)? ", 
‚
);

58 i‡(
	`sˇnf
("%c", &
c
Ë=1 && (¯='Y' || c ='y')Ë
ªt
 = 1;

61 
î∫o
 = 
ßve_î∫o
;

62  
ªt
;

63 
	}
}

65 
	$bgzù_maö_ußge
()

67 
	`Ârötf
(
°dîr
, "\n");

68 
	`Ârötf
(
°dîr
, "Vîsi⁄: %s\n", 
	`hts_vîsi⁄
());

69 
	`Ârötf
(
°dîr
, "Usage: bgzip [OPTIONS] [FILE] ...\n");

70 
	`Ârötf
(
°dîr
, "Options:\n");

71 
	`Ârötf
(
°dîr
, " -b, --offset INT decompressát virtual fileÖointer (0-based uncompressed offset)\n");

72 
	`Ârötf
(
°dîr
, " -c, --stdout write on standard output, keep original files unchanged\n");

73 
	`Ârötf
(
°dîr
, " -d, --decompress decompress\n");

74 
	`Ârötf
(
°dîr
, " -f, --force overwrite files withoutásking\n");

75 
	`Ârötf
(
°dîr
, " -h, --help giveÅhis help\n");

76 
	`Ârötf
(
°dîr
, " -i, --index compressánd create BGZF index\n");

77 
	`Ârötf
(
°dîr
, " -I, --index-name FILEÇame of BGZF index file [file.gz.gzi]\n");

78 
	`Ârötf
(
°dîr
, " -r, --reindex (re)index compressed file\n");

79 
	`Ârötf
(
°dîr
, " -g, --rebgzip useán index fileÅo bgzipá file\n");

80 
	`Ârötf
(
°dîr
, " -s, --size INT decompress INT bytes (uncompressed size)\n");

81 
	`Ârötf
(
°dîr
, " -@, --threads INTÇumber of compressionÅhreadsÅo use [1]\n");

82 
	`Ârötf
(
°dîr
, "\n");

84 
	}
}

86 
	$maö
(
¨gc
, **
¨gv
)

88 
c
, 
com¥ess
, 
p°dout
, 
is_f‹˚d
, 
ödex
 = 0, 
ªbgzù
 = 0, 
ªödex
 = 0;

89 
BGZF
 *
Â
;

90 *
buf„r
;

91 
°¨t
, 
íd
, 
size
;

92 *
ödex_‚ame
 = 
NULL
;

93 
thªads
 = 1;

95 c⁄° 
›ti⁄
 
l›ti⁄s
[] =

97 {"hñp", 
no_¨gumít
, 
NULL
, 'h'},

98 {"off£t", 
ªquúed_¨gumít
, 
NULL
, 'b'},

99 {"°dout", 
no_¨gumít
, 
NULL
, 'c'},

100 {"decom¥ess", 
no_¨gumít
, 
NULL
, 'd'},

101 {"f‹˚", 
no_¨gumít
, 
NULL
, 'f'},

102 {"ödex", 
no_¨gumít
, 
NULL
, 'i'},

103 {"ödex-«me", 
ªquúed_¨gumít
, 
NULL
, 'I'},

104 {"ªödex", 
no_¨gumít
, 
NULL
, 'r'},

105 {"ªbgzù",
no_¨gumít
,
NULL
,'g'},

106 {"size", 
ªquúed_¨gumít
, 
NULL
, 's'},

107 {"thªads", 
ªquúed_¨gumít
, 
NULL
, '@'},

108 {"vîsi⁄", 
no_¨gumít
, 
NULL
, 1},

109 {
NULL
, 0, NULL, 0}

112 
com¥ess
 = 1; 
p°dout
 = 0; 
°¨t
 = 0; 
size
 = -1; 
íd
 = -1; 
is_f‹˚d
 = 0;

113 (
c
 = 
	`gë›t_l⁄g
(
¨gc
, 
¨gv
, "cdh?fb:@:s:iI:gr",
l›ti⁄s
,
NULL
)) >= 0){

114 
c
){

115 'd': 
com¥ess
 = 0; ;

116 'c': 
p°dout
 = 1; ;

117 'b': 
°¨t
 = 
	`©ﬁ
(
›èrg
); 
com¥ess
 = 0; 
p°dout
 = 1; ;

118 's': 
size
 = 
	`©ﬁ
(
›èrg
); 
p°dout
 = 1; ;

119 'f': 
is_f‹˚d
 = 1; ;

120 'i': 
ödex
 = 1; ;

121 'I': 
ödex_‚ame
 = 
›èrg
; ;

122 'g': 
ªbgzù
 = 1; ;

123 'r': 
ªödex
 = 1; 
com¥ess
 = 0; ;

124 '@': 
thªads
 = 
	`©oi
(
›èrg
); ;

126 
	`¥ötf
(

128 "C›yrighà(CË2017 GíomêRe£¨ch Ltd.\n", 
	`hts_vîsi⁄
());

129  
EXIT_SUCCESS
;

131 '?':  
	`bgzù_maö_ußge
();

134 i‡(
size
 >0Ë
íd
 = 
°¨t
 + size;

135 i‡(
íd
 >0 &&Énd < 
°¨t
) {

136 
	`Ârötf
(
°dîr
, "[bgzù] IŒegÆÑegi⁄: [%ld, %ld]\n", 
°¨t
, 
íd
);

139 i‡(
com¥ess
 == 1) {

140 
°©
 
sbuf
;

141 
f_§c
 = 
	`fûío
(
°dö
);

143 i‡–
¨gc
>
›töd
 )

145 i‡–
	`°©
(
¨gv
[
›töd
],&
sbuf
)<0 )

147 
	`Ârötf
(
°dîr
, "[bgzù] %s: %s\n", 
	`°ªº‹
(
î∫o
), 
¨gv
[
›töd
]);

151 i‡((
f_§c
 = 
	`›í
(
¨gv
[
›töd
], 
O_RDONLY
)) < 0) {

152 
	`Ârötf
(
°dîr
, "[bgzù] %s: %s\n", 
	`°ªº‹
(
î∫o
), 
¨gv
[
›töd
]);

156 i‡(
p°dout
)

157 
Â
 = 
	`bgzf_›í
("-", "w");

160 *
«me
 = 
	`mÆloc
(
	`°æí
(
¨gv
[
›töd
]) + 5);

161 
	`°r˝y
(
«me
, 
¨gv
[
›töd
]);

162 
	`°rˇt
(
«me
, ".gz");

163 
Â
 = 
	`bgzf_›í
(
«me
, 
is_f‹˚d
? "w" : "wx");

164 i‡(
Â
 =
NULL
 && 
î∫o
 =
EEXIST
 && 
	`c⁄fúm_ovîwrôe
(
«me
))

165 
Â
 = 
	`bgzf_›í
(
«me
, "w");

166 i‡(
Â
 =
NULL
) {

167 
	`Ârötf
(
°dîr
, "[bgzù] c™'à¸óã %s: %s\n", 
«me
, 
	`°ªº‹
(
î∫o
));

168 
	`‰ì
(
«me
);

171 
	`‰ì
(
«me
);

174 i‡(!
p°dout
 && 
	`ißây
(
	`fûío
((
FILE
 *)
°dout
)) )

175  
	`bgzù_maö_ußge
();

176 i‡–
ödex
 && !
ödex_‚ame
 )

178 
	`Ârötf
(
°dîr
, "[bgzip] Index fileÇameÉxpected when writingÅo stdout\n");

182 
Â
 = 
	`bgzf_›í
("-", "w");

184 i‡–
ödex
 && 
ªbgzù
 )

186 
	`Ârötf
(
°dîr
, "[bgzip] Can'tÖroduceá indexándÑebgzip simultaneously\n");

190 i‡–
ªbgzù
 && !
ödex_‚ame
 )

192 
	`Ârötf
(
°dîr
, "[bgzip] Index fileÇameÉxpected when writingÅo stdout\n");

196 i‡(
thªads
 > 1)

197 
	`bgzf_mt
(
Â
, 
thªads
, 256);

199 i‡–
ödex
 ) 
	`bgzf_ödex_buûd_öô
(
Â
);

200 
buf„r
 = 
	`mÆloc
(
WINDOW_SIZE
);

201 i‡(
ªbgzù
){

202 i‡–
	`bgzf_ödex_lﬂd
(
Â
, 
ödex_‚ame
, 
NULL
Ë< 0 ) 
	`îr‹
("CouldÇŸÜﬂd index: %s.gzi\n", 
¨gv
[
›töd
]);

204 (
c
 = 
	`ªad
(
f_§c
, 
buf„r
, 
WINDOW_SIZE
)) > 0)

205 i‡(
	`bgzf_block_wrôe
(
Â
, 
buf„r
, 
c
Ë< 0Ë
	`îr‹
("CouldÇŸ wrôê%d byãs: Eº‹ %d\n", c, fp->
îrcode
);

208 (
c
 = 
	`ªad
(
f_§c
, 
buf„r
, 
WINDOW_SIZE
)) > 0)

209 i‡(
	`bgzf_wrôe
(
Â
, 
buf„r
, 
c
Ë< 0Ë
	`îr‹
("CouldÇŸ wrôê%d byãs: Eº‹ %d\n", c, fp->
îrcode
);

211 i‡–
ödex
 )

213 i‡(
ödex_‚ame
) {

214 i‡(
	`bgzf_ödex_dump
(
Â
, 
ödex_‚ame
, 
NULL
) < 0)

215 
	`îr‹
("CouldÇŸ wrôêödexÅÿ'%s'\n", 
ödex_‚ame
);

217 i‡(
	`bgzf_ödex_dump
(
Â
, 
¨gv
[
›töd
], ".gz.gzi") < 0)

218 
	`îr‹
("CouldÇŸ wrôêödexÅÿ'%s.gz.gzi'", 
¨gv
[
›töd
]);

221 i‡(
	`bgzf_˛o£
(
Â
Ë< 0Ë
	`îr‹
("Clo£ faûed: Eº‹ %d", fp->
îrcode
);

222 i‡(
¨gc
 > 
›töd
 && !
p°dout
Ë
	`u∆ök
(
¨gv
[optind]);

223 
	`‰ì
(
buf„r
);

224 
	`˛o£
(
f_§c
);

227 i‡–
ªödex
 )

229 i‡–
¨gc
>
›töd
 )

231 
Â
 = 
	`bgzf_›í
(
¨gv
[
›töd
], "r");

232 i‡–!
Â
 ) 
	`îr‹
("[bgzù] CouldÇŸ o≥¿fûe: %s\n", 
¨gv
[
›töd
]);

236 i‡–!
ödex_‚ame
 ) 
	`îr‹
("[bgzip] Index fileÇameÉxpected whenÑeading from stdin\n");

237 
Â
 = 
	`bgzf_›í
("-", "r");

238 i‡–!
Â
 ) 
	`îr‹
("[bgzù] CouldÇŸÑód from stdö: %s\n", 
	`°ªº‹
(
î∫o
));

241 
buf„r
 = 
	`mÆloc
(
BGZF_BLOCK_SIZE
);

242 
	`bgzf_ödex_buûd_öô
(
Â
);

243 
ªt
;

244  (
ªt
=
	`bgzf_ªad
(
Â
, 
buf„r
, 
BGZF_BLOCK_SIZE
))>0 ) ;

245 
	`‰ì
(
buf„r
);

246 i‡–
ªt
<0 ) 
	`îr‹
("IsÅhe file gzipped or bgzipped? TheÜatter isÑequired for indexing.\n");

248 i‡–
ödex_‚ame
 ) {

249 i‡(
	`bgzf_ödex_dump
(
Â
, 
ödex_‚ame
, 
NULL
) < 0)

250 
	`îr‹
("CouldÇŸ wrôêödexÅÿ'%s'\n", 
ödex_‚ame
);

252 i‡(
	`bgzf_ödex_dump
(
Â
, 
¨gv
[
›töd
], ".gzi") < 0)

253 
	`îr‹
("CouldÇŸ wrôêödexÅÿ'%s.gzi'\n", 
¨gv
[
›töd
]);

256 i‡–
	`bgzf_˛o£
(
Â
)<0 ) 
	`îr‹
("Clo£ faûed: Eº‹ %d\n",Â->
îrcode
);

261 
°©
 
sbuf
;

262 
f_d°
;

264 i‡–
¨gc
>
›töd
 )

266 i‡–
	`°©
(
¨gv
[
›töd
],&
sbuf
)<0 )

268 
	`Ârötf
(
°dîr
, "[bgzù] %s: %s\n", 
	`°ªº‹
(
î∫o
), 
¨gv
[
›töd
]);

271 *
«me
;

272 
Àn
 = 
	`°æí
(
¨gv
[
›töd
]);

273 i‡–
	`°rcmp
(
¨gv
[
›töd
]+
Àn
-3,".gz") )

275 
	`Ârötf
(
°dîr
, "[bgzù] %s: unknow¿suffix -- ign‹ed\n", 
¨gv
[
›töd
]);

278 
Â
 = 
	`bgzf_›í
(
¨gv
[
›töd
], "r");

279 i‡(
Â
 =
NULL
) {

280 
	`Ârötf
(
°dîr
, "[bgzù] CouldÇŸ o≥¿fûe: %s\n", 
¨gv
[
›töd
]);

284 i‡(
p°dout
) {

285 
f_d°
 = 
	`fûío
(
°dout
);

288 c⁄° 
wrÊags
 = 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
;

289 
«me
 = 
	`°rdup
(
¨gv
[
›töd
]);

290 
«me
[
	`°æí
(name) - 3] = '\0';

291 
f_d°
 = 
	`›í
(
«me
, 
is_f‹˚d
? 
wrÊags
 : wrÊags|
O_EXCL
, 0666);

292 i‡(
f_d°
 < 0 && 
î∫o
 =
EEXIST
 && 
	`c⁄fúm_ovîwrôe
(
«me
))

293 
f_d°
 = 
	`›í
(
«me
, 
wrÊags
, 0666);

294 i‡(
f_d°
 < 0) {

295 
	`Ârötf
(
°dîr
, "[bgzù] c™'à¸óã %s: %s\n", 
«me
, 
	`°ªº‹
(
î∫o
));

296 
	`‰ì
(
«me
);

299 
	`‰ì
(
«me
);

302 i‡(!
p°dout
 && 
	`ißây
(
	`fûío
((
FILE
 *)
°dö
)) )

303  
	`bgzù_maö_ußge
();

306 
f_d°
 = 
	`fûío
(
°dout
);

307 
Â
 = 
	`bgzf_›í
("-", "r");

308 i‡(
Â
 =
NULL
) {

309 
	`Ârötf
(
°dîr
, "[bgzù] CouldÇŸÑód from stdö: %s\n", 
	`°ªº‹
(
î∫o
));

313 i‡(
thªads
 > 1)

314 
	`bgzf_mt
(
Â
, 
thªads
, 256);

316 
buf„r
 = 
	`mÆloc
(
WINDOW_SIZE
);

317 i‡–
°¨t
>0 )

319 i‡–
	`bgzf_ödex_lﬂd
(
Â
, 
¨gv
[
›töd
], ".gzi"Ë< 0 ) 
	`îr‹
("CouldÇotÜoad index: %s.gzi\n",árgv[optind]);

320 i‡–
	`bgzf_u£ek
(
Â
, 
°¨t
, 
SEEK_SET
Ë< 0 ) 
	`îr‹
("CouldÇot seekÅo %d-th (uncompressd) byte\n", start);

323 i‡(
íd
 < 0Ë
c
 = 
	`bgzf_ªad
(
Â
, 
buf„r
, 
WINDOW_SIZE
);

324 
c
 = 
	`bgzf_ªad
(
Â
, 
buf„r
, (
íd
 - 
°¨t
 > 
WINDOW_SIZE
)? WINDOW_SIZE:(end - start));

325 i‡(
c
 == 0) ;

326 i‡(
c
 < 0Ë
	`îr‹
("CouldÇŸÑód %d byãs: Eº‹ %d\n", (
íd
 - 
°¨t
 > 
WINDOW_SIZE
)? WINDOW_SIZE:”nd - sèπ), 
Â
->
îrcode
);

327 
°¨t
 +
c
;

328 i‡–
	`wrôe
(
f_d°
, 
buf„r
, 
c
Ë!¯Ë
	`îr‹
("CouldÇot write %d bytes\n", c);

329 i‡(
íd
 >0 && 
°¨t
 >=Énd) ;

331 
	`‰ì
(
buf„r
);

332 i‡(
	`bgzf_˛o£
(
Â
Ë< 0Ë
	`îr‹
("Clo£ faûed: Eº‹ %d\n",Â->
îrcode
);

333 i‡(!
p°dout
Ë
	`u∆ök
(
¨gv
[
›töd
]);

336 
	}
}

	@htslib/cram/cram.h

42 #i‚de‡
_CRAM_H_


43 
	#_CRAM_H_


	)

45 
	~"¸am/¸am_ßmtoﬁs.h
"

46 
	~"¸am/ßm_hódî.h
"

47 
	~"¸am_°ru˘s.h
"

48 
	~"¸am_io.h
"

49 
	~"¸am_ícode.h
"

50 
	~"¸am_decode.h
"

51 
	~"¸am_°©s.h
"

52 
	~"¸am_codecs.h
"

53 
	~"¸am_ödex.h
"

59 
	~"ht¶ib/¸am.h
"

	@htslib/cram/cram_codecs.c

36 
	~<c⁄fig.h
>

38 
	~<°dlib.h
>

39 
	~<°rög.h
>

40 
	~<as£π.h
>

41 
	~<limôs.h
>

42 
	~<°döt.h
>

43 
	~<î∫o.h
>

45 
	~"¸am/¸am.h
"

55 sig√d 
	$gë_bô_MSB
(
¸am_block
 *
block
) {

56 
vÆ
;

58 i‡(
block
->
byã
 > block->
Æloc
)

61 
vÆ
 = 
block
->
d©a
[block->
byã
] >> block->
bô
;

62 i‡(--
block
->
bô
 == -1) {

63 
block
->
bô
 = 7;

64 
block
->
byã
++;

70  
vÆ
 & 1;

71 
	}
}

77 
	$gë_⁄e_bôs_MSB
(
¸am_block
 *
block
) {

78 
n
 = 0, 
b
;

79 i‡(
block
->
byã
 >block->
uncomp_size
)

82 
b
 = 
block
->
d©a
[block->
byã
] >> block->
bô
;

83 i‡(--
block
->
bô
 == -1) {

84 
block
->
bô
 = 7;

85 
block
->
byã
++;

86 i‡(
block
->
byã
 =block->
uncomp_size
 && (
b
&1))

89 
n
++;

90 } 
b
&1);

92  
n
-1;

93 
	}
}

95 
	$gë_zîo_bôs_MSB
(
¸am_block
 *
block
) {

96 
n
 = 0, 
b
;

97 i‡(
block
->
byã
 >block->
uncomp_size
)

100 
b
 = 
block
->
d©a
[block->
byã
] >> block->
bô
;

101 i‡(--
block
->
bô
 == -1) {

102 
block
->
bô
 = 7;

103 
block
->
byã
++;

104 i‡(
block
->
byã
 =block->
uncomp_size
 && !(
b
&1))

107 
n
++;

108 } !(
b
&1));

110  
n
-1;

111 
	}
}

115 
	$°‹e_bô_MSB
(
¸am_block
 *
block
, 
bô
) {

116 i‡(
block
->
byã
 >block->
Æloc
) {

117 
block
->
Æloc
 = block->alloc ? block->alloc*2 : 1024;

118 
block
->
d©a
 = 
	`ªÆloc
(block->d©a, block->
Æloc
);

121 i‡(
bô
)

122 
block
->
d©a
[block->
byã
] |(1 << block->
bô
);

124 i‡(--
block
->
bô
 == -1) {

125 
block
->
bô
 = 7;

126 
block
->
byã
++;

127 
block
->
d©a
[block->
byã
] = 0;

129 
	}
}

134 
	$°‹e_byãs_MSB
(
¸am_block
 *
block
, *
byãs
, 
Àn
) {

135 i‡(
block
->
bô
 != 7) {

136 
block
->
bô
 = 7;

137 
block
->
byã
++;

140 
block
->
byã
 + 
Àn
 >block->
Æloc
) {

141 
block
->
Æloc
 = block->alloc ? block->alloc*2 : 1024;

142 
block
->
d©a
 = 
	`ªÆloc
(block->d©a, block->
Æloc
);

145 
	`mem˝y
(&
block
->
d©a
[block->
byã
], 
byãs
, 
Àn
);

146 
block
->
byã
 +
Àn
;

147 
	}
}

151 
ölöe
 
	$gë_bôs_MSB
(
¸am_block
 *
block
, 
nbôs
) {

152 
vÆ
 = 0;

153 
i
;

157 i‡(
nbôs
 <
block
->
bô
+1) {

158 
vÆ
 = (
block
->
d©a
[block->
byã
]>>(block->
bô
-(
nbôs
-1))) & ((1<<nbits)-1);

159 i‡((
block
->
bô
 -
nbôs
) == -1) {

160 
block
->
bô
 = 7;

161 
block
->
byã
++;

163  
vÆ
;

167 
vÆ
 = 
block
->
d©a
[block->
byã
] & ((1<<(block->
bô
+1))-1);

168 
nbôs
 -
block
->
bô
+1;

169 
block
->
bô
 = 7;

170 
block
->
byã
++;

173 
nbôs
 >= 8) {

174 
vÆ
 = (vÆ << 8Ë| 
block
->
d©a
[block->
byã
++];

175 
nbôs
 -= 8;

178 
vÆ
 <<
nbôs
;

179 
vÆ
 |(
block
->
d©a
[block->
byã
]>>(block->
bô
-(
nbôs
-1))) & ((1<<nbits)-1);

180 
block
->
bô
 -
nbôs
;

181  
vÆ
;

187 
i
 = 0; i < 
nbôs
; i++)

189 
	`GET_BIT_MSB
(
block
, 
vÆ
);

194 i‡(
nbôs
 <
block
->
bô
+1) {

195 
vÆ
 = (
block
->
d©a
[block->
byã
]>>(block->
bô
-(
nbôs
-1))) & ((1<<nbits)-1);

196 i‡((
block
->
bô
 -
nbôs
) == -1) {

197 
block
->
bô
 = 7;

198 
block
->
byã
++;

200  
vÆ
;

203 
nbôs
) {

211 8: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

212 7: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

213 6: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

214 5: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

215 4: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

216 3: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

217 2: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

218 1: 
	`GET_BIT_MSB
(
block
, 
vÆ
);

222 
i
 = 0; i < 
nbôs
; i++)

224 
	`GET_BIT_MSB
(
block
, 
vÆ
);

230  
vÆ
;

231 
	}
}

241 
	$°‹e_bôs_MSB
(
¸am_block
 *
block
, 
vÆ
, 
nbôs
) {

248 
mask
;

250 i‡(
block
->
byã
+4 >block->
Æloc
) {

251 i‡(
block
->
byã
) {

252 
block
->
Æloc
 *= 2;

253 
block
->
d©a
 = 
	`ªÆloc
(block->d©a, block->
Æloc
 + 4);

254 i‡(!
block
->
d©a
)

257 
block
->
Æloc
 = 1024;

258 
block
->
d©a
 = 
	`ªÆloc
(block->d©a, block->
Æloc
 + 4);

259 i‡(!
block
->
d©a
)

261 
block
->
d©a
[0] = 0;

266 i‡(
nbôs
 <
block
->
bô
+1) {

267 
block
->
d©a
[block->
byã
] |(
vÆ
 << (block->
bô
+1-
nbôs
));

268 i‡((
block
->
bô
-=
nbôs
) == -1) {

269 
block
->
bô
 = 7;

270 
block
->
byã
++;

271 
block
->
d©a
[block->
byã
] = 0;

276 
block
->
d©a
[block->
byã
] |(
vÆ
 >> (
nbôs
 -block->
bô
+1));

277 
block
->
bô
 = 7;

278 
block
->
byã
++;

279 
block
->
d©a
[block->
byã
] = 0;

281 
mask
 = 1<<(
nbôs
-1);

283 i‡(
vÆ
 & 
mask
)

284 
block
->
d©a
[block->
byã
] |(1 << block->
bô
);

285 i‡(--
block
->
bô
 == -1) {

286 
block
->
bô
 = 7;

287 
block
->
byã
++;

288 
block
->
d©a
[block->
byã
] = 0;

290 
mask
 >>= 1;

291 } --
nbôs
);

294 
	}
}

301 *
	$¸am_exåa˘_block
(
¸am_block
 *
b
, 
size
) {

302 *
˝
 = (*)
b
->
d©a
 + b->
idx
;

303 
b
->
idx
 +
size
;

304 i‡(
b
->
idx
 > b->
uncomp_size
)

305  
NULL
;

307  
˝
;

308 
	}
}

314 
	$¸am_exã∫Æ_decode_ª£t
(
¸am_codec
 *
c
) {

315 
c
->
exã∫Æ
.
b
 = 
NULL
;

316 
	}
}

318 
	$¸am_exã∫Æ_decode_öt
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

319 
¸am_block
 *
ö
, *
out
, *
out_size
) {

320 
l
;

321 *
˝
;

322 
¸am_block
 *
b
;

325 i‡(!(
b
 = 
c
->
exã∫Æ
.b)){

326 
b
 = 
	`¸am_gë_block_by_id
(
¶i˚
, 
c
->
exã∫Æ
.
c⁄ã¡_id
);

327 
c
->
exã∫Æ
.
b
 = b;

329 i‡(!
b
)

330  *
out_size
?-1:0;

332 
˝
 = (*)
b
->
d©a
 + b->
idx
;

334 
l
 = 
	`ß„_ôf8_gë
(
˝
, (*)
b
->
d©a
 + b->
uncomp_size
, (
öt32_t
 *)
out
);

335 
b
->
idx
 +
l
;

336 *
out_size
 = 1;

338  
l
 > 0 ? 0 : -1;

339 
	}
}

341 
	$¸am_exã∫Æ_decode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

342 
¸am_block
 *
ö
, *
out
,

343 *
out_size
) {

344 *
˝
;

345 
¸am_block
 *
b
;

348 i‡(!(
b
 = 
c
->
exã∫Æ
.b)){

349 
b
 = 
	`¸am_gë_block_by_id
(
¶i˚
, 
c
->
exã∫Æ
.
c⁄ã¡_id
);

350 
c
->
exã∫Æ
.
b
 = b;

352 i‡(!
b
)

353  *
out_size
?-1:0;

355 
˝
 = 
	`¸am_exåa˘_block
(
b
, *
out_size
);

356 i‡(!
˝
)

359 i‡(
out
)

360 
	`mem˝y
(
out
, 
˝
, *
out_size
);

362 
	}
}

364 
	$¸am_exã∫Æ_decode_block
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

365 
¸am_block
 *
ö
, *
out_
,

366 *
out_size
) {

367 *
˝
;

368 
¸am_block
 *
out
 = (¸am_block *)
out_
;

369 
¸am_block
 *
b
 = 
NULL
;

372 i‡(!(
b
 = 
c
->
exã∫Æ
.b)){

373 
b
 = 
	`¸am_gë_block_by_id
(
¶i˚
, 
c
->
exã∫Æ
.
c⁄ã¡_id
);

374 
c
->
exã∫Æ
.
b
 = b;

376 i‡(!
b
)

377  *
out_size
?-1:0;

379 
˝
 = 
	`¸am_exåa˘_block
(
b
, *
out_size
);

380 i‡(!
˝
)

383 
	`BLOCK_APPEND
(
out
, 
˝
, *
out_size
);

385 
	}
}

387 
	$¸am_exã∫Æ_decode_‰ì
(
¸am_codec
 *
c
) {

388 i‡(
c
)

389 
	`‰ì
(
c
);

390 
	}
}

392 
¸am_codec
 *
	$¸am_exã∫Æ_decode_öô
(*
d©a
, 
size
,

393 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

394 
vîsi⁄
) {

395 
¸am_codec
 *
c
 = 
NULL
;

396 *
˝
 = 
d©a
;

398 i‡(
size
 < 1)

399 
mÆf‹med
;

401 i‡(!(
c
 = 
	`mÆloc
((*c))))

402  
NULL
;

404 
c
->
codec
 = 
E_EXTERNAL
;

405 i‡(
›ti⁄
 =
E_INT
 || o±i⁄ =
E_LONG
)

406 
c
->
decode
 = 
¸am_exã∫Æ_decode_öt
;

407 i‡(
›ti⁄
 =
E_BYTE_ARRAY
 || o±i⁄ =
E_BYTE
)

408 
c
->
decode
 = 
¸am_exã∫Æ_decode_ch¨
;

410 
c
->
decode
 = 
¸am_exã∫Æ_decode_block
;

411 
c
->
‰ì
 = 
¸am_exã∫Æ_decode_‰ì
;

413 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a
 + 
size
, &
c
->
exã∫Æ
.
c⁄ã¡_id
);

415 i‡(
˝
 - 
d©a
 !
size
)

416 
mÆf‹med
;

418 
c
->
exã∫Æ
.
ty≥
 = 
›ti⁄
;

419 
c
->
exã∫Æ
.
b
 = 
NULL
;

420 
c
->
ª£t
 = 
¸am_exã∫Æ_decode_ª£t
;

422  
c
;

424 
mÆf‹med
:

425 i‡(
hts_vîbo£
 >= 1)

426 
	`Ârötf
(
°dîr
, "MalformedÉxternal header stream\n");

427 
	`‰ì
(
c
);

428  
NULL
;

429 
	}
}

431 
	$¸am_exã∫Æ_ícode_öt
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

432 *
ö
, 
ö_size
) {

433 
uöt32_t
 *
i32
 = (uöt32_à*)
ö
;

435 
	`ôf8_put_blk
(
c
->
out
, *
i32
);

437 
	}
}

439 
	$¸am_exã∫Æ_ícode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

440 *
ö
, 
ö_size
) {

441 
	`BLOCK_APPEND
(
c
->
out
, 
ö
, 
ö_size
);

443 
	}
}

445 
	$¸am_exã∫Æ_ícode_‰ì
(
¸am_codec
 *
c
) {

446 i‡(!
c
)

448 
	`‰ì
(
c
);

449 
	}
}

451 
	$¸am_exã∫Æ_ícode_°‹e
(
¸am_codec
 *
c
, 
¸am_block
 *
b
, *
¥efix
,

452 
vîsi⁄
) {

453 
tmp
[99], *
ç
 =Åmp;

454 
Àn
 = 0;

456 i‡(
¥efix
) {

457 
size_t
 
l
 = 
	`°æí
(
¥efix
);

458 
	`BLOCK_APPEND
(
b
, 
¥efix
, 
l
);

459 
Àn
 +
l
;

462 
ç
 +
	`ôf8_put
—p, 
c
->
e_exã∫Æ
.
c⁄ã¡_id
);

463 
Àn
 +
	`ôf8_put_blk
(
b
, 
c
->
codec
);

464 
Àn
 +
	`ôf8_put_blk
(
b
, 
ç
-
tmp
);

465 
	`BLOCK_APPEND
(
b
, 
tmp
, 
ç
-tmp);

466 
Àn
 +
ç
-
tmp
;

468  
Àn
;

469 
	}
}

471 
¸am_codec
 *
	$¸am_exã∫Æ_ícode_öô
(
¸am_°©s
 *
°
,

472 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

473 *
d©
,

474 
vîsi⁄
) {

475 
¸am_codec
 *
c
;

477 
c
 = 
	`mÆloc
((*c));

478 i‡(!
c
)

479  
NULL
;

480 
c
->
codec
 = 
E_EXTERNAL
;

481 
c
->
‰ì
 = 
¸am_exã∫Æ_ícode_‰ì
;

482 i‡(
›ti⁄
 =
E_INT
 || o±i⁄ =
E_LONG
)

483 
c
->
ícode
 = 
¸am_exã∫Æ_ícode_öt
;

484 i‡(
›ti⁄
 =
E_BYTE_ARRAY
 || o±i⁄ =
E_BYTE
)

485 
c
->
ícode
 = 
¸am_exã∫Æ_ícode_ch¨
;

487 
	`ab‹t
();

488 
c
->
°‹e
 = 
¸am_exã∫Æ_ícode_°‹e
;

490 
c
->
e_exã∫Æ
.
c⁄ã¡_id
 = (
size_t
)
d©
;

492  
c
;

493 
	}
}

499 
	$¸am_n›_decode_ª£t
(
¸am_codec
 *
c
Ë{
	}
}

501 
	$¸am_bëa_decode_öt
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
, 
¸am_block
 *
ö
, *
out
, *
out_size
) {

502 
öt32_t
 *
out_i
 = (öt32_à*)
out
;

503 
i
, 
n
 = *
out_size
;

505 i‡(
c
->
bëa
.
nbôs
) {

506 i‡(
	`¸am_nŸ_íough_bôs
(
ö
, 
c
->
bëa
.
nbôs
 * 
n
))

509 
i
 = 0; i < 
n
; i++)

510 
out_i
[
i
] = 
	`gë_bôs_MSB
(
ö
, 
c
->
bëa
.
nbôs
Ë- c->bëa.
off£t
;

512 
i
 = 0; i < 
n
; i++)

513 
out_i
[
i
] = -
c
->
bëa
.
off£t
;

517 
	}
}

519 
	$¸am_bëa_decode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
, 
¸am_block
 *
ö
, *
out
, *
out_size
) {

520 
i
, 
n
 = *
out_size
;

523 i‡(
c
->
bëa
.
nbôs
) {

524 i‡(
	`¸am_nŸ_íough_bôs
(
ö
, 
c
->
bëa
.
nbôs
 * 
n
))

527 i‡(
out
)

528 
i
 = 0; i < 
n
; i++)

529 
out
[
i
] = 
	`gë_bôs_MSB
(
ö
, 
c
->
bëa
.
nbôs
Ë- c->bëa.
off£t
;

531 
i
 = 0; i < 
n
; i++)

532 
	`gë_bôs_MSB
(
ö
, 
c
->
bëa
.
nbôs
);

534 i‡(
out
)

535 
i
 = 0; i < 
n
; i++)

536 
out
[
i
] = -
c
->
bëa
.
off£t
;

540 
	}
}

542 
	$¸am_bëa_decode_‰ì
(
¸am_codec
 *
c
) {

543 i‡(
c
)

544 
	`‰ì
(
c
);

545 
	}
}

547 
¸am_codec
 *
	$¸am_bëa_decode_öô
(*
d©a
, 
size
,

548 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

549 
vîsi⁄
) {

550 
¸am_codec
 *
c
;

551 *
˝
 = 
d©a
;

553 i‡(!(
c
 = 
	`mÆloc
((*c))))

554  
NULL
;

556 
c
->
codec
 = 
E_BETA
;

557 i‡(
›ti⁄
 =
E_INT
 || o±i⁄ =
E_LONG
)

558 
c
->
decode
 = 
¸am_bëa_decode_öt
;

559 i‡(
›ti⁄
 =
E_BYTE_ARRAY
 || o±i⁄ =
E_BYTE
)

560 
c
->
decode
 = 
¸am_bëa_decode_ch¨
;

562 
	`Ârötf
(
°dîr
, "BYTE_ARRAYsÇot supported byÅhis codec\n");

563  
NULL
;

565 
c
->
‰ì
 = 
¸am_bëa_decode_‰ì
;

567 
c
->
bëa
.
nbôs
 = -1;

568 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a
 + 
size
, &
c
->
bëa
.
off£t
);

569 i‡(
˝
 < 
d©a
 + 
size
)

570 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a
 + 
size
, &
c
->
bëa
.
nbôs
);

572 i‡(
˝
 - 
d©a
 !
size


573 || 
c
->
bëa
.
nbôs
 < 0 || c->beta.nbits > 8 * ()) {

574 i‡(
hts_vîbo£
 >= 1)

575 
	`Ârötf
(
°dîr
, "Malformed beta header stream\n");

576 
	`‰ì
(
c
);

577  
NULL
;

580 
c
->
ª£t
 = 
¸am_n›_decode_ª£t
;

582  
c
;

583 
	}
}

585 
	$¸am_bëa_ícode_°‹e
(
¸am_codec
 *
c
, 
¸am_block
 *
b
,

586 *
¥efix
, 
vîsi⁄
) {

587 
Àn
 = 0;

589 i‡(
¥efix
) {

590 
size_t
 
l
 = 
	`°æí
(
¥efix
);

591 
	`BLOCK_APPEND
(
b
, 
¥efix
, 
l
);

592 
Àn
 +
l
;

595 
Àn
 +
	`ôf8_put_blk
(
b
, 
c
->
codec
);

596 
Àn
 +
	`ôf8_put_blk
(
b
, 
	`ôf8_size
(
c
->
e_bëa
.
off£t
)

597 + 
	`ôf8_size
(
c
->
e_bëa
.
nbôs
));

598 
Àn
 +
	`ôf8_put_blk
(
b
, 
c
->
e_bëa
.
off£t
);

599 
Àn
 +
	`ôf8_put_blk
(
b
, 
c
->
e_bëa
.
nbôs
);

601  
Àn
;

602 
	}
}

604 
	$¸am_bëa_ícode_öt
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

605 *
ö
, 
ö_size
) {

606 *
syms
 = (*)
ö
;

607 
i
, 
r
 = 0;

609 
i
 = 0; i < 
ö_size
; i++)

610 
r
 |
	`°‹e_bôs_MSB
(
c
->
out
, 
syms
[
i
] + c->
e_bëa
.
off£t
,

611 
c
->
e_bëa
.
nbôs
);

613  
r
;

614 
	}
}

616 
	$¸am_bëa_ícode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

617 *
ö
, 
ö_size
) {

618 *
syms
 = (*)
ö
;

619 
i
, 
r
 = 0;

621 
i
 = 0; i < 
ö_size
; i++)

622 
r
 |
	`°‹e_bôs_MSB
(
c
->
out
, 
syms
[
i
] + c->
e_bëa
.
off£t
,

623 
c
->
e_bëa
.
nbôs
);

625  
r
;

626 
	}
}

628 
	$¸am_bëa_ícode_‰ì
(
¸am_codec
 *
c
) {

629 i‡(
c
Ë
	`‰ì
(c);

630 
	}
}

632 
¸am_codec
 *
	$¸am_bëa_ícode_öô
(
¸am_°©s
 *
°
,

633 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

634 *
d©
,

635 
vîsi⁄
) {

636 
¸am_codec
 *
c
;

637 
mö_vÆ
, 
max_vÆ
, 
Àn
 = 0;

638 
öt64_t
 
ønge
;

640 
c
 = 
	`mÆloc
((*c));

641 i‡(!
c
)

642  
NULL
;

643 
c
->
codec
 = 
E_BETA
;

644 
c
->
‰ì
 = 
¸am_bëa_ícode_‰ì
;

645 i‡(
›ti⁄
 =
E_INT
)

646 
c
->
ícode
 = 
¸am_bëa_ícode_öt
;

648 
c
->
ícode
 = 
¸am_bëa_ícode_ch¨
;

649 
c
->
°‹e
 = 
¸am_bëa_ícode_°‹e
;

651 i‡(
d©
) {

652 
mö_vÆ
 = ((*)
d©
)[0];

653 
max_vÆ
 = ((*)
d©
)[1];

655 
mö_vÆ
 = 
INT_MAX
;

656 
max_vÆ
 = 
INT_MIN
;

657 
i
;

658 
i
 = 0; i < 
MAX_STAT_VAL
; i++) {

659 i‡(!
°
->
‰eqs
[
i
])

661 i‡(
mö_vÆ
 > 
i
)

662 
mö_vÆ
 = 
i
;

663 
max_vÆ
 = 
i
;

665 i‡(
°
->
h
) {

666 
khöt_t
 
k
;

668 
k
 = 
	`kh_begö
(
°
->
h
); k !
	`kh_íd
(st->h); k++) {

669 i‡(!
	`kh_exi°
(
°
->
h
, 
k
))

672 
i
 = 
	`kh_key
(
°
->
h
, 
k
);

673 i‡(
mö_vÆ
 > 
i
)

674 
mö_vÆ
 = 
i
;

675 i‡(
max_vÆ
 < 
i
)

676 
max_vÆ
 = 
i
;

681 
	`as£π
(
max_vÆ
 >
mö_vÆ
);

682 
c
->
e_bëa
.
off£t
 = -
mö_vÆ
;

683 
ønge
 = (
öt64_t
Ë
max_vÆ
 - 
mö_vÆ
;

684 
ønge
) {

685 
Àn
++;

686 
ønge
 >>= 1;

688 
c
->
e_bëa
.
nbôs
 = 
Àn
;

690  
c
;

691 
	}
}

697 
	$¸am_subexp_decode
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
, 
¸am_block
 *
ö
, *
out
, *
out_size
) {

698 
öt32_t
 *
out_i
 = (öt32_à*)
out
;

699 
n
, 
cou¡
;

700 
k
 = 
c
->
subexp
.k;

702 
cou¡
 = 0, 
n
 = *
out_size
; count <Ç; count++) {

703 
i
 = 0, 
èû
;

704 
vÆ
;

708 
i
 = 
	`gë_⁄e_bôs_MSB
(
ö
);

709 i‡(
i
 < 0 || 
	`¸am_nŸ_íough_bôs
(
ö
, i > 0 ? i + 
k
 - 1 : k))

716 i‡(
i
) {

717 
èû
 = 
i
 + 
k
-1;

718 
vÆ
 = 0;

719 
èû
) {

721 
	`GET_BIT_MSB
(
ö
, 
vÆ
);

722 
èû
--;

724 
vÆ
 +1 << (
i
 + 
k
-1);

726 
èû
 = 
k
;

727 
vÆ
 = 0;

728 
èû
) {

730 
	`GET_BIT_MSB
(
ö
, 
vÆ
);

731 
èû
--;

735 
out_i
[
cou¡
] = 
vÆ
 - 
c
->
subexp
.
off£t
;

739 
	}
}

741 
	$¸am_subexp_decode_‰ì
(
¸am_codec
 *
c
) {

742 i‡(
c
)

743 
	`‰ì
(
c
);

744 
	}
}

746 
¸am_codec
 *
	$¸am_subexp_decode_öô
(*
d©a
, 
size
,

747 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

748 
vîsi⁄
) {

749 
¸am_codec
 *
c
;

750 *
˝
 = 
d©a
;

752 i‡(
›ti⁄
 =
E_BYTE_ARRAY_BLOCK
) {

753 
	`Ârötf
(
°dîr
, "BYTE_ARRAYsÇot supported byÅhis codec\n");

754  
NULL
;

757 i‡(!(
c
 = 
	`mÆloc
((*c))))

758  
NULL
;

760 
c
->
codec
 = 
E_SUBEXP
;

761 
c
->
decode
 = 
¸am_subexp_decode
;

762 
c
->
‰ì
 = 
¸am_subexp_decode_‰ì
;

763 
c
->
subexp
.
k
 = -1;

765 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a
 + 
size
, &
c
->
subexp
.
off£t
);

766 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a
 + 
size
, &
c
->
subexp
.
k
);

768 i‡(
˝
 - 
d©a
 !
size
 || 
c
->
subexp
.
k
 < 0) {

769 
	`Ârötf
(
°dîr
, "Malformed subexp header stream\n");

770 
	`‰ì
(
c
);

771  
NULL
;

774 
c
->
ª£t
 = 
¸am_n›_decode_ª£t
;

776  
c
;

777 
	}
}

783 
	$¸am_gamma_decode
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
, 
¸am_block
 *
ö
, *
out
, *
out_size
) {

784 
öt32_t
 *
out_i
 = (öt32_à*)
out
;

785 
i
, 
n
;

787 
i
 = 0, 
n
 = *
out_size
; i <Ç; i++) {

788 
nz
 = 0;

789 
vÆ
;

791 
nz
 = 
	`gë_zîo_bôs_MSB
(
ö
);

792 i‡(
	`¸am_nŸ_íough_bôs
(
ö
, 
nz
))

794 
vÆ
 = 1;

795 
nz
 > 0) {

797 
	`GET_BIT_MSB
(
ö
, 
vÆ
);

798 
nz
--;

801 
out_i
[
i
] = 
vÆ
 - 
c
->
gamma
.
off£t
;

805 
	}
}

807 
	$¸am_gamma_decode_‰ì
(
¸am_codec
 *
c
) {

808 i‡(
c
)

809 
	`‰ì
(
c
);

810 
	}
}

812 
¸am_codec
 *
	$¸am_gamma_decode_öô
(*
d©a
, 
size
,

813 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

814 
vîsi⁄
) {

815 
¸am_codec
 *
c
 = 
NULL
;

816 *
˝
 = 
d©a
;

818 i‡(
›ti⁄
 =
E_BYTE_ARRAY_BLOCK
) {

819 
	`Ârötf
(
°dîr
, "BYTE_ARRAYsÇot supported byÅhis codec\n");

820  
NULL
;

823 i‡(
size
 < 1)

824 
mÆf‹med
;

826 i‡(!(
c
 = 
	`mÆloc
((*c))))

827  
NULL
;

829 
c
->
codec
 = 
E_GAMMA
;

830 
c
->
decode
 = 
¸am_gamma_decode
;

831 
c
->
‰ì
 = 
¸am_gamma_decode_‰ì
;

833 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a
 + 
size
, &
c
->
gamma
.
off£t
);

835 i‡(
˝
 - 
d©a
 !
size
)

836 
mÆf‹med
;

838 
c
->
ª£t
 = 
¸am_n›_decode_ª£t
;

840  
c
;

842 
mÆf‹med
:

843 i‡(
hts_vîbo£
 >= 1)

844 
	`Ârötf
(
°dîr
, "Malformed gamma header stream\n");

845 
	`‰ì
(
c
);

846  
NULL
;

847 
	}
}

854 
	$code_s‹t
(c⁄° *
vp1
, c⁄° *
vp2
) {

855 c⁄° 
¸am_huffm™_code
 *
c1
 = (c⁄° cøm_huffm™_codê*)
vp1
;

856 c⁄° 
¸am_huffm™_code
 *
c2
 = (c⁄° cøm_huffm™_codê*)
vp2
;

858 i‡(
c1
->
Àn
 !
c2
->len)

859  
c1
->
Àn
 - 
c2
->len;

861  
c1
->
symbﬁ
 - 
c2
->symbol;

862 
	}
}

864 
	$¸am_huffm™_decode_‰ì
(
¸am_codec
 *
c
) {

865 i‡(!
c
)

868 i‡(
c
->
huffm™
.
codes
)

869 
	`‰ì
(
c
->
huffm™
.
codes
);

870 
	`‰ì
(
c
);

871 
	}
}

873 
	$¸am_huffm™_decode_nuŒ
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

874 
¸am_block
 *
ö
, *
out
, *
out_size
) {

876 
	}
}

878 
	$¸am_huffm™_decode_ch¨0
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

879 
¸am_block
 *
ö
, *
out
, *
out_size
) {

880 
i
, 
n
;

882 i‡(!
out
)

886 
i
 = 0, 
n
 = *
out_size
; i <Ç; i++) {

887 
out
[
i
] = 
c
->
huffm™
.
codes
[0].
symbﬁ
;

890 
	}
}

892 
	$¸am_huffm™_decode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

893 
¸am_block
 *
ö
, *
out
, *
out_size
) {

894 
i
, 
n
, 
ncodes
 = 
c
->
huffm™
.ncodes;

895 c⁄° 
¸am_huffm™_code
 * c⁄° 
codes
 = 
c
->
huffm™
.codes;

897 
i
 = 0, 
n
 = *
out_size
; i <Ç; i++) {

898 
idx
 = 0;

899 
vÆ
 = 0, 
Àn
 = 0, 
œ°_Àn
 = 0;

902 
dÀn
 = 
codes
[
idx
].
Àn
 - 
œ°_Àn
;

903 i‡(
	`¸am_nŸ_íough_bôs
(
ö
, 
dÀn
))

910 
œ°_Àn
 = (
Àn
 +
dÀn
);

911 ; 
dÀn
; dÀn--Ë
	`GET_BIT_MSB
(
ö
, 
vÆ
);

913 
idx
 = 
vÆ
 - 
codes
[idx].
p
;

914 i‡(
idx
 >
ncodes
 || idx < 0)

917 i‡(
codes
[
idx
].
code
 =
vÆ
 && codes[idx].
Àn
 ==Üen) {

918 
out
[
i
] = 
codes
[
idx
].
symbﬁ
;

925 
	}
}

927 
	$¸am_huffm™_decode_öt0
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

928 
¸am_block
 *
ö
, *
out
, *
out_size
) {

929 
öt32_t
 *
out_i
 = (öt32_à*)
out
;

930 
i
, 
n
;

931 c⁄° 
¸am_huffm™_code
 * c⁄° 
codes
 = 
c
->
huffm™
.codes;

934 
i
 = 0, 
n
 = *
out_size
; i <Ç; i++) {

935 
out_i
[
i
] = 
codes
[0].
symbﬁ
;

938 
	}
}

940 
	$¸am_huffm™_decode_öt
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

941 
¸am_block
 *
ö
, *
out
, *
out_size
) {

942 
öt32_t
 *
out_i
 = (öt32_à*)
out
;

943 
i
, 
n
, 
ncodes
 = 
c
->
huffm™
.ncodes;

944 c⁄° 
¸am_huffm™_code
 * c⁄° 
codes
 = 
c
->
huffm™
.codes;

946 
i
 = 0, 
n
 = *
out_size
; i <Ç; i++) {

947 
idx
 = 0;

948 
vÆ
 = 0, 
Àn
 = 0, 
œ°_Àn
 = 0;

952 
dÀn
 = 
codes
[
idx
].
Àn
 - 
œ°_Àn
;

953 i‡(
	`¸am_nŸ_íough_bôs
(
ö
, 
dÀn
))

960 
œ°_Àn
 = (
Àn
 +
dÀn
);

961 ; 
dÀn
; dÀn--Ë
	`GET_BIT_MSB
(
ö
, 
vÆ
);

963 
idx
 = 
vÆ
 - 
codes
[idx].
p
;

964 i‡(
idx
 >
ncodes
 || idx < 0)

967 i‡(
codes
[
idx
].
code
 =
vÆ
 && codes[idx].
Àn
 ==Üen) {

968 
out_i
[
i
] = 
codes
[
idx
].
symbﬁ
;

975 
	}
}

980 
¸am_codec
 *
	$¸am_huffm™_decode_öô
(*
d©a
, 
size
,

981 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

982 
vîsi⁄
) {

983 
öt32_t
 
ncodes
 = 0, 
i
, 
j
;

984 *
˝
 = 
d©a
, *
d©a_íd
 = &d©a[
size
];

985 
¸am_codec
 *
h
;

986 
¸am_huffm™_code
 *
codes
;

987 
öt32_t
 
vÆ
, 
œ°_Àn
, 
max_Àn
 = 0;

988 
l
;

990 i‡(
›ti⁄
 =
E_BYTE_ARRAY_BLOCK
) {

991 
	`Ârötf
(
°dîr
, "BYTE_ARRAYsÇot supported byÅhis codec\n");

992  
NULL
;

995 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a_íd
, &
ncodes
);

996 i‡(
ncodes
 < 0) {

997 
	`Ârötf
(
°dîr
, "InvalidÇumber of symbols in huffman stream\n");

998  
NULL
;

1000 i‡(
ncodes
 >
SIZE_MAX
 / (*
codes
)) {

1001 
î∫o
 = 
ENOMEM
;

1002  
NULL
;

1005 
h
 = 
	`ˇŒoc
(1, (*h));

1006 i‡(!
h
)

1007  
NULL
;

1009 
h
->
codec
 = 
E_HUFFMAN
;

1010 
h
->
‰ì
 = 
¸am_huffm™_decode_‰ì
;

1012 
h
->
huffm™
.
ncodes
 =Çcodes;

1013 i‡(
ncodes
) {

1014 
codes
 = 
h
->
huffm™
.code†
	`mÆloc
(
ncodes
 * (*codes));

1015 i‡(!
codes
) {

1016 
	`‰ì
(
h
);

1017  
NULL
;

1020 
codes
 = 
h
->
huffm™
.code†
NULL
;

1024 
i
 = 0, 
l
 = 1; i < 
ncodes
 &&Ü > 0; i++, 
˝
 +=Ü) {

1025 
l
 = 
	`ß„_ôf8_gë
(
˝
, 
d©a_íd
, &
codes
[
i
].
symbﬁ
);

1028 i‡(
l
 < 1) {

1029 
	`Ârötf
(
°dîr
, "Malformed huffman header stream\n");

1030 
	`‰ì
(
h
);

1031  
NULL
;

1033 
˝
 +
	`ß„_ôf8_gë
(˝, 
d©a_íd
, &
i
);

1034 i‡(
i
 !
ncodes
) {

1035 
	`Ârötf
(
°dîr
, "Malformed huffman header stream\n");

1036 
	`‰ì
(
h
);

1037  
NULL
;

1040 
h
->
ª£t
 = 
¸am_n›_decode_ª£t
;

1042 i‡(
ncodes
 == 0) {

1045 
h
->
decode
 = 
¸am_huffm™_decode_nuŒ
;

1046  
h
;

1049 
i
 = 0, 
l
 = 1; i < 
ncodes
; i++, 
˝
 +=Ü) {

1050 
l
 = 
	`ß„_ôf8_gë
(
˝
, 
d©a_íd
, &
codes
[
i
].
Àn
);

1051 i‡(
l
 < 1)

1053 i‡(
max_Àn
 < 
codes
[
i
].
Àn
)

1054 
max_Àn
 = 
codes
[
i
].
Àn
;

1056 i‡(
l
 < 1 || 
˝
 - 
d©a
 !
size
 || 
max_Àn
 >
ncodes
) {

1057 
	`Ârötf
(
°dîr
, "Malformed huffman header stream\n");

1058 
	`‰ì
(
h
);

1059  
NULL
;

1063 
	`qs‹t
(
codes
, 
ncodes
, (*codes), 
code_s‹t
);

1066 
vÆ
 = -1, 
œ°_Àn
 = 0;

1067 
i
 = 0; i < 
ncodes
; i++) {

1068 
vÆ
++;

1069 i‡(
codes
[
i
].
Àn
 > 
œ°_Àn
) {

1070 
codes
[
i
].
Àn
 > 
œ°_Àn
) {

1071 
vÆ
 <<= 1;

1072 
œ°_Àn
++;

1075 
codes
[
i
].
code
 = 
vÆ
;

1083 
œ°_Àn
 = 0;

1084 
i
 = 
j
 = 0; i < 
ncodes
; i++) {

1085 i‡(
codes
[
i
].
Àn
 > 
œ°_Àn
) {

1086 
j
 = 
codes
[
i
].
code
 - i;

1087 
œ°_Àn
 = 
codes
[
i
].
Àn
;

1089 
codes
[
i
].
p
 = 
j
;

1107 i‡(
›ti⁄
 =
E_BYTE
 || o±i⁄ =
E_BYTE_ARRAY
) {

1108 i‡(
h
->
huffm™
.
codes
[0].
Àn
 == 0)

1109 
h
->
decode
 = 
¸am_huffm™_decode_ch¨0
;

1111 
h
->
decode
 = 
¸am_huffm™_decode_ch¨
;

1112 } i‡(
›ti⁄
 =
E_BYTE_ARRAY_BLOCK
) {

1113 
	`ab‹t
();

1115 i‡(
h
->
huffm™
.
codes
[0].
Àn
 == 0)

1116 
h
->
decode
 = 
¸am_huffm™_decode_öt0
;

1118 
h
->
decode
 = 
¸am_huffm™_decode_öt
;

1121  (
¸am_codec
 *)
h
;

1122 
	}
}

1124 
	$¸am_huffm™_ícode_ch¨0
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1125 *
ö
, 
ö_size
) {

1127 
	}
}

1129 
	$¸am_huffm™_ícode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1130 *
ö
, 
ö_size
) {

1131 
i
, 
code
, 
Àn
, 
r
 = 0;

1132 *
syms
 = (*)
ö
;

1134 
ö_size
--) {

1135 
sym
 = *
syms
++;

1136 i‡(
sym
 >-1 && sym < 
MAX_HUFF
) {

1137 
i
 = 
c
->
e_huffm™
.
vÆ2code
[
sym
+1];

1138 
	`as£π
(
c
->
e_huffm™
.
codes
[
i
].
symbﬁ
 =
sym
);

1139 
code
 = 
c
->
e_huffm™
.
codes
[
i
].code;

1140 
Àn
 = 
c
->
e_huffm™
.
codes
[
i
].len;

1143 
i
 = 0; i < 
c
->
e_huffm™
.
nvÆs
; i++) {

1144 i‡(
c
->
e_huffm™
.
codes
[
i
].
symbﬁ
 =
sym
)

1147 i‡(
i
 =
c
->
e_huffm™
.
nvÆs
)

1150 
code
 = 
c
->
e_huffm™
.
codes
[
i
].code;

1151 
Àn
 = 
c
->
e_huffm™
.
codes
[
i
].len;

1154 
r
 |
	`°‹e_bôs_MSB
(
c
->
out
, 
code
, 
Àn
);

1157  
r
;

1158 
	}
}

1160 
	$¸am_huffm™_ícode_öt0
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1161 *
ö
, 
ö_size
) {

1163 
	}
}

1165 
	$¸am_huffm™_ícode_öt
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1166 *
ö
, 
ö_size
) {

1167 
i
, 
code
, 
Àn
, 
r
 = 0;

1168 *
syms
 = (*)
ö
;

1170 
ö_size
--) {

1171 
sym
 = *
syms
++;

1173 i‡(
sym
 >-1 && sym < 
MAX_HUFF
) {

1174 
i
 = 
c
->
e_huffm™
.
vÆ2code
[
sym
+1];

1175 
	`as£π
(
c
->
e_huffm™
.
codes
[
i
].
symbﬁ
 =
sym
);

1176 
code
 = 
c
->
e_huffm™
.
codes
[
i
].code;

1177 
Àn
 = 
c
->
e_huffm™
.
codes
[
i
].len;

1180 
i
 = 0; i < 
c
->
e_huffm™
.
nvÆs
; i++) {

1181 i‡(
c
->
e_huffm™
.
codes
[
i
].
symbﬁ
 =
sym
)

1184 i‡(
i
 =
c
->
e_huffm™
.
nvÆs
)

1187 
code
 = 
c
->
e_huffm™
.
codes
[
i
].code;

1188 
Àn
 = 
c
->
e_huffm™
.
codes
[
i
].len;

1191 
r
 |
	`°‹e_bôs_MSB
(
c
->
out
, 
code
, 
Àn
);

1194  
r
;

1195 
	}
}

1197 
	$¸am_huffm™_ícode_‰ì
(
¸am_codec
 *
c
) {

1198 i‡(!
c
)

1201 i‡(
c
->
e_huffm™
.
codes
)

1202 
	`‰ì
(
c
->
e_huffm™
.
codes
);

1203 
	`‰ì
(
c
);

1204 
	}
}

1210 
	$¸am_huffm™_ícode_°‹e
(
¸am_codec
 *
c
, 
¸am_block
 *
b
, *
¥efix
,

1211 
vîsi⁄
) {

1212 
i
, 
Àn
 = 0;

1213 
¸am_huffm™_code
 *
codes
 = 
c
->
e_huffm™
.codes;

1223 *
tmp
 = 
	`mÆloc
(6*
c
->
e_huffm™
.
nvÆs
+16);

1224 *
ç
 = 
tmp
;

1226 i‡(!
tmp
)

1229 i‡(
¥efix
) {

1230 
size_t
 
l
 = 
	`°æí
(
¥efix
);

1231 
	`BLOCK_APPEND
(
b
, 
¥efix
, 
l
);

1232 
Àn
 +
l
;

1235 
ç
 +
	`ôf8_put
—p, 
c
->
e_huffm™
.
nvÆs
);

1236 
i
 = 0; i < 
c
->
e_huffm™
.
nvÆs
; i++) {

1237 
ç
 +
	`ôf8_put
—p, 
codes
[
i
].
symbﬁ
);

1240 
ç
 +
	`ôf8_put
—p, 
c
->
e_huffm™
.
nvÆs
);

1241 
i
 = 0; i < 
c
->
e_huffm™
.
nvÆs
; i++) {

1242 
ç
 +
	`ôf8_put
—p, 
codes
[
i
].
Àn
);

1245 
Àn
 +
	`ôf8_put_blk
(
b
, 
c
->
codec
);

1246 
Àn
 +
	`ôf8_put_blk
(
b
, 
ç
-
tmp
);

1247 
	`BLOCK_APPEND
(
b
, 
tmp
, 
ç
-tmp);

1248 
Àn
 +
ç
-
tmp
;

1250 
	`‰ì
(
tmp
);

1252  
Àn
;

1253 
	}
}

1255 
¸am_codec
 *
	$¸am_huffm™_ícode_öô
(
¸am_°©s
 *
°
,

1256 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1257 *
d©
,

1258 
vîsi⁄
) {

1259 *
vÆs
 = 
NULL
, *
‰eqs
 = NULL, 
vÆs_Æloc
 = 0, *
Àns
, 
code
, 
Àn
;

1260 
nvÆs
, 
i
, 
¡Ÿ
 = 0, 
max_vÆ
 = 0, 
mö_vÆ
 = 
INT_MAX
, 
k
;

1261 
¸am_codec
 *
c
;

1262 
¸am_huffm™_code
 *
codes
;

1264 
c
 = 
	`mÆloc
((*c));

1265 i‡(!
c
)

1266  
NULL
;

1267 
c
->
codec
 = 
E_HUFFMAN
;

1270 
nvÆs
 = 
i
 = 0; i < 
MAX_STAT_VAL
; i++) {

1271 i‡(!
°
->
‰eqs
[
i
])

1273 i‡(
nvÆs
 >
vÆs_Æloc
) {

1274 
vÆs_Æloc
 = vals_alloc ? vals_alloc*2 : 1024;

1275 
vÆs
 = 
	`ªÆloc
(vÆs, 
vÆs_Æloc
 * ());

1276 
‰eqs
 = 
	`ªÆloc
(‰eqs, 
vÆs_Æloc
 * ());

1277 i‡(!
vÆs
 || !
‰eqs
) {

1278 i‡(
vÆs
Ë
	`‰ì
(vals);

1279 i‡(
‰eqs
Ë
	`‰ì
(freqs);

1280 
	`‰ì
(
c
);

1281  
NULL
;

1284 
vÆs
[
nvÆs
] = 
i
;

1285 
‰eqs
[
nvÆs
] = 
°
->‰eqs[
i
];

1286 
	`as£π
(
°
->
‰eqs
[
i
] > 0);

1287 
¡Ÿ
 +
‰eqs
[
nvÆs
];

1288 i‡(
max_vÆ
 < 
i
) max_val = i;

1289 i‡(
mö_vÆ
 > 
i
) min_val = i;

1290 
nvÆs
++;

1292 i‡(
°
->
h
) {

1293 
khöt_t
 
k
;

1295 
k
 = 
	`kh_begö
(
°
->
h
); k !
	`kh_íd
(st->h); k++) {

1296 i‡(!
	`kh_exi°
(
°
->
h
, 
k
))

1298 i‡(
nvÆs
 >
vÆs_Æloc
) {

1299 
vÆs_Æloc
 = vals_alloc ? vals_alloc*2 : 1024;

1300 
vÆs
 = 
	`ªÆloc
(vÆs, 
vÆs_Æloc
 * ());

1301 
‰eqs
 = 
	`ªÆloc
(‰eqs, 
vÆs_Æloc
 * ());

1302 i‡(!
vÆs
 || !
‰eqs
)

1303  
NULL
;

1305 
vÆs
[
nvÆs
]
	`kh_key
(
°
->
h
, 
k
);

1306 
‰eqs
[
nvÆs
] = 
	`kh_vÆ
(
°
->
h
, 
k
);

1307 
	`as£π
(
‰eqs
[
nvÆs
] > 0);

1308 
¡Ÿ
 +
‰eqs
[
nvÆs
];

1309 i‡(
max_vÆ
 < 
i
) max_val = i;

1310 i‡(
mö_vÆ
 > 
i
) min_val = i;

1311 
nvÆs
++;

1315 
	`as£π
(
nvÆs
 > 0);

1317 
‰eqs
 = 
	`ªÆloc
(‰eqs, 2*
nvÆs
*(*freqs));

1318 
Àns
 = 
	`ˇŒoc
(2*
nvÆs
, (*lens));

1319 i‡(!
Àns
 || !
‰eqs
)

1320  
NULL
;

1326 
low1
 = 
INT_MAX
, 
low2
 = INT_MAX;

1327 
öd1
 = 0, 
öd2
 = 0;

1328 
i
 = 0; i < 
nvÆs
; i++) {

1329 i‡(
‰eqs
[
i
] < 0)

1331 i‡(
low1
 > 
‰eqs
[
i
])

1332 
low2
 = 
low1
, 
öd2
 = 
öd1
,Üow1 = 
‰eqs
[
i
], ind1 = i;

1333 i‡(
low2
 > 
‰eqs
[
i
])

1334 
low2
 = 
‰eqs
[
i
], 
öd2
 = i;

1336 i‡(
low2
 =
INT_MAX
)

1339 
‰eqs
[
nvÆs
] = 
low1
 + 
low2
;

1340 
Àns
[
öd1
] = 
nvÆs
;

1341 
Àns
[
öd2
] = 
nvÆs
;

1342 
‰eqs
[
öd1
] *= -1;

1343 
‰eqs
[
öd2
] *= -1;

1344 
nvÆs
++;

1346 
nvÆs
 =Çvals/2+1;

1349 
i
 = 0; i < 
nvÆs
; i++) {

1350 
code_Àn
 = 0;

1351 
k
 = 
Àns
[
i
]; k; k =Üens[k])

1352 
code_Àn
++;

1353 
Àns
[
i
] = 
code_Àn
;

1354 
‰eqs
[
i
] *= -1;

1360 i‡(!(
codes
 = 
	`mÆloc
(
nvÆs
 * (*codes))))

1361  
NULL
;

1362 
i
 = 0; i < 
nvÆs
; i++) {

1363 
codes
[
i
].
symbﬁ
 = 
vÆs
[i];

1364 
codes
[
i
].
Àn
 = 
Àns
[i];

1366 
	`qs‹t
(
codes
, 
nvÆs
, (*codes), 
code_s‹t
);

1388 
code
 = 0; 
Àn
 = 
codes
[0].len;

1389 
i
 = 0; i < 
nvÆs
; i++) {

1390 
Àn
 !
codes
[
i
].len) {

1391 
code
<<=1;

1392 
Àn
++;

1394 
codes
[
i
].
code
 = code++;

1396 i‡(
codes
[
i
].
symbﬁ
 >-1 && codes[i].symbﬁ < 
MAX_HUFF
)

1397 
c
->
e_huffm™
.
vÆ2code
[
codes
[
i
].
symbﬁ
+1] = i;

1403 
	`‰ì
(
Àns
);

1404 
	`‰ì
(
vÆs
);

1405 
	`‰ì
(
‰eqs
);

1407 
c
->
e_huffm™
.
codes
 = codes;

1408 
c
->
e_huffm™
.
nvÆs
 =Çvals;

1410 
c
->
‰ì
 = 
¸am_huffm™_ícode_‰ì
;

1411 i‡(
›ti⁄
 =
E_BYTE
 || o±i⁄ =
E_BYTE_ARRAY
) {

1412 i‡(
c
->
e_huffm™
.
codes
[0].
Àn
 == 0)

1413 
c
->
ícode
 = 
¸am_huffm™_ícode_ch¨0
;

1415 
c
->
ícode
 = 
¸am_huffm™_ícode_ch¨
;

1417 i‡(
c
->
e_huffm™
.
codes
[0].
Àn
 == 0)

1418 
c
->
ícode
 = 
¸am_huffm™_ícode_öt0
;

1420 
c
->
ícode
 = 
¸am_huffm™_ícode_öt
;

1422 
c
->
°‹e
 = 
¸am_huffm™_ícode_°‹e
;

1424  
c
;

1425 
	}
}

1431 
	$¸am_byã_¨øy_Àn_decode
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1432 
¸am_block
 *
ö
, *
out
,

1433 *
out_size
) {

1435 
öt32_t
 
Àn
 = 0, 
⁄e
 = 1;

1436 
r
;

1438 
r
 = 
c
->
byã_¨øy_Àn
.
Àn_codec
->
	`decode
(
¶i˚
, c->byte_array_len.len_codec,

1439 
ö
, (*)&
Àn
, &
⁄e
);

1442 i‡(!
r
 && 
c
->
byã_¨øy_Àn
.
vÆ_codec
 && 
Àn
 >= 0) {

1443 
r
 = 
c
->
byã_¨øy_Àn
.
vÆ_codec
->
	`decode
(
¶i˚
,

1444 
c
->
byã_¨øy_Àn
.
vÆ_codec
,

1445 
ö
, 
out
, &
Àn
);

1450 *
out_size
 = 
Àn
;

1452  
r
;

1453 
	}
}

1455 
	$¸am_byã_¨øy_Àn_decode_‰ì
(
¸am_codec
 *
c
) {

1456 i‡(!
c
) ;

1458 i‡(
c
->
byã_¨øy_Àn
.
Àn_codec
)

1459 
c
->
byã_¨øy_Àn
.
Àn_codec
->
	`‰ì
(c->byte_array_len.len_codec);

1461 i‡(
c
->
byã_¨øy_Àn
.
vÆ_codec
)

1462 
c
->
byã_¨øy_Àn
.
vÆ_codec
->
	`‰ì
(c->byte_array_len.val_codec);

1464 
	`‰ì
(
c
);

1465 
	}
}

1467 
	$¸am_byã_¨øy_Àn_decode_ª£t
(
¸am_codec
 *
c
) {

1468 
c
->
byã_¨øy_Àn
.
Àn_codec
->
	`ª£t
(c->byte_array_len.len_codec);

1469 
c
->
byã_¨øy_Àn
.
vÆ_codec
->
	`ª£t
(c->byte_array_len.val_codec);

1470 
	}
}

1472 
¸am_codec
 *
	$¸am_byã_¨øy_Àn_decode_öô
(*
d©a
, 
size
,

1473 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1474 
vîsi⁄
) {

1475 
¸am_codec
 *
c
;

1476 *
˝
 = 
d©a
;

1477 *
ídp
 = 
d©a
 + 
size
;

1478 
öt32_t
 
ícodög
 = 0;

1479 
öt32_t
 
sub_size
 = -1;

1481 i‡(!(
c
 = 
	`mÆloc
((*c))))

1482  
NULL
;

1484 
c
->
codec
 = 
E_BYTE_ARRAY_LEN
;

1485 
c
->
decode
 = 
¸am_byã_¨øy_Àn_decode
;

1486 
c
->
‰ì
 = 
¸am_byã_¨øy_Àn_decode_‰ì
;

1488 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
ícodög
);

1489 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
sub_size
);

1490 i‡(
sub_size
 < 0 || 
ídp
 - 
˝
 < sub_size)

1491 
mÆf‹med
;

1492 
c
->
byã_¨øy_Àn
.
Àn_codec
 = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
sub_size
,

1493 
E_INT
, 
vîsi⁄
);

1494 i‡(
c
->
byã_¨øy_Àn
.
Àn_codec
 =
NULL
)

1495 
no_codec
;

1496 
˝
 +
sub_size
;

1498 
sub_size
 = -1;

1499 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
ícodög
);

1500 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
sub_size
);

1501 i‡(
sub_size
 < 0 || 
ídp
 - 
˝
 < sub_size)

1502 
mÆf‹med
;

1503 
c
->
byã_¨øy_Àn
.
vÆ_codec
 = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
sub_size
,

1504 
›ti⁄
, 
vîsi⁄
);

1505 i‡(
c
->
byã_¨øy_Àn
.
vÆ_codec
 =
NULL
)

1506 
no_codec
;

1507 
˝
 +
sub_size
;

1509 i‡(
˝
 - 
d©a
 !
size
)

1510 
mÆf‹med
;

1512 
c
->
ª£t
 = 
¸am_byã_¨øy_Àn_decode_ª£t
;

1514  
c
;

1516 
mÆf‹med
:

1517 
	`Ârötf
(
°dîr
, "Malformed byte_array_len header stream\n");

1518 
no_codec
:

1519 
	`‰ì
(
c
);

1520  
NULL
;

1521 
	}
}

1523 
	$¸am_byã_¨øy_Àn_ícode
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1524 *
ö
, 
ö_size
) {

1525 
öt32_t
 
i32
 = 
ö_size
;

1526 
r
 = 0;

1528 
r
 |
c
->
e_byã_¨øy_Àn
.
Àn_codec
->
	`ícode
(
¶i˚
,

1529 
c
->
e_byã_¨øy_Àn
.
Àn_codec
,

1530 (*)&
i32
, 1);

1531 
r
 |
c
->
e_byã_¨øy_Àn
.
vÆ_codec
->
	`ícode
(
¶i˚
,

1532 
c
->
e_byã_¨øy_Àn
.
vÆ_codec
,

1533 
ö
, 
ö_size
);

1534  
r
;

1535 
	}
}

1537 
	$¸am_byã_¨øy_Àn_ícode_‰ì
(
¸am_codec
 *
c
) {

1538 i‡(!
c
)

1541 i‡(
c
->
e_byã_¨øy_Àn
.
Àn_codec
)

1542 
c
->
e_byã_¨øy_Àn
.
Àn_codec
->
	`‰ì
(c->e_byte_array_len.len_codec);

1544 i‡(
c
->
e_byã_¨øy_Àn
.
vÆ_codec
)

1545 
c
->
e_byã_¨øy_Àn
.
vÆ_codec
->
	`‰ì
(c->e_byte_array_len.val_codec);

1547 
	`‰ì
(
c
);

1548 
	}
}

1550 
	$¸am_byã_¨øy_Àn_ícode_°‹e
(
¸am_codec
 *
c
, 
¸am_block
 *
b
,

1551 *
¥efix
, 
vîsi⁄
) {

1552 
Àn
 = 0, 
Àn2
, 
Àn3
;

1553 
¸am_codec
 *
tc
;

1554 
¸am_block
 *
b_Àn
, *
b_vÆ
;

1556 i‡(
¥efix
) {

1557 
size_t
 
l
 = 
	`°æí
(
¥efix
);

1558 
	`BLOCK_APPEND
(
b
, 
¥efix
, 
l
);

1559 
Àn
 +
l
;

1562 
tc
 = 
c
->
e_byã_¨øy_Àn
.
Àn_codec
;

1563 
b_Àn
 = 
	`¸am_√w_block
(0, 0);

1564 
Àn2
 = 
tc
->
	`°‹e
—c, 
b_Àn
, 
NULL
, 
vîsi⁄
);

1566 
tc
 = 
c
->
e_byã_¨øy_Àn
.
vÆ_codec
;

1567 
b_vÆ
 = 
	`¸am_√w_block
(0, 0);

1568 
Àn3
 = 
tc
->
	`°‹e
—c, 
b_vÆ
, 
NULL
, 
vîsi⁄
);

1570 
Àn
 +
	`ôf8_put_blk
(
b
, 
c
->
codec
);

1571 
Àn
 +
	`ôf8_put_blk
(
b
, 
Àn2
+
Àn3
);

1572 
	`BLOCK_APPEND
(
b
, 
	`BLOCK_DATA
(
b_Àn
), 
	`BLOCK_SIZE
(b_len));

1573 
	`BLOCK_APPEND
(
b
, 
	`BLOCK_DATA
(
b_vÆ
), 
	`BLOCK_SIZE
(b_val));

1575 
	`¸am_‰ì_block
(
b_Àn
);

1576 
	`¸am_‰ì_block
(
b_vÆ
);

1578  
Àn
 + 
Àn2
 + 
Àn3
;

1579 
	}
}

1581 
¸am_codec
 *
	$¸am_byã_¨øy_Àn_ícode_öô
(
¸am_°©s
 *
°
,

1582 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1583 *
d©
,

1584 
vîsi⁄
) {

1585 
¸am_codec
 *
c
;

1586 
¸am_byã_¨øy_Àn_ícodî
 *
e
 = (¸am_byã_¨øy_Àn_ícodî *)
d©
;

1588 
c
 = 
	`mÆloc
((*c));

1589 i‡(!
c
)

1590  
NULL
;

1591 
c
->
codec
 = 
E_BYTE_ARRAY_LEN
;

1592 
c
->
‰ì
 = 
¸am_byã_¨øy_Àn_ícode_‰ì
;

1593 
c
->
ícode
 = 
¸am_byã_¨øy_Àn_ícode
;

1594 
c
->
°‹e
 = 
¸am_byã_¨øy_Àn_ícode_°‹e
;

1596 
c
->
e_byã_¨øy_Àn
.
Àn_codec
 = 
	`¸am_ícodî_öô
(
e
->
Àn_ícodög
,

1597 
°
, 
E_INT
,

1598 
e
->
Àn_d©
,

1599 
vîsi⁄
);

1600 
c
->
e_byã_¨øy_Àn
.
vÆ_codec
 = 
	`¸am_ícodî_öô
(
e
->
vÆ_ícodög
,

1601 
NULL
, 
E_BYTE_ARRAY
,

1602 
e
->
vÆ_d©
,

1603 
vîsi⁄
);

1605  
c
;

1606 
	}
}

1612 
	$¸am_byã_¨øy_°›_decode_ª£t
(
¸am_codec
 *
c
) {

1613 
c
->
byã_¨øy_°›
.
b
 = 
NULL
;

1614 
	}
}

1616 
	$¸am_byã_¨øy_°›_decode_ch¨
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1617 
¸am_block
 *
ö
, *
out
,

1618 *
out_size
) {

1619 *
˝
, 
ch
;

1620 
¸am_block
 *
b
 = 
NULL
;

1622 i‡(!(
b
 = 
c
->
byã_¨øy_°›
.b)){

1623 
b
 = 
	`¸am_gë_block_by_id
(
¶i˚
, 
c
->
byã_¨øy_°›
.
c⁄ã¡_id
);

1624 
c
->
byã_¨øy_°›
.
b
 = b;

1626 i‡(!
b
)

1627  *
out_size
?-1:0;

1629 i‡(
b
->
idx
 >b->
uncomp_size
)

1632 
˝
 = (*)
b
->
d©a
 + b->
idx
;

1633 i‡(
out
) {

1634 (
ch
 = *
˝
Ë!()
c
->
byã_¨øy_°›
.
°›
) {

1635 i‡(
˝
 - (*)
b
->
d©a
 >b->
uncomp_size
)

1637 *
out
++ = 
ch
;

1638 
˝
++;

1642 (
ch
 = *
˝
Ë!()
c
->
byã_¨øy_°›
.
°›
) {

1643 i‡(
˝
 - (*)
b
->
d©a
 >b->
uncomp_size
)

1645 
˝
++;

1649 *
out_size
 = 
˝
 - (*)(
b
->
d©a
 + b->
idx
);

1650 
b
->
idx
 = 
˝
 - (*)b->
d©a
 + 1;

1653 
	}
}

1655 
	$¸am_byã_¨øy_°›_decode_block
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1656 
¸am_block
 *
ö
, *
out_
,

1657 *
out_size
) {

1658 
¸am_block
 *
b
;

1659 
¸am_block
 *
out
 = (¸am_block *)
out_
;

1660 *
˝
, *
out_˝
, *
˝_íd
;

1661 
°›
;

1663 i‡(!(
b
 = 
c
->
byã_¨øy_°›
.b)){

1664 
b
 = 
	`¸am_gë_block_by_id
(
¶i˚
, 
c
->
byã_¨øy_°›
.
c⁄ã¡_id
);

1665 
c
->
byã_¨øy_°›
.
b
 = b;

1667 i‡(!
b
)

1668  *
out_size
?-1:0;

1670 i‡(
b
->
idx
 >b->
uncomp_size
)

1672 
˝
 = (*)
b
->
d©a
 + b->
idx
;

1673 
˝_íd
 = (*)
b
->
d©a
 + b->
uncomp_size
;

1674 
out_˝
 = (*)
	`BLOCK_END
(
out
);

1676 
°›
 = 
c
->
byã_¨øy_°›
.stop;

1677 i‡(
˝_íd
 - 
˝
 < 
out
->
Æloc
 - out->
byã
) {

1678 
˝
 !
˝_íd
 && *˝ !
°›
)

1679 *
out_˝
++ = *
˝
++;

1680 
	`BLOCK_SIZE
(
out
Ë
out_˝
 - (*)
	`BLOCK_DATA
(out);

1682 *
˝_°¨t
;

1683 
˝_°¨t
 = 
˝
; c∞!
˝_íd
 && *˝ !
°›
; cp++)

1685 
	`BLOCK_APPEND
(
out
, 
˝_°¨t
, 
˝
 - cp_start);

1686 
	`BLOCK_GROW
(
out
, 
˝
 - 
˝_°¨t
);

1689 *
out_size
 = 
˝
 - (*)(
b
->
d©a
 + b->
idx
);

1690 
b
->
idx
 = 
˝
 - (*)b->
d©a
 + 1;

1693 
	}
}

1695 
	$¸am_byã_¨øy_°›_decode_‰ì
(
¸am_codec
 *
c
) {

1696 i‡(!
c
) ;

1698 
	`‰ì
(
c
);

1699 
	}
}

1701 
¸am_codec
 *
	$¸am_byã_¨øy_°›_decode_öô
(*
d©a
, 
size
,

1702 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1703 
vîsi⁄
) {

1704 
¸am_codec
 *
c
 = 
NULL
;

1705 *
˝
 = (*)
d©a
;

1707 i‡(
size
 < (
	`CRAM_MAJOR_VERS
(
vîsi⁄
) == 1 ? 5 : 2))

1708 
mÆf‹med
;

1710 i‡(!(
c
 = 
	`mÆloc
((*c))))

1711  
NULL
;

1713 
c
->
codec
 = 
E_BYTE_ARRAY_STOP
;

1714 
›ti⁄
) {

1715 
E_BYTE_ARRAY_BLOCK
:

1716 
c
->
decode
 = 
¸am_byã_¨øy_°›_decode_block
;

1718 
E_BYTE_ARRAY
:

1719 
c
->
decode
 = 
¸am_byã_¨øy_°›_decode_ch¨
;

1722 i‡(
hts_vîbo£
 >= 1)

1723 
	`Ârötf
(
°dîr
, "byte_array_stop codec only supports BYTE_ARRAYs.\n");

1724 
	`‰ì
(
c
);

1725  
NULL
;

1727 
c
->
‰ì
 = 
¸am_byã_¨øy_°›_decode_‰ì
;

1729 
c
->
byã_¨øy_°›
.
°›
 = *
˝
++;

1730 i‡(
	`CRAM_MAJOR_VERS
(
vîsi⁄
) == 1) {

1731 
c
->
byã_¨øy_°›
.
c⁄ã¡_id
 = 
˝
[0] + (cp[1]<<8) + (cp[2]<<16)

1732 + (
˝
[3]<<24);

1733 
˝
 += 4;

1735 
˝
 +
	`ß„_ôf8_gë
((*Ë˝, 
d©a
 + 
size
,

1736 &
c
->
byã_¨øy_°›
.
c⁄ã¡_id
);

1739 i‡((*)
˝
 - 
d©a
 !
size
)

1740 
mÆf‹med
;

1742 
c
->
byã_¨øy_°›
.
b
 = 
NULL
;

1743 
c
->
ª£t
 = 
¸am_byã_¨øy_°›_decode_ª£t
;

1745  
c
;

1747 
mÆf‹med
:

1748 i‡(
hts_vîbo£
 >= 1)

1749 
	`Ârötf
(
°dîr
, "Malformed byte_array_stop header stream\n");

1750 
	`‰ì
(
c
);

1751  
NULL
;

1752 
	}
}

1754 
	$¸am_byã_¨øy_°›_ícode
(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
c
,

1755 *
ö
, 
ö_size
) {

1756 
	`BLOCK_APPEND
(
c
->
out
, 
ö
, 
ö_size
);

1757 
	`BLOCK_APPEND_CHAR
(
c
->
out
, c->
e_byã_¨øy_°›
.
°›
);

1759 
	}
}

1761 
	$¸am_byã_¨øy_°›_ícode_‰ì
(
¸am_codec
 *
c
) {

1762 i‡(!
c
)

1764 
	`‰ì
(
c
);

1765 
	}
}

1767 
	$¸am_byã_¨øy_°›_ícode_°‹e
(
¸am_codec
 *
c
, 
¸am_block
 *
b
,

1768 *
¥efix
, 
vîsi⁄
) {

1769 
Àn
 = 0;

1770 
buf
[20], *
˝
 = buf;

1772 i‡(
¥efix
) {

1773 
size_t
 
l
 = 
	`°æí
(
¥efix
);

1774 
	`BLOCK_APPEND
(
b
, 
¥efix
, 
l
);

1775 
Àn
 +
l
;

1778 
˝
 +
	`ôf8_put
(˝, 
c
->
codec
);

1780 i‡(
	`CRAM_MAJOR_VERS
(
vîsi⁄
) == 1) {

1781 
˝
 +
	`ôf8_put
(cp, 5);

1782 *
˝
++ = 
c
->
e_byã_¨øy_°›
.
°›
;

1783 *
˝
++ = (
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
 >> 0) & 0xff;

1784 *
˝
++ = (
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
 >> 8) & 0xff;

1785 *
˝
++ = (
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
 >> 16) & 0xff;

1786 *
˝
++ = (
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
 >> 24) & 0xff;

1788 
˝
 +
	`ôf8_put
(˝, 1 + 
	`ôf8_size
(
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
));

1789 *
˝
++ = 
c
->
e_byã_¨øy_°›
.
°›
;

1790 
˝
 +
	`ôf8_put
(˝, 
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
);

1793 
	`BLOCK_APPEND
(
b
, 
buf
, 
˝
-buf);

1794 
Àn
 +
˝
-
buf
;

1796  
Àn
;

1797 
	}
}

1799 
¸am_codec
 *
	$¸am_byã_¨øy_°›_ícode_öô
(
¸am_°©s
 *
°
,

1800 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1801 *
d©
,

1802 
vîsi⁄
) {

1803 
¸am_codec
 *
c
;

1805 
c
 = 
	`mÆloc
((*c));

1806 i‡(!
c
)

1807  
NULL
;

1808 
c
->
codec
 = 
E_BYTE_ARRAY_STOP
;

1809 
c
->
‰ì
 = 
¸am_byã_¨øy_°›_ícode_‰ì
;

1810 
c
->
ícode
 = 
¸am_byã_¨øy_°›_ícode
;

1811 
c
->
°‹e
 = 
¸am_byã_¨øy_°›_ícode_°‹e
;

1813 
c
->
e_byã_¨øy_°›
.
°›
 = ((*)
d©
)[0];

1814 
c
->
e_byã_¨øy_°›
.
c⁄ã¡_id
 = ((*)
d©
)[1];

1816  
c
;

1817 
	}
}

1823 c⁄° *
	$¸am_ícodög2°r
(
¸am_ícodög
 
t
) {

1824 
t
) {

1825 
E_NULL
:  "NULL";

1826 
E_EXTERNAL
:  "EXTERNAL";

1827 
E_GOLOMB
:  "GOLOMB";

1828 
E_HUFFMAN
:  "HUFFMAN";

1829 
E_BYTE_ARRAY_LEN
:  "BYTE_ARRAY_LEN";

1830 
E_BYTE_ARRAY_STOP
:  "BYTE_ARRAY_STOP";

1831 
E_BETA
:  "BETA";

1832 
E_SUBEXP
:  "SUBEXP";

1833 
E_GOLOMB_RICE
:  "GOLOMB_RICE";

1834 
E_GAMMA
:  "GAMMA";

1835 
E_NUM_CODECS
:

1838 
	}
}

1840 
	g¸am_codec
 *(*
	gdecode_öô
[])(*
	gd©a
,

1841 
	gsize
,

1842 
¸am_exã∫Æ_ty≥
 
	g›ti⁄
,

1843 
	gvîsi⁄
) = {

1844 
NULL
,

1845 
¸am_exã∫Æ_decode_öô
,

1846 
NULL
,

1847 
¸am_huffm™_decode_öô
,

1848 
¸am_byã_¨øy_Àn_decode_öô
,

1849 
¸am_byã_¨øy_°›_decode_öô
,

1850 
¸am_bëa_decode_öô
,

1851 
¸am_subexp_decode_öô
,

1852 
NULL
,

1853 
¸am_gamma_decode_öô
,

1856 
¸am_codec
 *
	$¸am_decodî_öô
(
¸am_ícodög
 
codec
,

1857 *
d©a
, 
size
,

1858 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1859 
vîsi⁄
) {

1860 i‡(
codec
 >
E_NULL
 && code¯< 
E_NUM_CODECS
 && 
decode_öô
[codec]) {

1861  
decode_öô
[
codec
](
d©a
, 
size
, 
›ti⁄
, 
vîsi⁄
);

1863 
	`Ârötf
(
°dîr
, "Unim∂emíãd code¯o‡ty≥ %s\n", 
	`¸am_ícodög2°r
(
codec
));

1864  
NULL
;

1866 
	}
}

1868 
	g¸am_codec
 *(*
	gícode_öô
[])(
¸am_°©s
 *
	g°x
,

1869 
¸am_exã∫Æ_ty≥
 
	g›ti⁄
,

1870 *
	g›t
,

1871 
	gvîsi⁄
) = {

1872 
NULL
,

1873 
¸am_exã∫Æ_ícode_öô
,

1874 
NULL
,

1875 
¸am_huffm™_ícode_öô
,

1876 
¸am_byã_¨øy_Àn_ícode_öô
,

1877 
¸am_byã_¨øy_°›_ícode_öô
,

1878 
¸am_bëa_ícode_öô
,

1879 
NULL
,

1880 
NULL
,

1881 
NULL
,

1884 
¸am_codec
 *
	$¸am_ícodî_öô
(
¸am_ícodög
 
codec
,

1885 
¸am_°©s
 *
°
,

1886 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

1887 *
d©
,

1888 
vîsi⁄
) {

1889 i‡(
°
 && !°->
nvÆs
)

1890  
NULL
;

1892 i‡(
ícode_öô
[
codec
]) {

1893 
¸am_codec
 *
r
;

1894 i‡((
r
 = 
ícode_öô
[
codec
](
°
, 
›ti⁄
, 
d©
, 
vîsi⁄
)))

1895 
r
->
out
 = 
NULL
;

1896  
r
;

1898 
	`Ârötf
(
°dîr
, "Unim∂emíãd code¯o‡ty≥ %s\n", 
	`¸am_ícodög2°r
(
codec
));

1899 
	`ab‹t
();

1901 
	}
}

1908 
	$¸am_codec_to_id
(
¸am_codec
 *
c
, *
id2
) {

1909 
bnum1
, 
bnum2
 = -2;

1911 
c
->
codec
) {

1912 
E_HUFFMAN
:

1913 
bnum1
 = 
c
->
huffm™
.
ncodes
 == 1 ? -2 : -1;

1915 
E_GOLOMB
:

1916 
E_BETA
:

1917 
E_SUBEXP
:

1918 
E_GOLOMB_RICE
:

1919 
E_GAMMA
:

1920 
bnum1
 = -1;

1922 
E_EXTERNAL
:

1923 
bnum1
 = 
c
->
exã∫Æ
.
c⁄ã¡_id
;

1925 
E_BYTE_ARRAY_LEN
:

1926 
bnum1
 = 
	`¸am_codec_to_id
(
c
->
byã_¨øy_Àn
.
Àn_codec
, 
NULL
);

1927 
bnum2
 = 
	`¸am_codec_to_id
(
c
->
byã_¨øy_Àn
.
vÆ_codec
, 
NULL
);

1929 
E_BYTE_ARRAY_STOP
:

1930 
bnum1
 = 
c
->
byã_¨øy_°›
.
c⁄ã¡_id
;

1932 
E_NULL
:

1933 
bnum1
 = -2;

1936 
	`Ârötf
(
°dîr
, "Unknow¿code¯ty≥ %d\n", 
c
->
codec
);

1937 
bnum1
 = -1;

1940 i‡(
id2
)

1941 *
id2
 = 
bnum2
;

1942  
bnum1
;

1943 
	}
}

1957 
	$¸am_codec_decodî2ícodî
(
¸am_fd
 *
fd
, 
¸am_codec
 *
c
) {

1958 
j
;

1960 
c
->
codec
) {

1961 
E_EXTERNAL
:

1963 
c
->
‰ì
 = 
¸am_exã∫Æ_ícode_‰ì
;

1964 
c
->
°‹e
 = 
¸am_exã∫Æ_ícode_°‹e
;

1965 i‡(
c
->
decode
 =
¸am_exã∫Æ_decode_öt
)

1966 
c
->
ícode
 = 
¸am_exã∫Æ_ícode_öt
;

1967 i‡(
c
->
decode
 =
¸am_exã∫Æ_decode_ch¨
)

1968 
c
->
ícode
 = 
¸am_exã∫Æ_ícode_ch¨
;

1973 
E_HUFFMAN
: {

1977 
¸am_codec
 *
t
 = 
	`mÆloc
((*t));

1978 
t
->
codec
 = 
E_HUFFMAN
;

1979 
t
->
‰ì
 = 
¸am_huffm™_ícode_‰ì
;

1980 
t
->
°‹e
 = 
¸am_huffm™_ícode_°‹e
;

1981 
t
->
e_huffm™
.
codes
 = 
c
->
huffm™
.codes;

1982 
t
->
e_huffm™
.
nvÆs
 = 
c
->
huffm™
.
ncodes
;

1983 
j
 = 0; j < 
t
->
e_huffm™
.
nvÆs
; j++) {

1984 
öt32_t
 
sym
 = 
t
->
e_huffm™
.
codes
[
j
].
symbﬁ
;

1985 i‡(
sym
 >-1 && sym < 
MAX_HUFF
)

1986 
t
->
e_huffm™
.
vÆ2code
[
sym
+1] = 
j
;

1989 i‡(
c
->
decode
 =
¸am_huffm™_decode_ch¨0
)

1990 
t
->
ícode
 = 
¸am_huffm™_ícode_ch¨0
;

1991 i‡(
c
->
decode
 =
¸am_huffm™_decode_ch¨
)

1992 
t
->
ícode
 = 
¸am_huffm™_ícode_ch¨
;

1993 i‡(
c
->
decode
 =
¸am_huffm™_decode_öt0
)

1994 
t
->
ícode
 = 
¸am_huffm™_ícode_öt0
;

1995 i‡(
c
->
decode
 =
¸am_huffm™_decode_öt
)

1996 
t
->
ícode
 = 
¸am_huffm™_ícode_öt
;

1998 
	`‰ì
(
t
);

2001 *
c
 = *
t
;

2002 
	`‰ì
(
t
);

2006 
E_BETA
:

2008 
c
->
‰ì
 = 
¸am_bëa_ícode_‰ì
;

2009 
c
->
°‹e
 = 
¸am_bëa_ícode_°‹e
;

2010 i‡(
c
->
decode
 =
¸am_bëa_decode_öt
)

2011 
c
->
ícode
 = 
¸am_bëa_ícode_öt
;

2012 i‡(
c
->
decode
 =
¸am_bëa_decode_ch¨
)

2013 
c
->
ícode
 = 
¸am_bëa_ícode_ch¨
;

2018 
E_BYTE_ARRAY_LEN
: {

2019 
¸am_codec
 *
t
 = 
	`mÆloc
((*t));

2020 
t
->
codec
 = 
E_BYTE_ARRAY_LEN
;

2021 
t
->
‰ì
 = 
¸am_byã_¨øy_Àn_ícode_‰ì
;

2022 
t
->
°‹e
 = 
¸am_byã_¨øy_Àn_ícode_°‹e
;

2023 
t
->
ícode
 = 
¸am_byã_¨øy_Àn_ícode
;

2024 
t
->
e_byã_¨øy_Àn
.
Àn_codec
 = 
c
->
byã_¨øy_Àn
.len_codec;

2025 
t
->
e_byã_¨øy_Àn
.
vÆ_codec
 = 
c
->
byã_¨øy_Àn
.val_codec;

2026 i‡(
	`¸am_codec_decodî2ícodî
(
fd
, 
t
->
e_byã_¨øy_Àn
.
Àn_codec
) == -1 ||

2027 
	`¸am_codec_decodî2ícodî
(
fd
, 
t
->
e_byã_¨øy_Àn
.
vÆ_codec
) == -1) {

2028 
t
->
	`‰ì
(t);

2034 *
c
 = *
t
;

2035 
	`‰ì
(
t
);

2039 
E_BYTE_ARRAY_STOP
:

2041 
c
->
‰ì
 = 
¸am_byã_¨øy_°›_ícode_‰ì
;

2042 
c
->
°‹e
 = 
¸am_byã_¨øy_°›_ícode_°‹e
;

2043 
c
->
ícode
 = 
¸am_byã_¨øy_°›_ícode
;

2051 
	}
}

	@htslib/cram/cram_codecs.h

31 #i‚de‡
_CRAM_ENCODINGS_H_


32 
	#_CRAM_ENCODINGS_H_


	)

34 
	~<öây≥s.h
>

36 #ifde‡
__˝lu•lus


40 
¸am_codec
;

52 
öt32_t
 
symbﬁ
;

53 
öt32_t
 
p
;

54 
öt32_t
 
code
;

55 
öt32_t
 
Àn
;

56 } 
	t¸am_huffm™_code
;

59 
ncodes
;

60 
¸am_huffm™_code
 *
codes
;

61 } 
	t¸am_huffm™_decodî
;

63 
	#MAX_HUFF
 128

	)

65 
¸am_huffm™_code
 *
codes
;

66 
nvÆs
;

67 
vÆ2code
[
MAX_HUFF
+1];

68 } 
	t¸am_huffm™_ícodî
;

71 
öt32_t
 
off£t
;

72 
öt32_t
 
nbôs
;

73 } 
	t¸am_bëa_decodî
;

76 
öt32_t
 
off£t
;

77 } 
	t¸am_gamma_decodî
;

80 
öt32_t
 
off£t
;

81 
öt32_t
 
k
;

82 } 
	t¸am_subexp_decodî
;

85 
öt32_t
 
c⁄ã¡_id
;

86 
¸am_exã∫Æ_ty≥
 
ty≥
;

87 
¸am_block
 *
b
;

88 } 
	t¸am_exã∫Æ_decodî
;

91 
¸am_codec
 *
Àn_codec
;

92 
¸am_codec
 *
vÆ_codec
;

93 } 
	t¸am_byã_¨øy_Àn_decodî
;

96 
°›
;

97 
öt32_t
 
c⁄ã¡_id
;

98 
¸am_block
 *
b
;

99 } 
	t¸am_byã_¨øy_°›_decodî
;

102 
¸am_ícodög
 
Àn_ícodög
;

103 
¸am_ícodög
 
vÆ_ícodög
;

104 *
Àn_d©
;

105 *
vÆ_d©
;

106 
¸am_codec
 *
Àn_codec
;

107 
¸am_codec
 *
vÆ_codec
;

108 } 
	t¸am_byã_¨øy_Àn_ícodî
;

113 
	s¸am_codec
 {

114 
¸am_ícodög
 
codec
;

115 
¸am_block
 *
out
;

116 (*
‰ì
)(
¸am_codec
 *
codec
);

117 (*
decode
)(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
codec
,

118 
¸am_block
 *
ö
, *
out
, *
out_size
);

119 (*
ícode
)(
¸am_¶i˚
 *
¶i˚
, 
¸am_codec
 *
codec
,

120 *
ö
, 
ö_size
);

121 (*
°‹e
)(
¸am_codec
 *
codec
, 
¸am_block
 *
b
, *
¥efix
,

122 
vîsi⁄
);

123 (*
ª£t
)(
¸am_codec
 *
codec
);

126 
¸am_huffm™_decodî
 
huffm™
;

127 
¸am_exã∫Æ_decodî
 
exã∫Æ
;

128 
¸am_bëa_decodî
 
bëa
;

129 
¸am_gamma_decodî
 
gamma
;

130 
¸am_subexp_decodî
 
subexp
;

131 
¸am_byã_¨øy_Àn_decodî
 
byã_¨øy_Àn
;

132 
¸am_byã_¨øy_°›_decodî
 
byã_¨øy_°›
;

134 
¸am_huffm™_ícodî
 
e_huffm™
;

135 
¸am_exã∫Æ_decodî
 
e_exã∫Æ
;

136 
¸am_byã_¨øy_°›_decodî
 
e_byã_¨øy_°›
;

137 
¸am_byã_¨øy_Àn_ícodî
 
e_byã_¨øy_Àn
;

138 
¸am_bëa_decodî
 
e_bëa
;

140 } 
	t¸am_codec
;

142 c⁄° *
¸am_ícodög2°r
(
¸am_ícodög
 
t
);

144 
¸am_codec
 *
¸am_decodî_öô
(
¸am_ícodög
 
codec
, *
d©a
, 
size
,

145 
¸am_exã∫Æ_ty≥
 
›ti⁄
,

146 
vîsi⁄
);

147 
¸am_codec
 *
¸am_ícodî_öô
(
¸am_ícodög
 
codec
, 
¸am_°©s
 *
°
,

148 
¸am_exã∫Æ_ty≥
 
›ti⁄
, *
d©
,

149 
vîsi⁄
);

156 
	#GET_BIT_MSB
(
b
,
v
Ë()(v<<=1, v|=(b->
d©a
[b->
byã
] >> b->
bô
)&1, b->byã +(--b->bô<0), b->bô&=7)

	)

164 
ölöe
 
¸am_nŸ_íough_bôs
(
¸am_block
 *
blk
, 
nbôs
) {

165 i‡(
nbôs
 < 0 ||

166 (
blk
->
byã
 >blk->
uncomp_size
 && 
nbôs
 > 0) ||

167 (
blk
->
uncomp_size
 - blk->
byã
 <
INT32_MAX
 / 8 + 1 &&

168 (
blk
->
uncomp_size
 - blk->
byã
Ë* 8 + blk->
bô
 - 7 < 
nbôs
)) {

179 
¸am_codec_to_id
(
¸am_codec
 *
c
, *
id2
);

192 
¸am_codec_decodî2ícodî
(
¸am_fd
 *
fd
, 
¸am_codec
 *
c
);

194 #ifde‡
__˝lu•lus


	@htslib/cram/cram_decode.c

36 
	~<c⁄fig.h
>

38 
	~<°dio.h
>

39 
	~<î∫o.h
>

40 
	~<as£π.h
>

41 
	~<°dlib.h
>

42 
	~<°rög.h
>

43 
	~<zlib.h
>

44 
	~<sys/ty≥s.h
>

45 
	~<sys/°©.h
>

46 
	~<m©h.h
>

47 
	~<°döt.h
>

49 
	~"¸am/¸am.h
"

50 
	~"¸am/os.h
"

51 
	~"ht¶ib/hts.h
"

67 
	$¸am_decode_TD
(*
˝
, c⁄° *
ídp
, 
¸am_block_com¥essi⁄_hdr
 *
h
) {

68 *
›
 = 
˝
;

69 *
d©
;

70 
¸am_block
 *
b
;

71 
öt32_t
 
blk_size
 = 0;

72 
nTL
, 
i
, 
sz
;

74 i‡(!(
b
 = 
	`¸am_√w_block
(0, 0)))

78 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
blk_size
);

79 i‡(!
blk_size
) {

80 
h
->
nTL
 = 0;

81 
h
->
TL
 = 
NULL
;

82 
	`¸am_‰ì_block
(
b
);

83  
˝
 - 
›
;

86 i‡(
blk_size
 < 0 || 
ídp
 - 
˝
 < blk_size) {

87 
	`¸am_‰ì_block
(
b
);

91 
	`BLOCK_APPEND
(
b
, 
˝
, 
blk_size
);

92 
˝
 +
blk_size
;

93 
sz
 = 
˝
 - 
›
;

95 i‡(
	`BLOCK_DATA
(
b
)[
	`BLOCK_SIZE
(b)-1])

96 
	`BLOCK_APPEND_CHAR
(
b
, '\0');

99 
d©
 = 
	`BLOCK_DATA
(
b
);

102 
nTL
 = 
i
 = 0; i < 
	`BLOCK_SIZE
(
b
); i++) {

103 
nTL
++;

104 
d©
[
i
])

105 
i
++;

109 
h
->
nTL
 =ÇTL;

110 i‡(!(
h
->
TL
 = 
	`ˇŒoc
(h->
nTL
, (*)))) {

111 
	`¸am_‰ì_block
(
b
);

114 
nTL
 = 
i
 = 0; i < 
	`BLOCK_SIZE
(
b
); i++) {

115 
h
->
TL
[
nTL
++] = &
d©
[
i
];

116 
d©
[
i
])

117 
i
++;

119 
h
->
TD_blk
 = 
b
;

121  
sz
;

122 
	}
}

129 
¸am_block_com¥essi⁄_hdr
 *
	$¸am_decode_com¥essi⁄_hódî
(
¸am_fd
 *
fd
,

130 
¸am_block
 *
b
) {

131 *
˝
, *
ídp
, *
˝_c›y
;

132 
¸am_block_com¥essi⁄_hdr
 *
hdr
 = 
	`ˇŒoc
(1, (*hdr));

133 
i
;

134 
öt32_t
 
m≠_size
 = 0, 
m≠_cou¡
 = 0;

136 i‡(!
hdr
)

137  
NULL
;

139 i‡(
b
->
mëhod
 !
RAW
) {

140 i‡(
	`¸am_uncom¥ess_block
(
b
)) {

141 
	`‰ì
(
hdr
);

142  
NULL
;

146 
˝
 = (*)
b
->
d©a
;

147 
ídp
 = 
˝
 + 
b
->
uncomp_size
;

149 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

150 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
hdr
->
ªf_£q_id
);

151 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
hdr
->
ªf_£q_°¨t
);

152 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
hdr
->
ªf_£q_•™
);

153 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
hdr
->
num_ªc‹ds
);

154 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
hdr
->
num_œndm¨ks
);

155 i‡((
hdr
->
num_œndm¨ks
 < 0 ||

156 
hdr
->
num_œndm¨ks
 >
SIZE_MAX
 / (
öt32_t
))) {

157 
	`‰ì
(
hdr
);

158  
NULL
;

160 i‡(!(
hdr
->
œndm¨k
 = 
	`mÆloc
(hdr->
num_œndm¨ks
 * (
öt32_t
)))) {

161 
	`‰ì
(
hdr
);

162  
NULL
;

164 
i
 = 0; i < 
hdr
->
num_œndm¨ks
; i++) {

165 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
hdr
->
œndm¨k
[
i
]);

169 
hdr
->
¥e£rv©i⁄_m≠
 = 
	`kh_öô
(
m≠
);

171 
	`mem£t
(
hdr
->
ªc_ícodög_m≠
, 0,

172 
CRAM_MAP_HASH
 * (
hdr
->
ªc_ícodög_m≠
[0]));

173 
	`mem£t
(
hdr
->
èg_ícodög_m≠
, 0,

174 
CRAM_MAP_HASH
 * (
hdr
->
èg_ícodög_m≠
[0]));

176 i‡(!
hdr
->
¥e£rv©i⁄_m≠
) {

177 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

178  
NULL
;

182 
hdr
->
m≠≥d_qs_ö˛uded
 = 0;

183 
hdr
->
unm≠≥d_qs_ö˛uded
 = 0;

184 
hdr
->
unm≠≥d_∂a˚d
 = 0;

185 
hdr
->
qs_ö˛uded
 = 0;

186 
hdr
->
ªad_«mes_ö˛uded
 = 0;

187 
hdr
->
AP_dñè
 = 1;

188 
	`mem˝y
(
hdr
->
sub°ôuti⁄_m©rix
, "CGTNAGTNACTNACGNACGT", 20);

191 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
m≠_size
); 
˝_c›y
 = cp;

192 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
m≠_cou¡
);

193 
i
 = 0; i < 
m≠_cou¡
; i++) {

194 
pm≠_t
 
hd
;

195 
khöt_t
 
k
;

196 
r
;

198 i‡(
ídp
 - 
˝
 < 3) {

199 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

200  
NULL
;

202 
˝
 += 2;

203 
	`CRAM_KEY
(
˝
[-2],cp[-1])) {

204 
	`CRAM_KEY
('M','I'):

205 
hd
.
i
 = *
˝
++;

206 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "MI", &
r
);

207 i‡(-1 =
r
) {

208 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

209  
NULL
;

212 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

213 
hdr
->
m≠≥d_qs_ö˛uded
 = 
hd
.
i
;

216 
	`CRAM_KEY
('U','I'):

217 
hd
.
i
 = *
˝
++;

218 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "UI", &
r
);

219 i‡(-1 =
r
) {

220 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

221  
NULL
;

224 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

225 
hdr
->
unm≠≥d_qs_ö˛uded
 = 
hd
.
i
;

228 
	`CRAM_KEY
('P','I'):

229 
hd
.
i
 = *
˝
++;

230 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "PI", &
r
);

231 i‡(-1 =
r
) {

232 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

233  
NULL
;

236 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

237 
hdr
->
unm≠≥d_∂a˚d
 = 
hd
.
i
;

240 
	`CRAM_KEY
('R','N'):

241 
hd
.
i
 = *
˝
++;

242 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "RN", &
r
);

243 i‡(-1 =
r
) {

244 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

245  
NULL
;

248 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

249 
hdr
->
ªad_«mes_ö˛uded
 = 
hd
.
i
;

252 
	`CRAM_KEY
('A','P'):

253 
hd
.
i
 = *
˝
++;

254 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "AP", &
r
);

255 i‡(-1 =
r
) {

256 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

257  
NULL
;

260 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

261 
hdr
->
AP_dñè
 = 
hd
.
i
;

264 
	`CRAM_KEY
('R','R'):

265 
hd
.
i
 = *
˝
++;

266 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "RR", &
r
);

267 i‡(-1 =
r
) {

268 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

269  
NULL
;

272 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

273 
fd
->
no_ªf
 = !
hd
.
i
;

276 
	`CRAM_KEY
('S','M'):

277 i‡(
ídp
 - 
˝
 < 5) {

278 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

279  
NULL
;

281 
hdr
->
sub°ôuti⁄_m©rix
[0][(
˝
[0]>>6)&3] = 'C';

282 
hdr
->
sub°ôuti⁄_m©rix
[0][(
˝
[0]>>4)&3] = 'G';

283 
hdr
->
sub°ôuti⁄_m©rix
[0][(
˝
[0]>>2)&3] = 'T';

284 
hdr
->
sub°ôuti⁄_m©rix
[0][(
˝
[0]>>0)&3] = 'N';

286 
hdr
->
sub°ôuti⁄_m©rix
[1][(
˝
[1]>>6)&3] = 'A';

287 
hdr
->
sub°ôuti⁄_m©rix
[1][(
˝
[1]>>4)&3] = 'G';

288 
hdr
->
sub°ôuti⁄_m©rix
[1][(
˝
[1]>>2)&3] = 'T';

289 
hdr
->
sub°ôuti⁄_m©rix
[1][(
˝
[1]>>0)&3] = 'N';

291 
hdr
->
sub°ôuti⁄_m©rix
[2][(
˝
[2]>>6)&3] = 'A';

292 
hdr
->
sub°ôuti⁄_m©rix
[2][(
˝
[2]>>4)&3] = 'C';

293 
hdr
->
sub°ôuti⁄_m©rix
[2][(
˝
[2]>>2)&3] = 'T';

294 
hdr
->
sub°ôuti⁄_m©rix
[2][(
˝
[2]>>0)&3] = 'N';

296 
hdr
->
sub°ôuti⁄_m©rix
[3][(
˝
[3]>>6)&3] = 'A';

297 
hdr
->
sub°ôuti⁄_m©rix
[3][(
˝
[3]>>4)&3] = 'C';

298 
hdr
->
sub°ôuti⁄_m©rix
[3][(
˝
[3]>>2)&3] = 'G';

299 
hdr
->
sub°ôuti⁄_m©rix
[3][(
˝
[3]>>0)&3] = 'N';

301 
hdr
->
sub°ôuti⁄_m©rix
[4][(
˝
[4]>>6)&3] = 'A';

302 
hdr
->
sub°ôuti⁄_m©rix
[4][(
˝
[4]>>4)&3] = 'C';

303 
hdr
->
sub°ôuti⁄_m©rix
[4][(
˝
[4]>>2)&3] = 'G';

304 
hdr
->
sub°ôuti⁄_m©rix
[4][(
˝
[4]>>0)&3] = 'T';

306 
hd
.
p
 = 
˝
;

307 
˝
 += 5;

309 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "SM", &
r
);

310 i‡(-1 =
r
) {

311 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

312  
NULL
;

314 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

317 
	`CRAM_KEY
('T','D'): {

318 
sz
 = 
	`¸am_decode_TD
(
˝
, 
ídp
, 
hdr
);

319 i‡(
sz
 < 0) {

320 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

321  
NULL
;

324 
hd
.
p
 = 
˝
;

325 
˝
 +
sz
;

327 
k
 = 
	`kh_put
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
, "TD", &
r
);

328 i‡(-1 =
r
) {

329 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

330  
NULL
;

332 
	`kh_vÆ
(
hdr
->
¥e£rv©i⁄_m≠
, 
k
Ë
hd
;

337 
	`Ârötf
(
°dîr
, "UnrecognisedÖreservation map key %c%c\n",

338 
˝
[-2], cp[-1]);

340 
˝
++;

344 i‡(
˝
 - 
˝_c›y
 !
m≠_size
) {

345 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

346  
NULL
;

350 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
m≠_size
); 
˝_c›y
 = cp;

351 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
m≠_cou¡
);

352 
i
 = 0; i < 
m≠_cou¡
; i++) {

353 *
key
 = 
˝
;

354 
öt32_t
 
ícodög
 = 
E_NULL
;

355 
öt32_t
 
size
 = 0;

356 
¸am_m≠
 *
m
 = 
	`mÆloc
((*m));

358 i‡(!
m
 || 
ídp
 - 
˝
 < 4) {

359 
	`‰ì
(
m
);

360 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

361  
NULL
;

364 
˝
 += 2;

365 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
ícodög
);

366 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
size
);

369 
m
->
key
 = (key[0]<<8)|key[1];

370 
m
->
ícodög
 =Éncoding;

371 
m
->
size
 = size;

372 
m
->
off£t
 = 
˝
 - (*)
b
->
d©a
;

373 
m
->
codec
 = 
NULL
;

375 i‡(
m
->
ícodög
 =
E_NULL
)

378 i‡(
size
 < 0 || 
ídp
 - 
˝
 < size) {

379 
	`‰ì
(
m
);

380 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

381  
NULL
;

396 i‡(
key
[0] == 'B' && key[1] == 'F') {

397 i‡(!(
hdr
->
codecs
[
DS_BF
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

398 
E_INT
,

399 
fd
->
vîsi⁄
))) {

400 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

401  
NULL
;

403 } i‡(
key
[0] == 'C' && key[1] == 'F') {

404 i‡(!(
hdr
->
codecs
[
DS_CF
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

405 
E_INT
,

406 
fd
->
vîsi⁄
))) {

407 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

408  
NULL
;

410 } i‡(
key
[0] == 'R' && key[1] == 'I') {

411 i‡(!(
hdr
->
codecs
[
DS_RI
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

412 
E_INT
,

413 
fd
->
vîsi⁄
))) {

414 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

415  
NULL
;

417 } i‡(
key
[0] == 'R' && key[1] == 'L') {

418 i‡(!(
hdr
->
codecs
[
DS_RL
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

419 
E_INT
,

420 
fd
->
vîsi⁄
))) {

421 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

422  
NULL
;

424 } i‡(
key
[0] == 'A' && key[1] == 'P') {

425 i‡(!(
hdr
->
codecs
[
DS_AP
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

426 
E_INT
,

427 
fd
->
vîsi⁄
))) {

428 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

429  
NULL
;

431 } i‡(
key
[0] == 'R' && key[1] == 'G') {

432 i‡(!(
hdr
->
codecs
[
DS_RG
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

433 
E_INT
,

434 
fd
->
vîsi⁄
))) {

435 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

436  
NULL
;

438 } i‡(
key
[0] == 'M' && key[1] == 'F') {

439 i‡(!(
hdr
->
codecs
[
DS_MF
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

440 
E_INT
,

441 
fd
->
vîsi⁄
))) {

442 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

443  
NULL
;

445 } i‡(
key
[0] == 'N' && key[1] == 'S') {

446 i‡(!(
hdr
->
codecs
[
DS_NS
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

447 
E_INT
,

448 
fd
->
vîsi⁄
))) {

449 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

450  
NULL
;

452 } i‡(
key
[0] == 'N' && key[1] == 'P') {

453 i‡(!(
hdr
->
codecs
[
DS_NP
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

454 
E_INT
,

455 
fd
->
vîsi⁄
))) {

456 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

457  
NULL
;

459 } i‡(
key
[0] == 'T' && key[1] == 'S') {

460 i‡(!(
hdr
->
codecs
[
DS_TS
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

461 
E_INT
,

462 
fd
->
vîsi⁄
))) {

463 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

464  
NULL
;

466 } i‡(
key
[0] == 'N' && key[1] == 'F') {

467 i‡(!(
hdr
->
codecs
[
DS_NF
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

468 
E_INT
,

469 
fd
->
vîsi⁄
))) {

470 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

471  
NULL
;

473 } i‡(
key
[0] == 'T' && key[1] == 'C') {

474 i‡(!(
hdr
->
codecs
[
DS_TC
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

475 
E_BYTE
,

476 
fd
->
vîsi⁄
))) {

477 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

478  
NULL
;

480 } i‡(
key
[0] == 'T' && key[1] == 'N') {

481 i‡(!(
hdr
->
codecs
[
DS_TN
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

482 
E_INT
,

483 
fd
->
vîsi⁄
))) {

484 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

485  
NULL
;

487 } i‡(
key
[0] == 'F' && key[1] == 'N') {

488 i‡(!(
hdr
->
codecs
[
DS_FN
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

489 
E_INT
,

490 
fd
->
vîsi⁄
))) {

491 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

492  
NULL
;

494 } i‡(
key
[0] == 'F' && key[1] == 'C') {

495 i‡(!(
hdr
->
codecs
[
DS_FC
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

496 
E_BYTE
,

497 
fd
->
vîsi⁄
))) {

498 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

499  
NULL
;

501 } i‡(
key
[0] == 'F' && key[1] == 'P') {

502 i‡(!(
hdr
->
codecs
[
DS_FP
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

503 
E_INT
,

504 
fd
->
vîsi⁄
))) {

505 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

506  
NULL
;

508 } i‡(
key
[0] == 'B' && key[1] == 'S') {

509 i‡(!(
hdr
->
codecs
[
DS_BS
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

510 
E_BYTE
,

511 
fd
->
vîsi⁄
))) {

512 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

513  
NULL
;

515 } i‡(
key
[0] == 'I' && key[1] == 'N') {

516 i‡(!(
hdr
->
codecs
[
DS_IN
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

517 
E_BYTE_ARRAY
,

518 
fd
->
vîsi⁄
))) {

519 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

520  
NULL
;

522 } i‡(
key
[0] == 'S' && key[1] == 'C') {

523 i‡(!(
hdr
->
codecs
[
DS_SC
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

524 
E_BYTE_ARRAY
,

525 
fd
->
vîsi⁄
))) {

526 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

527  
NULL
;

529 } i‡(
key
[0] == 'D' && key[1] == 'L') {

530 i‡(!(
hdr
->
codecs
[
DS_DL
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

531 
E_INT
,

532 
fd
->
vîsi⁄
))) {

533 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

534  
NULL
;

536 } i‡(
key
[0] == 'B' && key[1] == 'A') {

537 i‡(!(
hdr
->
codecs
[
DS_BA
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

538 
E_BYTE
,

539 
fd
->
vîsi⁄
))) {

540 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

541  
NULL
;

543 } i‡(
key
[0] == 'B' && key[1] == 'B') {

544 i‡(!(
hdr
->
codecs
[
DS_BB
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

545 
E_BYTE_ARRAY
,

546 
fd
->
vîsi⁄
))) {

547 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

548  
NULL
;

550 } i‡(
key
[0] == 'R' && key[1] == 'S') {

551 i‡(!(
hdr
->
codecs
[
DS_RS
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

552 
E_INT
,

553 
fd
->
vîsi⁄
))) {

554 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

555  
NULL
;

557 } i‡(
key
[0] == 'P' && key[1] == 'D') {

558 i‡(!(
hdr
->
codecs
[
DS_PD
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

559 
E_INT
,

560 
fd
->
vîsi⁄
))) {

561 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

562  
NULL
;

564 } i‡(
key
[0] == 'H' && key[1] == 'C') {

565 i‡(!(
hdr
->
codecs
[
DS_HC
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

566 
E_INT
,

567 
fd
->
vîsi⁄
))) {

568 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

569  
NULL
;

571 } i‡(
key
[0] == 'M' && key[1] == 'Q') {

572 i‡(!(
hdr
->
codecs
[
DS_MQ
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

573 
E_INT
,

574 
fd
->
vîsi⁄
))) {

575 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

576  
NULL
;

578 } i‡(
key
[0] == 'R' && key[1] == 'N') {

579 i‡(!(
hdr
->
codecs
[
DS_RN
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

580 
E_BYTE_ARRAY_BLOCK
,

581 
fd
->
vîsi⁄
))) {

582 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

583  
NULL
;

585 } i‡(
key
[0] == 'Q' && key[1] == 'S') {

586 i‡(!(
hdr
->
codecs
[
DS_QS
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

587 
E_BYTE
,

588 
fd
->
vîsi⁄
))) {

589 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

590  
NULL
;

592 } i‡(
key
[0] == 'Q' && key[1] == 'Q') {

593 i‡(!(
hdr
->
codecs
[
DS_QQ
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

594 
E_BYTE_ARRAY
,

595 
fd
->
vîsi⁄
))) {

596 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

597  
NULL
;

599 } i‡(
key
[0] == 'T' && key[1] == 'L') {

600 i‡(!(
hdr
->
codecs
[
DS_TL
] = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

601 
E_INT
,

602 
fd
->
vîsi⁄
))) {

603 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

604  
NULL
;

606 } i‡(
key
[0] == 'T' && key[1] == 'M') {

607 } i‡(
key
[0] == 'T' && key[1] == 'V') {

609 
	`Ârötf
(
°dîr
, "Uƒecogni£d key: %.2s\n", 
key
);

611 
˝
 +
size
;

613 
m
->
√xt
 = 
hdr
->
ªc_ícodög_m≠
[
	`CRAM_MAP
(
key
[0], key[1])];

614 
hdr
->
ªc_ícodög_m≠
[
	`CRAM_MAP
(
key
[0], key[1])] = 
m
;

616 i‡(
˝
 - 
˝_c›y
 !
m≠_size
) {

617 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

618  
NULL
;

622 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
m≠_size
); 
˝_c›y
 = cp;

623 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
m≠_cou¡
);

624 
i
 = 0; i < 
m≠_cou¡
; i++) {

625 
öt32_t
 
ícodög
 = 
E_NULL
;

626 
öt32_t
 
size
 = 0;

627 
¸am_m≠
 *
m
 = 
	`mÆloc
((*m));

628 *
key
;

630 i‡(!
m
 || 
ídp
 - 
˝
 < 6) {

631 
	`‰ì
(
m
);

632 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

633  
NULL
;

636 
key
 = 
˝
 + 1;

637 
m
->
key
 = (key[0]<<16)|(key[1]<<8)|key[2];

639 
˝
 += 4;

640 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
ícodög
);

641 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
size
);

643 
m
->
ícodög
 =Éncoding;

644 
m
->
size
 = size;

645 
m
->
off£t
 = 
˝
 - (*)
b
->
d©a
;

646 i‡(
size
 < 0 || 
ídp
 - 
˝
 < size ||

647 !(
m
->
codec
 = 
	`¸am_decodî_öô
(
ícodög
, 
˝
, 
size
,

648 
E_BYTE_ARRAY_BLOCK
, 
fd
->
vîsi⁄
))) {

649 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

650 
	`‰ì
(
m
);

651  
NULL
;

654 
˝
 +
size
;

656 
m
->
√xt
 = 
hdr
->
èg_ícodög_m≠
[
	`CRAM_MAP
(
key
[0],key[1])];

657 
hdr
->
èg_ícodög_m≠
[
	`CRAM_MAP
(
key
[0],key[1])] = 
m
;

659 i‡(
˝
 - 
˝_c›y
 !
m≠_size
) {

660 
	`¸am_‰ì_com¥essi⁄_hódî
(
hdr
);

661  
NULL
;

664  
hdr
;

665 
	}
}

677 
	$¸am_dïídít_d©a_£rõs
(
¸am_fd
 *
fd
,

678 
¸am_block_com¥essi⁄_hdr
 *
hdr
,

679 
¸am_¶i˚
 *
s
) {

680 *
block_u£d
;

681 
c‹e_u£d
 = 0;

682 
i
;

683 
i_to_id
[] = {

684 
DS_BF
, 
DS_AP
, 
DS_FP
, 
DS_RL
, 
DS_DL
, 
DS_NF
, 
DS_BA
, 
DS_QS
,

685 
DS_FC
, 
DS_FN
, 
DS_BS
, 
DS_IN
, 
DS_RG
, 
DS_MQ
, 
DS_TL
, 
DS_RN
,

686 
DS_NS
, 
DS_NP
, 
DS_TS
, 
DS_MF
, 
DS_CF
, 
DS_RI
, 
DS_RS
, 
DS_PD
,

687 
DS_HC
, 
DS_SC
, 
DS_BB
, 
DS_QQ
,

689 
uöt32_t
 
‹ig_ds
;

695 i‡(
fd
->
ªquúed_fõlds
 && fd->ªquúed_fõld†!
INT_MAX
) {

696 
hdr
->
d©a_£rõs
 = 0;

698 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_QNAME
)

699 
hdr
->
d©a_£rõs
 |
CRAM_RN
;

701 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_FLAG
)

702 
hdr
->
d©a_£rõs
 |
CRAM_BF
;

704 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_RNAME
)

705 
hdr
->
d©a_£rõs
 |
CRAM_RI
 | 
CRAM_BF
;

707 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_POS
)

708 
hdr
->
d©a_£rõs
 |
CRAM_AP
 | 
CRAM_BF
;

710 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_MAPQ
)

711 
hdr
->
d©a_£rõs
 |
CRAM_MQ
;

713 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_CIGAR
)

714 
hdr
->
d©a_£rõs
 |
CRAM_CIGAR
;

716 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_RNEXT
)

717 
hdr
->
d©a_£rõs
 |
CRAM_CF
 | 
CRAM_NF
 | 
CRAM_RI
 | 
CRAM_NS
 |
CRAM_BF
;

719 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_PNEXT
)

720 
hdr
->
d©a_£rõs
 |
CRAM_CF
 | 
CRAM_NF
 | 
CRAM_AP
 | 
CRAM_NP
 | 
CRAM_BF
;

722 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_TLEN
)

723 
hdr
->
d©a_£rõs
 |
CRAM_CF
 | 
CRAM_NF
 | 
CRAM_AP
 | 
CRAM_TS
 |

724 
CRAM_BF
 | 
CRAM_MF
 | 
CRAM_RI
 | 
CRAM_CIGAR
;

726 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_SEQ
)

727 
hdr
->
d©a_£rõs
 |
CRAM_SEQ
;

729 i‡(!(
fd
->
ªquúed_fõlds
 & 
SAM_AUX
))

731 
fd
->
decode_md
 = 0;

733 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_QUAL
)

734 
hdr
->
d©a_£rõs
 |
CRAM_QUAL
;

736 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_AUX
)

737 
hdr
->
d©a_£rõs
 |
CRAM_RG
 | 
CRAM_TL
 | 
CRAM_aux
;

739 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_RGAUX
)

740 
hdr
->
d©a_£rõs
 |
CRAM_RG
 | 
CRAM_BF
;

743 i‡(
	`¸am_uncom¥ess_block
(
s
->
block
[0]))

746 
hdr
->
d©a_£rõs
 = 
CRAM_ALL
;

748 
i
 = 0; i < 
s
->
hdr
->
num_blocks
; i++) {

749 i‡(
	`¸am_uncom¥ess_block
(
s
->
block
[
i
]))

756 
block_u£d
 = 
	`ˇŒoc
(
s
->
hdr
->
num_blocks
+1, ());

757 i‡(!
block_u£d
)

769 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_RS
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

770 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_PD
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

771 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_HC
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

772 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_QS
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

773 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_IN
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

774 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_SC
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

775 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_BS
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

776 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_DL
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

777 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_BA
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

778 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_BB
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

779 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_QQ
Ëhdr->d©a_£rõ†|
CRAM_FC
|
CRAM_FP
;

782 i‡(
hdr
->
d©a_£rõs
 & (
CRAM_SEQ
|
CRAM_CIGAR
)Ëhdr->d©a_£rõ†|
CRAM_RL
;

784 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_FP
Ëhdr->d©a_£rõ†|
CRAM_FC
;

785 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_FC
Ëhdr->d©a_£rõ†|
CRAM_FN
;

786 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_aux
Ëhdr->d©a_£rõ†|
CRAM_TL
;

787 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_MF
Ëhdr->d©a_£rõ†|
CRAM_CF
;

788 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_MQ
Ëhdr->d©a_£rõ†|
CRAM_BF
;

789 i‡(
hdr
->
d©a_£rõs
 & 
CRAM_BS
Ëhdr->d©a_£rõ†|
CRAM_RI
;

790 i‡(
hdr
->
d©a_£rõs
 & (
CRAM_MF
 |
CRAM_NS
 |
CRAM_NP
 |
CRAM_TS
 |
CRAM_NF
))

791 
hdr
->
d©a_£rõs
 |
CRAM_CF
;

792 i‡(!
hdr
->
ªad_«mes_ö˛uded
 && hdr->
d©a_£rõs
 & 
CRAM_RN
)

793 
hdr
->
d©a_£rõs
 |
CRAM_CF
 | 
CRAM_NF
;

794 i‡(
hdr
->
d©a_£rõs
 & (
CRAM_BA
 | 
CRAM_QS
 | 
CRAM_BB
 | 
CRAM_QQ
))

795 
hdr
->
d©a_£rõs
 |
CRAM_BF
 | 
CRAM_CF
 | 
CRAM_RL
;

797 
‹ig_ds
 = 
hdr
->
d©a_£rõs
;

800 
i
 = 0; i < (
i_to_id
)/(*i_to_id); i++) {

801 
bnum1
, 
bnum2
, 
j
;

802 
¸am_codec
 *
c
 = 
hdr
->
codecs
[
i_to_id
[
i
]];

804 i‡(!(
hdr
->
d©a_£rõs
 & (1<<
i
)))

807 i‡(!
c
)

810 
bnum1
 = 
	`¸am_codec_to_id
(
c
, &
bnum2
);

813 
bnum1
) {

818 
c‹e_u£d
 = 1;

822 
j
 = 0; j < 
s
->
hdr
->
num_blocks
; j++) {

823 i‡(
s
->
block
[
j
]->
c⁄ã¡_ty≥
 =
EXTERNAL
 &&

824 
s
->
block
[
j
]->
c⁄ã¡_id
 =
bnum1
) {

825 
block_u£d
[
j
] = 1;

826 i‡(
	`¸am_uncom¥ess_block
(
s
->
block
[
j
])) {

827 
	`‰ì
(
block_u£d
);

835 i‡(
bnum2
 =-2 || 
bnum1
 == bnum2)

838 
bnum1
 = 
bnum2
;

843 i‡((
fd
->
ªquúed_fõlds
 & 
SAM_AUX
) ||

844 (
hdr
->
d©a_£rõs
 & 
CRAM_aux
)) {

845 
i
 = 0; i < 
CRAM_MAP_HASH
; i++) {

846 
bnum1
, 
bnum2
, 
j
;

847 
¸am_m≠
 *
m
 = 
hdr
->
èg_ícodög_m≠
[
i
];

849 
m
) {

850 
¸am_codec
 *
c
 = 
m
->
codec
;

851 i‡(!
c
) {

852 
m
 = m->
√xt
;

856 
bnum1
 = 
	`¸am_codec_to_id
(
c
, &
bnum2
);

859 
bnum1
) {

864 
c‹e_u£d
 = 1;

868 
j
 = 0; j < 
s
->
hdr
->
num_blocks
; j++) {

869 i‡(
s
->
block
[
j
]->
c⁄ã¡_ty≥
 =
EXTERNAL
 &&

870 
s
->
block
[
j
]->
c⁄ã¡_id
 =
bnum1
) {

871 
block_u£d
[
j
] = 1;

872 i‡(
	`¸am_uncom¥ess_block
(
s
->
block
[
j
])) {

873 
	`‰ì
(
block_u£d
);

881 i‡(
bnum2
 =-2 || 
bnum1
 == bnum2)

884 
bnum1
 = 
bnum2
;

887 
m
 = m->
√xt
;

894 
i
 = 0; i < (
i_to_id
)/(*i_to_id); i++) {

895 
bnum1
, 
bnum2
, 
j
;

896 
¸am_codec
 *
c
 = 
hdr
->
codecs
[
i_to_id
[
i
]];

898 i‡(!
c
)

901 
bnum1
 = 
	`¸am_codec_to_id
(
c
, &
bnum2
);

904 
bnum1
) {

909 i‡(
c‹e_u£d
) {

911 
hdr
->
d©a_£rõs
 |1<<
i
;

916 
j
 = 0; j < 
s
->
hdr
->
num_blocks
; j++) {

917 i‡(
s
->
block
[
j
]->
c⁄ã¡_ty≥
 =
EXTERNAL
 &&

918 
s
->
block
[
j
]->
c⁄ã¡_id
 =
bnum1
) {

919 i‡(
block_u£d
[
j
]) {

921 
hdr
->
d©a_£rõs
 |1<<
i
;

928 i‡(
bnum2
 =-2 || 
bnum1
 == bnum2)

931 
bnum1
 = 
bnum2
;

936 
i
 = 0; i < 
CRAM_MAP_HASH
; i++) {

937 
bnum1
, 
bnum2
, 
j
;

938 
¸am_m≠
 *
m
 = 
hdr
->
èg_ícodög_m≠
[
i
];

940 
m
) {

941 
¸am_codec
 *
c
 = 
m
->
codec
;

942 i‡(!
c
) {

943 
m
 = m->
√xt
;

947 
bnum1
 = 
	`¸am_codec_to_id
(
c
, &
bnum2
);

950 
bnum1
) {

956 
hdr
->
d©a_£rõs
 |
CRAM_aux
;

960 
j
 = 0; j < 
s
->
hdr
->
num_blocks
; j++) {

961 i‡(
s
->
block
[
j
]->
c⁄ã¡_ty≥
 =
EXTERNAL
 &&

962 
s
->
block
[
j
]->
c⁄ã¡_id
 =
bnum1
) {

963 i‡(
block_u£d
[
j
]) {

966 
hdr
->
d©a_£rõs
 |
CRAM_aux
;

973 i‡(
bnum2
 =-2 || 
bnum1
 == bnum2)

976 
bnum1
 = 
bnum2
;

979 
m
 = m->
√xt
;

982 } 
‹ig_ds
 !
hdr
->
d©a_£rõs
);

984 
	`‰ì
(
block_u£d
);

986 
	}
}

993 
	$¸am_ds_unique
(
¸am_block_com¥essi⁄_hdr
 *
hdr
, 
¸am_codec
 *
c
,

994 
id
) {

995 
i
, 
n_id
 = 0;

996 
¸am_ícodög
 
e_ty≥
 = 0;

998 
i
 = 0; i < 
DS_END
; i++) {

999 
¸am_codec
 *
c
;

1000 
bnum1
, 
bnum2
, 
ﬁd_n_id
;

1002 i‡(!(
c
 = 
hdr
->
codecs
[
i
]))

1005 
bnum1
 = 
	`¸am_codec_to_id
(
c
, &
bnum2
);

1007 
ﬁd_n_id
 = 
n_id
;

1008 i‡(
bnum1
 =
id
) {

1009 
n_id
++;

1010 
e_ty≥
 = 
c
->
codec
;

1012 i‡(
bnum2
 =
id
) {

1013 
n_id
++;

1014 
e_ty≥
 = 
c
->
codec
;

1017 i‡(
n_id
 =
ﬁd_n_id
+2)

1018 
n_id
--;

1021  
n_id
 =1 ? 
e_ty≥
 : 0;

1022 
	}
}

1029 
	$¸am_decode_e°im©e_sizes
(
¸am_block_com¥essi⁄_hdr
 *
hdr
, 
¸am_¶i˚
 *
s
,

1030 *
quÆ_size
, *
«me_size
,

1031 *
q_id
) {

1032 
bnum1
, 
bnum2
;

1033 
¸am_codec
 *
cd
;

1035 *
quÆ_size
 = 0;

1036 *
«me_size
 = 0;

1039 
cd
 = 
hdr
->
codecs
[
DS_QS
];

1040 i‡(
cd
 =
NULL
) ;

1041 
bnum1
 = 
	`¸am_codec_to_id
(
cd
, &
bnum2
);

1042 i‡(
bnum1
 < 0 && 
bnum2
 >= 0) bnum1 = bnum2;

1043 i‡(
	`¸am_ds_unique
(
hdr
, 
cd
, 
bnum1
)) {

1044 
¸am_block
 *
b
 = 
	`¸am_gë_block_by_id
(
s
, 
bnum1
);

1045 i‡(
b
Ë*
quÆ_size
 = b->
uncomp_size
;

1046 i‡(
q_id
 && 
cd
->
codec
 =
E_EXTERNAL
)

1047 *
q_id
 = 
bnum1
;

1051 
cd
 = 
hdr
->
codecs
[
DS_RN
];

1052 i‡(
cd
 =
NULL
) ;

1053 
bnum1
 = 
	`¸am_codec_to_id
(
cd
, &
bnum2
);

1054 i‡(
bnum1
 < 0 && 
bnum2
 >= 0) bnum1 = bnum2;

1055 i‡(
	`¸am_ds_unique
(
hdr
, 
cd
, 
bnum1
)) {

1056 
¸am_block
 *
b
 = 
	`¸am_gë_block_by_id
(
s
, 
bnum1
);

1057 i‡(
b
Ë*
«me_size
 = b->
uncomp_size
;

1059 
	}
}

1071 
¸am_block_¶i˚_hdr
 *
	$¸am_decode_¶i˚_hódî
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
) {

1072 
¸am_block_¶i˚_hdr
 *
hdr
;

1073 *
˝
;

1074 *
˝_íd
;

1075 
i
;

1077 i‡(
b
->
mëhod
 !
RAW
) {

1080 i‡(
	`¸am_uncom¥ess_block
(
b
) < 0)

1081  
NULL
;

1083 
˝
 = (*)
	`BLOCK_DATA
(
b
);

1084 
˝_íd
 = 
˝
 + 
b
->
uncomp_size
;

1086 i‡(
b
->
c⁄ã¡_ty≥
 !
MAPPED_SLICE
 &&

1087 
b
->
c⁄ã¡_ty≥
 !
UNMAPPED_SLICE
)

1088  
NULL
;

1090 i‡(!(
hdr
 = 
	`ˇŒoc
(1, (*hdr))))

1091  
NULL
;

1093 
hdr
->
c⁄ã¡_ty≥
 = 
b
->content_type;

1095 i‡(
b
->
c⁄ã¡_ty≥
 =
MAPPED_SLICE
) {

1096 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
ªf_£q_id
);

1097 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
ªf_£q_°¨t
);

1098 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
ªf_£q_•™
);

1100 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
num_ªc‹ds
);

1101 
hdr
->
ªc‹d_cou¡î
 = 0;

1102 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 2) {

1103 
öt32_t
 
i32
 = 0;

1104 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
i32
);

1105 
hdr
->
ªc‹d_cou¡î
 = 
i32
;

1106 } i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

1107 
˝
 +
	`ß„_…f8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
ªc‹d_cou¡î
);

1110 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
num_blocks
);

1112 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*)
˝_íd
, &
hdr
->
num_c⁄ã¡_ids
);

1113 i‡(
hdr
->
num_c⁄ã¡_ids
 < 1 ||

1114 
hdr
->
num_c⁄ã¡_ids
 >
SIZE_MAX
 / (
öt32_t
)) {

1117 
	`‰ì
(
hdr
);

1118  
NULL
;

1120 
hdr
->
block_c⁄ã¡_ids
 = 
	`mÆloc
(hdr->
num_c⁄ã¡_ids
 * (
öt32_t
));

1121 i‡(!
hdr
->
block_c⁄ã¡_ids
) {

1122 
	`‰ì
(
hdr
);

1123  
NULL
;

1126 
i
 = 0; i < 
hdr
->
num_c⁄ã¡_ids
; i++) {

1127 
l
 = 
	`ß„_ôf8_gë
((*)
˝
, (*)
˝_íd
,

1128 &
hdr
->
block_c⁄ã¡_ids
[
i
]);

1129 i‡(
l
 <= 0) {

1130 
	`‰ì
(
hdr
->
block_c⁄ã¡_ids
);

1131 
	`‰ì
(
hdr
);

1132  
NULL
;

1134 
˝
 +
l
;

1137 i‡(
b
->
c⁄ã¡_ty≥
 =
MAPPED_SLICE
) {

1138 
˝
 +
	`ß„_ôf8_gë
((*)˝, (*Ë
˝_íd
, &
hdr
->
ªf_ba£_id
);

1141 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) != 1) {

1142 i‡(
˝_íd
 - 
˝
 < 16) {

1143 
	`‰ì
(
hdr
->
block_c⁄ã¡_ids
);

1144 
	`‰ì
(
hdr
);

1145  
NULL
;

1147 
	`mem˝y
(
hdr
->
md5
, 
˝
, 16);

1149 
	`mem£t
(
hdr
->
md5
, 0, 16);

1152  
hdr
;

1153 
	}
}

1158 
	$nbôs
(
v
) {

1159 c⁄° 
Mu…ùlyDeBruijnBôPosôi⁄
[32] = {

1164 
v
 |= v >> 1;

1165 
v
 |= v >> 2;

1166 
v
 |= v >> 4;

1167 
v
 |= v >> 8;

1168 
v
 |= v >> 16;

1171  
Mu…ùlyDeBruijnBôPosôi⁄
[(
uöt32_t
)(
v
 * 0x07C4ACDDU) >> 27];

1172 
	}
}

1176 
	$s‹t_‰eqs
(c⁄° *
vp1
, c⁄° *
vp2
) {

1177 c⁄° 
i1
 = *(c⁄° *)
vp1
;

1178 c⁄° 
i2
 = *(c⁄° *)
vp2
;

1179  
i1
-
i2
;

1180 
	}
}

1187 
ölöe
 
	$add_md_ch¨
(
¸am_¶i˚
 *
s
, 
decode_md
, 
c
, 
öt32_t
 *
md_di°
) {

1188 i‡(
decode_md
) {

1189 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, *
md_di°
);

1190 
	`BLOCK_APPEND_CHAR
(
s
->
aux_blk
, 
c
);

1191 *
md_di°
 = 0;

1193 
	}
}

1199 
	$¸am_decode_£q
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

1200 
¸am_block
 *
blk
, 
¸am_ªc‹d
 *
¸
, 
SAM_hdr
 *
bfd
,

1201 
cf
, *
£q
, *
quÆ
,

1202 
has_MD
, 
has_NM
) {

1203 
¥ev_pos
 = 0, 
f
, 
r
 = 0, 
out_sz
 = 1;

1204 
£q_pos
 = 1;

1205 
cig_Àn
 = 0, 
ªf_pos
 = 
¸
->
≠os
;

1206 
öt32_t
 
‚
, 
i32
;

1207 
cig¨_›
 
cig_›
 = 
BAM_CMATCH
;

1208 
uöt32_t
 *
cig¨
 = 
s
->cigar;

1209 
uöt32_t
 
ncig¨
 = 
s
->ncigar;

1210 
uöt32_t
 
cig¨_Æloc
 = 
s
->cigar_alloc;

1211 
uöt32_t
 
nm
 = 0;

1212 
öt32_t
 
md_di°
 = 0;

1213 
‹ig_aux
 = 0;

1214 
decode_md
 = 
fd
->decode_md && 
s
->
ªf
 && !
has_MD
;

1215 
decode_nm
 = 
fd
->
decode_md
 && 
s
->
ªf
 && !
has_NM
;

1216 
uöt32_t
 
ds
 = 
c
->
comp_hdr
->
d©a_£rõs
;

1218 i‡((
ds
 & 
CRAM_QS
Ë&& !(
cf
 & 
CRAM_FLAG_PRESERVE_QUAL_SCORES
)) {

1219 
	`mem£t
(
quÆ
, 255, 
¸
->
Àn
);

1222 i‡(
¸
->
¸am_Êags
 & 
CRAM_FLAG_NO_SEQ
)

1223 
decode_md
 = 
decode_nm
 = 0;

1225 i‡(
decode_md
) {

1226 
‹ig_aux
 = 
	`BLOCK_SIZE
(
s
->
aux_blk
);

1227 
	`BLOCK_APPEND
(
s
->
aux_blk
, "MDZ", 3);

1230 i‡(
ds
 & 
CRAM_FN
) {

1231 i‡(!
c
->
comp_hdr
->
codecs
[
DS_FN
])  -1;

1232 
r
 |
c
->
comp_hdr
->
codecs
[
DS_FN
]->
	`decode
(
s
,c->comp_hdr->codecs[DS_FN],

1233 
blk
, (*)&
‚
, &
out_sz
);

1234 i‡(
r
) Ñ;

1236 
‚
 = 0;

1239 
ªf_pos
--;

1240 
¸
->
cig¨
 = 
ncig¨
;

1242 i‡(!(
ds
 & (
CRAM_FC
 | 
CRAM_FP
)))

1243 
skù_cig¨
;

1245 
f
 = 0; f < 
‚
; f++) {

1246 
öt32_t
 
pos
 = 0;

1247 
›
;

1249 i‡(
ncig¨
+2 >
cig¨_Æloc
) {

1250 
cig¨_Æloc
 = cigar_alloc ? cigar_alloc*2 : 1024;

1251 
s
->
cig¨
 = cigar;

1252 i‡(!(
cig¨
 = 
	`ªÆloc
(cig¨, 
cig¨_Æloc
 * (*cigar))))

1256 i‡(
ds
 & 
CRAM_FC
) {

1257 i‡(!
c
->
comp_hdr
->
codecs
[
DS_FC
])  -1;

1258 
r
 |
c
->
comp_hdr
->
codecs
[
DS_FC
]->
	`decode
(
s
,

1259 
c
->
comp_hdr
->
codecs
[
DS_FC
],

1260 
blk
,

1261 &
›
, &
out_sz
);

1262 i‡(
r
) Ñ;

1265 i‡(!(
ds
 & 
CRAM_FP
))

1268 i‡(!
c
->
comp_hdr
->
codecs
[
DS_FP
])  -1;

1269 
r
 |
c
->
comp_hdr
->
codecs
[
DS_FP
]->
	`decode
(
s
,

1270 
c
->
comp_hdr
->
codecs
[
DS_FP
],

1271 
blk
,

1272 (*)&
pos
, &
out_sz
);

1273 i‡(
r
) Ñ;

1274 
pos
 +
¥ev_pos
;

1276 i‡(
pos
 <= 0) {

1277 
	`Ârötf
(
°dîr
, "Error: featureÖosition %d before start ofÑead.\n",

1278 
pos
);

1282 i‡(
pos
 > 
£q_pos
) {

1283 i‡(
pos
 > 
¸
->
Àn
+1)

1286 i‡(
s
->
ªf
 && 
¸
->
ªf_id
 >= 0) {

1287 i‡(
ªf_pos
 + 
pos
 - 
£q_pos
 > 
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
) {

1288 
whöged
 = 0;

1289 
æí
;

1290 i‡(!
whöged
)

1291 
	`Ârötf
(
°dîr
, "RefÖos outside ofÑef "

1293 
whöged
 = 1;

1294 
æí
 = 
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 - 
ªf_pos
;

1297 i‡(
æí
 > 0) {

1298 
	`mem˝y
(&
£q
[
£q_pos
-1],

1299 &
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 +1], 
æí
);

1300 i‡((
pos
 - 
£q_pos
Ë- 
æí
 > 0)

1301 
	`mem£t
(&
£q
[
£q_pos
-1+
æí
], 'N',

1302 (
pos
 - 
£q_pos
Ë- 
æí
);

1304 
	`mem£t
(&
£q
[
£q_pos
-1], 'N', 
¸
->
Àn
 - seq_pos + 1);

1306 i‡(
md_di°
 >= 0)

1307 
md_di°
 +
pos
 - 
£q_pos
;

1310 i‡(
decode_md
 || 
decode_nm
) {

1311 
i
;

1312 
i
 = 0; i < 
pos
 - 
£q_pos
; i++) {

1314 
ba£
 = 
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 + 1 + 
i
];

1315 i‡(
ba£
 == 'N') {

1316 
	`add_md_ch¨
(
s
, 
decode_md
,

1317 
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 + 1 + 
i
],

1318 &
md_di°
);

1319 
nm
++;

1321 
md_di°
++;

1323 
£q
[
£q_pos
-1+
i
] = 
ba£
;

1326 
	`mem˝y
(&
£q
[
£q_pos
-1], &
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 +1],

1327 
pos
 - 
£q_pos
);

1331 #ifde‡
USE_X


1332 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CBASE_MATCH
) {

1333 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1334 
cig_Àn
 = 0;

1336 
cig_›
 = 
BAM_CBASE_MATCH
;

1338 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CMATCH
) {

1339 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1340 
cig_Àn
 = 0;

1342 
cig_›
 = 
BAM_CMATCH
;

1344 
cig_Àn
 +
pos
 - 
£q_pos
;

1345 
ªf_pos
 +
pos
 - 
£q_pos
;

1346 
£q_pos
 = 
pos
;

1349 
¥ev_pos
 = 
pos
;

1351 i‡(!(
ds
 & 
CRAM_FC
))

1352 
skù_cig¨
;

1354 
›
) {

1356 
öt32_t
 
out_sz2
 = 1;

1357 
have_sc
 = 0;

1359 i‡(
cig_Àn
) {

1360 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1361 
cig_Àn
 = 0;

1363 
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
)) {

1365 i‡(
ds
 & 
CRAM_IN
) {

1366 
r
 |
c
->
comp_hdr
->
codecs
[
DS_IN
]

1367 ? 
c
->
comp_hdr
->
codecs
[
DS_IN
]

1368 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_IN
],

1369 
blk
,

1370 
¸
->
Àn
 ? &
£q
[
pos
-1] : 
NULL
,

1371 &
out_sz2
)

1372 : (
£q
[
pos
-1] = 'N', 
out_sz2
 = 1, 0);

1373 
have_sc
 = 1;

1378 i‡(
ds
 & 
CRAM_SC
) {

1379 
r
 |
c
->
comp_hdr
->
codecs
[
DS_SC
]

1380 ? 
c
->
comp_hdr
->
codecs
[
DS_SC
]

1381 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_SC
],

1382 
blk
,

1383 
¸
->
Àn
 ? &
£q
[
pos
-1] : 
NULL
,

1384 &
out_sz2
)

1385 : (
£q
[
pos
-1] = 'N', 
out_sz2
 = 1, 0);

1386 
have_sc
 = 1;

1397 i‡(
have_sc
) {

1398 i‡(
r
) Ñ;

1399 
cig¨
[
ncig¨
++] = (
out_sz2
<<4Ë+ 
BAM_CSOFT_CLIP
;

1400 
cig_›
 = 
BAM_CSOFT_CLIP
;

1401 
£q_pos
 +
out_sz2
;

1407 
ba£
;

1408 #ifde‡
USE_X


1409 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CBASE_MISMATCH
) {

1410 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1411 
cig_Àn
 = 0;

1413 i‡(
ds
 & 
CRAM_BS
) {

1414 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BS
])  -1;

1415 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BS
]

1416 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BS
], 
blk
,

1417 (*)&
ba£
, &
out_sz
);

1418 i‡(
pos
-1 < 
¸
->
Àn
)

1419 
£q
[
pos
-1] = 'N';

1421 
cig_›
 = 
BAM_CBASE_MISMATCH
;

1423 
ªf_ba£
;

1424 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CMATCH
) {

1425 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1426 
cig_Àn
 = 0;

1428 i‡(
ds
 & 
CRAM_BS
) {

1429 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BS
])  -1;

1430 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BS
]

1431 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BS
], 
blk
,

1432 (*)&
ba£
, &
out_sz
);

1433 i‡(
r
)  -1;

1434 i‡(
ªf_pos
 >
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 || !
s
->ref) {

1435 i‡(
pos
-1 < 
¸
->
Àn
)

1436 
£q
[
pos
-1] = 
c
->
comp_hdr
->

1437 
sub°ôuti⁄_m©rix
[
fd
->
L1
['N']][
ba£
];

1438 i‡(
decode_md
 || 
decode_nm
) {

1439 i‡(
md_di°
 >0 && 
decode_md
)

1440 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 
md_di°
);

1441 
md_di°
 = -1;

1442 
nm
--;

1445 
ªf_ˇŒ
 = 
ªf_pos
 <
s
->
ªf_íd


1446 ? (
uc
)
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 +1]

1448 
ªf_ba£
 = 
fd
->
L1
[
ªf_ˇŒ
];

1449 i‡(
pos
-1 < 
¸
->
Àn
)

1450 
£q
[
pos
-1] = 
c
->
comp_hdr
->

1451 
sub°ôuti⁄_m©rix
[
ªf_ba£
][
ba£
];

1452 
	`add_md_ch¨
(
s
, 
decode_md
, 
ªf_ˇŒ
, &
md_di°
);

1455 
cig_›
 = 
BAM_CMATCH
;

1457 
nm
++;

1458 
cig_Àn
++;

1459 
£q_pos
++;

1460 
ªf_pos
++;

1465 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CDEL
) {

1466 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1467 
cig_Àn
 = 0;

1469 i‡(
ds
 & 
CRAM_DL
) {

1470 i‡(!
c
->
comp_hdr
->
codecs
[
DS_DL
])  -1;

1471 
r
 |
c
->
comp_hdr
->
codecs
[
DS_DL
]

1472 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_DL
], 
blk
,

1473 (*)&
i32
, &
out_sz
);

1474 i‡(
r
) Ñ;

1475 i‡(
decode_md
 || 
decode_nm
) {

1476 i‡(
md_di°
 >0 && 
decode_md
)

1477 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 
md_di°
);

1478 i‡(
ªf_pos
 + 
i32
 <
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
) {

1479 i‡(
decode_md
) {

1480 
	`BLOCK_APPEND_CHAR
(
s
->
aux_blk
, '^');

1481 
	`BLOCK_APPEND
(
s
->
aux_blk
,

1482 &
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 +1],

1483 
i32
);

1484 
md_di°
 = 0;

1486 
nm
 +
i32
;

1488 
uöt32_t
 
dÀn
;

1489 i‡(
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 >
ªf_pos
) {

1490 i‡(
decode_md
) {

1491 
	`BLOCK_APPEND_CHAR
(
s
->
aux_blk
, '^');

1492 
	`BLOCK_APPEND
(
s
->
aux_blk
,

1493 &
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
+1],

1494 
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
-
ªf_pos
);

1495 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 0);

1497 
dÀn
 = 
i32
 - (
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 - 
ªf_pos
);

1498 
nm
 +
i32
 - 
dÀn
;

1500 
dÀn
 = 
i32
;

1503 
md_di°
 = -1;

1506 
cig_›
 = 
BAM_CDEL
;

1507 
cig_Àn
 +
i32
;

1508 
ªf_pos
 +
i32
;

1515 
öt32_t
 
out_sz2
 = 1;

1517 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CINS
) {

1518 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1519 
cig_Àn
 = 0;

1522 i‡(
ds
 & 
CRAM_IN
) {

1523 i‡(!
c
->
comp_hdr
->
codecs
[
DS_IN
])  -1;

1524 
r
 |
c
->
comp_hdr
->
codecs
[
DS_IN
]

1525 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_IN
], 
blk
,

1526 
¸
->
Àn
 ? &
£q
[
pos
-1] : 
NULL
,

1527 &
out_sz2
);

1528 i‡(
r
) Ñ;

1529 
cig_›
 = 
BAM_CINS
;

1530 
cig_Àn
 +
out_sz2
;

1531 
£q_pos
 +
out_sz2
;

1532 
nm
 +
out_sz2
;

1539 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CINS
) {

1540 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1541 
cig_Àn
 = 0;

1543 i‡(
ds
 & 
CRAM_BA
) {

1544 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BA
])  -1;

1545 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BA
]

1546 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BA
], 
blk
,

1547 
¸
->
Àn
 ? &
£q
[
pos
-1] : 
NULL
,

1548 &
out_sz
);

1549 i‡(
r
) Ñ;

1551 
cig_›
 = 
BAM_CINS
;

1552 
cig_Àn
++;

1553 
£q_pos
++;

1554 
nm
++;

1559 
öt32_t
 
Àn
 = 1;

1561 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CMATCH
) {

1562 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1563 
cig_Àn
 = 0;

1566 i‡(
ds
 & 
CRAM_BB
) {

1567 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BB
])  -1;

1568 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BB
]

1569 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BB
], 
blk
,

1570 
¸
->
Àn
 ? &
£q
[
pos
-1] : 
NULL
,

1571 &
Àn
);

1572 i‡(
r
) Ñ;

1574 i‡(
decode_md
 || 
decode_nm
) {

1575 
x
;

1576 i‡(
md_di°
 >0 && 
decode_md
)

1577 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 
md_di°
);

1579 
x
 = 0; x < 
Àn
; x++) {

1580 i‡(
x
 && 
decode_md
)

1581 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 0);

1582 i‡(
ªf_pos
+
x
 >
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 || !
s
->ref) {

1583 
md_di°
 = -1;

1586 i‡(
decode_md
) {

1587 
r
 = 
s
->
ªf
[
ªf_pos
+
x
-s->
ªf_°¨t
 +1];

1588 
	`BLOCK_APPEND_CHAR
(
s
->
aux_blk
, 
r
);

1593 
nm
 +
x
;

1597 
cig_›
 = 
BAM_CMATCH
;

1599 
cig_Àn
+=
Àn
;

1600 
£q_pos
+=
Àn
;

1601 
ªf_pos
+=
Àn
;

1607 
öt32_t
 
Àn
 = 1;

1609 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CMATCH
) {

1610 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1611 
cig_Àn
 = 0;

1614 i‡(
ds
 & 
CRAM_QQ
) {

1615 i‡(!
c
->
comp_hdr
->
codecs
[
DS_QQ
])  -1;

1616 
r
 |
c
->
comp_hdr
->
codecs
[
DS_QQ
]

1617 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_QQ
], 
blk
,

1618 (*)&
quÆ
[
pos
-1], &
Àn
);

1619 i‡(
r
) Ñ;

1622 
cig_›
 = 
BAM_CMATCH
;

1624 
cig_Àn
+=
Àn
;

1625 
£q_pos
+=
Àn
;

1626 
ªf_pos
+=
Àn
;

1632 #ifde‡
USE_X


1633 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CBASE_MISMATCH
) {

1634 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1635 
cig_Àn
 = 0;

1638 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CMATCH
) {

1639 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1640 
cig_Àn
 = 0;

1643 i‡(
ds
 & 
CRAM_BA
) {

1644 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BA
])  -1;

1645 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BA
]

1646 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BA
], 
blk
,

1647 
¸
->
Àn
 ? &
£q
[
pos
-1] : 
NULL
,

1648 &
out_sz
);

1650 i‡(
decode_md
 || 
decode_nm
) {

1651 i‡(
md_di°
 >0 && 
decode_md
)

1652 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 
md_di°
);

1653 i‡(
ªf_pos
 >
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 || !
s
->ref) {

1654 
md_di°
 = -1;

1656 i‡(
decode_md
)

1657 
	`BLOCK_APPEND_CHAR
(
s
->
aux_blk
,

1658 
s
->
ªf
[
ªf_pos
-s->
ªf_°¨t
 +1]);

1659 
nm
++;

1660 
md_di°
 = 0;

1664 i‡(
ds
 & 
CRAM_QS
) {

1665 i‡(!
c
->
comp_hdr
->
codecs
[
DS_QS
])  -1;

1666 
r
 |
c
->
comp_hdr
->
codecs
[
DS_QS
]

1667 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_QS
], 
blk
,

1668 (*)&
quÆ
[
pos
-1], &
out_sz
);

1670 #ifde‡
USE_X


1671 
cig_›
 = 
BAM_CBASE_MISMATCH
;

1673 
cig_›
 = 
BAM_CMATCH
;

1675 
cig_Àn
++;

1676 
£q_pos
++;

1677 
ªf_pos
++;

1683 i‡(
ds
 & 
CRAM_QS
) {

1684 i‡(!
c
->
comp_hdr
->
codecs
[
DS_QS
])  -1;

1685 
r
 |
c
->
comp_hdr
->
codecs
[
DS_QS
]

1686 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_QS
], 
blk
,

1687 (*)&
quÆ
[
pos
-1], &
out_sz
);

1694 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CHARD_CLIP
) {

1695 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1696 
cig_Àn
 = 0;

1698 i‡(
ds
 & 
CRAM_HC
) {

1699 i‡(!
c
->
comp_hdr
->
codecs
[
DS_HC
])  -1;

1700 
r
 |
c
->
comp_hdr
->
codecs
[
DS_HC
]

1701 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_HC
], 
blk
,

1702 (*)&
i32
, &
out_sz
);

1703 i‡(
r
) Ñ;

1704 
cig_›
 = 
BAM_CHARD_CLIP
;

1705 
cig_Àn
 +
i32
;

1711 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CPAD
) {

1712 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1713 
cig_Àn
 = 0;

1715 i‡(
ds
 & 
CRAM_PD
) {

1716 i‡(!
c
->
comp_hdr
->
codecs
[
DS_PD
])  -1;

1717 
r
 |
c
->
comp_hdr
->
codecs
[
DS_PD
]

1718 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_PD
], 
blk
,

1719 (*)&
i32
, &
out_sz
);

1720 i‡(
r
) Ñ;

1721 
cig_›
 = 
BAM_CPAD
;

1722 
cig_Àn
 +
i32
;

1728 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CREF_SKIP
) {

1729 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1730 
cig_Àn
 = 0;

1732 i‡(
ds
 & 
CRAM_RS
) {

1733 i‡(!
c
->
comp_hdr
->
codecs
[
DS_RS
])  -1;

1734 
r
 |
c
->
comp_hdr
->
codecs
[
DS_RS
]

1735 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_RS
], 
blk
,

1736 (*)&
i32
, &
out_sz
);

1737 i‡(
r
) Ñ;

1738 
cig_›
 = 
BAM_CREF_SKIP
;

1739 
cig_Àn
 +
i32
;

1740 
ªf_pos
 +
i32
;

1746 
	`Ârötf
(
°dîr
, "Eº‹: Unknow¿„©uª codê'%c'\n", 
›
);

1751 i‡(!(
ds
 & 
CRAM_FC
))

1752 
skù_cig¨
;

1755 i‡((
ds
 & 
CRAM_FN
Ë&& 
¸
->
Àn
 >
£q_pos
) {

1756 i‡(
s
->
ªf
) {

1757 i‡(
ªf_pos
 + 
¸
->
Àn
 - 
£q_pos
 + 1 > 
bfd
->
ªf
[¸->
ªf_id
].len) {

1758 
whöged
 = 0;

1759 
æí
;

1760 i‡(!
whöged
)

1761 
	`Ârötf
(
°dîr
, "RefÖos outside ofÑef sequence boundary\n");

1762 
whöged
 = 1;

1763 
æí
 = 
bfd
->
ªf
[
¸
->
ªf_id
].
Àn
 - 
ªf_pos
;

1766 i‡(
æí
 > 0) {

1767 i‡(
£q_pos
-1 + 
æí
 < 
¸
->
Àn
)

1768 
	`mem˝y
(&
£q
[
£q_pos
-1],

1769 &
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 +1], 
æí
);

1770 i‡((
¸
->
Àn
 - 
£q_pos
 + 1Ë- 
æí
 > 0)

1771 
	`mem£t
(&
£q
[
£q_pos
-1+
æí
], 'N',

1772 (
¸
->
Àn
 - 
£q_pos
 + 1Ë- 
æí
);

1774 i‡(
¸
->
Àn
 - 
£q_pos
 + 1 > 0)

1775 
	`mem£t
(&
£q
[
£q_pos
-1], 'N', 
¸
->
Àn
 - seq_pos + 1);

1777 i‡(
md_di°
 >= 0)

1778 
md_di°
 +
¸
->
Àn
 - 
£q_pos
 + 1;

1780 i‡(
¸
->
Àn
 - 
£q_pos
 + 1 > 0) {

1781 i‡(
decode_md
 || 
decode_nm
) {

1782 
i
;

1783 
i
 = 0; i < 
¸
->
Àn
 - 
£q_pos
 + 1; i++) {

1785 
ba£
 = 
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 + 1 + 
i
];

1786 i‡(
ba£
 == 'N') {

1787 
	`add_md_ch¨
(
s
, 
decode_md
,

1788 
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 + 1 + 
i
],

1789 &
md_di°
);

1790 
nm
++;

1792 
md_di°
++;

1794 
£q
[
£q_pos
-1+
i
] = 
ba£
;

1797 
	`mem˝y
(&
£q
[
£q_pos
-1], &
s
->
ªf
[
ªf_pos
 - s->
ªf_°¨t
 +1],

1798 
¸
->
Àn
 - 
£q_pos
 + 1);

1801 
ªf_pos
 +
¸
->
Àn
 - 
£q_pos
 + 1;

1805 i‡(
ncig¨
+1 >
cig¨_Æloc
) {

1806 
cig¨_Æloc
 = cigar_alloc ? cigar_alloc*2 : 1024;

1807 
s
->
cig¨
 = cigar;

1808 i‡(!(
cig¨
 = 
	`ªÆloc
(cig¨, 
cig¨_Æloc
 * (*cigar))))

1811 #ifde‡
USE_X


1812 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CBASE_MATCH
) {

1813 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1814 
cig_Àn
 = 0;

1816 
cig_›
 = 
BAM_CBASE_MATCH
;

1818 i‡(
cig_Àn
 && 
cig_›
 !
BAM_CMATCH
) {

1819 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1820 
cig_Àn
 = 0;

1822 
cig_›
 = 
BAM_CMATCH
;

1824 
cig_Àn
 +
¸
->
Àn
 - 
£q_pos
+1;

1827 
skù_cig¨
:

1829 i‡((
ds
 & 
CRAM_FN
Ë&& 
decode_md
) {

1830 i‡(
md_di°
 >= 0)

1831 
	`BLOCK_APPEND_UINT
(
s
->
aux_blk
, 
md_di°
);

1834 i‡(
cig_Àn
) {

1835 i‡(
ncig¨
 >
cig¨_Æloc
) {

1836 
cig¨_Æloc
 = cigar_alloc ? cigar_alloc*2 : 1024;

1837 
s
->
cig¨
 = cigar;

1838 i‡(!(
cig¨
 = 
	`ªÆloc
(cig¨, 
cig¨_Æloc
 * (*cigar))))

1842 
cig¨
[
ncig¨
++] = (
cig_Àn
<<4Ë+ 
cig_›
;

1845 
¸
->
ncig¨
 =Çcig¨ - cr->
cig¨
;

1846 
¸
->
´nd
 = 
ªf_pos
;

1850 i‡(
ds
 & 
CRAM_MQ
) {

1851 i‡(!
c
->
comp_hdr
->
codecs
[
DS_MQ
])  -1;

1852 
r
 |
c
->
comp_hdr
->
codecs
[
DS_MQ
]

1853 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_MQ
], 
blk
,

1854 (*)&
¸
->
mquÆ
, &
out_sz
);

1856 
¸
->
mquÆ
 = 40;

1859 i‡((
ds
 & 
CRAM_QS
Ë&& (
cf
 & 
CRAM_FLAG_PRESERVE_QUAL_SCORES
)) {

1860 
öt32_t
 
out_sz2
 = 
¸
->
Àn
;

1862 i‡(
ds
 & 
CRAM_QS
) {

1863 i‡(!
c
->
comp_hdr
->
codecs
[
DS_QS
])  -1;

1864 
r
 |
c
->
comp_hdr
->
codecs
[
DS_QS
]

1865 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_QS
], 
blk
,

1866 
quÆ
, &
out_sz2
);

1870 
s
->
cig¨
 = cigar;

1871 
s
->
cig¨_Æloc
 = cigar_alloc;

1872 
s
->
ncig¨
 =Çcigar;

1874 i‡(
¸
->
¸am_Êags
 & 
CRAM_FLAG_NO_SEQ
)

1875 
¸
->
Àn
 = 0;

1877 i‡(
decode_md
) {

1878 
	`BLOCK_APPEND_CHAR
(
s
->
aux_blk
, '\0');

1879 
¸
->
aux_size
 +
	`BLOCK_SIZE
(
s
->
aux_blk
Ë- 
‹ig_aux
;

1882 i‡(
decode_nm
) {

1883 
buf
[7];

1884 
buf
[0] = 'N'; buf[1] = 'M'; buf[2] = 'I';

1885 
buf
[3] = (
nm
>> 0) & 0xff;

1886 
buf
[4] = (
nm
>> 8) & 0xff;

1887 
buf
[5] = (
nm
>>16) & 0xff;

1888 
buf
[6] = (
nm
>>24) & 0xff;

1889 
	`BLOCK_APPEND
(
s
->
aux_blk
, 
buf
, 7);

1890 
¸
->
aux_size
 += 7;

1893  
r
;

1894 
	}
}

1899 
¸am_m≠
 *
	$m≠_föd
(
¸am_m≠
 **
m≠
, *
key
, 
id
) {

1900 
¸am_m≠
 *
m
;

1902 
m
 = 
m≠
[
	`CRAM_MAP
(
key
[0],key[1])];

1903 
m
 && m->
key
 !
id
)

1904 
m
m->
√xt
;

1906  
m
;

1907 
	}
}

1912 
	$¸am_decode_aux_1_0
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

1913 
¸am_block
 *
blk
, 
¸am_ªc‹d
 *
¸
) {

1914 
i
, 
r
 = 0, 
out_sz
 = 1;

1915 
¡ags
;

1917 i‡(!
c
->
comp_hdr
->
codecs
[
DS_TC
])  -1;

1918 
r
 |
c
->
comp_hdr
->
codecs
[
DS_TC
]->
	`decode
(
s
, c->comp_hdr->codecs[DS_TC], 
blk
,

1919 (*)&
¡ags
, &
out_sz
);

1920 
¸
->
¡ags
 =Çtags;

1923 
¸
->
aux_size
 = 0;

1924 
¸
->
aux
 = 
	`BLOCK_SIZE
(
s
->
aux_blk
);

1926 
i
 = 0; i < 
¸
->
¡ags
; i++) {

1927 
öt32_t
 
id
, 
out_sz
 = 1;

1928 
èg_d©a
[3];

1929 
¸am_m≠
 *
m
;

1932 i‡(!
c
->
comp_hdr
->
codecs
[
DS_TN
])  -1;

1933 
r
 |
c
->
comp_hdr
->
codecs
[
DS_TN
]->
	`decode
(
s
, c->comp_hdr->codecs[DS_TN],

1934 
blk
, (*)&
id
, &
out_sz
);

1935 i‡(
out_sz
 == 3) {

1936 
èg_d©a
[0] = ((*)&
id
)[0];

1937 
èg_d©a
[1] = ((*)&
id
)[1];

1938 
èg_d©a
[2] = ((*)&
id
)[2];

1940 
èg_d©a
[0] = (
id
>>16) & 0xff;

1941 
èg_d©a
[1] = (
id
>>8) & 0xff;

1942 
èg_d©a
[2] = 
id
 & 0xff;

1945 
m
 = 
	`m≠_föd
(
c
->
comp_hdr
->
èg_ícodög_m≠
, 
èg_d©a
, 
id
);

1946 i‡(!
m
)

1948 
	`BLOCK_APPEND
(
s
->
aux_blk
, (*)
èg_d©a
, 3);

1950 i‡(!
m
->
codec
)  -1;

1951 
r
 |
m
->
codec
->
	`decode
(
s
, m->codec, 
blk
, (*)s->
aux_blk
, &
out_sz
);

1953 
¸
->
aux_size
 +
out_sz
 + 3;

1956  
r
;

1957 
	}
}

1959 
	$¸am_decode_aux
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

1960 
¸am_block
 *
blk
, 
¸am_ªc‹d
 *
¸
,

1961 *
has_MD
, *
has_NM
) {

1962 
i
, 
r
 = 0, 
out_sz
 = 1;

1963 
öt32_t
 
TL
 = 0;

1964 *
TN
;

1965 
uöt32_t
 
ds
 = 
c
->
comp_hdr
->
d©a_£rõs
;

1967 i‡(!(
ds
 & (
CRAM_TL
|
CRAM_aux
))) {

1968 
¸
->
aux
 = 0;

1969 
¸
->
aux_size
 = 0;

1973 i‡(!
c
->
comp_hdr
->
codecs
[
DS_TL
])  -1;

1974 
r
 |
c
->
comp_hdr
->
codecs
[
DS_TL
]->
	`decode
(
s
, c->comp_hdr->codecs[DS_TL], 
blk
,

1975 (*)&
TL
, &
out_sz
);

1976 i‡(
r
 || 
TL
 < 0 || TL >
c
->
comp_hdr
->
nTL
)

1979 
TN
 = 
c
->
comp_hdr
->
TL
[TL];

1980 
¸
->
¡ags
 = 
	`°æí
((*)
TN
)/3;

1983 
¸
->
aux_size
 = 0;

1984 
¸
->
aux
 = 
	`BLOCK_SIZE
(
s
->
aux_blk
);

1986 i‡(!(
ds
 & 
CRAM_aux
))

1989 
i
 = 0; i < 
¸
->
¡ags
; i++) {

1990 
öt32_t
 
id
, 
out_sz
 = 1;

1991 
èg_d©a
[3];

1992 
¸am_m≠
 *
m
;

1994 i‡(
TN
[0] ='M' && TN[1] ='D' && 
has_MD
)

1995 *
has_MD
 = 1;

1996 i‡(
TN
[0] ='N' && TN[1] ='M' && 
has_NM
)

1997 *
has_NM
 = 1;

2000 
èg_d©a
[0] = *
TN
++;

2001 
èg_d©a
[1] = *
TN
++;

2002 
èg_d©a
[2] = *
TN
++;

2003 
id
 = (
èg_d©a
[0]<<16) | (tag_data[1]<<8) |Åag_data[2];

2005 
m
 = 
	`m≠_föd
(
c
->
comp_hdr
->
èg_ícodög_m≠
, 
èg_d©a
, 
id
);

2006 i‡(!
m
)

2008 
	`BLOCK_APPEND
(
s
->
aux_blk
, (*)
èg_d©a
, 3);

2010 i‡(!
m
->
codec
)  -1;

2011 
r
 |
m
->
codec
->
	`decode
(
s
, m->codec, 
blk
, (*)s->
aux_blk
, &
out_sz
);

2012 i‡(
r
) ;

2013 
¸
->
aux_size
 +
out_sz
 + 3;

2016  
r
;

2017 
	}
}

2020 
	$¸am_decode_¶i˚_xªf
(
¸am_¶i˚
 *
s
, 
ªquúed_fõlds
) {

2021 
ªc
;

2023 i‡(!(
ªquúed_fõlds
 & (
SAM_RNEXT
 | 
SAM_PNEXT
 | 
SAM_TLEN
))) {

2024 
ªc
 = 0;Ñe¯< 
s
->
hdr
->
num_ªc‹ds
;Ñec++) {

2025 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
ªc
];

2027 
¸
->
éí
 = 0;

2028 
¸
->
m©e_pos
 = 0;

2029 
¸
->
m©e_ªf_id
 = -1;

2035 
ªc
 = 0;Ñe¯< 
s
->
hdr
->
num_ªc‹ds
;Ñec++) {

2036 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
ªc
];

2038 i‡(
¸
->
m©e_löe
 >= 0) {

2039 i‡(
¸
->
m©e_löe
 < 
s
->
hdr
->
num_ªc‹ds
) {

2053 i‡(
¸
->
éí
 =
INT_MIN
) {

2054 
id1
 = 
ªc
, 
id2
 =Ñec;

2055 
Æe·
 = 
¸
->
≠os
, 
¨ight
 = cr->
´nd
;

2056 
éí
;

2057 
ªf
 = 
¸
->
ªf_id
;

2060 
À·_˙t
 = 0;

2063 i‡(
Æe·
 > 
s
->
¸ecs
[
id2
].
≠os
)

2064 
Æe·
 = 
s
->
¸ecs
[
id2
].
≠os
, 
À·_˙t
 = 1;

2065 i‡(
Æe·
 =
s
->
¸ecs
[
id2
].
≠os
)

2066 
À·_˙t
++;

2067 i‡(
¨ight
 < 
s
->
¸ecs
[
id2
].
´nd
)

2068 
¨ight
 = 
s
->
¸ecs
[
id2
].
´nd
;

2069 i‡(
s
->
¸ecs
[
id2
].
m©e_löe
 == -1) {

2070 
s
->
¸ecs
[
id2
].
m©e_löe
 = 
ªc
;

2073 i‡(
s
->
¸ecs
[
id2
].
m©e_löe
 <= id2 ||

2074 
s
->
¸ecs
[
id2
].
m©e_löe
 >s->
hdr
->
num_ªc‹ds
)

2076 
id2
 = 
s
->
¸ecs
[id2].
m©e_löe
;

2078 i‡(
s
->
¸ecs
[
id2
].
ªf_id
 !
ªf
)

2079 
ªf
 = -1;

2080 } 
id2
 !
id1
);

2082 i‡(
ªf
 != -1) {

2083 
éí
 = 
¨ight
 - 
Æe·
 + 1;

2084 
id1
 = 
id2
 = 
ªc
;

2091 i‡(
s
->
¸ecs
[
id2
].
≠os
 =
Æe·
) {

2092 i‡(
À·_˙t
 == 1 ||

2093 (
s
->
¸ecs
[
id2
].
Êags
 & 
BAM_FREAD1
))

2094 
s
->
¸ecs
[
id2
].
éí
 =Ålen;

2096 
s
->
¸ecs
[
id2
].
éí
 = -tlen;

2098 
s
->
¸ecs
[
id2
].
éí
 = -tlen;

2101 
id2
 = 
s
->
¸ecs
[id2].
m©e_löe
;

2102 
id2
 !
id1
) {

2103 i‡(
s
->
¸ecs
[
id2
].
≠os
 =
Æe·
) {

2104 i‡(
À·_˙t
 == 1 ||

2105 (
s
->
¸ecs
[
id2
].
Êags
 & 
BAM_FREAD1
))

2106 
s
->
¸ecs
[
id2
].
éí
 =Ålen;

2108 
s
->
¸ecs
[
id2
].
éí
 = -tlen;

2110 
s
->
¸ecs
[
id2
].
éí
 = -tlen;

2112 
id2
 = 
s
->
¸ecs
[id2].
m©e_löe
;

2115 
id1
 = 
id2
 = 
ªc
;

2117 
s
->
¸ecs
[
id2
].
éí
 = 0;

2118 
id2
 = 
s
->
¸ecs
[id2].
m©e_löe
;

2119 
id2
 !
id1
) {

2120 
s
->
¸ecs
[
id2
].
éí
 = 0;

2121 
id2
 = 
s
->
¸ecs
[id2].
m©e_löe
;

2126 
¸
->
m©e_pos
 = 
s
->
¸ecs
[¸->
m©e_löe
].
≠os
;

2127 
¸
->
m©e_ªf_id
 = 
s
->
¸ecs
[¸->
m©e_löe
].
ªf_id
;

2130 
¸
->
Êags
 |
BAM_FPAIRED
;

2133 i‡(
s
->
¸ecs
[
¸
->
m©e_löe
].
Êags
 & 
BAM_FUNMAP
) {

2134 
¸
->
Êags
 |
BAM_FMUNMAP
;

2135 
¸
->
éí
 = 0;

2137 i‡(
¸
->
Êags
 & 
BAM_FUNMAP
) {

2138 
¸
->
éí
 = 0;

2142 i‡(
s
->
¸ecs
[
¸
->
m©e_löe
].
Êags
 & 
BAM_FREVERSE
)

2143 
¸
->
Êags
 |
BAM_FMREVERSE
;

2145 
	`Ârötf
(
°dîr
, "MateÜine out of bounds: %d vs [0, %d]\n",

2146 
¸
->
m©e_löe
, 
s
->
hdr
->
num_ªc‹ds
-1);

2151 i‡(
¸
->
m©e_Êags
 & 
CRAM_M_REVERSE
) {

2152 
¸
->
Êags
 |
BAM_FPAIRED
 | 
BAM_FMREVERSE
;

2154 i‡(
¸
->
m©e_Êags
 & 
CRAM_M_UNMAP
) {

2155 
¸
->
Êags
 |
BAM_FMUNMAP
;

2158 i‡(!(
¸
->
Êags
 & 
BAM_FPAIRED
))

2159 
¸
->
m©e_ªf_id
 = -1;

2162 i‡(
¸
->
éí
 =
INT_MIN
)

2163 
¸
->
éí
 = 0;

2166 
	}
}

2168 *
	$md5_¥öt
(*
md5
, *
out
) {

2169 
i
;

2170 
i
 = 0; i < 16; i++) {

2171 
out
[
i
*2+0] = "0123456789abcdef"[
md5
[i]>>4];

2172 
out
[
i
*2+1] = "0123456789abcdef"[
md5
[i]&15];

2174 
out
[32] = 0;

2176  
out
;

2177 
	}
}

2179 
	$ª£t_Æl_codecs
(
¸am_block_com¥essi⁄_hdr
 *
hdr
) {

2180 
i
;

2182 
i
 = 0; i < 
DS_END
; i++) {

2183 i‡(
hdr
->
codecs
[
i
] && hdr->codecs[i]->
ª£t
)

2184 
hdr
->
codecs
[
i
]->
	`ª£t
(hdr->codecs[i]);

2187 
i
 = 0; i < 
CRAM_MAP_HASH
; i++) {

2188 
¸am_m≠
 *
m
;

2189 
m
 = 
hdr
->
ªc_ícodög_m≠
[
i
]; m; m = m->
√xt
)

2190 i‡(
m
->
codec
Ëm->codec->
	`ª£t
(m->codec);

2193 
i
 = 0; i < 
CRAM_MAP_HASH
; i++) {

2194 
¸am_m≠
 *
m
;

2195 
m
 = 
hdr
->
èg_ícodög_m≠
[
i
]; m; m = m->
√xt
)

2196 i‡(
m
->
codec
Ëm->codec->
	`ª£t
(m->codec);

2198 
	}
}

2205 
	$¸am_decode_¶i˚
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

2206 
SAM_hdr
 *
bfd
) {

2207 
¸am_block
 *
blk
 = 
s
->
block
[0];

2208 
öt32_t
 
bf
, 
ªf_id
;

2209 
cf
;

2210 
out_sz
, 
r
 = 0;

2211 
ªc
;

2212 *
£q
 = 
NULL
, *
quÆ
 = NULL;

2213 
unknown_rg
 = -1;

2214 
embed_ªf
;

2215 **
ªfs
 = 
NULL
;

2216 
uöt32_t
 
ds
;

2219 
	`ª£t_Æl_codecs
(
c
->
comp_hdr
);

2221 i‡(
	`¸am_dïídít_d©a_£rõs
(
fd
, 
c
->
comp_hdr
, 
s
) != 0)

2224 
ds
 = 
c
->
comp_hdr
->
d©a_£rõs
;

2226 
blk
->
bô
 = 7;

2234 
qsize
, 
nsize
, 
q_id
;

2235 
	`¸am_decode_e°im©e_sizes
(
c
->
comp_hdr
, 
s
, &
qsize
, &
nsize
, &
q_id
);

2238 i‡(
qsize
 && (
ds
 & 
CRAM_RL
)Ë
	`BLOCK_RESIZE_EXACT
(
s
->
£qs_blk
, qsize+1);

2239 i‡(
qsize
 && (
ds
 & 
CRAM_RL
)Ë
	`BLOCK_RESIZE_EXACT
(
s
->
quÆ_blk
, qsize+1);

2240 i‡(
nsize
 && (
ds
 & 
CRAM_NS
)Ë
	`BLOCK_RESIZE_EXACT
(
s
->
«me_blk
,Çsize+1);

2250 i‡(
bfd
->
ƒg
 > 0 &&

2251 
bfd
->
rg
[bfd->
ƒg
-1].
«me
 !
NULL
 &&

2252 !
	`°rcmp
(
bfd
->
rg
[bfd->
ƒg
-1].
«me
, "UNKNOWN"))

2253 
unknown_rg
 = 
bfd
->
ƒg
-1;

2255 i‡(
blk
->
c⁄ã¡_ty≥
 !
CORE
)

2258 i‡(
s
->
¸ecs
)

2259 
	`‰ì
(
s
->
¸ecs
);

2260 i‡(!(
s
->
¸ecs
 = 
	`mÆloc
(s->
hdr
->
num_ªc‹ds
 * (*s->crecs))))

2263 
ªf_id
 = 
s
->
hdr
->
ªf_£q_id
;

2264 
embed_ªf
 = 
s
->
hdr
->
ªf_ba£_id
 >= 0 ? 1 : 0;

2266 i‡(
ªf_id
 >= 0) {

2267 i‡(
embed_ªf
) {

2268 
¸am_block
 *
b
;

2269 i‡(
s
->
hdr
->
ªf_ba£_id
 < 0) {

2270 
	`Ârötf
(
°dîr
, "NoÑeference specifiedánd "

2274 
b
 = 
	`¸am_gë_block_by_id
(
s
, s->
hdr
->
ªf_ba£_id
);

2275 i‡(!
b
)

2277 i‡(
	`¸am_uncom¥ess_block
(
b
) != 0)

2279 
s
->
ªf
 = (*)
	`BLOCK_DATA
(
b
);

2280 
s
->
ªf_°¨t
 = s->
hdr
->
ªf_£q_°¨t
;

2281 
s
->
ªf_íd
 = s->
hdr
->
ªf_£q_°¨t
 + s->hdr->
ªf_£q_•™
-1;

2282 i‡(
s
->
ªf_íd
 - s->
ªf_°¨t
 > 
b
->
uncomp_size
) {

2283 
	`Ârötf
(
°dîr
, "EmbeddedÑeference isÅoo small.\n");

2286 } i‡(!
fd
->
no_ªf
) {

2291 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_SEQ
)

2292 
s
->
ªf
 =

2293 
	`¸am_gë_ªf
(
fd
, 
s
->
hdr
->
ªf_£q_id
,

2294 
s
->
hdr
->
ªf_£q_°¨t
,

2295 
s
->
hdr
->
ªf_£q_°¨t
 + s->hdr->
ªf_£q_•™
 -1);

2296 
s
->
ªf_°¨t
 = s->
hdr
->
ªf_£q_°¨t
;

2297 
s
->
ªf_íd
 = s->
hdr
->
ªf_£q_°¨t
 + s->hdr->
ªf_£q_•™
-1;

2300 i‡(
s
->
ªf_°¨t
 < 0) {

2301 
	`Ârötf
(
°dîr
, "Slice starts before base 1.\n");

2302 
s
->
ªf_°¨t
 = 0;

2304 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

2305 
	`±hªad_muãx_lock
(&
fd
->
ªfs
->
lock
);

2306 i‡((
fd
->
ªquúed_fõlds
 & 
SAM_SEQ
) &&

2307 
ªf_id
 < 
fd
->
ªfs
->
ƒef
 &&

2308 
s
->
ªf_íd
 > 
fd
->
ªfs
->
ªf_id
[ªf_id]->
Àngth
) {

2309 
s
->
ªf_íd
 = 
fd
->
ªfs
->
ªf_id
[ªf_id]->
Àngth
;

2311 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2312 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2316 i‡((
fd
->
ªquúed_fõlds
 & 
SAM_SEQ
) &&

2317 
s
->
ªf
 =
NULL
 && s->
hdr
->
ªf_£q_id
 >0 && !
fd
->
no_ªf
) {

2318 
	`Ârötf
(
°dîr
, "UnableÅo fetchÑeference #%d %d..%d\n",

2319 
s
->
hdr
->
ªf_£q_id
, s->hdr->
ªf_£q_°¨t
,

2320 
s
->
hdr
->
ªf_£q_°¨t
 + s->hdr->
ªf_£q_•™
-1);

2324 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) != 1

2325 && (
fd
->
ªquúed_fõlds
 & 
SAM_SEQ
)

2326 && 
s
->
hdr
->
ªf_£q_id
 >= 0

2327 && !
fd
->
ign‹e_md5


2328 && 
	`memcmp
(
s
->
hdr
->
md5
, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0", 16)) {

2329 
hts_md5_c⁄ãxt
 *
md5
;

2330 
dige°
[16];

2332 i‡(
s
->
ªf
 && s->
hdr
->
ªf_£q_id
 >= 0) {

2333 
°¨t
, 
Àn
;

2335 i‡(
s
->
hdr
->
ªf_£q_°¨t
 >s->
ªf_°¨t
) {

2336 
°¨t
 = 
s
->
hdr
->
ªf_£q_°¨t
 - s->
ªf_°¨t
;

2338 
	`Ârötf
(
°dîr
, "Slice starts before base 1.\n");

2339 
°¨t
 = 0;

2342 i‡(
s
->
hdr
->
ªf_£q_•™
 <s->
ªf_íd
 - s->
ªf_°¨t
 + 1) {

2343 
Àn
 = 
s
->
hdr
->
ªf_£q_•™
;

2345 
	`Ârötf
(
°dîr
, "SliceÉnds beyondÑeferenceÉnd.\n");

2346 
Àn
 = 
s
->
ªf_íd
 - s->
ªf_°¨t
 + 1;

2349 i‡(!(
md5
 = 
	`hts_md5_öô
()))

2351 i‡(
°¨t
 + 
Àn
 > 
s
->
ªf_íd
 - s->
ªf_°¨t
 + 1)

2352 
Àn
 = 
s
->
ªf_íd
 - s->
ªf_°¨t
 + 1 - 
°¨t
;

2353 i‡(
Àn
 >= 0)

2354 
	`hts_md5_upd©e
(
md5
, 
s
->
ªf
 + 
°¨t
, 
Àn
);

2355 
	`hts_md5_föÆ
(
dige°
, 
md5
);

2356 
	`hts_md5_de°roy
(
md5
);

2357 } i‡(!
s
->
ªf
 && s->
hdr
->
ªf_ba£_id
 >= 0) {

2358 
¸am_block
 *
b
 = 
	`¸am_gë_block_by_id
(
s
, s->
hdr
->
ªf_ba£_id
);

2359 i‡(
b
) {

2360 i‡(!(
md5
 = 
	`hts_md5_öô
()))

2362 
	`hts_md5_upd©e
(
md5
, 
b
->
d©a
, b->
uncomp_size
);

2363 
	`hts_md5_föÆ
(
dige°
, 
md5
);

2364 
	`hts_md5_de°roy
(
md5
);

2368 i‡((!
s
->
ªf
 && s->
hdr
->
ªf_ba£_id
 < 0)

2369 || 
	`memcmp
(
dige°
, 
s
->
hdr
->
md5
, 16) != 0) {

2370 
M
[33];

2371 
	`Ârötf
(
°dîr
, "ERROR: md5sumÑeference mismatch forÑef "

2372 "%dÖo†%d..%d\n", 
ªf_id
, 
s
->
ªf_°¨t
, s->
ªf_íd
);

2373 
	`Ârötf
(
°dîr
, "CRAM: %s\n", 
	`md5_¥öt
(
s
->
hdr
->
md5
, 
M
));

2374 
	`Ârötf
(
°dîr
, "Re‡: %s\n", 
	`md5_¥öt
(
dige°
, 
M
));

2379 i‡(
ªf_id
 == -2) {

2380 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

2381 
	`±hªad_muãx_lock
(&
fd
->
ªfs
->
lock
);

2382 
ªfs
 = 
	`ˇŒoc
(
fd
->ªfs->
ƒef
, (*));

2383 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2384 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2385 i‡(!
ªfs
)

2389 
œ°_ªf_id
 = -9;

2390 
ªc
 = 0;Ñe¯< 
s
->
hdr
->
num_ªc‹ds
;Ñec++) {

2391 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
ªc
];

2392 
has_MD
, 
has_NM
;

2396 
¸
->
s
 = s;

2398 
out_sz
 = 1;

2399 i‡(
ds
 & 
CRAM_BF
) {

2400 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BF
])  -1;

2401 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BF
]

2402 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BF
], 
blk
,

2403 (*)&
bf
, &
out_sz
);

2404 i‡(
r
 || 
bf
 < 0 ||

2405 
bf
 >(
fd
->
bam_Êag_sw≠
)/(*fd->bam_flag_swap))

2407 
bf
 = 
fd
->
bam_Êag_sw≠
[bf];

2408 
¸
->
Êags
 = 
bf
;

2410 
¸
->
Êags
 = 
bf
 = 0x4;

2413 i‡(
ds
 & 
CRAM_CF
) {

2414 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2416 i‡(!
c
->
comp_hdr
->
codecs
[
DS_CF
])  -1;

2417 
r
 |
c
->
comp_hdr
->
codecs
[
DS_CF
]

2418 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_CF
], 
blk
,

2419 (*)&
cf
, &
out_sz
);

2420 i‡(
r
)  -1;

2421 
¸
->
¸am_Êags
 = 
cf
;

2423 i‡(!
c
->
comp_hdr
->
codecs
[
DS_CF
])  -1;

2424 
r
 |
c
->
comp_hdr
->
codecs
[
DS_CF
]

2425 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_CF
], 
blk
,

2426 (*)&
¸
->
¸am_Êags
, &
out_sz
);

2427 i‡(
r
)  -1;

2428 
cf
 = 
¸
->
¸am_Êags
;

2431 
cf
 = 
¸
->
¸am_Êags
 = 0;

2434 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
Ë!1 && 
ªf_id
 == -2) {

2435 i‡(
ds
 & 
CRAM_RI
) {

2436 i‡(!
c
->
comp_hdr
->
codecs
[
DS_RI
])  -1;

2437 
r
 |
c
->
comp_hdr
->
codecs
[
DS_RI
]

2438 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_RI
], 
blk
,

2439 (*)&
¸
->
ªf_id
, &
out_sz
);

2440 i‡(
r
)  -1;

2441 i‡((
fd
->
ªquúed_fõlds
 & (
SAM_SEQ
|
SAM_TLEN
))

2442 && 
¸
->
ªf_id
 >= 0

2443 && 
¸
->
ªf_id
 !
œ°_ªf_id
) {

2444 i‡(!
fd
->
no_ªf
) {

2445 i‡(!
ªfs
[
¸
->
ªf_id
])

2446 
ªfs
[
¸
->
ªf_id
] = 
	`¸am_gë_ªf
(
fd
, cr->ref_id,

2448 
s
->
ªf
 = 
ªfs
[
¸
->
ªf_id
];

2450 i‡(!
fd
->
uns‹ãd
 && 
œ°_ªf_id
 >0 && 
ªfs
[last_ref_id]) {

2451 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
œ°_ªf_id
);

2452 
ªfs
[
œ°_ªf_id
] = 
NULL
;

2455 
s
->
ªf_°¨t
 = 1;

2456 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

2457 
	`±hªad_muãx_lock
(&
fd
->
ªfs
->
lock
);

2458 
s
->
ªf_íd
 = 
fd
->
ªfs
->
ªf_id
[
¸
->ªf_id]->
Àngth
;

2459 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2460 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2462 
œ°_ªf_id
 = 
¸
->
ªf_id
;

2465 
¸
->
ªf_id
 = -1;

2468 
¸
->
ªf_id
 =Ñef_id;

2470 i‡(
¸
->
ªf_id
 >
bfd
->
ƒef
) {

2471 
	`Ârötf
(
°dîr
, "Reque°ed unknow¿ª„ªn˚ ID %d\n", 
¸
->
ªf_id
);

2475 i‡(
ds
 & 
CRAM_RL
) {

2476 i‡(!
c
->
comp_hdr
->
codecs
[
DS_RL
])  -1;

2477 
r
 |
c
->
comp_hdr
->
codecs
[
DS_RL
]

2478 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_RL
], 
blk
,

2479 (*)&
¸
->
Àn
, &
out_sz
);

2480 i‡(
r
) Ñ;

2481 i‡(
¸
->
Àn
 < 0) {

2482 
	`Ârötf
(
°dîr
, "Read hasÇegativeÜength\n");

2487 i‡(
ds
 & 
CRAM_AP
) {

2488 i‡(!
c
->
comp_hdr
->
codecs
[
DS_AP
])  -1;

2489 
r
 |
c
->
comp_hdr
->
codecs
[
DS_AP
]

2490 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_AP
], 
blk
,

2491 (*)&
¸
->
≠os
, &
out_sz
);

2492 i‡(
r
) Ñ;

2493 i‡(
c
->
comp_hdr
->
AP_dñè
)

2494 
¸
->
≠os
 +
s
->
œ°_≠os
;

2495 
s
->
œ°_≠os

¸
->
≠os
;

2497 
¸
->
≠os
 = 
c
->
ªf_£q_°¨t
;

2500 i‡(
ds
 & 
CRAM_RG
) {

2501 i‡(!
c
->
comp_hdr
->
codecs
[
DS_RG
])  -1;

2502 
r
 |
c
->
comp_hdr
->
codecs
[
DS_RG
]

2503 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_RG
], 
blk
,

2504 (*)&
¸
->
rg
, &
out_sz
);

2505 i‡(
r
) Ñ;

2506 i‡(
¸
->
rg
 =
unknown_rg
)

2507 
¸
->
rg
 = -1;

2509 
¸
->
rg
 = -1;

2512 
¸
->
«me_Àn
 = 0;

2514 i‡(
c
->
comp_hdr
->
ªad_«mes_ö˛uded
) {

2515 
öt32_t
 
out_sz2
 = 1;

2518 
¸
->
«me
 = 
	`BLOCK_SIZE
(
s
->
«me_blk
);

2519 i‡(
ds
 & 
CRAM_RN
) {

2520 i‡(!
c
->
comp_hdr
->
codecs
[
DS_RN
])  -1;

2521 
r
 |
c
->
comp_hdr
->
codecs
[
DS_RN
]

2522 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_RN
], 
blk
,

2523 (*)
s
->
«me_blk
, &
out_sz2
);

2524 i‡(
r
) Ñ;

2525 
¸
->
«me_Àn
 = 
out_sz2
;

2529 
¸
->
m©e_pos
 = 0;

2530 
¸
->
m©e_löe
 = -1;

2531 
¸
->
m©e_ªf_id
 = -1;

2532 i‡((
ds
 & 
CRAM_CF
Ë&& (
cf
 & 
CRAM_FLAG_DETACHED
)) {

2533 i‡(
ds
 & 
CRAM_MF
) {

2534 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2536 
mf
;

2537 i‡(!
c
->
comp_hdr
->
codecs
[
DS_MF
])  -1;

2538 
r
 |
c
->
comp_hdr
->
codecs
[
DS_MF
]

2539 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_MF
],

2540 
blk
, (*)&
mf
, &
out_sz
);

2541 i‡(
r
) Ñ;

2542 
¸
->
m©e_Êags
 = 
mf
;

2544 i‡(!
c
->
comp_hdr
->
codecs
[
DS_MF
])  -1;

2545 
r
 |
c
->
comp_hdr
->
codecs
[
DS_MF
]

2546 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_MF
],

2547 
blk
,

2548 (*)&
¸
->
m©e_Êags
,

2549 &
out_sz
);

2550 i‡(
r
) Ñ;

2553 
¸
->
m©e_Êags
 = 0;

2556 i‡(!
c
->
comp_hdr
->
ªad_«mes_ö˛uded
) {

2557 
öt32_t
 
out_sz2
 = 1;

2560 
¸
->
«me
 = 
	`BLOCK_SIZE
(
s
->
«me_blk
);

2561 i‡(
ds
 & 
CRAM_RN
) {

2562 i‡(!
c
->
comp_hdr
->
codecs
[
DS_RN
])  -1;

2563 
r
 |
c
->
comp_hdr
->
codecs
[
DS_RN
]

2564 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_RN
],

2565 
blk
, (*)
s
->
«me_blk
,

2566 &
out_sz2
);

2567 i‡(
r
) Ñ;

2568 
¸
->
«me_Àn
 = 
out_sz2
;

2572 i‡(
ds
 & 
CRAM_NS
) {

2573 i‡(!
c
->
comp_hdr
->
codecs
[
DS_NS
])  -1;

2574 
r
 |
c
->
comp_hdr
->
codecs
[
DS_NS
]

2575 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_NS
], 
blk
,

2576 (*)&
¸
->
m©e_ªf_id
, &
out_sz
);

2577 i‡(
r
) Ñ;

2586 i‡(
ds
 & 
CRAM_NP
) {

2587 i‡(!
c
->
comp_hdr
->
codecs
[
DS_NP
])  -1;

2588 
r
 |
c
->
comp_hdr
->
codecs
[
DS_NP
]

2589 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_NP
], 
blk
,

2590 (*)&
¸
->
m©e_pos
, &
out_sz
);

2591 i‡(
r
) Ñ;

2594 i‡(
ds
 & 
CRAM_TS
) {

2595 i‡(!
c
->
comp_hdr
->
codecs
[
DS_TS
])  -1;

2596 
r
 |
c
->
comp_hdr
->
codecs
[
DS_TS
]

2597 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_TS
], 
blk
,

2598 (*)&
¸
->
éí
, &
out_sz
);

2599 i‡(
r
) Ñ;

2601 
¸
->
éí
 = 
INT_MIN
;

2603 } i‡((
ds
 & 
CRAM_CF
Ë&& (
cf
 & 
CRAM_FLAG_MATE_DOWNSTREAM
)) {

2604 i‡(
ds
 & 
CRAM_NF
) {

2605 i‡(!
c
->
comp_hdr
->
codecs
[
DS_NF
])  -1;

2606 
r
 |
c
->
comp_hdr
->
codecs
[
DS_NF
]

2607 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_NF
], 
blk
,

2608 (*)&
¸
->
m©e_löe
, &
out_sz
);

2609 i‡(
r
) Ñ;

2610 
¸
->
m©e_löe
 +
ªc
 + 1;

2616 
¸
->
m©e_ªf_id
 = -1;

2617 
¸
->
éí
 = 
INT_MIN
;

2618 
¸
->
m©e_pos
 = 0;

2620 
¸
->
m©e_Êags
 = 0;

2621 
¸
->
éí
 = 
INT_MIN
;

2624 
¸
->
m©e_Êags
 = 0;

2625 
¸
->
éí
 = 
INT_MIN
;

2641 
has_MD
 = 
has_NM
 = 0;

2642 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1)

2643 
r
 |
	`¸am_decode_aux_1_0
(
c
, 
s
, 
blk
, 
¸
);

2645 
r
 |
	`¸am_decode_aux
(
c
, 
s
, 
blk
, 
¸
, &
has_MD
, &
has_NM
);

2646 i‡(
r
) Ñ;

2649 i‡(
ds
 & 
CRAM_RL
) {

2650 
¸
->
£q
 = 
	`BLOCK_SIZE
(
s
->
£qs_blk
);

2651 
	`BLOCK_GROW
(
s
->
£qs_blk
, 
¸
->
Àn
);

2652 
£q
 = (*)
	`BLOCK_END
(
s
->
£qs_blk
);

2653 
	`BLOCK_SIZE
(
s
->
£qs_blk
Ë+
¸
->
Àn
;

2655 i‡(!
£q
)

2658 
¸
->
quÆ
 = 
	`BLOCK_SIZE
(
s
->
quÆ_blk
);

2659 
	`BLOCK_GROW
(
s
->
quÆ_blk
, 
¸
->
Àn
);

2660 
quÆ
 = (*)
	`BLOCK_END
(
s
->
quÆ_blk
);

2661 
	`BLOCK_SIZE
(
s
->
quÆ_blk
Ë+
¸
->
Àn
;

2663 i‡(!
s
->
ªf
)

2664 
	`mem£t
(
£q
, '=', 
¸
->
Àn
);

2667 i‡(!(
bf
 & 
BAM_FUNMAP
)) {

2668 i‡((
ds
 & 
CRAM_AP
Ë&& 
¸
->
≠os
 <= 0) {

2669 
	`Ârötf
(
°dîr
,

2671 
¸
->
≠os
);

2675 i‡(
ds
 & (
CRAM_SEQ
 | 
CRAM_MQ
)) {

2676 
r
 |
	`¸am_decode_£q
(
fd
, 
c
, 
s
, 
blk
, 
¸
, 
bfd
, 
cf
, 
£q
, 
quÆ
,

2677 
has_MD
, 
has_NM
);

2678 i‡(
r
) Ñ;

2680 
¸
->
cig¨
 = 0;

2681 
¸
->
ncig¨
 = 0;

2682 
¸
->
´nd
 = cr->
≠os
;

2683 
¸
->
mquÆ
 = 0;

2686 
out_sz2
 = 
¸
->
Àn
;

2689 
¸
->
cig¨
 = 0;

2690 
¸
->
ncig¨
 = 0;

2691 
¸
->
´nd
 = cr->
≠os
;

2692 
¸
->
mquÆ
 = 0;

2694 i‡(
ds
 & 
CRAM_BA
 && 
¸
->
Àn
) {

2695 i‡(!
c
->
comp_hdr
->
codecs
[
DS_BA
])  -1;

2696 
r
 |
c
->
comp_hdr
->
codecs
[
DS_BA
]

2697 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_BA
], 
blk
,

2698 (*)
£q
, &
out_sz2
);

2699 i‡(
r
) Ñ;

2702 i‡((
ds
 & 
CRAM_CF
Ë&& (
cf
 & 
CRAM_FLAG_PRESERVE_QUAL_SCORES
)) {

2703 
out_sz2
 = 
¸
->
Àn
;

2704 i‡(
ds
 & 
CRAM_QS
 && 
¸
->
Àn
 >= 0) {

2705 i‡(!
c
->
comp_hdr
->
codecs
[
DS_QS
])  -1;

2706 
r
 |
c
->
comp_hdr
->
codecs
[
DS_QS
]

2707 ->
	`decode
(
s
, 
c
->
comp_hdr
->
codecs
[
DS_QS
],

2708 
blk
, 
quÆ
, &
out_sz2
);

2709 i‡(
r
) Ñ;

2712 i‡(
ds
 & 
CRAM_RL
)

2713 
	`mem£t
(
quÆ
, 255, 
¸
->
Àn
);

2718 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

2719 i‡(
ªfs
) {

2720 
i
;

2721 
i
 = 0; i < 
fd
->
ªfs
->
ƒef
; i++) {

2722 i‡(
ªfs
[
i
])

2723 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
i
);

2725 
	`‰ì
(
ªfs
);

2726 } i‡(
ªf_id
 >0 && 
s
->
ªf
 !
fd
->
ªf_‰ì
 && !
embed_ªf
) {

2727 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
ªf_id
);

2729 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2732 
r
 |
	`¸am_decode_¶i˚_xªf
(
s
, 
fd
->
ªquúed_fõlds
);

2736 
i
;

2737 
i
 = 0; i < 
s
->
hdr
->
num_blocks
; i++) {

2738 
¸am_block
 *
b
 = 
s
->
block
[
i
];

2739 
	`¸am_‰ì_block
(
b
);

2740 
s
->
block
[
i
] = 
NULL
;

2753 
	`BLOCK_RESIZE_EXACT
(
s
->
£qs_blk
, 
	`BLOCK_SIZE
(s->seqs_blk)+1);

2754 
	`BLOCK_RESIZE_EXACT
(
s
->
quÆ_blk
, 
	`BLOCK_SIZE
(s->qual_blk)+1);

2755 
	`BLOCK_RESIZE_EXACT
(
s
->
«me_blk
, 
	`BLOCK_SIZE
(s->name_blk)+1);

2756 
	`BLOCK_RESIZE_EXACT
(
s
->
aux_blk
, 
	`BLOCK_SIZE
(s->aux_blk)+1);

2758  
r
;

2759 
	}
}

2762 
¸am_fd
 *
	mfd
;

2763 
¸am_c⁄èöî
 *
	mc
;

2764 
¸am_¶i˚
 *
	ms
;

2765 
SAM_hdr
 *
	mh
;

2766 
	mexô_code
;

2767 } 
	t¸am_decode_job
;

2769 *
	$¸am_decode_¶i˚_thªad
(*
¨g
) {

2770 
¸am_decode_job
 *
j
 = (¸am_decode_job *)
¨g
;

2772 
j
->
exô_code
 = 
	`¸am_decode_¶i˚
(j->
fd
, j->
c
, j->
s
, j->
h
);

2774  
j
;

2775 
	}
}

2780 
	$¸am_decode_¶i˚_mt
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

2781 
SAM_hdr
 *
bfd
) {

2782 
¸am_decode_job
 *
j
;

2783 
n⁄block
;

2785 i‡(!
fd
->
poﬁ
)

2786  
	`¸am_decode_¶i˚
(
fd
, 
c
, 
s
, 
bfd
);

2788 i‡(!(
j
 = 
	`mÆloc
((*j))))

2791 
j
->
fd
 = fd;

2792 
j
->
c
 = c;

2793 
j
->
s
 = s;

2794 
j
->
h
 = 
bfd
;

2796 
n⁄block
 = 
	`hts_çoﬁ_¥o˚ss_sz
(
fd
->
rqueue
) ? 1 : 0;

2798 i‡(-1 =
	`hts_çoﬁ_di•©ch2
(
fd
->
poﬁ
, fd->
rqueue
, 
¸am_decode_¶i˚_thªad
,

2799 
j
, 
n⁄block
)) {

2801 
fd
->
job_≥ndög
 = 
j
;

2803 
fd
->
job_≥ndög
 = 
NULL
;

2808 
	}
}

2828 
	$¸am_to_bam
(
SAM_hdr
 *
bfd
, 
¸am_fd
 *
fd
, 
¸am_¶i˚
 *
s
,

2829 
¸am_ªc‹d
 *
¸
, 
ªc
, 
bam_£q_t
 **
bam
) {

2830 
bam_idx
, 
rg_Àn
;

2831 
«me_a
[1024], *
«me
;

2832 
«me_Àn
;

2833 *
aux
, *
aux_‹ig
;

2834 *
£q
, *
quÆ
;

2837 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_QNAME
) {

2838 i‡(
¸
->
«me_Àn
) {

2839 
«me
 = (*)
	`BLOCK_DATA
(
s
->
«me_blk
Ë+ 
¸
->name;

2840 
«me_Àn
 = 
¸
->name_len;

2842 
«me
 = 
«me_a
;

2843 
«me_Àn
 = 
	`°æí
(
fd
->
¥efix
);

2844 
	`mem˝y
(
«me
, 
fd
->
¥efix
, 
«me_Àn
);

2845 
«me
 +
«me_Àn
;

2846 *
«me
++ = ':';

2847 i‡(
¸
->
m©e_löe
 >0 && cr->m©e_löê< 
ªc
)

2848 
«me
 = (*)
	`≠≥nd_uöt64
((*)name,

2849 
s
->
hdr
->
ªc‹d_cou¡î
 +

2850 
¸
->
m©e_löe
 + 1);

2852 
«me
 = (*)
	`≠≥nd_uöt64
((*)name,

2853 
s
->
hdr
->
ªc‹d_cou¡î
 +

2854 
ªc
 + 1);

2855 
«me_Àn
 = 
«me
 - 
«me_a
;

2856 
«me
 = 
«me_a
;

2859 
«me
 = "?";

2860 
«me_Àn
 = 1;

2864 i‡(
¸
->
rg
 < -1 || cr->rg >
bfd
->
ƒg
)

2866 
rg_Àn
 = (
¸
->
rg
 !-1Ë? 
bfd
->rg[¸->rg].
«me_Àn
 + 4 : 0;

2868 i‡(
fd
->
ªquúed_fõlds
 & (
SAM_SEQ
 | 
SAM_QUAL
)) {

2869 i‡(!
	`BLOCK_DATA
(
s
->
£qs_blk
))

2871 
£q
 = (*)
	`BLOCK_DATA
(
s
->
£qs_blk
Ë+ 
¸
->seq;

2873 
£q
 = "*";

2874 
¸
->
Àn
 = 0;

2878 i‡(
fd
->
ªquúed_fõlds
 & 
SAM_QUAL
) {

2879 i‡(!
	`BLOCK_DATA
(
s
->
quÆ_blk
))

2881 
quÆ
 = (*)
	`BLOCK_DATA
(
s
->
quÆ_blk
Ë+ 
¸
->qual;

2883 
quÆ
 = 
NULL
;

2886 
bam_idx
 = 
	`bam_c⁄°ru˘_£q
(
bam
, 
¸
->
aux_size
 + 
rg_Àn
,

2887 
«me
, 
«me_Àn
,

2888 
¸
->
Êags
,

2889 
¸
->
ªf_id
,

2890 
¸
->
≠os
,

2891 
¸
->
´nd
,

2892 
¸
->
mquÆ
,

2893 
¸
->
ncig¨
, &
s
->
cig¨
[cr->cigar],

2894 
¸
->
m©e_ªf_id
,

2895 
¸
->
m©e_pos
,

2896 
¸
->
éí
,

2897 
¸
->
Àn
,

2898 
£q
,

2899 
quÆ
);

2900 i‡(
bam_idx
 == -1)

2903 
aux
 = 
aux_‹ig
 = (*)
	`bam_aux
(*
bam
);

2906 i‡(
¸
->
aux_size
 != 0) {

2907 
	`mem˝y
(
aux
, 
	`BLOCK_DATA
(
s
->
aux_blk
Ë+ 
¸
->aux, cr->
aux_size
);

2908 
aux
 +
¸
->
aux_size
;

2912 i‡(
¸
->
rg
 != -1) {

2913 
Àn
 = 
bfd
->
rg
[
¸
->rg].
«me_Àn
;

2914 *
aux
++ = 'R'; *aux++ = 'G'; *aux++ = 'Z';

2915 
	`mem˝y
(
aux
, 
bfd
->
rg
[
¸
->rg].
«me
, 
Àn
);

2916 
aux
 +
Àn
;

2917 *
aux
++ = 0;

2920  
bam_idx
 + (
aux
 - 
aux_‹ig
);

2921 
	}
}

2926 
¸am_¶i˚
 *
	$¸am_√xt_¶i˚
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 **
˝
) {

2927 
¸am_c⁄èöî
 *
c
;

2928 
¸am_¶i˚
 *
s
 = 
NULL
;

2930 i‡(!(
c
 = 
fd
->
˘r
)) {

2933 i‡(!(
c
 = 
fd
->
˘r
 = 
	`¸am_ªad_c⁄èöî
(fd)))

2934  
NULL
;

2935 } 
c
->
Àngth
 == 0);

2942 i‡(
fd
->
ønge
.
ªfid
 != -2) {

2943 
c
->
ªf_£q_id
 != -2 &&

2944 (
c
->
ªf_£q_id
 < 
fd
->
ønge
.
ªfid
 ||

2945 
c
->
ªf_£q_°¨t
 + c->
ªf_£q_•™
-1 < 
fd
->
ønge
.
°¨t
)) {

2946 i‡(0 !
	`¸am_£ek
(
fd
, 
c
->
Àngth
, 
SEEK_CUR
))

2947  
NULL
;

2948 
	`¸am_‰ì_c⁄èöî
(
fd
->
˘r
);

2950 i‡(!(
c
 = 
fd
->
˘r
 = 
	`¸am_ªad_c⁄èöî
(fd)))

2951  
NULL
;

2952 } 
c
->
Àngth
 == 0);

2955 i‡(
c
->
ªf_£q_id
 !-2 && c->ªf_£q_id !
fd
->
ønge
.
ªfid
)

2956  
NULL
;

2959 i‡(!(
c
->
comp_hdr_block
 = 
	`¸am_ªad_block
(
fd
)))

2960  
NULL
;

2961 i‡(
c
->
comp_hdr_block
->
c⁄ã¡_ty≥
 !
COMPRESSION_HEADER
)

2962  
NULL
;

2964 
c
->
comp_hdr
 = 
	`¸am_decode_com¥essi⁄_hódî
(
fd
, c->
comp_hdr_block
);

2965 i‡(!
c
->
comp_hdr
)

2966  
NULL
;

2967 i‡(!
c
->
comp_hdr
->
AP_dñè
 &&

2968 
	`ßm_hdr_s‹t_‹dî
(
fd
->
hódî
Ë!
ORDER_COORD
) {

2969 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

2970 
fd
->
uns‹ãd
 = 1;

2971 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2975 i‡((
s
 = 
c
->
¶i˚
)) {

2976 
c
->
¶i˚
 = 
NULL
;

2977 
	`¸am_‰ì_¶i˚
(
s
);

2978 
s
 = 
NULL
;

2981 i‡(
c
->
cuº_¶i˚
 =c->
max_¶i˚
) {

2982 i‡(
fd
->
˘r
 =
c
)

2983 
fd
->
˘r
 = 
NULL
;

2984 
	`¸am_‰ì_c⁄èöî
(
c
);

2985 
c
 = 
NULL
;

2990 i‡(
fd
->
job_≥ndög
) {

2991 
¸am_decode_job
 *
j
 = (¸am_decode_job *)
fd
->
job_≥ndög
;

2992 
c
 = 
j
->c;

2993 
s
 = 
j
->s;

2994 
	`‰ì
(
fd
->
job_≥ndög
);

2995 
fd
->
job_≥ndög
 = 
NULL
;

2996 } i‡(!
fd
->
ooc
) {

2997 
em±y_c⁄èöî
:

2998 i‡(!
c
 || c->
cuº_¶i˚
 =c->
max_¶i˚
) {

3001 i‡(!(
c
 = 
fd
->
˘r
 = 
	`¸am_ªad_c⁄èöî
(fd))) {

3002 i‡(
fd
->
poﬁ
) {

3003 
fd
->
ooc
 = 1;

3007  
NULL
;

3009 } 
c
->
Àngth
 == 0);

3010 i‡(
fd
->
ooc
)

3014 i‡(
fd
->
ønge
.
ªfid
 !-2 && 
c
->
ªf_£q_id
 != -2) {

3015 
fd
->
ªquúed_fõlds
 |
SAM_POS
;

3017 i‡(
c
->
ªf_£q_id
 !
fd
->
ønge
.
ªfid
) {

3018 
	`¸am_‰ì_c⁄èöî
(
c
);

3019 
fd
->
˘r
 = 
NULL
;

3020 
fd
->
ooc
 = 1;

3021 
fd
->
eof
 = 1;

3025 i‡(
c
->
ªf_£q_°¨t
 > 
fd
->
ønge
.
íd
) {

3026 
	`¸am_‰ì_c⁄èöî
(
c
);

3027 
fd
->
˘r
 = 
NULL
;

3028 
fd
->
ooc
 = 1;

3029 
fd
->
eof
 = 1;

3033 i‡(
c
->
ªf_£q_°¨t
 + c->
ªf_£q_•™
-1 <

3034 
fd
->
ønge
.
°¨t
) {

3035 
c
->
cuº_ªc
 = c->
max_ªc
;

3036 
c
->
cuº_¶i˚
 = c->
max_¶i˚
;

3037 
	`¸am_£ek
(
fd
, 
c
->
Àngth
, 
SEEK_CUR
);

3038 
	`¸am_‰ì_c⁄èöî
(
c
);

3039 
c
 = 
NULL
;

3044 i‡(!(
c
->
comp_hdr_block
 = 
	`¸am_ªad_block
(
fd
)))

3045  
NULL
;

3046 i‡(
c
->
comp_hdr_block
->
c⁄ã¡_ty≥
 !
COMPRESSION_HEADER
)

3047  
NULL
;

3049 
c
->
comp_hdr
 =

3050 
	`¸am_decode_com¥essi⁄_hódî
(
fd
, 
c
->
comp_hdr_block
);

3051 i‡(!
c
->
comp_hdr
)

3052  
NULL
;

3054 i‡(!
c
->
comp_hdr
->
AP_dñè
 &&

3055 
	`ßm_hdr_s‹t_‹dî
(
fd
->
hódî
Ë!
ORDER_COORD
) {

3056 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

3057 
fd
->
uns‹ãd
 = 1;

3058 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

3062 i‡(
c
->
num_ªc‹ds
 == 0) {

3063 
	`¸am_‰ì_c⁄èöî
(
c
); c = 
NULL
;

3064 
em±y_c⁄èöî
;

3068 i‡(!(
s
 = 
c
->
¶i˚
 = 
	`¸am_ªad_¶i˚
(
fd
)))

3069  
NULL
;

3070 
c
->
cuº_¶i˚
++;

3071 
c
->
cuº_ªc
 = 0;

3072 
c
->
max_ªc
 = 
s
->
hdr
->
num_ªc‹ds
;

3074 
s
->
œ°_≠os
 = s->
hdr
->
ªf_£q_°¨t
;

3077 i‡(
fd
->
ønge
.
ªfid
 !-2 && 
s
->
hdr
->
ªf_£q_id
 != -2) {

3078 i‡(
s
->
hdr
->
ªf_£q_id
 !
fd
->
ønge
.
ªfid
) {

3079 
fd
->
eof
 = 1;

3080 
	`¸am_‰ì_¶i˚
(
s
);

3081 
c
->
¶i˚
 = 
NULL
;

3082  
NULL
;

3085 i‡(
s
->
hdr
->
ªf_£q_°¨t
 > 
fd
->
ønge
.
íd
) {

3086 
fd
->
eof
 = 1;

3087 
	`¸am_‰ì_¶i˚
(
s
);

3088 
c
->
¶i˚
 = 
NULL
;

3089  
NULL
;

3092 i‡(
s
->
hdr
->
ªf_£q_°¨t
 + s->hdr->
ªf_£q_•™
-1 <

3093 
fd
->
ønge
.
°¨t
) {

3094 
	`¸am_‰ì_¶i˚
(
s
);

3095 
c
->
¶i˚
 = 
NULL
;

3096 
	`¸am_‰ì_c⁄èöî
(
c
);

3097 
c
 = 
NULL
;

3104 i‡(!
c
 || !
s
)

3107 i‡(
	`¸am_decode_¶i˚_mt
(
fd
, 
c
, 
s
, fd->
hódî
) != 0) {

3109 
	`Ârötf
(
°dîr
, "FailureÅo decode slice\n");

3110 
	`¸am_‰ì_¶i˚
(
s
);

3111 
c
->
¶i˚
 = 
NULL
;

3112  
NULL
;

3115 i‡(!
fd
->
poﬁ
 || fd->
job_≥ndög
)

3120 i‡(
	`hts_çoﬁ_¥o˚ss_Àn
(
fd
->
rqueue
Ë> 
	`hts_çoﬁ_¥o˚ss_qsize
(fd->rqueue))

3124 i‡(
fd
->
poﬁ
) {

3125 
hts_çoﬁ_ªsu…
 *
ªs
;

3126 
¸am_decode_job
 *
j
;

3132 i‡(
fd
->
ooc
 && 
	`hts_çoﬁ_¥o˚ss_em±y
(fd->
rqueue
))

3133  
NULL
;

3135 
ªs
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
fd
->
rqueue
);

3137 i‡(!
ªs
 || !
	`hts_çoﬁ_ªsu…_d©a
(res)) {

3138 
	`Ârötf
(
°dîr
, "hts_tpool_next_result failure\n");

3139  
NULL
;

3142 
j
 = (
¸am_decode_job
 *)
	`hts_çoﬁ_ªsu…_d©a
(
ªs
);

3143 
c
 = 
j
->c;

3144 
s
 = 
j
->s;

3146 i‡(
j
->
exô_code
 != 0) {

3147 
	`Ârötf
(
°dîr
, "Slice decode failure\n");

3148 
fd
->
eof
 = 0;

3149 
	`hts_çoﬁ_dñëe_ªsu…
(
ªs
, 1);

3150  
NULL
;

3153 
fd
->
˘r
 = 
c
;

3155 
	`hts_çoﬁ_dñëe_ªsu…
(
ªs
, 1);

3158 *
˝
 = 
c
;

3159  
s
;

3160 
	}
}

3171 
¸am_ªc‹d
 *
	$¸am_gë_£q
(
¸am_fd
 *
fd
) {

3172 
¸am_c⁄èöî
 *
c
;

3173 
¸am_¶i˚
 *
s
;

3176 
c
 = 
fd
->
˘r
;

3177 i‡(
c
 && c->
¶i˚
 && c->
cuº_ªc
 < c->
max_ªc
) {

3178 
s
 = 
c
->
¶i˚
;

3180 i‡(!(
s
 = 
	`¸am_√xt_¶i˚
(
fd
, &
c
)))

3181  
NULL
;

3185 i‡(
fd
->
ønge
.
ªfid
 != -2) {

3186 i‡(
fd
->
ønge
.
ªfid
 =-1 && 
s
->
¸ecs
[
c
->
cuº_ªc
].
ªf_id
 != -1) {

3190 
c
->
cuº_ªc
++;

3193 i‡(
s
->
¸ecs
[
c
->
cuº_ªc
].
ªf_id
 < 
fd
->
ønge
.
ªfid
 &&

3194 
s
->
¸ecs
[
c
->
cuº_ªc
].
ªf_id
 != -1) {

3197 
c
->
cuº_ªc
++;

3201 i‡(
s
->
¸ecs
[
c
->
cuº_ªc
].
ªf_id
 !
fd
->
ønge
.
ªfid
) {

3202 
fd
->
eof
 = 1;

3203 
	`¸am_‰ì_¶i˚
(
s
);

3204 
c
->
¶i˚
 = 
NULL
;

3205  
NULL
;

3208 i‡(
fd
->
ønge
.
ªfid
 !-1 && 
s
->
¸ecs
[
c
->
cuº_ªc
].
≠os
 > fd->ønge.
íd
) {

3209 
fd
->
eof
 = 1;

3210 
	`¸am_‰ì_¶i˚
(
s
);

3211 
c
->
¶i˚
 = 
NULL
;

3212  
NULL
;

3215 i‡(
fd
->
ønge
.
ªfid
 !-1 && 
s
->
¸ecs
[
c
->
cuº_ªc
].
´nd
 < fd->ønge.
°¨t
) {

3216 
c
->
cuº_ªc
++;

3224 
fd
->
˘r
 = 
c
;

3225 
c
->
¶i˚
 = 
s
;

3226  &
s
->
¸ecs
[
c
->
cuº_ªc
++];

3227 
	}
}

3235 
	$¸am_gë_bam_£q
(
¸am_fd
 *
fd
, 
bam_£q_t
 **
bam
) {

3236 
¸am_ªc‹d
 *
¸
;

3237 
¸am_c⁄èöî
 *
c
;

3238 
¸am_¶i˚
 *
s
;

3240 i‡(!(
¸
 = 
	`¸am_gë_£q
(
fd
)))

3243 
c
 = 
fd
->
˘r
;

3244 
s
 = 
c
->
¶i˚
;

3246  
	`¸am_to_bam
(
fd
->
hódî
, fd, 
s
, 
¸
, 
c
->
cuº_ªc
-1, 
bam
);

3247 
	}
}

	@htslib/cram/cram_decode.h

41 #i‚de‡
_CRAM_READ_H_


42 
	#_CRAM_READ_H_


	)

44 #ifde‡
__˝lu•lus


62 
¸am_ªc‹d
 *
¸am_gë_£q
(
¸am_fd
 *
fd
);

70 
¸am_gë_bam_£q
(
¸am_fd
 *
fd
, 
bam_£q_t
 **
bam
);

84 
¸am_block_com¥essi⁄_hdr
 *
¸am_decode_com¥essi⁄_hódî
(
¸am_fd
 *
fd
,

85 
¸am_block
 *
b
);

94 
¸am_block_¶i˚_hdr
 *
¸am_decode_¶i˚_hódî
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
);

104 
¸am_decode_¶i˚
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

105 
SAM_hdr
 *
hdr
);

108 #ifde‡
__˝lu•lus


	@htslib/cram/cram_encode.c

31 
	~<c⁄fig.h
>

33 
	~<°dio.h
>

34 
	~<î∫o.h
>

35 
	~<as£π.h
>

36 
	~<°dlib.h
>

37 
	~<°rög.h
>

38 
	~<zlib.h
>

39 
	~<sys/ty≥s.h
>

40 
	~<sys/°©.h
>

41 
	~<m©h.h
>

43 
	~"¸am/¸am.h
"

44 
	~"¸am/os.h
"

45 
	~"ht¶ib/hts.h
"

46 
	~"ht¶ib/hts_ídün.h
"

48 
	$KHASH_MAP_INIT_STR
(
m_s2u64
, 
uöt64_t
)

50 
	#Z_CRAM_STRAT
 
Z_FILTERED


	)

55 
	`¥o˚ss_⁄e_ªad
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

56 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
¸
,

57 
bam_£q_t
 *
b
, 
∫um
);

63 
	$sub_idx
(*
key
, 
vÆ
) {

64 
i
;

66 
i
 = 0; *
key
 && *key++ !
vÆ
; i++);

67  
i
;

68 
	}
}

76 
¸am_block
 *
	$¸am_ícode_com¥essi⁄_hódî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

77 
¸am_block_com¥essi⁄_hdr
 *
h
) {

78 
¸am_block
 *
cb
 = 
	`¸am_√w_block
(
COMPRESSION_HEADER
, 0);

79 
¸am_block
 *
m≠
 = 
	`¸am_√w_block
(
COMPRESSION_HEADER
, 0);

80 
i
, 
mc
;

82 i‡(!
cb
 || !
m≠
)

83  
NULL
;

95 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

96 
	`ôf8_put_blk
(
cb
, 
h
->
ªf_£q_id
);

97 
	`ôf8_put_blk
(
cb
, 
h
->
ªf_£q_°¨t
);

98 
	`ôf8_put_blk
(
cb
, 
h
->
ªf_£q_•™
);

99 
	`ôf8_put_blk
(
cb
, 
h
->
num_ªc‹ds
);

100 
	`ôf8_put_blk
(
cb
, 
h
->
num_œndm¨ks
);

101 
i
 = 0; i < 
h
->
num_œndm¨ks
; i++) {

102 
	`ôf8_put_blk
(
cb
, 
h
->
œndm¨k
[
i
]);

106 i‡(
h
->
¥e£rv©i⁄_m≠
)

107 
	`kh_de°roy
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
);

112 
khöt_t
 
k
;

113 
r
;

115 i‡(!(
h
->
¥e£rv©i⁄_m≠
 = 
	`kh_öô
(
m≠
)))

116  
NULL
;

118 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "RN", &
r
);

119 i‡(-1 =
r
Ë 
NULL
;

120 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = !
fd
->
lossy_ªad_«mes
;

122 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

123 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "PI", &
r
);

124 i‡(-1 =
r
Ë 
NULL
;

125 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = 0;

127 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "UI", &
r
);

128 i‡(-1 =
r
Ë 
NULL
;

129 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = 1;

131 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "MI", &
r
);

132 i‡(-1 =
r
Ë 
NULL
;

133 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = 1;

137 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "SM", &
r
);

138 i‡(-1 =
r
Ë 
NULL
;

139 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = 0;

141 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "TD", &
r
);

142 i‡(-1 =
r
Ë 
NULL
;

143 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = 0;

145 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "AP", &
r
);

146 i‡(-1 =
r
Ë 
NULL
;

147 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = h->
AP_dñè
;

149 i‡(
fd
->
no_ªf
 || fd->
embed_ªf
) {

151 
k
 = 
	`kh_put
(
m≠
, 
h
->
¥e£rv©i⁄_m≠
, "RR", &
r
);

152 i‡(-1 =
r
Ë 
NULL
;

153 
	`kh_vÆ
(
h
->
¥e£rv©i⁄_m≠
, 
k
).
i
 = 0;

159 
mc
 = 0;

160 
	`BLOCK_SIZE
(
m≠
) = 0;

161 i‡(
h
->
¥e£rv©i⁄_m≠
) {

162 
khöt_t
 
k
;

164 
k
 = 
	`kh_begö
(
h
->
¥e£rv©i⁄_m≠
);

165 
k
 !
	`kh_íd
(
h
->
¥e£rv©i⁄_m≠
);

166 
k
++) {

167 c⁄° *
key
;

168 
	`khash_t
(
m≠
Ë*
pm≠
 = 
h
->
¥e£rv©i⁄_m≠
;

171 i‡(!
	`kh_exi°
(
pm≠
, 
k
))

174 
key
 = 
	`kh_key
(
pm≠
, 
k
);

175 
	`BLOCK_APPEND
(
m≠
, 
key
, 2);

177 
	`CRAM_KEY
(
key
[0], key[1])) {

178 
	`CRAM_KEY
('M','I'):

179 
	`BLOCK_APPEND_CHAR
(
m≠
, 
	`kh_vÆ
(
pm≠
, 
k
).
i
);

182 
	`CRAM_KEY
('U','I'):

183 
	`BLOCK_APPEND_CHAR
(
m≠
, 
	`kh_vÆ
(
pm≠
, 
k
).
i
);

186 
	`CRAM_KEY
('P','I'):

187 
	`BLOCK_APPEND_CHAR
(
m≠
, 
	`kh_vÆ
(
pm≠
, 
k
).
i
);

190 
	`CRAM_KEY
('A','P'):

191 
	`BLOCK_APPEND_CHAR
(
m≠
, 
	`kh_vÆ
(
pm≠
, 
k
).
i
);

194 
	`CRAM_KEY
('R','N'):

195 
	`BLOCK_APPEND_CHAR
(
m≠
, 
	`kh_vÆ
(
pm≠
, 
k
).
i
);

198 
	`CRAM_KEY
('R','R'):

199 
	`BLOCK_APPEND_CHAR
(
m≠
, 
	`kh_vÆ
(
pm≠
, 
k
).
i
);

202 
	`CRAM_KEY
('S','M'): {

203 
sm©
[5], *
mp
 = smat;

204 *
mp
++ =

205 (
	`sub_idx
("CGTN", 
h
->
sub°ôuti⁄_m©rix
[0][0]) << 6) |

206 (
	`sub_idx
("CGTN", 
h
->
sub°ôuti⁄_m©rix
[0][1]) << 4) |

207 (
	`sub_idx
("CGTN", 
h
->
sub°ôuti⁄_m©rix
[0][2]) << 2) |

208 (
	`sub_idx
("CGTN", 
h
->
sub°ôuti⁄_m©rix
[0][3]) << 0);

209 *
mp
++ =

210 (
	`sub_idx
("AGTN", 
h
->
sub°ôuti⁄_m©rix
[1][0]) << 6) |

211 (
	`sub_idx
("AGTN", 
h
->
sub°ôuti⁄_m©rix
[1][1]) << 4) |

212 (
	`sub_idx
("AGTN", 
h
->
sub°ôuti⁄_m©rix
[1][2]) << 2) |

213 (
	`sub_idx
("AGTN", 
h
->
sub°ôuti⁄_m©rix
[1][3]) << 0);

214 *
mp
++ =

215 (
	`sub_idx
("ACTN", 
h
->
sub°ôuti⁄_m©rix
[2][0]) << 6) |

216 (
	`sub_idx
("ACTN", 
h
->
sub°ôuti⁄_m©rix
[2][1]) << 4) |

217 (
	`sub_idx
("ACTN", 
h
->
sub°ôuti⁄_m©rix
[2][2]) << 2) |

218 (
	`sub_idx
("ACTN", 
h
->
sub°ôuti⁄_m©rix
[2][3]) << 0);

219 *
mp
++ =

220 (
	`sub_idx
("ACGN", 
h
->
sub°ôuti⁄_m©rix
[3][0]) << 6) |

221 (
	`sub_idx
("ACGN", 
h
->
sub°ôuti⁄_m©rix
[3][1]) << 4) |

222 (
	`sub_idx
("ACGN", 
h
->
sub°ôuti⁄_m©rix
[3][2]) << 2) |

223 (
	`sub_idx
("ACGN", 
h
->
sub°ôuti⁄_m©rix
[3][3]) << 0);

224 *
mp
++ =

225 (
	`sub_idx
("ACGT", 
h
->
sub°ôuti⁄_m©rix
[4][0]) << 6) |

226 (
	`sub_idx
("ACGT", 
h
->
sub°ôuti⁄_m©rix
[4][1]) << 4) |

227 (
	`sub_idx
("ACGT", 
h
->
sub°ôuti⁄_m©rix
[4][2]) << 2) |

228 (
	`sub_idx
("ACGT", 
h
->
sub°ôuti⁄_m©rix
[4][3]) << 0);

229 
	`BLOCK_APPEND
(
m≠
, 
sm©
, 5);

233 
	`CRAM_KEY
('T','D'): {

234 
	`ôf8_put_blk
(
m≠
, 
	`BLOCK_SIZE
(
h
->
TD_blk
));

235 
	`BLOCK_APPEND
(
m≠
,

236 
	`BLOCK_DATA
(
h
->
TD_blk
),

237 
	`BLOCK_SIZE
(
h
->
TD_blk
));

242 
	`Ârötf
(
°dîr
, "Unknow¿¥e£rv©i⁄ key '%.2s'\n", 
key
);

246 
mc
++;

249 
	`ôf8_put_blk
(
cb
, 
	`BLOCK_SIZE
(
m≠
Ë+ 
	`ôf8_size
(
mc
));

250 
	`ôf8_put_blk
(
cb
, 
mc
);

251 
	`BLOCK_APPEND
(
cb
, 
	`BLOCK_DATA
(
m≠
), 
	`BLOCK_SIZE
(map));

254 
mc
 = 0;

255 
	`BLOCK_SIZE
(
m≠
) = 0;

256 i‡(
h
->
codecs
[
DS_BF
]) {

257 i‡(-1 =
h
->
codecs
[
DS_BF
]->
	`°‹e
(h->codecs[DS_BF], 
m≠
, "BF",

258 
fd
->
vîsi⁄
))

259  
NULL
;

260 
mc
++;

262 i‡(
h
->
codecs
[
DS_CF
]) {

263 i‡(-1 =
h
->
codecs
[
DS_CF
]->
	`°‹e
(h->codecs[DS_CF], 
m≠
, "CF",

264 
fd
->
vîsi⁄
))

265  
NULL
;

266 
mc
++;

268 i‡(
h
->
codecs
[
DS_RL
]) {

269 i‡(-1 =
h
->
codecs
[
DS_RL
]->
	`°‹e
(h->codecs[DS_RL], 
m≠
, "RL",

270 
fd
->
vîsi⁄
))

271  
NULL
;

272 
mc
++;

274 i‡(
h
->
codecs
[
DS_AP
]) {

275 i‡(-1 =
h
->
codecs
[
DS_AP
]->
	`°‹e
(h->codecs[DS_AP], 
m≠
, "AP",

276 
fd
->
vîsi⁄
))

277  
NULL
;

278 
mc
++;

280 i‡(
h
->
codecs
[
DS_RG
]) {

281 i‡(-1 =
h
->
codecs
[
DS_RG
]->
	`°‹e
(h->codecs[DS_RG], 
m≠
, "RG",

282 
fd
->
vîsi⁄
))

283  
NULL
;

284 
mc
++;

286 i‡(
h
->
codecs
[
DS_MF
]) {

287 i‡(-1 =
h
->
codecs
[
DS_MF
]->
	`°‹e
(h->codecs[DS_MF], 
m≠
, "MF",

288 
fd
->
vîsi⁄
))

289  
NULL
;

290 
mc
++;

292 i‡(
h
->
codecs
[
DS_NS
]) {

293 i‡(-1 =
h
->
codecs
[
DS_NS
]->
	`°‹e
(h->codecs[DS_NS], 
m≠
, "NS",

294 
fd
->
vîsi⁄
))

295  
NULL
;

296 
mc
++;

298 i‡(
h
->
codecs
[
DS_NP
]) {

299 i‡(-1 =
h
->
codecs
[
DS_NP
]->
	`°‹e
(h->codecs[DS_NP], 
m≠
, "NP",

300 
fd
->
vîsi⁄
))

301  
NULL
;

302 
mc
++;

304 i‡(
h
->
codecs
[
DS_TS
]) {

305 i‡(-1 =
h
->
codecs
[
DS_TS
]->
	`°‹e
(h->codecs[DS_TS], 
m≠
, "TS",

306 
fd
->
vîsi⁄
))

307  
NULL
;

308 
mc
++;

310 i‡(
h
->
codecs
[
DS_NF
]) {

311 i‡(-1 =
h
->
codecs
[
DS_NF
]->
	`°‹e
(h->codecs[DS_NF], 
m≠
, "NF",

312 
fd
->
vîsi⁄
))

313  
NULL
;

314 
mc
++;

316 i‡(
h
->
codecs
[
DS_TC
]) {

317 i‡(-1 =
h
->
codecs
[
DS_TC
]->
	`°‹e
(h->codecs[DS_TC], 
m≠
, "TC",

318 
fd
->
vîsi⁄
))

319  
NULL
;

320 
mc
++;

322 i‡(
h
->
codecs
[
DS_TN
]) {

323 i‡(-1 =
h
->
codecs
[
DS_TN
]->
	`°‹e
(h->codecs[DS_TN], 
m≠
, "TN",

324 
fd
->
vîsi⁄
))

325  
NULL
;

326 
mc
++;

328 i‡(
h
->
codecs
[
DS_TL
]) {

329 i‡(-1 =
h
->
codecs
[
DS_TL
]->
	`°‹e
(h->codecs[DS_TL], 
m≠
, "TL",

330 
fd
->
vîsi⁄
))

331  
NULL
;

332 
mc
++;

334 i‡(
h
->
codecs
[
DS_FN
]) {

335 i‡(-1 =
h
->
codecs
[
DS_FN
]->
	`°‹e
(h->codecs[DS_FN], 
m≠
, "FN",

336 
fd
->
vîsi⁄
))

337  
NULL
;

338 
mc
++;

340 i‡(
h
->
codecs
[
DS_FC
]) {

341 i‡(-1 =
h
->
codecs
[
DS_FC
]->
	`°‹e
(h->codecs[DS_FC], 
m≠
, "FC",

342 
fd
->
vîsi⁄
))

343  
NULL
;

344 
mc
++;

346 i‡(
h
->
codecs
[
DS_FP
]) {

347 i‡(-1 =
h
->
codecs
[
DS_FP
]->
	`°‹e
(h->codecs[DS_FP], 
m≠
, "FP",

348 
fd
->
vîsi⁄
))

349  
NULL
;

350 
mc
++;

352 i‡(
h
->
codecs
[
DS_BS
]) {

353 i‡(-1 =
h
->
codecs
[
DS_BS
]->
	`°‹e
(h->codecs[DS_BS], 
m≠
, "BS",

354 
fd
->
vîsi⁄
))

355  
NULL
;

356 
mc
++;

358 i‡(
h
->
codecs
[
DS_IN
]) {

359 i‡(-1 =
h
->
codecs
[
DS_IN
]->
	`°‹e
(h->codecs[DS_IN], 
m≠
, "IN",

360 
fd
->
vîsi⁄
))

361  
NULL
;

362 
mc
++;

364 i‡(
h
->
codecs
[
DS_DL
]) {

365 i‡(-1 =
h
->
codecs
[
DS_DL
]->
	`°‹e
(h->codecs[DS_DL], 
m≠
, "DL",

366 
fd
->
vîsi⁄
))

367  
NULL
;

368 
mc
++;

370 i‡(
h
->
codecs
[
DS_BA
]) {

371 i‡(-1 =
h
->
codecs
[
DS_BA
]->
	`°‹e
(h->codecs[DS_BA], 
m≠
, "BA",

372 
fd
->
vîsi⁄
))

373  
NULL
;

374 
mc
++;

376 i‡(
h
->
codecs
[
DS_BB
]) {

377 i‡(-1 =
h
->
codecs
[
DS_BB
]->
	`°‹e
(h->codecs[DS_BB], 
m≠
, "BB",

378 
fd
->
vîsi⁄
))

379  
NULL
;

380 
mc
++;

382 i‡(
h
->
codecs
[
DS_MQ
]) {

383 i‡(-1 =
h
->
codecs
[
DS_MQ
]->
	`°‹e
(h->codecs[DS_MQ], 
m≠
, "MQ",

384 
fd
->
vîsi⁄
))

385  
NULL
;

386 
mc
++;

388 i‡(
h
->
codecs
[
DS_RN
]) {

389 i‡(-1 =
h
->
codecs
[
DS_RN
]->
	`°‹e
(h->codecs[DS_RN], 
m≠
, "RN",

390 
fd
->
vîsi⁄
))

391  
NULL
;

392 
mc
++;

394 i‡(
h
->
codecs
[
DS_QS
]) {

395 i‡(-1 =
h
->
codecs
[
DS_QS
]->
	`°‹e
(h->codecs[DS_QS], 
m≠
, "QS",

396 
fd
->
vîsi⁄
))

397  
NULL
;

398 
mc
++;

400 i‡(
h
->
codecs
[
DS_QQ
]) {

401 i‡(-1 =
h
->
codecs
[
DS_QQ
]->
	`°‹e
(h->codecs[DS_QQ], 
m≠
, "QQ",

402 
fd
->
vîsi⁄
))

403  
NULL
;

404 
mc
++;

406 i‡(
h
->
codecs
[
DS_RI
]) {

407 i‡(-1 =
h
->
codecs
[
DS_RI
]->
	`°‹e
(h->codecs[DS_RI], 
m≠
, "RI",

408 
fd
->
vîsi⁄
))

409  
NULL
;

410 
mc
++;

412 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) != 1) {

413 i‡(
h
->
codecs
[
DS_SC
]) {

414 i‡(-1 =
h
->
codecs
[
DS_SC
]->
	`°‹e
(h->codecs[DS_SC], 
m≠
, "SC",

415 
fd
->
vîsi⁄
))

416  
NULL
;

417 
mc
++;

419 i‡(
h
->
codecs
[
DS_RS
]) {

420 i‡(-1 =
h
->
codecs
[
DS_RS
]->
	`°‹e
(h->codecs[DS_RS], 
m≠
, "RS",

421 
fd
->
vîsi⁄
))

422  
NULL
;

423 
mc
++;

425 i‡(
h
->
codecs
[
DS_PD
]) {

426 i‡(-1 =
h
->
codecs
[
DS_PD
]->
	`°‹e
(h->codecs[DS_PD], 
m≠
, "PD",

427 
fd
->
vîsi⁄
))

428  
NULL
;

429 
mc
++;

431 i‡(
h
->
codecs
[
DS_HC
]) {

432 i‡(-1 =
h
->
codecs
[
DS_HC
]->
	`°‹e
(h->codecs[DS_HC], 
m≠
, "HC",

433 
fd
->
vîsi⁄
))

434  
NULL
;

435 
mc
++;

438 i‡(
h
->
codecs
[
DS_TM
]) {

439 i‡(-1 =
h
->
codecs
[
DS_TM
]->
	`°‹e
(h->codecs[DS_TM], 
m≠
, "TM",

440 
fd
->
vîsi⁄
))

441  
NULL
;

442 
mc
++;

444 i‡(
h
->
codecs
[
DS_TV
]) {

445 i‡(-1 =
h
->
codecs
[
DS_TV
]->
	`°‹e
(h->codecs[DS_TV], 
m≠
, "TV",

446 
fd
->
vîsi⁄
))

447  
NULL
;

448 
mc
++;

450 
	`ôf8_put_blk
(
cb
, 
	`BLOCK_SIZE
(
m≠
Ë+ 
	`ôf8_size
(
mc
));

451 
	`ôf8_put_blk
(
cb
, 
mc
);

452 
	`BLOCK_APPEND
(
cb
, 
	`BLOCK_DATA
(
m≠
), 
	`BLOCK_SIZE
(map));

456 
mp
 = 
m≠
; 
mc
 = 0;

457 i‡(
h
->
èg_ícodög_m≠
) {

458 
HashIãm
 *
hi
;

459 
HashIãr
 *
ôî
 = 
	`HashTabÀIãrCª©e
();

460 i‡(!
ôî
)

461  
NULL
;

463 (
hi
 = 
	`HashTabÀIãrNext
(
h
->
èg_ícodög_m≠
, 
ôî
))) {

464 
¸am_m≠
 *
m
 = 
hi
->
d©a
.
p
;

465 
sz
;

467 
mp
 +
	`ôf8_put
(mp, (
hi
->
key
[0]<<16)|(hi->key[1]<<8)|hi->key[2]);

468 i‡(-1 =(
sz
 = 
m
->
codec
->
	`°‹e
(m->codec, 
mp
, 
NULL
, 
fd
->
vîsi⁄
)))

469  
NULL
;

470 
mp
 +
sz
;

471 
mc
++;

474 
	`HashTabÀIãrDe°roy
(
ôî
);

477 
mc
 = 0;

478 
	`BLOCK_SIZE
(
m≠
) = 0;

479 i‡(
c
->
ègs_u£d
) {

480 
khöt_t
 
k
;

482 
k
 = 
	`kh_begö
(
c
->
ègs_u£d
); k !
	`kh_íd
(c->tags_used); k++) {

483 
key
;

484 i‡(!
	`kh_exi°
(
c
->
ègs_u£d
, 
k
))

487 
key
 = 
	`kh_key
(
c
->
ègs_u£d
, 
k
);

488 
¸am_codec
 *
cd
 = 
	`kh_vÆ
(
c
->
ègs_u£d
, 
k
)->
codec
;

490 
	`ôf8_put_blk
(
m≠
, 
key
);

491 i‡(-1 =
cd
->
	`°‹e
(cd, 
m≠
, 
NULL
, 
fd
->
vîsi⁄
))

492  
NULL
;

494 
mc
++;

498 
	`ôf8_put_blk
(
cb
, 
	`BLOCK_SIZE
(
m≠
Ë+ 
	`ôf8_size
(
mc
));

499 
	`ôf8_put_blk
(
cb
, 
mc
);

500 
	`BLOCK_APPEND
(
cb
, 
	`BLOCK_DATA
(
m≠
), 
	`BLOCK_SIZE
(map));

502 i‡(
fd
->
vîbo£
)

503 
	`Ârötf
(
°dîr
, "Wrote compression block header in %d bytes\n",

504 ()
	`BLOCK_SIZE
(
cb
));

506 
	`BLOCK_UPLEN
(
cb
);

508 
	`¸am_‰ì_block
(
m≠
);

510  
cb
;

511 
	}
}

520 
¸am_block
 *
	$¸am_ícode_¶i˚_hódî
(
¸am_fd
 *
fd
, 
¸am_¶i˚
 *
s
) {

521 *
buf
;

522 *
˝
;

523 
¸am_block
 *
b
 = 
	`¸am_√w_block
(
MAPPED_SLICE
, 0);

524 
j
;

526 i‡(!
b
)

527  
NULL
;

529 i‡(
NULL
 =(
˝
 = 
buf
 = 
	`mÆloc
(16+5*(8+
s
->
hdr
->
num_blocks
)))) {

530 
	`¸am_‰ì_block
(
b
);

531  
NULL
;

534 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
ªf_£q_id
);

535 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
ªf_£q_°¨t
);

536 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
ªf_£q_•™
);

537 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
num_ªc‹ds
);

538 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 2)

539 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
ªc‹d_cou¡î
);

540 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3)

541 
˝
 +
	`…f8_put
(˝, 
s
->
hdr
->
ªc‹d_cou¡î
);

542 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
num_blocks
);

543 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
num_c⁄ã¡_ids
);

544 
j
 = 0; j < 
s
->
hdr
->
num_c⁄ã¡_ids
; j++) {

545 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
block_c⁄ã¡_ids
[
j
]);

547 i‡(
s
->
hdr
->
c⁄ã¡_ty≥
 =
MAPPED_SLICE
)

548 
˝
 +
	`ôf8_put
(˝, 
s
->
hdr
->
ªf_ba£_id
);

550 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) != 1) {

551 
	`mem˝y
(
˝
, 
s
->
hdr
->
md5
, 16); cp += 16;

554 
	`as£π
(
˝
-
buf
 <16+5*(8+
s
->
hdr
->
num_blocks
));

556 
b
->
d©a
 = (*)
buf
;

557 
b
->
comp_size
 = b->
uncomp_size
 = 
˝
-
buf
;

559  
b
;

560 
	}
}

569 
	$¸am_ícode_¶i˚_ªad
(
¸am_fd
 *
fd
,

570 
¸am_c⁄èöî
 *
c
,

571 
¸am_block_com¥essi⁄_hdr
 *
h
,

572 
¸am_¶i˚
 *
s
,

573 
¸am_ªc‹d
 *
¸
,

574 *
œ°_pos
) {

575 
r
 = 0;

576 
öt32_t
 
i32
;

577 
uc
;

583 
i32
 = 
fd
->
¸am_Êag_sw≠
[
¸
->
Êags
 & 0xfff];

584 
r
 |
h
->
codecs
[
DS_BF
]->
	`ícode
(
s
, h->codecs[DS_BF], (*)&
i32
, 1);

586 
i32
 = 
¸
->
¸am_Êags
 & 
CRAM_FLAG_MASK
;

587 
r
 |
h
->
codecs
[
DS_CF
]->
	`ícode
(
s
, h->codecs[DS_CF], (*)&
i32
, 1);

589 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
Ë!1 && 
s
->
hdr
->
ªf_£q_id
 == -2)

590 
r
 |
h
->
codecs
[
DS_RI
]->
	`ícode
(
s
, h->codecs[DS_RI], (*)&
¸
->
ªf_id
, 1);

592 
r
 |
h
->
codecs
[
DS_RL
]->
	`ícode
(
s
, h->codecs[DS_RL], (*)&
¸
->
Àn
, 1);

594 i‡(
c
->
pos_s‹ãd
) {

595 
i32
 = 
¸
->
≠os
 - *
œ°_pos
;

596 
r
 |
h
->
codecs
[
DS_AP
]->
	`ícode
(
s
, h->codecs[DS_AP], (*)&
i32
, 1);

597 *
œ°_pos
 = 
¸
->
≠os
;

599 
i32
 = 
¸
->
≠os
;

600 
r
 |
h
->
codecs
[
DS_AP
]->
	`ícode
(
s
, h->codecs[DS_AP], (*)&
i32
, 1);

603 
r
 |
h
->
codecs
[
DS_RG
]->
	`ícode
(
s
, h->codecs[DS_RG], (*)&
¸
->
rg
, 1);

605 i‡(
¸
->
¸am_Êags
 & 
CRAM_FLAG_DETACHED
) {

606 
i32
 = 
¸
->
m©e_Êags
;

607 
r
 |
h
->
codecs
[
DS_MF
]->
	`ícode
(
s
, h->codecs[DS_MF], (*)&
i32
, 1);

609 
r
 |
h
->
codecs
[
DS_NS
]->
	`ícode
(
s
, h->codecs[DS_NS],

610 (*)&
¸
->
m©e_ªf_id
, 1);

612 
r
 |
h
->
codecs
[
DS_NP
]->
	`ícode
(
s
, h->codecs[DS_NP],

613 (*)&
¸
->
m©e_pos
, 1);

615 
r
 |
h
->
codecs
[
DS_TS
]->
	`ícode
(
s
, h->codecs[DS_TS],

616 (*)&
¸
->
éí
, 1);

617 } i‡(
¸
->
¸am_Êags
 & 
CRAM_FLAG_MATE_DOWNSTREAM
) {

618 
r
 |
h
->
codecs
[
DS_NF
]->
	`ícode
(
s
, h->codecs[DS_NF],

619 (*)&
¸
->
m©e_löe
, 1);

623 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

624 
j
;

625 
uc
 = 
¸
->
¡ags
;

626 
r
 |
h
->
codecs
[
DS_TC
]->
	`ícode
(
s
, h->codecs[DS_TC], (*)&
uc
, 1);

628 
j
 = 0; j < 
¸
->
¡ags
; j++) {

629 
uöt32_t
 
i32
 = 
s
->
TN
[
¸
->
TN_idx
 + 
j
];

630 
r
 |
h
->
codecs
[
DS_TN
]->
	`ícode
(
s
, h->codecs[DS_TN], (*)&
i32
, 1);

633 
r
 |
h
->
codecs
[
DS_TL
]->
	`ícode
(
s
, h->codecs[DS_TL], (*)&
¸
->
TL
, 1);

640 i‡(!(
¸
->
Êags
 & 
BAM_FUNMAP
)) {

641 
¥ev_pos
 = 0, 
j
;

643 
r
 |
h
->
codecs
[
DS_FN
]->
	`ícode
(
s
, h->codecs[DS_FN],

644 (*)&
¸
->
n„©uª
, 1);

645 
j
 = 0; j < 
¸
->
n„©uª
; j++) {

646 
¸am_„©uª
 *
f
 = &
s
->
„©uªs
[
¸
->
„©uª
 + 
j
];

648 
uc
 = 
f
->
X
.
code
;

649 
r
 |
h
->
codecs
[
DS_FC
]->
	`ícode
(
s
, h->codecs[DS_FC], (*)&
uc
, 1);

650 
i32
 = 
f
->
X
.
pos
 - 
¥ev_pos
;

651 
r
 |
h
->
codecs
[
DS_FP
]->
	`ícode
(
s
, h->codecs[DS_FP], (*)&
i32
, 1);

652 
¥ev_pos
 = 
f
->
X
.
pos
;

654 
f
->
X
.
code
) {

660 
uc
 = 
f
->
X
.
ba£
;

661 
r
 |
h
->
codecs
[
DS_BS
]->
	`ícode
(
s
, h->codecs[DS_BS],

662 (*)&
uc
, 1);

687 
uc
 = 
f
->
i
.
ba£
;

688 
r
 |
h
->
codecs
[
DS_BA
]->
	`ícode
(
s
, h->codecs[DS_BA],

689 (*)&
uc
, 1);

695 
i32
 = 
f
->
D
.
Àn
;

696 
r
 |
h
->
codecs
[
DS_DL
]->
	`ícode
(
s
, h->codecs[DS_DL],

697 (*)&
i32
, 1);

704 
uc
 = 
f
->
B
.
ba£
;

705 
r
 |
h
->
codecs
[
DS_BA
]->
	`ícode
(
s
, h->codecs[DS_BA],

706 (*)&
uc
, 1);

716 
r
 |
h
->
codecs
[
DS_BB
]->
	`ícode
(
s
, h->codecs[DS_BB],

717 (*)
	`BLOCK_DATA
(
s
->
£qs_blk
)

718 + 
f
->
b
.
£q_idx
,

719 
f
->
b
.
Àn
);

730 
i32
 = 
f
->
N
.
Àn
;

731 
r
 |
h
->
codecs
[
DS_RS
]->
	`ícode
(
s
, h->codecs[DS_RS],

732 (*)&
i32
, 1);

736 
i32
 = 
f
->
P
.
Àn
;

737 
r
 |
h
->
codecs
[
DS_PD
]->
	`ícode
(
s
, h->codecs[DS_PD],

738 (*)&
i32
, 1);

742 
i32
 = 
f
->
H
.
Àn
;

743 
r
 |
h
->
codecs
[
DS_HC
]->
	`ícode
(
s
, h->codecs[DS_HC],

744 (*)&
i32
, 1);

749 
	`Ârötf
(
°dîr
, "unhandled feature code %c\n",

750 
f
->
X
.
code
);

755 
r
 |
h
->
codecs
[
DS_MQ
]->
	`ícode
(
s
, h->codecs[DS_MQ],

756 (*)&
¸
->
mquÆ
, 1);

758 *
£q
 = (*)
	`BLOCK_DATA
(
s
->
£qs_blk
Ë+ 
¸
->seq;

759 i‡(
¸
->
Àn
)

760 
r
 |
h
->
codecs
[
DS_BA
]->
	`ícode
(
s
, h->codecs[DS_BA], 
£q
, 
¸
->
Àn
);

763  
r
 ? -1 : 0;

764 
	}
}

774 
	$¸am_com¥ess_¶i˚
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
) {

775 
Àvñ
 = 
fd
->Àvñ, 
i
;

776 
mëhod
 = 1<<
GZIP
 | 1<<
GZIP_RLE
, 
mëhodF
 = method;

779 i‡(
Àvñ
 > 5 && 
s
->
block
[0]->
uncomp_size
 > 500)

780 
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[0], 
NULL
, 1<<
GZIP
, 1);

782 i‡(
fd
->
u£_bz2
)

783 
mëhod
 |1<<
BZIP2
;

785 i‡(
fd
->
u£_øns
)

786 
mëhod
 |(1<<
RANS0
Ë| (1<<
RANS1
);

788 i‡(
fd
->
u£_lzma
)

789 
mëhod
 |(1<<
LZMA
);

792 
mëhodF
 = 
mëhod
 & ~(1<<
GZIP
 | 1<<
BZIP2
 | 1<<
LZMA
);

793 i‡(
Àvñ
 >= 6)

794 
mëhodF
 = 
mëhod
;

798 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_IN
], fd->
m
[DS_IN],

799 
mëhod
, 
Àvñ
))

802 i‡(
fd
->
Àvñ
 == 0) {

804 } i‡(
fd
->
Àvñ
 == 1) {

805 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_QS
], fd->
m
[DS_QS],

806 
mëhodF
, 1))

808 
i
 = 
DS_aux
; i <
DS_aux_oz
; i++) {

809 i‡(
s
->
block
[
i
])

810 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
i
], fd->
m
[i],

811 
mëhod
, 1))

814 } i‡(
fd
->
Àvñ
 < 3) {

815 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_QS
], fd->
m
[DS_QS],

816 
mëhod
, 1))

818 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_BA
], fd->
m
[DS_BA],

819 
mëhod
, 1))

821 i‡(
s
->
block
[
DS_BB
])

822 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_BB
], fd->
m
[DS_BB],

823 
mëhod
, 1))

825 
i
 = 
DS_aux
; i <
DS_aux_oz
; i++) {

826 i‡(
s
->
block
[
i
])

827 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
i
], fd->
m
[i],

828 
mëhod
, 
Àvñ
))

832 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_QS
], fd->
m
[DS_QS],

833 
mëhod
, 
Àvñ
))

835 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_BA
], fd->
m
[DS_BA],

836 
mëhod
, 
Àvñ
))

838 i‡(
s
->
block
[
DS_BB
])

839 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_BB
], fd->
m
[DS_BB],

840 
mëhod
, 
Àvñ
))

842 
i
 = 
DS_aux
; i <
DS_aux_oz
; i++) {

843 i‡(
s
->
block
[
i
])

844 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
i
], fd->
m
[i],

845 
mëhod
, 
Àvñ
))

852 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_RN
], fd->
m
[DS_RN],

853 
mëhod
 & ~(1<<
RANS0
 | 1<<
GZIP_RLE
),

854 
	`MIN
(9,
Àvñ
)))

858 i‡(
s
->
block
[
DS_NS
] != s->block[0])

859 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
DS_NS
], fd->
m
[DS_NS],

860 
mëhod
, 
Àvñ
))

868 
i
;

869 
i
 = 0; i < 
s
->
«ux_block
; i++) {

870 i‡(!
s
->
aux_block
[
i
] || s->aux_block[i] =s->
block
[0])

873 i‡(
s
->
aux_block
[
i
]->
mëhod
 !
RAW
)

876 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
aux_block
[
i
], s->aux_block[i]->
m
,

877 
mëhod
, 
Àvñ
))

886 
i
;

887 
i
 = 1; i < 
s
->
hdr
->
num_blocks
 && i < 
DS_END
; i++) {

888 i‡(!
s
->
block
[
i
] || s->block[i] == s->block[0])

891 i‡(
s
->
block
[
i
]->
mëhod
 !
RAW
)

894 i‡(
	`¸am_com¥ess_block
(
fd
, 
s
->
block
[
i
], fd->
m
[i],

895 
mëhodF
, 
Àvñ
))

901 
	}
}

909 
	$¸am_ícode_¶i˚
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

910 
¸am_block_com¥essi⁄_hdr
 *
h
, 
¸am_¶i˚
 *
s
) {

911 
ªc
, 
r
 = 0, 
œ°_pos
;

912 
embed_ªf
;

913 
¸am_DS_ID
 
id
;

915 
embed_ªf
 = 
fd
->embed_ª‡&& 
s
->
hdr
->
ªf_£q_id
 != -1 ? 1 : 0;

929 
s
->
hdr
->
ªf_ba£_id
 = 
embed_ªf
 ? 
DS_ªf
 : -1;

930 
s
->
hdr
->
ªc‹d_cou¡î
 = 
c
->
num_ªc‹ds
 + c->record_counter;

931 
c
->
num_ªc‹ds
 +
s
->
hdr
->num_records;

933 
¡ags
 = 
c
->
ègs_u£d
 ? c->ègs_u£d->
n_occupõd
 : 0;

934 
s
->
block
 = 
	`ˇŒoc
(
DS_END
 + 
¡ags
, (s->block[0]));

935 
s
->
hdr
->
block_c⁄ã¡_ids
 = 
	`mÆloc
(
DS_END
 * (
öt32_t
));

936 i‡(!
s
->
block
 || !s->
hdr
->
block_c⁄ã¡_ids
)

941 i‡(!(
s
->
block
[0] = 
	`¸am_√w_block
(
CORE
, 0)))

945 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

946 i‡(
h
->
codecs
[
DS_TN
]->
codec
 =
E_EXTERNAL
) {

947 i‡(!(
s
->
block
[
DS_TN
] = 
	`¸am_√w_block
(
EXTERNAL
,DS_TN)))  -1;

948 
h
->
codecs
[
DS_TN
]->
exã∫Æ
.
c⁄ã¡_id
 = DS_TN;

950 
s
->
block
[
DS_TN
] = s->block[0];

952 
s
->
block
[
DS_TN
] = s->block[DS_TN];

956 i‡(
embed_ªf
) {

957 i‡(!(
s
->
block
[
DS_ªf
] = 
	`¸am_√w_block
(
EXTERNAL
, DS_ref)))

959 
s
->
ªf_id
 = 
DS_ªf
;

960 
	`BLOCK_APPEND
(
s
->
block
[
DS_ªf
],

961 
c
->
ªf
 + c->
fú°_ba£
 - c->
ªf_°¨t
,

962 
c
->
œ°_ba£
 - c->
fú°_ba£
 + 1);

968 
id
 = 
DS_BF
; id < 
DS_TN
; id++) {

969 i‡(
h
->
codecs
[
id
] && (h->codecs[id]->
codec
 =
E_EXTERNAL
 ||

970 
h
->
codecs
[
id
]->
codec
 =
E_BYTE_ARRAY_STOP
 ||

971 
h
->
codecs
[
id
]->
codec
 =
E_BYTE_ARRAY_LEN
)) {

972 
h
->
codecs
[
id
]->
codec
) {

973 
E_EXTERNAL
:

974 i‡(!(
s
->
block
[
id
] = 
	`¸am_√w_block
(
EXTERNAL
, id)))

976 
h
->
codecs
[
id
]->
exã∫Æ
.
c⁄ã¡_id
 = id;

979 
E_BYTE_ARRAY_STOP
:

980 i‡(!(
s
->
block
[
id
] = 
	`¸am_√w_block
(
EXTERNAL
, id)))

982 
h
->
codecs
[
id
]->
byã_¨øy_°›
.
c⁄ã¡_id
 = id;

985 
E_BYTE_ARRAY_LEN
: {

986 
¸am_codec
 *
cc
;

988 
cc
 = 
h
->
codecs
[
id
]->
e_byã_¨øy_Àn
.
Àn_codec
;

989 i‡(
cc
->
codec
 =
E_EXTERNAL
) {

990 
eid
 = 
cc
->
exã∫Æ
.
c⁄ã¡_id
;

991 i‡(!(
s
->
block
[
eid
] = 
	`¸am_√w_block
(
EXTERNAL
,Éid)))

993 
cc
->
exã∫Æ
.
c⁄ã¡_id
 = 
eid
;

994 
cc
->
out
 = 
s
->
block
[
eid
];

997 
cc
 = 
h
->
codecs
[
id
]->
e_byã_¨øy_Àn
.
vÆ_codec
;

998 i‡(
cc
->
codec
 =
E_EXTERNAL
) {

999 
eid
 = 
cc
->
exã∫Æ
.
c⁄ã¡_id
;

1000 i‡(!
s
->
block
[
eid
])

1001 i‡(!(
s
->
block
[
eid
] = 
	`¸am_√w_block
(
EXTERNAL
,Éid)))

1003 
cc
->
exã∫Æ
.
c⁄ã¡_id
 = 
eid
;

1004 
cc
->
out
 = 
s
->
block
[
eid
];

1012 i‡(!(
id
 =
DS_BB
 && !
h
->
codecs
[DS_BB]))

1013 
s
->
block
[
id
] = s->block[0];

1015 i‡(
h
->
codecs
[
id
])

1016 
h
->
codecs
[
id
]->
out
 = 
s
->
block
[id];

1022 i‡(
c
->
ègs_u£d
) {

1023 
n
;

1024 
s
->
hdr
->
num_blocks
 = 
DS_END
;

1025 
n
 = 0;Ç < 
s
->
«ux_block
;Ç++)

1026 
s
->
block
[s->
hdr
->
num_blocks
++] = s->
aux_block
[
n
];

1030 
œ°_pos
 = 
s
->
hdr
->
ªf_£q_°¨t
;

1031 
ªc
 = 0;Ñe¯< 
s
->
hdr
->
num_ªc‹ds
;Ñec++) {

1032 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
ªc
];

1033 i‡(
	`¸am_ícode_¶i˚_ªad
(
fd
, 
c
, 
h
, 
s
, 
¸
, &
œ°_pos
) == -1)

1037 
s
->
block
[0]->
uncomp_size
 = s->block[0]->
byã
 + (s->block[0]->
bô
 < 7);

1038 
s
->
block
[0]->
comp_size
 = s->block[0]->
uncomp_size
;

1041 
s
->
block
[
DS_IN
] = s->
ba£_blk
; s->ba£_blk = 
NULL
;

1042 
s
->
block
[
DS_QS
] = s->
quÆ_blk
; s->quÆ_blk = 
NULL
;

1043 
s
->
block
[
DS_RN
] = s->
«me_blk
; s->«me_blk = 
NULL
;

1044 
s
->
block
[
DS_SC
] = s->
so·_blk
; s->so·_blk = 
NULL
;

1047 
id
 = 1; id < 
s
->
hdr
->
num_blocks
; id++) {

1048 i‡(!
s
->
block
[
id
] || s->block[id] == s->block[0])

1051 i‡(
s
->
block
[
id
]->
uncomp_size
 == 0)

1052 
	`BLOCK_UPLEN
(
s
->
block
[
id
]);

1056 i‡(
	`¸am_com¥ess_¶i˚
(
fd
, 
c
, 
s
) == -1)

1061 
i
, 
j
;

1063 
s
->
hdr
->
block_c⁄ã¡_ids
 = 
	`ªÆloc
(s->hdr->block_content_ids,

1064 
s
->
hdr
->
num_blocks
 * (
öt32_t
));

1065 i‡(!
s
->
hdr
->
block_c⁄ã¡_ids
)

1068 
i
 = 
j
 = 1; i < 
s
->
hdr
->
num_blocks
; i++) {

1069 i‡(!
s
->
block
[
i
] || s->block[i] == s->block[0])

1071 i‡(
s
->
block
[
i
]->
uncomp_size
 == 0) {

1072 
	`¸am_‰ì_block
(
s
->
block
[
i
]);

1073 
s
->
block
[
i
] = 
NULL
;

1076 
s
->
block
[
j
] = s->block[
i
];

1077 
s
->
hdr
->
block_c⁄ã¡_ids
[
j
-1] = s->
block
[
i
]->
c⁄ã¡_id
;

1078 
j
++;

1080 
s
->
hdr
->
num_c⁄ã¡_ids
 = 
j
-1;

1081 
s
->
hdr
->
num_blocks
 = 
j
;

1083 i‡(!(
s
->
hdr_block
 = 
	`¸am_ícode_¶i˚_hódî
(
fd
, s)))

1087  
r
 ? -1 : 0;

1088 
	}
}

1093 
	$ex≥˘ed_ãm∂©e_cou¡
(
bam_£q_t
 *
b
) {

1094 
ex≥˘ed
 = 
	`bam_Êag
(
b
Ë& 
BAM_FPAIRED
 ? 2 : 1;

1096 
uöt8_t
 *
TC
 = (uöt8_à*)
	`bam_aux_gë
(
b
, "TC");

1097 i‡(
TC
) {

1098 
n
 = 
	`bam_aux2i
(
TC
);

1099 i‡(
ex≥˘ed
 < 
n
)

1100 
ex≥˘ed
 = 
n
;

1103 i‡(!
TC
 && 
	`bam_aux_gë
(
b
, "SA")) {

1107 
ex≥˘ed
 = 
INT_MAX
;

1110  
ex≥˘ed
;

1111 
	}
}

1132 
	$lossy_ªad_«mes
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

1133 
bam_°¨t
) {

1134 
r1
, 
r2
, 
ªt
 = -1;

1137 
r2
 = 0;Ñ2 < 
s
->
hdr
->
num_ªc‹ds
;Ñ2++)

1138 
s
->
¸ecs
[
r2
].
¸am_Êags
 = 0;

1140 i‡(!
fd
->
lossy_ªad_«mes
)

1143 
	`khash_t
(
m_s2u64
Ë*
«mes
 = 
	`kh_öô
(m_s2u64);

1144 i‡(!
«mes
)

1145 
Áû
;

1148 
r1
 = 
bam_°¨t
, 
r2
 = 0;Ñ2 < 
s
->
hdr
->
num_ªc‹ds
;Ñ1++,Ñ2++) {

1150 
bam_£q_t
 *
b
 = 
c
->
bams
[
r1
];

1151 
khöt_t
 
k
;

1152 
n
;

1153 
uöt64_t
 
e
;

1155 
uöt64_t
 
i64
;

1157 
öt32_t
 
e
,
c
;

1159 } 
u
;

1161 
e
 = 
	`ex≥˘ed_ãm∂©e_cou¡
(
b
);

1162 
u
.
e
 =É; u.
c
 = 1;

1164 
k
 = 
	`kh_put
(
m_s2u64
, 
«mes
, 
	`bam_«me
(
b
), &
n
);

1165 i‡(
n
 == -1)

1166 
Áû
;

1168 i‡(
n
 == 0) {

1170 
u
.
i64
 = 
	`kh_vÆ
(
«mes
, 
k
);

1171 i‡(
u
.
e
 !=É) {

1174 
	`kh_vÆ
(
«mes
, 
k
) = 0;

1176 
u
.
c
++;

1177 i‡(
u
.
e
 =u.
c
) {

1179 
	`kh_vÆ
(
«mes
, 
k
) = -1;

1181 
	`kh_vÆ
(
«mes
, 
k
Ë
u
.
i64
;

1186 
	`kh_vÆ
(
«mes
, 
k
Ë
u
.
i64
;

1191 
r1
 = 
bam_°¨t
, 
r2
 = 0;Ñ2 < 
s
->
hdr
->
num_ªc‹ds
;Ñ1++,Ñ2++) {

1192 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
r2
];

1193 
bam_£q_t
 *
b
 = 
c
->
bams
[
r1
];

1194 
khöt_t
 
k
;

1196 
k
 = 
	`kh_gë
(
m_s2u64
, 
«mes
, 
	`bam_«me
(
b
));

1198 i‡(
k
 =
	`kh_íd
(
«mes
))

1199 
Áû
;

1201 i‡(
	`kh_vÆ
(
«mes
, 
k
) == -1)

1202 
¸
->
¸am_Êags
 = 
CRAM_FLAG_DISCARD_NAME
;

1205 
ªt
 = 0;

1206 
Áû
:

1208 i‡(
«mes
)

1209 
	`kh_de°roy
(
m_s2u64
, 
«mes
);

1211  
ªt
;

1212 
	}
}

1225 
	$add_ªad_«mes
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

1226 
bam_°¨t
) {

1227 
r1
, 
r2
;

1228 
kìp_«mes
 = !
fd
->
lossy_ªad_«mes
;

1230 
r1
 = 
bam_°¨t
, 
r2
 = 0;

1231 
r1
 < 
c
->
cuº_c_ªc
 && 
r2
 < 
s
->
hdr
->
num_ªc‹ds
;

1232 
r1
++, 
r2
++) {

1233 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
r2
];

1234 
bam_£q_t
 *
b
 = 
c
->
bams
[
r1
];

1236 
¸
->
«me
 = 
	`BLOCK_SIZE
(
s
->
«me_blk
);

1237 i‡((
¸
->
¸am_Êags
 & 
CRAM_FLAG_DETACHED
Ë|| 
kìp_«mes
) {

1238 
	`BLOCK_APPEND
(
s
->
«me_blk
, 
	`bam_«me
(
b
), 
	`bam_«me_Àn
(b));

1239 
¸
->
«me_Àn
 = 
	`bam_«me_Àn
(
b
);

1242 
¸
->
«me_Àn
 = 0;

1244 
	`¸am_°©s_add
(
c
->
°©s
[
DS_RN
], 
¸
->
«me_Àn
);

1246 
	}
}

1253 
	$¸am_ícode_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
) {

1254 
i
, 
j
, 
¶i˚_off£t
;

1255 
¸am_block_com¥essi⁄_hdr
 *
h
 = 
c
->
comp_hdr
;

1256 
¸am_block
 *
c_hdr
;

1257 
mu…i_ªf
 = 0;

1258 
r1
, 
r2
, 
¢
, 
ƒef
;

1259 
•¨e_bams
 *
•¨es
;

1262 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

1263 
ƒef
 = 
fd
->
ªfs
->nref;

1264 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

1266 i‡(!
fd
->
no_ªf
 && 
c
->
ªfs_u£d
) {

1267 
i
 = 0; i < 
ƒef
; i++) {

1268 i‡(
c
->
ªfs_u£d
[
i
])

1269 
	`¸am_gë_ªf
(
fd
, 
i
, 1, 0);

1275 i‡(!
fd
->
no_ªf
) {

1276 
bam_£q_t
 *
b
 = 
c
->
bams
[0];

1277 *
ªf
;

1279 
ªf
 = 
	`¸am_gë_ªf
(
fd
, 
	`bam_ªf
(
b
), 1, 0);

1280 i‡(!
ªf
 && 
	`bam_ªf
(
b
) >= 0) {

1281 
	`Ârötf
(
°dîr
, "FaûedÅÿlﬂdÑe„ªn˚ #%d\n", 
	`bam_ªf
(
b
));

1284 i‡((
c
->
ªf_id
 = 
	`bam_ªf
(
b
)) >= 0) {

1285 
c
->
ªf_£q_id
 = c->
ªf_id
;

1286 
c
->
ªf
 = 
fd
->
ªfs
->
ªf_id
[c->
ªf_£q_id
]->
£q
;

1287 
c
->
ªf_°¨t
 = 1;

1288 
c
->
ªf_íd
 = 
fd
->
ªfs
->
ªf_id
[c->
ªf_£q_id
]->
Àngth
;

1290 
c
->
ªf_£q_id
 = c->
ªf_id
;

1293 
c
->
ªf_id
 = 
	`bam_ªf
(c->
bams
[0]);

1294 
	`¸am_ªf_ö¸
(
fd
->
ªfs
, 
c
->
ªf_id
);

1295 
c
->
ªf_£q_id
 = c->
ªf_id
;

1299 
r1
 = 
¢
 = 0;Ñ1 < 
c
->
cuº_c_ªc
; sn++) {

1300 
¸am_¶i˚
 *
s
 = 
c
->
¶i˚s
[
¢
];

1301 
fú°_ba£
 = 
INT_MAX
, 
œ°_ba£
 = 
INT_MIN
;

1303 
r1_°¨t
 = 
r1
;

1305 
	`as£π
(
¢
 < 
c
->
cuº_¶i˚
);

1309 i‡(
	`lossy_ªad_«mes
(
fd
, 
c
, 
s
, 
r1_°¨t
) != 0)

1314 
r2
 = 0; 
r1
 < 
c
->
cuº_c_ªc
 &&Ñ2 < 
s
->
hdr
->
num_ªc‹ds
;Ñ1++,Ñ2++) {

1315 
¸am_ªc‹d
 *
¸
 = &
s
->
¸ecs
[
r2
];

1316 
bam_£q_t
 *
b
 = 
c
->
bams
[
r1
];

1319 i‡(
c
->
mu…i_£q
 && !
fd
->
no_ªf
) {

1320 i‡(
	`bam_ªf
(
b
Ë!
c
->
ªf_£q_id
 && bam_ref(b) >= 0) {

1321 i‡(
c
->
ªf_£q_id
 >= 0)

1322 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
c
->
ªf_£q_id
);

1324 i‡(!
	`¸am_gë_ªf
(
fd
, 
	`bam_ªf
(
b
), 1, 0)) {

1325 
	`Ârötf
(
°dîr
, "FailedÅoÜoadÑeference #%d\n",

1326 
	`bam_ªf
(
b
));

1330 
c
->
ªf_£q_id
 = 
	`bam_ªf
(
b
);

1331 i‡(!
fd
->
ªfs
->
ªf_id
[
c
->
ªf_£q_id
]->
£q
)

1333 
c
->
ªf
 = 
fd
->
ªfs
->
ªf_id
[c->
ªf_£q_id
]->
£q
;

1334 
c
->
ªf_°¨t
 = 1;

1335 
c
->
ªf_íd
 = 
fd
->
ªfs
->
ªf_id
[c->
ªf_£q_id
]->
Àngth
;

1339 i‡(
	`¥o˚ss_⁄e_ªad
(
fd
, 
c
, 
s
, 
¸
, 
b
, 
r2
) != 0)

1342 i‡(
fú°_ba£
 > 
¸
->
≠os
)

1343 
fú°_ba£
 = 
¸
->
≠os
;

1345 i‡(
œ°_ba£
 < 
¸
->
´nd
)

1346 
œ°_ba£
 = 
¸
->
´nd
;

1354 
	`add_ªad_«mes
(
fd
, 
c
, 
s
, 
r1_°¨t
);

1356 i‡(
c
->
mu…i_£q
) {

1357 
s
->
hdr
->
ªf_£q_id
 = -2;

1358 
s
->
hdr
->
ªf_£q_°¨t
 = 0;

1359 
s
->
hdr
->
ªf_£q_•™
 = 0;

1361 
s
->
hdr
->
ªf_£q_id
 = 
c
->
ªf_id
;

1362 
s
->
hdr
->
ªf_£q_°¨t
 = 
fú°_ba£
;

1363 
s
->
hdr
->
ªf_£q_•™
 = 
	`MAX
(0, 
œ°_ba£
 - 
fú°_ba£
 + 1);

1365 
s
->
hdr
->
num_ªc‹ds
 = 
r2
;

1369 i‡(
c
->
ègs_u£d
->
n_occupõd
) {

1370 
¡ags
 = 
c
->
ègs_u£d
->
n_occupõd
;

1371 
s
->
aux_block
 = 
	`ˇŒoc
(
¡ags
, (*s->aux_block));

1372 i‡(!
s
->
aux_block
)

1375 
khöt_t
 
k
;

1377 
s
->
«ux_block
 = 0;

1378 
k
 = 
	`kh_begö
(
c
->
ègs_u£d
); k !
	`kh_íd
(c->tags_used); k++) {

1379 i‡(!
	`kh_exi°
(
c
->
ègs_u£d
, 
k
))

1382 
¸am_èg_m≠
 *
tm
 = 
	`kh_vÆ
(
c
->
ègs_u£d
, 
k
);

1383 i‡(!
tm
->
blk
) ;

1384 
s
->
aux_block
[s->
«ux_block
++] = 
tm
->
blk
;

1385 
tm
->
blk
 = 
NULL
;

1387 
	`as£π
(
s
->
«ux_block
 <
c
->
ègs_u£d
->
n_occupõd
);

1391 i‡(
c
->
mu…i_£q
 && !
fd
->
no_ªf
) {

1392 i‡(
c
->
ªf_£q_id
 >= 0)

1393 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
c
->
ªf_£q_id
);

1397 
•¨es
 = 
	`mÆloc
((*spares));

1398 
	`±hªad_muãx_lock
(&
fd
->
bam_li°_lock
);

1399 
•¨es
->
bams
 = 
c
->bams;

1400 
•¨es
->
√xt
 = 
fd
->
bl
;

1401 
fd
->
bl
 = 
•¨es
;

1402 
	`±hªad_muãx_u∆ock
(&
fd
->
bam_li°_lock
);

1403 
c
->
bams
 = 
NULL
;

1406 
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[
DS_RI
]);

1407 
mu…i_ªf
 = 
c
->
°©s
[
DS_RI
]->
nvÆs
 > 1;

1409 i‡(
mu…i_ªf
) {

1410 i‡(
fd
->
vîbo£
)

1411 
	`Ârötf
(
°dîr
, "Multi-ref container\n");

1412 
c
->
ªf_£q_id
 = -2;

1413 
c
->
ªf_£q_°¨t
 = 0;

1414 
c
->
ªf_£q_•™
 = 0;

1419 
i
 = 0; i < 
c
->
cuº_¶i˚
; i++) {

1420 
¸am_¶i˚
 *
s
 = 
c
->
¶i˚s
[
i
];

1422 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) != 1) {

1423 i‡(
s
->
hdr
->
ªf_£q_id
 >0 && 
c
->
mu…i_£q
 =0 && !
fd
->
no_ªf
) {

1424 
hts_md5_c⁄ãxt
 *
md5
 = 
	`hts_md5_öô
();

1425 i‡(!
md5
)

1427 
	`hts_md5_upd©e
(
md5
,

1428 
c
->
ªf
 + 
s
->
hdr
->
ªf_£q_°¨t
 - c->
ªf_°¨t
,

1429 
s
->
hdr
->
ªf_£q_•™
);

1430 
	`hts_md5_föÆ
(
s
->
hdr
->
md5
, md5);

1431 
	`hts_md5_de°roy
(
md5
);

1433 
	`mem£t
(
s
->
hdr
->
md5
, 0, 16);

1438 
c
->
num_ªc‹ds
 = 0;

1439 
c
->
num_blocks
 = 1;

1440 
c
->
Àngth
 = 0;

1443 
h
->
codecs
[
DS_BF
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_BF]),

1444 
c
->
°©s
[
DS_BF
], 
E_INT
, 
NULL
,

1445 
fd
->
vîsi⁄
);

1448 
h
->
codecs
[
DS_CF
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_CF]),

1449 
c
->
°©s
[
DS_CF
], 
E_INT
, 
NULL
,

1450 
fd
->
vîsi⁄
);

1457 i‡(
c
->
pos_s‹ãd
) {

1458 
h
->
codecs
[
DS_AP
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_AP]),

1459 
c
->
°©s
[
DS_AP
], 
E_INT
, 
NULL
,

1460 
fd
->
vîsi⁄
);

1462 
p
[2] = {0, 
c
->
max_≠os
};

1463 
h
->
codecs
[
DS_AP
] = 
	`¸am_ícodî_öô
(
E_BETA
, 
NULL
, 
E_INT
, 
p
,

1464 
fd
->
vîsi⁄
);

1468 
h
->
codecs
[
DS_RG
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_RG]),

1469 
c
->
°©s
[
DS_RG
], 
E_INT
, 
NULL
,

1470 
fd
->
vîsi⁄
);

1473 
h
->
codecs
[
DS_MQ
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_MQ]),

1474 
c
->
°©s
[
DS_MQ
], 
E_INT
, 
NULL
,

1475 
fd
->
vîsi⁄
);

1478 
h
->
codecs
[
DS_NS
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_NS]),

1479 
c
->
°©s
[
DS_NS
], 
E_INT
, 
NULL
,

1480 
fd
->
vîsi⁄
);

1483 
h
->
codecs
[
DS_MF
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_MF]),

1484 
c
->
°©s
[
DS_MF
], 
E_INT
, 
NULL
,

1485 
fd
->
vîsi⁄
);

1488 
h
->
codecs
[
DS_TS
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_TS]),

1489 
c
->
°©s
[
DS_TS
], 
E_INT
, 
NULL
,

1490 
fd
->
vîsi⁄
);

1492 
h
->
codecs
[
DS_NP
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_NP]),

1493 
c
->
°©s
[
DS_NP
], 
E_INT
, 
NULL
,

1494 
fd
->
vîsi⁄
);

1496 
h
->
codecs
[
DS_NF
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_NF]),

1497 
c
->
°©s
[
DS_NF
], 
E_INT
, 
NULL
,

1498 
fd
->
vîsi⁄
);

1501 
h
->
codecs
[
DS_RL
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_RL]),

1502 
c
->
°©s
[
DS_RL
], 
E_INT
, 
NULL
,

1503 
fd
->
vîsi⁄
);

1506 
h
->
codecs
[
DS_FN
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_FN]),

1507 
c
->
°©s
[
DS_FN
], 
E_INT
, 
NULL
,

1508 
fd
->
vîsi⁄
);

1511 
h
->
codecs
[
DS_FC
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_FC]),

1512 
c
->
°©s
[
DS_FC
], 
E_BYTE
, 
NULL
,

1513 
fd
->
vîsi⁄
);

1516 
h
->
codecs
[
DS_FP
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_FP]),

1517 
c
->
°©s
[
DS_FP
], 
E_INT
, 
NULL
,

1518 
fd
->
vîsi⁄
);

1521 
h
->
codecs
[
DS_DL
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_DL]),

1522 
c
->
°©s
[
DS_DL
], 
E_INT
, 
NULL
,

1523 
fd
->
vîsi⁄
);

1526 
h
->
codecs
[
DS_BA
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_BA]),

1527 
c
->
°©s
[
DS_BA
], 
E_BYTE
, 
NULL
,

1528 
fd
->
vîsi⁄
);

1530 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

1531 
¸am_byã_¨øy_Àn_ícodî
 
e
;

1533 
e
.
Àn_ícodög
 = 
E_EXTERNAL
;

1534 
e
.
Àn_d©
 = (*)
DS_BB_Àn
;

1537 
e
.
vÆ_ícodög
 = 
E_EXTERNAL
;

1538 
e
.
vÆ_d©
 = (*)
DS_BB
;

1540 
h
->
codecs
[
DS_BB
] = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_LEN
, 
NULL
,

1541 
E_BYTE_ARRAY
, (*)&
e
,

1542 
fd
->
vîsi⁄
);

1544 
h
->
codecs
[
DS_BB
] = 
NULL
;

1548 
h
->
codecs
[
DS_BS
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_BS]),

1549 
c
->
°©s
[
DS_BS
], 
E_BYTE
, 
NULL
,

1550 
fd
->
vîsi⁄
);

1552 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

1553 
h
->
codecs
[
DS_TL
] = 
NULL
;

1554 
h
->
codecs
[
DS_RI
] = 
NULL
;

1555 
h
->
codecs
[
DS_RS
] = 
NULL
;

1556 
h
->
codecs
[
DS_PD
] = 
NULL
;

1557 
h
->
codecs
[
DS_HC
] = 
NULL
;

1558 
h
->
codecs
[
DS_SC
] = 
NULL
;

1561 
h
->
codecs
[
DS_TC
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_TC]),

1562 
c
->
°©s
[
DS_TC
], 
E_BYTE
, 
NULL
,

1563 
fd
->
vîsi⁄
);

1566 
h
->
codecs
[
DS_TN
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_TN]),

1567 
c
->
°©s
[
DS_TN
], 
E_INT
, 
NULL
,

1568 
fd
->
vîsi⁄
);

1570 
h
->
codecs
[
DS_TC
] = 
NULL
;

1571 
h
->
codecs
[
DS_TN
] = 
NULL
;

1574 
h
->
codecs
[
DS_TL
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_TL]),

1575 
c
->
°©s
[
DS_TL
], 
E_INT
, 
NULL
,

1576 
fd
->
vîsi⁄
);

1580 
h
->
codecs
[
DS_RI
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_RI]),

1581 
c
->
°©s
[
DS_RI
], 
E_INT
, 
NULL
,

1582 
fd
->
vîsi⁄
);

1585 
h
->
codecs
[
DS_RS
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_RS]),

1586 
c
->
°©s
[
DS_RS
], 
E_INT
, 
NULL
,

1587 
fd
->
vîsi⁄
);

1590 
h
->
codecs
[
DS_PD
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_PD]),

1591 
c
->
°©s
[
DS_PD
], 
E_INT
, 
NULL
,

1592 
fd
->
vîsi⁄
);

1595 
h
->
codecs
[
DS_HC
] = 
	`¸am_ícodî_öô
(
	`¸am_°©s_ícodög
(
fd
, 
c
->
°©s
[DS_HC]),

1596 
c
->
°©s
[
DS_HC
], 
E_INT
, 
NULL
,

1597 
fd
->
vîsi⁄
);

1601 
i2
[2] = {0, 
DS_SC
};

1603 
h
->
codecs
[
DS_SC
] = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_STOP
, 
NULL
,

1604 
E_BYTE_ARRAY
, (*)
i2
,

1605 
fd
->
vîsi⁄
);

1610 
¸am_byã_¨øy_Àn_ícodî
 
e
;

1612 
e
.
Àn_ícodög
 = 
E_EXTERNAL
;

1613 
e
.
Àn_d©
 = (*)
DS_SC_Àn
;

1615 
e
.
vÆ_ícodög
 = 
E_EXTERNAL
;

1616 
e
.
vÆ_d©
 = (*)
DS_SC
;

1618 
h
->
codecs
[
DS_SC
] = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_LEN
, 
NULL
,

1619 
E_BYTE_ARRAY
, (*)&
e
,

1620 
fd
->
vîsi⁄
);

1626 
i2
[2] = {0, 
DS_IN
};

1627 
h
->
codecs
[
DS_IN
] = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_STOP
, 
NULL
,

1628 
E_BYTE_ARRAY
, (*)
i2
,

1629 
fd
->
vîsi⁄
);

1632 
h
->
codecs
[
DS_QS
] = 
	`¸am_ícodî_öô
(
E_EXTERNAL
, 
NULL
, 
E_BYTE
,

1633 (*)
DS_QS
,

1634 
fd
->
vîsi⁄
);

1636 
i2
[2] = {0, 
DS_RN
};

1637 
h
->
codecs
[
DS_RN
] = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_STOP
, 
NULL
,

1638 
E_BYTE_ARRAY
, (*)
i2
,

1639 
fd
->
vîsi⁄
);

1644 
i
 = 0; i < 
c
->
cuº_¶i˚
; i++) {

1645 i‡(
fd
->
vîbo£
)

1646 
	`Ârötf
(
°dîr
, "Encodê¶i˚ %d\n", 
i
);

1648 i‡(
	`¸am_ícode_¶i˚
(
fd
, 
c
, 
h
, c->
¶i˚s
[
i
]) != 0)

1654 
h
->
ªf_£q_id
 = 
c
->ref_seq_id;

1655 
h
->
ªf_£q_°¨t
 = 
c
->ref_seq_start;

1656 
h
->
ªf_£q_•™
 = 
c
->ref_seq_span;

1657 
h
->
num_ªc‹ds
 = 
c
->num_records;

1659 
h
->
m≠≥d_qs_ö˛uded
 = 0;

1660 
h
->
unm≠≥d_qs_ö˛uded
 = 0;

1661 
h
->
AP_dñè
 = 
c
->
pos_s‹ãd
;

1663 
	`mem˝y
(
h
->
sub°ôuti⁄_m©rix
, 
CRAM_SUBST_MATRIX
, 20);

1665 i‡(!(
c_hdr
 = 
	`¸am_ícode_com¥essi⁄_hódî
(
fd
, 
c
, 
h
)))

1671 
c
->
num_œndm¨ks
 = c->
cuº_¶i˚
;

1672 
c
->
œndm¨k
 = 
	`mÆloc
(c->
num_œndm¨ks
 * (*c->landmark));

1673 i‡(!
c
->
œndm¨k
)

1681 
¶i˚_off£t
 = 
c_hdr
->
mëhod
 =
RAW


1682 ? 
c_hdr
->
uncomp_size


1683 : 
c_hdr
->
comp_size
;

1684 
¶i˚_off£t
 +2 + 4*(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) +

1685 
	`ôf8_size
(
c_hdr
->
c⁄ã¡_id
) +

1686 
	`ôf8_size
(
c_hdr
->
comp_size
) +

1687 
	`ôf8_size
(
c_hdr
->
uncomp_size
);

1690 
c
->
ªf_£q_id
 = c->
¶i˚s
[0]->
hdr
->ref_seq_id;

1691 
c
->
ªf_£q_°¨t
 = c->
¶i˚s
[0]->
hdr
->ref_seq_start;

1692 
c
->
ªf_£q_•™
 = c->
¶i˚s
[0]->
hdr
->ref_seq_span;

1693 
i
 = 0; i < 
c
->
cuº_¶i˚
; i++) {

1694 
¸am_¶i˚
 *
s
 = 
c
->
¶i˚s
[
i
];

1696 
c
->
num_blocks
 +
s
->
hdr
->num_blocks + 1;

1697 
c
->
œndm¨k
[
i
] = 
¶i˚_off£t
;

1699 i‡(
s
->
hdr
->
ªf_£q_°¨t
 + s->hdr->
ªf_£q_•™
 >

1700 
c
->
ªf_£q_°¨t
 + c->
ªf_£q_•™
) {

1701 
c
->
ªf_£q_•™
 = 
s
->
hdr
->
ªf_£q_°¨t
 + s->hdr->ref_seq_span

1702 - 
c
->
ªf_£q_°¨t
;

1705 
¶i˚_off£t
 +
s
->
hdr_block
->
mëhod
 =
RAW


1706 ? 
s
->
hdr_block
->
uncomp_size


1707 : 
s
->
hdr_block
->
comp_size
;

1709 
¶i˚_off£t
 +2 + 4*(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) +

1710 
	`ôf8_size
(
s
->
hdr_block
->
c⁄ã¡_id
) +

1711 
	`ôf8_size
(
s
->
hdr_block
->
comp_size
) +

1712 
	`ôf8_size
(
s
->
hdr_block
->
uncomp_size
);

1714 
j
 = 0; j < 
s
->
hdr
->
num_blocks
; j++) {

1715 
¶i˚_off£t
 +2 + 4*(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) +

1716 
	`ôf8_size
(
s
->
block
[
j
]->
c⁄ã¡_id
) +

1717 
	`ôf8_size
(
s
->
block
[
j
]->
comp_size
) +

1718 
	`ôf8_size
(
s
->
block
[
j
]->
uncomp_size
);

1720 
¶i˚_off£t
 +
s
->
block
[
j
]->
mëhod
 =
RAW


1721 ? 
s
->
block
[
j
]->
uncomp_size


1722 : 
s
->
block
[
j
]->
comp_size
;

1725 
c
->
Àngth
 +
¶i˚_off£t
;

1727 
c
->
comp_hdr_block
 = 
c_hdr
;

1729 i‡(
c
->
ªf_£q_id
 >= 0) {

1730 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
c
->
ªf_£q_id
);

1734 i‡(!
fd
->
no_ªf
 && 
c
->
ªfs_u£d
) {

1735 
i
 = 0; i < 
fd
->
ªfs
->
ƒef
; i++) {

1736 i‡(
c
->
ªfs_u£d
[
i
])

1737 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
i
);

1742 
	}
}

1754 
	$¸am_add_„©uª
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
,

1755 
¸am_ªc‹d
 *
r
, 
¸am_„©uª
 *
f
) {

1756 i‡(
s
->
n„©uªs
 >s->
a„©uªs
) {

1757 
s
->
a„©uªs
 = s->afeatures ? s->afeatures*2 : 1024;

1758 
s
->
„©uªs
 = 
	`ªÆloc
(s->„©uªs, s->
a„©uªs
*(*s->features));

1759 i‡(!
s
->
„©uªs
)

1763 i‡(!
r
->
n„©uª
++) {

1764 
r
->
„©uª
 = 
s
->
n„©uªs
;

1765 
	`¸am_°©s_add
(
c
->
°©s
[
DS_FP
], 
f
->
X
.
pos
);

1767 
	`¸am_°©s_add
(
c
->
°©s
[
DS_FP
],

1768 
f
->
X
.
pos
 - 
s
->
„©uªs
[
r
->
„©uª
 +Ñ->
n„©uª
-2].X.pos);

1770 
	`¸am_°©s_add
(
c
->
°©s
[
DS_FC
], 
f
->
X
.
code
);

1772 
s
->
„©uªs
[s->
n„©uªs
++] = *
f
;

1775 
	}
}

1777 
	$¸am_add_sub°ôuti⁄
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

1778 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1779 
pos
, 
ba£
, 
quÆ
, 
ªf
) {

1780 
¸am_„©uª
 
f
;

1783 i‡(
fd
->
L2
[(
uc
)
ba£
]<4 || (fd->L2[(uc)ba£]<5 && fd->L2[(uc)
ªf
]<4)) {

1784 
f
.
X
.
pos
 =Öos+1;

1785 
f
.
X
.
code
 = 'X';

1786 
f
.
X
.
ba£
 = 
fd
->
¸am_sub_m©rix
[
ªf
&0x1f][base&0x1f];

1787 
	`¸am_°©s_add
(
c
->
°©s
[
DS_BS
], 
f
.
X
.
ba£
);

1789 
f
.
B
.
pos
 =Öos+1;

1790 
f
.
B
.
code
 = 'B';

1791 
f
.
B
.
ba£
 = base;

1792 
f
.
B
.
quÆ
 = qual;

1793 
	`¸am_°©s_add
(
c
->
°©s
[
DS_BA
], 
f
.
B
.
ba£
);

1794 
	`¸am_°©s_add
(
c
->
°©s
[
DS_QS
], 
f
.
B
.
quÆ
);

1795 
	`BLOCK_APPEND_CHAR
(
s
->
quÆ_blk
, 
quÆ
);

1797  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1798 
	}
}

1800 
	$¸am_add_ba£s
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

1801 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1802 
pos
, 
Àn
, *
ba£
) {

1803 
¸am_„©uª
 
f
;

1805 
f
.
b
.
pos
 =Öos+1;

1806 
f
.
b
.
code
 = 'b';

1807 
f
.
b
.
£q_idx
 = 
ba£
 - (*)
	`BLOCK_DATA
(
s
->
£qs_blk
);

1808 
f
.
b
.
Àn
 =Üen;

1810  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1811 
	}
}

1813 
	$¸am_add_ba£
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

1814 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1815 
pos
, 
ba£
, 
quÆ
) {

1816 
¸am_„©uª
 
f
;

1817 
f
.
B
.
pos
 =Öos+1;

1818 
f
.
B
.
code
 = 'B';

1819 
f
.
B
.
ba£
 = base;

1820 
f
.
B
.
quÆ
 = qual;

1821 
	`¸am_°©s_add
(
c
->
°©s
[
DS_BA
], 
ba£
);

1822 
	`¸am_°©s_add
(
c
->
°©s
[
DS_QS
], 
quÆ
);

1823 
	`BLOCK_APPEND_CHAR
(
s
->
quÆ_blk
, 
quÆ
);

1824  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1825 
	}
}

1827 
	$¸am_add_quÆôy
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

1828 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1829 
pos
, 
quÆ
) {

1830 
¸am_„©uª
 
f
;

1831 
f
.
Q
.
pos
 =Öos+1;

1832 
f
.
Q
.
code
 = 'Q';

1833 
f
.
Q
.
quÆ
 = qual;

1834 
	`¸am_°©s_add
(
c
->
°©s
[
DS_QS
], 
quÆ
);

1835 
	`BLOCK_APPEND_CHAR
(
s
->
quÆ_blk
, 
quÆ
);

1836  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1837 
	}
}

1839 
	$¸am_add_dñëi⁄
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1840 
pos
, 
Àn
, *
ba£
) {

1841 
¸am_„©uª
 
f
;

1842 
f
.
D
.
pos
 =Öos+1;

1843 
f
.
D
.
code
 = 'D';

1844 
f
.
D
.
Àn
 =Üen;

1845 
	`¸am_°©s_add
(
c
->
°©s
[
DS_DL
], 
Àn
);

1846  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1847 
	}
}

1849 
	$¸am_add_so·˛ù
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1850 
pos
, 
Àn
, *
ba£
, 
vîsi⁄
) {

1851 
¸am_„©uª
 
f
;

1852 
f
.
S
.
pos
 =Öos+1;

1853 
f
.
S
.
code
 = 'S';

1854 
f
.
S
.
Àn
 =Üen;

1855 
	`CRAM_MAJOR_VERS
(
vîsi⁄
)) {

1857 
f
.
S
.
£q_idx
 = 
	`BLOCK_SIZE
(
s
->
ba£_blk
);

1858 
	`BLOCK_APPEND
(
s
->
ba£_blk
, 
ba£
, 
Àn
);

1859 
	`BLOCK_APPEND_CHAR
(
s
->
ba£_blk
, '\0');

1864 
f
.
S
.
£q_idx
 = 
	`BLOCK_SIZE
(
s
->
so·_blk
);

1865 i‡(
ba£
) {

1866 
	`BLOCK_APPEND
(
s
->
so·_blk
, 
ba£
, 
Àn
);

1868 
i
;

1869 
i
 = 0; i < 
Àn
; i++)

1870 
	`BLOCK_APPEND_CHAR
(
s
->
so·_blk
, 'N');

1872 
	`BLOCK_APPEND_CHAR
(
s
->
so·_blk
, '\0');

1879  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1880 
	}
}

1882 
	$¸am_add_h¨d˛ù
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1883 
pos
, 
Àn
, *
ba£
) {

1884 
¸am_„©uª
 
f
;

1885 
f
.
S
.
pos
 =Öos+1;

1886 
f
.
S
.
code
 = 'H';

1887 
f
.
S
.
Àn
 =Üen;

1888 
	`¸am_°©s_add
(
c
->
°©s
[
DS_HC
], 
Àn
);

1889  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1890 
	}
}

1892 
	$¸am_add_skù
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1893 
pos
, 
Àn
, *
ba£
) {

1894 
¸am_„©uª
 
f
;

1895 
f
.
S
.
pos
 =Öos+1;

1896 
f
.
S
.
code
 = 'N';

1897 
f
.
S
.
Àn
 =Üen;

1898 
	`¸am_°©s_add
(
c
->
°©s
[
DS_RS
], 
Àn
);

1899  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1900 
	}
}

1902 
	$¸am_add_∑d
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1903 
pos
, 
Àn
, *
ba£
) {

1904 
¸am_„©uª
 
f
;

1905 
f
.
S
.
pos
 =Öos+1;

1906 
f
.
S
.
code
 = 'P';

1907 
f
.
S
.
Àn
 =Üen;

1908 
	`¸am_°©s_add
(
c
->
°©s
[
DS_PD
], 
Àn
);

1909  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1910 
	}
}

1912 
	$¸am_add_ö£πi⁄
(
¸am_c⁄èöî
 *
c
, 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
r
,

1913 
pos
, 
Àn
, *
ba£
) {

1914 
¸am_„©uª
 
f
;

1915 
f
.
I
.
pos
 =Öos+1;

1916 i‡(
Àn
 == 1) {

1917 
b
 = 
ba£
 ? *base : 'N';

1918 
f
.
i
.
code
 = 'i';

1919 
f
.
i
.
ba£
 = 
b
;

1920 
	`¸am_°©s_add
(
c
->
°©s
[
DS_BA
], 
b
);

1922 
f
.
I
.
code
 = 'I';

1923 
f
.
I
.
Àn
 =Üen;

1924 
f
.
S
.
£q_idx
 = 
	`BLOCK_SIZE
(
s
->
ba£_blk
);

1925 i‡(
ba£
) {

1926 
	`BLOCK_APPEND
(
s
->
ba£_blk
, 
ba£
, 
Àn
);

1928 
i
;

1929 
i
 = 0; i < 
Àn
; i++)

1930 
	`BLOCK_APPEND_CHAR
(
s
->
ba£_blk
, 'N');

1932 
	`BLOCK_APPEND_CHAR
(
s
->
ba£_blk
, '\0');

1934  
	`¸am_add_„©uª
(
c
, 
s
, 
r
, &
f
);

1935 
	}
}

1942 *
	$¸am_ícode_aux_1_0
(
¸am_fd
 *
fd
, 
bam_£q_t
 *
b
, 
¸am_c⁄èöî
 *
c
,

1943 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
¸
) {

1944 *
aux
, *
tmp
, *
rg
 = 
NULL
;

1945 
aux_size
 = 
	`bam_blk_size
(
b
) -

1946 ((*)
	`bam_aux
(
b
Ë- (*)&
	`bam_ªf
(b));

1949 
	`BLOCK_GROW
(
s
->
aux_blk
, 
aux_size
*1.34+1);

1950 
tmp
 = (*)
	`BLOCK_END
(
s
->
aux_blk
);

1952 
aux
 = (*)
	`bam_aux
(
b
);

1953 
¸
->
TN_idx
 = 
s
->
nTN
;

1955 
aux
[0] != 0) {

1956 
öt32_t
 
i32
;

1957 
r
;

1959 i‡(
aux
[0] == 'R' &&áux[1] == 'G' &&áux[2] == 'Z') {

1960 
rg
 = &
aux
[3];

1961 *
aux
++);

1964 i‡(
aux
[0] == 'M' &&áux[1] == 'D' &&áux[2] == 'Z') {

1965 *
aux
++);

1968 i‡(
aux
[0] == 'N' &&áux[1] == 'M') {

1969 
aux
[2]) {

1970 'A': 'C': 'c': 
aux
+=4; ;

1971 'I': 'i': 'f': 
aux
+=7; ;

1973 
	`Ârötf
(
°dîr
, "UnhandledÅype code for NMÅag\n");

1974  
NULL
;

1979 
¸
->
¡ags
++;

1981 
i32
 = (
aux
[0]<<16) | (aux[1]<<8) |áux[2];

1982 
	`kh_put
(
m_ègm≠
, 
c
->
ègs_u£d
, 
i32
, &
r
);

1983 i‡(-1 =
r
)

1984  
NULL
;

1986 i‡(
s
->
nTN
 >s->
aTN
) {

1987 
s
->
aTN
 = s->aTN ? s->aTN*2 : 1024;

1988 i‡(!(
s
->
TN
 = 
	`ªÆloc
(s->TN, s->
aTN
 * (*s->TN))))

1989  
NULL
;

1991 
s
->
TN
[s->
nTN
++] = 
i32
;

1992 
	`¸am_°©s_add
(
c
->
°©s
[
DS_TN
], 
i32
);

1994 
aux
[2]) {

1996 
aux
+=3;

1997 *
tmp
++=*
aux
++;

2001 
aux
+=3;

2002 *
tmp
++=*
aux
++; *tmp++=*aux++;

2006 
aux
+=3;

2007 *
tmp
++=*
aux
++; *tmp++=*aux++; *tmp++=*aux++; *tmp++=*aux++;

2011 
aux
+=3;

2012 *
tmp
++=*
aux
++; *tmp++=*aux++; *tmp++=*aux++; *tmp++=*aux++;

2013 *
tmp
++=*
aux
++; *tmp++=*aux++; *tmp++=*aux++; *tmp++=*aux++;

2017 
aux
+=3;

2018 (*
tmp
++=*
aux
++));

2019 *
tmp
++ = '\t';

2023 
ty≥
 = 
aux
[3], 
bÀn
;

2024 
uöt32_t
 
cou¡
 = (uöt32_t)((((*)
aux
)[4]<< 0) +

2025 (((*)
aux
)[5]<< 8) +

2026 (((*)
aux
)[6]<<16) +

2027 (((*)
aux
)[7]<<24));

2029 
aux
+=3;

2032 
ty≥
) {

2034 
bÀn
 = 
cou¡
;

2037 
bÀn
 = 2*
cou¡
;

2040 
bÀn
 = 4*
cou¡
;

2043 
	`Ârötf
(
°dîr
, "Unknown sub-type '%c' foráuxÅype 'B'\n",

2044 
ty≥
);

2045  
NULL
;

2049 
tmp
 +
	`ôf8_put
—mp, 
bÀn
+5);

2051 *
tmp
++=*
aux
++;

2052 *
tmp
++=*
aux
++; *tmp++=*aux++; *tmp++=*aux++; *tmp++=*aux++;

2055 
	`mem˝y
(
tmp
, 
aux
, 
bÀn
);Åmp += blen;áux += blen;

2061 
	`Ârötf
(
°dîr
, "Unknow¿auxÅy≥ '%c'\n", 
aux
[2]);

2062  
NULL
;

2065 
	`¸am_°©s_add
(
c
->
°©s
[
DS_TC
], 
¸
->
¡ags
);

2067 
¸
->
aux
 = 
	`BLOCK_SIZE
(
s
->
aux_blk
);

2068 
¸
->
aux_size
 = (
uc
 *)
tmp
 - (
	`BLOCK_DATA
(
s
->
aux_blk
Ë+ cr->
aux
);

2069 
	`BLOCK_SIZE
(
s
->
aux_blk
Ë(
uc
 *)
tmp
 - 
	`BLOCK_DATA
(s->aux_blk);

2070 
	`as£π
(
s
->
aux_blk
->
byã
 <s->aux_blk->
Æloc
);

2072  
rg
;

2073 
	}
}

2082 *
	$¸am_ícode_aux
(
¸am_fd
 *
fd
, 
bam_£q_t
 *
b
, 
¸am_c⁄èöî
 *
c
,

2083 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
¸
) {

2084 *
aux
, *
‹ig
, *
rg
 = 
NULL
;

2085 
aux_size
 = 
	`bam_gë_l_aux
(
b
);

2086 
¸am_block
 *
td_b
 = 
c
->
comp_hdr
->
TD_blk
;

2087 
TD_blk_size
 = 
	`BLOCK_SIZE
(
td_b
), 
√w
;

2088 *
key
;

2089 
khöt_t
 
k
;

2091 
‹ig
 = 
aux
 = (*)
	`bam_aux
(
b
);

2094 
aux
 - 
‹ig
 < 
aux_size
 &&áux[0] != 0) {

2095 
r
;

2098 i‡(
aux
[0] == 'R' &&áux[1] == 'G' &&áux[2] == 'Z') {

2099 
rg
 = &
aux
[3];

2100 *
aux
++);

2105 i‡(
aux
[0] == 'M' &&áux[1] == 'D' &&áux[2] == 'Z') {

2106 i‡(
¸
->
Àn
 && !
fd
->
no_ªf
 && !(¸->
Êags
 & 
BAM_FUNMAP
)) {

2107 *
aux
++);

2113 i‡(
aux
[0] == 'N' &&áux[1] == 'M') {

2114 i‡(
¸
->
Àn
 && !
fd
->
no_ªf
 && !(¸->
Êags
 & 
BAM_FUNMAP
)) {

2115 
aux
[2]) {

2116 'A': 'C': 'c': 
aux
+=4; ;

2117 'S': 's': 
aux
+=5; ;

2118 'I': 'i': 'f': 
aux
+=7; ;

2120 
	`Ârötf
(
°dîr
, "UnhandledÅype code for NMÅag\n");

2121  
NULL
;

2127 
	`BLOCK_APPEND
(
td_b
, 
aux
, 3);

2131 
key
 = (
aux
[0]<<16)|(aux[1]<<8)|aux[2];

2132 
k
 = 
	`kh_put
(
m_ègm≠
, 
c
->
ègs_u£d
, 
key
, &
r
);

2133 i‡(-1 =
r
)

2134  
NULL
;

2136 i‡(
r
 == 1) {

2137 
khöt_t
 
k_globÆ
;

2140 
	`±hªad_muãx_lock
(&
fd
->
mërics_lock
);

2141 
k_globÆ
 = 
	`kh_put
(
m_mërics
, 
fd
->
ègs_u£d
, 
key
, &
r
);

2142 i‡(-1 =
r
)

2143  
NULL
;

2144 i‡(
r
 == 1)

2145 
	`kh_vÆ
(
fd
->
ègs_u£d
, 
k_globÆ
Ë
	`¸am_√w_mërics
();

2147 
	`±hªad_muãx_u∆ock
(&
fd
->
mërics_lock
);

2149 
i2
[2] = {'\t',
key
};

2150 
size_t
 
sk
 = 
key
;

2151 
¸am_èg_m≠
 *
m
 = 
	`ˇŒoc
(1, (*m));

2152 
	`kh_vÆ
(
c
->
ègs_u£d
, 
k
Ë
m
;

2154 
¸am_codec
 *
c
;

2158 
aux
[2]) {

2161 
c
 = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_STOP
, 
NULL
,

2162 
E_BYTE_ARRAY
, (*)
i2
,

2163 
fd
->
vîsi⁄
);

2168 
¸am_byã_¨øy_Àn_ícodî
 
e
;

2169 
¸am_°©s
 
°
;

2171 
e
.
Àn_ícodög
 = 
E_HUFFMAN
;

2172 
e
.
Àn_d©
 = 
NULL
;

2173 
	`mem£t
(&
°
, 0, (st));

2174 
	`¸am_°©s_add
(&
°
, 1);

2175 
	`¸am_°©s_ícodög
(
fd
, &
°
);

2177 
e
.
vÆ_ícodög
 = 
E_EXTERNAL
;

2178 
e
.
vÆ_d©
 = (*)
sk
;

2180 
c
 = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_LEN
, &
°
,

2181 
E_BYTE_ARRAY
, (*)&
e
,

2182 
fd
->
vîsi⁄
);

2188 
¸am_byã_¨øy_Àn_ícodî
 
e
;

2189 
¸am_°©s
 
°
;

2191 
e
.
Àn_ícodög
 = 
E_HUFFMAN
;

2192 
e
.
Àn_d©
 = 
NULL
;

2193 
	`mem£t
(&
°
, 0, (st));

2194 
	`¸am_°©s_add
(&
°
, 2);

2195 
	`¸am_°©s_ícodög
(
fd
, &
°
);

2197 
e
.
vÆ_ícodög
 = 
E_EXTERNAL
;

2198 
e
.
vÆ_d©
 = (*)
sk
;

2200 
c
 = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_LEN
, &
°
,

2201 
E_BYTE_ARRAY
, (*)&
e
,

2202 
fd
->
vîsi⁄
);

2207 
¸am_byã_¨øy_Àn_ícodî
 
e
;

2208 
¸am_°©s
 
°
;

2210 
e
.
Àn_ícodög
 = 
E_HUFFMAN
;

2211 
e
.
Àn_d©
 = 
NULL
;

2212 
	`mem£t
(&
°
, 0, (st));

2213 
	`¸am_°©s_add
(&
°
, 4);

2214 
	`¸am_°©s_ícodög
(
fd
, &
°
);

2216 
e
.
vÆ_ícodög
 = 
E_EXTERNAL
;

2217 
e
.
vÆ_d©
 = (*)
sk
;

2219 
c
 = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_LEN
, &
°
,

2220 
E_BYTE_ARRAY
, (*)&
e
,

2221 
fd
->
vîsi⁄
);

2231 
¸am_byã_¨øy_Àn_ícodî
 
e
;

2233 
e
.
Àn_ícodög
 = 
E_EXTERNAL
;

2234 
e
.
Àn_d©
 = (*)
sk
;

2236 
e
.
vÆ_ícodög
 = 
E_EXTERNAL
;

2237 
e
.
vÆ_d©
 = (*)
sk
;

2239 
c
 = 
	`¸am_ícodî_öô
(
E_BYTE_ARRAY_LEN
, 
NULL
,

2240 
E_BYTE_ARRAY
, (*)&
e
,

2241 
fd
->
vîsi⁄
);

2246 
	`Ârötf
(
°dîr
, "Unsupported SAMáuxÅype '%c'\n",

2247 
aux
[2]);

2248 
c
 = 
NULL
;

2251 
m
->
codec
 = 
c
;

2254 
m
->m = 
k_globÆ
 ? (
¸am_mërics
 *)
	`kh_vÆ
(
fd
->
ègs_u£d
, k_globÆË: 
NULL
;

2257 
¸am_èg_m≠
 *
tm
 = (¸am_èg_m≠ *)
	`kh_vÆ
(
c
->
ègs_u£d
, 
k
);

2258 
¸am_codec
 *
codec
 = 
tm
->codec;

2260 
aux
[2]) {

2262 i‡(!
tm
->
blk
) {

2263 i‡(!(
tm
->
blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
key
)))

2264  
NULL
;

2265 
codec
->
e_byã_¨øy_Àn
.
vÆ_codec
->
out
 = 
tm
->
blk
;

2268 
aux
+=3;

2271 
	`BLOCK_APPEND_CHAR
(
tm
->
blk
, *
aux
);

2272 
aux
++;

2276 i‡(!
tm
->
blk
) {

2277 i‡(!(
tm
->
blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
key
)))

2278  
NULL
;

2279 
codec
->
e_byã_¨øy_Àn
.
vÆ_codec
->
out
 = 
tm
->
blk
;

2282 
aux
+=3;

2284 
	`BLOCK_APPEND
(
tm
->
blk
, 
aux
, 2);

2285 
aux
+=2;

2289 i‡(!
tm
->
blk
) {

2290 i‡(!(
tm
->
blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
key
)))

2291  
NULL
;

2292 
codec
->
e_byã_¨øy_Àn
.
vÆ_codec
->
out
 = 
tm
->
blk
;

2295 
aux
+=3;

2297 
	`BLOCK_APPEND
(
tm
->
blk
, 
aux
, 4);

2298 
aux
+=4;

2302 i‡(!
tm
->
blk
) {

2303 i‡(!(
tm
->
blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
key
)))

2304  
NULL
;

2305 
codec
->
e_byã_¨øy_Àn
.
vÆ_codec
->
out
 = 
tm
->
blk
;

2308 
aux
+=3;

2310 
	`BLOCK_APPEND
(
tm
->
blk
, 
aux
, 8);

2311 
aux
+=8;

2316 i‡(!
tm
->
blk
) {

2317 i‡(!(
tm
->
blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
key
)))

2318  
NULL
;

2319 
codec
->
out
 = 
tm
->
blk
;

2322 *
aux_s
;

2323 
aux
 += 3;

2324 
aux_s
 = 
aux
;

2325 *
aux
++);

2326 
codec
->
	`ícode
(
s
, codec, 
aux_s
, 
aux
 -áux_s);

2331 
ty≥
 = 
aux
[3], 
bÀn
;

2332 
uöt32_t
 
cou¡
 = (uöt32_t)((((*)
aux
)[4]<< 0) +

2333 (((*)
aux
)[5]<< 8) +

2334 (((*)
aux
)[6]<<16) +

2335 (((*)
aux
)[7]<<24));

2336 i‡(!
tm
->
blk
) {

2337 i‡(!(
tm
->
blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
key
)))

2338  
NULL
;

2339 
codec
->
e_byã_¨øy_Àn
.
Àn_codec
->
out
 = 
tm
->
blk
;

2340 
codec
->
e_byã_¨øy_Àn
.
vÆ_codec
->
out
 = 
tm
->
blk
;

2344 
aux
+=3;

2347 
ty≥
) {

2349 
bÀn
 = 
cou¡
;

2352 
bÀn
 = 2*
cou¡
;

2355 
bÀn
 = 4*
cou¡
;

2358 
	`Ârötf
(
°dîr
, "Unknown sub-type '%c' foráuxÅype 'B'\n",

2359 
ty≥
);

2360  
NULL
;

2364 
bÀn
 += 5;

2366 
codec
->
	`ícode
(
s
, codec, 
aux
, 
bÀn
);

2367 
aux
 +
bÀn
;

2371 
	`Ârötf
(
°dîr
, "Unknow¿auxÅy≥ '%c'\n", 
aux
[2]);

2372  
NULL
;

2374 
tm
->
blk
->
m
 =Åm->m;

2380 
	`BLOCK_APPEND_CHAR
(
td_b
, 0);

2383 
key
 = 
	`°rög_ndup
(
c
->
comp_hdr
->
TD_keys
,

2384 (*)
	`BLOCK_DATA
(
td_b
Ë+ 
TD_blk_size
,

2385 
	`BLOCK_SIZE
(
td_b
Ë- 
TD_blk_size
);

2386 
k
 = 
	`kh_put
(
m_s2i
, 
c
->
comp_hdr
->
TD_hash
, 
key
, &
√w
);

2387 i‡(
√w
 < 0) {

2388  
NULL
;

2389 } i‡(
√w
 == 0) {

2390 
	`BLOCK_SIZE
(
td_b
Ë
TD_blk_size
;

2392 
	`kh_vÆ
(
c
->
comp_hdr
->
TD_hash
, 
k
Ëc->comp_hdr->
nTL
;

2393 
c
->
comp_hdr
->
nTL
++;

2396 
¸
->
TL
 = 
	`kh_vÆ
(
c
->
comp_hdr
->
TD_hash
, 
k
);

2397 
	`¸am_°©s_add
(
c
->
°©s
[
DS_TL
], 
¸
->
TL
);

2399  
rg
;

2400 
	}
}

2409 
	$¸am_upd©e_cuº_¶i˚
(
¸am_c⁄èöî
 *
c
) {

2410 
¸am_¶i˚
 *
s
 = 
c
->
¶i˚
;

2411 i‡(
c
->
mu…i_£q
) {

2412 
s
->
hdr
->
ªf_£q_id
 = -2;

2413 
s
->
hdr
->
ªf_£q_°¨t
 = 0;

2414 
s
->
hdr
->
ªf_£q_•™
 = 0;

2416 
s
->
hdr
->
ªf_£q_id
 = 
c
->
cuº_ªf
;

2417 
s
->
hdr
->
ªf_£q_°¨t
 = 
c
->
fú°_ba£
;

2418 
s
->
hdr
->
ªf_£q_•™
 = 
	`MAX
(0, 
c
->
œ°_ba£
 - c->
fú°_ba£
 + 1);

2420 
s
->
hdr
->
num_ªc‹ds
 = 
c
->
cuº_ªc
;

2422 i‡(
c
->
cuº_¶i˚
 == 0) {

2423 i‡(
c
->
ªf_£q_id
 !
s
->
hdr
->ref_seq_id)

2424 
c
->
ªf_£q_id
 = 
s
->
hdr
->ref_seq_id;

2425 
c
->
ªf_£q_°¨t
 = c->
fú°_ba£
;

2428 
c
->
cuº_¶i˚
++;

2429 
	}
}

2440 
¸am_c⁄èöî
 *
	$¸am_√xt_c⁄èöî
(
¸am_fd
 *
fd
, 
bam_£q_t
 *
b
) {

2441 
¸am_c⁄èöî
 *
c
 = 
fd
->
˘r
;

2442 
i
;

2445 i‡(
c
->
cuº_ªf
 == -2)

2446 
c
->
cuº_ªf
 = 
	`bam_ªf
(
b
);

2448 i‡(
c
->
¶i˚
)

2449 
	`¸am_upd©e_cuº_¶i˚
(
c
);

2452 i‡(
c
->
cuº_¶i˚
 =c->
max_¶i˚
 ||

2453 (
	`bam_ªf
(
b
Ë!
c
->
cuº_ªf
 && !c->
mu…i_£q
)) {

2454 
c
->
ªf_£q_•™
 = 
fd
->
œ°_ba£
 - c->
ªf_£q_°¨t
 + 1;

2455 i‡(
fd
->
vîbo£
)

2456 
	`Ârötf
(
°dîr
, "Flush container %d/%d..%d\n",

2457 
c
->
ªf_£q_id
, c->
ªf_£q_°¨t
,

2458 
c
->
ªf_£q_°¨t
 + c->
ªf_£q_•™
 -1);

2461 i‡(
fd
->
poﬁ
) {

2462 i‡(-1 =
	`¸am_Êush_c⁄èöî_mt
(
fd
, 
c
))

2463  
NULL
;

2465 i‡(-1 =
	`¸am_Êush_c⁄èöî
(
fd
, 
c
))

2466  
NULL
;

2470 
i
 = 0; i < 
c
->
max_¶i˚
; i++) {

2471 
	`¸am_‰ì_¶i˚
(
c
->
¶i˚s
[
i
]);

2472 
c
->
¶i˚s
[
i
] = 
NULL
;

2475 
c
->
¶i˚
 = 
NULL
;

2476 
c
->
cuº_¶i˚
 = 0;

2479 
	`¸am_‰ì_c⁄èöî
(
c
);

2482 
c
 = 
fd
->
˘r
 = 
	`¸am_√w_c⁄èöî
(fd->
£qs_≥r_¶i˚
,

2483 
fd
->
¶i˚s_≥r_c⁄èöî
);

2484 i‡(!
c
)

2485  
NULL
;

2486 
c
->
ªc‹d_cou¡î
 = 
fd
->record_counter;

2487 
c
->
cuº_ªf
 = 
	`bam_ªf
(
b
);

2490 
c
->
œ°_pos
 = c->
fú°_ba£
 = c->
œ°_ba£
 = 
	`bam_pos
(
b
)+1;

2493 
c
->
¶i˚
 = c->
¶i˚s
[c->
cuº_¶i˚
] =

2494 
	`¸am_√w_¶i˚
(
MAPPED_SLICE
, 
c
->
max_ªc
);

2495 i‡(!
c
->
¶i˚
)

2496  
NULL
;

2498 i‡(
c
->
mu…i_£q
) {

2499 
c
->
¶i˚
->
hdr
->
ªf_£q_id
 = -2;

2500 
c
->
¶i˚
->
hdr
->
ªf_£q_°¨t
 = 0;

2501 
c
->
¶i˚
->
œ°_≠os
 = 1;

2503 
c
->
¶i˚
->
hdr
->
ªf_£q_id
 = 
	`bam_ªf
(
b
);

2505 
c
->
¶i˚
->
hdr
->
ªf_£q_°¨t
 = 
	`bam_pos
(
b
)+1;

2506 
c
->
¶i˚
->
œ°_≠os
 = 
	`bam_pos
(
b
)+1;

2509 
c
->
cuº_ªc
 = 0;

2510 
c
->
s_num_ba£s
 = 0;

2512  
c
;

2513 
	}
}

2522 
	$¥o˚ss_⁄e_ªad
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

2523 
¸am_¶i˚
 *
s
, 
¸am_ªc‹d
 *
¸
,

2524 
bam_£q_t
 *
b
, 
∫um
) {

2525 
i
, 
Áke_quÆ
 = -1;

2526 *
˝
, *
rg
;

2527 *
ªf
, *
£q
, *
quÆ
;

2531 
ªf
 = 
c
->ref;

2532 
¸
->
Êags
 = 
	`bam_Êag
(
b
);

2533 
¸
->
Àn
 = 
	`bam_£q_Àn
(
b
);

2541 
¸
->
¡ags
 = 0;

2542 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1)

2543 
rg
 = 
	`¸am_ícode_aux_1_0
(
fd
, 
b
, 
c
, 
s
, 
¸
);

2545 
rg
 = 
	`¸am_ícode_aux
(
fd
, 
b
, 
c
, 
s
, 
¸
);

2552 i‡(
rg
) {

2553 
SAM_RG
 *
brg
 = 
	`ßm_hdr_föd_rg
(
fd
->
hódî
, 
rg
);

2554 
¸
->
rg
 = 
brg
 ? brg->
id
 : -1;

2555 } i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2556 
SAM_RG
 *
brg
 = 
	`ßm_hdr_föd_rg
(
fd
->
hódî
, "UNKNOWN");

2557 
	`as£π
(
brg
);

2559 
¸
->
rg
 = -1;

2561 
	`¸am_°©s_add
(
c
->
°©s
[
DS_RG
], 
¸
->
rg
);

2564 
¸
->
ªf_id
 = 
	`bam_ªf
(
b
); 
	`¸am_°©s_add
(
c
->
°©s
[
DS_RI
], cr->ref_id);

2565 
	`¸am_°©s_add
(
c
->
°©s
[
DS_BF
], 
fd
->
¸am_Êag_sw≠
[
¸
->
Êags
 & 0xfff]);

2569 i‡(!
fd
->
no_ªf
 || 
	`CRAM_MAJOR_VERS
(fd->
vîsi⁄
) >= 3)

2570 
¸
->
¸am_Êags
 |
CRAM_FLAG_PRESERVE_QUAL_SCORES
;

2572 i‡(
¸
->
Àn
 <0 && 
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3)

2573 
¸
->
¸am_Êags
 |
CRAM_FLAG_NO_SEQ
;

2576 
c
->
num_ba£s
 +
¸
->
Àn
;

2577 
¸
->
≠os
 = 
	`bam_pos
(
b
)+1;

2578 i‡(
c
->
pos_s‹ãd
) {

2579 i‡(
¸
->
≠os
 < 
s
->
œ°_≠os
) {

2580 
c
->
pos_s‹ãd
 = 0;

2582 
	`¸am_°©s_add
(
c
->
°©s
[
DS_AP
], 
¸
->
≠os
 - 
s
->
œ°_≠os
);

2583 
s
->
œ°_≠os
 = 
¸
->
≠os
;

2588 
c
->
max_≠os
 +(
¸
->
≠os
 > c->max_apos) * (cr->apos - c->max_apos);

2595 
¸
->
£q
 = 
	`BLOCK_SIZE
(
s
->
£qs_blk
);

2596 
¸
->
quÆ
 = 
	`BLOCK_SIZE
(
s
->
quÆ_blk
);

2597 
	`BLOCK_GROW
(
s
->
£qs_blk
, 
¸
->
Àn
+1);

2598 
	`BLOCK_GROW
(
s
->
quÆ_blk
, 
¸
->
Àn
);

2599 
£q
 = 
˝
 = (*)
	`BLOCK_END
(
s
->
£qs_blk
);

2601 *
£q
 = 0;

2602 #i‡
HTS_ALLOW_UNALIGNED
 != 0

2605 c⁄° 
uöt16_t
 
code2ba£
[256] = {

2640 
l2
 = 
¸
->
Àn
 / 2;

2641 *
‰om
 = (*)
	`bam_£q
(
b
);

2642 
uöt16_t
 *
˝i
 = (uöt16_à*)
˝
;

2643 
˝
[0] = 0;

2644 
i
 = 0; i < 
l2
; i++)

2645 
˝i
[
i
] = 
	`À_öt2
(
code2ba£
[
‰om
[i]]);

2646 i‡((
i
 *2Ë< 
¸
->
Àn
)

2647 
˝
[
i
] = 
£q_¡16_°r
[
	`bam_£qi
(
	`bam_£q
(
b
), i)];

2650 
i
 = 0; i < 
¸
->
Àn
; i++)

2651 
˝
[
i
] = 
£q_¡16_°r
[
	`bam_£qi
(
	`bam_£q
(
b
), i)];

2653 
	`BLOCK_SIZE
(
s
->
£qs_blk
Ë+
¸
->
Àn
;

2655 
quÆ
 = 
˝
 = (*)
	`bam_quÆ
(
b
);

2658 i‡(!(
¸
->
Êags
 & 
BAM_FUNMAP
)) {

2659 
uöt32_t
 *
cig_to
, *
cig_‰om
;

2660 
≠os
 = 
¸
->≠os-1, 
•os
 = 0;

2662 
¸
->
cig¨
 = 
s
->
ncig¨
;

2663 
¸
->
ncig¨
 = 
	`bam_cig¨_Àn
(
b
);

2664 
¸
->
cig¨
 + cr->
ncig¨
 >
s
->
cig¨_Æloc
) {

2665 
s
->
cig¨_Æloc
 = s->cigar_alloc ? s->cigar_alloc*2 : 1024;

2666 
s
->
cig¨
 = 
	`ªÆloc
(s->cig¨, s->
cig¨_Æloc
 * (*s->cigar));

2667 i‡(!
s
->
cig¨
)

2671 
cig_to
 = (
uöt32_t
 *)
s
->
cig¨
;

2672 
cig_‰om
 = (
uöt32_t
 *)
	`bam_cig¨
(
b
);

2674 
¸
->
„©uª
 = 0;

2675 
¸
->
n„©uª
 = 0;

2676 
i
 = 0; i < 
¸
->
ncig¨
; i++) {

2677 
cig¨_›
 
cig_›
 = 
cig_‰om
[
i
] & 
BAM_CIGAR_MASK
;

2678 
uöt32_t
 
cig_Àn
 = 
cig_‰om
[
i
] >> 
BAM_CIGAR_SHIFT
;

2679 
cig_to
[
i
] = 
cig_‰om
[i];

2683 
cig_›
) {

2684 
l
;

2687 
BAM_CMATCH
:

2688 
BAM_CBASE_MATCH
:

2689 
BAM_CBASE_MISMATCH
:

2692 
l
 = 0;

2693 i‡(!
fd
->
no_ªf
 && 
¸
->
Àn
) {

2694 
íd
 = 
cig_Àn
+
≠os
 < 
c
->
ªf_íd


2695 ? 
cig_Àn
 : 
c
->
ªf_íd
 - 
≠os
;

2696 *
•
 = &
£q
[
•os
];

2697 *
Ω
 = &
ªf
[
≠os
];

2698 *
qp
 = &
quÆ
[
•os
];

2699 i‡(
íd
 > 
¸
->
Àn
) {

2700 
	`Ârötf
(
°dîr
, "CIGARánd query sequenceáre of "

2704 
l
 = 0;Ü < 
íd
;Ü++) {

2705 i‡(
Ω
[
l
] !
•
[l]) {

2706 i‡(!
•
[
l
])

2708 i‡(0 && 
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

2711 
ﬁ
=
l
;

2712 
l
<
íd
 && 
Ω
[l] !
•
[l])

2713 
l
++;

2714 i‡(
l
-
ﬁ
 > 1) {

2715 i‡(
	`¸am_add_ba£s
(
fd
, 
c
, 
s
, 
¸
, 
•os
+
ﬁ
,

2716 
l
-
ﬁ
, &
£q
[
•os
+ol]))

2718 
l
--;

2720 
l
 = 
ﬁ
;

2721 i‡(
	`¸am_add_sub°ôuti⁄
(
fd
, 
c
, 
s
, 
¸
,

2722 
•os
+
l
, 
•
[l],

2723 
qp
[
l
], 
Ω
[l]))

2727 i‡(
	`¸am_add_sub°ôuti⁄
(
fd
, 
c
, 
s
, 
¸
, 
•os
+
l
,

2728 
•
[
l
], 
qp
[l], 
Ω
[l]))

2733 
•os
 +
l
;

2734 
≠os
 +
l
;

2737 i‡(
l
 < 
cig_Àn
 && 
¸
->
Àn
) {

2738 i‡(
fd
->
no_ªf
) {

2739 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 3) {

2740 i‡(
	`¸am_add_ba£s
(
fd
, 
c
, 
s
, 
¸
, 
•os
,

2741 
cig_Àn
-
l
, &
£q
[
•os
]))

2743 
•os
 +
cig_Àn
-
l
;

2745 ; 
l
 < 
cig_Àn
 && 
£q
[
•os
];Ü++, spos++) {

2746 i‡(
	`¸am_add_ba£
(
fd
, 
c
, 
s
, 
¸
, 
•os
,

2747 
£q
[
•os
], 
quÆ
[spos]))

2753 ; 
l
 < 
cig_Àn
 && 
£q
[
•os
];Ü++, spos++) {

2754 i‡(
	`¸am_add_ba£
(
fd
, 
c
, 
s
, 
¸
, 
•os
,

2755 
£q
[
•os
], 
quÆ
[spos]))

2759 
≠os
 +
cig_Àn
;

2760 } i‡(!
¸
->
Àn
) {

2762 
≠os
 +
cig_Àn
;

2763 
•os
 +
cig_Àn
;

2767 
BAM_CDEL
:

2768 i‡(
	`¸am_add_dñëi⁄
(
c
, 
s
, 
¸
, 
•os
, 
cig_Àn
, &
£q
[spos]))

2770 
≠os
 +
cig_Àn
;

2773 
BAM_CREF_SKIP
:

2774 i‡(
	`¸am_add_skù
(
c
, 
s
, 
¸
, 
•os
, 
cig_Àn
, &
£q
[spos]))

2776 
≠os
 +
cig_Àn
;

2779 
BAM_CINS
:

2780 i‡(
	`¸am_add_ö£πi⁄
(
c
, 
s
, 
¸
, 
•os
, 
cig_Àn
,

2781 
¸
->
Àn
 ? &
£q
[
•os
] : 
NULL
))

2783 i‡(
fd
->
no_ªf
 && 
¸
->
Àn
) {

2784 
l
 = 0;Ü < 
cig_Àn
;Ü++, 
•os
++) {

2785 
	`¸am_add_quÆôy
(
fd
, 
c
, 
s
, 
¸
, 
•os
, 
quÆ
[spos]);

2788 
•os
 +
cig_Àn
;

2792 
BAM_CSOFT_CLIP
:

2793 i‡(
	`¸am_add_so·˛ù
(
c
, 
s
, 
¸
, 
•os
, 
cig_Àn
,

2794 
¸
->
Àn
 ? &
£q
[
•os
] : 
NULL
,

2795 
fd
->
vîsi⁄
))

2798 i‡(
fd
->
no_ªf
 &&

2799 !(
¸
->
¸am_Êags
 & 
CRAM_FLAG_PRESERVE_QUAL_SCORES
)) {

2800 i‡(
¸
->
Àn
) {

2801 
l
 = 0;Ü < 
cig_Àn
;Ü++, 
•os
++) {

2802 
	`¸am_add_quÆôy
(
fd
, 
c
, 
s
, 
¸
, 
•os
, 
quÆ
[spos]);

2805 
l
 = 0;Ü < 
cig_Àn
;Ü++, 
•os
++) {

2806 
	`¸am_add_quÆôy
(
fd
, 
c
, 
s
, 
¸
, 
•os
, -1);

2810 
•os
 +
cig_Àn
;

2814 
BAM_CHARD_CLIP
:

2815 i‡(
	`¸am_add_h¨d˛ù
(
c
, 
s
, 
¸
, 
•os
, 
cig_Àn
, &
£q
[spos]))

2819 
BAM_CPAD
:

2820 i‡(
	`¸am_add_∑d
(
c
, 
s
, 
¸
, 
•os
, 
cig_Àn
, &
£q
[spos]))

2825 
	`Ârötf
(
°dîr
, "Unknow¿CIGAR o∞codê%d\n", 
cig_›
);

2829 i‡(
¸
->
Àn
 && 
•os
 != cr->len) {

2830 
	`Ârötf
(
°dîr
, "CIGARánd query sequenceáre of different "

2834 
Áke_quÆ
 = 
•os
;

2835 
¸
->
´nd
 = 
fd
->
no_ªf
 ? 
≠os
 : 
	`MIN
◊pos, 
c
->
ªf_íd
);

2836 
	`¸am_°©s_add
(
c
->
°©s
[
DS_FN
], 
¸
->
n„©uª
);

2839 
¸
->
¸am_Êags
 |
CRAM_FLAG_PRESERVE_QUAL_SCORES
;

2840 
¸
->
cig¨
 = 0;

2841 
¸
->
ncig¨
 = 0;

2842 
¸
->
n„©uª
 = 0;

2843 
¸
->
´nd
 = cr->
≠os
;

2844 
i
 = 0; i < 
¸
->
Àn
; i++)

2845 
	`¸am_°©s_add
(
c
->
°©s
[
DS_BA
], 
£q
[
i
]);

2846 
Áke_quÆ
 = 0;

2854 i‡(
¸
->
¸am_Êags
 & 
CRAM_FLAG_PRESERVE_QUAL_SCORES
) {

2856 i‡(
¸
->
Àn
 == 0) {

2857 
¸
->
Àn
 = 
Áke_quÆ
;

2858 
	`BLOCK_GROW
(
s
->
quÆ_blk
, 
¸
->
Àn
);

2859 
˝
 = (*)
	`BLOCK_END
(
s
->
quÆ_blk
);

2860 
	`mem£t
(
˝
, 255, 
¸
->
Àn
);

2862 
	`BLOCK_GROW
(
s
->
quÆ_blk
, 
¸
->
Àn
);

2863 
˝
 = (*)
	`BLOCK_END
(
s
->
quÆ_blk
);

2864 *
‰om
 = (*)&
	`bam_quÆ
(
b
)[0];

2865 *
to
 = &
˝
[0];

2866 
	`mem˝y
(
to
, 
‰om
, 
¸
->
Àn
);

2869 
	`BLOCK_SIZE
(
s
->
quÆ_blk
Ë+
¸
->
Àn
;

2871 i‡(
¸
->
Àn
 == 0)

2872 
¸
->
Àn
 = 
Áke_quÆ
 >0 ? fake_quÆ : cr->
´nd
 - cr->
≠os
 + 1;

2875 
	`¸am_°©s_add
(
c
->
°©s
[
DS_RL
], 
¸
->
Àn
);

2879 
√w
;

2880 
khöt_t
 
k
;

2881 
£c
 = (
¸
->
Êags
 & 
BAM_FSECONDARY
) ? 1 : 0;

2885 i‡(
¸
->
Êags
 & 
BAM_FPAIRED
) {

2886 *
key
 = 
	`°rög_ndup
(
s
->
∑ú_keys
, 
	`bam_«me
(
b
), 
	`bam_«me_Àn
(b));

2887 i‡(!
key
)

2890 
k
 = 
	`kh_put
(
m_s2i
, 
s
->
∑ú
[
£c
], 
key
, &
√w
);

2891 i‡(-1 =
√w
)

2893 i‡(
√w
 > 0)

2894 
	`kh_vÆ
(
s
->
∑ú
[
£c
], 
k
Ë
∫um
;

2896 
√w
 = 1;

2899 i‡(
√w
 == 0) {

2900 
¸am_ªc‹d
 *
p
 = &
s
->
¸ecs
[
	`kh_vÆ
(s->
∑ú
[
£c
], 
k
)];

2901 
Æe·
, 
¨ight
, 
sign
;

2903 
Æe·
 = 
	`MIN
(
¸
->
≠os
, 
p
->apos);

2904 
¨ight
 = 
	`MAX
(
¸
->
´nd
, 
p
->aend);

2905 i‡(
¸
->
≠os
 < 
p
->apos) {

2906 
sign
 = 1;

2907 } i‡(
¸
->
≠os
 > 
p
->apos) {

2908 
sign
 = -1;

2909 } i‡(
¸
->
Êags
 & 
BAM_FREAD1
) {

2910 
sign
 = 1;

2912 
sign
 = -1;

2917 i‡((
	`bam_ös_size
(
b
) &&

2918 
	`abs
(
	`bam_ös_size
(
b
Ë- 
sign
*(
¨ight
-
Æe·
+1)Ë> 
fd
->
éí_≠¥ox
) ||

2919 (!
	`bam_ös_size
(
b
Ë&& !
fd
->
éí_zîo
))

2920 
dëached
;

2922 i‡((!
fd
->
éí_zîo
 && 
	`MAX
(
	`bam_m©e_pos
(
b
)+1, 0Ë!
p
->
≠os
) &&

2923 !(
fd
->
éí_zîo
 && 
	`bam_m©e_pos
(
b
) == 0))

2924 
dëached
;

2926 i‡(((
	`bam_Êag
(
b
Ë& 
BAM_FMUNMAP
) != 0) !=

2927 ((
p
->
Êags
 & 
BAM_FUNMAP
) != 0))

2928 
dëached
;

2930 i‡(((
	`bam_Êag
(
b
Ë& 
BAM_FMREVERSE
) != 0) !=

2931 ((
p
->
Êags
 & 
BAM_FREVERSE
) != 0))

2932 
dëached
;

2936 i‡(
p
->
ªf_id
 !
¸
->ref_id &&

2937 !(
fd
->
éí_zîo
 && 
p
->
ªf_id
 == -1))

2938 
dëached
;

2940 i‡((
p
->
éí
 && 
	`abs
’->éí - -
sign
*(
¨ight
-
Æe·
+1)Ë> 
fd
->
éí_≠¥ox
) ||

2941 (!
p
->
éí
 && !
fd
->
éí_zîo
))

2942 
dëached
;

2944 i‡(
p
->
m©e_pos
 !
¸
->
≠os
 &&

2945 !(
fd
->
éí_zîo
 && 
p
->
m©e_pos
 == 0))

2946 
dëached
;

2948 i‡(((
p
->
Êags
 & 
BAM_FMUNMAP
) != 0) !=

2949 ((
p
->
m©e_Êags
 & 
CRAM_M_UNMAP
) != 0))

2950 
dëached
;

2952 i‡(((
p
->
Êags
 & 
BAM_FMREVERSE
) != 0) !=

2953 ((
p
->
m©e_Êags
 & 
CRAM_M_REVERSE
) != 0))

2954 
dëached
;

2957 i‡((
¸
->
Êags
 & 
BAM_FSUPPLEMENTARY
) ||

2958 (
p
->
Êags
 & 
BAM_FSUPPLEMENTARY
))

2959 
dëached
;

2964 i‡(
fd
->
lossy_ªad_«mes
 &&

2965 (!(
¸
->
¸am_Êags
 & 
CRAM_FLAG_DISCARD_NAME
) ||

2966 !((
p
->
¸am_Êags
 & 
CRAM_FLAG_DISCARD_NAME
))))

2967 
dëached
;

2978 
¸
->
m©e_pos
 = 
p
->
≠os
;

2979 
¸
->
éí
 = 
sign
*(
¨ight
-
Æe·
+1);

2980 
¸
->
m©e_Êags
 =

2981 ((
p
->
Êags
 & 
BAM_FMUNMAP
Ë=BAM_FMUNMAPË* 
CRAM_M_UNMAP
 +

2982 ((
p
->
Êags
 & 
BAM_FMREVERSE
Ë=BAM_FMREVERSEË* 
CRAM_M_REVERSE
;

2985 i‡(
p
->
¸am_Êags
 & 
CRAM_FLAG_STATS_ADDED
) {

2986 
	`¸am_°©s_dñ
(
c
->
°©s
[
DS_NP
], 
p
->
m©e_pos
);

2987 
	`¸am_°©s_dñ
(
c
->
°©s
[
DS_MF
], 
p
->
m©e_Êags
);

2988 
	`¸am_°©s_dñ
(
c
->
°©s
[
DS_TS
], 
p
->
éí
);

2989 
	`¸am_°©s_dñ
(
c
->
°©s
[
DS_NS
], 
p
->
m©e_ªf_id
);

3003 
¸
->
¸am_Êags
 &~
CRAM_FLAG_DETACHED
;

3004 
	`¸am_°©s_add
(
c
->
°©s
[
DS_CF
], 
¸
->
¸am_Êags
 & 
CRAM_FLAG_MASK
);

3007 i‡(
p
->
¸am_Êags
 & 
CRAM_FLAG_STATS_ADDED
) {

3008 
	`¸am_°©s_dñ
(
c
->
°©s
[
DS_CF
], 
p
->
¸am_Êags
 & 
CRAM_FLAG_MASK
);

3009 
p
->
¸am_Êags
 &~
CRAM_FLAG_STATS_ADDED
;

3012 
p
->
¸am_Êags
 &~
CRAM_FLAG_DETACHED
;

3013 
p
->
¸am_Êags
 |
CRAM_FLAG_MATE_DOWNSTREAM
;

3014 
	`¸am_°©s_add
(
c
->
°©s
[
DS_CF
], 
p
->
¸am_Êags
 & 
CRAM_FLAG_MASK
);

3016 
p
->
m©e_löe
 = 
∫um
 - (
	`kh_vÆ
(
s
->
∑ú
[
£c
], 
k
) + 1);

3017 
	`¸am_°©s_add
(
c
->
°©s
[
DS_NF
], 
p
->
m©e_löe
);

3019 
	`kh_vÆ
(
s
->
∑ú
[
£c
], 
k
Ë
∫um
;

3021 
dëached
:

3025 
¸
->
m©e_Êags
 = 0;

3026 i‡(
	`bam_Êag
(
b
Ë& 
BAM_FMUNMAP
)

3027 
¸
->
m©e_Êags
 |
CRAM_M_UNMAP
;

3028 i‡(
	`bam_Êag
(
b
Ë& 
BAM_FMREVERSE
)

3029 
¸
->
m©e_Êags
 |
CRAM_M_REVERSE
;

3031 
	`¸am_°©s_add
(
c
->
°©s
[
DS_MF
], 
¸
->
m©e_Êags
);

3033 
¸
->
m©e_pos
 = 
	`MAX
(
	`bam_m©e_pos
(
b
)+1, 0);

3034 
	`¸am_°©s_add
(
c
->
°©s
[
DS_NP
], 
¸
->
m©e_pos
);

3036 
¸
->
éí
 = 
	`bam_ös_size
(
b
);

3037 
	`¸am_°©s_add
(
c
->
°©s
[
DS_TS
], 
¸
->
éí
);

3039 
¸
->
¸am_Êags
 |
CRAM_FLAG_DETACHED
;

3040 
	`¸am_°©s_add
(
c
->
°©s
[
DS_CF
], 
¸
->
¸am_Êags
 & 
CRAM_FLAG_MASK
);

3041 
	`¸am_°©s_add
(
c
->
°©s
[
DS_NS
], 
	`bam_m©e_ªf
(
b
));

3043 
¸
->
¸am_Êags
 |
CRAM_FLAG_STATS_ADDED
;

3047 
¸
->
mquÆ
 = 
	`bam_m≠_quÆ
(
b
);

3048 
	`¸am_°©s_add
(
c
->
°©s
[
DS_MQ
], 
¸
->
mquÆ
);

3050 
¸
->
m©e_ªf_id
 = 
	`bam_m©e_ªf
(
b
);

3052 i‡(!(
	`bam_Êag
(
b
Ë& 
BAM_FUNMAP
)) {

3053 i‡(
c
->
fú°_ba£
 > 
¸
->
≠os
)

3054 
c
->
fú°_ba£
 = 
¸
->
≠os
;

3056 i‡(
c
->
œ°_ba£
 < 
¸
->
´nd
)

3057 
c
->
œ°_ba£
 = 
¸
->
´nd
;

3061 
	}
}

3070 
	$¸am_put_bam_£q
(
¸am_fd
 *
fd
, 
bam_£q_t
 *
b
) {

3071 
¸am_c⁄èöî
 *
c
;

3073 i‡(!
fd
->
˘r
) {

3074 
fd
->
˘r
 = 
	`¸am_√w_c⁄èöî
(fd->
£qs_≥r_¶i˚
,

3075 
fd
->
¶i˚s_≥r_c⁄èöî
);

3076 i‡(!
fd
->
˘r
)

3078 
fd
->
˘r
->
ªc‹d_cou¡î
 = fd->record_counter;

3080 
c
 = 
fd
->
˘r
;

3082 i‡(!
c
->
¶i˚
 || c->
cuº_ªc
 =c->
max_ªc
 ||

3083 (
	`bam_ªf
(
b
Ë!
c
->
cuº_ªf
 && c->curr_ref >= -1) ||

3084 (
c
->
s_num_ba£s
 >
fd
->
ba£s_≥r_¶i˚
)) {

3085 
¶i˚_ªc
, 
cuº_ªc
, 
mu…i_£q
 = 
fd
->multi_seq == 1;

3086 
cuº_ªf
 = 
c
->
¶i˚
 ? c->cuº_ª‡: 
	`bam_ªf
(
b
);

3094 i‡(
fd
->
mu…i_£q
 =-1 && 
c
->
cuº_ªc
 < c->
max_ªc
/4+10 &&

3095 
fd
->
œ°_¶i˚
 && fd->œ°_¶i˚ < 
c
->
max_ªc
/4+10 &&

3096 !
fd
->
embed_ªf
) {

3097 i‡(
fd
->
vîbo£
 && !
c
->
mu…i_£q
)

3098 
	`Ârötf
(
°dîr
, "Multi-refÉnabled forÅhis container\n");

3099 
mu…i_£q
 = 1;

3102 
¶i˚_ªc
 = 
c
->slice_rec;

3103 
cuº_ªc
 = 
c
->curr_rec;

3105 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1 ||

3106 
c
->
cuº_ªc
 =c->
max_ªc
 || 
fd
->
mu…i_£q
 !1 || !c->
¶i˚
 ||

3107 
c
->
s_num_ba£s
 >
fd
->
ba£s_≥r_¶i˚
) {

3108 i‡(
NULL
 =(
c
 = 
	`¸am_√xt_c⁄èöî
(
fd
, 
b
))) {

3109 i‡(
fd
->
˘r
) {

3111 
	`¸am_‰ì_c⁄èöî
(
fd
->
˘r
);

3112 
fd
->
˘r
 = 
NULL
;

3124 i‡(
mu…i_£q
) {

3125 
fd
->
mu…i_£q
 = 1;

3126 
c
->
mu…i_£q
 = 1;

3127 
c
->
pos_s‹ãd
 = 0;

3129 i‡(!
c
->
ªfs_u£d
) {

3130 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

3131 
c
->
ªfs_u£d
 = 
	`ˇŒoc
(
fd
->
ªfs
->
ƒef
, ());

3132 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

3133 i‡(!
c
->
ªfs_u£d
)

3138 
fd
->
œ°_¶i˚
 = 
cuº_ªc
 - 
¶i˚_ªc
;

3139 
c
->
¶i˚_ªc
 = c->
cuº_ªc
;

3142 i‡(
	`bam_ªf
(
b
Ë>0 && 
cuº_ªf
 >0 && bam_ªf(bË!cuº_ª‡&& !
fd
->
embed_ªf
 &&

3143 !
fd
->
uns‹ãd
 && 
mu…i_£q
) {

3145 i‡(!
c
->
ªfs_u£d
) {

3146 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

3147 
c
->
ªfs_u£d
 = 
	`ˇŒoc
(
fd
->
ªfs
->
ƒef
, ());

3148 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

3149 i‡(!
c
->
ªfs_u£d
)

3151 } i‡(
c
->
ªfs_u£d
 && c->ªfs_u£d[
	`bam_ªf
(
b
)]) {

3152 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

3153 
fd
->
uns‹ãd
 = 1;

3154 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

3155 
fd
->
mu…i_£q
 = 1;

3159 
c
->
cuº_ªf
 = 
	`bam_ªf
(
b
);

3160 i‡(
c
->
ªfs_u£d
 && c->
cuº_ªf
 >= 0) c->refs_used[c->curr_ref]++;

3163 i‡(!
c
->
bams
) {

3165 
	`±hªad_muãx_lock
(&
fd
->
bam_li°_lock
);

3166 i‡(
fd
->
bl
) {

3167 
•¨e_bams
 *
•¨e
 = 
fd
->
bl
;

3168 
c
->
bams
 = 
•¨e
->bams;

3169 
fd
->
bl
 = 
•¨e
->
√xt
;

3170 
	`‰ì
(
•¨e
);

3172 
c
->
bams
 = 
	`ˇŒoc
(c->
max_c_ªc
, (
bam_£q_t
 *));

3173 i‡(!
c
->
bams
)

3176 
	`±hªad_muãx_u∆ock
(&
fd
->
bam_li°_lock
);

3180 i‡(
c
->
bams
[c->
cuº_c_ªc
])

3181 
	`bam_c›y1
(
c
->
bams
[c->
cuº_c_ªc
], 
b
);

3183 
c
->
bams
[c->
cuº_c_ªc
] = 
	`bam_dup
(
b
);

3185 
c
->
cuº_ªc
++;

3186 
c
->
cuº_c_ªc
++;

3187 
c
->
s_num_ba£s
 +
	`bam_£q_Àn
(
b
);

3188 
fd
->
ªc‹d_cou¡î
++;

3191 
	}
}

	@htslib/cram/cram_encode.h

41 #i‚de‡
_CRAM_WRITE_H_


42 
	#_CRAM_WRITE_H_


	)

44 #ifde‡
__˝lu•lus


62 
¸am_put_bam_£q
(
¸am_fd
 *
fd
, 
bam_£q_t
 *
b
);

76 
¸am_block
 *
¸am_ícode_com¥essi⁄_hódî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
,

77 
¸am_block_com¥essi⁄_hdr
 *
h
);

86 
¸am_block
 *
¸am_ícode_¶i˚_hódî
(
¸am_fd
 *
fd
, 
¸am_¶i˚
 *
s
);

99 
¸am_ícode_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
);

109 
¸am_upd©e_cuº_¶i˚
(
¸am_c⁄èöî
 *
c
);

111 #ifde‡
__˝lu•lus


	@htslib/cram/cram_external.c

41 
	~<c⁄fig.h
>

43 
	~"ht¶ib/hfûe.h
"

44 
	~"¸am/¸am.h
"

50 
SAM_hdr
 *
	$¸am_fd_gë_hódî
(
¸am_fd
 *
fd
Ë{  fd->
hódî
; 
	}
}

51 
	$¸am_fd_£t_hódî
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
Ë{ fd->
hódî
 = hdr; 
	}
}

53 
	$¸am_fd_gë_vîsi⁄
(
¸am_fd
 *
fd
Ë{  fd->
vîsi⁄
; 
	}
}

54 
	$¸am_fd_£t_vîsi⁄
(
¸am_fd
 *
fd
, 
vîs
Ë{ fd->
vîsi⁄
 = vîs; 
	}
}

56 
	$¸am_maj‹_vîs
(
¸am_fd
 *
fd
Ë{  
	`CRAM_MAJOR_VERS
(fd->
vîsi⁄
); 
	}
}

57 
	$¸am_mö‹_vîs
(
¸am_fd
 *
fd
Ë{  
	`CRAM_MINOR_VERS
(fd->
vîsi⁄
); 
	}
}

59 
hFILE
 *
	$¸am_fd_gë_Â
(
¸am_fd
 *
fd
Ë{  fd->
Â
; 
	}
}

60 
	$¸am_fd_£t_Â
(
¸am_fd
 *
fd
, 
hFILE
 *
Â
Ë{ fd->Â = fp; 
	}
}

67 
öt32_t
 
	$¸am_c⁄èöî_gë_Àngth
(
¸am_c⁄èöî
 *
c
) {

68  
c
->
Àngth
;

69 
	}
}

71 
	$¸am_c⁄èöî_£t_Àngth
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 
Àngth
) {

72 
c
->
Àngth
 =Üength;

73 
	}
}

76 
öt32_t
 
	$¸am_c⁄èöî_gë_num_blocks
(
¸am_c⁄èöî
 *
c
) {

77  
c
->
num_blocks
;

78 
	}
}

80 
	$¸am_c⁄èöî_£t_num_blocks
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 
num_blocks
) {

81 
c
->
num_blocks
 =Çum_blocks;

82 
	}
}

88 
öt32_t
 *
	$¸am_c⁄èöî_gë_œndm¨ks
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 *
num_œndm¨ks
) {

89 *
num_œndm¨ks
 = 
c
->num_landmarks;

90  
c
->
œndm¨k
;

91 
	}
}

96 
	$¸am_c⁄èöî_£t_œndm¨ks
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 
num_œndm¨ks
,

97 
öt32_t
 *
œndm¨ks
) {

98 
c
->
num_œndm¨ks
 =Çum_landmarks;

99 
c
->
œndm¨k
 = 
œndm¨ks
;

100 
	}
}

104 
	$¸am_c⁄èöî_is_em±y
(
¸am_fd
 *
fd
) {

105  
fd
->
em±y_c⁄èöî
;

106 
	}
}

126 
	$¸am_block_com¥essi⁄_hdr_£t_DS
(
¸am_block_com¥essi⁄_hdr
 *
ch
,

127 
ds
, 
√w_rg
) {

128 i‡(!
ch
 || !ch->
codecs
[
ds
])

131 
ch
->
codecs
[
ds
]->
codec
) {

132 
E_HUFFMAN
:

133 i‡(
ch
->
codecs
[
ds
]->
huffm™
.
ncodes
 != 1)

135 
ch
->
codecs
[
ds
]->
huffm™
.
codes
[0].
symbﬁ
 = 
√w_rg
;

138 
E_BETA
:

139 i‡(
ch
->
codecs
[
ds
]->
bëa
.
nbôs
 != 0)

141 
ch
->
codecs
[
ds
]->
bëa
.
off£t
 = -
√w_rg
;

149 
	}
}

151 
	$¸am_block_com¥essi⁄_hdr_£t_rg
(
¸am_block_com¥essi⁄_hdr
 *
ch
, 
√w_rg
) {

152  
	`¸am_block_com¥essi⁄_hdr_£t_DS
(
ch
, 
DS_RG
, 
√w_rg
);

153 
	}
}

163 
	$¸am_block_com¥essi⁄_hdr_decodî2ícodî
(
¸am_fd
 *
fd
,

164 
¸am_block_com¥essi⁄_hdr
 *
ch
) {

165 
i
;

167 i‡(!
ch
)

170 
i
 = 0; i < 
DS_END
; i++) {

171 
¸am_codec
 *
co
 = 
ch
->
codecs
[
i
];

172 i‡(!
co
)

175 i‡(-1 =
	`¸am_codec_decodî2ícodî
(
fd
, 
co
))

180 
	}
}

186 
öt32_t
 
	$¸am_¶i˚_hdr_gë_num_blocks
(
¸am_block_¶i˚_hdr
 *
hdr
) {

187  
hdr
->
num_blocks
;

188 
	}
}

195 
öt32_t
 
	$¸am_block_gë_c⁄ã¡_id
(
¸am_block
 *
b
Ë{  b->
c⁄ã¡_id
; 
	}
}

196 
öt32_t
 
	$¸am_block_gë_comp_size
(
¸am_block
 *
b
Ë{  b->
comp_size
; 
	}
}

197 
öt32_t
 
	$¸am_block_gë_uncomp_size
(
¸am_block
 *
b
Ë{  b->
uncomp_size
; 
	}
}

198 
öt32_t
 
	$¸am_block_gë_¸c32
(
¸am_block
 *
b
Ë{  b->
¸c32
; 
	}
}

199 * 
	$¸am_block_gë_d©a
(
¸am_block
 *
b
Ë{  
	`BLOCK_DATA
(b); 
	}
}

200 
öt32_t
 
	$¸am_block_gë_size
(
¸am_block
 *
b
Ë{  
	`BLOCK_SIZE
(b); 
	}
}

201 
¸am_c⁄ã¡_ty≥
 
	$¸am_block_gë_c⁄ã¡_ty≥
(
¸am_block
 *
b
) {

202  
b
->
c⁄ã¡_ty≥
;

203 
	}
}

205 
	$¸am_block_£t_c⁄ã¡_id
(
¸am_block
 *
b
, 
öt32_t
 
id
Ë{ b->
c⁄ã¡_id
 = id; 
	}
}

206 
	$¸am_block_£t_comp_size
(
¸am_block
 *
b
, 
öt32_t
 
size
Ë{ b->
comp_size
 = size; 
	}
}

207 
	$¸am_block_£t_uncomp_size
(
¸am_block
 *
b
, 
öt32_t
 
size
Ë{ b->
uncomp_size
 = size; 
	}
}

208 
	$¸am_block_£t_¸c32
(
¸am_block
 *
b
, 
öt32_t
 
¸c
Ë{ b->
¸c32
 = crc; 
	}
}

209 
	$¸am_block_£t_d©a
(
¸am_block
 *
b
, *
d©a
Ë{ 
	`BLOCK_DATA
(bËd©a; 
	}
}

210 
	$¸am_block_£t_size
(
¸am_block
 *
b
, 
öt32_t
 
size
Ë{ 
	`BLOCK_SIZE
(bËsize; 
	}
}

212 
	$¸am_block_≠≥nd
(
¸am_block
 *
b
, *
d©a
, 
size
) {

213 
	`BLOCK_APPEND
(
b
, 
d©a
, 
size
);

214  
	`BLOCK_DATA
(
b
) ? 0 : -1;

215 
	}
}

216 
	$¸am_block_upd©e_size
(
¸am_block
 *
b
Ë{ 
	`BLOCK_UPLEN
(b); 
	}
}

219 
size_t
 
	$¸am_block_gë_off£t
(
¸am_block
 *
b
Ë{  
	`BLOCK_SIZE
(b); 
	}
}

220 
	$¸am_block_£t_off£t
(
¸am_block
 *
b
, 
size_t
 
off£t
Ë{ 
	`BLOCK_SIZE
(bËoff£t; 
	}
}

232 
	$¸am_c›y_¶i˚
(
¸am_fd
 *
ö
, cøm_fd *
out
, 
öt32_t
 
num_¶i˚
) {

233 
öt32_t
 
i
, 
j
;

235 
i
 = 0; i < 
num_¶i˚
; i++) {

236 
¸am_block
 *
blk
;

237 
¸am_block_¶i˚_hdr
 *
hdr
;

239 i‡(!(
blk
 = 
	`¸am_ªad_block
(
ö
)))

241 i‡(!(
hdr
 = 
	`¸am_decode_¶i˚_hódî
(
ö
, 
blk
))) {

242 
	`¸am_‰ì_block
(
blk
);

245 i‡(
	`¸am_wrôe_block
(
out
, 
blk
) != 0) {

246 
	`¸am_‰ì_block
(
blk
);

249 
	`¸am_‰ì_block
(
blk
);

251 
num_blocks
 = 
	`¸am_¶i˚_hdr_gë_num_blocks
(
hdr
);

252 
j
 = 0; j < 
num_blocks
; j++) {

253 
blk
 = 
	`¸am_ªad_block
(
ö
);

254 i‡(!
blk
 || 
	`¸am_wrôe_block
(
out
, blk) != 0) {

255 i‡(
blk
Ë
	`¸am_‰ì_block
(blk);

258 
	`¸am_‰ì_block
(
blk
);

260 
	`¸am_‰ì_¶i˚_hódî
(
hdr
);

264 
	}
}

296 
	$¸am_å™scode_rg
(
¸am_fd
 *
ö
, cøm_fd *
out
,

297 
¸am_c⁄èöî
 *
c
,

298 
ƒg
, *
ö_rg
, *
out_rg
) {

299 
√w_rg
 = *
out_rg
, 
ﬁd_size
, 
√w_size
;

300 
¸am_block
 *
o_blk
, *
n_blk
;

301 
¸am_block_com¥essi⁄_hdr
 *
ch
;

303 i‡(
ƒg
 != 1) {

304 
	`Ârötf
(
°dîr
, "[%s] ERROR:Çot implemented forÇrg != 1\n",

305 
__func__
);

311 
o_blk
 = 
	`¸am_ªad_block
(
ö
);

312 
ﬁd_size
 = 
	`¸am_block_size
(
o_blk
);

313 
ch
 = 
	`¸am_decode_com¥essi⁄_hódî
(
ö
, 
o_blk
);

314 i‡(
	`¸am_block_com¥essi⁄_hdr_£t_rg
(
ch
, 
√w_rg
) != 0)

316 
	`¸am_block_com¥essi⁄_hdr_decodî2ícodî
(
ö
, 
ch
);

317 
n_blk
 = 
	`¸am_ícode_com¥essi⁄_hódî
(
ö
, 
c
, 
ch
);

318 
	`¸am_‰ì_com¥essi⁄_hódî
(
ch
);

328 *
˝
 = 
	`¸am_block_gë_d©a
(
o_blk
);

329 *
›
 = 
˝
;

330 *
ídp
 = 
˝
 + 
	`¸am_block_gë_uncomp_size
(
o_blk
);

332 
öt32_t
 
i32
;

334 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
i32
);

335 
˝
 +
i32
;

336 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
i32
);

337 
˝
 +
i32
;

338 
›
 = 
˝
;

339 
˝
 +
	`ß„_ôf8_gë
(˝, 
ídp
, &
i32
);

340 
i32
 +(
˝
-
›
);

343 
	`¸am_block_£t_size
(
n_blk
, 
	`¸am_block_gë_size
(n_blk)-2);

344 
	`¸am_block_≠≥nd
(
n_blk
, 
›
, 
i32
);

345 
	`¸am_block_upd©e_size
(
n_blk
);

347 
√w_size
 = 
	`¸am_block_size
(
n_blk
);

353 
öt32_t
 *
œndm¨ks
, 
num_œndm¨ks
;

354 
œndm¨ks
 = 
	`¸am_c⁄èöî_gë_œndm¨ks
(
c
, &
num_œndm¨ks
);

356 i‡(
ﬁd_size
 !
√w_size
) {

357 
diff
 = 
√w_size
 - 
ﬁd_size
, 
j
;

359 
j
 = 0; j < 
num_œndm¨ks
; j++)

360 
œndm¨ks
[
j
] +
diff
;

362 
	`¸am_c⁄èöî_£t_Àngth
(
c
, 
	`¸am_c⁄èöî_gë_Àngth
(cË+ 
diff
);

367 i‡(
	`¸am_wrôe_c⁄èöî
(
out
, 
c
) != 0)

370 
	`¸am_wrôe_block
(
out
, 
n_blk
);

371 
	`¸am_‰ì_block
(
o_blk
);

372 
	`¸am_‰ì_block
(
n_blk
);

376  
	`¸am_c›y_¶i˚
(
ö
, 
out
, 
num_œndm¨ks
);

377 
	}
}

389 
ªfs_t
 *
	$¸am_gë_ªfs
(
htsFûe
 *
fd
) {

390  
fd
->
f‹m©
.f‹m© =
¸am


391 ? 
fd
->
Â
.
¸am
->
ªfs


392 : 
NULL
;

393 
	}
}

	@htslib/cram/cram_index.c

51 
	~<c⁄fig.h
>

53 
	~<°dio.h
>

54 
	~<î∫o.h
>

55 
	~<as£π.h
>

56 
	~<°dlib.h
>

57 
	~<°rög.h
>

58 
	~<zlib.h
>

59 
	~<sys/ty≥s.h
>

60 
	~<sys/°©.h
>

61 
	~<m©h.h
>

63 
	~"ht¶ib/hfûe.h
"

64 
	~"hts_öã∫Æ.h
"

65 
	~"¸am/¸am.h
"

66 
	~"¸am/os.h
"

67 
	~"¸am/zfio.h
"

70 
	$dump_ödex_
(
¸am_ödex
 *
e
, 
Àvñ
) {

71 
i
, 
n
;

72 
n
 = 
	`¥ötf
("%*s%d / %d .. %d, ", 
Àvñ
*4, "", 
e
->
ªfid
,É->
°¨t
,É->
íd
);

73 
	`¥ötf
("%*soff£à%"
PRId64
"\n", 
	`MAX
(0,50-
n
), "", 
e
->
off£t
);

74 
i
 = 0; i < 
e
->
n¶i˚
; i++) {

75 
	`dump_ödex_
(&
e
->e[
i
], 
Àvñ
+1);

77 
	}
}

79 
	$dump_ödex
(
¸am_fd
 *
fd
) {

80 
i
;

81 
i
 = 0; i < 
fd
->
ödex_sz
; i++) {

82 
	`dump_ödex_
(&
fd
->
ödex
[
i
], 0);

84 
	}
}

87 
	$kgë_öt32
(
k°rög_t
 *
k
, 
size_t
 *
pos
, 
öt32_t
 *
vÆ_p
) {

88 
sign
 = 1;

89 
öt32_t
 
vÆ
 = 0;

90 
size_t
 
p
 = *
pos
;

92 
p
 < 
k
->
l
 && (k->
s
[p] == ' ' || k->s[p] == '\t'))

93 
p
++;

95 i‡(
p
 < 
k
->
l
 && k->
s
[p] == '-')

96 
sign
 = -1, 
p
++;

98 i‡(
p
 >
k
->
l
 || !(k->
s
[p] >= '0' && k->s[p] <= '9'))

101 
p
 < 
k
->
l
 && k->
s
[p] >= '0' && k->s[p] <= '9')

102 
vÆ
 = vÆ*10 + 
k
->
s
[
p
++]-'0';

104 *
pos
 = 
p
;

105 *
vÆ_p
 = 
sign
*
vÆ
;

108 
	}
}

110 
	$kgë_öt64
(
k°rög_t
 *
k
, 
size_t
 *
pos
, 
öt64_t
 *
vÆ_p
) {

111 
sign
 = 1;

112 
öt64_t
 
vÆ
 = 0;

113 
size_t
 
p
 = *
pos
;

115 
p
 < 
k
->
l
 && (k->
s
[p] == ' ' || k->s[p] == '\t'))

116 
p
++;

118 i‡(
p
 < 
k
->
l
 && k->
s
[p] == '-')

119 
sign
 = -1, 
p
++;

121 i‡(
p
 >
k
->
l
 || !(k->
s
[p] >= '0' && k->s[p] <= '9'))

124 
p
 < 
k
->
l
 && k->
s
[p] >= '0' && k->s[p] <= '9')

125 
vÆ
 = vÆ*10 + 
k
->
s
[
p
++]-'0';

127 *
pos
 = 
p
;

128 *
vÆ_p
 = 
sign
*
vÆ
;

131 
	}
}

139 
	$¸am_ödex_lﬂd
(
¸am_fd
 *
fd
, c⁄° *
‚
, c⁄° *
‚_idx
) {

140 *
‚2
 = 
NULL
;

141 
buf
[65536];

142 
ssize_t
 
Àn
;

143 
k°rög_t
 
k°r
 = {0};

144 
hFILE
 *
Â
;

145 
¸am_ödex
 *
idx
;

146 
¸am_ödex
 **
idx_°ack
 = 
NULL
, *
ï
, 
e
;

147 
idx_°ack_Æloc
 = 0, 
idx_°ack_±r
 = 0;

148 
size_t
 
pos
 = 0;

151 i‡(
fd
->
ödex
)

154 
fd
->
ödex
 = 
	`ˇŒoc
((fd->
ödex_sz
 = 1), (*fd->index));

155 i‡(!
fd
->
ödex
)

158 
idx
 = &
fd
->
ödex
[0];

159 
idx
->
ªfid
 = -1;

160 
idx
->
°¨t
 = 
INT_MIN
;

161 
idx
->
íd
 = 
INT_MAX
;

163 
idx_°ack
 = 
	`ˇŒoc
(++
idx_°ack_Æloc
, (*idx_stack));

164 i‡(!
idx_°ack
)

165 
Áû
;

167 
idx_°ack
[
idx_°ack_±r
] = 
idx
;

169 i‡(!
‚_idx
) {

170 
‚2
 = 
	`hts_idx_gë‚
(
‚
, ".crai");

171 i‡(!
‚2
)

172 
Áû
;

174 
‚_idx
 = 
‚2
;

177 i‡(!(
Â
 = 
	`h›í
(
‚_idx
, "r"))) {

178 
	`≥º‹
(
‚_idx
);

179 
Áû
;

183 (
Àn
 = 
	`hªad
(
Â
, 
buf
, (buf))) > 0) {

184 i‡(
	`kput¢
(
buf
, 
Àn
, &
k°r
) < 0)

185 
Áû
;

188 i‡(
Àn
 < 0 || 
k°r
.
l
 < 2)

189 
Áû
;

191 i‡(
	`h˛o£
(
Â
) < 0)

192 
Áû
;

195 i‡(
k°r
.
s
[0] =31 && (
uc
)kstr.s[1] == 139) {

196 
size_t
 
l
;

197 *
s
 = 
	`zlib_mem_öÊ©e
(
k°r
.s, k°r.
l
, &l);

198 i‡(!
s
)

199 
Áû
;

201 
	`‰ì
(
k°r
.
s
);

202 
k°r
.
s
 = s;

203 
k°r
.
l
 =Ü;

204 
k°r
.
m
 = 
l
;

205 i‡(
	`kput¢
("", 0, &
k°r
) < 0)

206 
Áû
;

213 i‡(
	`kgë_öt32
(&
k°r
, &
pos
, &
e
.
ªfid
) == -1)

214 
Áû
;

216 i‡(
	`kgë_öt32
(&
k°r
, &
pos
, &
e
.
°¨t
) == -1)

217 
Áû
;

219 i‡(
	`kgë_öt32
(&
k°r
, &
pos
, &
e
.
íd
) == -1)

220 
Áû
;

222 i‡(
	`kgë_öt64
(&
k°r
, &
pos
, &
e
.
off£t
) == -1)

223 
Áû
;

225 i‡(
	`kgë_öt32
(&
k°r
, &
pos
, &
e
.
¶i˚
) == -1)

226 
Áû
;

228 i‡(
	`kgë_öt32
(&
k°r
, &
pos
, &
e
.
Àn
) == -1)

229 
Áû
;

231 
e
.
íd
 +e.
°¨t
-1;

234 i‡(
e
.
ªfid
 < -1) {

235 
	`Ârötf
(
°dîr
, "MÆf‹med index fûe,Ñefid %d\n", 
e
.
ªfid
);

236 
Áû
;

239 i‡(
e
.
ªfid
 !
idx
->refid) {

240 i‡(
fd
->
ödex_sz
 < 
e
.
ªfid
+2) {

241 
¸am_ödex
 *
√w_idx
;

242 
√w_sz
 = 
e
.
ªfid
+2;

243 
size_t
 
ödex_íd
 = 
fd
->
ödex_sz
 * (*fd->
ödex
);

244 
√w_idx
 = 
	`ªÆloc
(
fd
->
ödex
,

245 
√w_sz
 * (*
fd
->
ödex
));

246 i‡(!
√w_idx
)

247 
Áû
;

249 
fd
->
ödex
 = 
√w_idx
;

250 
fd
->
ödex_sz
 = 
√w_sz
;

251 
	`mem£t
(((*)
fd
->
ödex
Ë+ 
ödex_íd
, 0,

252 
fd
->
ödex_sz
 * (*fd->
ödex
Ë- 
ödex_íd
);

254 
idx
 = &
fd
->
ödex
[
e
.
ªfid
+1];

255 
idx
->
ªfid
 = 
e
.refid;

256 
idx
->
°¨t
 = 
INT_MIN
;

257 
idx
->
íd
 = 
INT_MAX
;

258 
idx
->
n¶i˚
 = idx->
«Œoc
 = 0;

259 
idx
->
e
 = 
NULL
;

260 
idx_°ack
[(
idx_°ack_±r
 = 0)] = 
idx
;

263 !(
e
.
°¨t
 >
idx
->°¨à&&É.
íd
 <= idx->end) || idx->end == 0) {

264 
idx
 = 
idx_°ack
[--
idx_°ack_±r
];

268 i‡(
idx
->
n¶i˚
+1 >idx->
«Œoc
) {

269 
¸am_ödex
 *
√w_e
;

270 
idx
->
«Œoc
 = idx->nalloc ? idx->nalloc*2 : 16;

271 
√w_e
 = 
	`ªÆloc
(
idx
->
e
, idx->
«Œoc
 * (*idx->e));

272 i‡(!
√w_e
)

273 
Áû
;

275 
idx
->
e
 = 
√w_e
;

278 
e
.
«Œoc
 =É.
n¶i˚
 = 0;É.ê
NULL
;

279 *(
ï
 = &
idx
->
e
[idx->
n¶i˚
++]) =É;

280 
idx
 = 
ï
;

282 i‡(++
idx_°ack_±r
 >
idx_°ack_Æloc
) {

283 
¸am_ödex
 **
√w_°ack
;

284 
idx_°ack_Æloc
 *= 2;

285 
√w_°ack
 = 
	`ªÆloc
(
idx_°ack
, 
idx_°ack_Æloc
*(*idx_stack));

286 i‡(!
√w_°ack
)

287 
Áû
;

288 
idx_°ack
 = 
√w_°ack
;

290 
idx_°ack
[
idx_°ack_±r
] = 
idx
;

292 
pos
 < 
k°r
.
l
 && k°r.
s
[pos] != '\n')

293 
pos
++;

294 
pos
++;

295 } 
pos
 < 
k°r
.
l
);

297 
	`‰ì
(
idx_°ack
);

298 
	`‰ì
(
k°r
.
s
);

299 
	`‰ì
(
‚2
);

305 
Áû
:

306 
	`‰ì
(
k°r
.
s
);

307 
	`‰ì
(
idx_°ack
);

308 
	`‰ì
(
‚2
);

309 
	`¸am_ödex_‰ì
(
fd
);

311 
	}
}

313 
	$¸am_ödex_‰ì_ªcur£
(
¸am_ödex
 *
e
) {

314 i‡(
e
->e) {

315 
i
;

316 
i
 = 0; i < 
e
->
n¶i˚
; i++) {

317 
	`¸am_ödex_‰ì_ªcur£
(&
e
->e[
i
]);

319 
	`‰ì
(
e
->e);

321 
	}
}

323 
	$¸am_ödex_‰ì
(
¸am_fd
 *
fd
) {

324 
i
;

326 i‡(!
fd
->
ödex
)

329 
i
 = 0; i < 
fd
->
ödex_sz
; i++) {

330 
	`¸am_ödex_‰ì_ªcur£
(&
fd
->
ödex
[
i
]);

332 
	`‰ì
(
fd
->
ödex
);

334 
fd
->
ödex
 = 
NULL
;

335 
	}
}

351 
¸am_ödex
 *
	$¸am_ödex_quîy
(
¸am_fd
 *
fd
, 
ªfid
, 
pos
,

352 
¸am_ödex
 *
‰om
) {

353 
i
, 
j
, 
k
;

354 
¸am_ödex
 *
e
;

356 i‡(
ªfid
+1 < 0 ||Ñefid+1 >
fd
->
ödex_sz
)

357  
NULL
;

359 i‡(!
‰om
)

360 
‰om
 = &
fd
->
ödex
[
ªfid
+1];

363 i‡(!
‰om
->
e
)

364  
NULL
;

368 
i
 = 0, 
j
 = 
fd
->
ödex
[
ªfid
+1].
n¶i˚
-1;

369 
k
 = 
j
/2; k !
i
; k = (j-i)/2 + i) {

370 i‡(
‰om
->
e
[
k
].
ªfid
 >Ñefid) {

371 
j
 = 
k
;

375 i‡(
‰om
->
e
[
k
].
ªfid
 <Ñefid) {

376 
i
 = 
k
;

380 i‡(
‰om
->
e
[
k
].
°¨t
 >
pos
) {

381 
j
 = 
k
;

385 i‡(
‰om
->
e
[
k
].
°¨t
 < 
pos
) {

386 
i
 = 
k
;

391 i‡(
j
 >0 && 
‰om
->
e
[j].
°¨t
 < 
pos
 && from->e[j].
ªfid
 ==Ñefid)

392 
i
 = 
j
;

395 
i
 > 0 && 
‰om
->
e
[i-1].
íd
 >
pos
)

396 
i
--;

399 
i
+1 < 
‰om
->
n¶i˚
 &&

400 (
‰om
->
e
[
i
].
ªfid
 <Ñefid ||

401 
‰om
->
e
[
i
].
íd
 < 
pos
))

402 
i
++;

404 
e
 = &
‰om
->e[
i
];

406  
e
;

407 
	}
}

424 
	$¸am_£ek_to_ªÂos
(
¸am_fd
 *
fd
, 
¸am_ønge
 *
r
) {

425 
¸am_ödex
 *
e
;

428 i‡((
e
 = 
	`¸am_ödex_quîy
(
fd
, 
r
->
ªfid
,Ñ->
°¨t
, 
NULL
))) {

429 i‡(0 !
	`¸am_£ek
(
fd
, 
e
->
off£t
, 
SEEK_SET
))

430 i‡(0 !
	`¸am_£ek
(
fd
, 
e
->
off£t
 - fd->
fú°_c⁄èöî
, 
SEEK_CUR
))

437 i‡(
fd
->
˘r
) {

438 
	`¸am_‰ì_c⁄èöî
(
fd
->
˘r
);

439 
fd
->
˘r
 = 
NULL
;

440 
fd
->
ooc
 = 0;

444 
	}
}

455 
	$¸am_ödex_buûd_mu…úef
(
¸am_fd
 *
fd
,

456 
¸am_c⁄èöî
 *
c
,

457 
¸am_¶i˚
 *
s
,

458 
zÂ
 *
Â
,

459 
off_t
 
˝os
,

460 
öt32_t
 
œndm¨k
,

461 
sz
) {

462 
i
, 
ªf
 = -2, 
ªf_°¨t
 = 0, 
ªf_íd
;

463 
buf
[1024];

465 i‡(0 !
	`¸am_decode_¶i˚
(
fd
, 
c
, 
s
, fd->
hódî
))

468 
ªf_íd
 = 
INT_MIN
;

469 
i
 = 0; i < 
s
->
hdr
->
num_ªc‹ds
; i++) {

470 i‡(
s
->
¸ecs
[
i
].
ªf_id
 =
ªf
) {

471 i‡(
ªf_íd
 < 
s
->
¸ecs
[
i
].
´nd
)

472 
ªf_íd
 = 
s
->
¸ecs
[
i
].
´nd
;

476 i‡(
ªf
 != -2) {

477 
	`•rötf
(
buf
, "%d\t%d\t%d\t%"
PRId64
"\t%d\t%d\n",

478 
ªf
, 
ªf_°¨t
, 
ªf_íd
 -Ñef_start + 1,

479 (
öt64_t
)
˝os
, 
œndm¨k
, 
sz
);

480 
	`zÂuts
(
buf
, 
Â
);

483 
ªf
 = 
s
->
¸ecs
[
i
].
ªf_id
;

484 
ªf_°¨t
 = 
s
->
¸ecs
[
i
].
≠os
;

485 
ªf_íd
 = 
INT_MIN
;

488 i‡(
ªf
 != -2) {

489 
	`•rötf
(
buf
, "%d\t%d\t%d\t%"
PRId64
"\t%d\t%d\n",

490 
ªf
, 
ªf_°¨t
, 
ªf_íd
 -Ñef_start + 1,

491 (
öt64_t
)
˝os
, 
œndm¨k
, 
sz
);

492 
	`zÂuts
(
buf
, 
Â
);

496 
	}
}

509 
	$¸am_ödex_buûd
(
¸am_fd
 *
fd
, c⁄° *
‚_ba£
, c⁄° *
‚_idx
) {

510 
¸am_c⁄èöî
 *
c
;

511 
off_t
 
˝os
, 
•os
, 
hpos
;

512 
zÂ
 *
Â
;

513 
k°rög_t
 
‚_idx_°r
 = {0};

515 i‡(! 
‚_idx
) {

516 
	`kputs
(
‚_ba£
, &
‚_idx_°r
);

517 
	`kputs
(".¸ai", &
‚_idx_°r
);

518 
‚_idx
 = 
‚_idx_°r
.
s
;

521 i‡(!(
Â
 = 
	`zf›í
(
‚_idx
, "wz"))) {

522 
	`≥º‹
(
‚_idx
);

523 
	`‰ì
(
‚_idx_°r
.
s
);

527 
	`‰ì
(
‚_idx_°r
.
s
);

529 
˝os
 = 
	`hãŒ
(
fd
->
Â
);

530 (
c
 = 
	`¸am_ªad_c⁄èöî
(
fd
))) {

531 
j
;

533 i‡(
fd
->
îr
) {

534 
	`≥º‹
("Cram containerÑead");

538 
hpos
 = 
	`hãŒ
(
fd
->
Â
);

540 i‡(!(
c
->
comp_hdr_block
 = 
	`¸am_ªad_block
(
fd
)))

542 
	`as£π
(
c
->
comp_hdr_block
->
c⁄ã¡_ty≥
 =
COMPRESSION_HEADER
);

544 
c
->
comp_hdr
 = 
	`¸am_decode_com¥essi⁄_hódî
(
fd
, c->
comp_hdr_block
);

545 i‡(!
c
->
comp_hdr
)

549 
j
 = 0; j < 
c
->
num_œndm¨ks
; j++) {

550 
buf
[1024];

551 
¸am_¶i˚
 *
s
;

552 
sz
;

554 
•os
 = 
	`hãŒ
(
fd
->
Â
);

555 
	`as£π
(
•os
 - 
˝os
 - 
c
->
off£t
 =c->
œndm¨k
[
j
]);

557 i‡(!(
s
 = 
	`¸am_ªad_¶i˚
(
fd
))) {

558 
	`zf˛o£
(
Â
);

562 
sz
 = ()(
	`hãŒ
(
fd
->
Â
Ë- 
•os
);

564 i‡(
s
->
hdr
->
ªf_£q_id
 == -2) {

565 
	`¸am_ödex_buûd_mu…úef
(
fd
, 
c
, 
s
, 
Â
,

566 
˝os
, 
c
->
œndm¨k
[
j
], 
sz
);

568 
	`•rötf
(
buf
, "%d\t%d\t%d\t%"
PRId64
"\t%d\t%d\n",

569 
s
->
hdr
->
ªf_£q_id
, s->hdr->
ªf_£q_°¨t
,

570 
s
->
hdr
->
ªf_£q_•™
, (
öt64_t
)
˝os
,

571 
c
->
œndm¨k
[
j
], 
sz
);

572 
	`zÂuts
(
buf
, 
Â
);

575 
	`¸am_‰ì_¶i˚
(
s
);

578 
˝os
 = 
	`hãŒ
(
fd
->
Â
);

579 
	`as£π
(
˝os
 =
hpos
 + 
c
->
Àngth
);

581 
	`¸am_‰ì_c⁄èöî
(
c
);

583 i‡(
fd
->
îr
) {

584 
	`zf˛o£
(
Â
);

589  (
	`zf˛o£
(
Â
) >= 0)? 0 : -4;

590 
	}
}

	@htslib/cram/cram_index.h

31 #i‚de‡
_CRAM_INDEX_H_


32 
	#_CRAM_INDEX_H_


	)

34 #ifde‡
__˝lu•lus


43 
¸am_ödex_lﬂd
(
¸am_fd
 *
fd
, c⁄° *
‚
, c⁄° *
‚_idx
);

45 
¸am_ödex_‰ì
(
¸am_fd
 *
fd
);

54 
¸am_ödex
 *
¸am_ödex_quîy
(
¸am_fd
 *
fd
, 
ªfid
, 
pos
, cøm_ödex *
‰m
);

63 
¸am_£ek_to_ªÂos
(
¸am_fd
 *
fd
, 
¸am_ønge
 *
r
);

65 
¸am_ödex_‰ì
(
¸am_fd
 *
fd
);

80 
¸am_£ek_to_ªÂos
(
¸am_fd
 *
fd
, 
¸am_ønge
 *
r
);

93 
¸am_ödex_buûd
(
¸am_fd
 *
fd
, c⁄° *
‚_ba£
, c⁄° *
‚_idx
);

95 #ifde‡
__˝lu•lus


	@htslib/cram/cram_io.c

47 
	~<c⁄fig.h
>

49 
	~<°dio.h
>

50 
	~<î∫o.h
>

51 
	~<as£π.h
>

52 
	~<°dlib.h
>

53 
	~<°rög.h
>

54 
	~<uni°d.h
>

55 
	~<zlib.h
>

56 #ifde‡
HAVE_LIBBZ2


57 
	~<bzlib.h
>

59 #ifde‡
HAVE_LIBLZMA


60 
	~<lzma.h
>

62 
	~<sys/ty≥s.h
>

63 
	~<sys/°©.h
>

64 
	~<m©h.h
>

65 
	~<time.h
>

66 
	~<°döt.h
>

68 
	~"¸am/¸am.h
"

69 
	~"¸am/os.h
"

70 
	~"ht¶ib/hts.h
"

71 
	~"¸am/›í_åa˚_fûe.h
"

72 
	~"¸am/rANS_°©ic.h
"

76 #ifde‡
REF_DEBUG


77 
	~<sys/sysˇŒ.h
>

78 
	#gëtid
(Ë()
	`sysˇŒ
(
SYS_gëtid
)

	)

80 
	#RP
(...Ë
	`Ârötf
 (
°dîr
, 
__VA_ARGS__
)

	)

82 
	#RP
(...)

	)

85 
	~"ht¶ib/hfûe.h
"

86 
	~"ht¶ib/bgzf.h
"

87 
	~"ht¶ib/Áidx.h
"

88 
	~"hts_öã∫Æ.h
"

90 #i‚de‡
PATH_MAX


91 
	#PATH_MAX
 
FILENAME_MAX


	)

94 
	#TRIAL_SPAN
 50

	)

95 
	#NTRIALS
 3

	)

113 
	$ôf8_decode
(
¸am_fd
 *
fd
, 
öt32_t
 *
vÆ_p
) {

114 
nbyãs
[16] = {

122 
nbôs
[16] = {

130 
öt32_t
 
vÆ
 = 
	`hgëc
(
fd
->
Â
);

131 i‡(
vÆ
 == -1)

134 
i
 = 
nbyãs
[
vÆ
>>4];

135 
vÆ
 &
nbôs
[val>>4];

137 
i
) {

139 *
vÆ_p
 = 
vÆ
;

143 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

144 *
vÆ_p
 = 
vÆ
;

148 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

149 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

150 *
vÆ_p
 = 
vÆ
;

154 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

155 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

156 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

157 *
vÆ_p
 = 
vÆ
;

161 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

162 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

163 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

164 
vÆ
 = (vÆ<<4Ë| ((()
	`hgëc
(
fd
->
Â
)) & 0x0f);

165 *
vÆ_p
 = 
vÆ
;

169 
	}
}

171 
	$ôf8_decode_¸c
(
¸am_fd
 *
fd
, 
öt32_t
 *
vÆ_p
, 
uöt32_t
 *
¸c
) {

172 
nbyãs
[16] = {

180 
nbôs
[16] = {

187 
c
[5];

189 
öt32_t
 
vÆ
 = 
	`hgëc
(
fd
->
Â
);

190 i‡(
vÆ
 == -1)

193 
c
[0]=
vÆ
;

195 
i
 = 
nbyãs
[
vÆ
>>4];

196 
vÆ
 &
nbôs
[val>>4];

198 
i
) {

200 *
vÆ_p
 = 
vÆ
;

201 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 1);

205 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));

206 *
vÆ_p
 = 
vÆ
;

207 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 2);

211 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));

212 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));

213 *
vÆ_p
 = 
vÆ
;

214 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 3);

218 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));

219 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));

220 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));

221 *
vÆ_p
 = 
vÆ
;

222 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 4);

227 
uöt32_t
 
uv
 = 
vÆ
;

228 
uv
 = (uv<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));

229 
uv
 = (uv<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));

230 
uv
 = (uv<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));

231 
uv
 = (uv<<4Ë| (((
c
[4]=
	`hgëc
(
fd
->
Â
))) & 0x0f);

232 *
vÆ_p
 = 
uv
 < 0x80000000UL ? uv : -((
öt32_t
) (0xffffffffUL - uv)) - 1;

233 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 5);

238 
	}
}

245 
	$ôf8_ícode
(
¸am_fd
 *
fd
, 
öt32_t
 
vÆ
) {

246 
buf
[5];

247 
Àn
 = 
	`ôf8_put
(
buf
, 
vÆ
);

248  
	`hwrôe
(
fd
->
Â
, 
buf
, 
Àn
) ==Üen ? 0 : -1;

249 
	}
}

251 c⁄° 
	gôf8_byãs
[16] = {

256 c⁄° 
	g…f8_byãs
[256] = {

283 
	$…f8_decode
(
¸am_fd
 *
fd
, 
öt64_t
 *
vÆ_p
) {

284 
c
 = 
	`hgëc
(
fd
->
Â
);

285 
öt64_t
 
vÆ
 = ()
c
;

286 i‡(
c
 == -1)

289 i‡(
vÆ
 < 0x80) {

290 *
vÆ_p
 = 
vÆ
;

293 } i‡(
vÆ
 < 0xc0) {

294 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

295 *
vÆ_p
 = 
vÆ
 & (((1LL<<(6+8)))-1);

298 } i‡(
vÆ
 < 0xe0) {

299 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

300 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

301 *
vÆ_p
 = 
vÆ
 & ((1LL<<(5+2*8))-1);

304 } i‡(
vÆ
 < 0xf0) {

305 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

306 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

307 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

308 *
vÆ_p
 = 
vÆ
 & ((1LL<<(4+3*8))-1);

311 } i‡(
vÆ
 < 0xf8) {

312 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

313 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

314 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

315 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

316 *
vÆ_p
 = 
vÆ
 & ((1LL<<(3+4*8))-1);

319 } i‡(
vÆ
 < 0xfc) {

320 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

321 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

322 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

323 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

324 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

325 *
vÆ_p
 = 
vÆ
 & ((1LL<<(2+5*8))-1);

328 } i‡(
vÆ
 < 0xfe) {

329 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

330 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

331 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

332 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

333 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

334 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

335 *
vÆ_p
 = 
vÆ
 & ((1LL<<(1+6*8))-1);

338 } i‡(
vÆ
 < 0xff) {

339 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

340 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

341 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

342 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

343 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

344 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

345 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

346 *
vÆ_p
 = 
vÆ
 & ((1LL<<(7*8))-1);

350 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

351 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

352 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

353 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

354 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

355 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

356 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

357 
vÆ
 = (vÆ<<8Ë| ()
	`hgëc
(
fd
->
Â
);

358 *
vÆ_p
 = 
vÆ
;

362 
	}
}

364 
	$…f8_decode_¸c
(
¸am_fd
 *
fd
, 
öt64_t
 *
vÆ_p
, 
uöt32_t
 *
¸c
) {

365 
c
[9];

366 
öt64_t
 
vÆ
 = ()
	`hgëc
(
fd
->
Â
);

367 i‡(
vÆ
 == -1)

370 
c
[0] = 
vÆ
;

372 i‡(
vÆ
 < 0x80) {

373 *
vÆ_p
 = 
vÆ
;

374 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 1);

377 } i‡(
vÆ
 < 0xc0) {

378 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

379 *
vÆ_p
 = 
vÆ
 & (((1LL<<(6+8)))-1);

380 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 2);

383 } i‡(
vÆ
 < 0xe0) {

384 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

385 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

386 *
vÆ_p
 = 
vÆ
 & ((1LL<<(5+2*8))-1);

387 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 3);

390 } i‡(
vÆ
 < 0xf0) {

391 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

392 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

393 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));;

394 *
vÆ_p
 = 
vÆ
 & ((1LL<<(4+3*8))-1);

395 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 4);

398 } i‡(
vÆ
 < 0xf8) {

399 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

400 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

401 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));;

402 
vÆ
 = (vÆ<<8Ë| (
c
[4]=
	`hgëc
(
fd
->
Â
));;

403 *
vÆ_p
 = 
vÆ
 & ((1LL<<(3+4*8))-1);

404 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 5);

407 } i‡(
vÆ
 < 0xfc) {

408 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

409 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

410 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));;

411 
vÆ
 = (vÆ<<8Ë| (
c
[4]=
	`hgëc
(
fd
->
Â
));;

412 
vÆ
 = (vÆ<<8Ë| (
c
[5]=
	`hgëc
(
fd
->
Â
));;

413 *
vÆ_p
 = 
vÆ
 & ((1LL<<(2+5*8))-1);

414 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 6);

417 } i‡(
vÆ
 < 0xfe) {

418 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

419 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

420 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));;

421 
vÆ
 = (vÆ<<8Ë| (
c
[4]=
	`hgëc
(
fd
->
Â
));;

422 
vÆ
 = (vÆ<<8Ë| (
c
[5]=
	`hgëc
(
fd
->
Â
));;

423 
vÆ
 = (vÆ<<8Ë| (
c
[6]=
	`hgëc
(
fd
->
Â
));;

424 *
vÆ_p
 = 
vÆ
 & ((1LL<<(1+6*8))-1);

425 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 7);

428 } i‡(
vÆ
 < 0xff) {

429 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

430 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

431 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));;

432 
vÆ
 = (vÆ<<8Ë| (
c
[4]=
	`hgëc
(
fd
->
Â
));;

433 
vÆ
 = (vÆ<<8Ë| (
c
[5]=
	`hgëc
(
fd
->
Â
));;

434 
vÆ
 = (vÆ<<8Ë| (
c
[6]=
	`hgëc
(
fd
->
Â
));;

435 
vÆ
 = (vÆ<<8Ë| (
c
[7]=
	`hgëc
(
fd
->
Â
));;

436 *
vÆ_p
 = 
vÆ
 & ((1LL<<(7*8))-1);

437 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 8);

441 
vÆ
 = (vÆ<<8Ë| (
c
[1]=
	`hgëc
(
fd
->
Â
));;

442 
vÆ
 = (vÆ<<8Ë| (
c
[2]=
	`hgëc
(
fd
->
Â
));;

443 
vÆ
 = (vÆ<<8Ë| (
c
[3]=
	`hgëc
(
fd
->
Â
));;

444 
vÆ
 = (vÆ<<8Ë| (
c
[4]=
	`hgëc
(
fd
->
Â
));;

445 
vÆ
 = (vÆ<<8Ë| (
c
[5]=
	`hgëc
(
fd
->
Â
));;

446 
vÆ
 = (vÆ<<8Ë| (
c
[6]=
	`hgëc
(
fd
->
Â
));;

447 
vÆ
 = (vÆ<<8Ë| (
c
[7]=
	`hgëc
(
fd
->
Â
));;

448 
vÆ
 = (vÆ<<8Ë| (
c
[8]=
	`hgëc
(
fd
->
Â
));;

449 *
¸c
 = 
	`¸c32
(*¸c, 
c
, 9);

450 *
vÆ_p
 = 
vÆ
;

454 
	}
}

463 
	$ôf8_put_blk
(
¸am_block
 *
blk
, 
vÆ
) {

464 
buf
[5];

465 
sz
;

467 
sz
 = 
	`ôf8_put
(
buf
, 
vÆ
);

468 
	`BLOCK_APPEND
(
blk
, 
buf
, 
sz
);

469  
sz
;

470 
	}
}

478 
	$öt32_decode
(
¸am_fd
 *
fd
, 
öt32_t
 *
vÆ
) {

479 
öt32_t
 
i
;

480 i‡(4 !
	`hªad
(
fd
->
Â
, &
i
, 4))

483 *
vÆ
 = 
	`À_öt4
(
i
);

485 
	}
}

493 
	$öt32_ícode
(
¸am_fd
 *
fd
, 
öt32_t
 
vÆ
) {

494 
vÆ
 = 
	`À_öt4
(val);

495 i‡(4 !
	`hwrôe
(
fd
->
Â
, &
vÆ
, 4))

499 
	}
}

502 
	$öt32_gë_blk
(
¸am_block
 *
b
, 
öt32_t
 *
vÆ
) {

503 i‡(
b
->
uncomp_size
 - 
	`BLOCK_SIZE
(b) < 4)

506 *
vÆ
 =

507 
b
->
d©a
[b->
byã
 ] |

508 (
b
->
d©a
[b->
byã
+1] << 8) |

509 (
b
->
d©a
[b->
byã
+2] << 16) |

510 (
b
->
d©a
[b->
byã
+3] << 24);

511 
	`BLOCK_SIZE
(
b
) += 4;

513 
	}
}

516 
	$öt32_put_blk
(
¸am_block
 *
b
, 
öt32_t
 
vÆ
) {

517 
˝
[4];

518 
˝
[0] = ( 
vÆ
 & 0xff);

519 
˝
[1] = ((
vÆ
>>8) & 0xff);

520 
˝
[2] = ((
vÆ
>>16) & 0xff);

521 
˝
[3] = ((
vÆ
>>24) & 0xff);

523 
	`BLOCK_APPEND
(
b
, 
˝
, 4);

524  
b
->
d©a
 ? 0 : -1;

525 
	}
}

532 *
	$zlib_mem_öÊ©e
(*
cd©a
, 
size_t
 
csize
, size_à*
size
) {

533 
z_°ªam
 
s
;

534 *
d©a
 = 
NULL
;

535 
d©a_Æloc
 = 0;

536 
îr
;

539 
d©a
 = 
	`mÆloc
(
d©a_Æloc
 = 
csize
*1.2+100);

540 i‡(!
d©a
)

541  
NULL
;

544 
s
.
zÆloc
 = 
Z_NULL
;

545 
s
.
z‰ì
 = 
Z_NULL
;

546 
s
.
›aque
 = 
Z_NULL
;

547 
s
.
√xt_ö
 = (*)
cd©a
;

548 
s
.
avaû_ö
 = 
csize
;

549 
s
.
tŸÆ_ö
 = 0;

550 
s
.
√xt_out
 = 
d©a
;

551 
s
.
avaû_out
 = 
d©a_Æloc
;

552 
s
.
tŸÆ_out
 = 0;

555 
îr
 = 
	`öÊ©eInô2
(&
s
, 15 + 32);

556 i‡(
îr
 !
Z_OK
) {

557 
	`Ârötf
(
°dîr
, "zlib inÊ©eInôÉº‹: %s\n", 
s
.
msg
);

558 
	`‰ì
(
d©a
);

559  
NULL
;

563 ;
s
.
avaû_ö
;) {

564 *
d©a_tmp
;

565 
Æloc_öc
;

567 
s
.
√xt_out
 = &
d©a
[s.
tŸÆ_out
];

568 
îr
 = 
	`öÊ©e
(&
s
, 
Z_NO_FLUSH
);

569 i‡(
îr
 =
Z_STREAM_END
)

572 i‡(
îr
 !
Z_OK
) {

573 
	`Ârötf
(
°dîr
, "zlib inÊ©êîr‹: %s\n", 
s
.
msg
);

574 i‡(
d©a
)

575 
	`‰ì
(
d©a
);

576  
NULL
;

580 
Æloc_öc
 = ()
s
.
avaû_ö
/s.
tŸÆ_ö
 * s.
tŸÆ_out
 + 100;

581 
d©a
 = 
	`ªÆloc
((
d©a_tmp
 = d©a), 
d©a_Æloc
 +
Æloc_öc
);

582 i‡(!
d©a
) {

583 
	`‰ì
(
d©a_tmp
);

584  
NULL
;

586 
s
.
avaû_out
 +
Æloc_öc
;

588 
	`öÊ©eEnd
(&
s
);

590 *
size
 = 
s
.
tŸÆ_out
;

591  (*)
d©a
;

592 
	}
}

594 *
	$zlib_mem_deÊ©e
(*
d©a
, 
size_t
 
size
, size_à*
cd©a_size
,

595 
Àvñ
, 
°øt
) {

596 
z_°ªam
 
s
;

597 *
cd©a
 = 
NULL
;

598 
cd©a_Æloc
 = 0;

599 
cd©a_pos
 = 0;

600 
îr
;

602 
cd©a
 = 
	`mÆloc
(
cd©a_Æloc
 = 
size
*1.05+100);

603 i‡(!
cd©a
)

604  
NULL
;

605 
cd©a_pos
 = 0;

608 
s
.
zÆloc
 = 
Z_NULL
;

609 
s
.
z‰ì
 = 
Z_NULL
;

610 
s
.
›aque
 = 
Z_NULL
;

611 
s
.
√xt_ö
 = (*)
d©a
;

612 
s
.
avaû_ö
 = 
size
;

613 
s
.
tŸÆ_ö
 = 0;

614 
s
.
√xt_out
 = 
cd©a
;

615 
s
.
avaû_out
 = 
cd©a_Æloc
;

616 
s
.
tŸÆ_out
 = 0;

617 
s
.
d©a_ty≥
 = 
Z_BINARY
;

619 
îr
 = 
	`deÊ©eInô2
(&
s
, 
Àvñ
, 
Z_DEFLATED
, 15|16, 9, 
°øt
);

620 i‡(
îr
 !
Z_OK
) {

621 
	`Ârötf
(
°dîr
, "zlib deÊ©eInô2Éº‹: %s\n", 
s
.
msg
);

622  
NULL
;

626 ;
s
.
avaû_ö
;) {

627 
s
.
√xt_out
 = &
cd©a
[
cd©a_pos
];

628 
s
.
avaû_out
 = 
cd©a_Æloc
 - 
cd©a_pos
;

629 i‡(
cd©a_Æloc
 - 
cd©a_pos
 <= 0) {

630 
	`Ârötf
(
°dîr
, "DeflateÖroducedÜarger outputÅhanÉxpected. Abort\n");

631  
NULL
;

633 
îr
 = 
	`deÊ©e
(&
s
, 
Z_NO_FLUSH
);

634 
cd©a_pos
 = 
cd©a_Æloc
 - 
s
.
avaû_out
;

635 i‡(
îr
 !
Z_OK
) {

636 
	`Ârötf
(
°dîr
, "zlib deÊ©êîr‹: %s\n", 
s
.
msg
);

640 i‡(
	`deÊ©e
(&
s
, 
Z_FINISH
Ë!
Z_STREAM_END
) {

641 
	`Ârötf
(
°dîr
, "zlib deÊ©êîr‹: %s\n", 
s
.
msg
);

643 *
cd©a_size
 = 
s
.
tŸÆ_out
;

645 i‡(
	`deÊ©eEnd
(&
s
Ë!
Z_OK
) {

646 
	`Ârötf
(
°dîr
, "zlib deÊ©êîr‹: %s\n", 
s
.
msg
);

648  (*)
cd©a
;

649 
	}
}

651 #ifde‡
HAVE_LIBLZMA


666 *
	$lzma_mem_deÊ©e
(*
d©a
, 
size_t
 
size
, size_à*
cd©a_size
,

667 
Àvñ
) {

668 *
out
;

669 
size_t
 
out_size
 = 
	`lzma_°ªam_buf„r_bound
(
size
);

670 *
cd©a_size
 = 0;

672 
out
 = 
	`mÆloc
(
out_size
);

675 i‡(
LZMA_OK
 !
	`lzma_ósy_buf„r_ícode
(
Àvñ
, 
LZMA_CHECK_CRC32
, 
NULL
,

676 (
uöt8_t
 *)
d©a
, 
size
,

677 (
uöt8_t
 *)
out
, 
cd©a_size
,

678 
out_size
))

679  
NULL
;

681  
out
;

682 
	}
}

684 *
	$lzma_mem_öÊ©e
(*
cd©a
, 
size_t
 
csize
, size_à*
size
) {

685 
lzma_°ªam
 
°rm
 = 
LZMA_STREAM_INIT
;

686 
size_t
 
out_size
 = 0, 
out_pos
 = 0;

687 *
out
 = 
NULL
;

688 
r
;

691 i‡(
LZMA_OK
 !
	`lzma_°ªam_decodî
(&
°rm
, 
	`lzma_ósy_decodî_memußge
(9), 0))

692  
NULL
;

695 
°rm
.
avaû_ö
 = 
csize
;

696 
°rm
.
√xt_ö
 = (
uöt8_t
 *)
cd©a
;

698 ;
°rm
.
avaû_ö
;) {

699 i‡(
°rm
.
avaû_ö
 > 
out_size
 - 
out_pos
) {

700 
out_size
 +
°rm
.
avaû_ö
 * 4 + 32768;

701 
out
 = 
	`ªÆloc
(out, 
out_size
);

703 
°rm
.
avaû_out
 = 
out_size
 - 
out_pos
;

704 
°rm
.
√xt_out
 = (
uöt8_t
 *)&
out
[
out_pos
];

706 
r
 = 
	`lzma_code
(&
°rm
, 
LZMA_RUN
);

707 i‡(
LZMA_OK
 !
r
 && 
LZMA_STREAM_END
 !=Ñ) {

708 
	`Ârötf
(
°dîr
, "[E::%s] LZMA decodêÁûuª (îr‹ %d)\n", 
__func__
, 
r
);

709  
NULL
;

712 
out_pos
 = 
°rm
.
tŸÆ_out
;

714 i‡(
r
 =
LZMA_STREAM_END
)

719 
r
 = 
	`lzma_code
(&
°rm
, 
LZMA_FINISH
);

720 i‡(
r
 !
LZMA_OK
 &&Ñ !
LZMA_STREAM_END
) {

721 
	`Ârötf
(
°dîr
, "r=%d\n", 
r
);

722  
NULL
;

725 
out
 = 
	`ªÆloc
(out, 
°rm
.
tŸÆ_out
);

726 *
size
 = 
°rm
.
tŸÆ_out
;

728 
	`lzma_íd
(&
°rm
);

730  
out
;

731 
	}
}

749 
¸am_block
 *
	$¸am_√w_block
(
¸am_c⁄ã¡_ty≥
 
c⁄ã¡_ty≥
,

750 
c⁄ã¡_id
) {

751 
¸am_block
 *
b
 = 
	`mÆloc
((*b));

752 i‡(!
b
)

753  
NULL
;

754 
b
->
mëhod
 = b->
‹ig_mëhod
 = 
RAW
;

755 
b
->
c⁄ã¡_ty≥
 = content_type;

756 
b
->
c⁄ã¡_id
 = content_id;

757 
b
->
comp_size
 = 0;

758 
b
->
uncomp_size
 = 0;

759 
b
->
d©a
 = 
NULL
;

760 
b
->
Æloc
 = 0;

761 
b
->
byã
 = 0;

762 
b
->
bô
 = 7;

764  
b
;

765 
	}
}

772 
¸am_block
 *
	$¸am_ªad_block
(
¸am_fd
 *
fd
) {

773 
¸am_block
 *
b
 = 
	`mÆloc
((*b));

774 
c
;

775 
uöt32_t
 
¸c
 = 0;

776 i‡(!
b
)

777  
NULL
;

781 i‡(-1 =(
b
->
mëhod
 = 
	`hgëc
(
fd
->
Â
))Ë{ 
	`‰ì
(b);  
NULL
; }

782 
c
 = 
b
->
mëhod
; 
¸c
 = 
	`¸c32
(crc, &c, 1);

783 i‡(-1 =(
b
->
c⁄ã¡_ty≥

	`hgëc
(
fd
->
Â
))Ë{ 
	`‰ì
(b);  
NULL
; }

784 
c
 = 
b
->
c⁄ã¡_ty≥
; 
¸c
 = 
	`¸c32
(crc, &c, 1);

785 i‡(-1 =
	`ôf8_decode_¸c
(
fd
, &
b
->
c⁄ã¡_id
, &
¸c
)Ë{ 
	`‰ì
(b);  
NULL
; }

786 i‡(-1 =
	`ôf8_decode_¸c
(
fd
, &
b
->
comp_size
, &
¸c
)Ë{ 
	`‰ì
(b);  
NULL
; }

787 i‡(-1 =
	`ôf8_decode_¸c
(
fd
, &
b
->
uncomp_size
, &
¸c
)Ë{ 
	`‰ì
(b);  
NULL
; }

792 i‡(
b
->
mëhod
 =
RAW
) {

793 i‡(
b
->
uncomp_size
 < 0Ë{ 
	`‰ì
(b);  
NULL
; }

794 
b
->
Æloc
 = b->
uncomp_size
;

795 i‡(!(
b
->
d©a
 = 
	`mÆloc
(b->
uncomp_size
))){ 
	`‰ì
(b);  
NULL
; }

796 i‡(
b
->
uncomp_size
 !
	`hªad
(
fd
->
Â
, b->
d©a
, b->uncomp_size)) {

797 
	`‰ì
(
b
->
d©a
);

798 
	`‰ì
(
b
);

799  
NULL
;

802 i‡(
b
->
comp_size
 < 0Ë{ 
	`‰ì
(b);  
NULL
; }

803 
b
->
Æloc
 = b->
comp_size
;

804 i‡(!(
b
->
d©a
 = 
	`mÆloc
(b->
comp_size
))Ë{ 
	`‰ì
(b);  
NULL
; }

805 i‡(
b
->
comp_size
 !
	`hªad
(
fd
->
Â
, b->
d©a
, b->comp_size)) {

806 
	`‰ì
(
b
->
d©a
);

807 
	`‰ì
(
b
);

808  
NULL
;

812 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

813 i‡(-1 =
	`öt32_decode
(
fd
, (
öt32_t
 *)&
b
->
¸c32
)) {

814 
	`‰ì
(
b
);

815  
NULL
;

818 
¸c
 = 
	`¸c32
(¸c, 
b
->
d©a
 ? b->d©®: (
uc
 *)"", b->
Æloc
);

819 i‡(
¸c
 !
b
->
¸c32
) {

820 
	`Ârötf
(
°dîr
, "Block CRC32 failure\n");

821 
	`‰ì
(
b
->
d©a
);

822 
	`‰ì
(
b
);

823  
NULL
;

827 
b
->
‹ig_mëhod
 = b->
mëhod
;

828 
b
->
idx
 = 0;

829 
b
->
byã
 = 0;

830 
b
->
bô
 = 7;

832  
b
;

833 
	}
}

840 
uöt32_t
 
	$¸am_block_size
(
¸am_block
 *
b
) {

841 
d©
[100], *
˝
 = dat;;

842 
uöt32_t
 
sz
;

844 *
˝
++ = 
b
->
mëhod
;

845 *
˝
++ = 
b
->
c⁄ã¡_ty≥
;

846 
˝
 +
	`ôf8_put
((*)˝, 
b
->
c⁄ã¡_id
);

847 
˝
 +
	`ôf8_put
((*)˝, 
b
->
comp_size
);

848 
˝
 +
	`ôf8_put
((*)˝, 
b
->
uncomp_size
);

850 
sz
 = 
˝
-
d©
 + 4;

851 
sz
 +
b
->
mëhod
 =
RAW
 ? b->
uncomp_size
 : b->
comp_size
;

853  
sz
;

854 
	}
}

861 
	$¸am_wrôe_block
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
) {

862 
	`as£π
(
b
->
mëhod
 !
RAW
 || (b->
comp_size
 =b->
uncomp_size
));

864 i‡(
	`hputc
(
b
->
mëhod
, 
fd
->
Â
Ë=
EOF
)  -1;

865 i‡(
	`hputc
(
b
->
c⁄ã¡_ty≥
, 
fd
->
Â
Ë=
EOF
)  -1;

866 i‡(
	`ôf8_ícode
(
fd
, 
b
->
c⁄ã¡_id
) == -1)  -1;

867 i‡(
	`ôf8_ícode
(
fd
, 
b
->
comp_size
) == -1)  -1;

868 i‡(
	`ôf8_ícode
(
fd
, 
b
->
uncomp_size
) == -1)  -1;

870 i‡(
b
->
d©a
) {

871 i‡(
b
->
mëhod
 =
RAW
) {

872 i‡(
b
->
uncomp_size
 !
	`hwrôe
(
fd
->
Â
, b->
d©a
, b->uncomp_size))

875 i‡(
b
->
comp_size
 !
	`hwrôe
(
fd
->
Â
, b->
d©a
, b->comp_size))

880 
	`as£π
(
b
->
mëhod
 =
RAW
 && b->
uncomp_size
 == 0);

883 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

884 
d©
[100], *
˝
 = dat;;

885 
uöt32_t
 
¸c
;

887 *
˝
++ = 
b
->
mëhod
;

888 *
˝
++ = 
b
->
c⁄ã¡_ty≥
;

889 
˝
 +
	`ôf8_put
((*)˝, 
b
->
c⁄ã¡_id
);

890 
˝
 +
	`ôf8_put
((*)˝, 
b
->
comp_size
);

891 
˝
 +
	`ôf8_put
((*)˝, 
b
->
uncomp_size
);

892 
¸c
 = 
	`¸c32
(0L, 
d©
, 
˝
-dat);

894 i‡(
b
->
mëhod
 =
RAW
) {

895 
b
->
¸c32
 = 
	`¸c32
(
¸c
, b->
d©a
 ? b->d©®: (
uc
*)"", b->
uncomp_size
);

897 
b
->
¸c32
 = 
	`¸c32
(
¸c
, b->
d©a
 ? b->d©®: (
uc
*)"", b->
comp_size
);

900 i‡(-1 =
	`öt32_ícode
(
fd
, 
b
->
¸c32
))

905 
	}
}

910 
	$¸am_‰ì_block
(
¸am_block
 *
b
) {

911 i‡(!
b
)

913 i‡(
b
->
d©a
)

914 
	`‰ì
(
b
->
d©a
);

915 
	`‰ì
(
b
);

916 
	}
}

921 
	$¸am_uncom¥ess_block
(
¸am_block
 *
b
) {

922 *
uncomp
;

923 
size_t
 
uncomp_size
 = 0;

925 i‡(
b
->
uncomp_size
 == 0) {

927 
b
->
mëhod
 = 
RAW
;

931 
b
->
mëhod
) {

932 
RAW
:

935 
GZIP
:

936 
uncomp
 = 
	`zlib_mem_öÊ©e
((*)
b
->
d©a
, b->
comp_size
, &
uncomp_size
);

937 i‡(!
uncomp
)

939 i‡(()
uncomp_size
 !
b
->uncomp_size) {

940 
	`‰ì
(
uncomp
);

943 
	`‰ì
(
b
->
d©a
);

944 
b
->
d©a
 = (*)
uncomp
;

945 
b
->
Æloc
 = 
uncomp_size
;

946 
b
->
mëhod
 = 
RAW
;

949 #ifde‡
HAVE_LIBBZ2


950 
BZIP2
: {

951 
usize
 = 
b
->
uncomp_size
;

952 i‡(!(
uncomp
 = 
	`mÆloc
(
usize
)))

954 i‡(
BZ_OK
 !
	`BZ2_bzBuffToBuffDecom¥ess
(
uncomp
, &
usize
,

955 (*)
b
->
d©a
, b->
comp_size
,

957 
	`‰ì
(
uncomp
);

960 
	`‰ì
(
b
->
d©a
);

961 
b
->
d©a
 = (*)
uncomp
;

962 
b
->
Æloc
 = 
usize
;

963 
b
->
mëhod
 = 
RAW
;

964 
b
->
uncomp_size
 = 
usize
;

968 
BZIP2
:

969 
	`Ârötf
(
°dîr
, "Bzip2 compression isÇot compiled intoÅhis "

974 #ifde‡
HAVE_LIBLZMA


975 
LZMA
:

976 
uncomp
 = 
	`lzma_mem_öÊ©e
((*)
b
->
d©a
, b->
comp_size
, &
uncomp_size
);

977 i‡(!
uncomp
)

979 i‡(()
uncomp_size
 !
b
->uncomp_size)

981 
	`‰ì
(
b
->
d©a
);

982 
b
->
d©a
 = (*)
uncomp
;

983 
b
->
Æloc
 = 
uncomp_size
;

984 
b
->
mëhod
 = 
RAW
;

987 
LZMA
:

988 
	`Ârötf
(
°dîr
, "Lzma compression isÇot compiled intoÅhis "

994 
RANS
: {

995 
usize
 = 
b
->
uncomp_size
, 
usize2
;

996 
uncomp
 = (*)
	`øns_uncom¥ess
(
b
->
d©a
, b->
comp_size
, &
usize2
);

997 i‡(!
uncomp
 || 
usize
 !
usize2
)

999 
	`‰ì
(
b
->
d©a
);

1000 
b
->
d©a
 = (*)
uncomp
;

1001 
b
->
Æloc
 = 
usize2
;

1002 
b
->
mëhod
 = 
RAW
;

1003 
b
->
uncomp_size
 = 
usize2
;

1013 
	}
}

1015 *
	$¸am_com¥ess_by_mëhod
(*
ö
, 
size_t
 
ö_size
,

1016 
size_t
 *
out_size
,

1017 
¸am_block_mëhod
 
mëhod
,

1018 
Àvñ
, 
°øt
) {

1019 
mëhod
) {

1020 
GZIP
:

1021  
	`zlib_mem_deÊ©e
(
ö
, 
ö_size
, 
out_size
, 
Àvñ
, 
°øt
);

1023 
BZIP2
: {

1024 #ifde‡
HAVE_LIBBZ2


1025 
comp_size
 = 
ö_size
*1.01 + 600;

1026 *
comp
 = 
	`mÆloc
(
comp_size
);

1027 i‡(!
comp
)

1028  
NULL
;

1030 i‡(
BZ_OK
 !
	`BZ2_bzBuffToBuffCom¥ess
(
comp
, &
comp_size
,

1031 
ö
, 
ö_size
,

1032 
Àvñ
, 0, 30)) {

1033 
	`‰ì
(
comp
);

1034  
NULL
;

1036 *
out_size
 = 
comp_size
;

1037  
comp
;

1039  
NULL
;

1043 
LZMA
:

1044 #ifde‡
HAVE_LIBLZMA


1045  
	`lzma_mem_deÊ©e
(
ö
, 
ö_size
, 
out_size
, 
Àvñ
);

1047  
NULL
;

1050 
RANS0
: {

1051 
out_size_i
;

1052 *
˝
;

1053 
˝
 = 
	`øns_com¥ess
((*)
ö
, 
ö_size
, &
out_size_i
, 0);

1054 *
out_size
 = 
out_size_i
;

1055  (*)
˝
;

1058 
RANS1
: {

1059 
out_size_i
;

1060 *
˝
;

1062 
˝
 = 
	`øns_com¥ess
((*)
ö
, 
ö_size
, &
out_size_i
, 1);

1063 *
out_size
 = 
out_size_i
;

1064  (*)
˝
;

1067 
RAW
:

1071  
NULL
;

1074  
NULL
;

1075 
	}
}

1088 
	$¸am_com¥ess_block
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
, 
¸am_mërics
 *
mërics
,

1089 
mëhod
, 
Àvñ
) {

1091 *
comp
 = 
NULL
;

1092 
size_t
 
comp_size
 = 0;

1093 
°øt
;

1095 i‡(
b
->
mëhod
 !
RAW
) {

1104 i‡(
mëhod
 == -1) {

1105 
mëhod
 = 1<<
GZIP
;

1106 i‡(
fd
->
u£_bz2
)

1107 
mëhod
 |1<<
BZIP2
;

1108 i‡(
fd
->
u£_lzma
)

1109 
mëhod
 |1<<
LZMA
;

1112 i‡(
Àvñ
 == -1)

1113 
Àvñ
 = 
fd
->level;

1117 i‡(
mëhod
 =
RAW
 || 
Àvñ
 =0 || 
b
->
uncomp_size
 == 0) {

1118 
b
->
mëhod
 = 
RAW
;

1119 
b
->
comp_size
 = b->
uncomp_size
;

1124 i‡(
mërics
) {

1125 
	`±hªad_muãx_lock
(&
fd
->
mërics_lock
);

1126 i‡(
mërics
->
åül
 > 0 || --mërics->
√xt_åül
 <= 0) {

1127 
size_t
 
sz_be°
 = 
INT_MAX
;

1128 
size_t
 
sz_gz_æe
 = 0;

1129 
size_t
 
sz_gz_def
 = 0;

1130 
size_t
 
sz_øns0
 = 0;

1131 
size_t
 
sz_øns1
 = 0;

1132 
size_t
 
sz_bzù2
 = 0;

1133 
size_t
 
sz_lzma
 = 0;

1134 
mëhod_be°
 = 0;

1135 *
c_be°
 = 
NULL
, *
c
 = NULL;

1137 i‡(
mërics
->
ªvi£d_mëhod
)

1138 
mëhod
 = 
mërics
->
ªvi£d_mëhod
;

1140 
mërics
->
ªvi£d_mëhod
 = 
mëhod
;

1142 i‡(
mërics
->
√xt_åül
 <= 0) {

1143 
mërics
->
√xt_åül
 = 
TRIAL_SPAN
;

1144 
mërics
->
åül
 = 
NTRIALS
;

1145 
mërics
->
sz_gz_æe
 /= 2;

1146 
mërics
->
sz_gz_def
 /= 2;

1147 
mërics
->
sz_øns0
 /= 2;

1148 
mërics
->
sz_øns1
 /= 2;

1149 
mërics
->
sz_bzù2
 /= 2;

1150 
mërics
->
sz_lzma
 /= 2;

1153 
	`±hªad_muãx_u∆ock
(&
fd
->
mërics_lock
);

1155 i‡(
mëhod
 & (1<<
GZIP_RLE
)) {

1156 
c
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1157 &
sz_gz_æe
, 
GZIP
, 1, 
Z_RLE
);

1158 i‡(
c
 && 
sz_be°
 > 
sz_gz_æe
) {

1159 
sz_be°
 = 
sz_gz_æe
;

1160 
mëhod_be°
 = 
GZIP_RLE
;

1161 i‡(
c_be°
)

1162 
	`‰ì
(
c_be°
);

1163 
c_be°
 = 
c
;

1164 } i‡(
c
) {

1165 
	`‰ì
(
c
);

1167 
sz_gz_æe
 = 
b
->
uncomp_size
*2+1000;

1173 i‡(
mëhod
 & (1<<
GZIP
)) {

1174 
c
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1175 &
sz_gz_def
, 
GZIP
, 
Àvñ
,

1176 
Z_FILTERED
);

1177 i‡(
c
 && 
sz_be°
 > 
sz_gz_def
) {

1178 
sz_be°
 = 
sz_gz_def
;

1179 
mëhod_be°
 = 
GZIP
;

1180 i‡(
c_be°
)

1181 
	`‰ì
(
c_be°
);

1182 
c_be°
 = 
c
;

1183 } i‡(
c
) {

1184 
	`‰ì
(
c
);

1186 
sz_gz_def
 = 
b
->
uncomp_size
*2+1000;

1192 i‡(
mëhod
 & (1<<
RANS0
)) {

1193 
c
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1194 &
sz_øns0
, 
RANS0
, 0, 0);

1195 i‡(
c
 && 
sz_be°
 > 
sz_øns0
) {

1196 
sz_be°
 = 
sz_øns0
;

1197 
mëhod_be°
 = 
RANS0
;

1198 i‡(
c_be°
)

1199 
	`‰ì
(
c_be°
);

1200 
c_be°
 = 
c
;

1201 } i‡(
c
) {

1202 
	`‰ì
(
c
);

1204 
sz_øns0
 = 
b
->
uncomp_size
*2+1000;

1208 i‡(
mëhod
 & (1<<
RANS1
)) {

1209 
c
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1210 &
sz_øns1
, 
RANS1
, 0, 0);

1211 i‡(
c
 && 
sz_be°
 > 
sz_øns1
) {

1212 
sz_be°
 = 
sz_øns1
;

1213 
mëhod_be°
 = 
RANS1
;

1214 i‡(
c_be°
)

1215 
	`‰ì
(
c_be°
);

1216 
c_be°
 = 
c
;

1217 } i‡(
c
) {

1218 
	`‰ì
(
c
);

1220 
sz_øns1
 = 
b
->
uncomp_size
*2+1000;

1224 i‡(
mëhod
 & (1<<
BZIP2
)) {

1225 
c
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1226 &
sz_bzù2
, 
BZIP2
, 
Àvñ
, 0);

1227 i‡(
c
 && 
sz_be°
 > 
sz_bzù2
) {

1228 
sz_be°
 = 
sz_bzù2
;

1229 
mëhod_be°
 = 
BZIP2
;

1230 i‡(
c_be°
)

1231 
	`‰ì
(
c_be°
);

1232 
c_be°
 = 
c
;

1233 } i‡(
c
) {

1234 
	`‰ì
(
c
);

1236 
sz_bzù2
 = 
b
->
uncomp_size
*2+1000;

1240 i‡(
mëhod
 & (1<<
LZMA
)) {

1241 
c
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1242 &
sz_lzma
, 
LZMA
, 
Àvñ
, 0);

1243 i‡(
c
 && 
sz_be°
 > 
sz_lzma
) {

1244 
sz_be°
 = 
sz_lzma
;

1245 
mëhod_be°
 = 
LZMA
;

1246 i‡(
c_be°
)

1247 
	`‰ì
(
c_be°
);

1248 
c_be°
 = 
c
;

1249 } i‡(
c
) {

1250 
	`‰ì
(
c
);

1252 
sz_lzma
 = 
b
->
uncomp_size
*2+1000;

1258 
	`‰ì
(
b
->
d©a
);

1259 
b
->
d©a
 = (*)
c_be°
;

1261 
b
->
mëhod
 = 
mëhod_be°
 =
GZIP_RLE
 ? 
GZIP
 : method_best;

1262 
b
->
comp_size
 = 
sz_be°
;

1264 
	`±hªad_muãx_lock
(&
fd
->
mërics_lock
);

1265 
mërics
->
sz_gz_æe
 += sz_gz_rle;

1266 
mërics
->
sz_gz_def
 += sz_gz_def;

1267 
mërics
->
sz_øns0
 += sz_rans0;

1268 
mërics
->
sz_øns1
 += sz_rans1;

1269 
mërics
->
sz_bzù2
 += sz_bzip2;

1270 
mërics
->
sz_lzma
 += sz_lzma;

1271 i‡(--
mërics
->
åül
 == 0) {

1272 
be°_mëhod
 = 
RAW
;

1273 
be°_sz
 = 
INT_MAX
;

1276 i‡(
fd
->
Àvñ
 <= 3) {

1277 
mërics
->
sz_øns1
 *= 1.02;

1278 
mërics
->
sz_gz_def
 *= 1.04;

1279 
mërics
->
sz_bzù2
 *= 1.08;

1280 
mërics
->
sz_lzma
 *= 1.10;

1281 } i‡(
fd
->
Àvñ
 <= 6) {

1282 
mërics
->
sz_øns1
 *= 1.01;

1283 
mërics
->
sz_gz_def
 *= 1.02;

1284 
mërics
->
sz_bzù2
 *= 1.03;

1285 
mërics
->
sz_lzma
 *= 1.05;

1288 i‡(
mëhod
 & (1<<
GZIP_RLE
Ë&& 
be°_sz
 > 
mërics
->
sz_gz_æe
)

1289 
be°_sz
 = 
mërics
->
sz_gz_æe
, 
be°_mëhod
 = 
GZIP_RLE
;

1291 i‡(
mëhod
 & (1<<
GZIP
Ë&& 
be°_sz
 > 
mërics
->
sz_gz_def
)

1292 
be°_sz
 = 
mërics
->
sz_gz_def
, 
be°_mëhod
 = 
GZIP
;

1294 i‡(
mëhod
 & (1<<
RANS0
Ë&& 
be°_sz
 > 
mërics
->
sz_øns0
)

1295 
be°_sz
 = 
mërics
->
sz_øns0
, 
be°_mëhod
 = 
RANS0
;

1297 i‡(
mëhod
 & (1<<
RANS1
Ë&& 
be°_sz
 > 
mërics
->
sz_øns1
)

1298 
be°_sz
 = 
mërics
->
sz_øns1
, 
be°_mëhod
 = 
RANS1
;

1300 i‡(
mëhod
 & (1<<
BZIP2
Ë&& 
be°_sz
 > 
mërics
->
sz_bzù2
)

1301 
be°_sz
 = 
mërics
->
sz_bzù2
, 
be°_mëhod
 = 
BZIP2
;

1303 i‡(
mëhod
 & (1<<
LZMA
Ë&& 
be°_sz
 > 
mërics
->
sz_lzma
)

1304 
be°_sz
 = 
mërics
->
sz_lzma
, 
be°_mëhod
 = 
LZMA
;

1306 i‡(
be°_mëhod
 =
GZIP_RLE
) {

1307 
mërics
->
mëhod
 = 
GZIP
;

1308 
mërics
->
°øt
 = 
Z_RLE
;

1310 
mërics
->
mëhod
 = 
be°_mëhod
;

1311 
mërics
->
°øt
 = 
Z_FILTERED
;

1318 
	#MAXDELTA
 0.20

	)

1319 
	#MAXFAILS
 4

	)

1320 i‡(
be°_mëhod
 =
GZIP_RLE
) {

1321 
mërics
->
gz_æe_˙t
 = 0;

1322 
mërics
->
gz_æe_exåa
 = 0;

1323 } i‡(
be°_sz
 < 
mërics
->
sz_gz_æe
) {

1324 
r
 = ()
mërics
->
sz_gz_æe
 / 
be°_sz
 - 1;

1325 i‡(++
mërics
->
gz_æe_˙t
 >
MAXFAILS
 &&

1326 (
mërics
->
gz_æe_exåa
 +
r
Ë>
MAXDELTA
)

1327 
mëhod
 &~(1<<
GZIP_RLE
);

1330 i‡(
be°_mëhod
 =
GZIP
) {

1331 
mërics
->
gz_def_˙t
 = 0;

1332 
mërics
->
gz_def_exåa
 = 0;

1333 } i‡(
be°_sz
 < 
mërics
->
sz_gz_def
) {

1334 
r
 = ()
mërics
->
sz_gz_def
 / 
be°_sz
 - 1;

1335 i‡(++
mërics
->
gz_def_˙t
 >
MAXFAILS
 &&

1336 (
mërics
->
gz_def_exåa
 +
r
Ë>
MAXDELTA
)

1337 
mëhod
 &~(1<<
GZIP
);

1340 i‡(
be°_mëhod
 =
RANS0
) {

1341 
mërics
->
øns0_˙t
 = 0;

1342 
mërics
->
øns0_exåa
 = 0;

1343 } i‡(
be°_sz
 < 
mërics
->
sz_øns0
) {

1344 
r
 = ()
mërics
->
sz_øns0
 / 
be°_sz
 - 1;

1345 i‡(++
mërics
->
øns0_˙t
 >
MAXFAILS
 &&

1346 (
mërics
->
øns0_exåa
 +
r
Ë>
MAXDELTA
)

1347 
mëhod
 &~(1<<
RANS0
);

1350 i‡(
be°_mëhod
 =
RANS1
) {

1351 
mërics
->
øns1_˙t
 = 0;

1352 
mërics
->
øns1_exåa
 = 0;

1353 } i‡(
be°_sz
 < 
mërics
->
sz_øns1
) {

1354 
r
 = ()
mërics
->
sz_øns1
 / 
be°_sz
 - 1;

1355 i‡(++
mërics
->
øns1_˙t
 >
MAXFAILS
 &&

1356 (
mërics
->
øns1_exåa
 +
r
Ë>
MAXDELTA
)

1357 
mëhod
 &~(1<<
RANS1
);

1360 i‡(
be°_mëhod
 =
BZIP2
) {

1361 
mërics
->
bzù2_˙t
 = 0;

1362 
mërics
->
bzù2_exåa
 = 0;

1363 } i‡(
be°_sz
 < 
mërics
->
sz_bzù2
) {

1364 
r
 = ()
mërics
->
sz_bzù2
 / 
be°_sz
 - 1;

1365 i‡(++
mërics
->
bzù2_˙t
 >
MAXFAILS
 &&

1366 (
mërics
->
bzù2_exåa
 +
r
Ë>
MAXDELTA
)

1367 
mëhod
 &~(1<<
BZIP2
);

1370 i‡(
be°_mëhod
 =
LZMA
) {

1371 
mërics
->
lzma_˙t
 = 0;

1372 
mërics
->
lzma_exåa
 = 0;

1373 } i‡(
be°_sz
 < 
mërics
->
sz_lzma
) {

1374 
r
 = ()
mërics
->
sz_lzma
 / 
be°_sz
 - 1;

1375 i‡(++
mërics
->
lzma_˙t
 >
MAXFAILS
 &&

1376 (
mërics
->
lzma_exåa
 +
r
Ë>
MAXDELTA
)

1377 
mëhod
 &~(1<<
LZMA
);

1383 
mërics
->
ªvi£d_mëhod
 = 
mëhod
;

1385 
	`±hªad_muãx_u∆ock
(&
fd
->
mërics_lock
);

1387 
°øt
 = 
mërics
->strat;

1388 
mëhod
 = 
mërics
->method;

1390 
	`±hªad_muãx_u∆ock
(&
fd
->
mërics_lock
);

1391 
comp
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1392 &
comp_size
, 
mëhod
,

1393 
Àvñ
, 
°øt
);

1394 i‡(!
comp
)

1396 
	`‰ì
(
b
->
d©a
);

1397 
b
->
d©a
 = (*)
comp
;

1398 
b
->
comp_size
 = comp_size;

1399 
b
->
mëhod
 = method;

1404 
comp
 = 
	`¸am_com¥ess_by_mëhod
((*)
b
->
d©a
, b->
uncomp_size
,

1405 &
comp_size
, 
GZIP
, 
Àvñ
, 
Z_FILTERED
);

1406 i‡(!
comp
) {

1407 
	`Ârötf
(
°dîr
, "Compression failed!\n");

1410 
	`‰ì
(
b
->
d©a
);

1411 
b
->
d©a
 = (*)
comp
;

1412 
b
->
comp_size
 = comp_size;

1413 
b
->
mëhod
 = 
GZIP
;

1416 i‡(
fd
->
vîbo£
)

1417 
	`Ârötf
(
°dîr
, "Compressed block ID %d from %dÅo %d by method %s\n",

1418 
b
->
c⁄ã¡_id
, b->
uncomp_size
, b->
comp_size
,

1419 
	`¸am_block_mëhod2°r
(
b
->
mëhod
));

1421 i‡(
b
->
mëhod
 =
RANS1
)

1422 
b
->
mëhod
 = 
RANS0
;

1425 
	}
}

1427 
¸am_mërics
 *
	$¸am_√w_mërics
() {

1428 
¸am_mërics
 *
m
 = 
	`ˇŒoc
(1, (*m));

1429 i‡(!
m
)

1430  
NULL
;

1431 
m
->
åül
 = 
NTRIALS
-1;

1432 
m
->
√xt_åül
 = 
TRIAL_SPAN
;

1433 
m
->
mëhod
 = 
RAW
;

1434 
m
->
°øt
 = 0;

1435 
m
->
ªvi£d_mëhod
 = 0;

1437  
m
;

1438 
	}
}

1440 *
	$¸am_block_mëhod2°r
(
¸am_block_mëhod
 
m
) {

1441 
m
) {

1442 
RAW
:  "RAW";

1443 
GZIP
:  "GZIP";

1444 
BZIP2
:  "BZIP2";

1445 
LZMA
:  "LZMA";

1446 
RANS0
:  "RANS0";

1447 
RANS1
:  "RANS1";

1448 
GZIP_RLE
:  "GZIP_RLE";

1449 
ERROR
: ;

1452 
	}
}

1454 *
	$¸am_c⁄ã¡_ty≥2°r
(
¸am_c⁄ã¡_ty≥
 
t
) {

1455 
t
) {

1456 
FILE_HEADER
:  "FILE_HEADER";

1457 
COMPRESSION_HEADER
:  "COMPRESSION_HEADER";

1458 
MAPPED_SLICE
:  "MAPPED_SLICE";

1459 
UNMAPPED_SLICE
:  "UNMAPPED_SLICE";

1460 
EXTERNAL
:  "EXTERNAL";

1461 
CORE
:  "CORE";

1462 
CT_ERROR
: ;

1465 
	}
}

1493 
	$ªf_íåy_‰ì_£q
(
ªf_íåy
 *
e
) {

1494 i‡(
e
->
mf
)

1495 
	`mf˛o£
(
e
->
mf
);

1496 i‡(
e
->
£q
 && !e->
mf
)

1497 
	`‰ì
(
e
->
£q
);

1499 
e
->
£q
 = 
NULL
;

1500 
e
->
mf
 = 
NULL
;

1501 
	}
}

1503 
	$ªfs_‰ì
(
ªfs_t
 *
r
) {

1504 
	`RP
("refs_free()\n");

1506 i‡(--
r
->
cou¡
 > 0)

1509 i‡(!
r
)

1512 i‡(
r
->
poﬁ
)

1513 
	`°rög_poﬁ_de°roy
(
r
->
poﬁ
);

1515 i‡(
r
->
h_mëa
) {

1516 
khöt_t
 
k
;

1518 
k
 = 
	`kh_begö
(
r
->
h_mëa
); k !
	`kh_íd
(r->h_meta); k++) {

1519 
ªf_íåy
 *
e
;

1521 i‡(!
	`kh_exi°
(
r
->
h_mëa
, 
k
))

1523 i‡(!(
e
 = 
	`kh_vÆ
(
r
->
h_mëa
, 
k
)))

1525 
	`ªf_íåy_‰ì_£q
(
e
);

1526 
	`‰ì
(
e
);

1529 
	`kh_de°roy
(
ªfs
, 
r
->
h_mëa
);

1532 i‡(
r
->
ªf_id
)

1533 
	`‰ì
(
r
->
ªf_id
);

1535 i‡(
r
->
Â
)

1536 
	`bgzf_˛o£
(
r
->
Â
);

1538 
	`±hªad_muãx_de°roy
(&
r
->
lock
);

1540 
	`‰ì
(
r
);

1541 
	}
}

1543 
ªfs_t
 *
	$ªfs_¸óã
() {

1544 
ªfs_t
 *
r
 = 
	`ˇŒoc
(1, (*r));

1546 
	`RP
("refs_create()\n");

1548 i‡(!
r
)

1549  
NULL
;

1551 i‡(!(
r
->
poﬁ
 = 
	`°rög_poﬁ_¸óã
(8192)))

1552 
îr
;

1554 
r
->
ªf_id
 = 
NULL
;

1555 
r
->
cou¡
 = 1;

1556 
r
->
œ°
 = 
NULL
;

1557 
r
->
œ°_id
 = -1;

1559 i‡(!(
r
->
h_mëa
 = 
	`kh_öô
(
ªfs
)))

1560 
îr
;

1562 
	`±hªad_muãx_öô
(&
r
->
lock
, 
NULL
);

1564  
r
;

1566 
îr
:

1567 
	`ªfs_‰ì
(
r
);

1568  
NULL
;

1569 
	}
}

1579 
BGZF
 *
	$bgzf_›í_ªf
(*
‚
, *
mode
, 
is_md5
) {

1580 
BGZF
 *
Â
;

1582 i‡(!
is_md5
) {

1583 
Ái_fûe
[
PATH_MAX
];

1585 
	`¢¥ötf
(
Ái_fûe
, 
PATH_MAX
, "%s.Ái", 
‚
);

1586 i‡(
	`ac˚ss
(
Ái_fûe
, 
R_OK
) != 0)

1587 i‡(
	`Ái_buûd
(
‚
) != 0)

1588  
NULL
;

1591 i‡(!(
Â
 = 
	`bgzf_›í
(
‚
, 
mode
))) {

1592 
	`≥º‹
(
‚
);

1593  
NULL
;

1596 i‡(
Â
->
is_com¥es£d
 =1 && 
	`bgzf_ödex_lﬂd
(Â, 
‚
, ".gzi") < 0) {

1597 
	`Ârötf
(
°dîr
, "U«bÀÅÿlﬂd .gzòödex '%s.gzi'\n", 
‚
);

1598 
	`bgzf_˛o£
(
Â
);

1599  
NULL
;

1602  
Â
;

1603 
	}
}

1614 
ªfs_t
 *
	$ªfs_lﬂd_Ái
(
ªfs_t
 *
r_‹ig
, *
‚
, 
is_îr
) {

1615 
°©
 
sb
;

1616 
FILE
 *
Â
 = 
NULL
;

1617 
Ái_‚
[
PATH_MAX
];

1618 
löe
[8192];

1619 
ªfs_t
 *
r
 = 
r_‹ig
;

1620 
size_t
 
‚_l
 = 
	`°æí
(
‚
);

1621 
id
 = 0, 
id_Æloc
 = 0;

1623 
	`RP
("ªfs_lﬂd_Áò%s\n", 
‚
);

1625 i‡(!
r
)

1626 i‡(!(
r
 = 
	`ªfs_¸óã
()))

1627 
îr
;

1630 i‡(
	`°©
(
‚
, &
sb
) != 0) {

1631 i‡(
is_îr
)

1632 
	`≥º‹
(
‚
);

1633 
îr
;

1636 i‡(
r
->
Â
)

1637 i‡(
	`bgzf_˛o£
(
r
->
Â
) != 0)

1638 
îr
;

1639 
r
->
Â
 = 
NULL
;

1641 i‡(!(
r
->
‚
 = 
	`°rög_dup
‘->
poﬁ
, fn)))

1642 
îr
;

1644 i‡(
‚_l
 > 4 && 
	`°rcmp
(&
‚
[fn_l-4], ".fai") == 0)

1645 
r
->
‚
[
‚_l
-4] = 0;

1647 i‡(!(
r
->
Â
 = 
	`bgzf_›í_ªf
‘->
‚
, "r", 0)))

1648 
îr
;

1651 
	`•rötf
(
Ái_‚
, "%.*s.Ái", 
PATH_MAX
-5, 
r
->
‚
);

1653 i‡(
	`°©
(
Ái_‚
, &
sb
) != 0) {

1654 i‡(
is_îr
)

1655 
	`≥º‹
(
Ái_‚
);

1656 
îr
;

1658 i‡(!(
Â
 = 
	`f›í
(
Ái_‚
, "r"))) {

1659 i‡(
is_îr
)

1660 
	`≥º‹
(
Ái_‚
);

1661 
îr
;

1663 
	`fgës
(
löe
, 8192, 
Â
Ë!
NULL
) {

1664 
ªf_íåy
 *
e
 = 
	`mÆloc
((*e));

1665 *
˝
;

1666 
n
;

1667 
khöt_t
 
k
;

1669 i‡(!
e
)

1670  
NULL
;

1673 
˝
 = 
löe
; *˝ && !
	`is•a˚_c
(*cp); cp++)

1675 *
˝
++ = 0;

1676 
e
->
«me
 = 
	`°rög_dup
(
r
->
poﬁ
, 
löe
);

1679 *
˝
 && 
	`is•a˚_c
(*cp))

1680 
˝
++;

1681 
e
->
Àngth
 = 
	`°πﬁl
(
˝
, &cp, 10);

1684 *
˝
 && 
	`is•a˚_c
(*cp))

1685 
˝
++;

1686 
e
->
off£t
 = 
	`°πﬁl
(
˝
, &cp, 10);

1689 *
˝
 && 
	`is•a˚_c
(*cp))

1690 
˝
++;

1691 
e
->
ba£s_≥r_löe
 = 
	`°πﬁ
(
˝
, &cp, 10);

1694 *
˝
 && 
	`is•a˚_c
(*cp))

1695 
˝
++;

1696 
e
->
löe_Àngth
 = 
	`°πﬁ
(
˝
, &cp, 10);

1699 
e
->
‚
 = 
r
->fn;

1701 
e
->
cou¡
 = 0;

1702 
e
->
£q
 = 
NULL
;

1703 
e
->
mf
 = 
NULL
;

1704 
e
->
is_md5
 = 0;

1706 
k
 = 
	`kh_put
(
ªfs
, 
r
->
h_mëa
, 
e
->
«me
, &
n
);

1707 i‡(-1 =
n
) {

1708 
	`‰ì
(
e
);

1709  
NULL
;

1712 i‡(
n
) {

1713 
	`kh_vÆ
(
r
->
h_mëa
, 
k
Ë
e
;

1715 
ªf_íåy
 *
ª
 = 
	`kh_vÆ
(
r
->
h_mëa
, 
k
);

1716 i‡(
ª
 && (ª->
cou¡
 !0 ||Ñe->
Àngth
 != 0)) {

1718 
	`‰ì
(
e
);

1721 i‡(
ª
)

1722 
	`‰ì
(
ª
);

1723 
	`kh_vÆ
(
r
->
h_mëa
, 
k
Ë
e
;

1727 i‡(
id
 >
id_Æloc
) {

1728 
x
;

1730 
id_Æloc
 = id_alloc ?id_alloc*2 : 16;

1731 
r
->
ªf_id
 = 
	`ªÆloc
‘->ªf_id, 
id_Æloc
 * (*r->ref_id));

1733 
x
 = 
id
; x < 
id_Æloc
; x++)

1734 
r
->
ªf_id
[
x
] = 
NULL
;

1736 
r
->
ªf_id
[
id
] = 
e
;

1737 
r
->
ƒef
 = ++
id
;

1740 
	`f˛o£
(
Â
);

1741  
r
;

1743 
îr
:

1744 i‡(
Â
)

1745 
	`f˛o£
(
Â
);

1747 i‡(!
r_‹ig
)

1748 
	`ªfs_‰ì
(
r
);

1750  
NULL
;

1751 
	}
}

1756 
	$ßnôi£_SQ_löes
(
¸am_fd
 *
fd
) {

1757 
i
;

1759 i‡(!
fd
->
hódî
)

1762 i‡(!
fd
->
ªfs
 || !fd->ªfs->
h_mëa
)

1765 
i
 = 0; i < 
fd
->
hódî
->
ƒef
; i++) {

1766 *
«me
 = 
fd
->
hódî
->
ªf
[
i
].name;

1767 
khöt_t
 
k
 = 
	`kh_gë
(
ªfs
, 
fd
->ªfs->
h_mëa
, 
«me
);

1768 
ªf_íåy
 *
r
;

1772 i‡(
k
 =
	`kh_íd
(
fd
->
ªfs
->
h_mëa
))

1775 i‡(!(
r
 = (
ªf_íåy
 *)
	`kh_vÆ
(
fd
->
ªfs
->
h_mëa
, 
k
)))

1778 i‡(
r
->
Àngth
 &&Ñ->Àngth !
fd
->
hódî
->
ªf
[
i
].
Àn
) {

1779 
	`as£π
(
	`°rcmp
(
r
->
«me
, 
fd
->
hódî
->
ªf
[
i
].name) == 0);

1783 
	`Ârötf
(
°dîr
, "WARNING: Header @SQÜength mismatch for "

1785 
r
->
«me
, 
fd
->
hódî
->
ªf
[
i
].
Àn
, (Ï->
Àngth
);

1789 
fd
->
hódî
->
ªf
[
i
].
Àn
 = 
r
->
Àngth
;

1792 
	}
}

1801 
	$ªfs2id
(
ªfs_t
 *
r
, 
SAM_hdr
 *
h
) {

1802 
i
;

1804 i‡(
r
->
ªf_id
)

1805 
	`‰ì
(
r
->
ªf_id
);

1806 i‡(
r
->
œ°
)

1807 
r
->
œ°
 = 
NULL
;

1809 
r
->
ªf_id
 = 
	`ˇŒoc
(
h
->
ƒef
, (*r->ref_id));

1810 i‡(!
r
->
ªf_id
)

1813 
r
->
ƒef
 = 
h
->nref;

1814 
i
 = 0; i < 
h
->
ƒef
; i++) {

1815 
khöt_t
 
k
 = 
	`kh_gë
(
ªfs
, 
r
->
h_mëa
, 
h
->
ªf
[
i
].
«me
);

1816 i‡(
k
 !
	`kh_íd
(
r
->
h_mëa
)) {

1817 
r
->
ªf_id
[
i
] = 
	`kh_vÆ
‘->
h_mëa
, 
k
);

1819 
	`Ârötf
(
°dîr
, "UnableÅo findÑefÇame '%s'\n",

1820 
h
->
ªf
[
i
].
«me
);

1825 
	}
}

1832 
	$ªfs_‰om_hódî
(
ªfs_t
 *
r
, 
¸am_fd
 *
fd
, 
SAM_hdr
 *
h
) {

1833 
i
, 
j
;

1835 i‡(!
r
)

1838 i‡(!
h
 || h->
ƒef
 == 0)

1844 i‡(!(
r
->
ªf_id
 = 
	`ªÆloc
‘->ªf_id, (r->
ƒef
 + 
h
->nref) * (*r->ref_id))))

1848 
i
 = 0, 
j
 = 
r
->
ƒef
; i < 
h
->nref; i++) {

1849 
SAM_hdr_ty≥
 *
ty
;

1850 
SAM_hdr_èg
 *
èg
;

1851 
khöt_t
 
k
;

1852 
n
;

1854 
k
 = 
	`kh_gë
(
ªfs
, 
r
->
h_mëa
, 
h
->
ªf
[
i
].
«me
);

1855 i‡(
k
 !
	`kh_íd
(
r
->
h_mëa
))

1859 i‡(!(
r
->
ªf_id
[
j
] = 
	`ˇŒoc
(1, (
ªf_íåy
))))

1862 i‡(!
h
->
ªf
[
i
].
«me
)

1865 
r
->
ªf_id
[
j
]->
«me
 = 
	`°rög_dup
‘->
poﬁ
, 
h
->
ªf
[
i
].name);

1866 
r
->
ªf_id
[
j
]->
Àngth
 = 0;

1869 i‡((
ty
 = 
	`ßm_hdr_föd
(
h
, "SQ", "SN", h->
ªf
[
i
].
«me
))) {

1870 i‡((
èg
 = 
	`ßm_hdr_föd_key
(
h
, 
ty
, "M5", 
NULL
))) {

1871 
r
->
ªf_id
[
j
]->
‚
 = 
	`°rög_dup
‘->
poﬁ
, 
èg
->
°r
+3);

1876 
k
 = 
	`kh_put
(
ªfs
, 
r
->
h_mëa
,Ñ->
ªf_id
[
j
]->
«me
, &
n
);

1877 i‡(
n
 <= 0)

1879 
	`kh_vÆ
(
r
->
h_mëa
, 
k
Ër->
ªf_id
[
j
];

1881 
j
++;

1883 
r
->
ƒef
 = 
j
;

1886 
	}
}

1895 
	$¸am_£t_hódî
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
) {

1896 i‡(
fd
->
hódî
)

1897 
	`ßm_hdr_‰ì
(
fd
->
hódî
);

1898 
fd
->
hódî
 = 
hdr
;

1899  
	`ªfs_‰om_hódî
(
fd
->
ªfs
, fd, 
hdr
);

1900 
	}
}

1907 
	$ex∑nd_ˇche_∑th
(*
∑th
, *
dú
, *
‚
) {

1908 *
˝
;

1910 (
˝
 = 
	`°rchr
(
dú
, '%'))) {

1911 
	`°∫˝y
(
∑th
, 
dú
, 
˝
-dir);

1912 
∑th
 +
˝
-
dú
;

1914 i‡(*++
˝
 == 's') {

1915 
	`°r˝y
(
∑th
, 
‚
);

1916 
∑th
 +
	`°æí
(
‚
);

1917 
‚
 +
	`°æí
(fn);

1918 
˝
++;

1919 } i‡(*
˝
 >= '0' && *cp <= '9') {

1920 *
ídp
;

1921 
l
;

1923 
l
 = 
	`°πﬁ
(
˝
, &
ídp
, 10);

1924 
l
 = 
	`MIN
÷, 
	`°æí
(
‚
));

1925 i‡(*
ídp
 == 's') {

1926 
	`°∫˝y
(
∑th
, 
‚
, 
l
);

1927 
∑th
 +
l
;

1928 
‚
 +
l
;

1929 *
∑th
 = 0;

1930 
˝
 = 
ídp
+1;

1932 *
∑th
++ = '%';

1933 *
∑th
++ = *
˝
++;

1936 *
∑th
++ = '%';

1937 *
∑th
++ = *
˝
++;

1939 
dú
 = 
˝
;

1941 
	`°r˝y
(
∑th
, 
dú
);

1942 
∑th
 +
	`°æí
(
dú
);

1943 i‡(*
‚
 && 
∑th
[-1] != '/')

1944 *
∑th
++ = '/';

1945 
	`°r˝y
(
∑th
, 
‚
);

1946 
	}
}

1951 
	$mkdú_¥efix
(*
∑th
, 
mode
) {

1952 *
˝
 = 
	`°ºchr
(
∑th
, '/');

1953 i‡(!
˝
)

1956 *
˝
 = 0;

1957 i‡(
	`is_dúe˘‹y
(
∑th
)) {

1958 *
˝
 = '/';

1962 i‡(
	`mkdú
(
∑th
, 
mode
) == 0) {

1963 
	`chmod
(
∑th
, 
mode
);

1964 *
˝
 = '/';

1968 
	`mkdú_¥efix
(
∑th
, 
mode
);

1969 
	`mkdú
(
∑th
, 
mode
);

1970 
	`chmod
(
∑th
, 
mode
);

1971 *
˝
 = '/';

1972 
	}
}

1978 c⁄° *
	$gë_ˇche_ba£dú
(c⁄° **
exåa
) {

1979 *
ba£
;

1981 *
exåa
 = "";

1983 
ba£
 = 
	`gëív
("XDG_CACHE_HOME");

1984 i‡(
ba£
 && *base)  base;

1986 
ba£
 = 
	`gëív
("HOME");

1987 i‡(
ba£
 && *ba£Ë{ *
exåa
 = "/.cache";  base; }

1989 
ba£
 = 
	`gëív
("TMPDIR");

1990 i‡(
ba£
 && *base)  base;

1992 
ba£
 = 
	`gëív
("TEMP");

1993 i‡(
ba£
 && *base)  base;

1996 
	}
}

2001 
	$gë_öt_thªadid
() {

2002 
±hªad_t
 
±
 = 
	`±hªad_£lf
();

2003 *
s
 = (*Ë&
±
;

2004 
size_t
 
i
;

2005 
h
 = 0;

2006 
i
 = 0; i < (
±hªad_t
); i++)

2007 
h
 = (h << 5Ë- h + 
s
[
i
];

2008  
h
;

2009 
	}
}

2018 
	$¸am_p›uœã_ªf
(
¸am_fd
 *
fd
, 
id
, 
ªf_íåy
 *
r
) {

2019 *
ªf_∑th
 = 
	`gëív
("REF_PATH");

2020 
SAM_hdr_ty≥
 *
ty
;

2021 
SAM_hdr_èg
 *
èg
;

2022 
∑th
[
PATH_MAX
], 
∑th_tmp
[PATH_MAX];

2023 
ˇche
[
PATH_MAX
], 
ˇche_roŸ
[PATH_MAX];

2024 *
loˇl_ˇche
 = 
	`gëív
("REF_CACHE");

2025 
mFILE
 *
mf
;

2026 
loˇl_∑th
 = 0;

2028 i‡(
fd
->
vîbo£
)

2029 
	`Ârötf
(
°dîr
, "¸am_p›uœã_ª‡⁄ fd %p, id %d\n", (*)
fd
, 
id
);

2031 
ˇche_roŸ
[0] = '\0';

2033 i‡(!
ªf_∑th
 || *ref_path == '\0') {

2038 
ªf_∑th
 = "http://www.ebi.ac.uk:80/ena/cram/md5/%s";

2039 i‡(!
loˇl_ˇche
 || *local_cache == '\0') {

2040 c⁄° *
exåa
;

2041 c⁄° *
ba£
 = 
	`gë_ˇche_ba£dú
(&
exåa
);

2042 
	`¢¥ötf
(
ˇche_roŸ
, 
PATH_MAX
, "%s%s/hts-ªf", 
ba£
, 
exåa
);

2043 
	`¢¥ötf
(
ˇche
,
PATH_MAX
, "%s%s/hts-ªf/%%2s/%%2s/%%s", 
ba£
, 
exåa
);

2044 
loˇl_ˇche
 = 
ˇche
;

2045 i‡(
fd
->
vîbo£
)

2046 
	`Ârötf
(
°dîr
, "P›uœtögÜoˇ»ˇche: %s\n", 
loˇl_ˇche
);

2050 i‡(!
r
->
«me
)

2053 i‡(!(
ty
 = 
	`ßm_hdr_föd
(
fd
->
hódî
, "SQ", "SN", 
r
->
«me
)))

2056 i‡(!(
èg
 = 
	`ßm_hdr_föd_key
(
fd
->
hódî
, 
ty
, "M5", 
NULL
)))

2057 
no_M5
;

2059 i‡(
fd
->
vîbo£
)

2060 
	`Ârötf
(
°dîr
, "QuîyögÑe‡%s\n", 
èg
->
°r
+3);

2063 i‡(
loˇl_ˇche
 && *local_cache) {

2064 
	`ex∑nd_ˇche_∑th
(
∑th
, 
loˇl_ˇche
, 
èg
->
°r
+3);

2065 
loˇl_∑th
 = 1;

2068 #i‚de‡
HAVE_MMAP


2069 *
∑th2
;

2071 i‡(!
loˇl_∑th
 && (
∑th2
 = 
	`föd_∑th
(
èg
->
°r
+3, 
ªf_∑th
))) {

2072 
	`°∫˝y
(
∑th
, 
∑th2
, 
PATH_MAX
);

2073 
	`‰ì
(
∑th2
);

2074 i‡(
	`is_fûe
(
∑th
))

2075 
loˇl_∑th
 = 1;

2080 i‡(
loˇl_∑th
) {

2081 
°©
 
sb
;

2082 
BGZF
 *
Â
;

2084 i‡(0 =
	`°©
(
∑th
, &
sb
Ë&& (
Â
 = 
	`bgzf_›í
(path, "r"))) {

2085 
r
->
Àngth
 = 
sb
.
°_size
;

2086 
r
->
off£t
 =Ñ->
löe_Àngth
 =Ñ->
ba£s_≥r_löe
 = 0;

2088 
r
->
‚
 = 
	`°rög_dup
(
fd
->
ªfs
->
poﬁ
, 
∑th
);

2090 i‡(
fd
->
ªfs
->
Â
)

2091 i‡(
	`bgzf_˛o£
(
fd
->
ªfs
->
Â
) != 0)

2093 
fd
->
ªfs
->
Â
 = fp;

2094 
fd
->
ªfs
->
‚
 = 
r
->fn;

2095 
r
->
is_md5
 = 1;

2105 i‡((
mf
 = 
	`›í_∑th_mfûe
(
èg
->
°r
+3, 
ªf_∑th
, 
NULL
))) {

2106 
size_t
 
sz
;

2107 
r
->
£q
 = 
	`mf°ól
(
mf
, &
sz
);

2108 i‡(
r
->
£q
) {

2109 
r
->
mf
 = 
NULL
;

2112 
r
->
£q
 = 
mf
->
d©a
;

2113 
r
->
mf
 = mf;

2115 
r
->
Àngth
 = 
sz
;

2116 
r
->
is_md5
 = 1;

2118 
ªfs_t
 *
ªfs
;

2119 *
‚
;

2121 
no_M5
:

2123 i‡(!(
èg
 = 
	`ßm_hdr_föd_key
(
fd
->
hódî
, 
ty
, "UR", 
NULL
)))

2126 
‚
 = (
	`°∫cmp
(
èg
->
°r
+3, "file:", 5) == 0)

2127 ? 
èg
->
°r
+8

2128 : 
èg
->
°r
+3;

2130 i‡(
fd
->
ªfs
->
Â
) {

2131 i‡(
	`bgzf_˛o£
(
fd
->
ªfs
->
Â
) != 0)

2133 
fd
->
ªfs
->
Â
 = 
NULL
;

2135 i‡(!(
ªfs
 = 
	`ªfs_lﬂd_Ái
(
fd
->ªfs, 
‚
, 0)))

2137 
	`ßnôi£_SQ_löes
(
fd
);

2139 
fd
->
ªfs
 =Ñefs;

2140 i‡(
fd
->
ªfs
->
Â
) {

2141 i‡(
	`bgzf_˛o£
(
fd
->
ªfs
->
Â
) != 0)

2143 
fd
->
ªfs
->
Â
 = 
NULL
;

2146 i‡(!
fd
->
ªfs
->
‚
)

2149 i‡(-1 =
	`ªfs2id
(
fd
->
ªfs
, fd->
hódî
))

2151 i‡(!
fd
->
ªfs
->
ªf_id
 || !fd->ªfs->ªf_id[
id
])

2159 i‡(
loˇl_ˇche
 && *local_cache) {

2160 
pid
 = (Ë
	`gëpid
();

2161 
thrid
 = 
	`gë_öt_thªadid
();

2162 
hFILE
 *
Â
;

2164 i‡(*
ˇche_roŸ
 && !
	`is_dúe˘‹y
(ˇche_roŸË&& 
hts_vîbo£
 >= 1)

2165 
	`Ârötf
(
°dîr
,

2168 
ˇche_roŸ
);

2170 
	`ex∑nd_ˇche_∑th
(
∑th
, 
loˇl_ˇche
, 
èg
->
°r
+3);

2171 i‡(
fd
->
vîbo£
)

2172 
	`Ârötf
(
°dîr
, "Wrôög cachêfûê'%s'\n", 
∑th
);

2173 
	`mkdú_¥efix
(
∑th
, 01777);

2177 
t
 = ((Ë
	`time
(
NULL
)Ë^ ((Ë
	`˛ock
());

2178 
thrid
++;

2180 
	`•rötf
(
∑th_tmp
, "%s.tmp_%d_%u_%u", 
∑th
, 
pid
, 
thrid
, 
t
);

2181 
Â
 = 
	`h›í
(
∑th_tmp
, "wx");

2182 } 
Â
 =
NULL
 && 
î∫o
 =
EEXIST
);

2183 i‡(!
Â
) {

2184 
	`≥º‹
(
∑th_tmp
);

2191 
hts_md5_c⁄ãxt
 *
md5
;

2192 
md5_buf1
[16];

2193 
md5_buf2
[33];

2195 i‡(!(
md5
 = 
	`hts_md5_öô
())) {

2196 
	`h˛o£_abru±ly
(
Â
);

2197 
	`u∆ök
(
∑th_tmp
);

2200 
	`hts_md5_upd©e
(
md5
, 
r
->
£q
,Ñ->
Àngth
);

2201 
	`hts_md5_föÆ
(
md5_buf1
, 
md5
);

2202 
	`hts_md5_de°roy
(
md5
);

2203 
	`hts_md5_hex
(
md5_buf2
, 
md5_buf1
);

2205 i‡(
	`°∫cmp
(
èg
->
°r
+3, 
md5_buf2
, 32) != 0) {

2206 
	`Ârötf
(
°dîr
, "[E::%s] mism©chög md5sum f‹ dow∆ﬂdedÑe„ªn˚.\n", 
__func__
);

2207 
	`h˛o£_abru±ly
(
Â
);

2208 
	`u∆ök
(
∑th_tmp
);

2212 i‡(
	`hwrôe
(
Â
, 
r
->
£q
,Ñ->
Àngth
) !=Ñ->length) {

2213 
	`≥º‹
(
∑th
);

2215 i‡(
	`h˛o£
(
Â
) < 0) {

2216 
	`u∆ök
(
∑th_tmp
);

2218 i‡(0 =
	`chmod
(
∑th_tmp
, 0444))

2219 
	`ª«me
(
∑th_tmp
, 
∑th
);

2221 
	`u∆ök
(
∑th_tmp
);

2226 
	}
}

2228 
	$¸am_ªf_ö¸_locked
(
ªfs_t
 *
r
, 
id
) {

2229 
	`RP
("%d INC REF %d, %d %p\n", 
	`gëtid
(), 
id
, ()(id>=0?
r
->
ªf_id
[id]->
cou¡
+1:-999), id>=0?r->ªf_id[id]->
£q
:(*)1);

2231 i‡(
id
 < 0 || !
r
->
ªf_id
[id] || !r->ªf_id[id]->
£q
)

2234 i‡(
r
->
œ°_id
 =
id
)

2235 
r
->
œ°_id
 = -1;

2237 ++
r
->
ªf_id
[
id
]->
cou¡
;

2238 
	}
}

2240 
	$¸am_ªf_ö¸
(
ªfs_t
 *
r
, 
id
) {

2241 
	`±hªad_muãx_lock
(&
r
->
lock
);

2242 
	`¸am_ªf_ö¸_locked
(
r
, 
id
);

2243 
	`±hªad_muãx_u∆ock
(&
r
->
lock
);

2244 
	}
}

2246 
	$¸am_ªf_de¸_locked
(
ªfs_t
 *
r
, 
id
) {

2247 
	`RP
("%d DEC REF %d, %d %p\n", 
	`gëtid
(), 
id
, ()(id>=0?
r
->
ªf_id
[id]->
cou¡
-1:-999), id>=0?r->ªf_id[id]->
£q
:(*)1);

2249 i‡(
id
 < 0 || !
r
->
ªf_id
[id] || !r->ªf_id[id]->
£q
) {

2250 
	`as£π
(
r
->
ªf_id
[
id
]->
cou¡
 >= 0);

2254 i‡(--
r
->
ªf_id
[
id
]->
cou¡
 <= 0) {

2255 
	`as£π
(
r
->
ªf_id
[
id
]->
cou¡
 == 0);

2256 i‡(
r
->
œ°_id
 >= 0) {

2257 i‡(
r
->
ªf_id
[r->
œ°_id
]->
cou¡
 <= 0 &&

2258 
r
->
ªf_id
[r->
œ°_id
]->
£q
) {

2259 
	`RP
("%d FREE REF %d (%p)\n", 
	`gëtid
(),

2260 
r
->
œ°_id
,Ñ->
ªf_id
[r->œ°_id]->
£q
);

2261 
	`ªf_íåy_‰ì_£q
(
r
->
ªf_id
[r->
œ°_id
]);

2262 
r
->
ªf_id
[r->
œ°_id
]->
Àngth
 = 0;

2265 
r
->
œ°_id
 = 
id
;

2267 
	}
}

2269 
	$¸am_ªf_de¸
(
ªfs_t
 *
r
, 
id
) {

2270 
	`±hªad_muãx_lock
(&
r
->
lock
);

2271 
	`¸am_ªf_de¸_locked
(
r
, 
id
);

2272 
	`±hªad_muãx_u∆ock
(&
r
->
lock
);

2273 
	}
}

2284 *
	$lﬂd_ªf_p‹ti⁄
(
BGZF
 *
Â
, 
ªf_íåy
 *
e
, 
°¨t
, 
íd
) {

2285 
off_t
 
off£t
, 
Àn
;

2286 *
£q
;

2288 i‡(
íd
 < 
°¨t
)

2289 
íd
 = 
°¨t
;

2295 
off£t
 = 
e
->
löe_Àngth


2296 ? 
e
->
off£t
 + (
°¨t
-1)/e->
ba£s_≥r_löe
 *É->
löe_Àngth
 +

2297 (
°¨t
-1Ë% 
e
->
ba£s_≥r_löe


2298 : 
°¨t
-1;

2300 
Àn
 = (
e
->
löe_Àngth


2301 ? 
e
->
off£t
 + (
íd
-1)/e->
ba£s_≥r_löe
 *É->
löe_Àngth
 +

2302 (
íd
-1Ë% 
e
->
ba£s_≥r_löe


2303 : 
íd
-1Ë- 
off£t
 + 1;

2305 i‡(
	`bgzf_u£ek
(
Â
, 
off£t
, 
SEEK_SET
) < 0) {

2306 
	`≥º‹
("bgzf_useek() onÑeference file");

2307  
NULL
;

2310 i‡(
Àn
 =0 || !(
£q
 = 
	`mÆloc
(len))) {

2311  
NULL
;

2314 i‡(
Àn
 !
	`bgzf_ªad
(
Â
, 
£q
,Üen)) {

2315 
	`≥º‹
("bgzf_read() onÑeference file");

2316 
	`‰ì
(
£q
);

2317  
NULL
;

2321 i‡(
Àn
 !
íd
-
°¨t
+1) {

2322 
i
, 
j
;

2323 *
˝
 = 
£q
;

2324 *
˝_to
;

2326 
i
 = 
j
 = 0; i < 
Àn
; i++) {

2327 i‡(
˝
[
i
] >= '!' && cp[i] <= '~')

2328 
˝
[
j
++] = 
	`touµî_c
(˝[
i
]);

2330 
˝_to
 = 
˝
+
j
;

2332 i‡(
˝_to
 - 
£q
 !
íd
-
°¨t
+1) {

2333 
	`Ârötf
(
°dîr
, "MalformedÑeference file?\n");

2334 
	`‰ì
(
£q
);

2335  
NULL
;

2338 
i
;

2339 
i
 = 0; i < 
Àn
; i++) {

2340 
£q
[
i
] = 
	`touµî_c
(seq[i]);

2344  
£q
;

2345 
	}
}

2354 
ªf_íåy
 *
	$¸am_ªf_lﬂd
(
ªfs_t
 *
r
, 
id
, 
is_md5
) {

2355 
ªf_íåy
 *
e
 = 
r
->
ªf_id
[
id
];

2356 
°¨t
 = 1, 
íd
 = 
e
->
Àngth
;

2357 *
£q
;

2359 i‡(
e
->
£q
) {

2360  
e
;

2363 
	`as£π
(
e
->
cou¡
 == 0);

2365 i‡(
r
->
œ°
) {

2366 #ifde‡
REF_DEBUG


2367 
idx
 = 0;

2368 
idx
 = 0; idx < 
r
->
ƒef
; idx++)

2369 i‡(
r
->
œ°
 =r->
ªf_id
[
idx
])

2371 
	`RP
("%d cøm_ªf_lﬂd DECR %d\n", 
	`gëtid
(), 
idx
);

2373 
	`as£π
(
r
->
œ°
->
cou¡
 > 0);

2374 i‡(--
r
->
œ°
->
cou¡
 <= 0) {

2375 
	`RP
("%d FREE REF %d (%p)\n", 
	`gëtid
(), 
id
, 
r
->
ªf_id
[id]->
£q
);

2376 i‡(
r
->
œ°
->
£q
)

2377 
	`ªf_íåy_‰ì_£q
(
r
->
œ°
);

2382 i‡(
	`°rcmp
(
r
->
‚
, 
e
->‚Ë||Ñ->
Â
 =
NULL
) {

2383 i‡(
r
->
Â
)

2384 i‡(
	`bgzf_˛o£
(
r
->
Â
) != 0)

2385  
NULL
;

2386 
r
->
‚
 = 
e
->fn;

2387 i‡(!(
r
->
Â
 = 
	`bgzf_›í_ªf
‘->
‚
, "r", 
is_md5
)))

2388  
NULL
;

2391 
	`RP
("%d LﬂdögÑe‡%d (%d..%d)\n", 
	`gëtid
(), 
id
, 
°¨t
, 
íd
);

2393 i‡(!(
£q
 = 
	`lﬂd_ªf_p‹ti⁄
(
r
->
Â
, 
e
, 
°¨t
, 
íd
))) {

2394  
NULL
;

2397 
	`RP
("%d LﬂdedÑe‡%d (%d..%dË%p\n", 
	`gëtid
(), 
id
, 
°¨t
, 
íd
, 
£q
);

2399 
	`RP
("%d INC REF %d, %d\n", 
	`gëtid
(), 
id
, ()(
e
->
cou¡
+1));

2400 
e
->
£q
 = seq;

2401 
e
->
mf
 = 
NULL
;

2402 
e
->
cou¡
++;

2408 
	`RP
("%d cøm_ªf_lﬂd INCR %d => %d\n", 
	`gëtid
(), 
id
, 
e
->
cou¡
+1);

2409 
r
->
œ°
 = 
e
;

2410 
e
->
cou¡
++;

2412  
e
;

2413 
	}
}

2437 *
	$¸am_gë_ªf
(
¸am_fd
 *
fd
, 
id
, 
°¨t
, 
íd
) {

2438 
ªf_íåy
 *
r
;

2439 *
£q
;

2440 
o°¨t
 = 
°¨t
;

2442 i‡(
id
 == -1)

2443  
NULL
;

2451 
	`±hªad_muãx_lock
(&
fd
->
ªf_lock
);

2453 
	`RP
("%d cøm_gë_ª‡⁄ fd %p, id %d,Ñ™gê%d..%d\n", 
	`gëtid
(), 
fd
, 
id
, 
°¨t
, 
íd
);

2460 i‡(
fd
->
uns‹ãd
)

2461 
fd
->
sh¨ed_ªf
 = 1;

2465 i‡(
id
 >
fd
->
ªfs
->
ƒef
) {

2466 
	`Ârötf
(
°dîr
, "Nÿª„ªn˚ found f‹ id %d\n", 
id
);

2467 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2468  
NULL
;

2471 i‡(!
fd
->
ªfs
 || !fd->ªfs->
ªf_id
[
id
]) {

2472 
	`Ârötf
(
°dîr
, "Nÿª„ªn˚ found f‹ id %d\n", 
id
);

2473 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2474  
NULL
;

2477 i‡(!(
r
 = 
fd
->
ªfs
->
ªf_id
[
id
])) {

2478 
	`Ârötf
(
°dîr
, "Nÿª„ªn˚ found f‹ id %d\n", 
id
);

2479 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2480  
NULL
;

2495 
	`±hªad_muãx_lock
(&
fd
->
ªfs
->
lock
);

2496 i‡(
r
->
Àngth
 == 0) {

2497 i‡(
	`¸am_p›uœã_ªf
(
fd
, 
id
, 
r
) == -1) {

2498 
	`Ârötf
(
°dîr
, "FaûedÅÿp›uœãÑe„ªn˚ f‹ id %d\n", 
id
);

2499 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2500 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2501  
NULL
;

2503 
r
 = 
fd
->
ªfs
->
ªf_id
[
id
];

2504 i‡(
fd
->
uns‹ãd
)

2505 
	`¸am_ªf_ö¸_locked
(
fd
->
ªfs
, 
id
);

2514 i‡(
íd
 < 1)

2515 
íd
 = 
r
->
Àngth
;

2516 i‡(
íd
 >
r
->
Àngth
)

2517 
íd
 = 
r
->
Àngth
;

2518 i‡(
°¨t
 < 1)

2519  
NULL
;

2521 i‡(
íd
 - 
°¨t
 >0.5*
r
->
Àngth
 || 
fd
->
sh¨ed_ªf
) {

2522 
°¨t
 = 1;

2523 
íd
 = 
r
->
Àngth
;

2534 i‡(
fd
->
sh¨ed_ªf
 || 
r
->
£q
 || (
°¨t
 =1 && 
íd
 =r->
Àngth
)) {

2535 *
˝
;

2537 i‡(
id
 >= 0) {

2538 i‡(
r
->
£q
) {

2539 
	`¸am_ªf_ö¸_locked
(
fd
->
ªfs
, 
id
);

2541 
ªf_íåy
 *
e
;

2542 i‡(!(
e
 = 
	`¸am_ªf_lﬂd
(
fd
->
ªfs
, 
id
, 
r
->
is_md5
))) {

2543 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2544 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2545  
NULL
;

2551 i‡(
fd
->
uns‹ãd
)

2552 
	`¸am_ªf_ö¸_locked
(
fd
->
ªfs
, 
id
);

2555 
fd
->
ªf
 = 
NULL
;

2556 
fd
->
ªf_°¨t
 = 1;

2557 
fd
->
ªf_íd
 = 
r
->
Àngth
;

2558 
fd
->
ªf_id
 = 
id
;

2560 
˝
 = 
fd
->
ªfs
->
ªf_id
[
id
]->
£q
 + 
o°¨t
-1;

2562 
fd
->
ªf
 = 
NULL
;

2563 
˝
 = 
NULL
;

2566 
	`RP
("%d cøm_gë_ª‡ªtu∫ög f‹ id %d, cou¡ %d\n", 
	`gëtid
(), 
id
, ()
r
->
cou¡
);

2568 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2569 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2570  
˝
;

2582 i‡(
id
 < 0) {

2583 i‡(
fd
->
ªf_‰ì
) {

2584 
	`‰ì
(
fd
->
ªf_‰ì
);

2585 
fd
->
ªf_‰ì
 = 
NULL
;

2587 
fd
->
ªf
 = 
NULL
;

2588 
fd
->
ªf_id
 = 
id
;

2589 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2590 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2591  
NULL
;

2595 i‡(
	`°rcmp
(
fd
->
ªfs
->
‚
, 
r
->‚Ë|| fd->ªfs->
Â
 =
NULL
) {

2596 i‡(
fd
->
ªfs
->
Â
)

2597 i‡(
	`bgzf_˛o£
(
fd
->
ªfs
->
Â
) != 0)

2598  
NULL
;

2599 
fd
->
ªfs
->
‚
 = 
r
->fn;

2600 i‡(!(
fd
->
ªfs
->
Â
 = 
	`bgzf_›í_ªf
(fd->ªfs->
‚
, "r", 
r
->
is_md5
))) {

2601 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2602 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2603  
NULL
;

2607 i‡(!(
fd
->
ªf
 = 
	`lﬂd_ªf_p‹ti⁄
(fd->
ªfs
->
Â
, 
r
, 
°¨t
, 
íd
))) {

2608 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2609 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2610  
NULL
;

2613 i‡(
fd
->
ªf_‰ì
)

2614 
	`‰ì
(
fd
->
ªf_‰ì
);

2616 
fd
->
ªf_id
 = 
id
;

2617 
fd
->
ªf_°¨t
 = 
°¨t
;

2618 
fd
->
ªf_íd
 = 
íd
;

2619 
fd
->
ªf_‰ì
 = fd->
ªf
;

2620 
£q
 = 
fd
->
ªf
;

2622 
	`±hªad_muãx_u∆ock
(&
fd
->
ªfs
->
lock
);

2623 
	`±hªad_muãx_u∆ock
(&
fd
->
ªf_lock
);

2625  
£q
 + 
o°¨t
 - 
°¨t
;

2626 
	}
}

2633 
	$¸am_lﬂd_ª„ªn˚
(
¸am_fd
 *
fd
, *
‚
) {

2634 
ªt
 = 0;

2636 i‡(
‚
) {

2637 
fd
->
ªfs
 = 
	`ªfs_lﬂd_Ái
(fd->ªfs, 
‚
,

2638 !(
fd
->
embed_ªf
 && fd->
mode
 == 'r'));

2639 
‚
 = 
fd
->
ªfs
 ? fd->ªfs->‚ : 
NULL
;

2640 i‡(!
‚
)

2641 
ªt
 = -1;

2642 
	`ßnôi£_SQ_löes
(
fd
);

2644 
fd
->
ªf_‚
 = 
‚
;

2646 i‡((!
fd
->
ªfs
 || (fd->ªfs->
ƒef
 =0 && !
‚
)Ë&& fd->
hódî
) {

2647 i‡(
fd
->
ªfs
)

2648 
	`ªfs_‰ì
(
fd
->
ªfs
);

2649 i‡(!(
fd
->
ªfs
 = 
	`ªfs_¸óã
()))

2651 i‡(-1 =
	`ªfs_‰om_hódî
(
fd
->
ªfs
, fd, fd->
hódî
))

2655 i‡(
fd
->
hódî
)

2656 i‡(-1 =
	`ªfs2id
(
fd
->
ªfs
, fd->
hódî
))

2659  
ªt
;

2660 
	}
}

2673 
¸am_c⁄èöî
 *
	$¸am_√w_c⁄èöî
(
ƒec
, 
n¶i˚
) {

2674 
¸am_c⁄èöî
 *
c
 = 
	`ˇŒoc
(1, (*c));

2675 
¸am_DS_ID
 
id
;

2677 i‡(!
c
)

2678  
NULL
;

2680 
c
->
cuº_ªf
 = -2;

2682 
c
->
max_c_ªc
 = 
ƒec
 * 
n¶i˚
;

2683 
c
->
cuº_c_ªc
 = 0;

2685 
c
->
max_ªc
 = 
ƒec
;

2686 
c
->
ªc‹d_cou¡î
 = 0;

2687 
c
->
num_ba£s
 = 0;

2688 
c
->
s_num_ba£s
 = 0;

2690 
c
->
max_¶i˚
 = 
n¶i˚
;

2691 
c
->
cuº_¶i˚
 = 0;

2693 
c
->
pos_s‹ãd
 = 1;

2694 
c
->
max_≠os
 = 0;

2695 
c
->
mu…i_£q
 = 0;

2697 
c
->
bams
 = 
NULL
;

2699 i‡(!(
c
->
¶i˚s
 = (
¸am_¶i˚
 **)
	`ˇŒoc
(
n¶i˚
, (cram_slice *))))

2700 
îr
;

2701 
c
->
¶i˚
 = 
NULL
;

2703 i‡(!(
c
->
comp_hdr
 = 
	`¸am_√w_com¥essi⁄_hódî
()))

2704 
îr
;

2705 
c
->
comp_hdr_block
 = 
NULL
;

2707 
id
 = 
DS_RN
; id < 
DS_TN
; id++)

2708 i‡(!(
c
->
°©s
[
id
] = 
	`¸am_°©s_¸óã
())Ë
îr
;

2712 i‡(!(
c
->
ègs_u£d
 = 
	`kh_öô
(
m_ègm≠
)))

2713 
îr
;

2714 
c
->
ªfs_u£d
 = 0;

2716  
c
;

2718 
îr
:

2719 i‡(
c
) {

2720 i‡(
c
->
¶i˚s
)

2721 
	`‰ì
(
c
->
¶i˚s
);

2722 
	`‰ì
(
c
);

2724  
NULL
;

2725 
	}
}

2727 
	$¸am_‰ì_c⁄èöî
(
¸am_c⁄èöî
 *
c
) {

2728 
¸am_DS_ID
 
id
;

2729 
i
;

2731 i‡(!
c
)

2734 i‡(
c
->
ªfs_u£d
)

2735 
	`‰ì
(
c
->
ªfs_u£d
);

2737 i‡(
c
->
œndm¨k
)

2738 
	`‰ì
(
c
->
œndm¨k
);

2740 i‡(
c
->
comp_hdr
)

2741 
	`¸am_‰ì_com¥essi⁄_hódî
(
c
->
comp_hdr
);

2743 i‡(
c
->
comp_hdr_block
)

2744 
	`¸am_‰ì_block
(
c
->
comp_hdr_block
);

2746 i‡(
c
->
¶i˚s
) {

2747 
i
 = 0; i < 
c
->
max_¶i˚
; i++)

2748 i‡(
c
->
¶i˚s
[
i
])

2749 
	`¸am_‰ì_¶i˚
(
c
->
¶i˚s
[
i
]);

2750 
	`‰ì
(
c
->
¶i˚s
);

2753 
id
 = 
DS_RN
; id < 
DS_TN
; id++)

2754 i‡(
c
->
°©s
[
id
]Ë
	`¸am_°©s_‰ì
(c->stats[id]);

2758 i‡(
c
->
ègs_u£d
) {

2759 
khöt_t
 
k
;

2761 
k
 = 
	`kh_begö
(
c
->
ègs_u£d
); k !
	`kh_íd
(c->tags_used); k++) {

2762 i‡(!
	`kh_exi°
(
c
->
ègs_u£d
, 
k
))

2765 
¸am_èg_m≠
 *
tm
 = (¸am_èg_m≠ *)
	`kh_vÆ
(
c
->
ègs_u£d
, 
k
);

2766 
¸am_codec
 *
c
 = 
tm
->
codec
;

2768 i‡(
c
Ëc->
	`‰ì
(c);

2769 
	`‰ì
(
tm
);

2772 
	`kh_de°roy
(
m_ègm≠
, 
c
->
ègs_u£d
);

2775 
	`‰ì
(
c
);

2776 
	}
}

2784 
¸am_c⁄èöî
 *
	$¸am_ªad_c⁄èöî
(
¸am_fd
 *
fd
) {

2785 
¸am_c⁄èöî
 
c2
, *
c
;

2786 
i
, 
s
;

2787 
size_t
 
rd
 = 0;

2788 
uöt32_t
 
¸c
 = 0;

2790 
fd
->
îr
 = 0;

2791 
fd
->
eof
 = 0;

2793 
	`mem£t
(&
c2
, 0, (c2));

2794 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2795 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
Àngth
, &
¸c
)) == -1) {

2796 
fd
->
eof
 = fd->
em±y_c⁄èöî
 ? 1 : 2;

2797  
NULL
;

2799 
rd
+=
s
;

2802 
uöt32_t
 
Àn
;

2803 i‡((
s
 = 
	`öt32_decode
(
fd
, &
c2
.
Àngth
)) == -1) {

2804 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 2 &&

2805 
	`CRAM_MINOR_VERS
(
fd
->
vîsi⁄
) == 0)

2806 
fd
->
eof
 = 1;

2808 
fd
->
eof
 = fd->
em±y_c⁄èöî
 ? 1 : 2;

2809  
NULL
;

2811 
rd
+=
s
;

2813 
Àn
 = 
	`À_öt4
(
c2
.
Àngth
);

2814 
¸c
 = 
	`¸c32
(0L, (*)&
Àn
, 4);

2816 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
ªf_£q_id
, &
¸c
)Ë=-1Ë 
NULL
; 
rd
+=s;

2817 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
ªf_£q_°¨t
, &
¸c
))=-1Ë 
NULL
; 
rd
+=s;

2818 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
ªf_£q_•™
, &
¸c
)Ë=-1Ë 
NULL
; 
rd
+=s;

2819 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
num_ªc‹ds
, &
¸c
)Ë=-1Ë 
NULL
; 
rd
+=s;

2821 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2822 
c2
.
ªc‹d_cou¡î
 = 0;

2823 
c2
.
num_ba£s
 = 0;

2825 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

2826 i‡((
s
 = 
	`…f8_decode_¸c
(
fd
, &
c2
.
ªc‹d_cou¡î
, &
¸c
)) == -1)

2827  
NULL
;

2829 
rd
 +
s
;

2831 
öt32_t
 
i32
;

2832 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
i32
, &
¸c
)) == -1)

2833  
NULL
;

2835 
rd
 +
s
;

2836 
c2
.
ªc‹d_cou¡î
 = 
i32
;

2839 i‡((
s
 = 
	`…f8_decode_¸c
(
fd
, &
c2
.
num_ba£s
, &
¸c
))== -1)

2840  
NULL
;

2842 
rd
 +
s
;

2844 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
num_blocks
, &
¸c
)Ë=-1Ë 
NULL
; 
rd
+=s;

2845 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c2
.
num_œndm¨ks
, &
¸c
))=-1Ë 
NULL
; 
rd
+=s;

2847 i‡(
c2
.
num_œndm¨ks
 < 0 || c2.num_œndm¨k†>
SIZE_MAX
 / (
öt32_t
))

2848  
NULL
;

2850 i‡(!(
c
 = 
	`ˇŒoc
(1, (*c))))

2851  
NULL
;

2853 *
c
 = 
c2
;

2855 i‡(!(
c
->
œndm¨k
 = 
	`mÆloc
(c->
num_œndm¨ks
 * (
öt32_t
))) &&

2856 
c
->
num_œndm¨ks
) {

2857 
fd
->
îr
 = 
î∫o
;

2858 
	`¸am_‰ì_c⁄èöî
(
c
);

2859  
NULL
;

2861 
i
 = 0; i < 
c
->
num_œndm¨ks
; i++) {

2862 i‡((
s
 = 
	`ôf8_decode_¸c
(
fd
, &
c
->
œndm¨k
[
i
], &
¸c
)) == -1) {

2863 
	`¸am_‰ì_c⁄èöî
(
c
);

2864  
NULL
;

2866 
rd
 +
s
;

2870 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

2871 i‡(-1 =
	`öt32_decode
(
fd
, (
öt32_t
 *)&
c
->
¸c32
))

2872  
NULL
;

2874 
rd
+=4;

2876 i‡(
¸c
 !
c
->
¸c32
) {

2877 
	`Ârötf
(
°dîr
, "Container header CRC32 failure\n");

2878 
	`¸am_‰ì_c⁄èöî
(
c
);

2879  
NULL
;

2883 
c
->
off£t
 = 
rd
;

2884 
c
->
¶i˚s
 = 
NULL
;

2885 
c
->
cuº_¶i˚
 = 0;

2886 
c
->
max_¶i˚
 = c->
num_œndm¨ks
;

2887 
c
->
¶i˚_ªc
 = 0;

2888 
c
->
cuº_ªc
 = 0;

2889 
c
->
max_ªc
 = 0;

2891 i‡(
c
->
ªf_£q_id
 == -2) {

2892 
c
->
mu…i_£q
 = 1;

2893 
fd
->
mu…i_£q
 = 1;

2896 
fd
->
em±y_c⁄èöî
 =

2897 (
c
->
num_ªc‹ds
 == 0 &&

2898 
c
->
ªf_£q_id
 == -1 &&

2899 
c
->
ªf_£q_°¨t
 == 0x454f46 ) ? 1 : 0;

2901  
c
;

2902 
	}
}

2906 
	$¸am_c⁄èöî_size
(
¸am_c⁄èöî
 *
c
) {

2907  55 + 5*
c
->
num_œndm¨ks
;

2908 
	}
}

2919 
	$¸am_°‹e_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, *
d©
, *
size
)

2921 *
˝
 = (*)
d©
;

2922 
i
;

2926 i‡(
	`¸am_c⁄èöî_size
(
c
Ë> *
size
)

2929 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2930 
˝
 +
	`ôf8_put
((*)˝, 
c
->
Àngth
);

2932 *(
öt32_t
 *)
˝
 = 
	`À_öt4
(
c
->
Àngth
);

2933 
˝
 += 4;

2935 i‡(
c
->
mu…i_£q
) {

2936 
˝
 +
	`ôf8_put
((*)cp, -2);

2937 
˝
 +
	`ôf8_put
((*)cp, 0);

2938 
˝
 +
	`ôf8_put
((*)cp, 0);

2940 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªf_£q_id
);

2941 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªf_£q_°¨t
);

2942 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªf_£q_•™
);

2944 
˝
 +
	`ôf8_put
((*)˝, 
c
->
num_ªc‹ds
);

2945 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 2) {

2946 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªc‹d_cou¡î
);

2947 
˝
 +
	`…f8_put
((*)˝, 
c
->
num_ba£s
);

2948 } i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

2949 
˝
 +
	`…f8_put
((*)˝, 
c
->
ªc‹d_cou¡î
);

2950 
˝
 +
	`…f8_put
((*)˝, 
c
->
num_ba£s
);

2953 
˝
 +
	`ôf8_put
((*)˝, 
c
->
num_blocks
);

2954 
˝
 +
	`ôf8_put
((*)˝, 
c
->
num_œndm¨ks
);

2955 
i
 = 0; i < 
c
->
num_œndm¨ks
; i++)

2956 
˝
 +
	`ôf8_put
((*)˝, 
c
->
œndm¨k
[
i
]);

2958 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

2959 
c
->
¸c32
 = 
	`¸c32
(0L, (
uc
 *)
d©
, (*)
˝
-dat);

2960 
˝
[0] = 
c
->
¸c32
 & 0xff;

2961 
˝
[1] = (
c
->
¸c32
 >> 8) & 0xff;

2962 
˝
[2] = (
c
->
¸c32
 >> 16) & 0xff;

2963 
˝
[3] = (
c
->
¸c32
 >> 24) & 0xff;

2964 
˝
 += 4;

2967 *
size
 = (*)
˝
-
d©
;

2970 
	}
}

2979 
	$¸am_wrôe_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
) {

2980 
buf_a
[1024], *
buf
 = buf_a;

2981 *
˝
;

2982 
i
;

2984 i‡(55 + 
c
->
num_œndm¨ks
 * 5 >= 1024)

2985 
buf
 = 
	`mÆloc
(55 + 
c
->
num_œndm¨ks
 * 5);

2986 
˝
 = (*)
buf
;

2988 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

2989 
˝
 +
	`ôf8_put
((*)˝, 
c
->
Àngth
);

2991 *(
öt32_t
 *)
˝
 = 
	`À_öt4
(
c
->
Àngth
);

2992 
˝
 += 4;

2994 i‡(
c
->
mu…i_£q
) {

2995 
˝
 +
	`ôf8_put
((*)cp, -2);

2996 
˝
 +
	`ôf8_put
((*)cp, 0);

2997 
˝
 +
	`ôf8_put
((*)cp, 0);

2999 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªf_£q_id
);

3000 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªf_£q_°¨t
);

3001 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªf_£q_•™
);

3003 
˝
 +
	`ôf8_put
((*)˝, 
c
->
num_ªc‹ds
);

3004 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 2) {

3005 
˝
 +
	`ôf8_put
((*)˝, 
c
->
ªc‹d_cou¡î
);

3006 
˝
 +
	`…f8_put
((*)˝, 
c
->
num_ba£s
);

3007 } i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

3008 
˝
 +
	`…f8_put
((*)˝, 
c
->
ªc‹d_cou¡î
);

3009 
˝
 +
	`…f8_put
((*)˝, 
c
->
num_ba£s
);

3012 
˝
 +
	`ôf8_put
((*)˝, 
c
->
num_blocks
);

3013 
˝
 +
	`ôf8_put
((*)˝, 
c
->
num_œndm¨ks
);

3014 
i
 = 0; i < 
c
->
num_œndm¨ks
; i++)

3015 
˝
 +
	`ôf8_put
((*)˝, 
c
->
œndm¨k
[
i
]);

3017 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) {

3018 
c
->
¸c32
 = 
	`¸c32
(0L, (
uc
 *)
buf
, (*)
˝
-buf);

3019 
˝
[0] = 
c
->
¸c32
 & 0xff;

3020 
˝
[1] = (
c
->
¸c32
 >> 8) & 0xff;

3021 
˝
[2] = (
c
->
¸c32
 >> 16) & 0xff;

3022 
˝
[3] = (
c
->
¸c32
 >> 24) & 0xff;

3023 
˝
 += 4;

3026 i‡((*)
˝
-
buf
 !
	`hwrôe
(
fd
->
Â
, buf, (*)cp-buf)) {

3027 i‡(
buf
 !
buf_a
)

3028 
	`‰ì
(
buf
);

3032 i‡(
buf
 !
buf_a
)

3033 
	`‰ì
(
buf
);

3036 
	}
}

3039 
	$¸am_Êush_c⁄èöî2
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
) {

3040 
i
, 
j
;

3042 i‡(
c
->
cuº_¶i˚
 > 0 && !c->
¶i˚s
)

3048 i‡(0 !
	`¸am_wrôe_c⁄èöî
(
fd
, 
c
))

3052 i‡(0 !
	`¸am_wrôe_block
(
fd
, 
c
->
comp_hdr_block
))

3056 
i
 = 0; i < 
c
->
cuº_¶i˚
; i++) {

3057 
¸am_¶i˚
 *
s
 = 
c
->
¶i˚s
[
i
];

3059 i‡(0 !
	`¸am_wrôe_block
(
fd
, 
s
->
hdr_block
))

3062 
j
 = 0; j < 
s
->
hdr
->
num_blocks
; j++) {

3063 i‡(0 !
	`¸am_wrôe_block
(
fd
, 
s
->
block
[
j
]))

3068  
	`hÊush
(
fd
->
Â
) == 0 ? 0 : -1;

3069 
	}
}

3079 
	$¸am_Êush_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
) {

3081 i‡(0 !
	`¸am_ícode_c⁄èöî
(
fd
, 
c
))

3084  
	`¸am_Êush_c⁄èöî2
(
fd
, 
c
);

3085 
	}
}

3088 
¸am_fd
 *
	mfd
;

3089 
¸am_c⁄èöî
 *
	mc
;

3090 } 
	t¸am_job
;

3092 *
	$¸am_Êush_thªad
(*
¨g
) {

3093 
¸am_job
 *
j
 = (¸am_job *)
¨g
;

3096 i‡(0 !
	`¸am_ícode_c⁄èöî
(
j
->
fd
, j->
c
)) {

3097 
	`Ârötf
(
°dîr
, "cram_encode_container failed\n");

3098  
NULL
;

3101  
¨g
;

3102 
	}
}

3104 
	$¸am_Êush_ªsu…
(
¸am_fd
 *
fd
) {

3105 
i
, 
ªt
 = 0;

3106 
hts_çoﬁ_ªsu…
 *
r
;

3108 (
r
 = 
	`hts_çoﬁ_√xt_ªsu…
(
fd
->
rqueue
))) {

3109 
¸am_job
 *
j
 = (¸am_job *)
	`hts_çoﬁ_ªsu…_d©a
(
r
);

3110 
¸am_c⁄èöî
 *
c
;

3112 i‡(!
j
) {

3113 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

3117 
fd
 = 
j
->fd;

3118 
c
 = 
j
->c;

3120 i‡(
fd
->
mode
 == 'w')

3121 i‡(0 !
	`¸am_Êush_c⁄èöî2
(
fd
, 
c
))

3125 
i
 = 0; i < 
c
->
max_¶i˚
; i++) {

3126 i‡(
c
->
¶i˚s
 && c->¶i˚s[
i
]) {

3127 
	`¸am_‰ì_¶i˚
(
c
->
¶i˚s
[
i
]);

3128 
c
->
¶i˚s
[
i
] = 
NULL
;

3132 
c
->
¶i˚
 = 
NULL
;

3133 
c
->
cuº_¶i˚
 = 0;

3135 
	`¸am_‰ì_c⁄èöî
(
c
);

3137 
ªt
 |
	`hÊush
(
fd
->
Â
) == 0 ? 0 : -1;

3139 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 1);

3142  
ªt
;

3143 
	}
}

3145 
	$¸am_Êush_c⁄èöî_mt
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
) {

3146 
¸am_job
 *
j
;

3148 i‡(!
fd
->
poﬁ
)

3149  
	`¸am_Êush_c⁄èöî
(
fd
, 
c
);

3151 i‡(!(
j
 = 
	`mÆloc
((*j))))

3153 
j
->
fd
 = fd;

3154 
j
->
c
 = c;

3160 
î∫o
 = 0;

3161 
	`hts_çoﬁ_di•©ch2
(
fd
->
poﬁ
, fd->
rqueue
, 
¸am_Êush_thªad
, 
j
, 1);

3162 
≥ndög
 = (
î∫o
 =
EAGAIN
);

3163 i‡(
	`¸am_Êush_ªsu…
(
fd
) != 0)

3165 i‡(!
≥ndög
)

3168 
	`u¶ìp
(1000);

3172 
	}
}

3184 
¸am_block_com¥essi⁄_hdr
 *
	$¸am_√w_com¥essi⁄_hódî
() {

3185 
¸am_block_com¥essi⁄_hdr
 *
hdr
 = 
	`ˇŒoc
(1, (*hdr));

3186 i‡(!
hdr
)

3187  
NULL
;

3189 i‡(!(
hdr
->
TD_blk
 = 
	`¸am_√w_block
(
CORE
, 0))) {

3190 
	`‰ì
(
hdr
);

3191  
NULL
;

3194 i‡(!(
hdr
->
TD_hash
 = 
	`kh_öô
(
m_s2i
))) {

3195 
	`¸am_‰ì_block
(
hdr
->
TD_blk
);

3196 
	`‰ì
(
hdr
);

3197  
NULL
;

3200 i‡(!(
hdr
->
TD_keys
 = 
	`°rög_poﬁ_¸óã
(8192))) {

3201 
	`kh_de°roy
(
m_s2i
, 
hdr
->
TD_hash
);

3202 
	`¸am_‰ì_block
(
hdr
->
TD_blk
);

3203 
	`‰ì
(
hdr
);

3204  
NULL
;

3207  
hdr
;

3208 
	}
}

3210 
	$¸am_‰ì_com¥essi⁄_hódî
(
¸am_block_com¥essi⁄_hdr
 *
hdr
) {

3211 
i
;

3213 i‡(
hdr
->
œndm¨k
)

3214 
	`‰ì
(
hdr
->
œndm¨k
);

3216 i‡(
hdr
->
¥e£rv©i⁄_m≠
)

3217 
	`kh_de°roy
(
m≠
, 
hdr
->
¥e£rv©i⁄_m≠
);

3219 
i
 = 0; i < 
CRAM_MAP_HASH
; i++) {

3220 
¸am_m≠
 *
m
, *
m2
;

3221 
m
 = 
hdr
->
ªc_ícodög_m≠
[
i
]; m; m = 
m2
) {

3222 
m2
 = 
m
->
√xt
;

3223 i‡(
m
->
codec
)

3224 
m
->
codec
->
	`‰ì
(m->codec);

3225 
	`‰ì
(
m
);

3229 
i
 = 0; i < 
CRAM_MAP_HASH
; i++) {

3230 
¸am_m≠
 *
m
, *
m2
;

3231 
m
 = 
hdr
->
èg_ícodög_m≠
[
i
]; m; m = 
m2
) {

3232 
m2
 = 
m
->
√xt
;

3233 i‡(
m
->
codec
)

3234 
m
->
codec
->
	`‰ì
(m->codec);

3235 
	`‰ì
(
m
);

3239 
i
 = 0; i < 
DS_END
; i++) {

3240 i‡(
hdr
->
codecs
[
i
])

3241 
hdr
->
codecs
[
i
]->
	`‰ì
(hdr->codecs[i]);

3244 i‡(
hdr
->
TL
)

3245 
	`‰ì
(
hdr
->
TL
);

3246 i‡(
hdr
->
TD_blk
)

3247 
	`¸am_‰ì_block
(
hdr
->
TD_blk
);

3248 i‡(
hdr
->
TD_hash
)

3249 
	`kh_de°roy
(
m_s2i
, 
hdr
->
TD_hash
);

3250 i‡(
hdr
->
TD_keys
)

3251 
	`°rög_poﬁ_de°roy
(
hdr
->
TD_keys
);

3253 
	`‰ì
(
hdr
);

3254 
	}
}

3261 
	$¸am_‰ì_¶i˚_hódî
(
¸am_block_¶i˚_hdr
 *
hdr
) {

3262 i‡(!
hdr
)

3265 i‡(
hdr
->
block_c⁄ã¡_ids
)

3266 
	`‰ì
(
hdr
->
block_c⁄ã¡_ids
);

3268 
	`‰ì
(
hdr
);

3271 
	}
}

3273 
	$¸am_‰ì_¶i˚
(
¸am_¶i˚
 *
s
) {

3274 i‡(!
s
)

3277 i‡(
s
->
hdr_block
)

3278 
	`¸am_‰ì_block
(
s
->
hdr_block
);

3280 i‡(
s
->
block
) {

3281 
i
;

3283 i‡(
s
->
hdr
) {

3284 
i
 = 0; i < 
s
->
hdr
->
num_blocks
; i++) {

3285 
	`¸am_‰ì_block
(
s
->
block
[
i
]);

3288 
	`‰ì
(
s
->
block
);

3291 i‡(
s
->
block_by_id
)

3292 
	`‰ì
(
s
->
block_by_id
);

3294 i‡(
s
->
hdr
)

3295 
	`¸am_‰ì_¶i˚_hódî
(
s
->
hdr
);

3297 i‡(
s
->
£qs_blk
)

3298 
	`¸am_‰ì_block
(
s
->
£qs_blk
);

3300 i‡(
s
->
quÆ_blk
)

3301 
	`¸am_‰ì_block
(
s
->
quÆ_blk
);

3303 i‡(
s
->
«me_blk
)

3304 
	`¸am_‰ì_block
(
s
->
«me_blk
);

3306 i‡(
s
->
aux_blk
)

3307 
	`¸am_‰ì_block
(
s
->
aux_blk
);

3309 i‡(
s
->
ba£_blk
)

3310 
	`¸am_‰ì_block
(
s
->
ba£_blk
);

3312 i‡(
s
->
so·_blk
)

3313 
	`¸am_‰ì_block
(
s
->
so·_blk
);

3315 i‡(
s
->
cig¨
)

3316 
	`‰ì
(
s
->
cig¨
);

3318 i‡(
s
->
¸ecs
)

3319 
	`‰ì
(
s
->
¸ecs
);

3321 i‡(
s
->
„©uªs
)

3322 
	`‰ì
(
s
->
„©uªs
);

3324 i‡(
s
->
TN
)

3325 
	`‰ì
(
s
->
TN
);

3327 i‡(
s
->
∑ú_keys
)

3328 
	`°rög_poﬁ_de°roy
(
s
->
∑ú_keys
);

3330 i‡(
s
->
∑ú
[0])

3331 
	`kh_de°roy
(
m_s2i
, 
s
->
∑ú
[0]);

3332 i‡(
s
->
∑ú
[1])

3333 
	`kh_de°roy
(
m_s2i
, 
s
->
∑ú
[1]);

3335 i‡(
s
->
aux_block
)

3336 
	`‰ì
(
s
->
aux_block
);

3338 
	`‰ì
(
s
);

3339 
	}
}

3348 
¸am_¶i˚
 *
	$¸am_√w_¶i˚
(
¸am_c⁄ã¡_ty≥
 
ty≥
, 
ƒecs
) {

3349 
¸am_¶i˚
 *
s
 = 
	`ˇŒoc
(1, (*s));

3350 i‡(!
s
)

3351  
NULL
;

3353 i‡(!(
s
->
hdr
 = (
¸am_block_¶i˚_hdr
 *)
	`ˇŒoc
(1, (*s->hdr))))

3354 
îr
;

3355 
s
->
hdr
->
c⁄ã¡_ty≥
 = 
ty≥
;

3357 
s
->
hdr_block
 = 
NULL
;

3358 
s
->
block
 = 
NULL
;

3359 
s
->
block_by_id
 = 
NULL
;

3360 
s
->
œ°_≠os
 = 0;

3361 i‡(!(
s
->
¸ecs
 = 
	`mÆloc
(
ƒecs
 * (
¸am_ªc‹d
)))Ë
îr
;

3362 
s
->
cig¨
 = 
NULL
;

3363 
s
->
cig¨_Æloc
 = 0;

3364 
s
->
ncig¨
 = 0;

3366 i‡(!(
s
->
£qs_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 0))Ë
îr
;

3367 i‡(!(
s
->
quÆ_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_QS
))Ë
îr
;

3368 i‡(!(
s
->
«me_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_RN
))Ë
îr
;

3369 i‡(!(
s
->
aux_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_aux
))Ë
îr
;

3370 i‡(!(
s
->
ba£_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_IN
))Ë
îr
;

3371 i‡(!(
s
->
so·_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_SC
))Ë
îr
;

3373 
s
->
„©uªs
 = 
NULL
;

3374 
s
->
n„©uªs
 = s->
a„©uªs
 = 0;

3376 #i‚de‡
TN_exã∫Æ


3377 
s
->
TN
 = 
NULL
;

3378 
s
->
nTN
 = s->
aTN
 = 0;

3382 i‡(!(
s
->
∑ú_keys
 = 
	`°rög_poﬁ_¸óã
(8192))Ë
îr
;

3383 i‡(!(
s
->
∑ú
[0] = 
	`kh_öô
(
m_s2i
))Ë
îr
;

3384 i‡(!(
s
->
∑ú
[1] = 
	`kh_öô
(
m_s2i
))Ë
îr
;

3386 #ifde‡
BA_exã∫Æ


3387 
s
->
BA_Àn
 = 0;

3390  
s
;

3392 
îr
:

3393 i‡(
s
)

3394 
	`¸am_‰ì_¶i˚
(
s
);

3396  
NULL
;

3397 
	}
}

3410 
¸am_¶i˚
 *
	$¸am_ªad_¶i˚
(
¸am_fd
 *
fd
) {

3411 
¸am_block
 *
b
 = 
	`¸am_ªad_block
(
fd
);

3412 
¸am_¶i˚
 *
s
 = 
	`ˇŒoc
(1, (*s));

3413 
i
, 
n
, 
max_id
, 
mö_id
;

3415 i‡(!
b
 || !
s
)

3416 
îr
;

3418 
s
->
hdr_block
 = 
b
;

3419 
b
->
c⁄ã¡_ty≥
) {

3420 
MAPPED_SLICE
:

3421 
UNMAPPED_SLICE
:

3422 i‡(!(
s
->
hdr
 = 
	`¸am_decode_¶i˚_hódî
(
fd
, 
b
)))

3423 
îr
;

3427 
	`Ârötf
(
°dîr
, "Unexpected block ofÅype %s\n",

3428 
	`¸am_c⁄ã¡_ty≥2°r
(
b
->
c⁄ã¡_ty≥
));

3429 
îr
;

3432 i‡(
s
->
hdr
->
num_blocks
 < 1) {

3433 
	`Ârötf
(
°dîr
, "Slice doesÇot includeány data blocks.\n");

3434 
îr
;

3437 
s
->
block
 = 
	`ˇŒoc
(
n
 = s->
hdr
->
num_blocks
, (*s->block));

3438 i‡(!
s
->
block
)

3439 
îr
;

3441 
max_id
 = 
i
 = 0, 
mö_id
 = 
INT_MAX
; i < 
n
; i++) {

3442 i‡(!(
s
->
block
[
i
] = 
	`¸am_ªad_block
(
fd
)))

3443 
îr
;

3445 i‡(
s
->
block
[
i
]->
c⁄ã¡_ty≥
 =
EXTERNAL
) {

3446 i‡(
max_id
 < 
s
->
block
[
i
]->
c⁄ã¡_id
)

3447 
max_id
 = 
s
->
block
[
i
]->
c⁄ã¡_id
;

3448 i‡(
mö_id
 > 
s
->
block
[
i
]->
c⁄ã¡_id
)

3449 
mö_id
 = 
s
->
block
[
i
]->
c⁄ã¡_id
;

3452 i‡(
mö_id
 >0 && 
max_id
 < 1024) {

3453 i‡(!(
s
->
block_by_id
 = 
	`ˇŒoc
(1024, (s->
block
[0]))))

3454 
îr
;

3456 
i
 = 0; i < 
n
; i++) {

3457 i‡(
s
->
block
[
i
]->
c⁄ã¡_ty≥
 !
EXTERNAL
)

3459 
s
->
block_by_id
[s->
block
[
i
]->
c⁄ã¡_id
] = s->block[i];

3464 
s
->
cig¨
 = 
NULL
;

3465 
s
->
cig¨_Æloc
 = 0;

3466 
s
->
ncig¨
 = 0;

3468 i‡(!(
s
->
£qs_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 0))Ë
îr
;

3469 i‡(!(
s
->
quÆ_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_QS
))Ë
îr
;

3470 i‡(!(
s
->
«me_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_RN
))Ë
îr
;

3471 i‡(!(
s
->
aux_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_aux
))Ë
îr
;

3472 i‡(!(
s
->
ba£_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_IN
))Ë
îr
;

3473 i‡(!(
s
->
so·_blk
 = 
	`¸am_√w_block
(
EXTERNAL
, 
DS_SC
))Ë
îr
;

3475 
s
->
¸ecs
 = 
NULL
;

3477 
s
->
œ°_≠os
 = s->
hdr
->
ªf_£q_°¨t
;

3479  
s
;

3481 
îr
:

3482 i‡(
b
)

3483 
	`¸am_‰ì_block
(
b
);

3484 i‡(
s
) {

3485 
s
->
hdr_block
 = 
NULL
;

3486 
	`¸am_‰ì_¶i˚
(
s
);

3488  
NULL
;

3489 
	}
}

3501 
¸am_fûe_def
 *
	$¸am_ªad_fûe_def
(
¸am_fd
 *
fd
) {

3502 
¸am_fûe_def
 *
def
 = 
	`mÆloc
((*def));

3503 i‡(!
def
)

3504  
NULL
;

3506 i‡(26 !
	`hªad
(
fd
->
Â
, &
def
->
magic
[0], 26)) {

3507 
	`‰ì
(
def
);

3508  
NULL
;

3511 i‡(
	`memcmp
(
def
->
magic
, "CRAM", 4) != 0) {

3512 
	`‰ì
(
def
);

3513  
NULL
;

3516 i‡(
def
->
maj‹_vîsi⁄
 > 3) {

3517 
	`Ârötf
(
°dîr
, "CRAM versionÇumber mismatch\n"

3519 
def
->
maj‹_vîsi⁄
, def->
mö‹_vîsi⁄
);

3520 
	`‰ì
(
def
);

3521  
NULL
;

3524 
fd
->
fú°_c⁄èöî
 += 26;

3525 
fd
->
œ°_¶i˚
 = 0;

3527  
def
;

3528 
	}
}

3535 
	$¸am_wrôe_fûe_def
(
¸am_fd
 *
fd
, 
¸am_fûe_def
 *
def
) {

3536  (
	`hwrôe
(
fd
->
Â
, &
def
->
magic
[0], 26) == 26) ? 0 : -1;

3537 
	}
}

3539 
	$¸am_‰ì_fûe_def
(
¸am_fûe_def
 *
def
) {

3540 i‡(
def
Ë
	`‰ì
(def);

3541 
	}
}

3556 
SAM_hdr
 *
	$¸am_ªad_SAM_hdr
(
¸am_fd
 *
fd
) {

3557 
öt32_t
 
hódî_Àn
;

3558 *
hódî
;

3559 
SAM_hdr
 *
hdr
;

3562 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

3564 i‡(-1 =
	`öt32_decode
(
fd
, &
hódî_Àn
))

3565  
NULL
;

3568 i‡(
hódî_Àn
 < 0 || 
NULL
 =(
hódî
 = 
	`mÆloc
((
size_t
) header_len+1)))

3569  
NULL
;

3571 i‡(
hódî_Àn
 !
	`hªad
(
fd
->
Â
, 
hódî
, header_len))

3572  
NULL
;

3573 
hódî
[
hódî_Àn
] = '\0';

3575 
fd
->
fú°_c⁄èöî
 +4 + 
hódî_Àn
;

3577 
¸am_c⁄èöî
 *
c
 = 
	`¸am_ªad_c⁄èöî
(
fd
);

3578 
¸am_block
 *
b
;

3579 
i
, 
Àn
;

3581 i‡(!
c
)

3582  
NULL
;

3584 
fd
->
fú°_c⁄èöî
 +
c
->
Àngth
 + c->
off£t
;

3586 i‡(
c
->
num_blocks
 < 1) {

3587 
	`¸am_‰ì_c⁄èöî
(
c
);

3588  
NULL
;

3591 i‡(!(
b
 = 
	`¸am_ªad_block
(
fd
))) {

3592 
	`¸am_‰ì_c⁄èöî
(
c
);

3593  
NULL
;

3595 i‡(
	`¸am_uncom¥ess_block
(
b
) != 0) {

3596 
	`¸am_‰ì_c⁄èöî
(
c
);

3597 
	`¸am_‰ì_block
(
b
);

3598  
NULL
;

3601 
Àn
 = 
b
->
comp_size
 + 2 + 4*(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) +

3602 
	`ôf8_size
(
b
->
c⁄ã¡_id
) +

3603 
	`ôf8_size
(
b
->
uncomp_size
) +

3604 
	`ôf8_size
(
b
->
comp_size
);

3607 i‡(-1 =
	`öt32_gë_blk
(
b
, &
hódî_Àn
) ||

3608 
hódî_Àn
 < 0 ||

3609 
b
->
uncomp_size
 - 4 < 
hódî_Àn
) {

3610 
	`¸am_‰ì_c⁄èöî
(
c
);

3611 
	`¸am_‰ì_block
(
b
);

3612  
NULL
;

3614 i‡(
NULL
 =(
hódî
 = 
	`mÆloc
((
size_t
Ë
hódî_Àn
+1))) {

3615 
	`¸am_‰ì_c⁄èöî
(
c
);

3616 
	`¸am_‰ì_block
(
b
);

3617  
NULL
;

3619 
	`mem˝y
(
hódî
, 
	`BLOCK_END
(
b
), 
hódî_Àn
);

3620 
hódî
[
hódî_Àn
] = '\0';

3621 
	`¸am_‰ì_block
(
b
);

3624 
i
 = 1; i < 
c
->
num_blocks
; i++) {

3625 i‡(!(
b
 = 
	`¸am_ªad_block
(
fd
))) {

3626 
	`¸am_‰ì_c⁄èöî
(
c
);

3627  
NULL
;

3629 
Àn
 +
b
->
comp_size
 + 2 + 4*(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3) +

3630 
	`ôf8_size
(
b
->
c⁄ã¡_id
) +

3631 
	`ôf8_size
(
b
->
uncomp_size
) +

3632 
	`ôf8_size
(
b
->
comp_size
);

3633 
	`¸am_‰ì_block
(
b
);

3636 i‡(
c
->
Àngth
 > 0 && 
Àn
 > 0 && c->length >Üen) {

3638 *
∑ds
 = 
	`mÆloc
(
c
->
Àngth
 - 
Àn
);

3639 i‡(!
∑ds
) {

3640 
	`¸am_‰ì_c⁄èöî
(
c
);

3641  
NULL
;

3644 i‡(
c
->
Àngth
 - 
Àn
 !
	`hªad
(
fd
->
Â
, 
∑ds
, c->length -Üen)) {

3645 
	`¸am_‰ì_c⁄èöî
(
c
);

3646  
NULL
;

3648 
	`‰ì
(
∑ds
);

3651 
	`¸am_‰ì_c⁄èöî
(
c
);

3655 
hdr
 = 
	`ßm_hdr_∑r£_
(
hódî
, 
hódî_Àn
);

3656 
	`‰ì
(
hódî
);

3658  
hdr
;

3659 
	}
}

3665 
	$fuŒ_∑th
(*
out
, *
ö
) {

3666 i‡(*
ö
 == '/') {

3667 
	`°∫˝y
(
out
, 
ö
, 
PATH_MAX
);

3668 
out
[
PATH_MAX
-1] = 0;

3670 
Àn
;

3673 i‡(!
	`gëcwd
(
out
, 
PATH_MAX
) ||

3674 (
Àn
 = 
	`°æí
(
out
))+1+°æí(
ö
Ë>
PATH_MAX
) {

3675 
	`°∫˝y
(
out
, 
ö
, 
PATH_MAX
);

3676 
out
[
PATH_MAX
-1] = 0;

3680 
	`•rötf
(
out
+
Àn
, "/%.*s", 
PATH_MAX
 -Üí, 
ö
);

3684 
	}
}

3691 
	$¸am_wrôe_SAM_hdr
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
) {

3692 
hódî_Àn
;

3693 
bœnk_block
 = (
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3);

3696 i‡(
fd
->
fûe_def
->
maj‹_vîsi⁄
 == 0) {

3697 
fd
->
fûe_def
->
maj‹_vîsi⁄
 = 
	`CRAM_MAJOR_VERS
(fd->
vîsi⁄
);

3698 
fd
->
fûe_def
->
mö‹_vîsi⁄
 = 
	`CRAM_MINOR_VERS
(fd->
vîsi⁄
);

3699 i‡(0 !
	`¸am_wrôe_fûe_def
(
fd
, fd->
fûe_def
))

3704 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

3705 i‡(!
	`ßm_hdr_föd_rg
(
hdr
, "UNKNOWN"))

3706 i‡(
	`ßm_hdr_add
(
hdr
, "RG",

3707 "ID", "UNKNOWN", "SM", "UNKNOWN", 
NULL
))

3712 i‡(
fd
->
ªfs
 && !fd->
no_ªf
) {

3713 
i
;

3714 
i
 = 0; i < 
hdr
->
ƒef
; i++) {

3715 
SAM_hdr_ty≥
 *
ty
;

3716 *
ªf
;

3718 i‡(!(
ty
 = 
	`ßm_hdr_föd
(
hdr
, "SQ", "SN", hdr->
ªf
[
i
].
«me
)))

3721 i‡(!
	`ßm_hdr_föd_key
(
hdr
, 
ty
, "M5", 
NULL
)) {

3722 
buf
[16];

3723 
buf2
[33];

3724 
æí
;

3725 
hts_md5_c⁄ãxt
 *
md5
;

3727 i‡(!
fd
->
ªfs
 ||

3728 !
fd
->
ªfs
->
ªf_id
 ||

3729 !
fd
->
ªfs
->
ªf_id
[
i
]) {

3732 
æí
 = 
fd
->
ªfs
->
ªf_id
[
i
]->
Àngth
;

3733 i‡(!(
md5
 = 
	`hts_md5_öô
()))

3735 
ªf
 = 
	`¸am_gë_ªf
(
fd
, 
i
, 1, 
æí
);

3736 i‡(
NULL
 =
ªf
)  -1;

3737 
æí
 = 
fd
->
ªfs
->
ªf_id
[
i
]->
Àngth
;

3738 
	`hts_md5_upd©e
(
md5
, 
ªf
, 
æí
);

3739 
	`hts_md5_föÆ
(
buf
, 
md5
);

3740 
	`hts_md5_de°roy
(
md5
);

3741 
	`¸am_ªf_de¸
(
fd
->
ªfs
, 
i
);

3743 
	`hts_md5_hex
(
buf2
, 
buf
);

3744 i‡(
	`ßm_hdr_upd©e
(
hdr
, 
ty
, "M5", 
buf2
, 
NULL
))

3748 i‡(
fd
->
ªf_‚
) {

3749 
ªf_‚
[
PATH_MAX
];

3750 
	`fuŒ_∑th
(
ªf_‚
, 
fd
->ref_fn);

3751 i‡(
	`ßm_hdr_upd©e
(
hdr
, 
ty
, "UR", 
ªf_‚
, 
NULL
))

3757 i‡(
	`ßm_hdr_ªbuûd
(
hdr
))

3761 
hódî_Àn
 = 
	`ßm_hdr_Àngth
(
hdr
);

3762 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

3763 i‡(-1 =
	`öt32_ícode
(
fd
, 
hódî_Àn
))

3767 i‡(
hódî_Àn
 !
	`hwrôe
(
fd
->
Â
, 
	`ßm_hdr_°r
(
hdr
), header_len))

3771 
¸am_block
 *
b
 = 
	`¸am_√w_block
(
FILE_HEADER
, 0);

3772 
¸am_c⁄èöî
 *
c
 = 
	`¸am_√w_c⁄èöî
(0, 0);

3773 
∑dded_Àngth
;

3774 *
∑ds
;

3775 
is_¸am_3
 = (
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3);

3777 i‡(!
b
 || !
c
) {

3778 i‡(
b
Ë
	`¸am_‰ì_block
(b);

3779 i‡(
c
Ë
	`¸am_‰ì_c⁄èöî
(c);

3783 
	`öt32_put_blk
(
b
, 
hódî_Àn
);

3784 i‡(
hódî_Àn
)

3785 
	`BLOCK_APPEND
(
b
, 
	`ßm_hdr_°r
(
hdr
), 
hódî_Àn
);

3786 
	`BLOCK_UPLEN
(
b
);

3789 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3)

3790 
	`¸am_com¥ess_block
(
fd
, 
b
, 
NULL
, -1, -1);

3792 i‡(
bœnk_block
) {

3793 
c
->
Àngth
 = 
b
->
comp_size
 + 2 + 4*
is_¸am_3
 +

3794 
	`ôf8_size
(
b
->
c⁄ã¡_id
) +

3795 
	`ôf8_size
(
b
->
uncomp_size
) +

3796 
	`ôf8_size
(
b
->
comp_size
);

3798 
c
->
num_blocks
 = 2;

3799 
c
->
num_œndm¨ks
 = 2;

3800 i‡(!(
c
->
œndm¨k
 = 
	`mÆloc
(2*(*c->landmark)))) {

3801 
	`¸am_‰ì_block
(
b
);

3802 
	`¸am_‰ì_c⁄èöî
(
c
);

3805 
c
->
œndm¨k
[0] = 0;

3806 
c
->
œndm¨k
[1] = c->
Àngth
;

3809 
∑dded_Àngth
 = 
	`MIN
(
c
->
Àngth
*.5, 10000);

3810 
c
->
Àngth
 +
∑dded_Àngth
 + 2 + 4*
is_¸am_3
 +

3811 
	`ôf8_size
(
b
->
c⁄ã¡_id
) +

3812 
	`ôf8_size
(
∑dded_Àngth
)*2;

3815 
c
->
num_blocks
 = 1;

3816 
c
->
num_œndm¨ks
 = 1;

3817 i‡(!(
c
->
œndm¨k
 = 
	`mÆloc
((*c->landmark))))

3819 
c
->
œndm¨k
[0] = 0;

3821 
∑dded_Àngth
 = 
	`MAX
(
c
->
Àngth
*1.5, 10000) - c->length;

3823 
c
->
Àngth
 = 
b
->
comp_size
 + 
∑dded_Àngth
 +

3824 2 + 4*
is_¸am_3
 +

3825 
	`ôf8_size
(
b
->
c⁄ã¡_id
) +

3826 
	`ôf8_size
(
b
->
uncomp_size
) +

3827 
	`ôf8_size
(
b
->
comp_size
);

3829 i‡(
NULL
 =(
∑ds
 = 
	`ˇŒoc
(1, 
∑dded_Àngth
))) {

3830 
	`¸am_‰ì_block
(
b
);

3831 
	`¸am_‰ì_c⁄èöî
(
c
);

3834 
	`BLOCK_APPEND
(
b
, 
∑ds
, 
∑dded_Àngth
);

3835 
	`BLOCK_UPLEN
(
b
);

3836 
	`‰ì
(
∑ds
);

3839 i‡(-1 =
	`¸am_wrôe_c⁄èöî
(
fd
, 
c
)) {

3840 
	`¸am_‰ì_block
(
b
);

3841 
	`¸am_‰ì_c⁄èöî
(
c
);

3845 i‡(-1 =
	`¸am_wrôe_block
(
fd
, 
b
)) {

3846 
	`¸am_‰ì_block
(
b
);

3847 
	`¸am_‰ì_c⁄èöî
(
c
);

3851 i‡(
bœnk_block
) {

3852 
	`BLOCK_RESIZE
(
b
, 
∑dded_Àngth
);

3853 
	`mem£t
(
	`BLOCK_DATA
(
b
), 0, 
∑dded_Àngth
);

3854 
	`BLOCK_SIZE
(
b
Ë
∑dded_Àngth
;

3855 
	`BLOCK_UPLEN
(
b
);

3856 
b
->
mëhod
 = 
RAW
;

3857 i‡(-1 =
	`¸am_wrôe_block
(
fd
, 
b
)) {

3858 
	`¸am_‰ì_block
(
b
);

3859 
	`¸am_‰ì_c⁄èöî
(
c
);

3864 
	`¸am_‰ì_block
(
b
);

3865 
	`¸am_‰ì_c⁄èöî
(
c
);

3868 i‡(-1 =
	`ªfs_‰om_hódî
(
fd
->
ªfs
, fd, fd->
hódî
))

3870 i‡(-1 =
	`ªfs2id
(
fd
->
ªfs
, fd->
hódî
))

3873 i‡(0 !
	`hÊush
(
fd
->
Â
))

3876 
	`RP
("=== Finishing saving header ===\n");

3879 
	}
}

3890 
	$¸am_öô_èbÀs
(
¸am_fd
 *
fd
) {

3891 
i
;

3893 
	`mem£t
(
fd
->
L1
, 4, 256);

3894 
fd
->
L1
['A'] = 0; fd->L1['a'] = 0;

3895 
fd
->
L1
['C'] = 1; fd->L1['c'] = 1;

3896 
fd
->
L1
['G'] = 2; fd->L1['g'] = 2;

3897 
fd
->
L1
['T'] = 3; fd->L1['t'] = 3;

3899 
	`mem£t
(
fd
->
L2
, 5, 256);

3900 
fd
->
L2
['A'] = 0; fd->L2['a'] = 0;

3901 
fd
->
L2
['C'] = 1; fd->L2['c'] = 1;

3902 
fd
->
L2
['G'] = 2; fd->L2['g'] = 2;

3903 
fd
->
L2
['T'] = 3; fd->L2['t'] = 3;

3904 
fd
->
L2
['N'] = 4; fd->L2['n'] = 4;

3906 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 1) {

3907 
i
 = 0; i < 0x200; i++) {

3908 
f
 = 0;

3910 i‡(
i
 & 
CRAM_FPAIRED
Ë
f
 |
BAM_FPAIRED
;

3911 i‡(
i
 & 
CRAM_FPROPER_PAIR
Ë
f
 |
BAM_FPROPER_PAIR
;

3912 i‡(
i
 & 
CRAM_FUNMAP
Ë
f
 |
BAM_FUNMAP
;

3913 i‡(
i
 & 
CRAM_FREVERSE
Ë
f
 |
BAM_FREVERSE
;

3914 i‡(
i
 & 
CRAM_FREAD1
Ë
f
 |
BAM_FREAD1
;

3915 i‡(
i
 & 
CRAM_FREAD2
Ë
f
 |
BAM_FREAD2
;

3916 i‡(
i
 & 
CRAM_FSECONDARY
Ë
f
 |
BAM_FSECONDARY
;

3917 i‡(
i
 & 
CRAM_FQCFAIL
Ë
f
 |
BAM_FQCFAIL
;

3918 i‡(
i
 & 
CRAM_FDUP
Ë
f
 |
BAM_FDUP
;

3920 
fd
->
bam_Êag_sw≠
[
i
] = 
f
;

3923 
i
 = 0; i < 0x1000; i++) {

3924 
g
 = 0;

3926 i‡(
i
 & 
BAM_FPAIRED
Ë
g
 |
CRAM_FPAIRED
;

3927 i‡(
i
 & 
BAM_FPROPER_PAIR
Ë
g
 |
CRAM_FPROPER_PAIR
;

3928 i‡(
i
 & 
BAM_FUNMAP
Ë
g
 |
CRAM_FUNMAP
;

3929 i‡(
i
 & 
BAM_FREVERSE
Ë
g
 |
CRAM_FREVERSE
;

3930 i‡(
i
 & 
BAM_FREAD1
Ë
g
 |
CRAM_FREAD1
;

3931 i‡(
i
 & 
BAM_FREAD2
Ë
g
 |
CRAM_FREAD2
;

3932 i‡(
i
 & 
BAM_FSECONDARY
Ë
g
 |
CRAM_FSECONDARY
;

3933 i‡(
i
 & 
BAM_FQCFAIL
Ë
g
 |
CRAM_FQCFAIL
;

3934 i‡(
i
 & 
BAM_FDUP
Ë
g
 |
CRAM_FDUP
;

3936 
fd
->
¸am_Êag_sw≠
[
i
] = 
g
;

3940 
i
 = 0; i < 0x1000; i++)

3941 
fd
->
bam_Êag_sw≠
[
i
] = i;

3942 
i
 = 0; i < 0x1000; i++)

3943 
fd
->
¸am_Êag_sw≠
[
i
] = i;

3946 
	`mem£t
(
fd
->
¸am_sub_m©rix
, 4, 32*32);

3947 
i
 = 0; i < 32; i++) {

3948 
fd
->
¸am_sub_m©rix
[
i
]['A'&0x1f]=0;

3949 
fd
->
¸am_sub_m©rix
[
i
]['C'&0x1f]=1;

3950 
fd
->
¸am_sub_m©rix
[
i
]['G'&0x1f]=2;

3951 
fd
->
¸am_sub_m©rix
[
i
]['T'&0x1f]=3;

3952 
fd
->
¸am_sub_m©rix
[
i
]['N'&0x1f]=4;

3954 
i
 = 0; i < 20; i+=4) {

3955 
j
;

3956 
j
 = 0; j < 20; j++) {

3957 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
j
]=3;

3958 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
j
]=3;

3959 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
j
]=3;

3960 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
j
]=3;

3962 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
CRAM_SUBST_MATRIX
[i+0]&0x1f]=0;

3963 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
CRAM_SUBST_MATRIX
[i+1]&0x1f]=1;

3964 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
CRAM_SUBST_MATRIX
[i+2]&0x1f]=2;

3965 
fd
->
¸am_sub_m©rix
["ACGTN"[
i
>>2]&0x1f][
CRAM_SUBST_MATRIX
[i+3]&0x1f]=3;

3967 
	}
}

3970 
	gmaj‹_vîsi⁄
 = 3;

3971 
	gmö‹_vîsi⁄
 = 0;

3980 
¸am_fd
 *
	$¸am_›í
(c⁄° *
fûíame
, c⁄° *
mode
) {

3981 
hFILE
 *
Â
;

3982 
¸am_fd
 *
fd
;

3983 
fmode
[3]{ 
mode
[0], '\0', '\0' };

3985 i‡(
	`°æí
(
mode
) > 1 && (mode[1] == 'b' || mode[1] == 'c')) {

3986 
fmode
[1] = 'b';

3989 
Â
 = 
	`h›í
(
fûíame
, 
fmode
);

3990 i‡(!
Â
)

3991  
NULL
;

3993 
fd
 = 
	`¸am_d›í
(
Â
, 
fûíame
, 
mode
);

3994 i‡(!
fd
)

3995 
	`h˛o£_abru±ly
(
Â
);

3997  
fd
;

3998 
	}
}

4005 
¸am_fd
 *
	$¸am_d›í
(
hFILE
 *
Â
, c⁄° *
fûíame
, c⁄° *
mode
) {

4006 
i
;

4007 *
˝
;

4008 
¸am_fd
 *
fd
 = 
	`ˇŒoc
(1, (*fd));

4009 i‡(!
fd
)

4010  
NULL
;

4012 
fd
->
Àvñ
 = 5;

4013 
i
 = 0; 
mode
[i]; i++) {

4014 i‡(
mode
[
i
] >= '0' && mode[i] <= '9') {

4015 
fd
->
Àvñ
 = 
mode
[
i
] - '0';

4020 
fd
->
Â
 = fp;

4021 
fd
->
mode
 = *mode;

4022 
fd
->
fú°_c⁄èöî
 = 0;

4024 i‡(
fd
->
mode
 == 'r') {

4027 i‡(!(
fd
->
fûe_def
 = 
	`¸am_ªad_fûe_def
(fd)))

4028 
îr
;

4030 
fd
->
vîsi⁄
 = fd->
fûe_def
->
maj‹_vîsi⁄
 * 256 +

4031 
fd
->
fûe_def
->
mö‹_vîsi⁄
;

4033 i‡(!(
fd
->
hódî
 = 
	`¸am_ªad_SAM_hdr
(fd))) {

4034 
	`¸am_‰ì_fûe_def
(
fd
->
fûe_def
);

4035 
îr
;

4040 
¸am_fûe_def
 *
def
 = 
	`ˇŒoc
(1, (*def));

4041 i‡(!
def
)

4042  
NULL
;

4044 
fd
->
fûe_def
 = 
def
;

4046 
def
->
magic
[0] = 'C';

4047 
def
->
magic
[1] = 'R';

4048 
def
->
magic
[2] = 'A';

4049 
def
->
magic
[3] = 'M';

4050 
def
->
maj‹_vîsi⁄
 = 0;

4051 
def
->
mö‹_vîsi⁄
 = 0;

4052 
	`mem£t
(
def
->
fûe_id
, 0, 20);

4053 
	`°∫˝y
(
def
->
fûe_id
, 
fûíame
, 20);

4055 
fd
->
vîsi⁄
 = 
maj‹_vîsi⁄
 * 256 + 
mö‹_vîsi⁄
;

4060 
	`¸am_öô_èbÀs
(
fd
);

4062 
fd
->
¥efix
 = 
	`°rdup
((
˝
 = 
	`°ºchr
(
fûíame
, '/')) ? cp+1 : filename);

4063 i‡(!
fd
->
¥efix
)

4064 
îr
;

4065 
fd
->
fú°_ba£
 = fd->
œ°_ba£
 = -1;

4066 
fd
->
ªc‹d_cou¡î
 = 0;

4068 
fd
->
˘r
 = 
NULL
;

4069 
fd
->
ªfs
 = 
	`ªfs_¸óã
();

4070 i‡(!
fd
->
ªfs
)

4071 
îr
;

4072 
fd
->
ªf_id
 = -2;

4073 
fd
->
ªf
 = 
NULL
;

4075 
fd
->
decode_md
 = 0;

4076 
fd
->
vîbo£
 = 0;

4077 
fd
->
£qs_≥r_¶i˚
 = 
SEQS_PER_SLICE
;

4078 
fd
->
ba£s_≥r_¶i˚
 = 
BASES_PER_SLICE
;

4079 
fd
->
¶i˚s_≥r_c⁄èöî
 = 
SLICE_PER_CNT
;

4080 
fd
->
embed_ªf
 = 0;

4081 
fd
->
no_ªf
 = 0;

4082 
fd
->
ign‹e_md5
 = 0;

4083 
fd
->
lossy_ªad_«mes
 = 0;

4084 
fd
->
u£_bz2
 = 0;

4085 
fd
->
u£_øns
 = (
	`CRAM_MAJOR_VERS
(fd->
vîsi⁄
) >= 3);

4086 
fd
->
u£_lzma
 = 0;

4087 
fd
->
mu…i_£q
 = -1;

4088 
fd
->
uns‹ãd
 = 0;

4089 
fd
->
sh¨ed_ªf
 = 0;

4091 
fd
->
ödex
 = 
NULL
;

4092 
fd
->
own_poﬁ
 = 0;

4093 
fd
->
poﬁ
 = 
NULL
;

4094 
fd
->
rqueue
 = 
NULL
;

4095 
fd
->
job_≥ndög
 = 
NULL
;

4096 
fd
->
ooc
 = 0;

4097 
fd
->
ªquúed_fõlds
 = 
INT_MAX
;

4099 
i
 = 0; i < 
DS_END
; i++)

4100 
fd
->
m
[
i
] = 
	`¸am_√w_mërics
();

4102 i‡(!(
fd
->
ègs_u£d
 = 
	`kh_öô
(
m_mërics
)))

4103 
îr
;

4105 
fd
->
ønge
.
ªfid
 = -2;

4106 
fd
->
eof
 = 1;

4107 
fd
->
ªf_‚
 = 
NULL
;

4109 
fd
->
bl
 = 
NULL
;

4112 i‡(-1 =
	`ªfs_‰om_hódî
(
fd
->
ªfs
, fd, fd->
hódî
))

4113 
îr
;

4115  
fd
;

4117 
îr
:

4118 i‡(
fd
)

4119 
	`‰ì
(
fd
);

4121  
NULL
;

4122 
	}
}

4130 
	$¸am_£ek
(
¸am_fd
 *
fd
, 
off_t
 
off£t
, 
whí˚
) {

4131 
buf
[65536];

4133 
fd
->
ooc
 = 0;

4135 i‡(
	`h£ek
(
fd
->
Â
, 
off£t
, 
whí˚
) >= 0)

4138 i‡(!(
whí˚
 =
SEEK_CUR
 && 
off£t
 >= 0))

4142 
off£t
 > 0) {

4143 
Àn
 = 
	`MIN
(65536, 
off£t
);

4144 i‡(
Àn
 !
	`hªad
(
fd
->
Â
, 
buf
,Üen))

4146 
off£t
 -
Àn
;

4150 
	}
}

4159 
	$¸am_Êush
(
¸am_fd
 *
fd
) {

4160 i‡(!
fd
)

4163 i‡(
fd
->
mode
 ='w' && fd->
˘r
) {

4164 if(
fd
->
˘r
->
¶i˚
)

4165 
	`¸am_upd©e_cuº_¶i˚
(
fd
->
˘r
);

4167 i‡(-1 =
	`¸am_Êush_c⁄èöî_mt
(
fd
, fd->
˘r
))

4172 
	}
}

4179 
	$¸am_˛o£
(
¸am_fd
 *
fd
) {

4180 
•¨e_bams
 *
bl
, *
√xt
;

4181 
i
;

4183 i‡(!
fd
)

4186 i‡(
fd
->
mode
 ='w' && fd->
˘r
) {

4187 if(
fd
->
˘r
->
¶i˚
)

4188 
	`¸am_upd©e_cuº_¶i˚
(
fd
->
˘r
);

4190 i‡(-1 =
	`¸am_Êush_c⁄èöî_mt
(
fd
, fd->
˘r
))

4194 i‡(
fd
->
poﬁ
 && fd->
eof
 >= 0) {

4195 
	`hts_çoﬁ_¥o˚ss_Êush
(
fd
->
rqueue
);

4197 i‡(0 !
	`¸am_Êush_ªsu…
(
fd
))

4200 
	`±hªad_muãx_de°roy
(&
fd
->
mërics_lock
);

4201 
	`±hªad_muãx_de°roy
(&
fd
->
ªf_lock
);

4202 
	`±hªad_muãx_de°roy
(&
fd
->
bam_li°_lock
);

4204 
fd
->
˘r
 = 
NULL
;

4208 
	`hts_çoﬁ_¥o˚ss_de°roy
(
fd
->
rqueue
);

4211 i‡(
fd
->
mode
 == 'w') {

4213 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) == 3) {

4214 i‡(38 !
	`hwrôe
(
fd
->
Â
,

4225 i‡(30 !
	`hwrôe
(
fd
->
Â
,

4234 
bl
 = 
fd
->bl; bl; b»
√xt
) {

4235 
i
, 
max_ªc
 = 
fd
->
£qs_≥r_¶i˚
 * fd->
¶i˚s_≥r_c⁄èöî
;

4237 
√xt
 = 
bl
->next;

4238 
i
 = 0; i < 
max_ªc
; i++) {

4239 i‡(
bl
->
bams
[
i
])

4240 
	`bam_‰ì
(
bl
->
bams
[
i
]);

4242 
	`‰ì
(
bl
->
bams
);

4243 
	`‰ì
(
bl
);

4246 i‡(
	`h˛o£
(
fd
->
Â
) != 0)

4249 i‡(
fd
->
fûe_def
)

4250 
	`¸am_‰ì_fûe_def
(
fd
->
fûe_def
);

4252 i‡(
fd
->
hódî
)

4253 
	`ßm_hdr_‰ì
(
fd
->
hódî
);

4255 
	`‰ì
(
fd
->
¥efix
);

4257 i‡(
fd
->
˘r
)

4258 
	`¸am_‰ì_c⁄èöî
(
fd
->
˘r
);

4260 i‡(
fd
->
ªfs
)

4261 
	`ªfs_‰ì
(
fd
->
ªfs
);

4262 i‡(
fd
->
ªf_‰ì
)

4263 
	`‰ì
(
fd
->
ªf_‰ì
);

4265 
i
 = 0; i < 
DS_END
; i++)

4266 i‡(
fd
->
m
[
i
])

4267 
	`‰ì
(
fd
->
m
[
i
]);

4269 i‡(
fd
->
ègs_u£d
) {

4270 
khöt_t
 
k
;

4272 
k
 = 
	`kh_begö
(
fd
->
ègs_u£d
); k !
	`kh_íd
(fd->tags_used); k++) {

4273 i‡(
	`kh_exi°
(
fd
->
ègs_u£d
, 
k
))

4274 
	`‰ì
(
	`kh_vÆ
(
fd
->
ègs_u£d
, 
k
));

4277 
	`kh_de°roy
(
m_mërics
, 
fd
->
ègs_u£d
);

4280 i‡(
fd
->
ödex
)

4281 
	`¸am_ödex_‰ì
(
fd
);

4283 i‡(
fd
->
own_poﬁ
 && fd->
poﬁ
)

4284 
	`hts_çoﬁ_de°roy
(
fd
->
poﬁ
);

4286 
	`‰ì
(
fd
);

4288 
	}
}

4293 
	$¸am_eof
(
¸am_fd
 *
fd
) {

4294  
fd
->
eof
;

4295 
	}
}

4305 
	$¸am_£t_›ti⁄
(
¸am_fd
 *
fd
, 
hts_fmt_›ti⁄
 
›t
, ...) {

4306 
r
;

4307 
va_li°
 
¨gs
;

4309 
	`va_°¨t
(
¨gs
, 
›t
);

4310 
r
 = 
	`¸am_£t_v›ti⁄
(
fd
, 
›t
, 
¨gs
);

4311 
	`va_íd
(
¨gs
);

4313  
r
;

4314 
	}
}

4323 
	$¸am_£t_v›ti⁄
(
¸am_fd
 *
fd
, 
hts_fmt_›ti⁄
 
›t
, 
va_li°
 
¨gs
) {

4324 
ªfs_t
 *
ªfs
;

4326 i‡(!
fd
) {

4327 
î∫o
 = 
EBADF
;

4331 
›t
) {

4332 
CRAM_OPT_DECODE_MD
:

4333 
fd
->
decode_md
 = 
	`va_¨g
(
¨gs
, );

4336 
CRAM_OPT_PREFIX
:

4337 i‡(
fd
->
¥efix
)

4338 
	`‰ì
(
fd
->
¥efix
);

4339 i‡(!(
fd
->
¥efix
 = 
	`°rdup
(
	`va_¨g
(
¨gs
, *))))

4343 
CRAM_OPT_VERBOSITY
:

4344 
fd
->
vîbo£
 = 
	`va_¨g
(
¨gs
, );

4347 
CRAM_OPT_SEQS_PER_SLICE
:

4348 
fd
->
£qs_≥r_¶i˚
 = 
	`va_¨g
(
¨gs
, );

4351 
CRAM_OPT_BASES_PER_SLICE
:

4352 
fd
->
ba£s_≥r_¶i˚
 = 
	`va_¨g
(
¨gs
, );

4355 
CRAM_OPT_SLICES_PER_CONTAINER
:

4356 
fd
->
¶i˚s_≥r_c⁄èöî
 = 
	`va_¨g
(
¨gs
, );

4359 
CRAM_OPT_EMBED_REF
:

4360 
fd
->
embed_ªf
 = 
	`va_¨g
(
¨gs
, );

4363 
CRAM_OPT_NO_REF
:

4364 
fd
->
no_ªf
 = 
	`va_¨g
(
¨gs
, );

4367 
CRAM_OPT_IGNORE_MD5
:

4368 
fd
->
ign‹e_md5
 = 
	`va_¨g
(
¨gs
, );

4371 
CRAM_OPT_LOSSY_NAMES
:

4372 
fd
->
lossy_ªad_«mes
 = 
	`va_¨g
(
¨gs
, );

4377 
fd
->
éí_≠¥ox
 = fd->
lossy_ªad_«mes
;

4378 
fd
->
éí_zîo
 = fd->
lossy_ªad_«mes
;

4381 
CRAM_OPT_USE_BZIP2
:

4382 
fd
->
u£_bz2
 = 
	`va_¨g
(
¨gs
, );

4385 
CRAM_OPT_USE_RANS
:

4386 
fd
->
u£_øns
 = 
	`va_¨g
(
¨gs
, );

4389 
CRAM_OPT_USE_LZMA
:

4390 
fd
->
u£_lzma
 = 
	`va_¨g
(
¨gs
, );

4393 
CRAM_OPT_SHARED_REF
:

4394 
fd
->
sh¨ed_ªf
 = 1;

4395 
ªfs
 = 
	`va_¨g
(
¨gs
, 
ªfs_t
 *);

4396 i‡(
ªfs
 !
fd
->refs) {

4397 i‡(
fd
->
ªfs
)

4398 
	`ªfs_‰ì
(
fd
->
ªfs
);

4399 
fd
->
ªfs
 =Ñefs;

4400 
fd
->
ªfs
->
cou¡
++;

4404 
CRAM_OPT_RANGE
:

4405 
fd
->
ønge
 = *
	`va_¨g
(
¨gs
, 
¸am_ønge
 *);

4406  
	`¸am_£ek_to_ªÂos
(
fd
, &fd->
ønge
);

4408 
CRAM_OPT_REFERENCE
:

4409  
	`¸am_lﬂd_ª„ªn˚
(
fd
, 
	`va_¨g
(
¨gs
, *));

4411 
CRAM_OPT_VERSION
: {

4412 
maj‹
, 
mö‹
;

4413 *
s
 = 
	`va_¨g
(
¨gs
, *);

4414 i‡(2 !
	`ssˇnf
(
s
, "%d.%d", &
maj‹
, &
mö‹
)) {

4415 
	`Ârötf
(
°dîr
, "MÆf‹med vîsi⁄ såög %s\n", 
s
);

4418 i‡(!((
maj‹
 =1 && 
mö‹
 == 0) ||

4419 (
maj‹
 =2 && (
mö‹
 == 0 || minor == 1)) ||

4420 (
maj‹
 =3 && 
mö‹
 == 0))) {

4421 
	`Ârötf
(
°dîr
, "Unknown version string; "

4423 
î∫o
 = 
EINVAL
;

4426 
fd
->
vîsi⁄
 = 
maj‹
*256 + 
mö‹
;

4428 i‡(
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
) >= 3)

4429 
fd
->
u£_øns
 = 1;

4433 
CRAM_OPT_MULTI_SEQ_PER_SLICE
:

4434 
fd
->
mu…i_£q
 = 
	`va_¨g
(
¨gs
, );

4437 
CRAM_OPT_NTHREADS
: {

4438 
¡hªads
 = 
	`va_¨g
(
¨gs
, );

4439 i‡(
¡hªads
 > 1) {

4440 i‡(!(
fd
->
poﬁ
 = 
	`hts_çoﬁ_öô
(
¡hªads
)))

4443 
fd
->
rqueue
 = 
	`hts_çoﬁ_¥o˚ss_öô
(fd->
poﬁ
, 
¡hªads
*2, 0);

4444 
	`±hªad_muãx_öô
(&
fd
->
mërics_lock
, 
NULL
);

4445 
	`±hªad_muãx_öô
(&
fd
->
ªf_lock
, 
NULL
);

4446 
	`±hªad_muãx_öô
(&
fd
->
bam_li°_lock
, 
NULL
);

4447 
fd
->
sh¨ed_ªf
 = 1;

4448 
fd
->
own_poﬁ
 = 1;

4453 
CRAM_OPT_THREAD_POOL
: {

4454 
htsThªadPoﬁ
 *
p
 = 
	`va_¨g
(
¨gs
, htsThreadPool *);

4455 
fd
->
poﬁ
 = 
p
 ?Ö->poﬁ : 
NULL
;

4456 i‡(
fd
->
poﬁ
) {

4457 
fd
->
rqueue
 = 
	`hts_çoﬁ_¥o˚ss_öô
(fd->
poﬁ
,

4458 
p
->
qsize
 ?Ö->qsizê: 
	`hts_çoﬁ_size
(
fd
->
poﬁ
)*2,

4460 
	`±hªad_muãx_öô
(&
fd
->
mërics_lock
, 
NULL
);

4461 
	`±hªad_muãx_öô
(&
fd
->
ªf_lock
, 
NULL
);

4462 
	`±hªad_muãx_öô
(&
fd
->
bam_li°_lock
, 
NULL
);

4464 
fd
->
sh¨ed_ªf
 = 1;

4465 
fd
->
own_poﬁ
 = 0;

4473 
CRAM_OPT_REQUIRED_FIELDS
:

4474 
fd
->
ªquúed_fõlds
 = 
	`va_¨g
(
¨gs
, );

4477 
HTS_OPT_COMPRESSION_LEVEL
:

4478 
fd
->
Àvñ
 = 
	`va_¨g
(
¨gs
, );

4482 
	`Ârötf
(
°dîr
, "Unknow¿CRAM o±i⁄ codê%d\n", 
›t
);

4483 
î∫o
 = 
EINVAL
;

4488 
	}
}

4490 
	$¸am_check_EOF
(
¸am_fd
 *
fd
)

4495 c⁄° 
TEMPLATE_2_1
[30] = {

4500 c⁄° 
TEMPLATE_3
[38] = {

4507 
buf
[38];

4509 
uöt8_t
 
maj‹
 = 
	`CRAM_MAJOR_VERS
(
fd
->
vîsi⁄
);

4510 
uöt8_t
 
mö‹
 = 
	`CRAM_MINOR_VERS
(
fd
->
vîsi⁄
);

4512 c⁄° *
ãm∂©e
;

4513 
ssize_t
 
ãm∂©e_Àn
;

4514 i‡((
maj‹
 < 2) ||

4515 (
maj‹
 =2 && 
mö‹
 == 0)) {

4517 } i‡(
maj‹
 =2 && 
mö‹
 == 1) {

4518 
ãm∂©e
 = 
TEMPLATE_2_1
;

4519 
ãm∂©e_Àn
 =  
TEMPLATE_2_1
;

4521 
ãm∂©e
 = 
TEMPLATE_3
;

4522 
ãm∂©e_Àn
 =  
TEMPLATE_3
;

4525 
off_t
 
off£t
 = 
	`hãŒ
(
fd
->
Â
);

4526 i‡(
	`h£ek
(
fd
->
Â
, -
ãm∂©e_Àn
, 
SEEK_END
) < 0) {

4527 i‡(
î∫o
 =
ESPIPE
) {

4528 
	`h˛óªº
(
fd
->
Â
);

4535 i‡(
	`hªad
(
fd
->
Â
, 
buf
, 
ãm∂©e_Àn
) !=Åemplate_len)  -1;

4536 i‡(
	`h£ek
(
fd
->
Â
, 
off£t
, 
SEEK_SET
) < 0)  -1;

4537 
buf
[8] &= 0x0f;

4538  (
	`memcmp
(
ãm∂©e
, 
buf
, 
ãm∂©e_Àn
) == 0)? 1 : 0;

4539 
	}
}

	@htslib/cram/cram_io.h

42 #i‚de‡
_CRAM_IO_H_


43 
	#_CRAM_IO_H_


	)

45 
	~<°döt.h
>

46 
	~<¸am/misc.h
>

48 #ifde‡
__˝lu•lus


59 
	#CRAM_KEY
(
a
,
b
Ë((◊)<<8)|((b)))

	)

68 
ôf8_decode
(
¸am_fd
 *
fd
, 
öt32_t
 *
vÆ
);

70 
ölöe
 
ôf8_gë
(*
˝
, 
öt32_t
 *
vÆ_p
) {

71 *
up
 = (*)
˝
;

73 i‡(
up
[0] < 0x80) {

74 *
vÆ_p
 = 
up
[0];

76 } i‡(
up
[0] < 0xc0) {

77 *
vÆ_p
 = ((
up
[0] <<8) | up[1]) & 0x3fff;

79 } i‡(
up
[0] < 0xe0) {

80 *
vÆ_p
 = ((
up
[0]<<16) | (up[1]<< 8) | up[2]) & 0x1fffff;

82 } i‡(
up
[0] < 0xf0) {

83 *
vÆ_p
 = ((
up
[0]<<24) | (up[1]<<16) | (up[2]<<8) | up[3]) & 0x0fffffff;

86 *
vÆ_p
 = ((
up
[0] & 0x0f)<<28) | (up[1]<<20) | (up[2]<<12) | (up[3]<<4) | (up[4] & 0x0f);

97 
ölöe
 
ôf8_put
(*
˝
, 
öt32_t
 
vÆ
) {

98 *
up
 = (*)
˝
;

99 i‡(!(
vÆ
 & ~0x00000007f)) {

100 *
up
 = 
vÆ
;

102 } i‡(!(
vÆ
 & ~0x00003fff)) {

103 *
up
++ = (
vÆ
 >> 8 ) | 0x80;

104 *
up
 = 
vÆ
 & 0xff;

106 } i‡(!(
vÆ
 & ~0x01fffff)) {

107 *
up
++ = (
vÆ
 >> 16) | 0xc0;

108 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

109 *
up
 = 
vÆ
 & 0xff;

111 } i‡(!(
vÆ
 & ~0x0fffffff)) {

112 *
up
++ = (
vÆ
 >> 24) | 0xe0;

113 *
up
++ = (
vÆ
 >> 16) & 0xff;

114 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

115 *
up
 = 
vÆ
 & 0xff;

118 *
up
++ = 0xf0 | ((
vÆ
>>28) & 0xff);

119 *
up
++ = (
vÆ
 >> 20) & 0xff;

120 *
up
++ = (
vÆ
 >> 12) & 0xff;

121 *
up
++ = (
vÆ
 >> 4 ) & 0xff;

122 *
up
 = 
vÆ
 & 0x0f;

129 
ölöe
 
…f8_put
(*
˝
, 
öt64_t
 
vÆ
) {

130 *
up
 = (*)
˝
;

131 i‡(!(
vÆ
 & ~((1LL<<7)-1))) {

132 *
up
 = 
vÆ
;

134 } i‡(!(
vÆ
 & ~((1LL<<(6+8))-1))) {

135 *
up
++ = (
vÆ
 >> 8 ) | 0x80;

136 *
up
 = 
vÆ
 & 0xff;

138 } i‡(!(
vÆ
 & ~((1LL<<(5+2*8))-1))) {

139 *
up
++ = (
vÆ
 >> 16) | 0xc0;

140 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

141 *
up
 = 
vÆ
 & 0xff;

143 } i‡(!(
vÆ
 & ~((1LL<<(4+3*8))-1))) {

144 *
up
++ = (
vÆ
 >> 24) | 0xe0;

145 *
up
++ = (
vÆ
 >> 16) & 0xff;

146 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

147 *
up
 = 
vÆ
 & 0xff;

149 } i‡(!(
vÆ
 & ~((1LL<<(3+4*8))-1))) {

150 *
up
++ = (
vÆ
 >> 32) | 0xf0;

151 *
up
++ = (
vÆ
 >> 24) & 0xff;

152 *
up
++ = (
vÆ
 >> 16) & 0xff;

153 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

154 *
up
 = 
vÆ
 & 0xff;

156 } i‡(!(
vÆ
 & ~((1LL<<(2+5*8))-1))) {

157 *
up
++ = (
vÆ
 >> 40) | 0xf8;

158 *
up
++ = (
vÆ
 >> 32) & 0xff;

159 *
up
++ = (
vÆ
 >> 24) & 0xff;

160 *
up
++ = (
vÆ
 >> 16) & 0xff;

161 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

162 *
up
 = 
vÆ
 & 0xff;

164 } i‡(!(
vÆ
 & ~((1LL<<(1+6*8))-1))) {

165 *
up
++ = (
vÆ
 >> 48) | 0xfc;

166 *
up
++ = (
vÆ
 >> 40) & 0xff;

167 *
up
++ = (
vÆ
 >> 32) & 0xff;

168 *
up
++ = (
vÆ
 >> 24) & 0xff;

169 *
up
++ = (
vÆ
 >> 16) & 0xff;

170 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

171 *
up
 = 
vÆ
 & 0xff;

173 } i‡(!(
vÆ
 & ~((1LL<<(7*8))-1))) {

174 *
up
++ = (
vÆ
 >> 56) | 0xfe;

175 *
up
++ = (
vÆ
 >> 48) & 0xff;

176 *
up
++ = (
vÆ
 >> 40) & 0xff;

177 *
up
++ = (
vÆ
 >> 32) & 0xff;

178 *
up
++ = (
vÆ
 >> 24) & 0xff;

179 *
up
++ = (
vÆ
 >> 16) & 0xff;

180 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

181 *
up
 = 
vÆ
 & 0xff;

184 *
up
++ = 0xff;

185 *
up
++ = (
vÆ
 >> 56) & 0xff;

186 *
up
++ = (
vÆ
 >> 48) & 0xff;

187 *
up
++ = (
vÆ
 >> 40) & 0xff;

188 *
up
++ = (
vÆ
 >> 32) & 0xff;

189 *
up
++ = (
vÆ
 >> 24) & 0xff;

190 *
up
++ = (
vÆ
 >> 16) & 0xff;

191 *
up
++ = (
vÆ
 >> 8 ) & 0xff;

192 *
up
 = 
vÆ
 & 0xff;

197 
ölöe
 
…f8_gë
(*
˝
, 
öt64_t
 *
vÆ_p
) {

198 *
up
 = (*)
˝
;

200 i‡(
up
[0] < 0x80) {

201 *
vÆ_p
 = 
up
[0];

203 } i‡(
up
[0] < 0xc0) {

204 *
vÆ_p
 = (((
uöt64_t
)
up
[0]<< 8) |

205 (
uöt64_t
)
up
[1]) & (((1LL<<(6+8)))-1);

207 } i‡(
up
[0] < 0xe0) {

208 *
vÆ_p
 = (((
uöt64_t
)
up
[0]<<16) |

209 ((
uöt64_t
)
up
[1]<< 8) |

210 (
uöt64_t
)
up
[2]) & ((1LL<<(5+2*8))-1);

212 } i‡(
up
[0] < 0xf0) {

213 *
vÆ_p
 = (((
uöt64_t
)
up
[0]<<24) |

214 ((
uöt64_t
)
up
[1]<<16) |

215 ((
uöt64_t
)
up
[2]<< 8) |

216 (
uöt64_t
)
up
[3]) & ((1LL<<(4+3*8))-1);

218 } i‡(
up
[0] < 0xf8) {

219 *
vÆ_p
 = (((
uöt64_t
)
up
[0]<<32) |

220 ((
uöt64_t
)
up
[1]<<24) |

221 ((
uöt64_t
)
up
[2]<<16) |

222 ((
uöt64_t
)
up
[3]<< 8) |

223 (
uöt64_t
)
up
[4]) & ((1LL<<(3+4*8))-1);

225 } i‡(
up
[0] < 0xfc) {

226 *
vÆ_p
 = (((
uöt64_t
)
up
[0]<<40) |

227 ((
uöt64_t
)
up
[1]<<32) |

228 ((
uöt64_t
)
up
[2]<<24) |

229 ((
uöt64_t
)
up
[3]<<16) |

230 ((
uöt64_t
)
up
[4]<< 8) |

231 (
uöt64_t
)
up
[5]) & ((1LL<<(2+5*8))-1);

233 } i‡(
up
[0] < 0xfe) {

234 *
vÆ_p
 = (((
uöt64_t
)
up
[0]<<48) |

235 ((
uöt64_t
)
up
[1]<<40) |

236 ((
uöt64_t
)
up
[2]<<32) |

237 ((
uöt64_t
)
up
[3]<<24) |

238 ((
uöt64_t
)
up
[4]<<16) |

239 ((
uöt64_t
)
up
[5]<< 8) |

240 (
uöt64_t
)
up
[6]) & ((1LL<<(1+6*8))-1);

242 } i‡(
up
[0] < 0xff) {

243 *
vÆ_p
 = (((
uöt64_t
)
up
[1]<<48) |

244 ((
uöt64_t
)
up
[2]<<40) |

245 ((
uöt64_t
)
up
[3]<<32) |

246 ((
uöt64_t
)
up
[4]<<24) |

247 ((
uöt64_t
)
up
[5]<<16) |

248 ((
uöt64_t
)
up
[6]<< 8) |

249 (
uöt64_t
)
up
[7]) & ((1LL<<(7*8))-1);

252 *
vÆ_p
 = (((
uöt64_t
)
up
[1]<<56) |

253 ((
uöt64_t
)
up
[2]<<48) |

254 ((
uöt64_t
)
up
[3]<<40) |

255 ((
uöt64_t
)
up
[4]<<32) |

256 ((
uöt64_t
)
up
[5]<<24) |

257 ((
uöt64_t
)
up
[6]<<16) |

258 ((
uöt64_t
)
up
[7]<< 8) |

259 (
uöt64_t
)
up
[8]);

264 
	#ôf8_size
(
v
Ë((!((v)&~0x7f))?1:(!((v)&~0x3fff))?2:(!((v)&~0x1fffff))?3:(!((v)&~0xfffffff))?4:5)

	)

269 c⁄° 
ôf8_byãs
[16];

270 c⁄° 
…f8_byãs
[256];

272 
ölöe
 
ß„_ôf8_gë
(c⁄° *
˝
, c⁄° *
ídp
,

273 
öt32_t
 *
vÆ_p
) {

274 c⁄° *
	gup
 = (*)
˝
;

276 i‡(
	gídp
 - 
	g˝
 < 5 &&

277 (
	g˝
 >
ídp
 ||Énd∞- 
˝
 < 
ôf8_byãs
[
up
[0]>>4])) {

278 *
vÆ_p
 = 0;

282 i‡(
	gup
[0] < 0x80) {

283 *
	gvÆ_p
 = 
up
[0];

285 } i‡(
	gup
[0] < 0xc0) {

286 *
	gvÆ_p
 = ((
up
[0] <<8) | up[1]) & 0x3fff;

288 } i‡(
	gup
[0] < 0xe0) {

289 *
	gvÆ_p
 = ((
up
[0]<<16) | (up[1]<< 8) | up[2]) & 0x1fffff;

291 } i‡(
	gup
[0] < 0xf0) {

292 *
	gvÆ_p
 = (((
uöt32_t
)
up
[0]<<24) | (up[1]<<16) | (up[2]<<8) | up[3]) & 0x0fffffff;

295 
uöt32_t
 
	guv
 = (((uöt32_t)
up
[0] & 0x0f)<<28) | (up[1]<<20) | (up[2]<<12) | (up[3]<<4) | (up[4] & 0x0f);

296 *
	gvÆ_p
 = 
uv
 < 0x80000000UL ? uv : -((
öt32_t
) (0xffffffffUL - uv)) - 1;

301 
ölöe
 
ß„_…f8_gë
(c⁄° *
˝
, c⁄° *
ídp
,

302 
öt64_t
 *
vÆ_p
) {

303 *
	gup
 = (*)
˝
;

305 i‡(
	gídp
 - 
	g˝
 < 9 &&

306 (
	g˝
 >
ídp
 ||Énd∞- 
˝
 < 
…f8_byãs
[
up
[0]]))  0;

308 i‡(
	gup
[0] < 0x80) {

309 *
	gvÆ_p
 = 
up
[0];

311 } i‡(
	gup
[0] < 0xc0) {

312 *
	gvÆ_p
 = (((
uöt64_t
)
up
[0]<< 8) |

313 (
uöt64_t
)
up
[1]) & (((1LL<<(6+8)))-1);

315 } i‡(
	gup
[0] < 0xe0) {

316 *
	gvÆ_p
 = (((
uöt64_t
)
up
[0]<<16) |

317 ((
uöt64_t
)
up
[1]<< 8) |

318 (
uöt64_t
)
up
[2]) & ((1LL<<(5+2*8))-1);

320 } i‡(
	gup
[0] < 0xf0) {

321 *
	gvÆ_p
 = (((
uöt64_t
)
up
[0]<<24) |

322 ((
uöt64_t
)
up
[1]<<16) |

323 ((
uöt64_t
)
up
[2]<< 8) |

324 (
uöt64_t
)
up
[3]) & ((1LL<<(4+3*8))-1);

326 } i‡(
	gup
[0] < 0xf8) {

327 *
	gvÆ_p
 = (((
uöt64_t
)
up
[0]<<32) |

328 ((
uöt64_t
)
up
[1]<<24) |

329 ((
uöt64_t
)
up
[2]<<16) |

330 ((
uöt64_t
)
up
[3]<< 8) |

331 (
uöt64_t
)
up
[4]) & ((1LL<<(3+4*8))-1);

333 } i‡(
	gup
[0] < 0xfc) {

334 *
	gvÆ_p
 = (((
uöt64_t
)
up
[0]<<40) |

335 ((
uöt64_t
)
up
[1]<<32) |

336 ((
uöt64_t
)
up
[2]<<24) |

337 ((
uöt64_t
)
up
[3]<<16) |

338 ((
uöt64_t
)
up
[4]<< 8) |

339 (
uöt64_t
)
up
[5]) & ((1LL<<(2+5*8))-1);

341 } i‡(
	gup
[0] < 0xfe) {

342 *
	gvÆ_p
 = (((
uöt64_t
)
up
[0]<<48) |

343 ((
uöt64_t
)
up
[1]<<40) |

344 ((
uöt64_t
)
up
[2]<<32) |

345 ((
uöt64_t
)
up
[3]<<24) |

346 ((
uöt64_t
)
up
[4]<<16) |

347 ((
uöt64_t
)
up
[5]<< 8) |

348 (
uöt64_t
)
up
[6]) & ((1LL<<(1+6*8))-1);

350 } i‡(
	gup
[0] < 0xff) {

351 *
	gvÆ_p
 = (((
uöt64_t
)
up
[1]<<48) |

352 ((
uöt64_t
)
up
[2]<<40) |

353 ((
uöt64_t
)
up
[3]<<32) |

354 ((
uöt64_t
)
up
[4]<<24) |

355 ((
uöt64_t
)
up
[5]<<16) |

356 ((
uöt64_t
)
up
[6]<< 8) |

357 (
uöt64_t
)
up
[7]) & ((1LL<<(7*8))-1);

360 *
	gvÆ_p
 = (((
uöt64_t
)
up
[1]<<56) |

361 ((
uöt64_t
)
up
[2]<<48) |

362 ((
uöt64_t
)
up
[3]<<40) |

363 ((
uöt64_t
)
up
[4]<<32) |

364 ((
uöt64_t
)
up
[5]<<24) |

365 ((
uöt64_t
)
up
[6]<<16) |

366 ((
uöt64_t
)
up
[7]<< 8) |

367 (
uöt64_t
)
up
[8]);

380 
ôf8_put_blk
(
¸am_block
 *
blk
, 
vÆ
);

387 
öt32_gë_blk
(
¸am_block
 *
b
, 
öt32_t
 *
vÆ
);

395 
öt32_put_blk
(
¸am_block
 *
blk
, 
öt32_t
 
vÆ
);

414 
¸am_block
 *
¸am_√w_block
(
¸am_c⁄ã¡_ty≥
 
c⁄ã¡_ty≥
,

415 
c⁄ã¡_id
);

423 
¸am_block
 *
¸am_ªad_block
(
¸am_fd
 *
fd
);

431 
¸am_wrôe_block
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
);

435 
¸am_‰ì_block
(
¸am_block
 *
b
);

443 *
zlib_mem_öÊ©e
(*
cd©a
, 
size_t
 
csize
, size_à*
size
);

451 
¸am_uncom¥ess_block
(
¸am_block
 *
b
);

466 
¸am_com¥ess_block
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
, 
¸am_mërics
 *
mërics
,

467 
mëhod
, 
Àvñ
);

469 
¸am_mërics
 *
¸am_√w_mërics
();

470 *
¸am_block_mëhod2°r
(
¸am_block_mëhod
 
m
);

471 *
¸am_c⁄ã¡_ty≥2°r
(
¸am_c⁄ã¡_ty≥
 
t
);

477 
ölöe
 
¸am_block
 *
¸am_gë_block_by_id
(
¸am_¶i˚
 *
¶i˚
, 
id
) {

478 i‡(
	g¶i˚
->
	gblock_by_id
 && 
	gid
 >0 && 
id
 < 1024) {

479  
¶i˚
->
block_by_id
[
id
];

481 
	gi
;

482 
	gi
 = 0; i < 
	g¶i˚
->
	ghdr
->
	gnum_blocks
; i++) {

483 
¸am_block
 *
	gb
 = 
¶i˚
->
block
[
i
];

484 i‡(
	gb
 && b->
	gc⁄ã¡_ty≥
 =
EXTERNAL
 && 
b
->
c⁄ã¡_id
 =
id
)

485  
b
;

488  
	gNULL
;

494 
	#BLOCK_SIZE
(
b
Ë((b)->
byã
)

	)

495 
	#BLOCK_DATA
(
b
Ë((b)->
d©a
)

	)

498 
	#BLOCK_END
(
b
Ë(&(b)->
d©a
[(b)->
byã
])

	)

501 
	#BLOCK_RESIZE
(
b
,
l
) \

503 (
b
)->
Æloc
 <(
l
)) { \

504 (
b
)->
Æloc
 = (b)->alloc ? (b)->alloc*1.5 : 1024; \

505 (
b
)->
d©a
 = 
	`ªÆloc
((b)->d©a, (b)->
Æloc
); \

507 } 0)

	)

510 
	#BLOCK_RESIZE_EXACT
(
b
,
l
) \

512 (
b
)->
Æloc
 = (
l
); \

513 (
b
)->
d©a
 = 
	`ªÆloc
((b)->d©a, (b)->
Æloc
); \

514 } 0)

	)

517 
	#BLOCK_GROW
(
b
,
l
Ë
	`BLOCK_RESIZE
((b), 
	`BLOCK_SIZE
((b)Ë+ (l))

	)

520 
	#BLOCK_APPEND
(
b
,
s
,
l
) \

522 
	`BLOCK_GROW
((
b
),(
l
)); \

523 
	`mem˝y
(
	`BLOCK_END
((
b
)), (
s
), (
l
)); \

524 
	`BLOCK_SIZE
((
b
)Ë+(
l
); \

525 } 0)

	)

528 
	#BLOCK_APPEND_CHAR
(
b
,
c
) \

530 
	`BLOCK_GROW
((
b
),1); \

531 (
b
)->
d©a
[(b)->
byã
++] = (
c
); \

532 } 0)

	)

535 
	#BLOCK_APPEND_UINT
(
b
,
i
) \

537 *
˝
; \

538 
	`BLOCK_GROW
((
b
),11); \

539 
˝
 = &(
b
)->
d©a
[(b)->
byã
]; \

540 (
b
)->
byã
 +
	`≠≥nd_uöt32
(
˝
, (
i
)) - cp; \

541 } 0)

	)

543 
ölöe
 *
≠≥nd_uöt32
(*
˝
, 
uöt32_t
 
i
) {

544 
uöt32_t
 
	gj
;

546 i‡(
	gi
 == 0) {

547 *
˝
++ = '0';

548  
	g˝
;

551 i‡(
	gi
 < 100Ë
	gb1
;

552 i‡(
	gi
 < 10000Ë
	gb3
;

553 i‡(
	gi
 < 1000000Ë
	gb5
;

554 i‡(
	gi
 < 100000000Ë
	gb7
;

556 i‡((
	gj
 = 
i
 / 1000000000)Ë{*
˝
++ = 
j
 + '0'; 
	gi
 -j*1000000000; 
	gx8
;}

557 i‡((
	gj
 = 
i
 / 100000000)Ë{*
˝
++ = 
j
 + '0'; 
	gi
 -j*100000000; 
	gx7
;}

558 
	gb7
:i‡((
j
 = 
i
 / 10000000)Ë{*
˝
++ = j + '0'; 
	gi
 -j*10000000; 
	gx6
;}

559 i‡((
	gj
 = 
i
 / 1000000)Ë{*
˝
++ = 
j
 + '0', 
	gi
 -j*1000000; 
	gx5
;}

560 
	gb5
:i‡((
j
 = 
i
 / 100000)Ë{*
˝
++ = j + '0', 
	gi
 -j*100000; 
	gx4
;}

561 i‡((
	gj
 = 
i
 / 10000)Ë{*
˝
++ = 
j
 + '0', 
	gi
 -j*10000; 
	gx3
;}

562 
	gb3
:i‡((
j
 = 
i
 / 1000)Ë{*
˝
++ = j + '0', 
	gi
 -j*1000; 
	gx2
;}

563 i‡((
	gj
 = 
i
 / 100)Ë{*
˝
++ = 
j
 + '0', 
	gi
 -j*100; 
	gx1
;}

564 
	gb1
:i‡((
j
 = 
i
 / 10)Ë{*
˝
++ = j + '0', 
	gi
 -j*10; 
	gx0
;}

565 i‡(
	gi
Ë*
	g˝
++ = 
i
 + '0';

566  
	g˝
;

568 
	gx8
: *
˝
++ = 
i
 / 100000000 + '0', 
	gi
 %= 100000000;

569 
	gx7
: *
˝
++ = 
i
 / 10000000 + '0', 
	gi
 %= 10000000;

570 
	gx6
: *
˝
++ = 
i
 / 1000000 + '0', 
	gi
 %= 1000000;

571 
	gx5
: *
˝
++ = 
i
 / 100000 + '0', 
	gi
 %= 100000;

572 
	gx4
: *
˝
++ = 
i
 / 10000 + '0', 
	gi
 %= 10000;

573 
	gx3
: *
˝
++ = 
i
 / 1000 + '0', 
	gi
 %= 1000;

574 
	gx2
: *
˝
++ = 
i
 / 100 + '0', 
	gi
 %= 100;

575 
	gx1
: *
˝
++ = 
i
 / 10 + '0', 
	gi
 %= 10;

576 
	gx0
: *
˝
++ = 
i
 + '0';

578  
	g˝
;

581 
ölöe
 *
≠≥nd_sub32
(*
˝
, 
uöt32_t
 
i
) {

582 *
	g˝
++ = 
i
 / 100000000 + '0', 
	gi
 %= 100000000;

583 *
	g˝
++ = 
i
 / 10000000 + '0', 
	gi
 %= 10000000;

584 *
	g˝
++ = 
i
 / 1000000 + '0', 
	gi
 %= 1000000;

585 *
	g˝
++ = 
i
 / 100000 + '0', 
	gi
 %= 100000;

586 *
	g˝
++ = 
i
 / 10000 + '0', 
	gi
 %= 10000;

587 *
	g˝
++ = 
i
 / 1000 + '0', 
	gi
 %= 1000;

588 *
	g˝
++ = 
i
 / 100 + '0', 
	gi
 %= 100;

589 *
	g˝
++ = 
i
 / 10 + '0', 
	gi
 %= 10;

590 *
	g˝
++ = 
i
 + '0';

592  
	g˝
;

595 
ölöe
 *
≠≥nd_uöt64
(*
˝
, 
uöt64_t
 
i
) {

596 
uöt64_t
 
	gj
;

598 i‡(
	gi
 <= 0xffffffff)

599  
≠≥nd_uöt32
(
˝
, 
i
);

601 i‡((
	gj
 = 
i
/1000000000) > 1000000000) {

602 
˝
 = 
≠≥nd_uöt32
(˝, 
j
/1000000000);

603 
	gj
 %= 1000000000;

604 
	g˝
 = 
≠≥nd_sub32
(
˝
, 
j
);

606 
	g˝
 = 
≠≥nd_uöt32
(
˝
, 
i
 / 1000000000);

608 
	g˝
 = 
≠≥nd_sub32
(
˝
, 
i
 % 1000000000);

610  
	g˝
;

613 
	#BLOCK_UPLEN
(
b
) \

614 (
b
)->
comp_size
 = (b)->
uncomp_size
 = 
	`BLOCK_SIZE
((b))

	)

627 
¸am_lﬂd_ª„ªn˚
(
¸am_fd
 *
fd
, *
‚
);

638 
ªfs2id
(
ªfs_t
 *
r
, 
SAM_hdr
 *
bfd
);

640 
ªfs_‰ì
(
ªfs_t
 *
r
);

655 *
¸am_gë_ªf
(
¸am_fd
 *
fd
, 
id
, 
°¨t
, 
íd
);

656 
¸am_ªf_ö¸
(
ªfs_t
 *
r
, 
id
);

657 
¸am_ªf_de¸
(
ªfs_t
 *
r
, 
id
);

670 
¸am_c⁄èöî
 *
¸am_√w_c⁄èöî
(
ƒec
, 
n¶i˚
);

671 
¸am_‰ì_c⁄èöî
(
¸am_c⁄èöî
 *
c
);

679 
¸am_c⁄èöî
 *
¸am_ªad_c⁄èöî
(
¸am_fd
 *
fd
);

687 
¸am_wrôe_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
h
);

699 
¸am_Êush_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
);

700 
¸am_Êush_c⁄èöî_mt
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
);

714 
¸am_block_com¥essi⁄_hdr
 *
¸am_√w_com¥essi⁄_hódî
();

717 
¸am_‰ì_com¥essi⁄_hódî
(
¸am_block_com¥essi⁄_hdr
 *
hdr
);

726 
¸am_‰ì_¶i˚_hódî
(
¸am_block_¶i˚_hdr
 *
hdr
);

729 
¸am_‰ì_¶i˚
(
¸am_¶i˚
 *
s
);

738 
¸am_¶i˚
 *
¸am_√w_¶i˚
(
¸am_c⁄ã¡_ty≥
 
ty≥
, 
ƒecs
);

752 
¸am_¶i˚
 *
¸am_ªad_¶i˚
(
¸am_fd
 *
fd
);

767 
¸am_fûe_def
 *
¸am_ªad_fûe_def
(
¸am_fd
 *
fd
);

775 
¸am_wrôe_fûe_def
(
¸am_fd
 *
fd
, 
¸am_fûe_def
 *
def
);

778 
¸am_‰ì_fûe_def
(
¸am_fûe_def
 *
def
);

795 
SAM_hdr
 *
¸am_ªad_SAM_hdr
(
¸am_fd
 *
fd
);

803 
¸am_wrôe_SAM_hdr
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
);

819 
¸am_fd
 *
¸am_›í
(c⁄° *
fûíame
, c⁄° *
mode
);

827 
¸am_fd
 *
¸am_d›í
(
hFILE
 *
Â
, c⁄° *
fûíame
, c⁄° *
mode
);

835 
¸am_˛o£
(
¸am_fd
 *
fd
);

843 
¸am_£ek
(
¸am_fd
 *
fd
, 
off_t
 
off£t
, 
whí˚
);

852 
¸am_Êush
(
¸am_fd
 *
fd
);

861 
¸am_eof
(
¸am_fd
 *
fd
);

872 
¸am_£t_›ti⁄
(
¸am_fd
 *
fd
, 
hts_fmt_›ti⁄
 
›t
, ...);

883 
¸am_£t_v›ti⁄
(
¸am_fd
 *
fd
, 
hts_fmt_›ti⁄
 
›t
, 
va_li°
 
¨gs
);

896 
¸am_£t_hódî
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
);

899 #ifde‡
__˝lu•lus


	@htslib/cram/cram_samtools.c

31 
	~<c⁄fig.h
>

33 
	~<as£π.h
>

34 
	~<°rög.h
>

35 
	~<°dlib.h
>

37 
	~"¸am/¸am.h
"

38 
	~"ht¶ib/ßm.h
"

43 
	$bam_c⁄°ru˘_£q
(
bam_£q_t
 **
bp
, 
size_t
 
exåa_Àn
,

44 c⁄° *
q«me
, 
size_t
 
q«me_Àn
,

45 
Êag
,

46 
∫ame
,

47 
pos
,

48 
íd
,

49 
m≠q
,

50 
uöt32_t
 
ncig¨
, c⁄° uöt32_à*
cig¨
,

51 
m∫m
,

52 
mpos
,

53 
isize
,

54 
Àn
,

55 c⁄° *
£q
,

56 c⁄° *
quÆ
) {

57 c⁄° 
L
[256] = {

75 
bam1_t
 *
b
 = (bam1_à*)*
bp
;

76 
uöt8_t
 *
˝
;

77 
i
, 
q«me_nuls
, 
bam_Àn
;

81 
q«me_nuls
 = 4 - 
q«me_Àn
%4;

82 i‡(
q«me_Àn
 + 
q«me_nuls
 > 255)

84 
bam_Àn
 = 
q«me_Àn
 + 
q«me_nuls
 + 
ncig¨
*4 + (
Àn
+1)/2 +Üí + 
exåa_Àn
;

85 i‡(
b
->
m_d©a
 < 
bam_Àn
) {

86 
b
->
m_d©a
 = 
bam_Àn
;

87 
	`kroundup32
(
b
->
m_d©a
);

88 
b
->
d©a
 = (
uöt8_t
*)
	`ªÆloc
(b->d©a, b->
m_d©a
);

89 i‡(!
b
->
d©a
)

92 
b
->
l_d©a
 = 
bam_Àn
;

94 
b
->
c‹e
.
tid
 = 
∫ame
;

95 
b
->
c‹e
.
pos
 =Öos-1;

96 
b
->
c‹e
.
bö
 = 
	`bam_ªg2bö
(
pos
-1, 
íd
);

97 
b
->
c‹e
.
quÆ
 = 
m≠q
;

98 
b
->
c‹e
.
l_q«me
 = 
q«me_Àn
+
q«me_nuls
;

99 
b
->
c‹e
.
l_exå™ul
 = 
q«me_nuls
-1;

100 
b
->
c‹e
.
Êag
 = flag;

101 
b
->
c‹e
.
n_cig¨
 = 
ncig¨
;

102 
b
->
c‹e
.
l_q£q
 = 
Àn
;

103 
b
->
c‹e
.
mtid
 = 
m∫m
;

104 
b
->
c‹e
.
mpos
 = mpos-1;

105 
b
->
c‹e
.
isize
 = isize;

107 
˝
 = 
b
->
d©a
;

109 
	`°∫˝y
((*)
˝
, 
q«me
, 
q«me_Àn
);

110 
i
 = 0; i < 
q«me_nuls
; i++)

111 
˝
[
q«me_Àn
+
i
] = '\0';

112 
˝
 +
q«me_Àn
+
q«me_nuls
;

113 i‡(
ncig¨
 > 0Ë
	`mem˝y
(
˝
, 
cig¨
,Çcigar*4);

114 
˝
 +
ncig¨
*4;

116 
i
 = 0; i+1 < 
Àn
; i+=2) {

117 *
˝
++ = (
L
[(
uc
)
£q
[
i
]]<<4) + L[(uc)seq[i+1]];

119 i‡(
i
 < 
Àn
)

120 *
˝
++ = 
L
[(
uc
)
£q
[
i
]]<<4;

122 i‡(
quÆ
)

123 
	`mem˝y
(
˝
, 
quÆ
, 
Àn
);

125 
	`mem£t
(
˝
, '\xff', 
Àn
);

128 
	}
}

130 
bam_hdr_t
 *
	$¸am_hódî_to_bam
(
SAM_hdr
 *
h
) {

131 
i
;

132 
bam_hdr_t
 *
hódî
 = 
	`bam_hdr_öô
();

134 
hódî
->
l_ãxt
 = 
	`ks_Àn
(&
h
->
ãxt
);

135 
hódî
->
ãxt
 = 
	`mÆloc
(hódî->
l_ãxt
+1);

136 
	`mem˝y
(
hódî
->
ãxt
, 
	`ks_°r
(&
h
->ãxt), hódî->
l_ãxt
);

137 
hódî
->
ãxt
[hódî->
l_ãxt
] = 0;

139 
hódî
->
n_èrgës
 = 
h
->
ƒef
;

140 
hódî
->
èrgë_«me
 = (**)
	`ˇŒoc
(hódî->
n_èrgës
,

142 
hódî
->
èrgë_Àn
 = (
uöt32_t
 *)
	`ˇŒoc
(hódî->
n_èrgës
, 4);

144 
i
 = 0; i < 
h
->
ƒef
; i++) {

145 
hódî
->
èrgë_«me
[
i
] = 
	`°rdup
(
h
->
ªf
[i].
«me
);

146 
hódî
->
èrgë_Àn
[
i
] = 
h
->
ªf
[i].
Àn
;

149  
hódî
;

150 
	}
}

152 
SAM_hdr
 *
	$bam_hódî_to_¸am
(
bam_hdr_t
 *
h
) {

153  
	`ßm_hdr_∑r£_
(
h
->
ãxt
, h->
l_ãxt
);

154 
	}
}

	@htslib/cram/cram_samtools.h

31 #i‚de‡
_CRAM_SAMTOOLS_H_


32 
	#_CRAM_SAMTOOLS_H_


	)

35 
	#bam_blk_size
(
b
Ë((b)->
l_d©a
)

	)

36 
	#bam_£t_blk_size
(
b
,
v
Ë((b)->
d©a_Àn
 = (v))

	)

38 
	#bam_ªf
(
b
Ë(b)->
c‹e
.
tid


	)

39 
	#bam_pos
(
b
Ë(b)->
c‹e
.
pos


	)

40 
	#bam_m©e_pos
(
b
Ë(b)->
c‹e
.
mpos


	)

41 
	#bam_m©e_ªf
(
b
Ë(b)->
c‹e
.
mtid


	)

42 
	#bam_ös_size
(
b
Ë(b)->
c‹e
.
isize


	)

43 
	#bam_£q_Àn
(
b
Ë(b)->
c‹e
.
l_q£q


	)

44 
	#bam_cig¨_Àn
(
b
Ë(b)->
c‹e
.
n_cig¨


	)

45 
	#bam_Êag
(
b
Ë(b)->
c‹e
.
Êag


	)

46 
	#bam_bö
(
b
Ë(b)->
c‹e
.
bö


	)

47 
	#bam_m≠_quÆ
(
b
Ë(b)->
c‹e
.
quÆ


	)

48 
	#bam_«me_Àn
(
b
Ë((b)->
c‹e
.
l_q«me
 - (b)->c‹e.
l_exå™ul
)

	)

49 
	#bam_«me
(
b
Ë
	`bam_gë_q«me
((b))

	)

50 
	#bam_quÆ
(
b
Ë
	`bam_gë_quÆ
((b))

	)

51 
	#bam_£q
(
b
Ë
	`bam_gë_£q
((b))

	)

52 
	#bam_cig¨
(
b
Ë
	`bam_gë_cig¨
((b))

	)

53 
	#bam_aux
(
b
Ë
	`bam_gë_aux
((b))

	)

55 
	#bam_dup
(
b
Ë
	`bam_c›y1
(
	`bam_öô1
(), (b))

	)

57 
	#bam_‰ì
(
b
Ë
	`bam_de°roy1
((b))

	)

59 
	#bam_ªg2bö
(
beg
,
íd
Ë
	`hts_ªg2bö
((beg),”nd),14,5)

	)

61 
	~"ht¶ib/ßm.h
"

63 
	ecig¨_›
 {

64 
	mBAM_CMATCH_
=
BAM_CMATCH
,

65 
	mBAM_CINS_
=
BAM_CINS
,

66 
	mBAM_CDEL_
=
BAM_CDEL
,

67 
	mBAM_CREF_SKIP_
=
BAM_CREF_SKIP
,

68 
	mBAM_CSOFT_CLIP_
=
BAM_CSOFT_CLIP
,

69 
	mBAM_CHARD_CLIP_
=
BAM_CHARD_CLIP
,

70 
	mBAM_CPAD_
=
BAM_CPAD
,

71 
	mBAM_CBASE_MATCH
=
BAM_CEQUAL
,

72 
	mBAM_CBASE_MISMATCH
=
BAM_CDIFF


75 
bam1_t
 
	tbam_£q_t
;

77 
	~"¸am/ßm_hódî.h
"

79 #ifde‡
__˝lu•lus


83 
bam_hdr_t
 *
¸am_hódî_to_bam
(
SAM_hdr
 *
h
);

84 
SAM_hdr
 *
bam_hódî_to_¸am
(
bam_hdr_t
 *
h
);

86 
bam_c⁄°ru˘_£q
(
bam_£q_t
 **
bp
, 
size_t
 
exåa_Àn
,

87 c⁄° *
q«me
, 
size_t
 
q«me_Àn
,

88 
Êag
,

89 
∫ame
,

90 
pos
,

91 
íd
,

92 
m≠q
,

93 
uöt32_t
 
ncig¨
, c⁄° uöt32_à*
cig¨
,

94 
m∫m
,

95 
mpos
,

96 
isize
,

97 
Àn
,

98 c⁄° *
£q
,

99 c⁄° *
quÆ
);

101 #ifde‡
__˝lu•lus


	@htslib/cram/cram_stats.c

31 
	~<c⁄fig.h
>

33 
	~<°dio.h
>

34 
	~<î∫o.h
>

35 
	~<as£π.h
>

36 
	~<°dlib.h
>

37 
	~<°rög.h
>

38 
	~<zlib.h
>

39 
	~<sys/ty≥s.h
>

40 
	~<sys/°©.h
>

41 
	~<m©h.h
>

43 
	~"¸am/¸am.h
"

44 
	~"¸am/os.h
"

46 
¸am_°©s
 *
	$¸am_°©s_¸óã
() {

47  
	`ˇŒoc
(1, (
¸am_°©s
));

48 
	}
}

50 
	$¸am_°©s_add
(
¸am_°©s
 *
°
, 
öt32_t
 
vÆ
) {

51 
°
->
nßmp
++;

55 i‡(
vÆ
 < 
MAX_STAT_VAL
 && val >= 0) {

56 
°
->
‰eqs
[
vÆ
]++;

58 
khöt_t
 
k
;

59 
r
;

61 i‡(!
°
->
h
) {

62 
°
->
h
 = 
	`kh_öô
(
m_i2i
);

65 
k
 = 
	`kh_put
(
m_i2i
, 
°
->
h
, 
vÆ
, &
r
);

66 i‡(
r
 == 0)

67 
	`kh_vÆ
(
°
->
h
, 
k
)++;

68 i‡(
r
 != -1)

69 
	`kh_vÆ
(
°
->
h
, 
k
) = 1;

73 
	}
}

75 
	$¸am_°©s_dñ
(
¸am_°©s
 *
°
, 
öt32_t
 
vÆ
) {

76 
°
->
nßmp
--;

80 i‡(
vÆ
 < 
MAX_STAT_VAL
 && val >= 0) {

81 
°
->
‰eqs
[
vÆ
]--;

82 
	`as£π
(
°
->
‰eqs
[
vÆ
] >= 0);

83 } i‡(
°
->
h
) {

84 
khöt_t
 
k
 = 
	`kh_gë
(
m_i2i
, 
°
->
h
, 
vÆ
);

86 i‡(
k
 !
	`kh_íd
(
°
->
h
)) {

87 i‡(--
	`kh_vÆ
(
°
->
h
, 
k
) == 0)

88 
	`kh_dñ
(
m_i2i
, 
°
->
h
, 
k
);

90 
	`Ârötf
(
°dîr
, "FaûedÅÿªmovêvÆ %d from cøm_°©s\n", 
vÆ
);

91 
°
->
nßmp
++;

94 
	`Ârötf
(
°dîr
, "FaûedÅÿªmovêvÆ %d from cøm_°©s\n", 
vÆ
);

95 
°
->
nßmp
++;

97 
	}
}

99 
	$¸am_°©s_dump
(
¸am_°©s
 *
°
) {

100 
i
;

101 
	`Ârötf
(
°dîr
, "cram_stats:\n");

102 
i
 = 0; i < 
MAX_STAT_VAL
; i++) {

103 i‡(!
°
->
‰eqs
[
i
])

105 
	`Ârötf
(
°dîr
, "\t%d\t%d\n", 
i
, 
°
->
‰eqs
[i]);

107 i‡(
°
->
h
) {

108 
khöt_t
 
k
;

109 
k
 = 
	`kh_begö
(
°
->
h
); k !
	`kh_íd
(st->h); k++) {

110 i‡(!
	`kh_exi°
(
°
->
h
, 
k
))

113 
	`Ârötf
(
°dîr
, "\t%d\t%d\n", 
	`kh_key
(
°
->
h
, 
k
), 
	`kh_vÆ
(st->h, k));

116 
	}
}

127 
¸am_ícodög
 
	$¸am_°©s_ícodög
(
¸am_fd
 *
fd
, 
¸am_°©s
 *
°
) {

128 
nvÆs
, 
i
, 
¡Ÿ
 = 0, 
max_vÆ
 = 0, 
mö_vÆ
 = 
INT_MAX
;

129 *
vÆs
 = 
NULL
, *
‰eqs
 = NULL, 
vÆs_Æloc
 = 0;

134 
nvÆs
 = 
i
 = 0; i < 
MAX_STAT_VAL
; i++) {

135 i‡(!
°
->
‰eqs
[
i
])

137 i‡(
nvÆs
 >
vÆs_Æloc
) {

138 
vÆs_Æloc
 = vals_alloc ? vals_alloc*2 : 1024;

139 
vÆs
 = 
	`ªÆloc
(vÆs, 
vÆs_Æloc
 * ());

140 
‰eqs
 = 
	`ªÆloc
(‰eqs, 
vÆs_Æloc
 * ());

141 i‡(!
vÆs
 || !
‰eqs
) {

142 i‡(
vÆs
Ë
	`‰ì
(vals);

143 i‡(
‰eqs
Ë
	`‰ì
(freqs);

144  
E_HUFFMAN
;

147 
vÆs
[
nvÆs
] = 
i
;

148 
‰eqs
[
nvÆs
] = 
°
->‰eqs[
i
];

149 
¡Ÿ
 +
‰eqs
[
nvÆs
];

150 i‡(
max_vÆ
 < 
i
) max_val = i;

151 i‡(
mö_vÆ
 > 
i
) min_val = i;

152 
nvÆs
++;

154 i‡(
°
->
h
) {

155 
khöt_t
 
k
;

156 
i
;

158 
k
 = 
	`kh_begö
(
°
->
h
); k !
	`kh_íd
(st->h); k++) {

159 i‡(!
	`kh_exi°
(
°
->
h
, 
k
))

162 i‡(
nvÆs
 >
vÆs_Æloc
) {

163 
vÆs_Æloc
 = vals_alloc ? vals_alloc*2 : 1024;

164 
vÆs
 = 
	`ªÆloc
(vÆs, 
vÆs_Æloc
 * ());

165 
‰eqs
 = 
	`ªÆloc
(‰eqs, 
vÆs_Æloc
 * ());

166 i‡(!
vÆs
 || !
‰eqs
)

167  
E_HUFFMAN
;

169 
i
 = 
	`kh_key
(
°
->
h
, 
k
);

170 
vÆs
[
nvÆs
]=
i
;

171 
‰eqs
[
nvÆs
] = 
	`kh_vÆ
(
°
->
h
, 
k
);

172 
¡Ÿ
 +
‰eqs
[
nvÆs
];

173 i‡(
max_vÆ
 < 
i
) max_val = i;

174 i‡(
mö_vÆ
 > 
i
) min_val = i;

175 
nvÆs
++;

179 
°
->
nvÆs
 =Çvals;

180 
	`as£π
(
¡Ÿ
 =
°
->
nßmp
);

182 
	`‰ì
(
vÆs
);

183 
	`‰ì
(
‰eqs
);

189  
nvÆs
 <1 ? 
E_HUFFMAN
 : 
E_EXTERNAL
;

190 
	}
}

192 
	$¸am_°©s_‰ì
(
¸am_°©s
 *
°
) {

193 i‡(
°
->
h
)

194 
	`kh_de°roy
(
m_i2i
, 
°
->
h
);

195 
	`‰ì
(
°
);

196 
	}
}

	@htslib/cram/cram_stats.h

31 #i‚de‡
_CRAM_STATS_H_


32 
	#_CRAM_STATS_H_


	)

34 #ifde‡
__˝lu•lus


38 
¸am_°©s
 *
¸am_°©s_¸óã
();

39 
¸am_°©s_add
(
¸am_°©s
 *
°
, 
öt32_t
 
vÆ
);

40 
¸am_°©s_dñ
(
¸am_°©s
 *
°
, 
öt32_t
 
vÆ
);

41 
¸am_°©s_dump
(
¸am_°©s
 *
°
);

42 
¸am_°©s_‰ì
(
¸am_°©s
 *
°
);

53 
¸am_ícodög
 
¸am_°©s_ícodög
(
¸am_fd
 *
fd
, 
¸am_°©s
 *
°
);

55 #ifde‡
__˝lu•lus


	@htslib/cram/cram_structs.h

31 #i‚de‡
_CRAM_STRUCTS_H_


32 
	#_CRAM_STRUCTS_H_


	)

49 
	~<±hªad.h
>

50 
	~<°döt.h
>

51 
	~<sys/ty≥s.h
>

53 
	~"ht¶ib/thªad_poﬁ.h
"

54 
	~"¸am/°rög_Æloc.h
"

55 
	~"¸am/mFILE.h
"

56 
	~"ht¶ib/khash.h
"

58 #ifde‡
__˝lu•lus


63 
KHASH_MAP_INIT_INT
(
m_i2i
, )

66 
KHASH_SET_INIT_INT
(
s_i2i
)

69 
	tuc
;

75 
i
;

76 *
p
;

77 } 
	tpm≠_t
;

82 
KHASH_MAP_INIT_STR
(
m≠
, 
pm≠_t
)

84 
hFILE
;

86 
	#SEQS_PER_SLICE
 10000

	)

87 
	#BASES_PER_SLICE
 (
SEQS_PER_SLICE
*500)

	)

88 
	#SLICE_PER_CNT
 1

	)

90 
	#CRAM_SUBST_MATRIX
 "CGTNAGTNACTNACGNACGT"

	)

92 
	#MAX_STAT_VAL
 1024

	)

94 
	s¸am_°©s
 {

95 
‰eqs
[
MAX_STAT_VAL
];

96 
khash_t
(
m_i2i
Ë*
h
;

97 
nßmp
;

98 
nvÆs
;

99 } 
	t¸am_°©s
;

102 
	e¸am_ícodög
 {

103 
E_NULL
 = 0,

104 
E_EXTERNAL
 = 1,

105 
E_GOLOMB
 = 2,

106 
E_HUFFMAN
 = 3,

107 
E_BYTE_ARRAY_LEN
 = 4,

108 
E_BYTE_ARRAY_STOP
 = 5,

109 
E_BETA
 = 6,

110 
E_SUBEXP
 = 7,

111 
E_GOLOMB_RICE
 = 8,

112 
E_GAMMA
 = 9,

113 
E_NUM_CODECS
 = 10,

116 
	e¸am_exã∫Æ_ty≥
 {

117 
E_INT
 = 1,

118 
E_LONG
 = 2,

119 
E_BYTE
 = 3,

120 
E_BYTE_ARRAY
 = 4,

121 
E_BYTE_ARRAY_BLOCK
 = 5,

125 
	e¸am_DS_ID
 {

126 
DS_CORE
 = 0,

127 
DS_aux
 = 1,

128 
DS_aux_OQ
 = 2,

129 
DS_aux_BQ
 = 3,

130 
DS_aux_BD
 = 4,

131 
DS_aux_BI
 = 5,

132 
DS_aux_FZ
 = 6,

133 
DS_aux_oq
 = 7,

134 
DS_aux_os
 = 8,

135 
DS_aux_oz
 = 9,

136 
DS_ªf
,

137 
DS_RN
,

138 
DS_QS
,

139 
DS_IN
,

140 
DS_SC
,

142 
DS_BF
,

143 
DS_CF
,

144 
DS_AP
,

145 
DS_RG
,

146 
DS_MQ
,

147 
DS_NS
,

148 
DS_MF
,

149 
DS_TS
,

150 
DS_NP
,

151 
DS_NF
,

152 
DS_RL
,

153 
DS_FN
,

154 
DS_FC
,

155 
DS_FP
,

156 
DS_DL
,

157 
DS_BA
,

158 
DS_BS
,

159 
DS_TL
,

160 
DS_RI
,

161 
DS_RS
,

162 
DS_PD
,

163 
DS_HC
,

164 
DS_BB
,

165 
DS_QQ
,

167 
DS_TN
,

169 
DS_RN_Àn
,

170 
DS_SC_Àn
,

171 
DS_BB_Àn
,

172 
DS_QQ_Àn
,

174 
DS_TC
,

175 
DS_TM
,

176 
DS_TV
,

178 
DS_END
,

182 
	s¸am_fûe_def
 {

183 
magic
[4];

184 
uöt8_t
 
maj‹_vîsi⁄
;

185 
uöt8_t
 
mö‹_vîsi⁄
;

186 
fûe_id
[20];

187 } 
	t¸am_fûe_def
;

189 
	#CRAM_MAJOR_VERS
(
v
Ë((vË>> 8)

	)

190 
	#CRAM_MINOR_VERS
(
v
Ë((vË& 0xff)

	)

192 
¸am_¶i˚
;

194 
	e¸am_block_mëhod
 {

195 
ERROR
 = -1,

196 
RAW
 = 0,

197 
GZIP
 = 1,

198 
BZIP2
 = 2,

199 
LZMA
 = 3,

200 
RANS
 = 4,

201 
RANS0
 = 4,

202 
RANS1
 = 10,

203 
GZIP_RLE
 = 11,

206 
	e¸am_c⁄ã¡_ty≥
 {

207 
CT_ERROR
 = -1,

208 
FILE_HEADER
 = 0,

209 
COMPRESSION_HEADER
 = 1,

210 
MAPPED_SLICE
 = 2,

211 
UNMAPPED_SLICE
 = 3,

212 
EXTERNAL
 = 4,

213 
CORE
 = 5,

219 
åül
;

220 
√xt_åül
;

223 
sz_gz_æe
;

224 
sz_gz_def
;

225 
sz_øns0
;

226 
sz_øns1
;

227 
sz_bzù2
;

228 
sz_lzma
;

231 
mëhod
;

232 
°øt
;

235 
gz_æe_˙t
;

236 
gz_def_˙t
;

237 
øns0_˙t
;

238 
øns1_˙t
;

239 
bzù2_˙t
;

240 
lzma_˙t
;

241 
ªvi£d_mëhod
;

243 
gz_æe_exåa
;

244 
gz_def_exåa
;

245 
øns0_exåa
;

246 
øns1_exåa
;

247 
bzù2_exåa
;

248 
lzma_exåa
;

249 } 
	t¸am_mërics
;

252 
KHASH_MAP_INIT_INT
(
m_mërics
, 
¸am_mërics
*)

256 
	s¸am_block
 {

257 
¸am_block_mëhod
 
mëhod
, 
‹ig_mëhod
;

258 
¸am_c⁄ã¡_ty≥
 
c⁄ã¡_ty≥
;

259 
öt32_t
 
c⁄ã¡_id
;

260 
öt32_t
 
comp_size
;

261 
öt32_t
 
uncomp_size
;

262 
uöt32_t
 
¸c32
;

263 
öt32_t
 
idx
;

264 *
d©a
;

267 
size_t
 
Æloc
;

268 
size_t
 
byã
;

269 
bô
;

272 
¸am_mërics
 *
m
;

273 } 
	t¸am_block
;

275 
¸am_codec
;

276 
¸am_m≠
;

278 
	#CRAM_MAP_HASH
 32

	)

279 
	#CRAM_MAP
(
a
,
b
Ë((◊)*3+(b))&(
CRAM_MAP_HASH
-1))

	)

282 
	s¸am_block_com¥essi⁄_hdr
 {

283 
öt32_t
 
ªf_£q_id
;

284 
öt32_t
 
ªf_£q_°¨t
;

285 
öt32_t
 
ªf_£q_•™
;

286 
öt32_t
 
num_ªc‹ds
;

287 
öt32_t
 
num_œndm¨ks
;

288 
öt32_t
 *
œndm¨k
;

291 
m≠≥d_qs_ö˛uded
;

292 
unm≠≥d_qs_ö˛uded
;

293 
unm≠≥d_∂a˚d
;

294 
qs_ö˛uded
;

295 
ªad_«mes_ö˛uded
;

296 
AP_dñè
;

298 
sub°ôuti⁄_m©rix
[5][4];

301 
¸am_block
 *
TD_blk
;

302 
nTL
;

303 **
TL
;

304 
khash_t
(
m_s2i
Ë*
TD_hash
;

305 
°rög_Æloc_t
 *
TD_keys
;

307 
khash_t
(
m≠
Ë*
¥e£rv©i⁄_m≠
;

308 
¸am_m≠
 *
ªc_ícodög_m≠
[
CRAM_MAP_HASH
];

309 
¸am_m≠
 *
èg_ícodög_m≠
[
CRAM_MAP_HASH
];

311 
¸am_codec
 *
codecs
[
DS_END
];

313 *
uncomp
;

314 
size_t
 
uncomp_size
, 
uncomp_Æloc
;

316 
d©a_£rõs
;

317 } 
	t¸am_block_com¥essi⁄_hdr
;

319 
	s¸am_m≠
 {

320 
key
;

321 
¸am_ícodög
 
ícodög
;

322 
off£t
;

323 
size
;

324 
¸am_codec
 *
codec
;

325 
¸am_m≠
 *
√xt
;

326 } 
	t¸am_m≠
;

328 
	s¸am_èg_m≠
 {

329 
¸am_codec
 *
codec
;

330 
¸am_block
 *
blk
;

331 
¸am_mërics
 *
m
;

332 } 
	t¸am_èg_m≠
;

335 
KHASH_MAP_INIT_INT
(
m_ègm≠
, 
¸am_èg_m≠
*)

338 
	s¸am_block_¶i˚_hdr
 {

339 
¸am_c⁄ã¡_ty≥
 
c⁄ã¡_ty≥
;

340 
öt32_t
 
ªf_£q_id
;

341 
öt32_t
 
ªf_£q_°¨t
;

342 
öt32_t
 
ªf_£q_•™
;

343 
öt32_t
 
num_ªc‹ds
;

344 
öt64_t
 
ªc‹d_cou¡î
;

345 
öt32_t
 
num_blocks
;

346 
öt32_t
 
num_c⁄ã¡_ids
;

347 
öt32_t
 *
block_c⁄ã¡_ids
;

348 
öt32_t
 
ªf_ba£_id
;

349 
md5
[16];

350 } 
	t¸am_block_¶i˚_hdr
;

352 
ªf_íåy
;

363 
	s¸am_c⁄èöî
 {

364 
öt32_t
 
Àngth
;

365 
öt32_t
 
ªf_£q_id
;

366 
öt32_t
 
ªf_£q_°¨t
;

367 
öt32_t
 
ªf_£q_•™
;

368 
öt64_t
 
ªc‹d_cou¡î
;

369 
öt64_t
 
num_ba£s
;

370 
öt32_t
 
num_ªc‹ds
;

371 
öt32_t
 
num_blocks
;

372 
öt32_t
 
num_œndm¨ks
;

373 
öt32_t
 *
œndm¨k
;

376 
size_t
 
off£t
;

379 
¸am_block_com¥essi⁄_hdr
 *
comp_hdr
;

380 
¸am_block
 *
comp_hdr_block
;

383 
max_¶i˚
, 
cuº_¶i˚
;

384 
max_ªc
, 
cuº_ªc
;

385 
max_c_ªc
, 
cuº_c_ªc
;

386 
¶i˚_ªc
;

387 
cuº_ªf
;

388 
œ°_pos
;

389 
¸am_¶i˚
 **
¶i˚s
, *
¶i˚
;

390 
pos_s‹ãd
;

391 
max_≠os
;

392 
œ°_¶i˚
;

393 
mu…i_£q
;

394 
uns‹ãd
;

397 
ªf_°¨t
, 
fú°_ba£
, 
œ°_ba£
, 
ªf_id
, 
ªf_íd
;

398 *
ªf
;

402 
bam_£q_t
 **
bams
;

405 
¸am_°©s
 *
°©s
[
DS_END
];

407 
khash_t
(
m_ègm≠
Ë*
ègs_u£d
;

408 *
ªfs_u£d
;

410 
uöt32_t
 
¸c32
;

412 
uöt64_t
 
s_num_ba£s
;

413 } 
	t¸am_c⁄èöî
;

418 
	s¸am_ªc‹d
 {

419 
¸am_¶i˚
 *
s
;

421 
öt32_t
 
ªf_id
;

422 
öt32_t
 
Êags
;

423 
öt32_t
 
¸am_Êags
;

424 
öt32_t
 
Àn
;

425 
öt32_t
 
≠os
;

426 
öt32_t
 
rg
;

427 
öt32_t
 
«me
;

428 
öt32_t
 
«me_Àn
;

429 
öt32_t
 
m©e_löe
;

430 
öt32_t
 
m©e_ªf_id
;

431 
öt32_t
 
m©e_pos
;

432 
öt32_t
 
éí
;

435 
öt32_t
 
¡ags
;

436 
öt32_t
 
aux
;

437 
öt32_t
 
aux_size
;

438 #i‚de‡
TN_exã∫Æ


439 
öt32_t
 
TN_idx
;

441 
öt32_t
 
ä
;

443 
TL
;

445 
öt32_t
 
£q
;

446 
öt32_t
 
quÆ
;

447 
öt32_t
 
cig¨
;

448 
öt32_t
 
ncig¨
;

449 
öt32_t
 
´nd
;

450 
öt32_t
 
mquÆ
;

452 
öt32_t
 
„©uª
;

453 
öt32_t
 
n„©uª
;

454 
öt32_t
 
m©e_Êags
;

455 } 
	t¸am_ªc‹d
;

458 
	#¸am_q«me
(
c
Ë(&(c)->
s
->
«me_blk
->
d©a
[(c)->
«me
])

	)

459 
	#¸am_£q
(
c
Ë(&(c)->
s
->
£qs_blk
->
d©a
[(c)->
£q
])

	)

460 
	#¸am_quÆ
(
c
Ë(&(c)->
s
->
quÆ_blk
->
d©a
[(c)->
quÆ
])

	)

461 
	#¸am_aux
(
c
Ë(&(c)->
s
->
aux_blk
->
d©a
[(c)->
aux
])

	)

462 
	#¸am_£qi
(
c
,
i
Ë(
	`¸am_£q
((c))[(i)])

	)

463 
	#¸am_«me_Àn
(
c
Ë((c)->
«me_Àn
)

	)

464 
	#¸am_°ønd
(
c
Ë(((c)->
Êags
 & 
BAM_FREVERSE
Ë!0)

	)

465 
	#¸am_m°ønd
(
c
Ë(((c)->
Êags
 & 
BAM_FMREVERSE
Ë!0)

	)

466 
	#¸am_cig¨
(
c
Ë(&((
¸
)->
s
->
cig¨
)[(c)->cig¨])

	)

472 
	s¸am_„©uª
 {

475 
pos
;

476 
code
;

477 
ba£
;

478 } 
X
;

480 
pos
;

481 
code
;

482 
ba£
;

483 
quÆ
;

484 } 
B
;

486 
pos
;

487 
code
;

488 
£q_idx
;

489 
Àn
;

490 } 
b
;

492 
pos
;

493 
code
;

494 
quÆ
;

495 } 
Q
;

497 
pos
;

498 
code
;

499 
Àn
;

500 
£q_idx
;

501 } 
S
;

503 
pos
;

504 
code
;

505 
Àn
;

506 
£q_idx
;

507 } 
I
;

509 
pos
;

510 
code
;

511 
ba£
;

512 } 
i
;

514 
pos
;

515 
code
;

516 
Àn
;

517 } 
D
;

519 
pos
;

520 
code
;

521 
Àn
;

522 } 
N
;

524 
pos
;

525 
code
;

526 
Àn
;

527 } 
P
;

529 
pos
;

530 
code
;

531 
Àn
;

532 } 
H
;

534 } 
	t¸am_„©uª
;

541 
	s¸am_¶i˚
 {

542 
¸am_block_¶i˚_hdr
 *
hdr
;

543 
¸am_block
 *
hdr_block
;

544 
¸am_block
 **
block
;

545 
¸am_block
 **
block_by_id
;

548 
œ°_≠os
, 
max_≠os
;

551 
¸am_ªc‹d
 *
¸ecs
;

556 
uöt32_t
 *
cig¨
;

557 
uöt32_t
 
cig¨_Æloc
;

558 
uöt32_t
 
ncig¨
;

560 
¸am_„©uª
 *
„©uªs
;

561 
n„©uªs
;

562 
a„©uªs
;

564 #i‚de‡
TN_exã∫Æ


566 
uöt32_t
 *
TN
;

567 
nTN
, 
aTN
;

569 
¸am_block
 *
ä_blk
;

570 
ä_id
;

574 
¸am_block
 *
«me_blk
;

575 
¸am_block
 *
£qs_blk
;

576 
¸am_block
 *
quÆ_blk
;

577 
¸am_block
 *
ba£_blk
;

578 
¸am_block
 *
so·_blk
;

579 
¸am_block
 *
aux_blk
;

581 
°rög_Æloc_t
 *
∑ú_keys
;

582 
khash_t
(
m_s2i
Ë*
∑ú
[2];

584 *
ªf
;

585 
ªf_°¨t
;

586 
ªf_íd
;

587 
ªf_id
;

590 
«ux_block
;

591 
¸am_block
 **
aux_block
;

592 } 
	t¸am_¶i˚
;

598 
	sªf_íåy
 {

599 *
«me
;

600 *
‚
;

601 
öt64_t
 
Àngth
;

602 
öt64_t
 
off£t
;

603 
ba£s_≥r_löe
;

604 
löe_Àngth
;

605 
öt64_t
 
cou¡
;

606 *
£q
;

607 
mFILE
 *
mf
;

608 
is_md5
;

609 } 
	tªf_íåy
;

611 
KHASH_MAP_INIT_STR
(
ªfs
, 
ªf_íåy
*)

615 
°rög_Æloc_t
 *
poﬁ
;

617 
khash_t
(
ªfs
Ë*
h_mëa
;

618 
ªf_íåy
 **
ªf_id
;

619 
ƒef
;

621 *
‚
;

622 
BGZF
 *
Â
;

624 
cou¡
;

626 
±hªad_muãx_t
 
lock
;

627 
ªf_íåy
 *
œ°
;

628 
œ°_id
;

629 } 
	tªfs_t
;

645 
	s¸am_ödex
 {

646 
n¶i˚
, 
«Œoc
;

647 
¸am_ödex
 *
e
;

649 
ªfid
;

650 
°¨t
;

651 
íd
;

652 
n£q
;

653 
¶i˚
;

654 
Àn
;

655 
öt64_t
 
off£t
;

656 } 
	t¸am_ödex
;

659 
ªfid
;

660 
°¨t
;

661 
íd
;

662 } 
	t¸am_ønge
;

668 
	s•¨e_bams
 {

669 
bam_£q_t
 **
bams
;

670 
•¨e_bams
 *
√xt
;

671 } 
	t•¨e_bams
;

673 
	s¸am_fd
 {

674 
hFILE
 *
Â
;

675 
mode
;

676 
vîsi⁄
;

677 
¸am_fûe_def
 *
fûe_def
;

678 
SAM_hdr
 *
hódî
;

680 *
¥efix
;

681 
öt64_t
 
ªc‹d_cou¡î
;

682 
îr
;

689 
¸am_c⁄èöî
 *
˘r
;

692 
fú°_ba£
, 
œ°_ba£
;

695 
ªfs_t
 *
ªfs
;

696 *
ªf
, *
ªf_‰ì
;

697 
ªf_id
;

698 
ªf_°¨t
;

699 
ªf_íd
;

700 *
ªf_‚
;

703 
Àvñ
;

704 
¸am_mërics
 *
m
[
DS_END
];

705 
khash_t
(
m_mërics
Ë*
ègs_u£d
;

708 
decode_md
;

709 
vîbo£
;

710 
£qs_≥r_¶i˚
;

711 
ba£s_≥r_¶i˚
;

712 
¶i˚s_≥r_c⁄èöî
;

713 
embed_ªf
;

714 
no_ªf
;

715 
ign‹e_md5
;

716 
u£_bz2
;

717 
u£_øns
;

718 
u£_lzma
;

719 
sh¨ed_ªf
;

720 
ªquúed_fõlds
;

721 
¸am_ønge
 
ønge
;

724 
bam_Êag_sw≠
[0x1000];

725 
¸am_Êag_sw≠
[0x1000];

726 
L1
[256];

727 
L2
[256];

728 
¸am_sub_m©rix
[32][32];

730 
ödex_sz
;

731 
¸am_ödex
 *
ödex
;

732 
off_t
 
fú°_c⁄èöî
;

733 
eof
;

734 
œ°_¶i˚
;

735 
mu…i_£q
;

736 
uns‹ãd
;

737 
em±y_c⁄èöî
;

740 
own_poﬁ
;

741 
hts_çoﬁ
 *
poﬁ
;

742 
hts_çoﬁ_¥o˚ss
 *
rqueue
;

743 
±hªad_muãx_t
 
mërics_lock
;

744 
±hªad_muãx_t
 
ªf_lock
;

745 
•¨e_bams
 *
bl
;

746 
±hªad_muãx_t
 
bam_li°_lock
;

747 *
job_≥ndög
;

748 
ooc
;

750 
lossy_ªad_«mes
;

751 
éí_≠¥ox
;

752 
éí_zîo
;

753 } 
	t¸am_fd
;

756 
	e¸am_fõlds
 {

757 
CRAM_BF
 = 0x00000001,

758 
CRAM_AP
 = 0x00000002,

759 
CRAM_FP
 = 0x00000004,

760 
CRAM_RL
 = 0x00000008,

761 
CRAM_DL
 = 0x00000010,

762 
CRAM_NF
 = 0x00000020,

763 
CRAM_BA
 = 0x00000040,

764 
CRAM_QS
 = 0x00000080,

765 
CRAM_FC
 = 0x00000100,

766 
CRAM_FN
 = 0x00000200,

767 
CRAM_BS
 = 0x00000400,

768 
CRAM_IN
 = 0x00000800,

769 
CRAM_RG
 = 0x00001000,

770 
CRAM_MQ
 = 0x00002000,

771 
CRAM_TL
 = 0x00004000,

772 
CRAM_RN
 = 0x00008000,

773 
CRAM_NS
 = 0x00010000,

774 
CRAM_NP
 = 0x00020000,

775 
CRAM_TS
 = 0x00040000,

776 
CRAM_MF
 = 0x00080000,

777 
CRAM_CF
 = 0x00100000,

778 
CRAM_RI
 = 0x00200000,

779 
CRAM_RS
 = 0x00400000,

780 
CRAM_PD
 = 0x00800000,

781 
CRAM_HC
 = 0x01000000,

782 
CRAM_SC
 = 0x02000000,

783 
CRAM_BB
 = 0x04000000,

784 
CRAM_BB_Àn
 = 0x08000000,

785 
CRAM_QQ
 = 0x10000000,

786 
CRAM_QQ_Àn
 = 0x20000000,

787 
CRAM_aux
= 0x40000000,

788 
CRAM_ALL
= 0x7fffffff,

795 
	#CRAM_CIGAR
 (
CRAM_FN
 | 
CRAM_FP
 | 
CRAM_FC
 | 
CRAM_DL
 | 
CRAM_IN
 | \

796 
CRAM_SC
 | 
CRAM_HC
 | 
CRAM_PD
 | 
CRAM_RS
 | 
CRAM_RL
 | 
CRAM_BF
)

	)

798 
	#CRAM_SEQ
 (
CRAM_CIGAR
 | 
CRAM_BA
 | 
CRAM_BS
 | \

799 
CRAM_RL
 | 
CRAM_AP
 | 
CRAM_BB
)

	)

801 
	#CRAM_QUAL
 (
CRAM_CIGAR
 | 
CRAM_RL
 | 
CRAM_AP
 | 
CRAM_QS
 | 
CRAM_QQ
)

	)

805 
	#CRAM_FPAIRED
 256

	)

806 
	#CRAM_FPROPER_PAIR
 128

	)

807 
	#CRAM_FUNMAP
 64

	)

808 
	#CRAM_FREVERSE
 32

	)

809 
	#CRAM_FREAD1
 16

	)

810 
	#CRAM_FREAD2
 8

	)

811 
	#CRAM_FSECONDARY
 4

	)

812 
	#CRAM_FQCFAIL
 2

	)

813 
	#CRAM_FDUP
 1

	)

815 
	#DS_aux_S
 "\001"

	)

816 
	#DS_aux_OQ_S
 "\002"

	)

817 
	#DS_aux_BQ_S
 "\003"

	)

818 
	#DS_aux_BD_S
 "\004"

	)

819 
	#DS_aux_BI_S
 "\005"

	)

820 
	#DS_aux_FZ_S
 "\006"

	)

821 
	#DS_aux_oq_S
 "\007"

	)

822 
	#DS_aux_os_S
 "\010"

	)

823 
	#DS_aux_oz_S
 "\011"

	)

825 
	#CRAM_M_REVERSE
 1

	)

826 
	#CRAM_M_UNMAP
 2

	)

830 
	#CRAM_FLAG_PRESERVE_QUAL_SCORES
 (1<<0)

	)

831 
	#CRAM_FLAG_DETACHED
 (1<<1)

	)

832 
	#CRAM_FLAG_MATE_DOWNSTREAM
 (1<<2)

	)

833 
	#CRAM_FLAG_NO_SEQ
 (1<<3)

	)

834 
	#CRAM_FLAG_MASK
 ((1<<4)-1)

	)

837 
	#CRAM_FLAG_STATS_ADDED
 (1<<30)

	)

838 
	#CRAM_FLAG_DISCARD_NAME
 (1<<31)

	)

840 #ifde‡
__˝lu•lus


	@htslib/cram/files.c

32 
	~<c⁄fig.h
>

34 
	~"¸am/misc.h
"

36 
	~<sys/ty≥s.h
>

37 
	~<sys/°©.h
>

41 #i‚de‡
S_ISDIR


42 
	#S_ISDIR
(
m
Ë(((m)&
S_IFMT
Ë=
S_IFDIR
)

	)

44 #i‚de‡
S_ISREG


45 
	#S_ISREG
(
m
Ë(((m)&
S_IFMT
Ë=
S_IFREG
)

	)

48 
	$is_dúe˘‹y
(* 
‚
)

50 
°©
 
buf
;

51 i‡–
	`°©
(
‚
,&
buf
) )  0;

52  
	`S_ISDIR
(
buf
.
°_mode
);

53 
	}
}

55 
	$is_fûe
(* 
‚
)

57 
°©
 
buf
;

58 i‡–
	`°©
(
‚
,&
buf
) )  0;

59  
	`S_ISREG
(
buf
.
°_mode
);

60 
	}
}

62 
	$fûe_exi°s
(* 
‚
)

64 
°©
 
buf
;

65  ( 
	`°©
(
‚
,&
buf
) == 0);

66 
	}
}

68 
	$fûe_size
(* 
‚
)

70 
°©
 
buf
;

71 i‡–
	`°©
(
‚
,&
buf
) != 0)  0;

72  
buf
.
°_size
;

73 
	}
}

	@htslib/cram/mFILE.c

31 
	~<c⁄fig.h
>

33 
	~<°dio.h
>

34 
	~<°dlib.h
>

35 
	~<î∫o.h
>

36 
	~<°rög.h
>

37 
	~<sys/ty≥s.h
>

38 
	~<sys/°©.h
>

39 
	~<f˙é.h
>

40 
	~<uni°d.h
>

41 
	~<°d¨g.h
>

43 
	~"¸am/os.h
"

44 
	~"¸am/mFILE.h
"

45 
	~"¸am/vÀn.h
"

47 #ifde‡
HAVE_MMAP


48 
	~<sys/mm™.h
>

63 
mFILE
 *
	gm_ch™√l
[3];

74 *
	$mÊﬂd
(
FILE
 *
Â
, c⁄° *
‚
, 
size_t
 *
size
, 
bö¨y
) {

75 
°©
 
sb
;

76 *
d©a
 = 
NULL
;

77 
size_t
 
Æloˇãd
 = 0, 
u£d
 = 0;

78 
bufsize
 = 8192;

80 #ifde‡
_WIN32


81 i‡(
bö¨y
)

82 
	`_£tmode
(
	`_fûío
(
Â
), 
_O_BINARY
);

84 
	`_£tmode
(
	`_fûío
(
Â
), 
_O_TEXT
);

87 i‡(
‚
 && -1 !
	`°©
(‚, &
sb
)) {

88 
d©a
 = 
	`mÆloc
(
Æloˇãd
 = 
sb
.
°_size
);

89 
bufsize
 = 
sb
.
°_size
;

91 
‚
 = 
NULL
;

95 
size_t
 
Àn
;

96 i‡(
u£d
 + 
bufsize
 > 
Æloˇãd
) {

97 
Æloˇãd
 +
bufsize
;

98 
d©a
 = 
	`ªÆloc
(d©a, 
Æloˇãd
);

100 
Àn
 = 
	`‰ód
(
d©a
 + 
u£d
, 1, 
Æloˇãd
 - u£d, 
Â
);

101 i‡(
Àn
 > 0)

102 
u£d
 +
Àn
;

103 } !
	`„of
(
Â
Ë&& (
‚
 =
NULL
 || 
u£d
 < 
sb
.
°_size
));

105 *
size
 = 
u£d
;

107  
d©a
;

108 
	}
}

111 #ifde‡
HAVE_MMAP


118 
	$mfmm≠
(
mFILE
 *
mf
, 
FILE
 *
Â
, c⁄° *
‚
) {

119 
°©
 
sb
;

121 i‡(
	`°©
(
‚
, &
sb
) != 0)

124 
mf
->
size
 = 
sb
.
°_size
;

125 
mf
->
d©a
 = 
	`mm≠
(
NULL
, mf->
size
, 
PROT_READ
, 
MAP_SHARED
,

126 
	`fûío
(
Â
), 0);

128 i‡(!
mf
->
d©a
)

131 
mf
->
Ælo˚d
 = 0;

133 
	}
}

142 
mFILE
 *
	$m°dö
() {

143 i‡(
m_ch™√l
[0])

144  
m_ch™√l
[0];

146 
m_ch™√l
[0] = 
	`mf¸óã
(
NULL
, 0);

147 i‡(
NULL
 =
m_ch™√l
[0])  NULL;

148 
m_ch™√l
[0]->
Â
 = 
°dö
;

149  
m_ch™√l
[0];

150 
	}
}

152 
	$öô_m°dö
() {

153 
d⁄e_°dö
 = 0;

154 i‡(
d⁄e_°dö
)

157 
m_ch™√l
[0]->
d©a
 = 
	`mÊﬂd
(
°dö
, 
NULL
, &m_ch™√l[0]->
size
, 1);

158 
m_ch™√l
[0]->
mode
 = 
MF_READ
;

159 
d⁄e_°dö
 = 1;

160 
	}
}

167 
mFILE
 *
	$m°dout
() {

168 i‡(
m_ch™√l
[1])

169  
m_ch™√l
[1];

171 
m_ch™√l
[1] = 
	`mf¸óã
(
NULL
, 0);

172 i‡(
NULL
 =
m_ch™√l
[1])  NULL;

173 
m_ch™√l
[1]->
Â
 = 
°dout
;

174 
m_ch™√l
[1]->
mode
 = 
MF_WRITE
;

175  
m_ch™√l
[1];

176 
	}
}

183 
mFILE
 *
	$m°dîr
() {

184 i‡(
m_ch™√l
[2])

185  
m_ch™√l
[2];

187 
m_ch™√l
[2] = 
	`mf¸óã
(
NULL
, 0);

188 i‡(
NULL
 =
m_ch™√l
[2])  NULL;

189 
m_ch™√l
[2]->
Â
 = 
°dîr
;

190 
m_ch™√l
[2]->
mode
 = 
MF_WRITE
;

191  
m_ch™√l
[2];

192 
	}
}

198 
mFILE
 *
	$mf¸óã
(*
d©a
, 
size
) {

199 
mFILE
 *
mf
 = (mFILE *)
	`mÆloc
((*mf));

200 i‡(
NULL
 =
mf
)  NULL;

201 
mf
->
Â
 = 
NULL
;

202 
mf
->
d©a
 = data;

203 
mf
->
Ælo˚d
 = 
size
;

204 
mf
->
size
 = size;

205 
mf
->
eof
 = 0;

206 
mf
->
off£t
 = 0;

207 
mf
->
Êush_pos
 = 0;

208 
mf
->
mode
 = 
MF_READ
 | 
MF_WRITE
;

209  
mf
;

210 
	}
}

216 
	$m‰e¸óã
(
mFILE
 *
mf
, *
d©a
, 
size
) {

217 i‡(
mf
->
d©a
)

218 
	`‰ì
(
mf
->
d©a
);

219 
mf
->
d©a
 = data;

220 
mf
->
size
 = size;

221 
mf
->
Ælo˚d
 = 
size
;

222 
mf
->
eof
 = 0;

223 
mf
->
off£t
 = 0;

224 
mf
->
Êush_pos
 = 0;

225 
	}
}

237 
mFILE
 *
	$mf¸óã_‰om
(c⁄° *
∑th
, c⁄° *
mode_°r
, 
FILE
 *
Â
) {

238 
mFILE
 *
mf
;

241 i‡(
NULL
 =(
mf
 = 
	`m‰e›í
(
∑th
, 
mode_°r
, 
Â
)))

242  
NULL
;

245 
mf
->
Â
 = 
NULL
;

247  
mf
;

248 
	}
}

255 
mFILE
 *
	$m‰e›í
(c⁄° *
∑th
, c⁄° *
mode_°r
, 
FILE
 *
Â
) {

256 
mFILE
 *
mf
;

257 
r
 = 0, 
w
 = 0, 
a
 = 0, 
b
 = 0, 
x
 = 0, 
mode
 = 0;

267 i‡(
	`°rchr
(
mode_°r
, 'r'))

268 
r
 = 1, 
mode
 |
MF_READ
;

269 i‡(
	`°rchr
(
mode_°r
, 'w'))

270 
w
 = 1, 
mode
 |
MF_WRITE
 | 
MF_TRUNC
;

271 i‡(
	`°rchr
(
mode_°r
, 'a'))

272 
w
 = 
a
 = 1, 
mode
 |
MF_WRITE
 | 
MF_APPEND
;

273 i‡(
	`°rchr
(
mode_°r
, 'b'))

274 
b
 = 1, 
mode
 |
MF_BINARY
;

275 i‡(
	`°rchr
(
mode_°r
, 'x'))

276 
x
 = 1;

277 i‡(
	`°rchr
(
mode_°r
, '+')) {

278 
w
 = 1, 
mode
 |
MF_READ
 | 
MF_WRITE
;

279 i‡(
a
)

280 
r
 = 1;

282 #ifde‡
HAVE_MMAP


283 i‡(
	`°rchr
(
mode_°r
, 'm'))

284 i‡(!
w
Ë
mode
 |
MF_MMAP
;

287 i‡(
r
) {

288 
mf
 = 
	`mf¸óã
(
NULL
, 0);

289 i‡(
NULL
 =
mf
)  NULL;

290 i‡(!(
mode
 & 
MF_TRUNC
)) {

291 #ifde‡
HAVE_MMAP


292 i‡(
mode
 & 
MF_MMAP
) {

293 i‡(
	`mfmm≠
(
mf
, 
Â
, 
∑th
) == -1) {

294 
mf
->
d©a
 = 
NULL
;

295 
mode
 &~
MF_MMAP
;

299 i‡(!
mf
->
d©a
) {

300 
mf
->
d©a
 = 
	`mÊﬂd
(
Â
, 
∑th
, &mf->
size
, 
b
);

301 
mf
->
Ælo˚d
 = mf->
size
;

302 i‡(!
a
)

303 
	`f£ek
(
Â
, 0, 
SEEK_SET
);

306 } i‡(
w
) {

308 
mf
 = 
	`mf¸óã
(
NULL
, 0);

309 i‡(
NULL
 =
mf
)  NULL;

311 
	`Ârötf
(
°dîr
, "Must specifyÉitherÑ, w orá for mode\n");

312  
NULL
;

314 
mf
->
Â
 = fp;

315 
mf
->
mode
 = mode;

317 i‡(
x
) {

318 
mf
->
mode
 |
MF_MODEX
;

321 i‡(
a
) {

322 
mf
->
Êush_pos
 = mf->
size
;

323 
	`f£ek
(
Â
, 0, 
SEEK_END
);

326  
mf
;

327 
	}
}

334 
mFILE
 *
	$mf›í
(c⁄° *
∑th
, c⁄° *
mode
) {

335 
FILE
 *
Â
;

337 i‡(
NULL
 =(
Â
 = 
	`f›í
(
∑th
, 
mode
)))

338  
NULL
;

339  
	`m‰e›í
(
∑th
, 
mode
, 
Â
);

340 
	}
}

348 
	$mf˛o£
(
mFILE
 *
mf
) {

349 i‡(!
mf
)

352 
	`mfÊush
(
mf
);

354 #ifde‡
HAVE_MMAP


355 i‡((
mf
->
mode
 & 
MF_MMAP
Ë&& mf->
d©a
) {

357 
	`munm≠
(
mf
->
d©a
, mf->
size
);

358 
mf
->
d©a
 = 
NULL
;

362 i‡(
mf
->
Â
)

363 
	`f˛o£
(
mf
->
Â
);

365 
	`mfde°roy
(
mf
);

368 
	}
}

376 
	$mfdëach
(
mFILE
 *
mf
) {

377 i‡(!
mf
)

380 
	`mfÊush
(
mf
);

381 i‡(
mf
->
mode
 & 
MF_MMAP
)

384 i‡(
mf
->
Â
) {

385 
	`f˛o£
(
mf
->
Â
);

386 
mf
->
Â
 = 
NULL
;

390 
	}
}

395 
	$mfde°roy
(
mFILE
 *
mf
) {

396 i‡(!
mf
)

399 i‡(
mf
->
d©a
)

400 
	`‰ì
(
mf
->
d©a
);

401 
	`‰ì
(
mf
);

404 
	}
}

415 *
	$mf°ól
(
mFILE
 *
mf
, 
size_t
 *
size_out
) {

416 *
d©a
;

418 i‡(!
mf
Ë 
NULL
;

420 
d©a
 = 
mf
->data;

422 i‡(
NULL
 !
size_out
Ë*size_ouà
mf
->
size
;

424 i‡(
	`mfdëach
(
mf
) != 0)

425  
NULL
;

427 
mf
->
d©a
 = 
NULL
;

428 
	`mfde°roy
(
mf
);

430  
d©a
;

431 
	}
}

438 
	$mf£ek
(
mFILE
 *
mf
, 
off£t
, 
whí˚
) {

439 
whí˚
) {

440 
SEEK_SET
:

441 
mf
->
off£t
 = offset;

443 
SEEK_CUR
:

444 
mf
->
off£t
 += offset;

446 
SEEK_END
:

447 
mf
->
off£t
 = mf->
size
 + offset;

450 
î∫o
 = 
EINVAL
;

454 
mf
->
eof
 = 0;

456 
	}
}

458 
	$m·ñl
(
mFILE
 *
mf
) {

459  
mf
->
off£t
;

460 
	}
}

462 
	$mªwöd
(
mFILE
 *
mf
) {

463 
mf
->
off£t
 = 0;

464 
mf
->
eof
 = 0;

465 
	}
}

475 
	$m·runˇã
(
mFILE
 *
mf
, 
off£t
) {

476 
mf
->
size
 = 
off£t
 != -1 ? offset : mf->offset;

477 i‡(
mf
->
off£t
 > mf->
size
)

478 
mf
->
off£t
 = mf->
size
;

479 
	}
}

481 
	$m„of
(
mFILE
 *
mf
) {

482  
mf
->
eof
;

483 
	}
}

489 
size_t
 
	$m‰ód
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
mFILE
 *
mf
) {

490 
size_t
 
Àn
;

491 *
˝å
 = (*)
±r
;

493 i‡(
mf
 =
m_ch™√l
[0]Ë
	`öô_m°dö
();

495 i‡(
mf
->
size
 <mf->
off£t
)

498 
Àn
 = 
size
 * 
nmemb
 <
mf
->sizê- mf->
off£t


499 ? 
size
 * 
nmemb


500 : 
mf
->
size
 - mf->
off£t
;

501 i‡(!
size
)

504 
	`mem˝y
(
˝å
, &
mf
->
d©a
[mf->
off£t
], 
Àn
);

505 
mf
->
off£t
 +
Àn
;

507 i‡(
Àn
 !
size
 * 
nmemb
) {

508 
mf
->
eof
 = 1;

511  
Àn
 / 
size
;

512 
	}
}

514 
size_t
 
	$mfwrôe
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
mFILE
 *
mf
) {

515 i‡(!(
mf
->
mode
 & 
MF_WRITE
))

519 i‡(
mf
->
mode
 & 
MF_APPEND
)

520 
mf
->
off£t
 = mf->
size
;

523 
size
 * 
nmemb
 + 
mf
->
off£t
 > mf->
Ælo˚d
) {

524 
size_t
 
√w_Ælo˚d
 = 
mf
->
Ælo˚d
 ? mf->alloced * 2 : 1024;

525 * 
√w_d©a
 = 
	`ªÆloc
(
mf
->
d©a
, 
√w_Ælo˚d
);

526 i‡(
NULL
 =
√w_d©a
)  0;

527 
mf
->
Ælo˚d
 = 
√w_Ælo˚d
;

528 
mf
->
d©a
 = 
√w_d©a
;

532 i‡(
mf
->
off£t
 < mf->
Êush_pos
)

533 
mf
->
Êush_pos
 = mf->
off£t
;

536 
	`mem˝y
(&
mf
->
d©a
[mf->
off£t
], 
±r
, 
size
 * 
nmemb
);

537 
mf
->
off£t
 +
size
 * 
nmemb
;

538 i‡(
mf
->
size
 < mf->
off£t
)

539 
mf
->
size
 = mf->
off£t
;

541  
nmemb
;

542 
	}
}

544 
	$mfgëc
(
mFILE
 *
mf
) {

545 i‡(
mf
 =
m_ch™√l
[0]Ë
	`öô_m°dö
();

546 i‡(
mf
->
off£t
 < mf->
size
) {

547  ()
mf
->
d©a
[mf->
off£t
++];

550 
mf
->
eof
 = 1;

552 
	}
}

554 
	$mungëc
(
c
, 
mFILE
 *
mf
) {

555 i‡(
mf
->
off£t
 > 0) {

556 
mf
->
d©a
[--mf->
off£t
] = 
c
;

557  
c
;

560 
mf
->
eof
 = 1;

562 
	}
}

564 *
	$mfgës
(*
s
, 
size
, 
mFILE
 *
mf
) {

565 
i
;

567 i‡(
mf
 =
m_ch™√l
[0]Ë
	`öô_m°dö
();

568 *
s
 = 0;

569 
i
 = 0; i < 
size
-1;) {

570 i‡(
mf
->
off£t
 < mf->
size
) {

571 
s
[
i
] = 
mf
->
d©a
[mf->
off£t
++];

572 i‡(
s
[
i
++] == '\n')

575 
mf
->
eof
 = 1;

580 
s
[
i
] = 0;

581  
i
 ? 
s
 : 
NULL
;

582 
	}
}

594 
	$mfÊush
(
mFILE
 *
mf
) {

595 i‡(!
mf
->
Â
)

599 i‡(
mf
 =
m_ch™√l
[1] || mf == m_channel[2]) {

600 i‡(
mf
->
Êush_pos
 < mf->
size
) {

601 
size_t
 
byãs
 = 
mf
->
size
 - mf->
Êush_pos
;

602 i‡(
	`fwrôe
(
mf
->
d©a
 + mf->
Êush_pos
, 1, 
byãs
, mf->
Â
) < bytes)

604 i‡(0 !
	`fÊush
(
mf
->
Â
))

609 
mf
->
off£t
 = mf->
size
 = mf->
Êush_pos
 = 0;

613 i‡(
mf
->
mode
 & 
MF_WRITE
) {

614 i‡(
mf
->
Êush_pos
 < mf->
size
) {

615 
size_t
 
byãs
 = 
mf
->
size
 - mf->
Êush_pos
;

616 i‡(!(
mf
->
mode
 & 
MF_MODEX
)) {

617 
	`f£ek
(
mf
->
Â
, mf->
Êush_pos
, 
SEEK_SET
);

619 i‡(
	`fwrôe
(
mf
->
d©a
 + mf->
Êush_pos
, 1, 
byãs
, mf->
Â
) < bytes)

621 i‡(0 !
	`fÊush
(
mf
->
Â
))

624 i‡(
	`·ñl
(
mf
->
Â
) != -1 &&

625 
	`·runˇã
(
	`fûío
(
mf
->
Â
), 
	`·ñl
(mf->fp)) == -1)

627 
mf
->
Êush_pos
 = mf->
size
;

631 
	}
}

638 
	$mÂrötf
(
mFILE
 *
mf
, *
fmt
, ...) {

639 
ªt
;

640 
size_t
 
e°_Àngth
;

641 
va_li°
 
¨gs
;

643 
	`va_°¨t
(
¨gs
, 
fmt
);

644 
e°_Àngth
 = 
	`vÊí
(
fmt
, 
¨gs
);

645 
	`va_íd
(
¨gs
);

646 
e°_Àngth
 + 
mf
->
off£t
 > mf->
Ælo˚d
) {

647 
size_t
 
√w_Ælo˚d
 = 
mf
->
Ælo˚d
 ? mf->alloced * 2 : 1024;

648 * 
√w_d©a
 = 
	`ªÆloc
(
mf
->
d©a
, 
√w_Ælo˚d
);

649 i‡(
NULL
 =
√w_d©a
)  -1;

650 
mf
->
Ælo˚d
 = 
√w_Ælo˚d
;

651 
mf
->
d©a
 = 
√w_d©a
;

654 
	`va_°¨t
(
¨gs
, 
fmt
);

655 
ªt
 = 
	`v•rötf
(&
mf
->
d©a
[mf->
off£t
], 
fmt
, 
¨gs
);

656 
	`va_íd
(
¨gs
);

658 i‡(
ªt
 > 0) {

659 
mf
->
off£t
 +
ªt
;

660 i‡(
mf
->
size
 < mf->
off£t
)

661 
mf
->
size
 = mf->
off£t
;

664 i‡(
mf
->
Â
 =
°dîr
) {

666 i‡(0 !
	`mfÊush
(
mf
))  -1;

669  
ªt
;

670 
	}
}

682 
	$mÁscii
(
mFILE
 *
mf
) {

683 
size_t
 
p1
, 
p2
;

685 
p1
 = 
p2
 = 1;Ö1 < 
mf
->
size
;Ö1++,Ö2++) {

686 i‡(
mf
->
d©a
[
p1
] == '\n' && mf->data[p1-1] == '\r') {

687 
p2
--;

689 
mf
->
d©a
[
p2
] = mf->d©a[
p1
];

691 
mf
->
size
 = 
p2
;

693 
mf
->
off£t
 = mf->
Êush_pos
 = 0;

694 
	}
}

	@htslib/cram/mFILE.h

31 #i‚de‡
_MFILE_H_


32 
	#_MFILE_H_


	)

34 
	~<°dio.h
>

36 #ifde‡
__˝lu•lus


41 
FILE
 *
Â
;

42 *
d©a
;

43 
size_t
 
Ælo˚d
;

44 
eof
;

45 
mode
;

46 
size_t
 
size
;

47 
size_t
 
off£t
;

48 
size_t
 
Êush_pos
;

49 } 
	tmFILE
;

51 
	#MF_READ
 1

	)

52 
	#MF_WRITE
 2

	)

53 
	#MF_APPEND
 4

	)

54 
	#MF_BINARY
 8

	)

55 
	#MF_TRUNC
 16

	)

56 
	#MF_MODEX
 32

	)

57 
	#MF_MMAP
 64

	)

59 
mFILE
 *
m‰e›í
(c⁄° *
∑th
, c⁄° *
mode
, 
FILE
 *
Â
);

60 
mFILE
 *
mf›í
(c⁄° *
∑th
, c⁄° *
mode
);

61 
mfdëach
(
mFILE
 *
mf
);

62 
mf˛o£
(
mFILE
 *
mf
);

63 
mfde°roy
(
mFILE
 *
mf
);

64 
mf£ek
(
mFILE
 *
mf
, 
off£t
, 
whí˚
);

65 
m·ñl
(
mFILE
 *
mf
);

66 
mªwöd
(
mFILE
 *
mf
);

67 
m·runˇã
(
mFILE
 *
mf
, 
off£t
);

68 
m„of
(
mFILE
 *
mf
);

69 
size_t
 
m‰ód
(*
±r
, size_à
size
, size_à
nmemb
, 
mFILE
 *
mf
);

70 
size_t
 
mfwrôe
(*
±r
, size_à
size
, size_à
nmemb
, 
mFILE
 *
mf
);

71 
mfgëc
(
mFILE
 *
mf
);

72 
mungëc
(
c
, 
mFILE
 *
mf
);

73 
mFILE
 *
mf¸óã
(*
d©a
, 
size
);

74 
mFILE
 *
mf¸óã_‰om
(c⁄° *
∑th
, c⁄° *
mode_°r
, 
FILE
 *
Â
);

75 
m‰e¸óã
(
mFILE
 *
mf
, *
d©a
, 
size
);

76 *
mf°ól
(
mFILE
 *
mf
, 
size_t
 *
size_out
);

77 *
mfgës
(*
s
, 
size
, 
mFILE
 *
mf
);

78 
mfÊush
(
mFILE
 *
mf
);

79 
mÂrötf
(
mFILE
 *
mf
, *
fmt
, ...);

80 
mFILE
 *
m°dö
();

81 
mFILE
 *
m°dout
();

82 
mFILE
 *
m°dîr
();

83 
mÁscii
(
mFILE
 *
mf
);

85 #ifde‡
__˝lu•lus


	@htslib/cram/misc.h

63 #i‚de‡
_misc_h


64 
	#_misc_h


	)

66 
	~"¸am/os.h
"

68 
	~<°dio.h
>

69 
	~<°d¨g.h
>

70 
	~<sys/ty≥s.h
>

72 #ifde‡
__˝lu•lus


82 #ifde‡
__GNUC__


83 
	#__NORETURN__
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

	)

85 
	#__NORETURN__


	)

93 #ifde‡
__GNUC__


94 
	#__PRINTF_FORMAT__
(
a
,
b
Ë
	`__©åibuã__
 ((
	`f‹m©
 (
¥ötf
,á, b)))

	)

96 
	#__PRINTF_FORMAT__
(
a
,
b
)

	)

99 
is_dúe˘‹y
(* 
‚
);

100 
is_fûe
(* 
‚
);

101 
fûe_size
(* 
‚
);

103 
	#MIN
(
A
,
B
Ë––(AË< (BËË? (AË: (BË)

	)

104 
	#MAX
(
A
,
B
Ë––(AË> (BËË? (AË: (BË)

	)

106 #ifde‡
__˝lu•lus


	@htslib/cram/open_trace_file.c

64 
	~<c⁄fig.h
>

66 
	~<°dlib.h
>

67 
	~<°dio.h
>

68 
	~<°rög.h
>

69 
	~<uni°d.h
>

70 
	~<limôs.h
>

71 
	~<sys/ty≥s.h
>

72 
	~<sys/°©.h
>

73 
	~"¸am/os.h
"

74 #i‚de‡
PATH_MAX


75 
	#PATH_MAX
 1024

	)

78 
	~"¸am/›í_åa˚_fûe.h
"

79 
	~"¸am/misc.h
"

80 
	~"ht¶ib/hfûe.h
"

94 *
	$tokíi£_£¨ch_∑th
(*
£¨ch∑th
) {

95 *
√w£¨ch
;

96 
i
, 
j
;

97 
size_t
 
Àn
;

98 #ifde‡
_WIN32


99 
∑th_£p
 = ';';

101 
∑th_£p
 = ':';

104 i‡(!
£¨ch∑th
)

105 
£¨ch∑th
="";

107 
√w£¨ch
 = (*)
	`mÆloc
((
Àn
 = 
	`°æí
(
£¨ch∑th
))+5);

108 i‡(!
√w£¨ch
)

109  
NULL
;

111 
i
 = 0, 
j
 = 0; i < 
Àn
; i++) {

113 i‡(
i
 < 
Àn
-1 && 
£¨ch∑th
[i] == ':' && searchpath[i+1] == ':') {

114 
√w£¨ch
[
j
++] = ':';

115 
i
++;

120 i‡(
∑th_£p
 == ':') {

121 i‡((
i
 =0 || (ò> 0 && 
£¨ch∑th
[i-1] == ':')) &&

122 (!
	`°∫cmp
(&
£¨ch∑th
[
i
], "http:", 5) ||

123 !
	`°∫cmp
(&
£¨ch∑th
[
i
], "ftp:", 4) ||

124 !
	`°∫cmp
(&
£¨ch∑th
[
i
], "|http:", 6) ||

125 !
	`°∫cmp
(&
£¨ch∑th
[
i
], "|ftp:", 5) ||

126 !
	`°∫cmp
(&
£¨ch∑th
[
i
], "URL=http:", 9) ||

127 !
	`°∫cmp
(&
£¨ch∑th
[
i
], "URL=ftp:", 8))) {

129 
√w£¨ch
[
j
++] = 
£¨ch∑th
[
i
];

130 } 
i
<
Àn
 && 
£¨ch∑th
[i++] != ':');

131 i‡(
£¨ch∑th
[
i
] == ':')

132 
i
++;

133 i‡(
£¨ch∑th
[
i
]=='/')

134 
√w£¨ch
[
j
++] = 
£¨ch∑th
[
i
++];

135 i‡(
£¨ch∑th
[
i
]=='/')

136 
√w£¨ch
[
j
++] = 
£¨ch∑th
[
i
++];

139 
√w£¨ch
[
j
++] = 
£¨ch∑th
[
i
++];

140 } 
i
<
Àn
 && 
£¨ch∑th
[i] != ':' && searchpath[i] != '/');

141 
√w£¨ch
[
j
++] = 
£¨ch∑th
[
i
++];

142 i‡(
£¨ch∑th
[
i
] == ':')

143 
i
++;

147 i‡(
£¨ch∑th
[
i
] =
∑th_£p
) {

149 i‡(
j
 && 
√w£¨ch
[j-1] != 0)

150 
√w£¨ch
[
j
++] = 0;

152 
√w£¨ch
[
j
++] = 
£¨ch∑th
[
i
];

156 i‡(
j
)

157 
√w£¨ch
[
j
++] = 0;

158 
√w£¨ch
[
j
++] = '.';

159 
√w£¨ch
[
j
++] = '/';

160 
√w£¨ch
[
j
++] = 0;

161 
√w£¨ch
[
j
++] = 0;

163  
√w£¨ch
;

164 
	}
}

166 
mFILE
 *
	$föd_fûe_uæ
(*
fûe
, *
uæ
) {

167 
buf
[8192], *
˝
;

168 
mFILE
 *
mf
 = 
NULL
;

169 
maxÀn
 = 8190 - 
	`°æí
(
fûe
), 
Àn
;

170 
hFILE
 *
hf
;

173 
˝
 = 
buf
; *
uæ
 && c∞- bu‡< 
maxÀn
; url++) {

174 i‡(*
uæ
 == '%' && *(url+1) == 's') {

175 
uæ
++;

176 
˝
 +
	`°æí
(
	`°r˝y
(˝, 
fûe
));

178 *
˝
++ = *
uæ
;

181 *
˝
++ = 0;

183 i‡(!(
hf
 = 
	`h›í
(
buf
, "r")))

184  
NULL
;

186 i‡(
NULL
 =(
mf
 = 
	`mf¸óã
(NULL, 0)))

187  
NULL
;

188 (
Àn
 = 
	`hªad
(
hf
, 
buf
, 8192)) > 0) {

189 i‡(
	`mfwrôe
(
buf
, 
Àn
, 1, 
mf
) <= 0) {

190 
	`h˛o£_abru±ly
(
hf
);

191 
	`mfde°roy
(
mf
);

192  
NULL
;

195 i‡(
	`h˛o£
(
hf
Ë< 0 || 
Àn
 < 0) {

196 
	`mfde°roy
(
mf
);

197  
NULL
;

200 
	`mªwöd
(
mf
);

201  
mf
;

202 
	}
}

210 *
	$ex∑nd_∑th
(*
fûe
, *
dú«me
) {

211 
size_t
 
Àn
 = 
	`°æí
(
dú«me
);

212 
size_t
 
Ànf
 = 
	`°æí
(
fûe
);

213 *
˝
, *
∑th
;

215 
∑th
 = 
	`mÆloc
(
Àn
+
Ànf
+2);

216 i‡(!
∑th
)

217  
NULL
;

219 i‡(
dú«me
[
Àn
-1] == '/')

220 
Àn
--;

223 i‡(*
fûe
 ='/' || (
Àn
==1 && *
dú«me
 == '.')) {

224 
	`•rötf
(
∑th
, "%s", 
fûe
);

227 *
∑th_íd
 = 
∑th
;

228 *
∑th
 = 0;

229 (
˝
 = 
	`°rchr
(
dú«me
, '%'))) {

230 *
ídp
;

231 
l
 = 
	`°πﬁ
(
˝
+1, &
ídp
, 10);

232 i‡(*
ídp
 != 's') {

233 
	`°∫˝y
(
∑th_íd
, 
dú«me
, (
ídp
+1)-dirname);

234 
∑th_íd
 +(
ídp
+1)-
dú«me
;

235 
dú«me
 = 
ídp
+1;

239 
	`°∫˝y
(
∑th_íd
, 
dú«me
, 
˝
-dirname);

240 
∑th_íd
 +
˝
-
dú«me
;

241 i‡(
l
) {

242 
	`°∫˝y
(
∑th_íd
, 
fûe
, 
l
);

243 
∑th_íd
 +
	`MIN
(
	`°æí
(
fûe
), 
l
);

244 
fûe
 +
	`MIN
(
	`°æí
(fûe), 
l
);

246 
	`°r˝y
(
∑th_íd
, 
fûe
);

247 
∑th_íd
 +
	`°æí
(
fûe
);

248 
fûe
 +
	`°æí
(file);

250 
Àn
 -(
ídp
+1Ë- 
dú«me
;

251 
dú«me
 = 
ídp
+1;

253 
	`°∫˝y
(
∑th_íd
, 
dú«me
, 
Àn
);

254 
∑th_íd
 +
	`MIN
(
	`°æí
(
dú«me
), 
Àn
);

255 *
∑th_íd
 = 0;

256 i‡(*
fûe
) {

257 *
∑th_íd
++ = '/';

258 
	`°r˝y
(
∑th_íd
, 
fûe
);

263  
∑th
;

264 
	}
}

274 
mFILE
 *
	$föd_fûe_dú
(*
fûe
, *
dú«me
) {

275 *
∑th
;

276 
mFILE
 *
mf
 = 
NULL
;

278 
∑th
 = 
	`ex∑nd_∑th
(
fûe
, 
dú«me
);

280 i‡(
	`is_fûe
(
∑th
))

281 
mf
 = 
	`mf›í
(
∑th
, "rbm");

283 
	`‰ì
(
∑th
);

284  
mf
;

285 
	}
}

307 
mFILE
 *
	$›í_∑th_mfûe
(*
fûe
, *
∑th
, *
ªœtive_to
) {

308 *
√w£¨ch
;

309 *
ñe
;

310 
mFILE
 *
Â
;

313 i‡(!
∑th
)

314 
∑th
 = 
	`gëív
("RAWDATA");

315 i‡(
NULL
 =(
√w£¨ch
 = 
	`tokíi£_£¨ch_∑th
(
∑th
)))

316  
NULL
;

323 
ñe
 = 
√w£¨ch
; *ñe;ÉÀ +
	`°æí
(ele)+1) {

324 *
ñe2
;

333 i‡(*
ñe
 == '|') {

334 
ñe2
 = 
ñe
+1;

336 
ñe2
 = 
ñe
;

339 i‡(0 =
	`°∫cmp
(
ñe2
, "URL=", 4)) {

340 i‡((
Â
 = 
	`föd_fûe_uæ
(
fûe
, 
ñe2
+4))) {

341 
	`‰ì
(
√w£¨ch
);

342  
Â
;

344 } i‡(!
	`°∫cmp
(
ñe2
, "http:", 5) ||

345 !
	`°∫cmp
(
ñe2
, "ftp:", 4)) {

346 i‡((
Â
 = 
	`föd_fûe_uæ
(
fûe
, 
ñe2
))) {

347 
	`‰ì
(
√w£¨ch
);

348  
Â
;

350 } i‡((
Â
 = 
	`föd_fûe_dú
(
fûe
, 
ñe2
))) {

351 
	`‰ì
(
√w£¨ch
);

352  
Â
;

356 
	`‰ì
(
√w£¨ch
);

359 i‡(
ªœtive_to
) {

360 *
˝
;

361 
ªœtive_∑th
[
PATH_MAX
+1];

362 
	`°r˝y
(
ªœtive_∑th
, 
ªœtive_to
);

363 i‡((
˝
 = 
	`°ºchr
(
ªœtive_∑th
, '/')))

364 *
˝
 = 0;

365 i‡((
Â
 = 
	`föd_fûe_dú
(
fûe
, 
ªœtive_∑th
)))

366  
Â
;

369  
NULL
;

370 
	}
}

381 *
	$föd_∑th
(*
fûe
, *
∑th
) {

382 *
√w£¨ch
;

383 *
ñe
;

384 *
ouç©h
 = 
NULL
;

387 i‡(!
∑th
)

388 
∑th
 = 
	`gëív
("RAWDATA");

389 i‡(
NULL
 =(
√w£¨ch
 = 
	`tokíi£_£¨ch_∑th
(
∑th
)))

390  
NULL
;

392 
ñe
 = 
√w£¨ch
; *ñe;ÉÀ +
	`°æí
(ele)+1) {

393 *
ñe2
 = (*
ñe
 == '|') ?Éle+1 :Éle;

395 i‡(!
	`°∫cmp
(
ñe2
, "URL=", 4) ||

396 !
	`°∫cmp
(
ñe2
, "http:", 5) ||

397 !
	`°∫cmp
(
ñe2
, "ftp:", 4)) {

400 
ouç©h
 = 
	`ex∑nd_∑th
(
fûe
, 
ñe2
);

401 i‡(
	`is_fûe
(
ouç©h
)) {

402 
	`‰ì
(
√w£¨ch
);

403  
ouç©h
;

405 
	`‰ì
(
ouç©h
);

410 
	`‰ì
(
√w£¨ch
);

412  
NULL
;

413 
	}
}

	@htslib/cram/open_trace_file.h

64 #i‚de‡
_OPEN_TRACE_FILE_H_


65 
	#_OPEN_TRACE_FILE_H_


	)

67 
	~"¸am/mFILE.h
"

69 #ifde‡
__˝lu•lus


85 *
tokíi£_£¨ch_∑th
(*
£¨ch∑th
);

102 
mFILE
 *
›í_∑th_mfûe
(*
fûe
, *
∑th
, *
ªœtive_to
);

108 
mFILE
 *
föd_fûe_uæ
(*
fûe
, *
uæ
);

119 *
föd_∑th
(*
fûe
, *
∑th
);

121 #ifde‡
__˝lu•lus


	@htslib/cram/os.h

75 #i‚de‡
_OS_H_


76 
	#_OS_H_


	)

78 
	~<limôs.h
>

79 
	~<öây≥s.h
>

80 
	~"ht¶ib/hts_ídün.h
"

82 #ifde‡
__˝lu•lus


99 
	#isw≠_öt8
(
x
) \

100 (((
x
 & 0x00000000000000ffLL) << 56) + \

101 ((
x
 & 0x000000000000ff00LL) << 40) + \

102 ((
x
 & 0x0000000000ff0000LL) << 24) + \

103 ((
x
 & 0x00000000ff000000LL) << 8) + \

104 ((
x
 & 0x000000ff00000000LL) >> 8) + \

105 ((
x
 & 0x0000ff0000000000LL) >> 24) + \

106 ((
x
 & 0x00ff000000000000LL) >> 40) + \

107 ((
x
 & 0xff00000000000000LLË>> 56))

	)

109 
	#isw≠_öt4
(
x
) \

110 (((
x
 & 0x000000ff) << 24) + \

111 ((
x
 & 0x0000ff00) << 8) + \

112 ((
x
 & 0x00ff0000) >> 8) + \

113 ((
x
 & 0xff000000Ë>> 24))

	)

115 
	#isw≠_öt2
(
x
) \

116 (((
x
 & 0x00ff) << 8) + \

117 ((
x
 & 0xff00Ë>> 8))

	)

125 #i‡
deföed
(
__löux__
)

126 
	~<byãsw≠.h
>

127 #unde‡
isw≠_öt8


128 #unde‡
isw≠_öt4


129 #unde‡
isw≠_öt2


130 
	#isw≠_öt8
 
bsw≠_64


	)

131 
	#isw≠_öt4
 
bsw≠_32


	)

132 
	#isw≠_öt2
 
bsw≠_16


	)

147 #i‡
deföed
(
HTS_BIG_ENDIAN
)

148 
	#À_öt4
(
x
Ë
	`isw≠_öt4
((x))

	)

149 
	#À_öt2
(
x
Ë
	`isw≠_öt2
((x))

	)

150 #ñi‡
deföed
(
HTS_LITTLE_ENDIAN
)

151 
	#À_öt4
(
x
Ë(x)

	)

152 
	#À_öt2
(
x
Ë(x)

	)

154 
ölöe
 
uöt32_t
 
À_öt4
(uöt32_à
x
) {

155  
À_to_u32
((
uöt8_t
 *Ë&
x
);

157 
ölöe
 
uöt16_t
 
À_öt2
(uöt16_à
x
) {

158  
À_to_u16
((
uöt8_t
 *Ë&
x
);

166 #i‚de‡
PRId64


167 
	#__PRI64__
 "l"

	)

168 
	#PRId64
 
__PRI64__
 "d"

	)

169 
	#PRId32
 "d"

	)

170 
	#PRId16
 "d"

	)

171 
	#PRId8
 "d"

	)

172 
	#PRIu64
 
__PRI64__
 "u"

	)

173 
	#PRIu32
 "u"

	)

174 
	#PRIu16
 "u"

	)

175 
	#PRIu8
 "u"

	)

187 #i‡
deföed
(
__sun__
Ë&& !deföed(
__svr4__
)

188 
	#SEEK_SET
 0

	)

189 
	#SEEK_CUR
 1

	)

190 
	#SEEK_END
 2

	)

197 #i‡
deföed
(
_MSC_VER
)

198 
	#p›í
 
_p›í


	)

199 
	#p˛o£
 
_p˛o£


	)

200 
	#·runˇã
(
fd
,
Àn
Ë
	`_chsize
(fd,Àn)

	)

207 #i‡
deföed
(
__MINGW32__
)

209 
	#sysc⁄f
(
x
Ë512

	)

210 
	#·runˇã
(
fd
,
Àn
Ë
	`_chsize
(fd,Àn)

	)

214 #ifde‡
_WIN32


215 #i‚de‡
HAVE_FSEEKO


216 #i‡
__MSVCRT_VERSION__
 >= 0x800

218 
	#off_t
 
__öt64


	)

219 
	#f£eko
 
_f£eki64


	)

220 
	#·ñlo
 
_·ñli64


	)

223 
	#off_t
 

	)

224 
	#f£eko
 
f£ek


	)

225 
	#·ñlo
 
·ñl


	)

230 #ifde‡
__˝lu•lus


	@htslib/cram/pooled_alloc.c

31 
	~<c⁄fig.h
>

33 
	~<°dlib.h
>

34 
	~<°dio.h
>

35 
	~<°döt.h
>

37 
	~"¸am/poﬁed_Æloc.h
"

38 
	~"¸am/misc.h
"

42 
	#PSIZE
 1024*1024

	)

45 
	$√xt_powî_2
(
v
) {

46 
v
--;

47 
v
 |= v >> 1;

48 
v
 |= v >> 2;

49 
v
 |= v >> 4;

50 
v
 |= v >> 8;

51 
v
 |= v >> 16;

52 
v
++;

54  
v
;

55 
	}
}

62 
poﬁ_Æloc_t
 *
	$poﬁ_¸óã
(
size_t
 
dsize
) {

63 
poﬁ_Æloc_t
 *
p
;

65 i‡(
NULL
 =(
p
 = (
poﬁ_Æloc_t
 *)
	`mÆloc
((*p))))

66  
NULL
;

69 
dsize
 = (dsize + (*) - 1) & ~((*)-1);

70 i‡(
dsize
 < (*))

71 
dsize
 = (*);

72 
p
->
dsize
 = dsize;

73 
p
->
psize
 = 
	`MIN
(
PSIZE
, 
	`√xt_powî_2
’->
dsize
*1024));

75 
p
->
≈oﬁs
 = 0;

76 
p
->
poﬁs
 = 
NULL
;

77 
p
->
‰ì
 = 
NULL
;

79  
p
;

80 
	}
}

82 
poﬁ_t
 *
	$√w_poﬁ
(
poﬁ_Æloc_t
 *
p
) {

83 
size_t
 
n
 = 
p
->
psize
 /Ö->
dsize
;

84 
poﬁ_t
 *
poﬁ
;

86 
poﬁ
 = 
	`ªÆloc
(
p
->
poﬁs
, (p->
≈oﬁs
 + 1) * (*p->pools));

87 i‡(
NULL
 =
poﬁ
)  NULL;

88 
p
->
poﬁs
 = 
poﬁ
;

89 
poﬁ
 = &
p
->
poﬁs
[p->
≈oﬁs
];

91 
poﬁ
->poﬁ = 
	`mÆloc
(
n
 * 
p
->
dsize
);

92 i‡(
NULL
 =
poﬁ
->pool)  NULL;

94 
poﬁ
->
u£d
 = 0;

96 
p
->
≈oﬁs
++;

98  
poﬁ
;

99 
	}
}

101 
	$poﬁ_de°roy
(
poﬁ_Æloc_t
 *
p
) {

102 
size_t
 
i
;

104 
i
 = 0; i < 
p
->
≈oﬁs
; i++) {

105 
	`‰ì
(
p
->
poﬁs
[
i
].
poﬁ
);

107 
	`‰ì
(
p
->
poﬁs
);

108 
	`‰ì
(
p
);

109 
	}
}

111 *
	$poﬁ_Æloc
(
poﬁ_Æloc_t
 *
p
) {

112 
poﬁ_t
 *
poﬁ
;

113 *
ªt
;

116 i‡(
NULL
 !
p
->
‰ì
) {

117 
ªt
 = 
p
->
‰ì
;

118 
p
->
‰ì
 = *((**)p->free);

119  
ªt
;

123 i‡(
p
->
≈oﬁs
) {

124 
poﬁ
 = &
p
->
poﬁs
[p->
≈oﬁs
 - 1];

125 i‡(
poﬁ
->
u£d
 + 
p
->
dsize
 <Ö->
psize
) {

126 
ªt
 = ((*Ë
poﬁ
->poﬁË+Öoﬁ->
u£d
;

127 
poﬁ
->
u£d
 +
p
->
dsize
;

128  
ªt
;

133 
poﬁ
 = 
	`√w_poﬁ
(
p
);

134 i‡(
NULL
 =
poﬁ
)  NULL;

136 
poﬁ
->
u£d
 = 
p
->
dsize
;

137  
poﬁ
->pool;

138 
	}
}

140 
	$poﬁ_‰ì
(
poﬁ_Æloc_t
 *
p
, *
±r
) {

141 *(**)
±r
 = 
p
->
‰ì
;

142 
p
->
‰ì
 = 
±r
;

143 
	}
}

145 #ifde‡
TEST_MAIN


147 
	mx
, 
	my
, 
	mz
;

148 } 
	txyz
;

150 
	#NP
 10000

	)

151 
	$maö
() {

152 
i
;

153 
xyz
 *
ôem
;

154 
xyz
 **
ôems
;

155 
poﬁ_Æloc_t
 *
p
 = 
	`poﬁ_¸óã
((
xyz
));

157 
ôems
 = (
xyz
 **)
	`mÆloc
(
NP
 * (*items));

159 
i
 = 0; i < 
NP
; i++) {

160 
ôem
 = 
	`poﬁ_Æloc
(
p
);

161 
ôem
->
x
 = 
i
;

162 
ôem
->
y
 = 
i
+1;

163 
ôem
->
z
 = 
i
+2;

164 
ôems
[
i
] = 
ôem
;

167 
i
 = 0; i < 
NP
; i++) {

168 
ôem
 = 
ôems
[
i
];

169 i‡(
i
 % 3)

170 
	`poﬁ_‰ì
(
p
, 
ôem
);

173 
i
 = 0; i < 
NP
; i++) {

174 
ôem
 = 
	`poﬁ_Æloc
(
p
);

175 
ôem
->
x
 = 1000000+
i
;

176 
ôem
->
y
 = 1000000+
i
+1;

177 
ôem
->
z
 = 1000000+
i
+2;

180 
i
 = 0; i < 
NP
; i++) {

181 
ôem
 = 
ôems
[
i
];

182 
	`¥ötf
("%d\t%d\t%d\t%d\n", 
i
, 
ôem
->
x
, iãm->
y
, iãm->
z
);

183 
	`poﬁ_‰ì
(
p
, 
ôem
);

187 
	}
}

	@htslib/cram/pooled_alloc.h

31 #i‚de‡
_POOLED_ALLOC_H_


32 
	#_POOLED_ALLOC_H_


	)

34 
	~<°ddef.h
>

36 #ifde‡
__˝lu•lus


45 *
poﬁ
;

46 
size_t
 
u£d
;

47 } 
	tpoﬁ_t
;

50 
size_t
 
dsize
;

51 
size_t
 
psize
;

52 
size_t
 
≈oﬁs
;

53 
poﬁ_t
 *
poﬁs
;

54 *
‰ì
;

55 } 
	tpoﬁ_Æloc_t
;

57 
poﬁ_Æloc_t
 *
poﬁ_¸óã
(
size_t
 
dsize
);

58 
poﬁ_de°roy
(
poﬁ_Æloc_t
 *
p
);

59 *
poﬁ_Æloc
(
poﬁ_Æloc_t
 *
p
);

60 
poﬁ_‰ì
(
poﬁ_Æloc_t
 *
p
, *
±r
);

62 #ifde‡
__˝lu•lus


	@htslib/cram/rANS_byte.h

15 #i‚de‡
RANS_BYTE_HEADER


16 
	#RANS_BYTE_HEADER


	)

18 
	~<°döt.h
>

20 #ifde‡
as£π


21 
	#R™sAs£π
 
as£π


	)

23 
	#R™sAs£π
(
x
)

	)

59 
	#RANS_BYTE_L
 (1u << 23)

60 

	)

62 
uöt32_t
 
	tR™sSèã
;

65 
ölöe
 
	$R™sEncInô
(
R™sSèã
* 
r
)

67 *
r
 = 
RANS_BYTE_L
;

68 
	}
}

71 
ölöe
 
R™sSèã
 
	$R™sEncRí‹m
(
R™sSèã
 
x
, 
uöt8_t
** 
µå
, 
uöt32_t
 
‰eq
, uöt32_à
sˇÀ_bôs
)

73 
uöt32_t
 
x_max
 = ((
RANS_BYTE_L
 >> 
sˇÀ_bôs
Ë<< 8Ë* 
‰eq
;

74 i‡(
x
 >
x_max
) {

75 
uöt8_t
* 
±r
 = *
µå
;

77 *--
±r
 = (
uöt8_t
Ë(
x
 & 0xff);

78 
x
 >>= 8;

79 } 
x
 >
x_max
);

80 *
µå
 = 
±r
;

82  
x
;

83 
	}
}

92 
ölöe
 
	$R™sEncPut
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
, 
uöt32_t
 
°¨t
, uöt32_à
‰eq
, uöt32_à
sˇÀ_bôs
)

95 
R™sSèã
 
x
 = 
	`R™sEncRí‹m
(*
r
, 
µå
, 
‰eq
, 
sˇÀ_bôs
);

98 *
r
 = ((
x
 / 
‰eq
Ë<< 
sˇÀ_bôs
Ë+ (x % fªqË+ 
°¨t
;

99 
	}
}

102 
ölöe
 
	$R™sEncFlush
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
)

104 
uöt32_t
 
x
 = *
r
;

105 
uöt8_t
* 
±r
 = *
µå
;

107 
±r
 -= 4;

108 
±r
[0] = (
uöt8_t
Ë(
x
 >> 0);

109 
±r
[1] = (
uöt8_t
Ë(
x
 >> 8);

110 
±r
[2] = (
uöt8_t
Ë(
x
 >> 16);

111 
±r
[3] = (
uöt8_t
Ë(
x
 >> 24);

113 *
µå
 = 
±r
;

114 
	}
}

118 
ölöe
 
	$R™sDecInô
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
)

120 
uöt32_t
 
x
;

121 
uöt8_t
* 
±r
 = *
µå
;

123 
x
 = 
±r
[0] << 0;

124 
x
 |
±r
[1] << 8;

125 
x
 |
±r
[2] << 16;

126 
x
 |
±r
[3] << 24;

127 
±r
 += 4;

129 *
µå
 = 
±r
;

130 *
r
 = 
x
;

131 
	}
}

134 
ölöe
 
uöt32_t
 
	$R™sDecGë
(
R™sSèã
* 
r
, 
uöt32_t
 
sˇÀ_bôs
)

136  *
r
 & ((1u << 
sˇÀ_bôs
) - 1);

137 
	}
}

142 
ölöe
 
	$R™sDecAdv™˚
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
, 
uöt32_t
 
°¨t
, uöt32_à
‰eq
, uöt32_à
sˇÀ_bôs
)

144 
uöt32_t
 
mask
 = (1u << 
sˇÀ_bôs
) - 1;

147 
uöt32_t
 
x
 = *
r
;

148 
x
 = 
‰eq
 * (x >> 
sˇÀ_bôs
Ë+ (x & 
mask
Ë- 
°¨t
;

151 i‡(
x
 < 
RANS_BYTE_L
) {

152 
uöt8_t
* 
±r
 = *
µå
;

153 dÿ
x
 = (x << 8Ë| *
±r
++; x < 
RANS_BYTE_L
);

154 *
µå
 = 
±r
;

157 *
r
 = 
x
;

158 
	}
}

169 
uöt32_t
 
	mx_max
;

170 
uöt32_t
 
	mr˝_‰eq
;

171 
uöt32_t
 
	mbüs
;

172 
uöt16_t
 
	mcm∂_‰eq
;

173 
uöt16_t
 
	mr˝_shi·
;

174 } 
	tR™sEncSymbﬁ
;

178 
uöt16_t
 
	m°¨t
;

179 
uöt16_t
 
	m‰eq
;

180 } 
	tR™sDecSymbﬁ
;

183 
ölöe
 
	$R™sEncSymbﬁInô
(
R™sEncSymbﬁ
* 
s
, 
uöt32_t
 
°¨t
, uöt32_à
‰eq
, uöt32_à
sˇÀ_bôs
)

185 
	`R™sAs£π
(
sˇÀ_bôs
 <= 16);

186 
	`R™sAs£π
(
°¨t
 <(1u << 
sˇÀ_bôs
));

187 
	`R™sAs£π
(
‰eq
 <(1u << 
sˇÀ_bôs
Ë- 
°¨t
);

206 
s
->
x_max
 = ((
RANS_BYTE_L
 >> 
sˇÀ_bôs
Ë<< 8Ë* 
‰eq
;

207 
s
->
cm∂_‰eq
 = (
uöt16_t
Ë((1 << 
sˇÀ_bôs
Ë- 
‰eq
);

208 i‡(
‰eq
 < 2) {

235 
s
->
r˝_‰eq
 = ~0u;

236 
s
->
r˝_shi·
 = 0;

237 
s
->
büs
 = 
°¨t
 + (1 << 
sˇÀ_bôs
) - 1;

241 
uöt32_t
 
shi·
 = 0;

242 
‰eq
 > (1u << 
shi·
))

243 
shi·
++;

245 
s
->
r˝_‰eq
 = (
uöt32_t
Ë(((1uŒ << (
shi·
 + 31)Ë+ 
‰eq
-1) / freq);

246 
s
->
r˝_shi·
 = 
shi·
 - 1;

250 
s
->
büs
 = 
°¨t
;

253 
s
->
r˝_shi·
 += 32;

254 
	}
}

257 
ölöe
 
	$R™sDecSymbﬁInô
(
R™sDecSymbﬁ
* 
s
, 
uöt32_t
 
°¨t
, uöt32_à
‰eq
)

259 
	`R™sAs£π
(
°¨t
 <= (1 << 16));

260 
	`R™sAs£π
(
‰eq
 <(1 << 16Ë- 
°¨t
);

261 
s
->
°¨t
 = (
uöt16_t
) start;

262 
s
->
‰eq
 = (
uöt16_t
) freq;

263 
	}
}

269 
ölöe
 
	$R™sEncPutSymbﬁ
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
, 
R™sEncSymbﬁ
 c⁄°* 
sym
)

271 
	`R™sAs£π
(
sym
->
x_max
 != 0);

274 
uöt32_t
 
x
 = *
r
;

275 
uöt32_t
 
x_max
 = 
sym
->x_max;

277 i‡(
x
 >
x_max
) {

278 
uöt8_t
* 
±r
 = *
µå
;

280 *--
±r
 = (
uöt8_t
Ë(
x
 & 0xff);

281 
x
 >>= 8;

282 } 
x
 >
x_max
);

283 *
µå
 = 
±r
;

293 
uöt32_t
 
q
 = (uöt32_tË(((
uöt64_t
)
x
 * 
sym
->
r˝_‰eq
Ë>> sym->
r˝_shi·
);

294 *
r
 = 
x
 + 
sym
->
büs
 + 
q
 * sym->
cm∂_‰eq
;

295 
	}
}

298 
ölöe
 
	$R™sDecAdv™˚Symbﬁ
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
, 
R™sDecSymbﬁ
 c⁄°* 
sym
, 
uöt32_t
 
sˇÀ_bôs
)

300 
	`R™sDecAdv™˚
(
r
, 
µå
, 
sym
->
°¨t
, sym->
‰eq
, 
sˇÀ_bôs
);

301 
	}
}

306 
ölöe
 
	$R™sDecAdv™˚Sãp
(
R™sSèã
* 
r
, 
uöt32_t
 
°¨t
, uöt32_à
‰eq
, uöt32_à
sˇÀ_bôs
)

308 
uöt32_t
 
mask
 = (1u << 
sˇÀ_bôs
) - 1;

311 
uöt32_t
 
x
 = *
r
;

312 *
r
 = 
‰eq
 * (
x
 >> 
sˇÀ_bôs
Ë+ (x & 
mask
Ë- 
°¨t
;

313 
	}
}

316 
ölöe
 
	$R™sDecAdv™˚SymbﬁSãp
(
R™sSèã
* 
r
, 
R™sDecSymbﬁ
 c⁄°* 
sym
, 
uöt32_t
 
sˇÀ_bôs
)

318 
	`R™sDecAdv™˚Sãp
(
r
, 
sym
->
°¨t
, sym->
‰eq
, 
sˇÀ_bôs
);

319 
	}
}

322 
ölöe
 
	$R™sDecRí‹m
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
)

325 
uöt32_t
 
x
 = *
r
;

327 i‡(
x
 < 
RANS_BYTE_L
) {

328 
uöt8_t
* 
±r
 = *
µå
;

329 
x
 = (x << 8Ë| *
±r
++;

330 i‡(
x
 < 
RANS_BYTE_L
)

331 
x
 = (x << 8Ë| *
±r
++;

332 *
µå
 = 
±r
;

335 *
r
 = 
x
;

336 
	}
}

339 
ölöe
 
	$R™sDecRí‹mSa„
(
R™sSèã
* 
r
, 
uöt8_t
** 
µå
, uöt8_à*
±r_íd
)

341 
uöt32_t
 
x
 = *
r
;

342 
uöt8_t
* 
±r
 = *
µå
;

343 i‡(
x
 >
RANS_BYTE_L
 || 
±r
 >
±r_íd
) ;

344 
x
 = (x << 8Ë| *
±r
++;

345 i‡(
x
 < 
RANS_BYTE_L
 && 
±r
 < 
±r_íd
)

346 
x
 = (x << 8Ë| *
±r
++;

347 *
µå
 = 
±r
;

348 *
r
 = 
x
;

349 
	}
}

	@htslib/cram/rANS_static.c

38 
	~<c⁄fig.h
>

40 
	~<°döt.h
>

41 
	~<°dlib.h
>

42 
	~<°dio.h
>

43 
	~<uni°d.h
>

44 
	~<as£π.h
>

45 
	~<°rög.h
>

46 
	~<sys/time.h
>

48 
	~"¸am/rANS_°©ic.h
"

49 
	~"¸am/rANS_byã.h
"

51 
	#TF_SHIFT
 12

	)

52 
	#TOTFREQ
 (1<<
TF_SHIFT
)

	)

54 
	#ABS
(
a
Ë(◊)>0?◊):-◊))

	)

55 #i‚de‡
BLK_SIZE


56 
	#BLK_SIZE
 1024*1024

	)

60 
	#BLK_SIZE2
 (()(1.05*
BLK_SIZE
))

	)

69 *
	$øns_com¥ess_O0
(*
ö
, 
ö_size
,

70 *
out_size
) {

71 *
out_buf
 = 
	`mÆloc
(1.05*
ö_size
 + 257*257*3 + 9);

72 *
˝
, *
out_íd
;

73 
R™sEncSymbﬁ
 
syms
[256];

74 
R™sSèã
 
øns0
, 
øns1
, 
øns2
, 
øns3
;

75 
uöt8_t
* 
±r
;

76 
F
[256] = {0}, 
i
, 
j
, 
èb_size
, 
æe
, 
x
, 
fsum
 = 0;

77 
m
 = 0, 
M
 = 0;

78 
uöt64_t
 
å
;

80 i‡(!
out_buf
)

81  
NULL
;

83 
±r
 = 
out_íd
 = 
out_buf
 + ()(1.05*
ö_size
) + 257*257*3 + 9;

86 
i
 = 0; i < 
ö_size
; i++) {

87 
F
[
ö
[
i
]]++;

89 
å
 = ((
uöt64_t
)
TOTFREQ
<<31)/
ö_size
 + (1<<30)/in_size;

90 
n‹mÆi£_h¨dî
:

92 
m
 = 
M
 = 
j
 = 0; j < 256; j++) {

93 i‡(!
F
[
j
])

96 i‡(
m
 < 
F
[
j
])

97 
m
 = 
F
[
j
], 
M
 = j;

99 i‡((
F
[
j
] = (F[j]*
å
)>>31) == 0)

100 
F
[
j
] = 1;

101 
fsum
 +
F
[
j
];

104 
fsum
++;

105 i‡(
fsum
 < 
TOTFREQ
) {

106 
F
[
M
] +
TOTFREQ
-
fsum
;

107 } i‡(
fsum
-
TOTFREQ
 > 
F
[
M
]/2) {

109 
å
 = 2104533975; 
n‹mÆi£_h¨dî
;

111 
F
[
M
] -
fsum
-
TOTFREQ
;

115 
	`as£π
(
F
[
M
]>0);

118 
˝
 = 
out_buf
+9;

120 
x
 = 
æe
 = 
j
 = 0; j < 256; j++) {

121 i‡(
F
[
j
]) {

123 i‡(
æe
) {

124 
æe
--;

126 *
˝
++ = 
j
;

127 i‡(!
æe
 && 
j
 && 
F
[j-1]) {

128 
æe
=
j
+1;ÑÀ<256 && 
F
[rle];Ñle++)

130 
æe
 -
j
+1;

131 *
˝
++ = 
æe
;

137 i‡(
F
[
j
]<128) {

138 *
˝
++ = 
F
[
j
];

140 *
˝
++ = 128 | (
F
[
j
]>>8);

141 *
˝
++ = 
F
[
j
]&0xff;

143 
	`R™sEncSymbﬁInô
(&
syms
[
j
], 
x
, 
F
[j], 
TF_SHIFT
);

144 
x
 +
F
[
j
];

147 *
˝
++ = 0;

150 
èb_size
 = 
˝
-
out_buf
;

152 
	`R™sEncInô
(&
øns0
);

153 
	`R™sEncInô
(&
øns1
);

154 
	`R™sEncInô
(&
øns2
);

155 
	`R™sEncInô
(&
øns3
);

157 
i
=(
ö_size
&3)) {

158 3: 
	`R™sEncPutSymbﬁ
(&
øns2
, &
±r
, &
syms
[
ö
[
ö_size
-(
i
-2)]]);

159 2: 
	`R™sEncPutSymbﬁ
(&
øns1
, &
±r
, &
syms
[
ö
[
ö_size
-(
i
-1)]]);

160 1: 
	`R™sEncPutSymbﬁ
(&
øns0
, &
±r
, &
syms
[
ö
[
ö_size
-(
i
-0)]]);

164 
i
=(
ö_size
 &~3); i>0; i-=4) {

165 
R™sEncSymbﬁ
 *
s3
 = &
syms
[
ö
[
i
-1]];

166 
R™sEncSymbﬁ
 *
s2
 = &
syms
[
ö
[
i
-2]];

167 
R™sEncSymbﬁ
 *
s1
 = &
syms
[
ö
[
i
-3]];

168 
R™sEncSymbﬁ
 *
s0
 = &
syms
[
ö
[
i
-4]];

170 
	`R™sEncPutSymbﬁ
(&
øns3
, &
±r
, 
s3
);

171 
	`R™sEncPutSymbﬁ
(&
øns2
, &
±r
, 
s2
);

172 
	`R™sEncPutSymbﬁ
(&
øns1
, &
±r
, 
s1
);

173 
	`R™sEncPutSymbﬁ
(&
øns0
, &
±r
, 
s0
);

176 
	`R™sEncFlush
(&
øns3
, &
±r
);

177 
	`R™sEncFlush
(&
øns2
, &
±r
);

178 
	`R™sEncFlush
(&
øns1
, &
±r
);

179 
	`R™sEncFlush
(&
øns0
, &
±r
);

182 *
out_size
 = (
out_íd
 - 
±r
Ë+ 
èb_size
;

184 
˝
 = 
out_buf
;

186 *
˝
++ = 0;

187 *
˝
++ = ((*
out_size
-9)>> 0) & 0xff;

188 *
˝
++ = ((*
out_size
-9)>> 8) & 0xff;

189 *
˝
++ = ((*
out_size
-9)>>16) & 0xff;

190 *
˝
++ = ((*
out_size
-9)>>24) & 0xff;

192 *
˝
++ = (
ö_size
>> 0) & 0xff;

193 *
˝
++ = (
ö_size
>> 8) & 0xff;

194 *
˝
++ = (
ö_size
>>16) & 0xff;

195 *
˝
++ = (
ö_size
>>24) & 0xff;

197 
	`memmove
(
out_buf
 + 
èb_size
, 
±r
, 
out_íd
-ptr);

199  
out_buf
;

200 
	}
}

203 
	mR
[
TOTFREQ
];

204 } 
	t¨i_decodî
;

206 *
	$øns_uncom¥ess_O0
(*
ö
, 
ö_size
,

207 *
out_size
) {

209 *
˝
 = 
ö
 + 9;

210 *
˝_íd
 = 
ö
 + 
ö_size
;

211 
i
, 
j
, 
x
, 
out_sz
, 
ö_sz
, 
æe
;

212 *
out_buf
;

213 
¨i_decodî
 
D
;

214 
R™sDecSymbﬁ
 
syms
[256];

216 i‡(
ö_size
 < 26)

217  
NULL
;

219 i‡(*
ö
++ != 0)

220  
NULL
;

222 
ö_sz
 = ((
ö
[0])<<0) | ((in[1])<<8) | ((in[2])<<16) | ((in[3])<<24);

223 
out_sz
 = ((
ö
[4])<<0) | ((in[5])<<8) | ((in[6])<<16) | ((in[7])<<24);

224 i‡(
ö_sz
 !
ö_size
-9)

225  
NULL
;

228 
æe
 = 
x
 = 0;

229 
j
 = *
˝
++;

231 
F
, 
C
;

232 i‡(
˝
 > 
˝_íd
 - 16Ë 
NULL
;

233 i‡((
F
 = *
˝
++) >= 128) {

234 
F
 &= ~128;

235 
F
 = ((F & 127Ë<< 8Ë| *
˝
++;

237 
C
 = 
x
;

239 
	`R™sDecSymbﬁInô
(&
syms
[
j
], 
C
, 
F
);

242 i‡(
x
 + 
F
 > 
TOTFREQ
)

243  
NULL
;

244 
	`mem£t
(&
D
.
R
[
x
], 
j
, 
F
);

246 
x
 +
F
;

248 i‡(!
æe
 && 
j
+1 =*
˝
) {

249 
j
 = *
˝
++;

250 
æe
 = *
˝
++;

251 } i‡(
æe
) {

252 
æe
--;

253 
j
++;

254 i‡(
j
 > 255)

255  
NULL
;

257 
j
 = *
˝
++;

259 } 
j
);

261 i‡(
x
 < 
TOTFREQ
-1 || x > TOTFREQ)

262  
NULL
;

263 i‡(
x
 < 
TOTFREQ
)

264 
D
.
R
[
x
] = D.R[x-1];

266 i‡(
˝
 > 
˝_íd
 - 16Ë 
NULL
;

268 
R™sSèã
 
øns0
, 
øns1
, 
øns2
, 
øns3
;

269 
uöt8_t
 *
±r
 = 
˝
;

270 
	`R™sDecInô
(&
øns0
, &
±r
);

271 
	`R™sDecInô
(&
øns1
, &
±r
);

272 
	`R™sDecInô
(&
øns2
, &
±r
);

273 
	`R™sDecInô
(&
øns3
, &
±r
);

275 
out_buf
 = 
	`mÆloc
(
out_sz
);

276 i‡(!
out_buf
)

277  
NULL
;

279 
out_íd
 = (
out_sz
&~3);

281 
R™sSèã
 
R
[4];

282 
R
[0] = 
øns0
;

283 
R
[1] = 
øns1
;

284 
R
[2] = 
øns2
;

285 
R
[3] = 
øns3
;

286 
uöt32_t
 
mask
 = (1u << 
TF_SHIFT
)-1;

288 
i
=0; i < 
out_íd
; i+=4) {

289 
uöt32_t
 
m
[4] = {
R
[0] & 
mask
,

290 
R
[1] & 
mask
,

291 
R
[2] & 
mask
,

292 
R
[3] & 
mask
};

293 
uöt8_t
 
c
[4] = {
D
.
R
[
m
[0]],

294 
D
.
R
[
m
[1]],

295 
D
.
R
[
m
[2]],

296 
D
.
R
[
m
[3]]};

297 
out_buf
[
i
+0] = 
c
[0];

298 
out_buf
[
i
+1] = 
c
[1];

299 
out_buf
[
i
+2] = 
c
[2];

300 
out_buf
[
i
+3] = 
c
[3];

318 
R
[0] = 
syms
[
c
[0]].
‰eq
 * (R[0]>>
TF_SHIFT
);

319 
R
[0] +
m
[0] - 
syms
[
c
[0]].
°¨t
;

320 
R
[1] = 
syms
[
c
[1]].
‰eq
 * (R[1]>>
TF_SHIFT
);

321 
R
[1] +
m
[1] - 
syms
[
c
[1]].
°¨t
;

322 
R
[2] = 
syms
[
c
[2]].
‰eq
 * (R[2]>>
TF_SHIFT
);

323 
R
[2] +
m
[2] - 
syms
[
c
[2]].
°¨t
;

324 
R
[3] = 
syms
[
c
[3]].
‰eq
 * (R[3]>>
TF_SHIFT
);

325 
R
[3] +
m
[3] - 
syms
[
c
[3]].
°¨t
;

327 i‡(
±r
 < 
˝_íd
 - 8) {

328 
	`R™sDecRí‹m
(&
R
[0], &
±r
);

329 
	`R™sDecRí‹m
(&
R
[1], &
±r
);

330 
	`R™sDecRí‹m
(&
R
[2], &
±r
);

331 
	`R™sDecRí‹m
(&
R
[3], &
±r
);

333 
	`R™sDecRí‹mSa„
(&
R
[0], &
±r
, 
˝_íd
);

334 
	`R™sDecRí‹mSa„
(&
R
[1], &
±r
, 
˝_íd
);

335 
	`R™sDecRí‹mSa„
(&
R
[2], &
±r
, 
˝_íd
);

336 
	`R™sDecRí‹mSa„
(&
R
[3], &
±r
, 
˝_íd
);

340 
out_sz
&3) {

342 
out_buf
[
out_íd
+2] = 
D
.
R
[
	`R™sDecGë
(&R[2], 
TF_SHIFT
)];

344 
out_buf
[
out_íd
+1] = 
D
.
R
[
	`R™sDecGë
(&R[1], 
TF_SHIFT
)];

346 
out_buf
[
out_íd
] = 
D
.
R
[
	`R™sDecGë
(&R[0], 
TF_SHIFT
)];

351 *
out_size
 = 
out_sz
;

353  (*)
out_buf
;

354 
	}
}

356 *
	$øns_com¥ess_O1
(*
ö
, 
ö_size
,

357 *
out_size
) {

358 *
out_buf
 = 
NULL
, *
out_íd
, *
˝
;

359 
œ°_i
, 
èb_size
, 
æe_i
, 
æe_j
;

360 
	`R™sEncSymbﬁ
 (*
syms
)[256] = 
NULL
;

361 (*
F
)[256] = 
NULL
;

362 *
T
 = 
NULL
;

363 
i
, 
j
;

364 
c
;

366 i‡(
ö_size
 < 4)

367  
	`øns_com¥ess_O0
(
ö
, 
ö_size
, 
out_size
);

369 
syms
 = 
	`mÆloc
(256 * (*syms));

370 i‡(!
syms
Ë
˛ónup
;

371 
F
 = 
	`ˇŒoc
(256, (*F));

372 i‡(!
F
Ë
˛ónup
;

373 
T
 = 
	`ˇŒoc
(256, (*T));

374 i‡(!
T
Ë
˛ónup
;

375 
out_buf
 = 
	`mÆloc
(1.05*
ö_size
 + 257*257*3 + 9);

376 i‡(!
out_buf
Ë
˛ónup
;

378 
out_íd
 = 
out_buf
 + ()(1.05*
ö_size
) + 257*257*3 + 9;

379 
˝
 = 
out_buf
+9;

387 
œ°_i
=
i
=0; i<
ö_size
; i++) {

388 
F
[
œ°_i
][
c
 = 
ö
[
i
]]++;

389 
T
[
œ°_i
]++;

390 
œ°_i
 = 
c
;

392 
F
[0][
ö
[1*(
ö_size
>>2)]]++;

393 
F
[0][
ö
[2*(
ö_size
>>2)]]++;

394 
F
[0][
ö
[3*(
ö_size
>>2)]]++;

395 
T
[0]+=3;

398 
æe_i
 = 
i
 = 0; i < 256; i++) {

399 
t2
, 
m
, 
M
;

400 
x
;

402 i‡(
T
[
i
] == 0)

406 
p
 = (()
TOTFREQ
)/
T
[
i
];

407 
n‹mÆi£_h¨dî
:

408 
t2
 = 
m
 = 
M
 = 
j
 = 0; j < 256; j++) {

409 i‡(!
F
[
i
][
j
])

412 i‡(
m
 < 
F
[
i
][
j
])

413 
m
 = 
F
[
i
][
j
], 
M
 = j;

416 i‡((
F
[
i
][
j
] *
p
) == 0)

417 
F
[
i
][
j
] = 1;

418 
t2
 +
F
[
i
][
j
];

421 
t2
++;

422 i‡(
t2
 < 
TOTFREQ
) {

423 
F
[
i
][
M
] +
TOTFREQ
-
t2
;

424 } i‡(
t2
-
TOTFREQ
 >
F
[
i
][
M
]/2) {

426 
p
 = .98; 
n‹mÆi£_h¨dî
;

428 
F
[
i
][
M
] -
t2
-
TOTFREQ
;

433 i‡(
æe_i
) {

434 
æe_i
--;

436 *
˝
++ = 
i
;

439 i‡(
i
 && 
T
[i-1]) {

440 
æe_i
=
i
+1;ÑÀ_i<256 && 
T
[rle_i];Ñle_i++)

442 
æe_i
 -
i
+1;

443 *
˝
++ = 
æe_i
;

447 *
F_i_
 = 
F
[
i
];

448 
x
 = 0;

449 
æe_j
 = 0;

450 
j
 = 0; j < 256; j++) {

451 i‡(
F_i_
[
j
]) {

455 i‡(
æe_j
) {

456 
æe_j
--;

458 *
˝
++ = 
j
;

459 i‡(!
æe_j
 && 
j
 && 
F_i_
[j-1]) {

460 
æe_j
=
j
+1;ÑÀ_j<256 && 
F_i_
[rle_j];Ñle_j++)

462 
æe_j
 -
j
+1;

463 *
˝
++ = 
æe_j
;

468 i‡(
F_i_
[
j
]<128) {

469 *
˝
++ = 
F_i_
[
j
];

471 *
˝
++ = 128 | (
F_i_
[
j
]>>8);

472 *
˝
++ = 
F_i_
[
j
]&0xff;

475 
	`R™sEncSymbﬁInô
(&
syms
[
i
][
j
], 
x
, 
F_i_
[j], 
TF_SHIFT
);

476 
x
 +
F_i_
[
j
];

479 *
˝
++ = 0;

481 *
˝
++ = 0;

484 
èb_size
 = 
˝
 - 
out_buf
;

485 
	`as£π
(
èb_size
 < 257*257*3);

487 
R™sSèã
 
øns0
, 
øns1
, 
øns2
, 
øns3
;

488 
	`R™sEncInô
(&
øns0
);

489 
	`R™sEncInô
(&
øns1
);

490 
	`R™sEncInô
(&
øns2
);

491 
	`R™sEncInô
(&
øns3
);

493 
uöt8_t
* 
±r
 = 
out_íd
;

495 
isz4
 = 
ö_size
>>2;

496 
i0
 = 1*
isz4
-2;

497 
i1
 = 2*
isz4
-2;

498 
i2
 = 3*
isz4
-2;

499 
i3
 = 4*
isz4
-2;

501 
l0
 = 
ö
[
i0
+1];

502 
l1
 = 
ö
[
i1
+1];

503 
l2
 = 
ö
[
i2
+1];

504 
l3
 = 
ö
[
i3
+1];

507 
l3
 = 
ö
[
ö_size
-1];

508 
i3
 = 
ö_size
-2; i3 > 4*
isz4
-2; i3--) {

509 
c3
 = 
ö
[
i3
];

510 
	`R™sEncPutSymbﬁ
(&
øns3
, &
±r
, &
syms
[
c3
][
l3
]);

511 
l3
 = 
c3
;

514 ; 
i0
 >0; i0--, 
i1
--, 
i2
--, 
i3
--) {

515 
c0
, 
c1
, 
c2
, 
c3
;

516 
R™sEncSymbﬁ
 *
s3
 = &
syms
[
c3
 = 
ö
[
i3
]][
l3
];

517 
R™sEncSymbﬁ
 *
s2
 = &
syms
[
c2
 = 
ö
[
i2
]][
l2
];

518 
R™sEncSymbﬁ
 *
s1
 = &
syms
[
c1
 = 
ö
[
i1
]][
l1
];

519 
R™sEncSymbﬁ
 *
s0
 = &
syms
[
c0
 = 
ö
[
i0
]][
l0
];

521 
	`R™sEncPutSymbﬁ
(&
øns3
, &
±r
, 
s3
);

522 
	`R™sEncPutSymbﬁ
(&
øns2
, &
±r
, 
s2
);

523 
	`R™sEncPutSymbﬁ
(&
øns1
, &
±r
, 
s1
);

524 
	`R™sEncPutSymbﬁ
(&
øns0
, &
±r
, 
s0
);

526 
l0
 = 
c0
;

527 
l1
 = 
c1
;

528 
l2
 = 
c2
;

529 
l3
 = 
c3
;

532 
	`R™sEncPutSymbﬁ
(&
øns3
, &
±r
, &
syms
[0][
l3
]);

533 
	`R™sEncPutSymbﬁ
(&
øns2
, &
±r
, &
syms
[0][
l2
]);

534 
	`R™sEncPutSymbﬁ
(&
øns1
, &
±r
, &
syms
[0][
l1
]);

535 
	`R™sEncPutSymbﬁ
(&
øns0
, &
±r
, &
syms
[0][
l0
]);

537 
	`R™sEncFlush
(&
øns3
, &
±r
);

538 
	`R™sEncFlush
(&
øns2
, &
±r
);

539 
	`R™sEncFlush
(&
øns1
, &
±r
);

540 
	`R™sEncFlush
(&
øns0
, &
±r
);

542 *
out_size
 = (
out_íd
 - 
±r
Ë+ 
èb_size
;

544 
˝
 = 
out_buf
;

545 *
˝
++ = 1;

547 *
˝
++ = ((*
out_size
-9)>> 0) & 0xff;

548 *
˝
++ = ((*
out_size
-9)>> 8) & 0xff;

549 *
˝
++ = ((*
out_size
-9)>>16) & 0xff;

550 *
˝
++ = ((*
out_size
-9)>>24) & 0xff;

552 *
˝
++ = (
ö_size
>> 0) & 0xff;

553 *
˝
++ = (
ö_size
>> 8) & 0xff;

554 *
˝
++ = (
ö_size
>>16) & 0xff;

555 *
˝
++ = (
ö_size
>>24) & 0xff;

557 
	`memmove
(
out_buf
 + 
èb_size
, 
±r
, 
out_íd
-ptr);

559 
˛ónup
:

560 
	`‰ì
(
syms
);

561 
	`‰ì
(
F
);

562 
	`‰ì
(
T
);

564  
out_buf
;

565 
	}
}

567 *
	$øns_uncom¥ess_O1
(*
ö
, 
ö_size
,

568 *
out_size
) {

570 *
˝
 = 
ö
 + 9;

571 *
±r_íd
 = 
ö
 + 
ö_size
;

572 
i
, 
j
 = -999, 
x
, 
out_sz
, 
ö_sz
, 
æe_i
, 
æe_j
;

573 *
out_buf
 = 
NULL
;

574 
¨i_decodî
 *
D
 = 
NULL
;

575 
	`R™sDecSymbﬁ
 (*
syms
)[256] = 
NULL
;

577 i‡(
ö_size
 < 27)

578  
NULL
;

580 i‡(*
ö
++ != 1)

581  
NULL
;

583 
ö_sz
 = ((
ö
[0])<<0) | ((in[1])<<8) | ((in[2])<<16) | ((in[3])<<24);

584 
out_sz
 = ((
ö
[4])<<0) | ((in[5])<<8) | ((in[6])<<16) | ((in[7])<<24);

585 i‡(
ö_sz
 !
ö_size
-9)

586  
NULL
;

590 
D
 = 
	`ˇŒoc
(256, (*D));

591 i‡(!
D
Ë
˛ónup
;

592 
syms
 = 
	`mÆloc
(256 * (*syms));

593 
	`mem£t
(&
syms
[0], 0, (syms[0]));

598 
æe_i
 = 0;

599 
i
 = *
˝
++;

601 
æe_j
 = 
x
 = 0;

602 
j
 = *
˝
++;

604 
F
, 
C
;

605 i‡(
˝
 > 
±r_íd
 - 16Ë
˛ónup
;

606 i‡((
F
 = *
˝
++) >= 128) {

607 
F
 &= ~128;

608 
F
 = ((F & 127Ë<< 8Ë| *
˝
++;

610 
C
 = 
x
;

614 i‡(!
F
)

615 
F
 = 
TOTFREQ
;

617 
	`R™sDecSymbﬁInô
(&
syms
[
i
][
j
], 
C
, 
F
);

620 i‡(
x
 + 
F
 > 
TOTFREQ
)

621 
˛ónup
;

622 
	`mem£t
(&
D
[
i
].
R
[
x
], 
j
, 
F
);

624 
x
 +
F
;

626 i‡(!
æe_j
 && 
j
+1 =*
˝
) {

627 
j
 = *
˝
++;

628 
æe_j
 = *
˝
++;

629 } i‡(
æe_j
) {

630 
æe_j
--;

631 
j
++;

632 i‡(
j
 > 255)

633 
˛ónup
;

635 
j
 = *
˝
++;

637 } 
j
);

639 i‡(
x
 < 
TOTFREQ
-1 || x > TOTFREQ)

640 
˛ónup
;

641 i‡(
x
 < 
TOTFREQ
)

642 
D
[
i
].
R
[
x
] = D[i].R[x-1];

644 i‡(!
æe_i
 && 
i
+1 =*
˝
) {

645 
i
 = *
˝
++;

646 
æe_i
 = *
˝
++;

647 } i‡(
æe_i
) {

648 
æe_i
--;

649 
i
++;

650 i‡(
i
 > 255)

651 
˛ónup
;

653 
i
 = *
˝
++;

655 } 
i
);

659 
R™sSèã
 
øns0
, 
øns1
, 
øns2
, 
øns3
;

660 
uöt8_t
 *
±r
 = 
˝
;

661 i‡(
±r
 > 
±r_íd
 - 16Ë
˛ónup
;

662 
	`R™sDecInô
(&
øns0
, &
±r
); i‡‘™s0 < 
RANS_BYTE_L
Ë
˛ónup
;

663 
	`R™sDecInô
(&
øns1
, &
±r
); i‡‘™s1 < 
RANS_BYTE_L
Ë
˛ónup
;

664 
	`R™sDecInô
(&
øns2
, &
±r
); i‡‘™s2 < 
RANS_BYTE_L
Ë
˛ónup
;

665 
	`R™sDecInô
(&
øns3
, &
±r
); i‡‘™s3 < 
RANS_BYTE_L
Ë
˛ónup
;

667 
isz4
 = 
out_sz
>>2;

668 
l0
 = 0;

669 
l1
 = 0;

670 
l2
 = 0;

671 
l3
 = 0;

672 
i4
[] = {0*
isz4
, 1*isz4, 2*isz4, 3*isz4};

674 
R™sSèã
 
R
[4];

675 
R
[0] = 
øns0
;

676 
R
[1] = 
øns1
;

677 
R
[2] = 
øns2
;

678 
R
[3] = 
øns3
;

681 
out_buf
 = 
	`mÆloc
(
out_sz
);

682 i‡(!
out_buf
Ë
˛ónup
;

684 ; 
i4
[0] < 
isz4
; i4[0]++, i4[1]++, i4[2]++, i4[3]++) {

685 
uöt32_t
 
m
[4] = {
R
[0] & ((1u << 
TF_SHIFT
)-1),

686 
R
[1] & ((1u << 
TF_SHIFT
)-1),

687 
R
[2] & ((1u << 
TF_SHIFT
)-1),

688 
R
[3] & ((1u << 
TF_SHIFT
)-1)};

690 
uöt8_t
 
c
[4] = {
D
[
l0
].
R
[
m
[0]],

691 
D
[
l1
].
R
[
m
[1]],

692 
D
[
l2
].
R
[
m
[2]],

693 
D
[
l3
].
R
[
m
[3]]};

695 
out_buf
[
i4
[0]] = 
c
[0];

696 
out_buf
[
i4
[1]] = 
c
[1];

697 
out_buf
[
i4
[2]] = 
c
[2];

698 
out_buf
[
i4
[3]] = 
c
[3];

705 
R
[0] = 
syms
[
l0
][
c
[0]].
‰eq
 * (R[0]>>
TF_SHIFT
);

706 
R
[0] +
m
[0] - 
syms
[
l0
][
c
[0]].
°¨t
;

707 
R
[1] = 
syms
[
l1
][
c
[1]].
‰eq
 * (R[1]>>
TF_SHIFT
);

708 
R
[1] +
m
[1] - 
syms
[
l1
][
c
[1]].
°¨t
;

709 
R
[2] = 
syms
[
l2
][
c
[2]].
‰eq
 * (R[2]>>
TF_SHIFT
);

710 
R
[2] +
m
[2] - 
syms
[
l2
][
c
[2]].
°¨t
;

711 
R
[3] = 
syms
[
l3
][
c
[3]].
‰eq
 * (R[3]>>
TF_SHIFT
);

712 
R
[3] +
m
[3] - 
syms
[
l3
][
c
[3]].
°¨t
;

714 i‡(
±r
 < 
±r_íd
 - 8) {

715 
	`R™sDecRí‹m
(&
R
[0], &
±r
);

716 
	`R™sDecRí‹m
(&
R
[1], &
±r
);

717 
	`R™sDecRí‹m
(&
R
[2], &
±r
);

718 
	`R™sDecRí‹m
(&
R
[3], &
±r
);

720 
	`R™sDecRí‹mSa„
(&
R
[0], &
±r
, 
±r_íd
);

721 
	`R™sDecRí‹mSa„
(&
R
[1], &
±r
, 
±r_íd
);

722 
	`R™sDecRí‹mSa„
(&
R
[2], &
±r
, 
±r_íd
);

723 
	`R™sDecRí‹mSa„
(&
R
[3], &
±r
, 
±r_íd
);

726 
l0
 = 
c
[0];

727 
l1
 = 
c
[1];

728 
l2
 = 
c
[2];

729 
l3
 = 
c
[3];

733 ; 
i4
[3] < 
out_sz
; i4[3]++) {

734 
c3
 = 
D
[
l3
].
R
[
	`R™sDecGë
(&R[3], 
TF_SHIFT
)];

735 
out_buf
[
i4
[3]] = 
c3
;

737 
uöt32_t
 
m
 = 
R
[3] & ((1u << 
TF_SHIFT
)-1);

738 
R
[3] = 
syms
[
l3
][
c3
].
‰eq
 * (R[3]>>
TF_SHIFT
Ë+ 
m
 - syms[l3][c3].
°¨t
;

739 
	`R™sDecRí‹mSa„
(&
R
[3], &
±r
, 
±r_íd
);

740 
l3
 = 
c3
;

743 *
out_size
 = 
out_sz
;

745 
˛ónup
:

746 i‡(
D
)

747 
	`‰ì
(
D
);

748 
	`‰ì
(
syms
);

750  (*)
out_buf
;

751 
	}
}

756 *
	$øns_com¥ess
(*
ö
, 
ö_size
,

757 *
out_size
, 
‹dî
) {

758  
‹dî


759 ? 
	`øns_com¥ess_O1
(
ö
, 
ö_size
, 
out_size
)

760 : 
	`øns_com¥ess_O0
(
ö
, 
ö_size
, 
out_size
);

761 
	}
}

763 *
	$øns_uncom¥ess
(*
ö
, 
ö_size
,

764 *
out_size
) {

767 i‡(
ö_size
 < 9)

768  
NULL
;

769  
ö
[0]

770 ? 
	`øns_uncom¥ess_O1
(
ö
, 
ö_size
, 
out_size
)

771 : 
	`øns_uncom¥ess_O0
(
ö
, 
ö_size
, 
out_size
);

772 
	}
}

775 #ifde‡
TEST_MAIN


790 
	$maö
(
¨gc
, **
¨gv
) {

791 
›t
, 
‹dî
 = 0;

792 
ö_buf
[
BLK_SIZE2
+257*257*3];

793 
decode
 = 0;

794 
FILE
 *
öÂ
 = 
°dö
, *
outÂ
 = 
°dout
;

795 
timevÆ
 
tv1
, 
tv2
;

796 
size_t
 
byãs
 = 0;

798 *
›èrg
;

799 
›töd
;

801 (
›t
 = 
	`gë›t
(
¨gc
, 
¨gv
, "o:d")) != -1) {

802 
›t
) {

804 
‹dî
 = 
	`©oi
(
›èrg
);

808 
decode
 = 1;

813 
‹dî
 = order ? 1 : 0;

815 i‡(
›töd
 < 
¨gc
) {

816 i‡(!(
öÂ
 = 
	`f›í
(
¨gv
[
›töd
], "rb"))) {

817 
	`≥º‹
(
¨gv
[
›töd
]);

820 
›töd
++;

823 i‡(
›töd
 < 
¨gc
) {

824 i‡(!(
outÂ
 = 
	`f›í
(
¨gv
[
›töd
], "wb"))) {

825 
	`≥º‹
(
¨gv
[
›töd
]);

828 
›töd
++;

831 
	`gëtimeofday
(&
tv1
, 
NULL
);

833 i‡(
decode
) {

839 
uöt32_t
 
ö_size
, 
out_size
;

840 *
out
;

842 i‡(9 !
	`‰ód
(
ö_buf
, 1, 9, 
öÂ
))

844 
ö_size
 = *(*)&
ö_buf
[1];

845 i‡(
ö_size
 !
	`‰ód
(
ö_buf
+9, 1, in_size, 
öÂ
)) {

846 
	`Ârötf
(
°dîr
, "Truncated input\n");

847 
	`exô
(1);

849 
out
 = 
	`øns_uncom¥ess
(
ö_buf
, 
ö_size
+9, &
out_size
);

850 i‡(!
out
)

851 
	`ab‹t
();

853 
	`fwrôe
(
out
, 1, 
out_size
, 
outÂ
);

854 
	`‰ì
(
out
);

856 
byãs
 +
out_size
;

860 
uöt32_t
 
ö_size
, 
out_size
;

861 *
out
;

863 
ö_size
 = 
	`‰ód
(
ö_buf
, 1, 
BLK_SIZE
, 
öÂ
);

864 i‡(
ö_size
 <= 0)

867 
out
 = 
	`øns_com¥ess
(
ö_buf
, 
ö_size
, &
out_size
, 
‹dî
);

869 
	`fwrôe
(
out
, 1, 
out_size
, 
outÂ
);

870 
	`‰ì
(
out
);

872 
byãs
 +
ö_size
;

876 
	`gëtimeofday
(&
tv2
, 
NULL
);

878 
	`Ârötf
(
°dîr
, "Took %ld microseconds, %5.1f MB/s\n",

879 ()(
tv2
.
tv_£c
 - 
tv1
.tv_sec)*1000000 +

880 
tv2
.
tv_u£c
 - 
tv1
.tv_usec,

881 ()
byãs
 / (()(
tv2
.
tv_£c
 - 
tv1
.tv_sec)*1000000 +

882 
tv2
.
tv_u£c
 - 
tv1
.tv_usec));

884 
	}
}

	@htslib/cram/rANS_static.h

35 #i‚de‡
RANS_STATIC_H


36 
	#RANS_STATIC_H


	)

38 #ifde‡
__˝lu•lus


42 *
øns_com¥ess
(*
ö
, 
ö_size
,

43 *
out_size
, 
‹dî
);

44 *
øns_uncom¥ess
(*
ö
, 
ö_size
,

45 *
out_size
);

47 #ifde‡
__˝lu•lus


	@htslib/cram/sam_header.c

31 
	~<c⁄fig.h
>

33 
	~<°rög.h
>

34 
	~<as£π.h
>

36 
	~"¸am/ßm_hódî.h
"

37 
	~"¸am/°rög_Æloc.h
"

39 
	$ßm_hdr_îr‹
(*
msg
, *
löe
, 
Àn
, 
 o
) {

40 
j
;

42 
j
 = 0; j < 
Àn
 && 
löe
[j] != '\n'; j++)

44 
	`Ârötf
(
°dîr
, "%†©Üöê%d: \"%.*s\"\n", 
msg
, 
 o
, 
j
, 
löe
);

45 
	}
}

47 
	$ßm_hdr_dump
(
SAM_hdr
 *
hdr
) {

48 
khöt_t
 
k
;

49 
i
;

51 
	`¥ötf
("===DUMP===\n");

52 
k
 = 
	`kh_begö
(
hdr
->
h
); k !
	`kh_íd
(hdr->h); k++) {

53 
SAM_hdr_ty≥
 *
t1
, *
t2
;

54 
c
[2];

56 i‡(!
	`kh_exi°
(
hdr
->
h
, 
k
))

59 
t1
 = 
t2
 = 
	`kh_vÆ
(
hdr
->
h
, 
k
);

60 
c
[0] = 
	`kh_key
(
hdr
->
h
, 
k
)>>8;

61 
c
[1] = 
	`kh_key
(
hdr
->
h
, 
k
)&0xff;

62 
	`¥ötf
("Ty≥ %.2s, cou¡ %d\n", 
c
, 
t1
->
¥ev
->
‹dî
+1);

65 
SAM_hdr_èg
 *
èg
;

66 
	`¥ötf
(">>>%d ", 
t1
->
‹dî
);

67 
èg
 = 
t1
->èg;Åag;ÅagÒag->
√xt
) {

68 
	`¥ötf
("\"%.2s\":\"%.*s\"\t",

69 
èg
->
°r
,Åag->
Àn
-3,Åag->str+3);

71 
	`putch¨
('\n');

72 
t1
 =Å1->
√xt
;

73 } 
t1
 !
t2
);

77 
	`¥ötf
("\n@PG chains:\n");

78 
i
 = 0; i < 
hdr
->
≈g_íd
; i++) {

79 
j
;

80 
	`¥ötf
(" %d:", 
i
);

81 
j
 = 
hdr
->
pg_íd
[
i
]; j !-1; j = hdr->
pg
[j].
¥ev_id
) {

82 
	`¥ötf
("%s%d(%.*s)",

83 
j
 =
hdr
->
pg_íd
[
i
] ? " " : "->",

84 
j
, 
hdr
->
pg
[j].
«me_Àn
, hdr->pg[j].
«me
);

86 
	`¥ötf
("\n");

89 
	`puts
("===END DUMP===");

90 
	}
}

97 
	$ßm_hdr_upd©e_hashes
(
SAM_hdr
 *
sh
,

98 
ty≥
,

99 
SAM_hdr_ty≥
 *
h_ty≥
) {

101 i‡((
ty≥
>>8) == 'S' && (type&0xff) == 'Q') {

102 
SAM_hdr_èg
 *
èg
;

103 
SAM_SQ
 *
√w_ªf
;

104 
ƒef
 = 
sh
->nref;

106 
√w_ªf
 = 
	`ªÆloc
(
sh
->
ªf
, (sh->
ƒef
+1)*(*sh->ref));

107 i‡(!
√w_ªf
)

109 
sh
->
ªf
 = 
√w_ªf
;

111 
èg
 = 
h_ty≥
->tag;

112 
sh
->
ªf
[
ƒef
].
«me
 = 
NULL
;

113 
sh
->
ªf
[
ƒef
].
Àn
 = 0;

114 
sh
->
ªf
[
ƒef
].
ty
 = 
h_ty≥
;

115 
sh
->
ªf
[
ƒef
].
èg
 =Åag;

117 
èg
) {

118 i‡(
èg
->
°r
[0] == 'S' &&Åag->str[1] == 'N') {

119 i‡(!(
sh
->
ªf
[
ƒef
].
«me
 = 
	`mÆloc
(
èg
->
Àn
)))

121 
	`°∫˝y
(
sh
->
ªf
[
ƒef
].
«me
, 
èg
->
°r
+3,Åag->
Àn
-3);

122 
sh
->
ªf
[
ƒef
].
«me
[
èg
->
Àn
-3] = 0;

123 } i‡(
èg
->
°r
[0] == 'L' &&Åag->str[1] == 'N') {

124 
sh
->
ªf
[
ƒef
].
Àn
 = 
	`©oi
(
èg
->
°r
+3);

126 
èg
 =Åag->
√xt
;

129 i‡(
sh
->
ªf
[
ƒef
].
«me
) {

130 
khöt_t
 
k
;

131 
r
;

132 
k
 = 
	`kh_put
(
m_s2i
, 
sh
->
ªf_hash
, sh->
ªf
[
ƒef
].
«me
, &
r
);

133 i‡(-1 =
r
)  -1;

134 
	`kh_vÆ
(
sh
->
ªf_hash
, 
k
Ë
ƒef
;

139 
sh
->
ƒef
++;

143 i‡((
ty≥
>>8) == 'R' && (type&0xff) == 'G') {

144 
SAM_hdr_èg
 *
èg
;

145 
SAM_RG
 *
√w_rg
;

146 
ƒg
 = 
sh
->nrg;

148 
√w_rg
 = 
	`ªÆloc
(
sh
->
rg
, (sh->
ƒg
+1)*(*sh->rg));

149 i‡(!
√w_rg
)

151 
sh
->
rg
 = 
√w_rg
;

153 
èg
 = 
h_ty≥
->tag;

154 
sh
->
rg
[
ƒg
].
«me
 = 
NULL
;

155 
sh
->
rg
[
ƒg
].
«me_Àn
 = 0;

156 
sh
->
rg
[
ƒg
].
ty
 = 
h_ty≥
;

157 
sh
->
rg
[
ƒg
].
èg
 =Åag;

158 
sh
->
rg
[
ƒg
].
id
 =Çrg;

160 
èg
) {

161 i‡(
èg
->
°r
[0] == 'I' &&Åag->str[1] == 'D') {

162 i‡(!(
sh
->
rg
[
ƒg
].
«me
 = 
	`mÆloc
(
èg
->
Àn
)))

164 
	`°∫˝y
(
sh
->
rg
[
ƒg
].
«me
, 
èg
->
°r
+3,Åag->
Àn
-3);

165 
sh
->
rg
[
ƒg
].
«me
[
èg
->
Àn
-3] = 0;

166 
sh
->
rg
[
ƒg
].
«me_Àn
 = 
	`°æí
(sh->rg[ƒg].
«me
);

168 
èg
 =Åag->
√xt
;

171 i‡(
sh
->
rg
[
ƒg
].
«me
) {

172 
khöt_t
 
k
;

173 
r
;

174 
k
 = 
	`kh_put
(
m_s2i
, 
sh
->
rg_hash
, sh->
rg
[
ƒg
].
«me
, &
r
);

175 i‡(-1 =
r
)  -1;

176 
	`kh_vÆ
(
sh
->
rg_hash
, 
k
Ë
ƒg
;

181 
sh
->
ƒg
++;

185 i‡((
ty≥
>>8) == 'P' && (type&0xff) == 'G') {

186 
SAM_hdr_èg
 *
èg
;

187 
SAM_PG
 *
√w_pg
;

188 
≈g
 = 
sh
->npg;

190 
√w_pg
 = 
	`ªÆloc
(
sh
->
pg
, (sh->
≈g
+1)*(*sh->pg));

191 i‡(!
√w_pg
)

193 
sh
->
pg
 = 
√w_pg
;

195 
èg
 = 
h_ty≥
->tag;

196 
sh
->
pg
[
≈g
].
«me
 = 
NULL
;

197 
sh
->
pg
[
≈g
].
«me_Àn
 = 0;

198 
sh
->
pg
[
≈g
].
ty
 = 
h_ty≥
;

199 
sh
->
pg
[
≈g
].
èg
 =Åag;

200 
sh
->
pg
[
≈g
].
id
 =Çpg;

201 
sh
->
pg
[
≈g
].
¥ev_id
 = -1;

203 
èg
) {

204 i‡(
èg
->
°r
[0] == 'I' &&Åag->str[1] == 'D') {

205 i‡(!(
sh
->
pg
[
≈g
].
«me
 = 
	`mÆloc
(
èg
->
Àn
)))

207 
	`°∫˝y
(
sh
->
pg
[
≈g
].
«me
, 
èg
->
°r
+3,Åag->
Àn
-3);

208 
sh
->
pg
[
≈g
].
«me
[
èg
->
Àn
-3] = 0;

209 
sh
->
pg
[
≈g
].
«me_Àn
 = 
	`°æí
(sh->pg[≈g].
«me
);

210 } i‡(
èg
->
°r
[0] == 'P' &&Åag->str[1] == 'P') {

212 
khöt_t
 
k
;

213 
tmp
 = 
èg
->
°r
[èg->
Àn
];Åag->str[tag->len] = 0;

214 
k
 = 
	`kh_gë
(
m_s2i
, 
sh
->
pg_hash
, 
èg
->
°r
+3);

215 
èg
->
°r
[èg->
Àn
] = 
tmp
;

217 i‡(
k
 !
	`kh_íd
(
sh
->
pg_hash
)) {

218 
p_id
 = 
	`kh_vÆ
(
sh
->
pg_hash
, 
k
);

219 
sh
->
pg
[
≈g
].
¥ev_id
 = sh->pg[
p_id
].
id
;

222 i‡(
sh
->
≈g_íd
 > 0 &&

223 
sh
->
pg_íd
[sh->
≈g_íd
-1] =
p_id
) {

224 
sh
->
≈g_íd
--;

226 
i
;

227 
i
 = 0; i < 
sh
->
≈g_íd
; i++) {

228 i‡(
sh
->
pg_íd
[
i
] =
p_id
) {

229 
	`memmove
(&
sh
->
pg_íd
[
i
], &sh->pg_end[i+1],

230 (
sh
->
≈g_íd
-
i
-1)*(*sh->
pg_íd
));

231 
sh
->
≈g_íd
--;

236 
sh
->
pg
[
≈g
].
¥ev_id
 = -1;

239 
èg
 =Åag->
√xt
;

242 i‡(
sh
->
pg
[
≈g
].
«me
) {

243 
khöt_t
 
k
;

244 
r
;

245 
k
 = 
	`kh_put
(
m_s2i
, 
sh
->
pg_hash
, sh->
pg
[
≈g
].
«me
, &
r
);

246 i‡(-1 =
r
)  -1;

247 
	`kh_vÆ
(
sh
->
pg_hash
, 
k
Ë
≈g
;

253 i‡(
sh
->
≈g_íd
 >sh->
≈g_íd_Æloc
) {

254 *
√w_pg_íd
;

255 
√w_Æloc
 = 
sh
->
≈g_íd_Æloc
 ? sh->npg_end_alloc*2 : 4;

257 
√w_pg_íd
 = 
	`ªÆloc
(
sh
->
pg_íd
, 
√w_Æloc
 * ());

258 i‡(!
√w_pg_íd
)

260 
sh
->
≈g_íd_Æloc
 = 
√w_Æloc
;

261 
sh
->
pg_íd
 = 
√w_pg_íd
;

263 
sh
->
pg_íd
[sh->
≈g_íd
++] = 
≈g
;

265 
sh
->
≈g
++;

269 
	}
}

283 
	$ßm_hdr_add_löes
(
SAM_hdr
 *
sh
, c⁄° *
löes
, 
Àn
) {

284 
i
, 
 o
, 
ãxt_off£t
;

285 *
hdr
;

287 i‡(!
Àn
)

288 
Àn
 = 
	`°æí
(
löes
);

290 
ãxt_off£t
 = 
	`ks_Àn
(&
sh
->
ãxt
);

291 i‡(
EOF
 =
	`kput¢
(
löes
, 
Àn
, &
sh
->
ãxt
))

293 
hdr
 = 
	`ks_°r
(&
sh
->
ãxt
Ë+ 
ãxt_off£t
;

295 
i
 = 0, 
 o
 = 1; i < 
Àn
 && 
hdr
[i] != '\0'; i++,Üno++) {

296 
khöt32_t
 
ty≥
;

297 
khöt_t
 
k
;

299 
l_°¨t
 = 
i
, 
√w
;

300 
SAM_hdr_ty≥
 *
h_ty≥
;

301 
SAM_hdr_èg
 *
h_èg
, *
œ°
;

303 i‡(
hdr
[
i
] != '@') {

304 
j
;

305 
j
 = 
i
; j < 
Àn
 && 
hdr
[j] != '\0' && hdr[j] != '\n'; j++)

307 
	`ßm_hdr_îr‹
("HeaderÜine doesÇot start with '@'",

308 &
hdr
[
l_°¨t
], 
Àn
 -Ü_°¨t, 
 o
);

312 
ty≥
 = (
hdr
[
i
+1]<<8) | hdr[i+2];

313 i‡(
hdr
[
i
+1] < 'A' || hdr[i+1] > 'z' ||

314 
hdr
[
i
+2] < 'A' || hdr[i+2] > 'z') {

315 
	`ßm_hdr_îr‹
("HeaderÜine doesÇot haveáÅwo character key",

316 &
hdr
[
l_°¨t
], 
Àn
 -Ü_°¨t, 
 o
);

320 
i
 += 3;

321 i‡(
hdr
[
i
] == '\n')

325 i‡(!(
h_ty≥
 = 
	`poﬁ_Æloc
(
sh
->
ty≥_poﬁ
)))

327 i‡(-1 =(
k
 = 
	`kh_put
(
ßm_hdr
, 
sh
->
h
, 
ty≥
, &
√w
)))

331 i‡(!
√w
) {

332 
SAM_hdr_ty≥
 *
t
 = 
	`kh_vÆ
(
sh
->
h
, 
k
), *
p
;

333 
p
 = 
t
->
¥ev
;

335 
	`as£π
(
p
->
√xt
 =
t
);

336 
p
->
√xt
 = 
h_ty≥
;

337 
h_ty≥
->
¥ev
 = 
p
;

339 
t
->
¥ev
 = 
h_ty≥
;

340 
h_ty≥
->
√xt
 = 
t
;

341 
h_ty≥
->
‹dî
 = 
p
->order+1;

343 
	`kh_vÆ
(
sh
->
h
, 
k
Ë
h_ty≥
;

344 
h_ty≥
->
¥ev
 = h_ty≥->
√xt
 = h_type;

345 
h_ty≥
->
‹dî
 = 0;

349 
œ°
 = 
NULL
;

350 i‡((
ty≥
>>8) == 'C' && (type&0xff) == 'O') {

351 
j
;

352 i‡(
hdr
[
i
] != '\t') {

353 
	`ßm_hdr_îr‹
("MissingÅab",

354 &
hdr
[
l_°¨t
], 
Àn
 -Ü_°¨t, 
 o
);

358 
j
 = ++
i
; j < 
Àn
 && 
hdr
[j] != '\0' && hdr[j] != '\n'; j++)

361 i‡(!(
h_ty≥
->
èg
 = 
h_èg
 = 
	`poﬁ_Æloc
(
sh
->
èg_poﬁ
)))

363 
h_èg
->
°r
 = 
	`°rög_ndup
(
sh
->
°r_poﬁ
, &
hdr
[
i
], 
j
-i);

364 
h_èg
->
Àn
 = 
j
-
i
;

365 
h_èg
->
√xt
 = 
NULL
;

366 i‡(!
h_èg
->
°r
)

369 
i
 = 
j
;

373 
j
;

374 i‡(
hdr
[
i
] != '\t') {

375 
	`ßm_hdr_îr‹
("MissingÅab",

376 &
hdr
[
l_°¨t
], 
Àn
 -Ü_°¨t, 
 o
);

380 
j
 = ++
i
; j < 
Àn
 && 
hdr
[j] != '\0' && hdr[j] != '\n' && hdr[j] != '\t'; j++)

383 i‡(!(
h_èg
 = 
	`poﬁ_Æloc
(
sh
->
èg_poﬁ
)))

385 
h_èg
->
°r
 = 
	`°rög_ndup
(
sh
->
°r_poﬁ
, &
hdr
[
i
], 
j
-i);

386 
h_èg
->
Àn
 = 
j
-
i
;

387 
h_èg
->
√xt
 = 
NULL
;

388 i‡(!
h_èg
->
°r
)

391 i‡(
h_èg
->
Àn
 < 3 || h_èg->
°r
[2] != ':') {

392 
	`ßm_hdr_îr‹
("Malformed key:valueÖair",

393 &
hdr
[
l_°¨t
], 
Àn
 -Ü_°¨t, 
 o
);

397 i‡(
œ°
)

398 
œ°
->
√xt
 = 
h_èg
;

400 
h_ty≥
->
èg
 = 
h_èg
;

402 
œ°
 = 
h_èg
;

403 
i
 = 
j
;

404 } 
i
 < 
Àn
 && 
hdr
[i] != '\0' && hdr[i] != '\n');

408 i‡(-1 =
	`ßm_hdr_upd©e_hashes
(
sh
, 
ty≥
, 
h_ty≥
))

413 
	}
}

423 
	$ßm_hdr_add
(
SAM_hdr
 *
sh
, c⁄° *
ty≥
, ...) {

424 
va_li°
 
¨gs
;

425 
	`va_°¨t
(
¨gs
, 
ty≥
);

426  
	`ßm_hdr_vadd
(
sh
, 
ty≥
, 
¨gs
, 
NULL
);

427 
	}
}

436 
	$ßm_hdr_vadd
(
SAM_hdr
 *
sh
, c⁄° *
ty≥
, 
va_li°
 
≠
, ...) {

437 
va_li°
 
¨gs
;

438 
SAM_hdr_ty≥
 *
h_ty≥
;

439 
SAM_hdr_èg
 *
h_èg
, *
œ°
;

440 
√w
;

441 
khöt32_t
 
ty≥_i
 = (
ty≥
[0]<<8Ë|Åy≥[1], 
k
;

443 i‡(
EOF
 =
	`kputc_
('@', &
sh
->
ãxt
))

445 i‡(
EOF
 =
	`kput¢
(
ty≥
, 2, &
sh
->
ãxt
))

448 i‡(!(
h_ty≥
 = 
	`poﬁ_Æloc
(
sh
->
ty≥_poﬁ
)))

450 i‡(-1 =(
k
 = 
	`kh_put
(
ßm_hdr
, 
sh
->
h
, 
ty≥_i
, &
√w
)))

454 i‡(!
√w
) {

455 
SAM_hdr_ty≥
 *
t
 = 
	`kh_vÆ
(
sh
->
h
, 
k
), *
p
;

456 
p
 = 
t
->
¥ev
;

458 
	`as£π
(
p
->
√xt
 =
t
);

459 
p
->
√xt
 = 
h_ty≥
;

460 
h_ty≥
->
¥ev
 = 
p
;

462 
t
->
¥ev
 = 
h_ty≥
;

463 
h_ty≥
->
√xt
 = 
t
;

464 
h_ty≥
->
‹dî
 = 
p
->order + 1;

466 
	`kh_vÆ
(
sh
->
h
, 
k
Ë
h_ty≥
;

467 
h_ty≥
->
¥ev
 = h_ty≥->
√xt
 = h_type;

468 
h_ty≥
->
‹dî
 = 0;

471 
œ°
 = 
NULL
;

474 
	`va_°¨t
(
¨gs
, 
≠
);

476 *
k
, *
v
;

477 
idx
;

479 i‡(!(
k
 = (*)
	`va_¨g
(
¨gs
, *)))

481 
v
 = 
	`va_¨g
(
¨gs
, *);

483 i‡(
EOF
 =
	`kputc_
('\t', &
sh
->
ãxt
))

486 i‡(!(
h_èg
 = 
	`poﬁ_Æloc
(
sh
->
èg_poﬁ
)))

488 
idx
 = 
	`ks_Àn
(&
sh
->
ãxt
);

490 i‡(
EOF
 =
	`kputs
(
k
, &
sh
->
ãxt
))

492 i‡(
EOF
 =
	`kputc_
(':', &
sh
->
ãxt
))

494 i‡(
EOF
 =
	`kputs
(
v
, &
sh
->
ãxt
))

497 
h_èg
->
Àn
 = 
	`ks_Àn
(&
sh
->
ãxt
Ë- 
idx
;

498 
h_èg
->
°r
 = 
	`°rög_ndup
(
sh
->
°r_poﬁ
,

499 
	`ks_°r
(&
sh
->
ãxt
Ë+ 
idx
,

500 
h_èg
->
Àn
);

501 
h_èg
->
√xt
 = 
NULL
;

502 i‡(!
h_èg
->
°r
)

505 i‡(
œ°
)

506 
œ°
->
√xt
 = 
h_èg
;

508 
h_ty≥
->
èg
 = 
h_èg
;

510 
œ°
 = 
h_èg
;

512 
	`va_íd
(
¨gs
);

516 *
k
, *
v
;

517 
idx
;

519 i‡(!(
k
 = (*)
	`va_¨g
(
≠
, *)))

521 
v
 = 
	`va_¨g
(
≠
, *);

523 i‡(
EOF
 =
	`kputc_
('\t', &
sh
->
ãxt
))

526 i‡(!(
h_èg
 = 
	`poﬁ_Æloc
(
sh
->
èg_poﬁ
)))

528 
idx
 = 
	`ks_Àn
(&
sh
->
ãxt
);

530 i‡(
EOF
 =
	`kputs
(
k
, &
sh
->
ãxt
))

532 i‡(
EOF
 =
	`kputc_
(':', &
sh
->
ãxt
))

534 i‡(
EOF
 =
	`kputs
(
v
, &
sh
->
ãxt
))

537 
h_èg
->
Àn
 = 
	`ks_Àn
(&
sh
->
ãxt
Ë- 
idx
;

538 
h_èg
->
°r
 = 
	`°rög_ndup
(
sh
->
°r_poﬁ
,

539 
	`ks_°r
(&
sh
->
ãxt
Ë+ 
idx
,

540 
h_èg
->
Àn
);

541 
h_èg
->
√xt
 = 
NULL
;

542 i‡(!
h_èg
->
°r
)

545 i‡(
œ°
)

546 
œ°
->
√xt
 = 
h_èg
;

548 
h_ty≥
->
èg
 = 
h_èg
;

550 
œ°
 = 
h_èg
;

552 
	`va_íd
(
≠
);

554 i‡(
EOF
 =
	`kputc
('\n', &
sh
->
ãxt
))

557 
ôy≥
 = (
ty≥
[0]<<8) |Åype[1];

558 i‡(-1 =
	`ßm_hdr_upd©e_hashes
(
sh
, 
ôy≥
, 
h_ty≥
))

561  
h_ty≥
->
‹dî
;

562 
	}
}

570 
SAM_hdr_ty≥
 *
	$ßm_hdr_föd
(
SAM_hdr
 *
hdr
, *
ty≥
,

571 *
ID_key
, *
ID_vÆue
) {

572 
SAM_hdr_ty≥
 *
t1
, *
t2
;

573 
ôy≥
 = (
ty≥
[0]<<8)|(type[1]);

574 
khöt_t
 
k
;

577 i‡(
ID_key
) {

578 i‡(
ty≥
[0] == 'S' &&Åype[1] == 'Q' &&

579 
ID_key
[0] == 'S' && ID_key[1] == 'N') {

580 
k
 = 
	`kh_gë
(
m_s2i
, 
hdr
->
ªf_hash
, 
ID_vÆue
);

581  
k
 !
	`kh_íd
(
hdr
->
ªf_hash
)

582 ? 
hdr
->
ªf
[
	`kh_vÆ
(hdr->
ªf_hash
, 
k
)].
ty


583 : 
NULL
;

586 i‡(
ty≥
[0] == 'R' &&Åype[1] == 'G' &&

587 
ID_key
[0] == 'I' && ID_key[1] == 'D') {

588 
k
 = 
	`kh_gë
(
m_s2i
, 
hdr
->
rg_hash
, 
ID_vÆue
);

589  
k
 !
	`kh_íd
(
hdr
->
rg_hash
)

590 ? 
hdr
->
rg
[
	`kh_vÆ
(hdr->
rg_hash
, 
k
)].
ty


591 : 
NULL
;

594 i‡(
ty≥
[0] == 'P' &&Åype[1] == 'G' &&

595 
ID_key
[0] == 'I' && ID_key[1] == 'D') {

596 
k
 = 
	`kh_gë
(
m_s2i
, 
hdr
->
pg_hash
, 
ID_vÆue
);

597  
k
 !
	`kh_íd
(
hdr
->
pg_hash
)

598 ? 
hdr
->
pg
[
	`kh_vÆ
(hdr->
pg_hash
, 
k
)].
ty


599 : 
NULL
;

603 
k
 = 
	`kh_gë
(
ßm_hdr
, 
hdr
->
h
, 
ôy≥
);

604 i‡(
k
 =
	`kh_íd
(
hdr
->
h
))

605  
NULL
;

607 i‡(!
ID_key
)

608  
	`kh_vÆ
(
hdr
->
h
, 
k
);

610 
t1
 = 
t2
 = 
	`kh_vÆ
(
hdr
->
h
, 
k
);

612 
SAM_hdr_èg
 *
èg
;

613 
èg
 = 
t1
->èg;Åag;Åag =Åag->
√xt
) {

614 i‡(
èg
->
°r
[0] =
ID_key
[0] &&Åag->str[1] == ID_key[1]) {

615 *
˝1
 = 
èg
->
°r
+3;

616 *
˝2
 = 
ID_vÆue
;

617 *
˝1
 && *˝1 =*
˝2
)

618 
˝1
++, 
˝2
++;

619 i‡(*
˝2
 || *
˝1
)

621  
t1
;

624 
t1
 =Å1->
√xt
;

625 } 
t1
 !
t2
);

627  
NULL
;

628 
	}
}

640 *
	$ßm_hdr_föd_löe
(
SAM_hdr
 *
hdr
, *
ty≥
,

641 *
ID_key
, *
ID_vÆue
) {

642 
SAM_hdr_ty≥
 *
ty
 = 
	`ßm_hdr_föd
(
hdr
, 
ty≥
, 
ID_key
, 
ID_vÆue
);

643 
k°rög_t
 
ks
 = 
KS_INITIALIZER
;

644 
SAM_hdr_èg
 *
èg
;

645 
r
 = 0;

647 i‡(!
ty
)

648  
NULL
;

651 
r
 |(
	`kputc_
('@', &
ks
Ë=
EOF
);

652 
r
 |(
	`kputs
(
ty≥
, &
ks
Ë=
EOF
);

653 
èg
 = 
ty
->èg;Åag;Åag =Åag->
√xt
) {

654 
r
 |(
	`kputc_
('\t', &
ks
Ë=
EOF
);

655 
r
 |(
	`kput¢
(
èg
->
°r
,Åag->
Àn
, &
ks
Ë=
EOF
);

658 i‡(
r
) {

659 
	`KS_FREE
(&
ks
);

660  
NULL
;

663  
	`ks_°r
(&
ks
);

664 
	}
}

677 
SAM_hdr_èg
 *
	$ßm_hdr_föd_key
(
SAM_hdr
 *
sh
,

678 
SAM_hdr_ty≥
 *
ty≥
,

679 *
key
,

680 
SAM_hdr_èg
 **
¥ev
) {

681 
SAM_hdr_èg
 *
èg
, *
p
 = 
NULL
;

683 
èg
 = 
ty≥
->èg;Åag; 
p
 =Åag,Åag =Åag->
√xt
) {

684 i‡(
èg
->
°r
[0] =
key
[0] &&Åag->str[1] == key[1]) {

685 i‡(
¥ev
)

686 *
¥ev
 = 
p
;

687  
èg
;

691 i‡(
¥ev
)

692 *
¥ev
 = 
p
;

694  
NULL
;

695 
	}
}

709 
	$ßm_hdr_upd©e
(
SAM_hdr
 *
hdr
, 
SAM_hdr_ty≥
 *
ty≥
, ...) {

710 
va_li°
 
≠
;

712 
	`va_°¨t
(
≠
, 
ty≥
);

715 *
k
, *
v
;

716 
idx
;

717 
SAM_hdr_èg
 *
èg
, *
¥ev
;

719 i‡(!(
k
 = (*)
	`va_¨g
(
≠
, *)))

721 
v
 = 
	`va_¨g
(
≠
, *);

723 
èg
 = 
	`ßm_hdr_föd_key
(
hdr
, 
ty≥
, 
k
, &
¥ev
);

724 i‡(!
èg
) {

725 i‡(!(
èg
 = 
	`poﬁ_Æloc
(
hdr
->
èg_poﬁ
)))

727 i‡(
¥ev
)

728 
¥ev
->
√xt
 = 
èg
;

730 
ty≥
->
èg
 =Åag;

732 
èg
->
√xt
 = 
NULL
;

735 
idx
 = 
	`ks_Àn
(&
hdr
->
ãxt
);

736 i‡(
	`k•rötf
(&
hdr
->
ãxt
, "%2.2s:%s", 
k
, 
v
) < 0)

738 
èg
->
Àn
 = 
	`ks_Àn
(&
hdr
->
ãxt
Ë- 
idx
;

739 
èg
->
°r
 = 
	`°rög_ndup
(
hdr
->
°r_poﬁ
,

740 
	`ks_°r
(&
hdr
->
ãxt
Ë+ 
idx
,

741 
èg
->
Àn
);

742 i‡(!
èg
->
°r
)

746 
	`va_íd
(
≠
);

749 
	}
}

751 
	#K
(
a
Ë((◊)[0]<<8)|(◊)[1]))

	)

756 
ßm_s‹t_‹dî
 
	$ßm_hdr_s‹t_‹dî
(
SAM_hdr
 *
hdr
) {

757  
hdr
->
s‹t_‹dî
;

758 
	}
}

760 
ßm_s‹t_‹dî
 
	$ßm_hdr_∑r£_s‹t_‹dî
(
SAM_hdr
 *
hdr
) {

761 
khöt_t
 
k
;

762 
ßm_s‹t_‹dî
 
so
;

764 
so
 = 
ORDER_UNKNOWN
;

765 
k
 = 
	`kh_gë
(
ßm_hdr
, 
hdr
->
h
, 
	`K
("HD"));

766 i‡(
k
 !
	`kh_íd
(
hdr
->
h
)) {

767 
SAM_hdr_ty≥
 *
ty
 = 
	`kh_vÆ
(
hdr
->
h
, 
k
);

768 
SAM_hdr_èg
 *
èg
;

769 
èg
 = 
ty
->èg;Åag;Åag =Åag->
√xt
) {

770 i‡(
èg
->
°r
[0] == 'S' &&Åag->str[1] == 'O') {

771 i‡(
	`°rcmp
(
èg
->
°r
+3, "unsorted") == 0)

772 
so
 = 
ORDER_UNSORTED
;

773 i‡(
	`°rcmp
(
èg
->
°r
+3, "queryname") == 0)

774 
so
 = 
ORDER_NAME
;

775 i‡(
	`°rcmp
(
èg
->
°r
+3, "coordinate") == 0)

776 
so
 = 
ORDER_COORD
;

777 i‡(
	`°rcmp
(
èg
->
°r
+3, "unknown") != 0)

778 
	`Ârötf
(
°dîr
, "Unknown sort order field: %s\n",

779 
èg
->
°r
+3);

784  
so
;

785 
	}
}

793 
	$ßm_hdr_ªbuûd
(
SAM_hdr
 *
hdr
) {

795 
k°rög_t
 
ks
 = 
KS_INITIALIZER
;

796 
khöt_t
 
k
;

799 
k
 = 
	`kh_gë
(
ßm_hdr
, 
hdr
->
h
, 
	`K
("HD"));

800 i‡(
k
 !
	`kh_íd
(
hdr
->
h
)) {

801 
SAM_hdr_ty≥
 *
ty
 = 
	`kh_vÆ
(
hdr
->
h
, 
k
);

802 
SAM_hdr_èg
 *
èg
;

803 i‡(
EOF
 =
	`kputs
("@HD", &
ks
))

805 
èg
 = 
ty
->èg;Åag;Åag =Åag->
√xt
) {

806 i‡(
EOF
 =
	`kputc_
('\t', &
ks
))

808 i‡(
EOF
 =
	`kput¢_
(
èg
->
°r
,Åag->
Àn
, &
ks
))

811 i‡(
EOF
 =
	`kputc
('\n', &
ks
))

815 
k
 = 
	`kh_begö
(
hdr
->
h
); k !
	`kh_íd
(hdr->h); k++) {

816 
SAM_hdr_ty≥
 *
t1
, *
t2
;

818 i‡(!
	`kh_exi°
(
hdr
->
h
, 
k
))

821 i‡(
	`kh_key
(
hdr
->
h
, 
k
Ë=
	`K
("HD"))

824 
t1
 = 
t2
 = 
	`kh_vÆ
(
hdr
->
h
, 
k
);

826 
SAM_hdr_èg
 *
èg
;

827 
c
[2];

829 i‡(
EOF
 =
	`kputc_
('@', &
ks
))

831 
c
[0] = 
	`kh_key
(
hdr
->
h
, 
k
)>>8;

832 
c
[1] = 
	`kh_key
(
hdr
->
h
, 
k
)&0xff;

833 i‡(
EOF
 =
	`kput¢_
(
c
, 2, &
ks
))

835 
èg
 = 
t1
->èg;Åag;ÅagÒag->
√xt
) {

836 i‡(
EOF
 =
	`kputc_
('\t', &
ks
))

838 i‡(
EOF
 =
	`kput¢_
(
èg
->
°r
,Åag->
Àn
, &
ks
))

841 i‡(
EOF
 =
	`kputc
('\n', &
ks
))

843 
t1
 =Å1->
√xt
;

844 } 
t1
 !
t2
);

847 i‡(
	`ks_°r
(&
hdr
->
ãxt
))

848 
	`KS_FREE
(&
hdr
->
ãxt
);

850 
hdr
->
ãxt
 = 
ks
;

853 
	}
}

862 
SAM_hdr
 *
	$ßm_hdr_√w
() {

863 
SAM_hdr
 *
sh
 = 
	`ˇŒoc
(1, (*sh));

865 i‡(!
sh
)

866  
NULL
;

868 
sh
->
h
 = 
	`kh_öô
(
ßm_hdr
);

869 i‡(!
sh
->
h
)

870 
îr
;

872 
sh
->
ID_˙t
 = 1;

873 
sh
->
ªf_cou¡
 = 1;

875 
sh
->
ƒef
 = 0;

876 
sh
->
ªf
 = 
NULL
;

877 i‡(!(
sh
->
ªf_hash
 = 
	`kh_öô
(
m_s2i
)))

878 
îr
;

880 
sh
->
ƒg
 = 0;

881 
sh
->
rg
 = 
NULL
;

882 i‡(!(
sh
->
rg_hash
 = 
	`kh_öô
(
m_s2i
)))

883 
îr
;

885 
sh
->
≈g
 = 0;

886 
sh
->
pg
 = 
NULL
;

887 
sh
->
≈g_íd
 = sh->
≈g_íd_Æloc
 = 0;

888 
sh
->
pg_íd
 = 
NULL
;

889 i‡(!(
sh
->
pg_hash
 = 
	`kh_öô
(
m_s2i
)))

890 
îr
;

892 
	`KS_INIT
(&
sh
->
ãxt
);

894 i‡(!(
sh
->
èg_poﬁ
 = 
	`poﬁ_¸óã
((
SAM_hdr_èg
))))

895 
îr
;

897 i‡(!(
sh
->
ty≥_poﬁ
 = 
	`poﬁ_¸óã
((
SAM_hdr_ty≥
))))

898 
îr
;

900 i‡(!(
sh
->
°r_poﬁ
 = 
	`°rög_poﬁ_¸óã
(8192)))

901 
îr
;

903  
sh
;

905 
îr
:

906 i‡(
sh
->
h
)

907 
	`kh_de°roy
(
ßm_hdr
, 
sh
->
h
);

909 i‡(
sh
->
èg_poﬁ
)

910 
	`poﬁ_de°roy
(
sh
->
èg_poﬁ
);

912 i‡(
sh
->
ty≥_poﬁ
)

913 
	`poﬁ_de°roy
(
sh
->
ty≥_poﬁ
);

915 i‡(
sh
->
°r_poﬁ
)

916 
	`°rög_poﬁ_de°roy
(
sh
->
°r_poﬁ
);

918 
	`‰ì
(
sh
);

920  
NULL
;

921 
	}
}

931 
SAM_hdr
 *
	$ßm_hdr_∑r£_
(c⁄° *
hdr
, 
Àn
) {

933 
SAM_hdr
 *
sh
;

935 
sh
 = 
	`ßm_hdr_√w
();

936 i‡(
NULL
 =
sh
)  NULL;

938 i‡(
NULL
 =
hdr
Ë 
sh
;

941 i‡(-1 =
	`ßm_hdr_add_löes
(
sh
, 
hdr
, 
Àn
)) {

942 
	`ßm_hdr_‰ì
(
sh
);

943  
NULL
;

947 
sh
->
s‹t_‹dî
 = 
	`ßm_hdr_∑r£_s‹t_‹dî
(sh);

957 
	`ßm_hdr_lök_pg
(
sh
);

960  
sh
;

961 
	}
}

967 
SAM_hdr
 *
	$ßm_hdr_dup
(
SAM_hdr
 *
hdr
) {

968 i‡(-1 =
	`ßm_hdr_ªbuûd
(
hdr
))

969  
NULL
;

971  
	`ßm_hdr_∑r£_
(
	`ßm_hdr_°r
(
hdr
), 
	`ßm_hdr_Àngth
(hdr));

972 
	}
}

979 
	$ßm_hdr_ö¸_ªf
(
SAM_hdr
 *
hdr
) {

980 
hdr
->
ªf_cou¡
++;

981 
	}
}

991 
	$ßm_hdr_de¸_ªf
(
SAM_hdr
 *
hdr
) {

992 
	`ßm_hdr_‰ì
(
hdr
);

993 
	}
}

1003 
	$ßm_hdr_‰ì
(
SAM_hdr
 *
hdr
) {

1004 i‡(!
hdr
)

1007 i‡(--
hdr
->
ªf_cou¡
 > 0)

1010 i‡(
	`ks_°r
(&
hdr
->
ãxt
))

1011 
	`KS_FREE
(&
hdr
->
ãxt
);

1013 i‡(
hdr
->
h
)

1014 
	`kh_de°roy
(
ßm_hdr
, 
hdr
->
h
);

1016 i‡(
hdr
->
ªf_hash
)

1017 
	`kh_de°roy
(
m_s2i
, 
hdr
->
ªf_hash
);

1019 i‡(
hdr
->
ªf
) {

1020 
i
;

1021 
i
 = 0; i < 
hdr
->
ƒef
; i++)

1022 i‡(
hdr
->
ªf
[
i
].
«me
)

1023 
	`‰ì
(
hdr
->
ªf
[
i
].
«me
);

1024 
	`‰ì
(
hdr
->
ªf
);

1027 i‡(
hdr
->
rg_hash
)

1028 
	`kh_de°roy
(
m_s2i
, 
hdr
->
rg_hash
);

1030 i‡(
hdr
->
rg
) {

1031 
i
;

1032 
i
 = 0; i < 
hdr
->
ƒg
; i++)

1033 i‡(
hdr
->
rg
[
i
].
«me
)

1034 
	`‰ì
(
hdr
->
rg
[
i
].
«me
);

1035 
	`‰ì
(
hdr
->
rg
);

1038 i‡(
hdr
->
pg_hash
)

1039 
	`kh_de°roy
(
m_s2i
, 
hdr
->
pg_hash
);

1041 i‡(
hdr
->
pg
) {

1042 
i
;

1043 
i
 = 0; i < 
hdr
->
≈g
; i++)

1044 i‡(
hdr
->
pg
[
i
].
«me
)

1045 
	`‰ì
(
hdr
->
pg
[
i
].
«me
);

1046 
	`‰ì
(
hdr
->
pg
);

1049 i‡(
hdr
->
pg_íd
)

1050 
	`‰ì
(
hdr
->
pg_íd
);

1052 i‡(
hdr
->
ty≥_poﬁ
)

1053 
	`poﬁ_de°roy
(
hdr
->
ty≥_poﬁ
);

1055 i‡(
hdr
->
èg_poﬁ
)

1056 
	`poﬁ_de°roy
(
hdr
->
èg_poﬁ
);

1058 i‡(
hdr
->
°r_poﬁ
)

1059 
	`°rög_poﬁ_de°roy
(
hdr
->
°r_poﬁ
);

1061 
	`‰ì
(
hdr
);

1062 
	}
}

1064 
	$ßm_hdr_Àngth
(
SAM_hdr
 *
hdr
) {

1065  
	`ks_Àn
(&
hdr
->
ãxt
);

1066 
	}
}

1068 *
	$ßm_hdr_°r
(
SAM_hdr
 *
hdr
) {

1069  
	`ks_°r
(&
hdr
->
ãxt
);

1070 
	}
}

1076 
	$ßm_hdr_«me2ªf
(
SAM_hdr
 *
hdr
, c⁄° *
ªf
) {

1077 
khöt_t
 
k
 = 
	`kh_gë
(
m_s2i
, 
hdr
->
ªf_hash
, 
ªf
);

1078  
k
 =
	`kh_íd
(
hdr
->
ªf_hash
Ë? -1 : 
	`kh_vÆ
(hdr->ref_hash, k);

1079 
	}
}

1087 
SAM_RG
 *
	$ßm_hdr_föd_rg
(
SAM_hdr
 *
hdr
, c⁄° *
rg
) {

1088 
khöt_t
 
k
 = 
	`kh_gë
(
m_s2i
, 
hdr
->
rg_hash
, 
rg
);

1089  
k
 =
	`kh_íd
(
hdr
->
rg_hash
)

1090 ? 
NULL


1091 : &
hdr
->
rg
[
	`kh_vÆ
(hdr->
rg_hash
, 
k
)];

1092 
	}
}

1108 
	$ßm_hdr_lök_pg
(
SAM_hdr
 *
hdr
) {

1109 
i
, 
j
, 
ªt
 = 0;

1111 
hdr
->
≈g_íd_Æloc
 = hdr->
≈g
;

1112 
hdr
->
pg_íd
 = 
	`ªÆloc
(hdr->pg_íd, hdr->
≈g
 * (*hdr->pg_end));

1113 i‡(!
hdr
->
pg_íd
)

1116 
i
 = 0; i < 
hdr
->
≈g
; i++)

1117 
hdr
->
pg_íd
[
i
] = i;

1119 
i
 = 0; i < 
hdr
->
≈g
; i++) {

1120 
khöt_t
 
k
;

1121 
SAM_hdr_èg
 *
èg
;

1122 
tmp
;

1124 
èg
 = 
hdr
->
pg
[
i
].èg;Åag;Åag =Åag->
√xt
) {

1125 i‡(
èg
->
°r
[0] == 'P' &&Åag->str[1] == 'P')

1128 i‡(!
èg
) {

1133 
tmp
 = 
èg
->
°r
[èg->
Àn
];Åag->str[tag->len] = 0;

1134 
k
 = 
	`kh_gë
(
m_s2i
, 
hdr
->
pg_hash
, 
èg
->
°r
+3);

1135 
èg
->
°r
[èg->
Àn
] = 
tmp
;

1137 i‡(
k
 =
	`kh_íd
(
hdr
->
pg_hash
)) {

1138 
ªt
 = -1;

1142 
hdr
->
pg
[
i
].
¥ev_id
 = hdr->pg[
	`kh_vÆ
(hdr->
pg_hash
, 
k
)].
id
;

1143 
hdr
->
pg_íd
[
	`kh_vÆ
(hdr->
pg_hash
, 
k
)] = -1;

1146 
i
 = 
j
 = 0; i < 
hdr
->
≈g
; i++) {

1147 i‡(
hdr
->
pg_íd
[
i
] != -1)

1148 
hdr
->
pg_íd
[
j
++] = hdr->pg_íd[
i
];

1150 
hdr
->
≈g_íd
 = 
j
;

1152  
ªt
;

1153 
	}
}

1161 c⁄° *
	$ßm_hdr_PG_ID
(
SAM_hdr
 *
sh
, c⁄° *
«me
) {

1162 
khöt_t
 
k
 = 
	`kh_gë
(
m_s2i
, 
sh
->
pg_hash
, 
«me
);

1163 i‡(
k
 =
	`kh_íd
(
sh
->
pg_hash
))

1164  
«me
;

1167 
	`•rötf
(
sh
->
ID_buf
, "%.1000s.%d", 
«me
, sh->
ID_˙t
++);

1168 
k
 = 
	`kh_gë
(
m_s2i
, 
sh
->
pg_hash
, sh->
ID_buf
);

1169 } 
k
 !
	`kh_íd
(
sh
->
pg_hash
));

1171  
sh
->
ID_buf
;

1172 
	}
}

1190 
	$ßm_hdr_add_PG
(
SAM_hdr
 *
sh
, c⁄° *
«me
, ...) {

1191 
va_li°
 
¨gs
;

1193 i‡(
sh
->
≈g_íd
) {

1195 *
íd
 = 
	`mÆloc
(
sh
->
≈g_íd
 * ());

1196 
i
, 
√nds
 = 
sh
->
≈g_íd
;

1198 i‡(!
íd
)

1201 
	`mem˝y
(
íd
, 
sh
->
pg_íd
, 
√nds
 * (*end));

1203 
i
 = 0; i < 
√nds
; i++) {

1204 
	`va_°¨t
(
¨gs
, 
«me
);

1205 i‡(-1 =
	`ßm_hdr_vadd
(
sh
, "PG", 
¨gs
,

1206 "ID", 
	`ßm_hdr_PG_ID
(
sh
, 
«me
),

1207 "PN", 
«me
,

1208 "PP", 
sh
->
pg
[
íd
[
i
]].
«me
,

1209 
NULL
)) {

1210 
	`‰ì
(
íd
);

1213 
	`va_íd
(
¨gs
);

1216 
	`‰ì
(
íd
);

1218 
	`va_°¨t
(
¨gs
, 
«me
);

1219 i‡(-1 =
	`ßm_hdr_vadd
(
sh
, "PG", 
¨gs
,

1220 "ID", 
	`ßm_hdr_PG_ID
(
sh
, 
«me
),

1221 "PN", 
«me
,

1222 
NULL
))

1224 
	`va_íd
(
¨gs
);

1230 
	}
}

1240 *
	$°rögify_¨gv
(
¨gc
, *
¨gv
[]) {

1241 *
°r
, *
˝
;

1242 
size_t
 
nbyãs
 = 1;

1243 
i
, 
j
;

1246 
i
 = 0; i < 
¨gc
; i++) {

1247 i‡(
i
 > 0Ë
nbyãs
 += 1;

1248 
nbyãs
 +
	`°æí
(
¨gv
[
i
]);

1250 i‡(!(
°r
 = 
	`mÆloc
(
nbyãs
)))

1251  
NULL
;

1254 
˝
 = 
°r
;

1255 
i
 = 0; i < 
¨gc
; i++) {

1256 i‡(
i
 > 0Ë*
˝
++ = ' ';

1257 
j
 = 0;

1258 
¨gv
[
i
][
j
]) {

1259 i‡(
¨gv
[
i
][
j
] == '\t')

1260 *
˝
++ = ' ';

1262 *
˝
++ = 
¨gv
[
i
][
j
];

1263 
j
++;

1266 *
˝
++ = 0;

1268  
°r
;

1269 
	}
}

	@htslib/cram/sam_header.h

47 #i‚de‡
_SAM_HDR_H_


48 
	#_SAM_HDR_H_


	)

50 
	~<°d¨g.h
>

52 
	~"¸am/°rög_Æloc.h
"

53 
	~"¸am/poﬁed_Æloc.h
"

55 
	~"ht¶ib/khash.h
"

56 
	~"ht¶ib/k°rög.h
"

58 #ifde‡
__˝lu•lus


63 
	#KS_INITIALIZER
 {0,0,0}

	)

66 
	#KS_INIT
(
ks
Ë((ks)->
l
 = 0, (ks)->
m
 = 0, (ks)->
s
 = 
NULL
)

	)

69 
	#KS_FREE
(
ks
Ëdÿ{ i‡((ks)->
s
Ë
	`‰ì
((ks)->s); } 0)

	)

105 
	sSAM_hdr_èg_s
 {

106 
SAM_hdr_èg_s
 *
√xt
;

107 *
°r
;

108 
Àn
;

109 } 
	tSAM_hdr_èg
;

126 
	sSAM_hdr_ôem_s
 {

127 
SAM_hdr_ôem_s
 *
√xt
;

128 
SAM_hdr_ôem_s
 *
¥ev
;

129 
SAM_hdr_èg
 *
èg
;

130 
‹dî
;

131 } 
	tSAM_hdr_ty≥
;

135 *
«me
;

136 
uöt32_t
 
Àn
;

137 
SAM_hdr_ty≥
 *
ty
;

138 
SAM_hdr_èg
 *
èg
;

139 } 
	tSAM_SQ
;

143 *
«me
;

144 
SAM_hdr_ty≥
 *
ty
;

145 
SAM_hdr_èg
 *
èg
;

146 
«me_Àn
;

147 
id
;

148 } 
	tSAM_RG
;

152 *
«me
;

153 
SAM_hdr_ty≥
 *
ty
;

154 
SAM_hdr_èg
 *
èg
;

155 
«me_Àn
;

156 
id
;

157 
¥ev_id
;

158 } 
	tSAM_PG
;

161 
	eßm_s‹t_‹dî
 {

162 
ORDER_UNKNOWN
 =-1,

163 
ORDER_UNSORTED
 = 0,

164 
ORDER_NAME
 = 1,

165 
ORDER_COORD
 = 2,

169 
KHASH_MAP_INIT_INT
(
ßm_hdr
, 
SAM_hdr_ty≥
*)

170 
KHASH_MAP_INIT_STR
(
m_s2i
, )

185 
k°rög_t
 
ãxt
;

186 
khash_t
(
ßm_hdr
Ë*
h
;

187 
°rög_Æloc_t
 *
°r_poﬁ
;

188 
poﬁ_Æloc_t
 *
ty≥_poﬁ
;

189 
poﬁ_Æloc_t
 *
èg_poﬁ
;

192 
ƒef
;

193 
SAM_SQ
 *
ªf
;

194 
khash_t
(
m_s2i
Ë*
ªf_hash
;

197 
ƒg
;

198 
SAM_RG
 *
rg
;

199 
khash_t
(
m_s2i
Ë*
rg_hash
;

202 
≈g
;

203 
≈g_íd
;

204 
≈g_íd_Æloc
;

205 
SAM_PG
 *
pg
;

206 
khash_t
(
m_s2i
Ë*
pg_hash
;

207 *
pg_íd
;

210 
ßm_s‹t_‹dî
 
s‹t_‹dî
;

213 
ID_buf
[1024];

214 
ID_˙t
;

215 
ªf_cou¡
;

217 } 
	tSAM_hdr
;

225 
SAM_hdr
 *
ßm_hdr_√w
();

235 
SAM_hdr
 *
ßm_hdr_∑r£_
(c⁄° *
hdr
, 
Àn
);

242 
SAM_hdr
 *
ßm_hdr_dup
(SAM_hd∏*
hdr
);

250 
ßm_hdr_ö¸_ªf
(
SAM_hdr
 *
hdr
);

261 
ßm_hdr_de¸_ªf
(
SAM_hdr
 *
hdr
);

272 
ßm_hdr_‰ì
(
SAM_hdr
 *
hdr
);

278 
ßm_hdr_Àngth
(
SAM_hdr
 *
hdr
);

284 *
ßm_hdr_°r
(
SAM_hdr
 *
hdr
);

299 
ßm_hdr_add_löes
(
SAM_hdr
 *
sh
, c⁄° *
löes
, 
Àn
);

310 
ßm_hdr_add
(
SAM_hdr
 *
sh
, c⁄° *
ty≥
, ...);

332 
ßm_hdr_vadd
(
SAM_hdr
 *
sh
, c⁄° *
ty≥
, 
va_li°
 
≠
, ...);

341 
SAM_hdr_ty≥
 *
ßm_hdr_föd
(
SAM_hdr
 *
hdr
, *
ty≥
,

342 *
ID_key
, *
ID_vÆue
);

356 *
ßm_hdr_föd_löe
(
SAM_hdr
 *
hdr
, *
ty≥
,

357 *
ID_key
, *
ID_vÆue
);

370 
SAM_hdr_èg
 *
ßm_hdr_föd_key
(
SAM_hdr
 *
sh
,

371 
SAM_hdr_ty≥
 *
ty≥
,

372 *
key
,

373 
SAM_hdr_èg
 **
¥ev
);

387 
ßm_hdr_upd©e
(
SAM_hdr
 *
hdr
, 
SAM_hdr_ty≥
 *
ty≥
, ...);

390 
ßm_s‹t_‹dî
 
ßm_hdr_s‹t_‹dî
(
SAM_hdr
 *
hdr
);

397 
ßm_hdr_ªbuûd
(
SAM_hdr
 *
hdr
);

403 
ßm_hdr_«me2ªf
(
SAM_hdr
 *
hdr
, c⁄° *
ªf
);

411 
SAM_RG
 *
ßm_hdr_föd_rg
(
SAM_hdr
 *
hdr
, c⁄° *
rg
);

423 
ßm_hdr_lök_pg
(
SAM_hdr
 *
hdr
);

442 
ßm_hdr_add_PG
(
SAM_hdr
 *
sh
, c⁄° *
«me
, ...);

453 *
°rögify_¨gv
(
¨gc
, *
¨gv
[]);

455 #ifde‡
__˝lu•lus


	@htslib/cram/string_alloc.c

39 
	~<c⁄fig.h
>

41 
	~<°rög.h
>

42 
	~<°dlib.h
>

43 
	~<°dio.h
>

45 
	~"¸am/°rög_Æloc.h
"

47 
	#MIN_STR_SIZE
 1024

	)

54 
°rög_Æloc_t
 *
	$°rög_poﬁ_¸óã
(
size_t
 
max_Àngth
) {

55 
°rög_Æloc_t
 *
a_°r
;

57 i‡(
NULL
 =(
a_°r
 = (
°rög_Æloc_t
 *)
	`mÆloc
((*a_str)))) {

58  
NULL
;

61 i‡(
max_Àngth
 < 
MIN_STR_SIZE
) max_length = MIN_STR_SIZE;

63 
a_°r
->
n°rögs
 = 0;

64 
a_°r
->
max_Àngth
 = max_length;

65 
a_°r
->
°rögs
 = 
NULL
;

67  
a_°r
;

68 
	}
}

73 
°rög_t
 *
	$√w_°rög_poﬁ
(
°rög_Æloc_t
 *
a_°r
) {

74 
°rög_t
 *
°r
;

76 
°r
 = 
	`ªÆloc
(
a_°r
->
°rögs
, (a_°r->
n°rögs
 + 1) * (*a_str->strings));

78 i‡(
NULL
 =
°r
)  NULL;

80 
a_°r
->
°rögs
 = 
°r
;

81 
°r
 = &
a_°r
->
°rögs
[a_°r->
n°rögs
];

83 
°r
->°∏
	`mÆloc
(
a_°r
->
max_Àngth
);;

85 i‡(
NULL
 =
°r
->str)  NULL;

87 
°r
->
u£d
 = 0;

88 
a_°r
->
n°rögs
++;

90  
°r
;

91 
	}
}

96 
	$°rög_poﬁ_de°roy
(
°rög_Æloc_t
 *
a_°r
) {

97 
size_t
 
i
;

99 
i
 = 0; i < 
a_°r
->
n°rögs
; i++) {

100 
	`‰ì
(
a_°r
->
°rögs
[
i
].
°r
);

103 
	`‰ì
(
a_°r
->
°rögs
);

104 
	`‰ì
(
a_°r
);

105 
	}
}

110 *
	$°rög_Æloc
(
°rög_Æloc_t
 *
a_°r
, 
size_t
 
Àngth
) {

111 
°rög_t
 *
°r
;

112 *
ªt
;

114 i‡(
Àngth
 <0Ë 
NULL
;

117 i‡(
a_°r
->
n°rögs
) {

118 
°r
 = &
a_°r
->
°rögs
[a_°r->
n°rögs
 - 1];

120 i‡(
°r
->
u£d
 + 
Àngth
 < 
a_°r
->
max_Àngth
) {

121 
ªt
 = 
°r
->°∏+ så->
u£d
;

122 
°r
->
u£d
 +
Àngth
;

123  
ªt
;

128 i‡(
Àngth
 > 
a_°r
->
max_Àngth
)á_str->max_length =Üength;

131 
°r
 = 
	`√w_°rög_poﬁ
(
a_°r
);

133 i‡(
NULL
 =
°r
)  NULL;

135 
°r
->
u£d
 = 
Àngth
;

136  
°r
->str;

137 
	}
}

142 *
	$°rög_dup
(
°rög_Æloc_t
 *
a_°r
, *
ö°r
) {

143  
	`°rög_ndup
(
a_°r
, 
ö°r
, 
	`°æí
(instr));

144 
	}
}

146 *
	$°rög_ndup
(
°rög_Æloc_t
 *
a_°r
, *
ö°r
, 
size_t
 
Àn
) {

147 *
°r
 = 
	`°rög_Æloc
(
a_°r
, 
Àn
 + 1);

149 i‡(
NULL
 =
°r
)  NULL;

151 
	`°∫˝y
(
°r
, 
ö°r
, 
Àn
);

152 
°r
[
Àn
] = 0;

154  
°r
;

155 
	}
}

	@htslib/cram/string_alloc.h

31 #i‚de‡
_STRING_ALLOC_H_


32 
	#_STRING_ALLOC_H_


	)

34 
	~<°dlib.h
>

36 #ifde‡
__˝lu•lus


48 *
°r
;

49 
size_t
 
u£d
;

50 } 
	t°rög_t
;

53 
size_t
 
max_Àngth
;

54 
size_t
 
n°rögs
;

55 
°rög_t
 *
°rögs
;

56 } 
	t°rög_Æloc_t
;

58 
°rög_Æloc_t
 *
°rög_poﬁ_¸óã
(
size_t
 
max_Àngth
);

59 
°rög_poﬁ_de°roy
(
°rög_Æloc_t
 *
a_°r
);

60 *
°rög_Æloc
(
°rög_Æloc_t
 *
a_°r
, 
size_t
 
Àngth
);

61 *
°rög_dup
(
°rög_Æloc_t
 *
a_°r
, *
ö°r
);

62 *
°rög_ndup
(
°rög_Æloc_t
 *
a_°r
, *
ö°r
, 
size_t
 
Àn
);

64 #ifde‡
__˝lu•lus


	@htslib/cram/vlen.c

65 
	~<c⁄fig.h
>

67 
	~<°dio.h
>

68 
	~<°dlib.h
>

69 
	~<°d¨g.h
>

70 
	~<sys/ty≥s.h
>

71 
	~<°rög.h
>

73 
	~"¸am/vÀn.h
"

74 
	~"¸am/os.h
"

76 #i‚de‡
MAX


77 
	#MAX
(
a
,
b
Ë(◊)>(b)?◊):(b))

	)

80 #i‚de‡
ABS


81 
	#ABS
(
a
Ë(◊)>0?◊):-◊))

	)

85 
	#DEBUG_¥ötf
(
a
,
n
)

	)

106 
	$Êí
(*
fmt
, ...)

108 
va_li°
 
¨gs
;

110 
	`va_°¨t
(
¨gs
, 
fmt
);

111  
	`vÊí
(
fmt
, 
¨gs
);

112 
	}
}

114 
	$vÊí
(*
fmt
, 
va_li°
 
≠
)

116 
Àn
 = 0;

117 *
˝
, 
c
;

118 
l
;

119 
i
;

120 
d
;

132 #i‡
	`deföed
(
HAVE_VA_COPY
)

133 
va_li°
 
≠_loˇl
;

134 
	`va_c›y
(
≠_loˇl
, 
≠
);

135 
	#≠
 
≠_loˇl


	)

138 
˝
 = 
fmt
; *cp; cp++) {

139 *
˝
) {

143 *
ídp
;

144 
c⁄v_Àn1
=0, 
c⁄v_Àn2
=0, 
c⁄v_Àn
=0;

145 sig√d 
¨g_size
;

148 ; (
c
=*++
˝
);) {

149 i‡('#' =
c
)

150 
Àn
+=2;

151 i‡('-' =
c
 || '+' == c || ' ' == c)

152 
Àn
++;

158 
l
 = 
	`°πﬁ
(
˝
, &
ídp
, 10);

159 i‡(
ídp
 !
˝
) {

160 
˝
 = 
ídp
;

161 
c⁄v_Àn
 = 
c⁄v_Àn1
 = 
l
;

162 } i‡(*
˝
 == '*') {

163 
c⁄v_Àn
 = 
c⁄v_Àn1
 = ()
	`va_¨g
(
≠
, );

164 
˝
++;

168 i‡('.' =*
˝
) {

169 
˝
++;

170 
c⁄v_Àn2
 = 
	`°πﬁ
(
˝
, &
ídp
, 10);

171 i‡(
ídp
 !
˝
) {

172 
˝
 = 
ídp
;

173 } i‡(*
˝
 == '*') {

174 
c⁄v_Àn2
 = ()
	`va_¨g
(
≠
, );

175 
˝
++;

177 
c⁄v_Àn
 = 
	`MAX
(
c⁄v_Àn1
, 
c⁄v_Àn2
);

181 i‡('h' =*
˝
) {

182 
¨g_size
 = -1;

183 
˝
++;

184 } i‡('l' =*
˝
) {

185 
¨g_size
 = 1;

186 
˝
++;

187 i‡('l' =*
˝
) {

188 
¨g_size
 = 2;

189 
˝
++;

192 
¨g_size
 = 0;

196 *
˝
) {

202 
Àn
 +
	`MAX
(
c⁄v_Àn1
, 1);

212 i‡(
¨g_size
 == -1)

213 
l
 = ()
	`va_¨g
(
≠
, );

214 i‡(
¨g_size
 == 1)

215 
l
 = 
	`va_¨g
(
≠
, );

216 i‡(
¨g_size
 == 2)

217 
l
 = 
	`va_¨g
(
≠
, );

219 
l
 = ()
	`va_¨g
(
≠
, );

221 
	`DEBUG_¥ötf
("%d", 
l
);

229 
Àn
 +
	`MAX
(
c⁄v_Àn
, 23);

233 
i
 = 
	`va_¨g
(
≠
, );

234 
	`DEBUG_¥ötf
("%c", 
i
);

239 
Àn
 +
	`MAX
(
c⁄v_Àn1
, 
i
>=0x80 ?
MB_CUR_MAX
 :1);

243 
d
 = 
	`va_¨g
(
≠
, );

244 
	`DEBUG_¥ötf
("%f", 
d
);

255 
l
 = (
	`ABS
(
d
) > 1000000) ? 317 : 15;

256 
l
 = 
	`MAX
÷, 
c⁄v_Àn1
 + 2);

257 i‡(
c⁄v_Àn2
Ë
l
 += conv_len2 - 6;

258 
Àn
 +
l
;

265 
d
 = 
	`va_¨g
(
≠
, );

266 
	`DEBUG_¥ötf
("%g", 
d
);

273 
Àn
 +
	`MAX
(
c⁄v_Àn
, 13);

277 
l
 = ()
	`va_¨g
(
≠
, *);

282 
	`DEBUG_¥ötf
("%p", (*)
l
);

283 
Àn
 +
	`MAX
(
c⁄v_Àn
, 20);

291 *
s
 = (*)
	`va_¨g
(
≠
, *);

292 
	`DEBUG_¥ötf
("%s", 
s
);

294 i‡(!
c⁄v_Àn2
) {

295 
Àn
 +
	`MAX
(
c⁄v_Àn
, ()
	`°æí
(
s
));

297 
Àn
 +
c⁄v_Àn
;

304 
	`DEBUG_¥ötf
("Arg i†%c\n", *
˝
);

313 
	`DEBUG_¥ötf
("%c", *
˝
);

314 
Àn
++;

318 
	`va_íd
(
≠
);

320  
Àn
+1;

321 
	}
}

324 
	$maö
() {

325 
l
;

326 
buf
[10000];

328 
	`•rötf
(
buf
, "d: %d\n", 500);

329 
l
 = 
	`Êí
("d: %d\n", 500);

330 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

332 
	`•rötf
(
buf
, "");

333 
l
 = 
	`Êí
("");

334 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

336 
	`•rötf
(
buf
, "%s\n","test");

337 
l
 = 
	`Êí
("%s\n", "test");

338 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

340 
	`•rötf
(
buf
, "%c\n", 'a');

341 
l
 = 
	`Êí
("%c\n", 'a');

342 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

344 
	`•rötf
(
buf
, "%31.30f\n", -9999.99);

345 
l
 = 
	`Êí
("%31.30f\n", -9999.99);

346 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

348 
	`•rötf
(
buf
, "%f\n", -1e308);

349 
l
 = 
	`Êí
("%f\n", -1e308);

350 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

352 
	`•rötf
(
buf
, "%.9f\n", -1e308);

353 
l
 = 
	`Êí
("%.9f\n", -1e308);

354 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

356 
	`•rötf
(
buf
, "%10.20f\n", -1.999222333);

357 
l
 = 
	`Êí
("%10.20f\n", -1.999222333);

358 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

360 
	`•rötf
(
buf
, "%#g\n", -3.14159265358e-222);

361 
l
 = 
	`Êí
("%#g\n", -3.1415927e-222);

362 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

364 
	`•rötf
(
buf
, "%e\n", -123456789123456789.1);

365 
l
 = 
	`Êí
("%e\n", -123456789123456789.1);

366 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

368 
	`•rötf
(
buf
, "%c %f %d %s %c %g %ld %s\n", 'a', 3.1, 9, "one", 'b', 4.2, 9, "two");

369 
l
 = 
	`Êí
("%c %f %d %s %c %g %ld %s\n", 'a', 3.1, 9, "one", 'b', 4.2, 9, "two");

370 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

372 
	`•rötf
(
buf
, "%*.*e %*c\n", 10, 5, 9.0, 20, 'x');

373 
l
 = 
	`Êí
("%*.*e %*c\n", 10, 5, 9.0, 20, 'x');

374 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

376 
	`•rötf
(
buf
, "%10c\n", 'z');

377 
l
 = 
	`Êí
("%10c\n", 'z');

378 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

380 
	`•rötf
(
buf
, "%.10c\n", 'z');

381 
l
 = 
	`Êí
("%.10c\n", 'z');

382 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

384 
	`•rötf
(
buf
, "%10d\n", 'z');

385 
l
 = 
	`Êí
("%10d\n", 'z');

386 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

388 
	`•rötf
(
buf
, "%.10d\n", 'z');

389 
l
 = 
	`Êí
("%.10d\n", 'z');

390 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

392 
	`•rötf
(
buf
, "%10%\n");

393 
l
 = 
	`Êí
("%10%\n");

394 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

396 
	`•rötf
(
buf
, "%.10%\n");

397 
l
 = 
	`Êí
("%.10%\n");

398 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

400 
	`•rötf
(
buf
, "%s\n", "0123456789");

401 
l
 = 
	`Êí
("%s\n", "0123456789");

402 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

404 
	`•rötf
(
buf
, "%5s\n", "0123456789");

405 
l
 = 
	`Êí
("%5s\n", "0123456789");

406 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

408 
	`•rötf
(
buf
, "%50s\n", "0123456789");

409 
l
 = 
	`Êí
("%50s\n", "0123456789");

410 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

412 
	`•rötf
(
buf
, "%.5s\n", "0123456789");

413 
l
 = 
	`Êí
("%.5s\n", "0123456789");

414 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

416 
	`•rötf
(
buf
, "%.50s\n", "0123456789");

417 
l
 = 
	`Êí
("%.50s\n", "0123456789");

418 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

420 
	`•rötf
(
buf
, "%5.50s\n", "0123456789");

421 
l
 = 
	`Êí
("%5.50s\n", "0123456789");

422 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

424 
	`•rötf
(
buf
, "%50.5s\n", "0123456789");

425 
l
 = 
	`Êí
("%50.5s\n", "0123456789");

426 
	`¥ötf
("%d %d\n\n", 
	`°æí
(
buf
), 
l
);

429 
	}
}

	@htslib/cram/vlen.h

34 #i‚de‡
_VLEN_H_


35 
	#_VLEN_H_


	)

37 
	~<°d¨g.h
>

39 #ifde‡
__˝lu•lus


43 
vÊí
(*
fmt
, 
va_li°
 
≠
);

44 
Êí
(*
fmt
, ...);

46 #ifde‡
__˝lu•lus


	@htslib/cram/zfio.c

31 
	~<c⁄fig.h
>

33 
	~<°dlib.h
>

34 
	~<uni°d.h
>

35 
	~<°rög.h
>

37 
	~"¸am/os.h
"

38 
	~"¸am/zfio.h
"

53 
off_t
 
	$z·ñlo
(
zÂ
 *
zf
) {

54  
zf
->
Â
 ? 
	`·ñlo
(zf->fp) : -1;

55 
	}
}

57 
	$zf£eko
(
zÂ
 *
zf
, 
off_t
 
off£t
, 
whí˚
) {

58  
zf
->
Â
 ? 
	`f£eko
(zf->Â, 
off£t
, 
whí˚
) : -1;

59 
	}
}

66 *
	$zfgës
(*
löe
, 
size
, 
zÂ
 *
zf
) {

67 i‡(
zf
->
Â
)

68  
	`fgës
(
löe
, 
size
, 
zf
->
Â
);

70  
	`gzgës
(
zf
->
gz
, 
löe
, 
size
);

71 
	}
}

77 
	$zÂuts
(*
löe
, 
zÂ
 *
zf
) {

78 i‡(
zf
->
Â
)

79  
	`Âuts
(
löe
, 
zf
->
Â
);

81  
	`gzputs
(
zf
->
gz
, 
löe
Ë? 0 : 
EOF
;

82 
	}
}

88 
	$zÂìk
(
zÂ
 *
zf
) {

89 
c
;

91 i‡(
zf
->
Â
) {

92 
c
 = 
	`gëc
(
zf
->
Â
);

93 i‡(
c
 !
EOF
)

94 
	`ungëc
(
c
, 
zf
->
Â
);

96 
c
 = 
	`gzgëc
(
zf
->
gz
);

97 i‡(
c
 !
EOF
)

98 
	`gzungëc
(
c
, 
zf
->
gz
);

101  
c
;

102 
	}
}

105 
	$z„of
(
zÂ
 *
zf
) {

106  
zf
->
Â
 ? 
	`„of
(zf->ÂË: 
	`gzeof
(zf->
gz
);

107 
	}
}

110 
zÂ
 *
	$zf›í
(c⁄° *
∑th
, c⁄° *
mode
) {

111 
∑th2
[1024];

112 
zÂ
 *
zf
;

114 i‡(!(
zf
 = (
zÂ
 *)
	`mÆloc
((*zf))))

115  
NULL
;

116 
zf
->
Â
 = 
NULL
;

117 
zf
->
gz
 = 
NULL
;

120 i‡(
mode
[0] != 'z' && mode[1] != 'z' &&

121 
NULL
 !(
zf
->
Â
 = 
	`f›í
(
∑th
, 
mode
))) {

122 
magic
[2];

123 i‡(2 !
	`‰ód
(
magic
, 1, 2, 
zf
->
Â
)) {

124 
	`‰ì
(
zf
);

125  
NULL
;

127 i‡(!(
magic
[0] == 0x1f &&

128 
magic
[1] == 0x8b)) {

129 
	`f£eko
(
zf
->
Â
, 0, 
SEEK_SET
);

130  
zf
;

133 
	`f˛o£
(
zf
->
Â
);

134 
zf
->
Â
 = 
NULL
;

137 i‡((
zf
->
gz
 = 
	`gz›í
(
∑th
, 
mode
)))

138  
zf
;

140 i‡(!
	`°rchr
(
mode
, 'w')) {

141 
	`•rötf
(
∑th2
, "%.*s.gz", 1020, 
∑th
);

142 i‡((
zf
->
gz
 = 
	`gz›í
(
∑th2
, 
mode
)))

143  
zf
;

146 
	`‰ì
(
zf
);

147  
NULL
;

148 
	}
}

150 
	$zf˛o£
(
zÂ
 *
zf
) {

151 
r
 = (
zf
->
Â
Ë? 
	`f˛o£
(zf->ÂË: 
	`gz˛o£
(zf->
gz
);

152 
	`‰ì
(
zf
);

153  
r
;

154 
	}
}

	@htslib/cram/zfio.h

31 #i‚de‡
_ZFIO_H_


32 
	#_ZFIO_H_


	)

34 
	~<°dio.h
>

35 
	~<zlib.h
>

37 #ifde‡
__˝lu•lus


45 
FILE
 *
Â
;

46 
gzFûe
 
gz
;

47 } 
	tzÂ
;

49 
off_t
 
z·ñlo
(
zÂ
 *
zf
);

50 
zf£eko
(
zÂ
 *
zf
, 
off_t
 
off£t
, 
whí˚
);

51 *
zfgës
(*
löe
, 
size
, 
zÂ
 *
zf
);

52 
zÂuts
(*
löe
, 
zÂ
 *
zf
);

53 
zÂ
 *
zf›í
(c⁄° *
∑th
, c⁄° *
mode
);

54 
zf˛o£
(
zÂ
 *
zf
);

55 
zÂìk
(
zÂ
 *
zf
);

56 
z„of
(
zÂ
 *
zf
);

58 #ifde‡
__˝lu•lus


	@htslib/errmod.c

26 
	~<c⁄fig.h
>

28 
	~<m©h.h
>

29 
	~"ht¶ib/hts.h
"

30 
	~"ht¶ib/ks‹t.h
"

31 
	$KSORT_INIT_GENERIC
(
uöt16_t
)

33 
	sîrmod_t
 {

34 
dïc‹r
;

36 *
fk
, *
bëa
, *
lhë
;

40 
fsum
[16], 
bsum
[16];

41 
uöt32_t
 
c
[16];

42 } 
	tˇŒ_aux_t
;

45 
	#lÁ˘
(
n
Ë
	`lgamma
“+1)

	)

48 * 
	$logböomül_èbÀ
–c⁄° 
n_size
 )

52 
k
, 
n
;

53 *
logböom
 = (*)
	`ˇŒoc
(
n_size
 *Ç_size, ());

54 
n
 = 1;Ç < 
n_size
; ++n) {

55 
l‚
 = 
	`lÁ˘
(
n
);

56 
k
 = 1; k <
n
; ++k)

57 
logböom
[
n
<<8|
k
] = 
l‚
 - 
	`lÁ˘
(k) -Üfact(n-k);

59  
logböom
;

60 
	}
}

62 
	$ˇl_c€f
(
îrmod_t
 *
em
, 
dïc‹r
, 
ëa
)

64 
k
, 
n
, 
q
;

65 
sum
, 
sum1
;

66 *
lC
;

69 
em
->
fk
 = (*)
	`ˇŒoc
(256, ());

70 
em
->
fk
[0] = 1.0;

71 
n
 = 1;Ç < 256; ++n)

72 
em
->
fk
[
n
] = 
	`pow
(1. - 
dïc‹r
,ÇË* (1.0 - 
ëa
) +Éta;

75 
em
->
bëa
 = (*)
	`ˇŒoc
(256 * 256 * 64, ());

77 
lC
 = 
	`logböomül_èbÀ
( 256 );

79 
q
 = 1; q < 64; ++q) {

80 
e
 = 
	`pow
(10.0, -
q
/10.0);

81 
À
 = 
	`log
(
e
);

82 
À1
 = 
	`log
(1.0 - 
e
);

83 
n
 = 1;Ç <= 255; ++n) {

84 *
bëa
 = 
em
->bë®+ (
q
<<16|
n
<<8);

85 
sum1
 = 
sum
 = 0.0;

86 
k
 = 
n
; k >0; --k, 
sum1
 = 
sum
) {

87 
sum
 = 
sum1
 + 
	`ex∂
(
lC
[
n
<<8|
k
] + k*
À
 + (n-k)*
À1
);

88 
bëa
[
k
] = -10. / 
M_LN10
 * 
	`logl
(
sum1
 / 
sum
);

94 
em
->
lhë
 = (*)
	`ˇŒoc
(256 * 256, ());

95 
n
 = 0;Ç < 256; ++n)

96 
k
 = 0; k < 256; ++k)

97 
em
->
lhë
[
n
<<8|
k
] = 
lC
[n<<8|k] - 
M_LN2
 *Ç;

98 
	`‰ì
(
lC
);

99 
	}
}

104 
îrmod_t
 *
	$îrmod_öô
(
dïc‹r
)

106 
îrmod_t
 *
em
;

107 
em
 = (
îrmod_t
*)
	`ˇŒoc
(1, (errmod_t));

108 
em
->
dïc‹r
 = depcorr;

109 
	`ˇl_c€f
(
em
, 
dïc‹r
, 0.03);

110  
em
;

111 
	}
}

116 
	$îrmod_de°roy
(
îrmod_t
 *
em
)

118 i‡(
em
 == 0) ;

119 
	`‰ì
(
em
->
lhë
); fªe”m->
fk
); fªe”m->
bëa
);

120 
	`‰ì
(
em
);

121 
	}
}

129 
	$îrmod_ˇl
(c⁄° 
îrmod_t
 *
em
, 
n
, 
m
, 
uöt16_t
 *
ba£s
, *
q
)

133 
ˇŒ_aux_t
 
aux
;

135 
i
, 
j
, 
k
;

137 
w
[32];

139 
	`mem£t
(
q
, 0, 
m
 * m * ());

140 i‡(
n
 == 0)  0;

142 i‡(
n
 > 255) {

143 
	`ks_shufÊe
(
uöt16_t
, 
n
, 
ba£s
);

144 
n
 = 255;

146 
	`ks_öåos‹t
(
uöt16_t
, 
n
, 
ba£s
);

148 
	`mem£t
(
w
, 0, 32 * ());

149 
	`mem£t
(&
aux
, 0, (
ˇŒ_aux_t
));

151 
j
 = 
n
 - 1; j >= 0; --j) {

152 
uöt16_t
 
b
 = 
ba£s
[
j
];

154 
quÆ
 = 
b
>>5 < 4? 4 : b>>5;

155 i‡(
quÆ
 > 63) qual = 63;

157 
ba£°ønd
 = 
b
&0x1f;

159 
ba£
 = 
b
&0xf;

160 
aux
.
fsum
[
ba£
] +
em
->
fk
[
w
[
ba£°ønd
]];

161 
aux
.
bsum
[
ba£
] +
em
->
fk
[
w
[
ba£°ønd
]] *Ém->
bëa
[
quÆ
<<16|
n
<<8|aux.
c
[base]];

162 ++
aux
.
c
[
ba£
];

163 ++
w
[
ba£°ønd
];

167 
j
 = 0; j < 
m
; ++j) {

168 
tmp1
, 
tmp3
;

169 
tmp2
;

171 
k
 = 0, 
tmp1
 = 
tmp3
 = 0.0, 
tmp2
 = 0; k < 
m
; ++k) {

172 i‡(
k
 =
j
) ;

173 
tmp1
 +
aux
.
bsum
[
k
]; 
tmp2
 +aux.
c
[k]; 
tmp3
 +aux.
fsum
[k];

175 i‡(
tmp2
) {

176 
q
[
j
*
m
+j] = 
tmp1
;

179 
k
 = 
j
 + 1; k < 
m
; ++k) {

180 
cjk
 = 
aux
.
c
[
j
] +áux.c[
k
];

181 
i
 = 0, 
tmp2
 = 0, 
tmp1
 = 
tmp3
 = 0.0; i < 
m
; ++i) {

182 i‡(
i
 =
j
 || i =
k
) ;

183 
tmp1
 +
aux
.
bsum
[
i
]; 
tmp2
 +aux.
c
[i]; 
tmp3
 +aux.
fsum
[i];

185 i‡(
tmp2
) {

186 
q
[
j
*
m
+
k
] = q[k*m+j] = -4.343 * 
em
->
lhë
[
cjk
<<8|
aux
.
c
[k]] + 
tmp1
;

187 } 
q
[
j
*
m
+
k
] = q[k*m+j] = -4.343 * 
em
->
lhë
[
cjk
<<8|
aux
.
c
[k]];

190 
k
 = 0; k < 
m
; ++kËi‡(
q
[
j
*m+k] < 0.0) q[j*m+k] = 0.0;

194 
	}
}

	@htslib/faidx.c

26 
	~<c⁄fig.h
>

28 
	~<˘y≥.h
>

29 
	~<°rög.h
>

30 
	~<°dlib.h
>

31 
	~<°dio.h
>

32 
	~<öây≥s.h
>

33 
	~<î∫o.h
>

34 
	~<limôs.h
>

35 
	~<uni°d.h
>

36 
	~<as£π.h
>

38 
	~"ht¶ib/bgzf.h
"

39 
	~"ht¶ib/Áidx.h
"

40 
	~"ht¶ib/hfûe.h
"

41 
	~"ht¶ib/khash.h
"

42 
	~"ht¶ib/k°rög.h
"

43 
	~"hts_öã∫Æ.h
"

46 
öt32_t
 
	mlöe_Àn
, 
	mlöe_bÀn
;

47 
öt64_t
 
	mÀn
;

48 
uöt64_t
 
	moff£t
;

49 } 
	tÁidx1_t
;

50 
	$KHASH_MAP_INIT_STR
(
s
, 
Áidx1_t
)

52 
	s__Áidx_t
 {

53 
BGZF
 *
bgzf
;

54 
n
, 
m
;

55 **
«me
;

56 
	`khash_t
(
s
Ë*
hash
;

59 #i‚de‡
kroundup32


60 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

63 
ölöe
 
	$Ái_ö£π_ödex
(
Áidx_t
 *
idx
, c⁄° *
«me
, 
öt64_t
 
Àn
, 
löe_Àn
, 
löe_bÀn
, 
uöt64_t
 
off£t
)

65 i‡(!
«me
) {

66 
	`Ârötf
(
°dîr
, "[fai_build_core] malformedÜine\n");

70 *
«me_key
 = 
	`°rdup
(
«me
);

71 
ab£¡
;

72 
khöt_t
 
k
 = 
	`kh_put
(
s
, 
idx
->
hash
, 
«me_key
, &
ab£¡
);

73 
Áidx1_t
 *
v
 = &
	`kh_vÆue
(
idx
->
hash
, 
k
);

75 i‡(! 
ab£¡
) {

76 
	`Ârötf
(
°dîr
, "[Ái_buûd_c‹e] ign‹ög du∂iˇã sequí˚ \"%s\"áàbyã off£à%"
PRIu64
"\n", 
«me
, 
off£t
);

77 
	`‰ì
(
«me_key
);

81 i‡(
idx
->
n
 =idx->
m
) {

82 **
tmp
;

83 
idx
->
m
 = idx->m? idx->m<<1 : 16;

84 i‡(!(
tmp
 = (**)
	`ªÆloc
(
idx
->
«me
, (*Ë* idx->
m
))) {

85 
	`Ârötf
(
°dîr
, "[fai_build_core] out of memory\n");

88 
idx
->
«me
 = 
tmp
;

90 
idx
->
«me
[idx->
n
++] = 
«me_key
;

91 
v
->
Àn
 =Üen;

92 
v
->
löe_Àn
 =Üine_len;

93 
v
->
löe_bÀn
 =Üine_blen;

94 
v
->
off£t
 = offset;

97 
	}
}

99 
Áidx_t
 *
	$Ái_buûd_c‹e
(
BGZF
 *
bgzf
)

101 
k°rög_t
 
«me
 = { 0, 0, 
NULL
 };

102 
c
;

103 
löe_Àn
, 
löe_bÀn
, 
°©e
;

104 
l1
, 
l2
;

105 
Áidx_t
 *
idx
;

106 
uöt64_t
 
off£t
;

107 
öt64_t
 
Àn
;

109 
idx
 = (
Áidx_t
*)
	`ˇŒoc
(1, (faidx_t));

110 
idx
->
hash
 = 
	`kh_öô
(
s
);

111 
Àn
 = 
löe_Àn
 = 
löe_bÀn
 = -1; 
°©e
 = 0; 
l1
 = 
l2
 = -1; 
off£t
 = 0;

112  (
c
=
	`bgzf_gëc
(
bgzf
))>=0 ) {

113 i‡(
c
 == '\n') {

114 i‡(
°©e
 == 1) {

115 
off£t
 = 
	`bgzf_uãŒ
(
bgzf
);

117 } i‡((
°©e
 =0 && 
Àn
 < 0) || state == 2) ;

118 i‡(
°©e
 == 0) { state = 2; ; }

120 i‡(
c
 == '>') {

121 i‡(
Àn
 >= 0) {

122 i‡(
	`Ái_ö£π_ödex
(
idx
, 
«me
.
s
, 
Àn
, 
löe_Àn
, 
löe_bÀn
, 
off£t
) != 0)

123 
Áû
;

126 
«me
.
l
 = 0;

127 (
c
 = 
	`bgzf_gëc
(
bgzf
)) >= 0)

128 i‡(! 
	`is•a˚
(
c
)Ë
	`kputc_
(c, &
«me
);

129 i‡(
«me
.
l
 > 0 || 
c
 == '\n') ;

130 
	`kput¢
("", 0, &
«me
);

132 i‡–
c
<0 ) {

133 
	`Ârötf
(
°dîr
, "[fai_build_core]ÅheÜastÉntry hasÇo sequence\n");

134 
Áû
;

136 i‡(
c
 !'\n'Ë (c=
	`bgzf_gëc
(
bgzf
))>=0 && c != '\n');

137 
°©e
 = 1; 
Àn
 = 0;

138 
off£t
 = 
	`bgzf_uãŒ
(
bgzf
);

140 i‡(
°©e
 == 3) {

141 
	`Ârötf
(
°dîr
, "[Ái_buûd_c‹e] i∆öedÉm±yÜöêi†nŸáŒowed i¿£quí˚ '%s'.\n", 
«me
.
s
);

142 
Áû
;

144 i‡(
°©e
 == 2) state = 3;

145 
l1
 = 
l2
 = 0;

147 ++
l1
;

148 i‡(
	`isgøph
(
c
)Ë++
l2
;

149 }  (
c
=
	`bgzf_gëc
(
bgzf
))>=0 && c != '\n');

150 i‡(
°©e
 =3 && 
l2
) {

151 
	`Ârötf
(
°dîr
, "[Ái_buûd_c‹e] dif„ª¡ÜöêÀngth i¿£quí˚ '%s'.\n", 
«me
.
s
);

152 
Áû
;

154 ++
l1
; 
Àn
 +
l2
;

155 i‡(
°©e
 =1Ë
löe_Àn
 = 
l1
, 
löe_bÀn
 = 
l2
, state = 0;

156 i‡(
°©e
 == 0) {

157 i‡(
l1
 !
löe_Àn
 || 
l2
 !
löe_bÀn
Ë
°©e
 = 2;

162 i‡(
Àn
 >= 0) {

163 i‡(
	`Ái_ö£π_ödex
(
idx
, 
«me
.
s
, 
Àn
, 
löe_Àn
, 
löe_bÀn
, 
off£t
) != 0)

164 
Áû
;

166 
Áû
;

169 
	`‰ì
(
«me
.
s
);

170  
idx
;

172 
Áû
:

173 
	`‰ì
(
«me
.
s
);

174 
	`Ái_de°roy
(
idx
);

175  
NULL
;

176 
	}
}

178 
	$Ái_ßve
(c⁄° 
Áidx_t
 *
Ái
, 
hFILE
 *
Â
) {

179 
khöt_t
 
k
;

180 
i
;

181 
buf
[96];

183 
i
 = 0; i < 
Ái
->
n
; ++i) {

184 
Áidx1_t
 
x
;

185 
k
 = 
	`kh_gë
(
s
, 
Ái
->
hash
, fai->
«me
[
i
]);

186 
	`as£π
(
k
 < 
	`kh_íd
(
Ái
->
hash
));

187 
x
 = 
	`kh_vÆue
(
Ái
->
hash
, 
k
);

188 
	`¢¥ötf
(
buf
, (buf),

189 "\t%"
PRId64
"\t%"
PRIu64
"\t%"
PRId32
"\t%"PRId32"\n",

190 
x
.
Àn
, x.
off£t
, x.
löe_bÀn
, x.
löe_Àn
);

191 i‡(
	`hputs
(
Ái
->
«me
[
i
], 
Â
) != 0)  -1;

192 i‡(
	`hputs
(
buf
, 
Â
) != 0)  -1;

195 
	}
}

197 
Áidx_t
 *
	$Ái_ªad
(
hFILE
 *
Â
, c⁄° *
‚ame
)

199 
Áidx_t
 *
Ái
;

200 *
buf
 = 
NULL
, *
p
;

201 
löe_Àn
, 
löe_bÀn
, 
n
;

202 
öt64_t
 
Àn
;

203 
uöt64_t
 
off£t
;

204 
ssize_t
 
l
, 
 um
 = 1;

206 
Ái
 = (
Áidx_t
*)
	`ˇŒoc
(1, (faidx_t));

207 i‡(!
Ái
Ë 
NULL
;

209 
Ái
->
hash
 = 
	`kh_öô
(
s
);

210 i‡(!
Ái
->
hash
Ë
Áû
;

212 
buf
 = (*)
	`ˇŒoc
(0x10000, 1);

213 i‡(!
buf
Ë
Áû
;

215 (
l
 = 
	`hgë 
(
buf
, 0x10000, 
Â
)) > 0) {

216 
p
 = 
buf
; *∞&& !
	`is•a˚_c
(*p); ++p);

217 i‡(
p
 - 
buf
 < 
l
) {

218 *
p
 = 0; ++p;

220 
n
 = 
	`ssˇnf
(
p
, "%"
SCNd64
"%"
SCNu64
"%d%d", &
Àn
, &
off£t
, &
löe_bÀn
, &
löe_Àn
);

221 i‡(
n
 != 4) {

222 i‡(
hts_vîbo£
 > 1)

223 
	`Ârötf
(
°dîr
, "[fai_load] couldn't understand FAI %sÜine %zd\n",

224 
‚ame
, 
 um
);

225 
Áû
;

227 i‡(
	`Ái_ö£π_ödex
(
Ái
, 
buf
, 
Àn
, 
löe_Àn
, 
löe_bÀn
, 
off£t
) != 0) {

228 
Áû
;

230 i‡(
buf
[
l
 - 1] ='\n'Ë++
 um
;

233 i‡(
l
 < 0) {

234 i‡(
hts_vîbo£
 > 1)

235 
	`Ârötf
(
°dîr
, "[fai_load]Érror whileÑeading \"%s\": %s\n",

236 
‚ame
, 
	`°ªº‹
(
î∫o
));

237 
Áû
;

239 
	`‰ì
(
buf
);

240  
Ái
;

242 
Áû
:

243 
	`‰ì
(
buf
);

244 
	`Ái_de°roy
(
Ái
);

245  
NULL
;

246 
	}
}

248 
	$Ái_de°roy
(
Áidx_t
 *
Ái
)

250 
i
;

251 i‡(!
Ái
) ;

252 
i
 = 0; i < 
Ái
->
n
; ++iË
	`‰ì
(Ái->
«me
[i]);

253 
	`‰ì
(
Ái
->
«me
);

254 
	`kh_de°roy
(
s
, 
Ái
->
hash
);

255 i‡(
Ái
->
bgzf
Ë
	`bgzf_˛o£
(fai->bgzf);

256 
	`‰ì
(
Ái
);

257 
	}
}

259 
	$Ái_buûd3
(c⁄° *
‚
, c⁄° *
‚Ái
, c⁄° *
‚gzi
)

261 
k°rög_t
 
Ái_k°r
 = { 0, 0, 
NULL
 };

262 
k°rög_t
 
gzi_k°r
 = { 0, 0, 
NULL
 };

263 
BGZF
 *
bgzf
 = 
NULL
;

264 
hFILE
 *
Â
 = 
NULL
;

265 
Áidx_t
 *
Ái
 = 
NULL
;

266 
ßve_î∫o
, 
ªs
;

268 i‡(!
‚Ái
) {

269 i‡(
	`k•rötf
(&
Ái_k°r
, "%s.Ái", 
‚
Ë< 0Ë
Áû
;

270 
‚Ái
 = 
Ái_k°r
.
s
;

272 i‡(!
‚gzi
) {

273 i‡(
	`k•rötf
(&
gzi_k°r
, "%s.gzi", 
‚
Ë< 0Ë
Áû
;

274 
‚gzi
 = 
gzi_k°r
.
s
;

277 
bgzf
 = 
	`bgzf_›í
(
‚
, "r");

278 i‡–!
bgzf
 ) {

279 i‡(
hts_vîbo£
 > 1)

280 
	`Ârötf
(
°dîr
, "[Ái_buûd] faûÅÿ›íÅhêFASTA fûê%s\n",
‚
);

281 
Áû
;

283 i‡–
bgzf
->
is_com¥es£d
 ) {

284 i‡(
	`bgzf_ödex_buûd_öô
(
bgzf
) != 0) {

285 i‡(
hts_vîbo£
 > 1)

286 
	`Ârötf
(
°dîr
, "[fai_build] failÅoállocate bgzf index");

287 
Áû
;

290 
Ái
 = 
	`Ái_buûd_c‹e
(
bgzf
);

291 i‡–!
Ái
 )

293 i‡–
bgzf
->
is_com¥es£d
 && bgzf->
is_gzù
 && 
hts_vîbo£
 > 1)

294 
	`Ârötf
(
°dîr
, "Cannot index files compressed with gzip,Ölease use bgzip\n");

295 
Áû
;

297 i‡–
bgzf
->
is_com¥es£d
 ) {

298 i‡(
	`bgzf_ödex_dump
(
bgzf
, 
‚gzi
, 
NULL
) < 0) {

299 i‡(
hts_vîbo£
 > 1)

300 
	`Ârötf
(
°dîr
, "[fai_build] failÅo make bgzf index %s\n",

301 
‚gzi
);

302 
Áû
;

305 
ªs
 = 
	`bgzf_˛o£
(
bgzf
);

306 
bgzf
 = 
NULL
;

307 i‡(
ªs
 < 0) {

308 i‡(
hts_vîbo£
 > 1)

309 
	`Ârötf
(
°dîr
, "[fai_build] Error on closing %s : %s\n",

310 
‚
, 
	`°ªº‹
(
î∫o
));

311 
Áû
;

313 
Â
 = 
	`h›í
(
‚Ái
, "wb");

314 i‡–!
Â
 ) {

315 i‡(
hts_vîbo£
 > 1)

316 
	`Ârötf
(
°dîr
, "[fai_build] failÅo open FASTA index %s : %s\n",

317 
‚Ái
, 
	`°ªº‹
(
î∫o
));

318 
Áû
;

320 i‡(
	`Ái_ßve
(
Ái
, 
Â
) != 0) {

321 i‡(
hts_vîbo£
 > 1)

322 
	`Ârötf
(
°dîr
, "[fai_build] failÅo write FASTA index %s : %s\n",

323 
‚Ái
, 
	`°ªº‹
(
î∫o
));

324 
Áû
;

326 i‡(
	`h˛o£
(
Â
) != 0) {

327 i‡(
hts_vîbo£
 > 1)

328 
	`Ârötf
(
°dîr
, "[fai_build] fail on closing FASTA index %s : %s\n",

329 
‚Ái
, 
	`°ªº‹
(
î∫o
));

330 
Áû
;

333 
	`‰ì
(
Ái_k°r
.
s
);

334 
	`‰ì
(
gzi_k°r
.
s
);

335 
	`Ái_de°roy
(
Ái
);

338 
Áû
:

339 
ßve_î∫o
 = 
î∫o
;

340 
	`‰ì
(
Ái_k°r
.
s
);

341 
	`‰ì
(
gzi_k°r
.
s
);

342 
	`bgzf_˛o£
(
bgzf
);

343 
	`Ái_de°roy
(
Ái
);

344 
î∫o
 = 
ßve_î∫o
;

346 
	}
}

348 
	$Ái_buûd
(c⁄° *
‚
) {

349  
	`Ái_buûd3
(
‚
, 
NULL
, NULL);

350 
	}
}

352 
Áidx_t
 *
	$Ái_lﬂd3
(c⁄° *
‚
, c⁄° *
‚Ái
, c⁄° *
‚gzi
,

353 
Êags
)

355 
k°rög_t
 
Ái_k°r
 = { 0, 0, 
NULL
 };

356 
k°rög_t
 
gzi_k°r
 = { 0, 0, 
NULL
 };

357 
hFILE
 *
Â
 = 
NULL
;

358 
Áidx_t
 *
Ái
 = 
NULL
;

359 
ªs
;

361 i‡(
‚
 =
NULL
)

362  
NULL
;

364 i‡(
‚Ái
 =
NULL
) {

365 i‡(
	`k•rötf
(&
Ái_k°r
, "%s.Ái", 
‚
Ë< 0Ë
Áû
;

366 
‚Ái
 = 
Ái_k°r
.
s
;

368 i‡(
‚gzi
 =
NULL
) {

369 i‡(
	`k•rötf
(&
gzi_k°r
, "%s.gzi", 
‚
Ë< 0Ë
Áû
;

370 
‚gzi
 = 
gzi_k°r
.
s
;

373 
Â
 = 
	`h›í
(
‚Ái
, "rb");

375 i‡(
Â
 == 0) {

376 i‡(!(
Êags
 & 
FAI_CREATE
Ë|| 
î∫o
 !
ENOENT
) {

377 i‡(
hts_vîbo£
 >= 1) {

378 
	`Ârötf
(
°dîr
, "[fai_load] failedÅo open FASTA index %s: %s\n",

379 
‚Ái
, 
	`°ªº‹
(
î∫o
));

381 
Áû
;

384 i‡(
hts_vîbo£
 >= 1) {

385 
	`Ârötf
(
°dîr
, "[fai_load] build FASTA index.\n");

387 i‡(
	`Ái_buûd3
(
‚
, 
‚Ái
, 
‚gzi
) < 0) {

388 
Áû
;

391 
Â
 = 
	`h›í
(
‚Ái
, "rb");

392 i‡(
Â
 == 0) {

393 i‡(
hts_vîbo£
 >= 1) {

394 
	`Ârötf
(
°dîr
, "[fai_load] failedÅo open FASTA index %s: %s\n",

395 
‚Ái
, 
	`°ªº‹
(
î∫o
));

397 
Áû
;

401 
Ái
 = 
	`Ái_ªad
(
Â
, 
‚Ái
);

402 i‡(
Ái
 =
NULL
) {

403 i‡(
hts_vîbo£
 >= 1)

404 
	`Ârötf
(
°dîr
, "[fai_load] failedÅoÑead FASTA index %s\n",

405 
‚Ái
);

406 
Áû
;

409 
ªs
 = 
	`h˛o£
(
Â
);

410 
Â
 = 
NULL
;

411 i‡(
ªs
 < 0) {

412 i‡(
hts_vîbo£
 >= 1)

413 
	`Ârötf
(
°dîr
, "[fai_load] fail on closing FASTA index %s : %s\n",

414 
‚Ái
, 
	`°ªº‹
(
î∫o
));

415 
Áû
;

418 
Ái
->
bgzf
 = 
	`bgzf_›í
(
‚
, "rb");

419 i‡(
Ái
->
bgzf
 == 0) {

420 i‡(
hts_vîbo£
 >= 1)

421 
	`Ârötf
(
°dîr
, "[Ái_lﬂd] faûÅÿ›í FASTA fûê%s.\n", 
‚
);

422 
Áû
;

424 i‡–
Ái
->
bgzf
->
is_com¥es£d
==1 )

426 i‡–
	`bgzf_ödex_lﬂd
(
Ái
->
bgzf
, 
‚gzi
, 
NULL
) < 0 )

428 i‡(
hts_vîbo£
 >= 1)

429 
	`Ârötf
(
°dîr
, "[fai_load] failedÅoÜoad .gzi index: %s\n",

430 
‚gzi
);

431 
Áû
;

434 
	`‰ì
(
Ái_k°r
.
s
);

435 
	`‰ì
(
gzi_k°r
.
s
);

436  
Ái
;

438 
Áû
:

439 i‡(
Ái
Ë
	`Ái_de°roy
(fai);

440 i‡(
Â
Ë
	`h˛o£_abru±ly
(fp);

441 
	`‰ì
(
Ái_k°r
.
s
);

442 
	`‰ì
(
gzi_k°r
.
s
);

443  
NULL
;

444 
	}
}

446 
Áidx_t
 *
	$Ái_lﬂd
(c⁄° *
‚
)

448  
	`Ái_lﬂd3
(
‚
, 
NULL
, NULL, 
FAI_CREATE
);

449 
	}
}

451 *
	$Ái_ªåõve
(c⁄° 
Áidx_t
 *
Ái
, c⁄° 
Áidx1_t
 *
vÆ
,

452 
beg
, 
íd
, *
Àn
) {

453 *
s
;

454 
size_t
 
l
;

455 
c
 = 0;

456 
ªt
 = 
	`bgzf_u£ek
(
Ái
->
bgzf
,

457 
vÆ
->
off£t


458 + 
beg
 / 
vÆ
->
löe_bÀn
 * vÆ->
löe_Àn


459 + 
beg
 % 
vÆ
->
löe_bÀn
, 
SEEK_SET
);

461 i‡(
ªt
 < 0) {

462 *
Àn
 = -1;

463 i‡(
hts_vîbo£
 >= 1)

464 
	`Ârötf
(
°dîr
, "[fai_fetch] Error: fai_fetch failed. (Seeking iná compressed, .gzi unindexed, file?)\n");

465  
NULL
;

468 
l
 = 0;

469 
s
 = (*)
	`mÆloc
((
size_t
Ë
íd
 - 
beg
 + 2);

470 i‡(!
s
) {

471 *
Àn
 = -1;

472  
NULL
;

475  
l
 < 
íd
 - 
beg
 && (
c
=
	`bgzf_gëc
(
Ái
->
bgzf
))>=0 )

476 i‡(
	`isgøph
(
c
)Ë
s
[
l
++] = c;

477 i‡(
c
 < 0) {

478 i‡(
hts_vîbo£
 >= 1) {

479 
	`Ârötf
(
°dîr
, "[E::fai_fetch] fai_fetch failed : %s\n",

480 
c
 == -1 ? "unexpectedÉnd of file" : "errorÑeading file");

482 
	`‰ì
(
s
);

483 *
Àn
 = -1;

484  
NULL
;

487 
s
[
l
] = '\0';

488 *
Àn
 = 
l
 < 
INT_MAX
 ?Ü : INT_MAX;

489  
s
;

490 
	}
}

492 *
	$Ái_„tch
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
°r
, *
Àn
)

494 *
s
, *
ï
;

495 
size_t
 
i
, 
l
, 
k
, 
«me_íd
;

496 
khôî_t
 
ôî
;

497 
Áidx1_t
 
vÆ
;

498 
	`khash_t
(
s
Ë*
h
;

499 
beg
, 
íd
;

501 
beg
 = 
íd
 = -1;

502 
h
 = 
Ái
->
hash
;

503 
«me_íd
 = 
l
 = 
	`°æí
(
°r
);

504 
s
 = (*)
	`mÆloc
(
l
+1);

505 i‡(!
s
) {

506 *
Àn
 = -1;

507  
NULL
;

511 
i
 = 
k
 = 0; i < 
l
; ++i)

512 i‡(!
	`is•a˚_c
(
°r
[
i
])Ë
s
[
k
++] = str[i];

513 
s
[
k
] = 0;

514 
«me_íd
 = 
l
 = 
k
;

516 
i
 = 
l
; i > 0; --iËi‡(
s
[i - 1] == ':') ;

517 i‡(
i
 > 0Ë
«me_íd
 = i - 1;

518 i‡(
«me_íd
 < 
l
) {

519 
n_hyphí
 = 0;

520 
i
 = 
«me_íd
 + 1; i < 
l
; ++i) {

521 i‡(
s
[
i
] ='-'Ë++
n_hyphí
;

522 i‡(!
	`isdigô_c
(
s
[
i
]) && s[i] != ',') ;

524 i‡(
i
 < 
l
 || 
n_hyphí
 > 1Ë
«me_íd
 =Ü;

525 
s
[
«me_íd
] = 0;

526 
ôî
 = 
	`kh_gë
(
s
, 
h
, s);

527 i‡(
ôî
 =
	`kh_íd
(
h
)) {

528 
ôî
 = 
	`kh_gë
(
s
, 
h
, 
°r
);

529 i‡(
ôî
 !
	`kh_íd
(
h
)) {

530 
s
[
«me_íd
] = ':';

531 
«me_íd
 = 
l
;

534 } 
ôî
 = 
	`kh_gë
(
s
, 
h
, 
°r
);

535 if(
ôî
 =
	`kh_íd
(
h
)) {

536 
	`Ârötf
(
°dîr
, "[Ái_„tch] W¨nög - Re„ªn˚ %†nŸ found i¿FASTA fûe,Ñëu∫ögÉm±y sequí˚\n", 
°r
);

537 
	`‰ì
(
s
);

538 *
Àn
 = -2;

541 
vÆ
 = 
	`kh_vÆue
(
h
, 
ôî
);

543 i‡(
«me_íd
 < 
l
) {

544 
ßve_î∫o
 = 
î∫o
;

545 
î∫o
 = 0;

546 
i
 = 
k
 = 
«me_íd
 + 1; i < 
l
; ++i)

547 i‡(
s
[
i
] !','Ës[
k
++] = s[i];

548 
s
[
k
] = 0;

549 i‡(
s
[
«me_íd
 + 1] == '-') {

550 
beg
 = 0;

551 
i
 = 
«me_íd
 + 2;

553 
beg
 = 
	`°πﬁ
(
s
 + 
«me_íd
 + 1, &
ï
, 10);

554 
i
 = 
ï
 - 
s
; i < 
k
;) if (s[i++] == '-') ;

556 
íd
 = 
i
 < 
k
? 
	`°πﬁ
(
s
 + i, &
ï
, 10Ë: 
vÆ
.
Àn
;

557 i‡(
beg
 > 0) --beg;

560 i‡(
î∫o
 =
ERANGE
 && (
uöt64_t
Ë
vÆ
.
Àn
 > 
LONG_MAX
) {

561 
	`Ârötf
(
°dîr
, "[fai_fetch] Positions inÑange %sáreÅooÜarge"

562 " f‹Åhi†∂©f‹m.\n", 
s
);

563 
	`‰ì
(
s
);

564 *
Àn
 = -2;

565  
NULL
;

567 
î∫o
 = 
ßve_î∫o
;

568 } 
beg
 = 0, 
íd
 = 
vÆ
.
Àn
;

569 i‡(
beg
 >
vÆ
.
Àn
) beg = val.len;

570 i‡(
íd
 >
vÆ
.
Àn
)Énd = val.len;

571 i‡(
beg
 > 
íd
) beg =Énd;

572 
	`‰ì
(
s
);

575  
	`Ái_ªåõve
(
Ái
, &
vÆ
, 
beg
, 
íd
, 
Àn
);

576 
	}
}

578 
	$Áidx_„tch_n£q
(c⁄° 
Áidx_t
 *
Ái
)

580  
Ái
->
n
;

581 
	}
}

583 
	$Áidx_n£q
(c⁄° 
Áidx_t
 *
Ái
)

585  
Ái
->
n
;

586 
	}
}

588 c⁄° *
	$Áidx_i£q
(c⁄° 
Áidx_t
 *
Ái
, 
i
)

590  
Ái
->
«me
[
i
];

591 
	}
}

593 
	$Áidx_£q_Àn
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
£q
)

595 
khöt_t
 
k
 = 
	`kh_gë
(
s
, 
Ái
->
hash
, 
£q
);

596 i‡–
k
 =
	`kh_íd
(
Ái
->
hash
) )  -1;

597  
	`kh_vÆ
(
Ái
->
hash
, 
k
).
Àn
;

598 
	}
}

600 *
	$Áidx_„tch_£q
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
c_«me
, 
p_beg_i
, 
p_íd_i
, *
Àn
)

602 
khôî_t
 
ôî
;

603 
Áidx1_t
 
vÆ
;

606 
ôî
 = 
	`kh_gë
(
s
, 
Ái
->
hash
, 
c_«me
);

607 i‡(
ôî
 =
	`kh_íd
(
Ái
->
hash
))

609 *
Àn
 = -2;

610 
	`Ârötf
(
°dîr
, "[Ái_„tch_£q] Thê£quí˚ \"%s\"ÇŸ found\n", 
c_«me
);

611  
NULL
;

613 
vÆ
 = 
	`kh_vÆue
(
Ái
->
hash
, 
ôî
);

614 if(
p_íd_i
 < 
p_beg_i
)Ö_beg_i =Ö_end_i;

615 if(
p_beg_i
 < 0)Ö_beg_i = 0;

616 if(
vÆ
.
Àn
 <
p_beg_i
)Ö_beg_i = val.len - 1;

617 if(
p_íd_i
 < 0)Ö_end_i = 0;

618 if(
vÆ
.
Àn
 <
p_íd_i
)Ö_end_i = val.len - 1;

621  
	`Ái_ªåõve
(
Ái
, &
vÆ
, 
p_beg_i
, (Ë
p_íd_i
 + 1, 
Àn
);

622 
	}
}

624 
	$Áidx_has_£q
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
£q
)

626 
khôî_t
 
ôî
 = 
	`kh_gë
(
s
, 
Ái
->
hash
, 
£q
);

627 i‡(
ôî
 =
	`kh_íd
(
Ái
->
hash
))  0;

629 
	}
}

	@htslib/hfile.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<î∫o.h
>

31 
	~<limôs.h
>

33 
	~<±hªad.h
>

35 
	~"ht¶ib/hfûe.h
"

36 
	~"hfûe_öã∫Æ.h
"

38 #i‚de‡
ENOTSUP


39 
	#ENOTSUP
 
EINVAL


	)

41 #i‚de‡
EOVERFLOW


42 
	#EOVERFLOW
 
ERANGE


	)

44 #i‚de‡
EPROTONOSUPPORT


45 
	#EPROTONOSUPPORT
 
ENOSYS


	)

48 #i‚de‡
SSIZE_MAX


49 
	#SSIZE_MAX
 
LONG_MAX


	)

95 
hFILE
 *
	$hfûe_öô
(
size_t
 
°ru˘_size
, c⁄° *
mode
, size_à
ˇ∑côy
)

97 
hFILE
 *
Â
 = (hFILE *Ë
	`mÆloc
(
°ru˘_size
);

98 i‡(
Â
 =
NULL
Ë
îr‹
;

100 i‡(
ˇ∑côy
 == 0) capacity = 32768;

102 i‡(
	`°rchr
(
mode
, 'r'Ë&& 
ˇ∑côy
 > 32768) capacity = 32768;

104 
Â
->
buf„r
 = (*Ë
	`mÆloc
(
ˇ∑côy
);

105 i‡(
Â
->
buf„r
 =
NULL
Ë
îr‹
;

107 
Â
->
begö
 = fp->
íd
 = fp->
buf„r
;

108 
Â
->
limô
 = &Â->
buf„r
[
ˇ∑côy
];

110 
Â
->
off£t
 = 0;

111 
Â
->
©_eof
 = 0;

112 
Â
->
mobûe
 = 1;

113 
Â
->
ªad⁄ly
 = (
	`°rchr
(
mode
, 'r') && ! strchr(mode, '+'));

114 
Â
->
has_î∫o
 = 0;

115  
Â
;

117 
îr‹
:

118 
	`hfûe_de°roy
(
Â
);

119  
NULL
;

120 
	}
}

122 
hFILE
 *
	$hfûe_öô_fixed
(
size_t
 
°ru˘_size
, c⁄° *
mode
,

123 *
buf„r
, 
size_t
 
buf_fûÀd
, size_à
buf_size
)

125 
hFILE
 *
Â
 = (hFILE *Ë
	`mÆloc
(
°ru˘_size
);

126 i‡(
Â
 =
NULL
)  NULL;

128 
Â
->
buf„r
 = fp->
begö
 = buffer;

129 
Â
->
íd
 = &Â->
buf„r
[
buf_fûÀd
];

130 
Â
->
limô
 = &Â->
buf„r
[
buf_size
];

132 
Â
->
off£t
 = 0;

133 
Â
->
©_eof
 = 1;

134 
Â
->
mobûe
 = 0;

135 
Â
->
ªad⁄ly
 = (
	`°rchr
(
mode
, 'r') && ! strchr(mode, '+'));

136 
Â
->
has_î∫o
 = 0;

137  
Â
;

138 
	}
}

140 
	$hfûe_de°roy
(
hFILE
 *
Â
)

142 
ßve
 = 
î∫o
;

143 i‡(
Â
Ë
	`‰ì
(Â->
buf„r
);

144 
	`‰ì
(
Â
);

145 
î∫o
 = 
ßve
;

146 
	}
}

148 
ölöe
 
	$wrôebuf„r_is_n⁄em±y
(
hFILE
 *
Â
)

150  
Â
->
begö
 > fp->
íd
;

151 
	}
}

156 
ssize_t
 
	$ªfûl_buf„r
(
hFILE
 *
Â
)

158 
ssize_t
 
n
;

161 i‡(
Â
->
mobûe
 && fp->
begö
 > fp->
buf„r
) {

162 
Â
->
off£t
 +Â->
begö
 - fp->
buf„r
;

163 
	`memmove
(
Â
->
buf„r
, fp->
begö
, fp->
íd
 - fp->begin);

164 
Â
->
íd
 = &Â->
buf„r
[Â->íd - fp->
begö
];

165 
Â
->
begö
 = fp->
buf„r
;

169 i‡(
Â
->
©_eof
 || fp->
íd
 =Â->
limô
Ë
n
 = 0;

171 
n
 = 
Â
->
backíd
->
	`ªad
(Â, fp->
íd
, fp->
limô
 - fp->end);

172 i‡(
n
 < 0Ë{ 
Â
->
has_î∫o
 = 
î∫o
; Ç; }

173 i‡(
n
 =0Ë
Â
->
©_eof
 = 1;

176 
Â
->
íd
 +
n
;

177  
n
;

178 
	}
}

181 
	$hgëc2
(
hFILE
 *
Â
)

183  (
	`ªfûl_buf„r
(
Â
Ë> 0)? (Ë*(Â->
begö
++Ë: 
EOF
;

184 
	}
}

186 
ssize_t
 
	$hgëdñim
(*
buf„r
, 
size_t
 
size
, 
dñim
, 
hFILE
 *
Â
)

188 *
found
;

189 
size_t
 
n
, 
c›õd
 = 0;

190 
ssize_t
 
gŸ
;

192 i‡(
size
 < 1 || sizê> 
SSIZE_MAX
) {

193 
Â
->
has_î∫o
 = 
î∫o
 = 
EINVAL
;

196 i‡(
	`wrôebuf„r_is_n⁄em±y
(
Â
)) {

197 
Â
->
has_î∫o
 = 
î∫o
 = 
EBADF
;

201 --
size
;

204 
n
 = 
Â
->
íd
 - fp->
begö
;

205 i‡(
n
 > 
size
 - 
c›õd
)Ç = size - copied;

208 
found
 = 
	`memchr
(
Â
->
begö
, 
dñim
, 
n
);

209 i‡(
found
 !
NULL
) {

210 
n
 = 
found
 - 
Â
->
begö
 + 1;

211 
	`mem˝y
(
buf„r
 + 
c›õd
, 
Â
->
begö
, 
n
);

212 
buf„r
[
n
 + 
c›õd
] = '\0';

213 
Â
->
begö
 +
n
;

214  
n
 + 
c›õd
;

218 
	`mem˝y
(
buf„r
 + 
c›õd
, 
Â
->
begö
, 
n
);

219 
Â
->
begö
 +
n
;

220 
c›õd
 +
n
;

222 i‡(
c›õd
 =
size
) {

223 
buf„r
[
c›õd
] = '\0';

224  
c›õd
;

227 
gŸ
 = 
	`ªfûl_buf„r
(
Â
);

228 } 
gŸ
 > 0);

230 i‡(
gŸ
 < 0)  -1;

232 
buf„r
[
c›õd
] = '\0';

233  
c›õd
;

234 
	}
}

236 *
	$hgës
(*
buf„r
, 
size
, 
hFILE
 *
Â
)

238 i‡(
size
 < 1) {

239 
Â
->
has_î∫o
 = 
î∫o
 = 
EINVAL
;

240  
NULL
;

242  
	`hgë 
(
buf„r
, 
size
, 
Â
Ë> 0 ? buf„∏: 
NULL
;

243 
	}
}

245 
ssize_t
 
	$h≥ek
(
hFILE
 *
Â
, *
buf„r
, 
size_t
 
nbyãs
)

247 
size_t
 
n
 = 
Â
->
íd
 - fp->
begö
;

248 
n
 < 
nbyãs
) {

249 
ssize_t
 
ªt
 = 
	`ªfûl_buf„r
(
Â
);

250 i‡(
ªt
 < 0) Ñet;

251 i‡(
ªt
 == 0) ;

252 
n
 +
ªt
;

255 i‡(
n
 > 
nbyãs
)Ç =Çbytes;

256 
	`mem˝y
(
buf„r
, 
Â
->
begö
, 
n
);

257  
n
;

258 
	}
}

262 
ssize_t
 
	$hªad2
(
hFILE
 *
Â
, *
de°v
, 
size_t
 
nbyãs
, size_à
ƒód
)

264 c⁄° 
size_t
 
ˇ∑côy
 = 
Â
->
limô
 - fp->
buf„r
;

265 
buf„r_övÆid©ed
 = 0;

266 *
de°
 = (*Ë
de°v
;

267 
de°
 +
ƒód
, 
nbyãs
 -=Çread;

270 
nbyãs
 * 2 >
ˇ∑côy
 && !
Â
->
©_eof
) {

271 
ssize_t
 
n
 = 
Â
->
backíd
->
	`ªad
(Â, 
de°
, 
nbyãs
);

272 i‡(
n
 < 0Ë{ 
Â
->
has_î∫o
 = 
î∫o
; Ç; }

273 i‡(
n
 =0Ë
Â
->
©_eof
 = 1;

274 
buf„r_övÆid©ed
 = 1;

275 
Â
->
off£t
 +
n
;

276 
de°
 +
n
, 
nbyãs
 -=Ç;

277 
ƒód
 +
n
;

280 i‡(
buf„r_övÆid©ed
) {

285 
Â
->
off£t
 +Â->
begö
 - fp->
buf„r
;

286 
Â
->
begö
 = fp->
íd
 = fp->
buf„r
;

289 
nbyãs
 > 0 && !
Â
->
©_eof
) {

290 
size_t
 
n
;

291 
ssize_t
 
ªt
 = 
	`ªfûl_buf„r
(
Â
);

292 i‡(
ªt
 < 0) Ñet;

294 
n
 = 
Â
->
íd
 - fp->
begö
;

295 i‡(
n
 > 
nbyãs
)Ç =Çbytes;

296 
	`mem˝y
(
de°
, 
Â
->
begö
, 
n
);

297 
Â
->
begö
 +
n
;

298 
de°
 +
n
, 
nbyãs
 -=Ç;

299 
ƒód
 +
n
;

302  
ƒód
;

303 
	}
}

307 
ssize_t
 
	$Êush_buf„r
(
hFILE
 *
Â
)

309 c⁄° *
buf„r
 = 
Â
->buffer;

310 
buf„r
 < 
Â
->
begö
) {

311 
ssize_t
 
n
 = 
Â
->
backíd
->
	`wrôe
(Â, 
buf„r
, fp->
begö
 - buffer);

312 i‡(
n
 < 0Ë{ 
Â
->
has_î∫o
 = 
î∫o
; Ç; }

313 
buf„r
 +
n
;

314 
Â
->
off£t
 +
n
;

317 
Â
->
begö
 = fp->
buf„r
;

319 
	}
}

321 
	$hÊush
(
hFILE
 *
Â
)

323 i‡(
	`Êush_buf„r
(
Â
Ë< 0Ë 
EOF
;

324 i‡(
Â
->
backíd
->
Êush
) {

325 i‡(
Â
->
backíd
->
	`Êush
(ÂË< 0Ë{ fp->
has_î∫o
 = 
î∫o
;  
EOF
; }

328 
	}
}

331 
	$hputc2
(
c
, 
hFILE
 *
Â
)

333 i‡(
	`Êush_buf„r
(
Â
Ë< 0Ë 
EOF
;

334 *(
Â
->
begö
++Ë
c
;

335  
c
;

336 
	}
}

340 
ssize_t
 
	$hwrôe2
(
hFILE
 *
Â
, c⁄° *
§cv
, 
size_t
 
tŸÆbyãs
, size_à
nc›õd
)

342 c⁄° *
§c
 = (c⁄° *Ë
§cv
;

343 
ssize_t
 
ªt
;

344 c⁄° 
size_t
 
ˇ∑côy
 = 
Â
->
limô
 - fp->
buf„r
;

345 
size_t
 
ªmaöög
 = 
tŸÆbyãs
 - 
nc›õd
;

346 
§c
 +
nc›õd
;

348 
ªt
 = 
	`Êush_buf„r
(
Â
);

349 i‡(
ªt
 < 0) Ñet;

352 
ªmaöög
 * 2 >
ˇ∑côy
) {

353 
ssize_t
 
n
 = 
Â
->
backíd
->
	`wrôe
(Â, 
§c
, 
ªmaöög
);

354 i‡(
n
 < 0Ë{ 
Â
->
has_î∫o
 = 
î∫o
; Ç; }

355 
Â
->
off£t
 +
n
;

356 
§c
 +
n
, 
ªmaöög
 -=Ç;

360 
	`mem˝y
(
Â
->
begö
, 
§c
, 
ªmaöög
);

361 
Â
->
begö
 +
ªmaöög
;

363  
tŸÆbyãs
;

364 
	}
}

367 
	$hputs2
(c⁄° *
ãxt
, 
size_t
 
tŸÆbyãs
, size_à
nc›õd
, 
hFILE
 *
Â
)

369  (
	`hwrôe2
(
Â
, 
ãxt
, 
tŸÆbyãs
, 
nc›õd
Ë>0)? 0 : 
EOF
;

370 
	}
}

372 
off_t
 
	$h£ek
(
hFILE
 *
Â
, 
off_t
 
off£t
, 
whí˚
)

374 
off_t
 
cuΩos
, 
pos
;

376 i‡(
	`wrôebuf„r_is_n⁄em±y
(
Â
)) {

377 
ªt
 = 
	`Êush_buf„r
(
Â
);

378 i‡(
ªt
 < 0) Ñet;

381 
cuΩos
 = 
	`hãŒ
(
Â
);

386 i‡(
whí˚
 =
SEEK_CUR
) {

387 i‡(
cuΩos
 + 
off£t
 < 0) {

390 
Â
->
has_î∫o
 = 
î∫o
 = (
off£t
 < 0)? 
EINVAL
 : 
EOVERFLOW
;

394 
whí˚
 = 
SEEK_SET
;

395 
off£t
 = 
cuΩos
 + offset;

399 i‡(! 
Â
->
mobûe
 && 
whí˚
 =
SEEK_END
) {

400 
size_t
 
Àngth
 = 
Â
->
íd
 - fp->
buf„r
;

401 i‡(
off£t
 > 0 || -off£à> 
Àngth
) {

402 
Â
->
has_î∫o
 = 
î∫o
 = 
EINVAL
;

406 
whí˚
 = 
SEEK_SET
;

407 
off£t
 = 
Àngth
 + offset;

412 i‡(
whí˚
 =
SEEK_SET
 && (! 
Â
->
mobûe
 || fp->
ªad⁄ly
) &&

413 
off£t
 >
Â
->off£à&& off£à- fp->off£à<Â->
íd
 - fp->
buf„r
) {

414 
Â
->
begö
 = &Â->
buf„r
[
off£t
 - fp->offset];

415  
off£t
;

418 
pos
 = 
Â
->
backíd
->
	`£ek
(Â, 
off£t
, 
whí˚
);

419 i‡(
pos
 < 0Ë{ 
Â
->
has_î∫o
 = 
î∫o
; Öos; }

422 
Â
->
begö
 = fp->
íd
 = fp->
buf„r
;

423 
Â
->
©_eof
 = 0;

425 
Â
->
off£t
 = 
pos
;

426  
pos
;

427 
	}
}

429 
	$h˛o£
(
hFILE
 *
Â
)

431 
îr
 = 
Â
->
has_î∫o
;

433 i‡(
	`wrôebuf„r_is_n⁄em±y
(
Â
Ë&& 
	`hÊush
(ÂË< 0Ë
îr
 = fp->
has_î∫o
;

434 i‡(
Â
->
backíd
->
	`˛o£
(ÂË< 0Ë
îr
 = 
î∫o
;

435 
	`hfûe_de°roy
(
Â
);

437 i‡(
îr
) {

438 
î∫o
 = 
îr
;

439  
EOF
;

442 
	}
}

444 
	$h˛o£_abru±ly
(
hFILE
 *
Â
)

446 
ßve
 = 
î∫o
;

447 i‡(
Â
->
backíd
->
	`˛o£
(fp) < 0) { }

448 
	`hfûe_de°roy
(
Â
);

449 
î∫o
 = 
ßve
;

450 
	}
}

457 #i‚de‡
_WIN32


458 
	~<sys/sockë.h
>

459 
	~<sys/°©.h
>

460 
	#HAVE_STRUCT_STAT_ST_BLKSIZE


	)

462 
	~<wösock2.h
>

463 
	#HAVE_CLOSESOCKET


	)

464 
	#HAVE_SETMODE


	)

466 
	~<f˙é.h
>

467 
	~<uni°d.h
>

474 
hFILE
 
	mba£
;

475 
	mfd
;

476 
	mis_sockë
:1;

477 } 
	thFILE_fd
;

479 
ssize_t
 
	$fd_ªad
(
hFILE
 *
Âv
, *
buf„r
, 
size_t
 
nbyãs
)

481 
hFILE_fd
 *
Â
 = (hFILE_fd *Ë
Âv
;

482 
ssize_t
 
n
;

484 
n
 = 
Â
->
is_sockë
? 
	`ªcv
(Â->
fd
, 
buf„r
, 
nbyãs
, 0)

485 : 
	`ªad
(
Â
->
fd
, 
buf„r
, 
nbyãs
);

486 } 
n
 < 0 && 
î∫o
 =
EINTR
);

487  
n
;

488 
	}
}

490 
ssize_t
 
	$fd_wrôe
(
hFILE
 *
Âv
, c⁄° *
buf„r
, 
size_t
 
nbyãs
)

492 
hFILE_fd
 *
Â
 = (hFILE_fd *Ë
Âv
;

493 
ssize_t
 
n
;

495 
n
 = 
Â
->
is_sockë
? 
	`£nd
(Â->
fd
, 
buf„r
, 
nbyãs
, 0)

496 : 
	`wrôe
(
Â
->
fd
, 
buf„r
, 
nbyãs
);

497 } 
n
 < 0 && 
î∫o
 =
EINTR
);

498  
n
;

499 
	}
}

501 
off_t
 
	$fd_£ek
(
hFILE
 *
Âv
, 
off_t
 
off£t
, 
whí˚
)

503 
hFILE_fd
 *
Â
 = (hFILE_fd *Ë
Âv
;

504  
	`l£ek
(
Â
->
fd
, 
off£t
, 
whí˚
);

505 
	}
}

507 
	$fd_Êush
(
hFILE
 *
Âv
)

509 
hFILE_fd
 *
Â
 = (hFILE_fd *Ë
Âv
;

510 
ªt
;

512 #ifde‡
HAVE_FDATASYNC


513 
ªt
 = 
	`fd©async
(
Â
->
fd
);

515 
ªt
 = 
	`fsync
(
Â
->
fd
);

519 i‡(
ªt
 < 0 && (
î∫o
 =
EINVAL
 ||Éºnÿ=
ENOTSUP
))Ñet = 0;

520 } 
ªt
 < 0 && 
î∫o
 =
EINTR
);

521  
ªt
;

522 
	}
}

524 
	$fd_˛o£
(
hFILE
 *
Âv
)

526 
hFILE_fd
 *
Â
 = (hFILE_fd *Ë
Âv
;

527 
ªt
;

529 #ifde‡
HAVE_CLOSESOCKET


530 
ªt
 = 
Â
->
is_sockë
? 
	`˛o£sockë
(Â->
fd
Ë: 
	`˛o£
(fp->fd);

532 
ªt
 = 
	`˛o£
(
Â
->
fd
);

534 } 
ªt
 < 0 && 
î∫o
 =
EINTR
);

535  
ªt
;

536 
	}
}

538 c⁄° 
hFILE_backíd
 
	gfd_backíd
 =

540 
fd_ªad
, 
fd_wrôe
, 
fd_£ek
, 
fd_Êush
, 
fd_˛o£


543 
size_t
 
	$blksize
(
fd
)

545 #ifde‡
HAVE_STRUCT_STAT_ST_BLKSIZE


546 
°©
 
sbuf
;

547 i‡(
	`f°©
(
fd
, &
sbuf
) != 0)  0;

548  
sbuf
.
°_blksize
;

552 
	}
}

554 
hFILE
 *
	$h›í_fd
(c⁄° *
fûíame
, c⁄° *
mode
)

556 
hFILE_fd
 *
Â
 = 
NULL
;

557 
fd
 = 
	`›í
(
fûíame
, 
	`hfûe_oÊags
(
mode
), 0666);

558 i‡(
fd
 < 0Ë
îr‹
;

560 
Â
 = (
hFILE_fd
 *Ë
	`hfûe_öô
( (hFILE_fd), 
mode
, 
	`blksize
(
fd
));

561 i‡(
Â
 =
NULL
Ë
îr‹
;

563 
Â
->
fd
 = fd;

564 
Â
->
is_sockë
 = 0;

565 
Â
->
ba£
.
backíd
 = &
fd_backíd
;

566  &
Â
->
ba£
;

568 
îr‹
:

569 i‡(
fd
 >0Ë{ 
ßve
 = 
î∫o
; (Ë
	`˛o£
(fd);Érrno = save; }

570 
	`hfûe_de°roy
((
hFILE
 *Ë
Â
);

571  
NULL
;

572 
	}
}

574 
hFILE
 *
	$hd›í
(
fd
, c⁄° *
mode
)

576 
hFILE_fd
 *
Â
 = (hFILE_fd*Ë
	`hfûe_öô
( (hFILE_fd), 
mode
, 
	`blksize
(
fd
));

577 i‡(
Â
 =
NULL
)  NULL;

579 
Â
->
fd
 = fd;

580 
Â
->
is_sockë
 = (
	`°rchr
(
mode
, 's'Ë!
NULL
);

581 
Â
->
ba£
.
backíd
 = &
fd_backíd
;

582  &
Â
->
ba£
;

583 
	}
}

585 
hFILE
 *
	$h›í_fd_fûeuri
(c⁄° *
uæ
, c⁄° *
mode
)

587 i‡(
	`°∫cmp
(
uæ
, "file://localhost/", 17) == 0) url += 16;

588 i‡(
	`°∫cmp
(
uæ
, "file:///", 8) == 0) url += 7;

589 { 
î∫o
 = 
EPROTONOSUPPORT
;  
NULL
; }

591  
	`h›í_fd
(
uæ
, 
mode
);

592 
	}
}

594 
hFILE
 *
	$h›í_fd_°döout
(c⁄° *
mode
)

596 
fd
 = (
	`°rchr
(
mode
, 'r'Ë!
NULL
)? 
STDIN_FILENO
 : 
STDOUT_FILENO
;

597 #i‡
deföed
 
HAVE_SETMODE
 && deföed 
O_BINARY


598 i‡(
	`£tmode
(
fd
, 
O_BINARY
Ë< 0Ë 
NULL
;

600  
	`hd›í
(
fd
, 
mode
);

601 
	}
}

603 
	$hfûe_oÊags
(c⁄° *
mode
)

605 
rdwr
 = 0, 
Êags
 = 0;

606 c⁄° *
s
;

607 
s
 = 
mode
; *s; s++)

608 *
s
) {

609 'r': 
rdwr
 = 
O_RDONLY
; ;

610 'w': 
rdwr
 = 
O_WRONLY
; 
Êags
 |
O_CREAT
 | 
O_TRUNC
; ;

611 'a': 
rdwr
 = 
O_WRONLY
; 
Êags
 |
O_CREAT
 | 
O_APPEND
; ;

612 '+': 
rdwr
 = 
O_RDWR
; ;

613 #ifde‡
O_CLOEXEC


614 'e': 
Êags
 |
O_CLOEXEC
; ;

616 #ifde‡
O_EXCL


617 'x': 
Êags
 |
O_EXCL
; ;

622 #ifde‡
O_BINARY


623 
Êags
 |
O_BINARY
;

626  
rdwr
 | 
Êags
;

627 
	}
}

634 
	~"hts_öã∫Æ.h
"

637 
hFILE
 
	mba£
;

638 } 
	thFILE_mem
;

640 
off_t
 
	$mem_£ek
(
hFILE
 *
Âv
, 
off_t
 
off£t
, 
whí˚
)

642 
î∫o
 = 
EINVAL
;

644 
	}
}

646 
	$mem_˛o£
(
hFILE
 *
Âv
)

649 
	}
}

651 c⁄° 
hFILE_backíd
 
	gmem_backíd
 =

653 
NULL
, NULL, 
mem_£ek
, NULL, 
mem_˛o£


656 
	$cmp_¥efix
(c⁄° *
key
, c⁄° *
s
)

658 *
key
)

659 i‡(
	`tﬁowî_c
(*
s
Ë!*
key
)  +1;

660 
s
++, 
key
++;

663 
	}
}

665 
hFILE
 *
	$h›í_mem
(c⁄° *
uæ
, c⁄° *
mode
)

667 
size_t
 
Àngth
, 
size
;

668 *
buf„r
;

669 c⁄° *
d©a
, *
comma
 = 
	`°rchr
(
uæ
, ',');

670 i‡(
comma
 =
NULL
Ë{ 
î∫o
 = 
EINVAL
;  NULL; }

671 
d©a
 = 
comma
+1;

674 i‡(
	`°rchr
(
mode
, 'r'Ë=
NULL
Ë{ 
î∫o
 = 
EROFS
;  NULL; }

676 i‡(
comma
 - 
uæ
 >7 && 
	`cmp_¥efix
(";base64", &comma[-7]) == 0) {

677 
size
 = 
	`hts_ba£64_decoded_Àngth
(
	`°æí
(
d©a
));

678 
buf„r
 = 
	`mÆloc
(
size
);

679 i‡(
buf„r
 =
NULL
)  NULL;

680 
	`hts_decode_ba£64
(
buf„r
, &
Àngth
, 
d©a
);

683 
size
 = 
	`°æí
(
d©a
) + 1;

684 
buf„r
 = 
	`mÆloc
(
size
);

685 i‡(
buf„r
 =
NULL
)  NULL;

686 
	`hts_decode_≥r˚¡
(
buf„r
, &
Àngth
, 
d©a
);

689 
hFILE_mem
 *
Â
 = (hFILE_mem *)

690 
	`hfûe_öô_fixed
( (
hFILE_mem
), 
mode
, 
buf„r
, 
Àngth
, 
size
);

691 i‡(
Â
 =
NULL
Ë{ 
	`‰ì
(
buf„r
);  NULL; }

693 
Â
->
ba£
.
backíd
 = &
mem_backíd
;

694  &
Â
->
ba£
;

695 
	}
}

702 
	~"ht¶ib/khash.h
"

704 
	$KHASH_MAP_INIT_STR
(
scheme_°rög
, c⁄° 
hFILE_scheme_h™dÀr
 *)

705 
	`khash_t
(
scheme_°rög
Ë*
schemes
 = 
NULL
;

707 
	shFILE_∂ugö_li°
 {

708 
hFILE_∂ugö
 
∂ugö
;

709 
hFILE_∂ugö_li°
 *
√xt
;

712 
hFILE_∂ugö_li°
 *
∂ugös
 = 
NULL
;

713 
±hªad_muãx_t
 
∂ugös_lock
 = 
PTHREAD_MUTEX_INITIALIZER
;

715 
	$hfûe_exô
()

717 
	`±hªad_muãx_lock
(&
∂ugös_lock
);

719 
	`kh_de°roy
(
scheme_°rög
, 
schemes
);

721 
∂ugös
 !
NULL
) {

722 
hFILE_∂ugö_li°
 *
p
 = 
∂ugös
;

723 i‡(
p
->
∂ugö
.
de°roy
Ëp->∂ugö.
	`de°roy
();

724 #ifde‡
ENABLE_PLUGINS


725 i‡(
p
->
∂ugö
.
obj
Ë
	`˛o£_∂ugö
(p->plugin.obj);

727 
∂ugös
 = 
p
->
√xt
;

728 
	`‰ì
(
p
);

731 
	`±hªad_muãx_u∆ock
(&
∂ugös_lock
);

732 
	`±hªad_muãx_de°roy
(&
∂ugös_lock
);

733 
	}
}

735 
ölöe
 
	$¥i‹ôy
(c⁄° 
hFILE_scheme_h™dÀr
 *
h™dÀr
)

737  
h™dÀr
->
¥i‹ôy
 % 1000;

738 
	}
}

740 
	$hfûe_add_scheme_h™dÀr
(c⁄° *
scheme
,

741 c⁄° 
hFILE_scheme_h™dÀr
 *
h™dÀr
)

743 
ab£¡
;

744 
khöt_t
 
k
 = 
	`kh_put
(
scheme_°rög
, 
schemes
, 
scheme
, &
ab£¡
);

745 i‡(
ab£¡
 || 
	`¥i‹ôy
(
h™dÀr
Ë>Öri‹ôy(
	`kh_vÆue
(
schemes
, 
k
))) {

746 
	`kh_vÆue
(
schemes
, 
k
Ë
h™dÀr
;

748 
	}
}

750 
	$öô_add_∂ugö
(*
obj
, (*
öô
)(
hFILE_∂ugö
 *),

751 c⁄° *
∂ugö«me
)

753 
hFILE_∂ugö_li°
 *
p
 = 
	`mÆloc
 ( (hFILE_plugin_list));

754 i‡(
p
 =
NULL
Ë
	`ab‹t
();

756 
p
->
∂ugö
.
≠i_vîsi⁄
 = 1;

757 
p
->
∂ugö
.
obj
 = obj;

758 
p
->
∂ugö
.
«me
 = 
NULL
;

759 
p
->
∂ugö
.
de°roy
 = 
NULL
;

761 
ªt
 = (*
öô
)(&
p
->
∂ugö
);

763 i‡(
ªt
 != 0) {

764 i‡(
hts_vîbo£
 >= 4)

765 
	`Ârötf
(
°dîr
, "[W::load_hfile_plugins] "

767 
∂ugö«me
, 
ªt
);

768 
	`‰ì
(
p
);

769  
ªt
;

772 i‡(
hts_vîbo£
 >= 5)

773 
	`Ârötf
(
°dîr
, "[M::lﬂd_hfûe_∂ugös]Üﬂded \"%s\"\n", 
∂ugö«me
);

775 
p
->
√xt
 = 
∂ugös
,Ölugins =Ö;

777 
	}
}

779 
	$lﬂd_hfûe_∂ugös
()

781 c⁄° 
hFILE_scheme_h™dÀr


782 
d©a
 = { 
h›í_mem
, 
hfûe_Æways_loˇl
, "built-in", 80 },

783 
fûe
 = { 
h›í_fd_fûeuri
, 
hfûe_Æways_loˇl
, "built-in", 80 };

785 
schemes
 = 
	`kh_öô
(
scheme_°rög
);

786 i‡(
schemes
 =
NULL
Ë
	`ab‹t
();

788 
	`hfûe_add_scheme_h™dÀr
("d©a", &
d©a
);

789 
	`hfûe_add_scheme_h™dÀr
("fûe", &
fûe
);

790 
	`öô_add_∂ugö
(
NULL
, 
hfûe_∂ugö_öô_√t
, "knetfile");

792 #ifde‡
ENABLE_PLUGINS


793 
hts_∑th_ôr
 
∑th
;

794 c⁄° *
∂ugö«me
;

795 
	`hts_∑th_ôr_£tup
(&
∑th
, 
NULL
, NULL, "hfile_", 6, NULL, 0);

796 (
∂ugö«me
 = 
	`hts_∑th_ôr_√xt
(&
∑th
)Ë!
NULL
) {

797 *
obj
;

798 (*
öô
)(
hFILE_∂ugö
 *) = ((*)(hFILE_plugin *))

799 
	`lﬂd_∂ugö
(&
obj
, 
∂ugö«me
, "hfile_plugin_init");

801 i‡(
öô
) {

802 i‡(
	`öô_add_∂ugö
(
obj
, 
öô
, 
∂ugö«me
) != 0)

803 
	`˛o£_∂ugö
(
obj
);

808 #ifde‡
HAVE_LIBCURL


809 
	`öô_add_∂ugö
(
NULL
, 
hfûe_∂ugö_öô_libcuæ
, "libcurl");

811 #ifde‡
ENABLE_GCS


812 
	`öô_add_∂ugö
(
NULL
, 
hfûe_∂ugö_öô_gcs
, "gcs");

814 #ifde‡
ENABLE_S3


815 
	`öô_add_∂ugö
(
NULL
, 
hfûe_∂ugö_öô_s3
, "s3");

823 (Ë
	`©exô
(
hfûe_exô
);

824 
	}
}

830 
hFILE
 *
	$h›í_unknown_scheme
(c⁄° *
‚ame
, c⁄° *
mode
)

832 
hFILE
 *
Â
 = 
	`h›í_fd
(
‚ame
, 
mode
);

833 i‡(
Â
 =
NULL
 && 
î∫o
 =
ENOENT
Ëî∫ÿ
EPROTONOSUPPORT
;

834  
Â
;

835 
	}
}

838 c⁄° 
hFILE_scheme_h™dÀr
 *
	$föd_scheme_h™dÀr
(c⁄° *
s
)

840 c⁄° 
hFILE_scheme_h™dÀr
 
unknown_scheme
 =

841 { 
h›í_unknown_scheme
, 
hfûe_Æways_loˇl
, "built-in", 0 };

843 
scheme
[12];

844 
i
;

846 
i
 = 0; i <  
scheme
; i++)

847 i‡(
	`iß um_c
(
s
[
i
]) || s[i] == '+' || s[i] == '-' || s[i] == '.')

848 
scheme
[
i
] = 
	`tﬁowî_c
(
s
[i]);

849 i‡(
s
[
i
] == ':') ;

850  
NULL
;

852 i‡(
i
 =0 || i > 
scheme
Ë 
NULL
;

853 
scheme
[
i
] = '\0';

855 
	`±hªad_muãx_lock
(&
∂ugös_lock
);

856 i‡(! 
schemes
Ë
	`lﬂd_hfûe_∂ugös
();

857 
	`±hªad_muãx_u∆ock
(&
∂ugös_lock
);

859 
khöt_t
 
k
 = 
	`kh_gë
(
scheme_°rög
, 
schemes
, 
scheme
);

860  (
k
 !
	`kh_íd
(
schemes
))? 
	`kh_vÆue
(schemes, kË: &
unknown_scheme
;

861 
	}
}

863 
hFILE
 *
	$h›í
(c⁄° *
‚ame
, c⁄° *
mode
, ...)

865 c⁄° 
hFILE_scheme_h™dÀr
 *
h™dÀr
 = 
	`föd_scheme_h™dÀr
(
‚ame
);

866 i‡(
h™dÀr
) {

867 i‡(
	`°rchr
(
mode
, ':'Ë=
NULL
Ë 
h™dÀr
->
	`›í
(
‚ame
, mode);

868 i‡(
h™dÀr
->
¥i‹ôy
 >2000 && h™dÀr->
v›í
) {

869 
hFILE
 *
Â
;

870 
va_li°
 
¨g
;

871 
	`va_°¨t
(
¨g
, 
mode
);

872 
Â
 = 
h™dÀr
->
	`v›í
(
‚ame
, 
mode
, 
¨g
);

873 
	`va_íd
(
¨g
);

874  
Â
;

876 { 
î∫o
 = 
ENOTSUP
;  
NULL
; }

878 i‡(
	`°rcmp
(
‚ame
, "-"Ë=0Ë 
	`h›í_fd_°döout
(
mode
);

879  
	`h›í_fd
(
‚ame
, 
mode
);

880 
	}
}

882 
	$hfûe_Æways_loˇl
 (c⁄° *
‚ame
Ë{  0; 
	}
}

883 
	$hfûe_Æways_ªmŸe
(c⁄° *
‚ame
Ë{  1; 
	}
}

885 
	$hi§emŸe
(c⁄° *
‚ame
)

887 c⁄° 
hFILE_scheme_h™dÀr
 *
h™dÀr
 = 
	`föd_scheme_h™dÀr
(
‚ame
);

888  
h™dÀr
? h™dÀr->
	`i§emŸe
(
‚ame
) : 0;

889 
	}
}

	@htslib/hfile_gcs.c

25 
	~<c⁄fig.h
>

27 
	~<°d¨g.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<î∫o.h
>

33 
	~"ht¶ib/hts.h
"

34 
	~"ht¶ib/k°rög.h
"

35 
	~"hfûe_öã∫Æ.h
"

36 #ifde‡
ENABLE_PLUGINS


37 
	~"vîsi⁄.h
"

40 
hFILE
 *

41 
	$gcs_ªwrôe
(c⁄° *
gsuæ
, c⁄° *
mode
, 
mode_has_cﬁ⁄
,

42 
va_li°
 *
¨g•
)

44 c⁄° *
buckë
, *
∑th
, *
ac˚ss_tokí
;

45 
k°rög_t
 
mode_cﬁ⁄
 = { 0, 0, 
NULL
 };

46 
k°rög_t
 
uæ
 = { 0, 0, 
NULL
 };

47 
k°rög_t
 
auth_hdr
 = { 0, 0, 
NULL
 };

48 
hFILE
 *
Â
 = 
NULL
;

52 i‡(
gsuæ
[2] == '+') {

53 
buckë
 = 
	`°rchr
(
gsuæ
, ':') + 1;

54 
	`kput¢
(&
gsuæ
[3], 
buckë
 - &gsuæ[3], &
uæ
);

57 
	`kputs
("hâps:", &
uæ
);

58 
buckë
 = &
gsuæ
[3];

60 *
buckë
 ='/'Ë
	`kputc
(*buckë++, &
uæ
);

62 
∑th
 = 
buckë
 + 
	`°rc•n
(bucket, "/?#");

64 
	`kput¢
(
buckë
, 
∑th
 - buckë, &
uæ
);

65 i‡(
	`°rchr
(
mode
, 'r')Ë
	`kputs
(".°‹age-dow∆ﬂd", &
uæ
);

66 i‡(
	`°rchr
(
mode
, 'w')Ë
	`kputs
(".°‹age-u∂ﬂd", &
uæ
);

67 
	`kputs
(".°‹age", &
uæ
);

68 
	`kputs
(".googÀ≠is.com", &
uæ
);

70 
	`kputs
(
∑th
, &
uæ
);

72 i‡(
hts_vîbo£
 >= 8)

73 
	`Ârötf
(
°dîr
, "[M::gcs_›í]ÑewrŸêURLá†%s\n", 
uæ
.
s
);

76 
ac˚ss_tokí
 = 
	`gëív
("GCS_OAUTH_TOKEN");

78 i‡(
ac˚ss_tokí
) {

79 
	`kputs
("Auth‹iz©i⁄: Bóª∏", &
auth_hdr
);

80 
	`kputs
(
ac˚ss_tokí
, &
auth_hdr
);

83 i‡(
¨g•
 || 
auth_hdr
.
l
 > 0 || 
mode_has_cﬁ⁄
) {

84 i‡(! 
mode_has_cﬁ⁄
) {

85 
	`kputs
(
mode
, &
mode_cﬁ⁄
);

86 
	`kputc
(':', &
mode_cﬁ⁄
);

87 
mode
 = 
mode_cﬁ⁄
.
s
;

90 
Â
 = 
	`h›í
(
uæ
.
s
, 
mode
, "va_li°", 
¨g•
,

91 "hâphdr", (
auth_hdr
.
l
 > 0)?áuth_hdr.
s
 : 
NULL
, NULL);

94 
Â
 = 
	`h›í
(
uæ
.
s
, 
mode
);

96 
	`‰ì
(
mode_cﬁ⁄
.
s
);

97 
	`‰ì
(
uæ
.
s
);

98 
	`‰ì
(
auth_hdr
.
s
);

99  
Â
;

100 
	}
}

102 
hFILE
 *
	$gcs_›í
(c⁄° *
uæ
, c⁄° *
mode
)

104  
	`gcs_ªwrôe
(
uæ
, 
mode
, 0, 
NULL
);

105 
	}
}

107 
hFILE
 *
	$gcs_v›í
(c⁄° *
uæ
, c⁄° *
mode_cﬁ⁄
, 
va_li°
 
¨gs0
)

111 
va_li°
 
¨gs
;

112 
	`va_c›y
(
¨gs
, 
¨gs0
);

113 
hFILE
 *
Â
 = 
	`gcs_ªwrôe
(
uæ
, 
mode_cﬁ⁄
, 1, &
¨gs
);

114 
	`va_íd
(
¨gs
);

115  
Â
;

116 
	}
}

118 
	$PLUGIN_GLOBAL
(
hfûe_∂ugö_öô
,
_gcs
)(
hFILE_∂ugö
 *
£lf
)

120 c⁄° 
hFILE_scheme_h™dÀr
 
h™dÀr
 =

121 { 
gcs_›í
, 
hfûe_Æways_ªmŸe
, "Google Cloud Storage",

122 2000 + 50, 
gcs_v›í


125 #ifde‡
ENABLE_PLUGINS


127 c⁄° 
id
[] = "@(#)hfûe_gc†∂ugö (ht¶ib)\t" 
HTS_VERSION
;

128 i‡(
hts_vîbo£
 >= 9)

129 
	`Ârötf
(
°dîr
, "[M::hfûe_gcs.öô] vîsi⁄ %s\n", 
	`°rchr
(
id
, '\t')+1);

132 
£lf
->
«me
 = "Google Cloud Storage";

133 
	`hfûe_add_scheme_h™dÀr
("gs", &
h™dÀr
);

134 
	`hfûe_add_scheme_h™dÀr
("gs+hâp", &
h™dÀr
);

135 
	`hfûe_add_scheme_h™dÀr
("gs+hâps", &
h™dÀr
);

137 
	}
}

	@htslib/hfile_internal.h

25 #i‚de‡
HFILE_INTERNAL_H


26 
	#HFILE_INTERNAL_H


	)

28 
	~<°d¨g.h
>

30 
	~"ht¶ib/hfûe.h
"

32 #ifde‡
__˝lu•lus


36 
	shFILE_backíd
 {

40 
ssize_t
 (*
ªad
)(
hFILE
 *
Â
, *
buf„r
, 
size_t
 
nbyãs
Ë
HTS_RESULT_USED
;

45 
ssize_t
 (*
wrôe
)(
hFILE
 *
Â
, c⁄° *
buf„r
, 
size_t
 
nbyãs
)

46 
HTS_RESULT_USED
;

50 
off_t
 (*
£ek
)(
hFILE
 *
Â
, off_à
off£t
, 
whí˚
Ë
HTS_RESULT_USED
;

54 (*
Êush
)(
hFILE
 *
Â
Ë
HTS_RESULT_USED
;

59 (*
˛o£
)(
hFILE
 *
Â
Ë
HTS_RESULT_USED
;

64 
hfûe_oÊags
(c⁄° *
mode
);

69 
hFILE
 *
hfûe_öô
(
size_t
 
°ru˘_size
, c⁄° *
mode
, size_à
ˇ∑côy
);

75 
hFILE
 *
hfûe_öô_fixed
(
size_t
 
°ru˘_size
, c⁄° *
mode
,

76 *
buf„r
, 
size_t
 
buf_fûÀd
, size_à
buf_size
);

81 
hfûe_de°roy
(
hFILE
 *
Â
);

84 
	shFILE_scheme_h™dÀr
 {

88 
hFILE
 *(*
›í
)(c⁄° *
fûíame
, c⁄° *
mode
Ë
HTS_RESULT_USED
;

92 (*
i§emŸe
)(c⁄° *
fûíame
Ë
HTS_RESULT_USED
;

95 c⁄° *
¥ovidî
;

101 
¥i‹ôy
;

107 
hFILE
 *(*
v›í
)(c⁄° *
fûíame
, c⁄° *
mode
, 
va_li°
 
¨gs
)

108 
HTS_RESULT_USED
;

112 
hfûe_Æways_loˇl
 (c⁄° *
‚ame
);

113 
hfûe_Æways_ªmŸe
(c⁄° *
‚ame
);

116 
hfûe_add_scheme_h™dÀr
(c⁄° *
scheme
,

117 c⁄° 
hFILE_scheme_h™dÀr
 *
h™dÀr
);

119 
	shFILE_∂ugö
 {

121 
	g≠i_vîsi⁄
;

124 *
	gobj
;

127 c⁄° *
	g«me
;

130 (*
	gde°roy
)();

133 #ifde‡
ENABLE_PLUGINS


134 
	#PLUGIN_GLOBAL
(
idítifõr
,
suffix
Ë
	)
identifier

137 
hfûe_∂ugö_öô
(
hFILE_∂ugö
 *
£lf
);

140 
	#PLUGIN_GLOBAL
(
idítifõr
,
suffix
Ëidítifõr##
	)
suffix

146 
hfûe_∂ugö_öô_gcs
(
hFILE_∂ugö
 *
£lf
);

147 
hfûe_∂ugö_öô_libcuæ
(
hFILE_∂ugö
 *
£lf
);

148 
hfûe_∂ugö_öô_s3
(
hFILE_∂ugö
 *
£lf
);

152 
hfûe_∂ugö_öô_√t
(
hFILE_∂ugö
 *
£lf
);

154 #ifde‡
__˝lu•lus


	@htslib/hfile_libcurl.c

25 
	~<c⁄fig.h
>

27 
	~<°d¨g.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<î∫o.h
>

31 
	~<sys/£À˘.h
>

33 
	~"hfûe_öã∫Æ.h
"

34 #ifde‡
ENABLE_PLUGINS


35 
	~"vîsi⁄.h
"

37 
	~"ht¶ib/hts.h
"

38 
	~"ht¶ib/k°rög.h
"

40 
	~<cuæ/cuæ.h
>

43 
hFILE
 
	mba£
;

44 
CURL
 *
	mósy
;

45 
cuæ_¶i°
 *
	mhódîs
;

46 
off_t
 
	mfûe_size
;

48 uni⁄ { *
	mrd
; c⁄° *
	mwr
; } 
	m±r
;

49 
size_t
 
	mÀn
;

50 } 
	mbuf„r
;

51 
CURLcode
 
	mföÆ_ªsu…
;

53 
	m∑u£d
 : 1;

54 
	m˛osög
 : 1;

55 
	mföished
 : 1;

56 } 
	thFILE_libcuæ
;

58 
	$hâp_°©us_î∫o
(
°©us
)

60 i‡(
°©us
 >= 500)

61 
°©us
) {

62 501:  
ENOSYS
;

63 503:  
EBUSY
;

64 504:  
ETIMEDOUT
;

65 :  
EIO
;

67 i‡(
°©us
 >= 400)

68 
°©us
) {

69 401:  
EPERM
;

70 403:  
EACCES
;

71 404:  
ENOENT
;

72 405:  
EROFS
;

73 407:  
EPERM
;

74 408:  
ETIMEDOUT
;

75 410:  
ENOENT
;

76 :  
EINVAL
;

79 
	}
}

81 
	$ósy_î∫o
(
CURL
 *
ósy
, 
CURLcode
 
îr
)

83 
lvÆ
;

85 
îr
) {

86 
CURLE_OK
:

89 
CURLE_UNSUPPORTED_PROTOCOL
:

90 
CURLE_URL_MALFORMAT
:

91  
EINVAL
;

93 #i‡
LIBCURL_VERSION_NUM
 >= 0x071505

94 
CURLE_NOT_BUILT_IN
:

95  
ENOSYS
;

98 
CURLE_COULDNT_RESOLVE_PROXY
:

99 
CURLE_COULDNT_RESOLVE_HOST
:

100 
CURLE_FTP_CANT_GET_HOST
:

101  
EDESTADDRREQ
;

103 
CURLE_COULDNT_CONNECT
:

104 
CURLE_SEND_ERROR
:

105 
CURLE_RECV_ERROR
:

106 i‡(
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_OS_ERRNO
, &
lvÆ
Ë=
CURLE_OK
)

107  
lvÆ
;

109  
ECONNABORTED
;

111 
CURLE_REMOTE_ACCESS_DENIED
:

112 
CURLE_LOGIN_DENIED
:

113 
CURLE_TFTP_PERM
:

114  
EACCES
;

116 
CURLE_PARTIAL_FILE
:

117  
EPIPE
;

119 
CURLE_HTTP_RETURNED_ERROR
:

120 i‡(
	`cuæ_ósy_gëöfo
(
ósy
, 
CURLINFO_RESPONSE_CODE
, &
lvÆ
Ë=
CURLE_OK
)

121  
	`hâp_°©us_î∫o
(
lvÆ
);

123  
EIO
;

125 
CURLE_OUT_OF_MEMORY
:

126  
ENOMEM
;

128 
CURLE_OPERATION_TIMEDOUT
:

129  
ETIMEDOUT
;

131 
CURLE_RANGE_ERROR
:

132  
ESPIPE
;

134 
CURLE_SSL_CONNECT_ERROR
:

136  
ECONNABORTED
;

138 
CURLE_FILE_COULDNT_READ_FILE
:

139 
CURLE_TFTP_NOTFOUND
:

140  
ENOENT
;

142 
CURLE_TOO_MANY_REDIRECTS
:

143  
ELOOP
;

145 
CURLE_FILESIZE_EXCEEDED
:

146  
EFBIG
;

148 
CURLE_REMOTE_DISK_FULL
:

149  
ENOSPC
;

151 
CURLE_REMOTE_FILE_EXISTS
:

152  
EEXIST
;

155  
EIO
;

157 
	}
}

159 
	$mu…i_î∫o
(
CURLMcode
 
îrm
)

161 
îrm
) {

162 
CURLM_CALL_MULTI_PERFORM
:

163 
CURLM_OK
:

166 
CURLM_BAD_HANDLE
:

167 
CURLM_BAD_EASY_HANDLE
:

168 
CURLM_BAD_SOCKET
:

169  
EBADF
;

171 
CURLM_OUT_OF_MEMORY
:

172  
ENOMEM
;

175  
EIO
;

177 
	}
}

181 
CURLM
 *
	mmu…i
;

182 
k°rög_t
 
	mu£øgít
;

183 
	mƒu¬ög
;

184 
	m≥rf‹m_agaö
 : 1;

185 } 
	gcuæ
 = { 
NULL
, { 0, 0, NULL }, 0, 0 };

187 
	$libcuæ_exô
()

189 (Ë
	`cuæ_mu…i_˛ónup
(
cuæ
.
mu…i
);

190 
cuæ
.
mu…i
 = 
NULL
;

192 
	`‰ì
(
cuæ
.
u£øgít
.
s
);

193 
cuæ
.
u£øgít
.
l
 = cuæ.u£øgít.
m
 = 0; cuæ.u£øgít.
s
 = 
NULL
;

195 
	`cuæ_globÆ_˛ónup
();

196 
	}
}

199 
	$¥o˚ss_mesßges
()

201 
CURLMsg
 *
msg
;

202 
ªmaöög
;

204 (
msg
 = 
	`cuæ_mu…i_öfo_ªad
(
cuæ
.
mu…i
, &
ªmaöög
)Ë!
NULL
) {

205 
hFILE_libcuæ
 *
Â
 = 
NULL
;

206 
	`cuæ_ósy_gëöfo
(
msg
->
ósy_h™dÀ
, 
CURLINFO_PRIVATE
, (**Ë&
Â
);

207 
msg
->msg) {

208 
CURLMSG_DONE
:

209 
Â
->
föished
 = 1;

210 
Â
->
föÆ_ªsu…
 = 
msg
->
d©a
.
ªsu…
;

217 
	}
}

219 
	$waô_≥rf‹m
()

221 
fd_£t
 
rd
, 
wr
, 
ex
;

222 
maxfd
, 
ƒu¬ög
;

223 
timeout
;

224 
CURLMcode
 
îrm
;

226 
	`FD_ZERO
(&
rd
);

227 
	`FD_ZERO
(&
wr
);

228 
	`FD_ZERO
(&
ex
);

229 i‡(
	`cuæ_mu…i_fd£t
(
cuæ
.
mu…i
, &
rd
, &
wr
, &
ex
, &
maxfd
Ë!
CURLM_OK
)

230 
maxfd
 = -1, 
timeout
 = 1000;

231 i‡(
maxfd
 < 0)

232 
timeout
 = 100;

234 i‡(
	`cuæ_mu…i_timeout
(
cuæ
.
mu…i
, &
timeout
Ë!
CURLM_OK
)

235 
timeout
 = 1000;

236 i‡(
timeout
 < 0)

237 
timeout
 = 10000;

240 i‡(
timeout
 > 0 && ! 
cuæ
.
≥rf‹m_agaö
) {

241 
timevÆ
 
tvÆ
;

242 
tvÆ
.
tv_£c
 = (
timeout
 / 1000);

243 
tvÆ
.
tv_u£c
 = (
timeout
 % 1000) * 1000;

245 i‡(
	`£À˘
(
maxfd
 + 1, &
rd
, &
wr
, &
ex
, &
tvÆ
) < 0)  -1;

248 
îrm
 = 
	`cuæ_mu…i_≥rf‹m
(
cuæ
.
mu…i
, &
ƒu¬ög
);

249 
cuæ
.
≥rf‹m_agaö
 = 0;

250 i‡(
îrm
 =
CURLM_CALL_MULTI_PERFORM
Ë
cuæ
.
≥rf‹m_agaö
 = 1;

251 i‡(
îrm
 !
CURLM_OK
Ë{ 
î∫o
 = 
	`mu…i_î∫o
(errm);  -1; }

253 i‡(
ƒu¬ög
 < 
cuæ
.ƒu¬ögË
	`¥o˚ss_mesßges
();

255 
	}
}

258 
size_t
 
	$ªcv_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
Âv
)

260 
hFILE_libcuæ
 *
Â
 = (hFILE_libcuæ *Ë
Âv
;

261 
size_t
 
n
 = 
size
 * 
nmemb
;

263 i‡(
n
 > 
Â
->
buf„r
.
Àn
Ë{ fp->
∑u£d
 = 1;  
CURL_WRITEFUNC_PAUSE
; }

264 i‡(
n
 == 0)  0;

266 
	`mem˝y
(
Â
->
buf„r
.
±r
.
rd
,Öå, 
n
);

267 
Â
->
buf„r
.
±r
.
rd
 +
n
;

268 
Â
->
buf„r
.
Àn
 -
n
;

269  
n
;

270 
	}
}

272 
ssize_t
 
	$libcuæ_ªad
(
hFILE
 *
Âv
, *
buf„rv
, 
size_t
 
nbyãs
)

274 
hFILE_libcuæ
 *
Â
 = (hFILE_libcuæ *Ë
Âv
;

275 *
buf„r
 = (*Ë
buf„rv
;

276 
CURLcode
 
îr
;

278 
Â
->
buf„r
.
±r
.
rd
 = buffer;

279 
Â
->
buf„r
.
Àn
 = 
nbyãs
;

280 
Â
->
∑u£d
 = 0;

281 
îr
 = 
	`cuæ_ósy_∑u£
(
Â
->
ósy
, 
CURLPAUSE_CONT
);

282 i‡(
îr
 !
CURLE_OK
Ë{ 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
,Érr);  -1; }

284 ! 
Â
->
∑u£d
 && ! fp->
föished
)

285 i‡(
	`waô_≥rf‹m
() < 0)  -1;

287 
nbyãs
 = 
Â
->
buf„r
.
±r
.
rd
 - buffer;

288 
Â
->
buf„r
.
±r
.
rd
 = 
NULL
;

289 
Â
->
buf„r
.
Àn
 = 0;

291 i‡(
Â
->
föished
 && fp->
föÆ_ªsu…
 !
CURLE_OK
) {

292 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
, fp->
föÆ_ªsu…
);

296  
nbyãs
;

297 
	}
}

299 
size_t
 
	$£nd_ˇŒback
(*
±r
, 
size_t
 
size
, size_à
nmemb
, *
Âv
)

301 
hFILE_libcuæ
 *
Â
 = (hFILE_libcuæ *Ë
Âv
;

302 
size_t
 
n
 = 
size
 * 
nmemb
;

304 i‡(
Â
->
buf„r
.
Àn
 == 0) {

306 i‡(
Â
->
˛osög
)  0;

307 { 
Â
->
∑u£d
 = 1;  
CURL_READFUNC_PAUSE
; }

310 i‡(
n
 > 
Â
->
buf„r
.
Àn
)Ç = fp->buffer.len;

311 
	`mem˝y
(
±r
, 
Â
->
buf„r
.±r.
wr
, 
n
);

312 
Â
->
buf„r
.
±r
.
wr
 +
n
;

313 
Â
->
buf„r
.
Àn
 -
n
;

314  
n
;

315 
	}
}

317 
ssize_t
 
	$libcuæ_wrôe
(
hFILE
 *
Âv
, c⁄° *
buf„rv
, 
size_t
 
nbyãs
)

319 
hFILE_libcuæ
 *
Â
 = (hFILE_libcuæ *Ë
Âv
;

320 c⁄° *
buf„r
 = (c⁄° *Ë
buf„rv
;

321 
CURLcode
 
îr
;

323 
Â
->
buf„r
.
±r
.
wr
 = buffer;

324 
Â
->
buf„r
.
Àn
 = 
nbyãs
;

325 
Â
->
∑u£d
 = 0;

326 
îr
 = 
	`cuæ_ósy_∑u£
(
Â
->
ósy
, 
CURLPAUSE_CONT
);

327 i‡(
îr
 !
CURLE_OK
Ë{ 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
,Érr);  -1; }

329 ! 
Â
->
∑u£d
 && ! fp->
föished
)

330 i‡(
	`waô_≥rf‹m
() < 0)  -1;

332 
nbyãs
 = 
Â
->
buf„r
.
±r
.
wr
 - buffer;

333 
Â
->
buf„r
.
±r
.
wr
 = 
NULL
;

334 
Â
->
buf„r
.
Àn
 = 0;

336 i‡(
Â
->
föished
 && fp->
föÆ_ªsu…
 !
CURLE_OK
) {

337 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
, fp->
föÆ_ªsu…
);

341  
nbyãs
;

342 
	}
}

344 
off_t
 
	$libcuæ_£ek
(
hFILE
 *
Âv
, 
off_t
 
off£t
, 
whí˚
)

346 
hFILE_libcuæ
 *
Â
 = (hFILE_libcuæ *Ë
Âv
;

348 
CURLcode
 
îr
;

349 
CURLMcode
 
îrm
;

350 
off_t
 
‹igö
, 
pos
;

352 
whí˚
) {

353 
SEEK_SET
:

354 
‹igö
 = 0;

356 
SEEK_CUR
:

357 
î∫o
 = 
ENOSYS
;

359 
SEEK_END
:

360 i‡(
Â
->
fûe_size
 < 0Ë{ 
î∫o
 = 
ESPIPE
;  -1; }

361 
‹igö
 = 
Â
->
fûe_size
;

364 
î∫o
 = 
EINVAL
;

369 i‡((
off£t
 < 0)? 
‹igö
 + offset < 0

370 : (
Â
->
fûe_size
 >0 && 
off£t
 > fp->fûe_sizê- 
‹igö
)) {

371 
î∫o
 = 
EINVAL
;

375 
pos
 = 
‹igö
 + 
off£t
;

377 
îrm
 = 
	`cuæ_mu…i_ªmove_h™dÀ
(
cuæ
.
mu…i
, 
Â
->
ósy
);

378 i‡(
îrm
 !
CURLM_OK
Ë{ 
î∫o
 = 
	`mu…i_î∫o
(errm);  -1; }

379 
cuæ
.
ƒu¬ög
--;

385 
îr
 = 
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_RESUME_FROM_LARGE
,(
cuæ_off_t
)
pos
);

386 i‡(
îr
 !
CURLE_OK
Ë{ 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
,Érr);  -1; }

388 
Â
->
buf„r
.
Àn
 = 0;

389 
Â
->
∑u£d
 = fp->
föished
 = 0;

391 
îrm
 = 
	`cuæ_mu…i_add_h™dÀ
(
cuæ
.
mu…i
, 
Â
->
ósy
);

392 i‡(
îrm
 !
CURLM_OK
Ë{ 
î∫o
 = 
	`mu…i_î∫o
(errm);  -1; }

393 
cuæ
.
ƒu¬ög
++;

395 
îr
 = 
	`cuæ_ósy_∑u£
(
Â
->
ósy
, 
CURLPAUSE_CONT
);

396 i‡(
îr
 !
CURLE_OK
Ë{ 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
,Érr);  -1; }

398 ! 
Â
->
∑u£d
 && ! fp->
föished
)

399 i‡(
	`waô_≥rf‹m
() < 0)  -1;

401 i‡(
Â
->
föished
 && fp->
föÆ_ªsu…
 !
CURLE_OK
) {

402 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
, fp->
föÆ_ªsu…
);

406  
pos
;

407 
	}
}

409 
	$libcuæ_˛o£
(
hFILE
 *
Âv
)

411 
hFILE_libcuæ
 *
Â
 = (hFILE_libcuæ *Ë
Âv
;

412 
CURLcode
 
îr
;

413 
CURLMcode
 
îrm
;

414 
ßve_î∫o
 = 0;

419 
Â
->
buf„r
.
Àn
 = 0;

420 
Â
->
˛osög
 = 1;

421 
Â
->
∑u£d
 = 0;

422 
îr
 = 
	`cuæ_ósy_∑u£
(
Â
->
ósy
, 
CURLPAUSE_CONT
);

423 i‡(
îr
 !
CURLE_OK
Ë
ßve_î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
,Érr);

425 
ßve_î∫o
 =0 && ! 
Â
->
∑u£d
 && ! fp->
föished
)

426 i‡(
	`waô_≥rf‹m
(Ë< 0Ë
ßve_î∫o
 = 
î∫o
;

428 i‡(
Â
->
föished
 && fp->
föÆ_ªsu…
 !
CURLE_OK
)

429 
ßve_î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
, fp->
föÆ_ªsu…
);

431 
îrm
 = 
	`cuæ_mu…i_ªmove_h™dÀ
(
cuæ
.
mu…i
, 
Â
->
ósy
);

432 i‡(
îrm
 !
CURLM_OK
 && 
ßve_î∫o
 =0Ëßve_î∫ÿ
	`mu…i_î∫o
(errm);

433 
cuæ
.
ƒu¬ög
--;

435 
	`cuæ_ósy_˛ónup
(
Â
->
ósy
);

437 i‡(
ßve_î∫o
Ë{ 
î∫o
 = save_errno;  -1; }

439 
	}
}

441 c⁄° 
hFILE_backíd
 
	glibcuæ_backíd
 =

443 
libcuæ_ªad
, 
libcuæ_wrôe
, 
libcuæ_£ek
, 
NULL
, 
libcuæ_˛o£


446 
hFILE
 *

447 
	$libcuæ_›í
(c⁄° *
uæ
, c⁄° *
modes
, 
cuæ_¶i°
 *
hódîs
)

449 
hFILE_libcuæ
 *
Â
;

450 
mode
;

451 c⁄° *
s
;

452 
CURLcode
 
îr
;

453 
CURLMcode
 
îrm
;

454 
ßve
;

456 i‡((
s
 = 
	`°Ωbrk
(
modes
, "rwa+")Ë!
NULL
) {

457 
mode
 = *
s
;

458 i‡(
	`°Ωbrk
(&
s
[1], "rwa+")Ë
mode
 = 'e';

460 
mode
 = '\0';

462 i‡(
mode
 !'r' && modê!'w'Ë{ 
î∫o
 = 
EINVAL
; 
óæy_îr‹
; }

464 
Â
 = (
hFILE_libcuæ
 *Ë
	`hfûe_öô
( (hFILE_libcuæ), 
modes
, 0);

465 i‡(
Â
 =
NULL
Ë
óæy_îr‹
;

467 
Â
->
hódîs
 = headers;

468 
Â
->
fûe_size
 = -1;

469 
Â
->
buf„r
.
±r
.
rd
 = 
NULL
;

470 
Â
->
buf„r
.
Àn
 = 0;

471 
Â
->
föÆ_ªsu…
 = (
CURLcode
) -1;

472 
Â
->
∑u£d
 = fp->
˛osög
 = fp->
föished
 = 0;

474 
Â
->
ósy
 = 
	`cuæ_ósy_öô
();

475 i‡(
Â
->
ósy
 =
NULL
Ë{ 
î∫o
 = 
ENOMEM
; 
îr‹
; }

478 
îr
 = 
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_PRIVATE
, fp);

480 i‡(
mode
 == 'r') {

481 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_WRITEFUNCTION
, 
ªcv_ˇŒback
);

482 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_WRITEDATA
, fp);

485 
cuæ_¶i°
 *
li°
;

487 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_READFUNCTION
, 
£nd_ˇŒback
);

488 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_READDATA
, fp);

489 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_UPLOAD
, 1L);

491 
li°
 = 
	`cuæ_¶i°_≠≥nd
(
Â
->
hódîs
, "Transfer-Encoding: chunked");

492 i‡(
li°
Ë
Â
->
hódîs
 =Üi°; 
îr‹
;

495 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_URL
, 
uæ
);

496 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_USERAGENT
, 
cuæ
.
u£øgít
.
s
);

497 i‡(
Â
->
hódîs
)

498 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_HTTPHEADER
, fp->
hódîs
);

499 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_FOLLOWLOCATION
, 1L);

500 i‡(
hts_vîbo£
 <= 8)

501 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_FAILONERROR
, 1L);

502 i‡(
hts_vîbo£
 >= 8)

503 
îr
 |
	`cuæ_ósy_£t›t
(
Â
->
ósy
, 
CURLOPT_VERBOSE
, 1L);

505 i‡(
îr
 !0Ë{ 
î∫o
 = 
ENOSYS
; 
îr‹
; }

507 
îrm
 = 
	`cuæ_mu…i_add_h™dÀ
(
cuæ
.
mu…i
, 
Â
->
ósy
);

508 i‡(
îrm
 !
CURLM_OK
Ë{ 
î∫o
 = 
	`mu…i_î∫o
”ºm); 
îr‹
; }

509 
cuæ
.
ƒu¬ög
++;

511 ! 
Â
->
∑u£d
 && ! fp->
föished
)

512 i‡(
	`waô_≥rf‹m
(Ë< 0Ë
îr‹_ªmove
;

514 i‡(
Â
->
föished
 && fp->
föÆ_ªsu…
 !
CURLE_OK
) {

515 
î∫o
 = 
	`ósy_î∫o
(
Â
->
ósy
, fp->
föÆ_ªsu…
);

516 
îr‹_ªmove
;

519 i‡(
mode
 == 'r') {

520 
dvÆ
;

521 i‡(
	`cuæ_ósy_gëöfo
(
Â
->
ósy
, 
CURLINFO_CONTENT_LENGTH_DOWNLOAD
,

522 &
dvÆ
Ë=
CURLE_OK
 && dval >= 0.0)

523 
Â
->
fûe_size
 = (
off_t
Ë(
dvÆ
 + 0.1);

526 
Â
->
ba£
.
backíd
 = &
libcuæ_backíd
;

527  &
Â
->
ba£
;

529 
îr‹_ªmove
:

530 
ßve
 = 
î∫o
;

531 (Ë
	`cuæ_mu…i_ªmove_h™dÀ
(
cuæ
.
mu…i
, 
Â
->
ósy
);

532 
cuæ
.
ƒu¬ög
--;

533 
î∫o
 = 
ßve
;

535 
îr‹
:

536 
ßve
 = 
î∫o
;

537 i‡(
Â
->
ósy
Ë
	`cuæ_ósy_˛ónup
(fp->easy);

538 i‡(
Â
->
hódîs
Ë
	`cuæ_¶i°_‰ì_Æl
(fp->headers);

539 
	`hfûe_de°roy
((
hFILE
 *Ë
Â
);

540 
î∫o
 = 
ßve
;

541  
NULL
;

543 
óæy_îr‹
:

544 
ßve
 = 
î∫o
;

545 i‡(
hódîs
Ë
	`cuæ_¶i°_‰ì_Æl
(headers);

546 
î∫o
 = 
ßve
;

547  
NULL
;

548 
	}
}

550 
hFILE
 *
	$h›í_libcuæ
(c⁄° *
uæ
, c⁄° *
modes
)

552  
	`libcuæ_›í
(
uæ
, 
modes
, 
NULL
);

553 
	}
}

555 
	$∑r£_va_li°
(
cuæ_¶i°
 **
hódîs
, 
va_li°
 
¨gs
)

557 c⁄° *
¨gty≥
;

559 (
¨gty≥
 = 
	`va_¨g
(
¨gs
, c⁄° *)Ë!
NULL
)

560 i‡(
	`°rcmp
(
¨gty≥
, "httphdr:v") == 0) {

561 c⁄° **
hdr
;

562 
hdr
 = 
	`va_¨g
(
¨gs
, const **); *hdr; hdr++) {

563 
cuæ_¶i°
 *
li°
 = 
	`cuæ_¶i°_≠≥nd
(*
hódîs
, *
hdr
);

564 i‡(
li°
Ë*
hódîs
 =Üist;  -1;

567 i‡(
	`°rcmp
(
¨gty≥
, "httphdr:l") == 0) {

568 c⁄° *
hdr
;

569 (
hdr
 = 
	`va_¨g
(
¨gs
, c⁄° *)Ë!
NULL
) {

570 
cuæ_¶i°
 *
li°
 = 
	`cuæ_¶i°_≠≥nd
(*
hódîs
, 
hdr
);

571 i‡(
li°
Ë*
hódîs
 =Üist;  -1;

574 i‡(
	`°rcmp
(
¨gty≥
, "httphdr") == 0) {

575 c⁄° *
hdr
 = 
	`va_¨g
(
¨gs
, const *);

576 i‡(
hdr
) {

577 
cuæ_¶i°
 *
li°
 = 
	`cuæ_¶i°_≠≥nd
(*
hódîs
, 
hdr
);

578 i‡(
li°
Ë*
hódîs
 =Üist;  -1;

581 i‡(
	`°rcmp
(
¨gty≥
, "va_list") == 0) {

582 
va_li°
 *
¨gs2
 = 
	`va_¨g
(
¨gs
, va_list *);

583 i‡(
¨gs2
) {

584 i‡(
	`∑r£_va_li°
(
hódîs
, *
¨gs2
) < 0)  -1;

587 { 
î∫o
 = 
EINVAL
;  -1; }

590 
	}
}

592 
hFILE
 *
	$vh›í_libcuæ
(c⁄° *
uæ
, c⁄° *
modes
, 
va_li°
 
¨gs
)

594 
cuæ_¶i°
 *
hódîs
 = 
NULL
;

595 i‡(
	`∑r£_va_li°
(&
hódîs
, 
¨gs
) < 0) {

596 i‡(
hódîs
Ë
	`cuæ_¶i°_‰ì_Æl
(headers);

597  
NULL
;

600  
	`libcuæ_›í
(
uæ
, 
modes
, 
hódîs
);

601 
	}
}

603 
	$PLUGIN_GLOBAL
(
hfûe_∂ugö_öô
,
_libcuæ
)(
hFILE_∂ugö
 *
£lf
)

605 c⁄° 
hFILE_scheme_h™dÀr
 
h™dÀr
 =

606 { 
h›í_libcuæ
, 
hfûe_Æways_ªmŸe
, "libcurl",

608 
vh›í_libcuæ
 };

610 #ifde‡
ENABLE_PLUGINS


612 c⁄° 
id
[] = "@(#)hfûe_libcuæÖlugö (ht¶ib)\t" 
HTS_VERSION
;

613 c⁄° *
vîsi⁄
 = 
	`°rchr
(
id
, '\t')+1;

615 c⁄° *
vîsi⁄
 = 
	`hts_vîsi⁄
();

617 c⁄° 
cuæ_vîsi⁄_öfo_d©a
 *
öfo
;

618 c⁄° * c⁄° *
¥Ÿocﬁ
;

619 
CURLcode
 
îr
;

621 
îr
 = 
	`cuæ_globÆ_öô
(
CURL_GLOBAL_ALL
);

622 i‡(
îr
 !
CURLE_OK
Ë{ 
î∫o
 = 
	`ósy_î∫o
(
NULL
,Érr);  -1; }

624 
cuæ
.
mu…i
 = 
	`cuæ_mu…i_öô
();

625 i‡(
cuæ
.
mu…i
 =
NULL
Ë{ 
	`cuæ_globÆ_˛ónup
(); 
î∫o
 = 
EIO
;  -1; }

627 
öfo
 = 
	`cuæ_vîsi⁄_öfo
(
CURLVERSION_NOW
);

628 
	`k•rötf
(&
cuæ
.
u£øgít
, "ht¶ib/%†libcuæ/%s", 
vîsi⁄
, 
öfo
->version);

630 
cuæ
.
ƒu¬ög
 = 0;

631 
cuæ
.
≥rf‹m_agaö
 = 0;

632 
£lf
->
«me
 = "libcurl";

633 
£lf
->
de°roy
 = 
libcuæ_exô
;

635 
¥Ÿocﬁ
 = 
öfo
->
¥Ÿocﬁs
; *protocol;Örotocol++)

636 
	`hfûe_add_scheme_h™dÀr
(*
¥Ÿocﬁ
, &
h™dÀr
);

638 
	}
}

	@htslib/hfile_net.c

25 
	~<c⁄fig.h
>

27 
	~<°dlib.h
>

28 
	~<î∫o.h
>

30 
	~"hfûe_öã∫Æ.h
"

32 
	~"ht¶ib/k√tfûe.h
"

35 
hFILE
 
	mba£
;

36 
k√tFûe
 *
	m√tÂ
;

37 } 
	thFILE_√t
;

39 
	g√t_öôed
 = 0;

41 #ifde‡
_WIN32


42 
	$√t_exô
()

44 
	`k√t_wö32_de°roy
();

45 
	}
}

48 
	$√t_öô
()

50 #ifde‡
_WIN32


51 i‡(
	`k√t_wö32_öô
() != 0)  -1;

56 (Ë
	`©exô
(
√t_exô
);

59 
√t_öôed
 = 1;

61 
	}
}

63 
ssize_t
 
	$√t_ªad
(
hFILE
 *
Âv
, *
buf„r
, 
size_t
 
nbyãs
)

65 
hFILE_√t
 *
Â
 = (hFILE_√à*Ë
Âv
;

66  
	`k√t_ªad
(
Â
->
√tÂ
, 
buf„r
, 
nbyãs
);

67 
	}
}

69 
off_t
 
	$√t_£ek
(
hFILE
 *
Âv
, 
off_t
 
off£t
, 
whí˚
)

71 
hFILE_√t
 *
Â
 = (hFILE_√à*Ë
Âv
;

72  
	`k√t_£ek
(
Â
->
√tÂ
, 
off£t
, 
whí˚
);

73 
	}
}

75 
	$√t_˛o£
(
hFILE
 *
Âv
)

77 
hFILE_√t
 *
Â
 = (hFILE_√à*Ë
Âv
;

78  
	`k√t_˛o£
(
Â
->
√tÂ
);

79 
	}
}

81 c⁄° 
hFILE_backíd
 
	g√t_backíd
 =

83 
√t_ªad
, 
NULL
, 
√t_£ek
, NULL, 
√t_˛o£


86 
hFILE
 *
	$h›í_√t
(c⁄° *
fûíame
, c⁄° *
mode
)

88 
hFILE_√t
 *
Â
;

91 i‡(! 
√t_öôed
Ë{ i‡(
	`√t_öô
(Ë< 0Ë 
NULL
; }

93 
Â
 = (
hFILE_√t
 *Ë
	`hfûe_öô
( (hFILE_√t), 
mode
, 0);

94 i‡(
Â
 =
NULL
)  NULL;

96 
Â
->
√tÂ
 = 
	`k√t_›í
(
fûíame
, 
mode
);

97 i‡(
Â
->
√tÂ
 =
NULL
Ë{ 
	`hfûe_de°roy
((
hFILE
 *) fp);  NULL; }

99 
Â
->
ba£
.
backíd
 = &
√t_backíd
;

100  &
Â
->
ba£
;

101 
	}
}

103 
	$hfûe_∂ugö_öô_√t
(
hFILE_∂ugö
 *
£lf
)

105 c⁄° 
hFILE_scheme_h™dÀr
 
h™dÀr
 =

106 { 
h›í_√t
, 
hfûe_Æways_ªmŸe
, "knetfile", 0 };

108 
£lf
->
«me
 = "knetfile";

109 
	`hfûe_add_scheme_h™dÀr
("hâp", &
h™dÀr
);

110 
	`hfûe_add_scheme_h™dÀr
("·p", &
h™dÀr
);

112 
	}
}

	@htslib/hfile_s3.c

25 
	~<c⁄fig.h
>

27 
	~<°d¨g.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<time.h
>

33 
	~"hts_öã∫Æ.h
"

34 
	~"hfûe_öã∫Æ.h
"

35 #ifde‡
ENABLE_PLUGINS


36 
	~"vîsi⁄.h
"

38 
	~"ht¶ib/hts.h
"

39 
	~"ht¶ib/k°rög.h
"

41 #i‡
deföed
 
HAVE_COMMONCRYPTO


43 
	~<Comm⁄Cry±o/Comm⁄HMAC.h
>

45 
	#DIGEST_BUFSIZ
 
CC_SHA1_DIGEST_LENGTH


	)

47 
size_t


48 
	$s3_sign
(*
dige°
, 
k°rög_t
 *
key
, k°rög_à*
mesßge
)

50 
	`CCHmac
(
kCCHmacAlgSHA1
, 
key
->
s
, key->
l
, 
mesßge
->s, mesßge->l, 
dige°
);

51  
CC_SHA1_DIGEST_LENGTH
;

52 
	}
}

54 #ñi‡
deföed
 
HAVE_HMAC


56 
	~<›ís¶/hmac.h
>

58 
	#DIGEST_BUFSIZ
 
EVP_MAX_MD_SIZE


	)

60 
size_t


61 
	$s3_sign
(*
dige°
, 
k°rög_t
 *
key
, k°rög_à*
mesßge
)

63 
Àn
;

64 
	`HMAC
(
	`EVP_sha1
(), 
key
->
s
, key->
l
,

65 (*Ë
mesßge
->
s
, mesßge->
l
, 
dige°
, &
Àn
);

66  
Àn
;

67 
	}
}

70 #îr‹ 
No
 
HMAC
(Ë
routöe
 
found
 
by
 
c⁄figuª


74 
	$uædecode_kput
(c⁄° *
s
, 
Àn
, 
k°rög_t
 *
°r
)

76 
buf
[3];

77 
i
 = 0;

79 
i
 < 
Àn
)

80 i‡(
s
[
i
] ='%' && i+2 < 
Àn
) {

81 
buf
[0] = 
s
[
i
+1], buf[1] = s[i+2], buf[2] = '\0';

82 
	`kputc
(
	`°πﬁ
(
buf
, 
NULL
, 16), 
°r
);

83 
i
 += 3;

85 
	`kputc
(
s
[
i
++], 
°r
);

86 
	}
}

88 
	$ba£64_kput
(c⁄° *
d©a
, 
size_t
 
Àn
, 
k°rög_t
 *
°r
)

90 c⁄° 
ba£64
[] =

93 
size_t
 
i
 = 0;

94 
x
 = 0;

95 
bôs
 = 0, 
∑d
 = 0;

97 
bôs
 || 
i
 < 
Àn
) {

98 i‡(
bôs
 < 6) {

99 
x
 <<8, 
bôs
 += 8;

100 i‡(
i
 < 
Àn
Ë
x
 |
d©a
[i++];

101 
∑d
++;

104 
bôs
 -= 6;

105 
	`kputc
(
ba£64
[(
x
 >> 
bôs
Ë& 63], 
°r
);

108 
°r
->
l
 -
∑d
;

109 
	`kput¢
("==", 
∑d
, 
°r
);

110 
	}
}

112 
	$is_dns_com∂ü¡
(c⁄° *
s0
, c⁄° *
¶im
)

114 
has_n⁄digô
 = 0, 
Àn
 = 0;

115 c⁄° *
s
;

117 
s
 = 
s0
; s < 
¶im
; 
Àn
++, s++)

118 i‡(
	`i¶owî_c
(*
s
))

119 
has_n⁄digô
 = 1;

120 i‡(*
s
 == '-') {

121 
has_n⁄digô
 = 1;

122 i‡(
s
 =
s0
 || s+1 =
¶im
)  0;

124 i‡(
	`isdigô_c
(*
s
))

126 i‡(*
s
 == '.') {

127 i‡(
s
 =
s0
 || ! 
	`iß um_c
(s[-1]))  0;

128 i‡(
s
+1 =
¶im
 || ! 
	`iß um_c
(s[1]))  0;

132  
has_n⁄digô
 && 
Àn
 >= 3 &&Üen <= 63;

133 
	}
}

135 
FILE
 *
	$ex∑nd_tûde_›í
(c⁄° *
‚ame
, c⁄° *
mode
)

137 
FILE
 *
Â
;

139 i‡(
	`°∫cmp
(
‚ame
, "~/", 2) == 0) {

140 
k°rög_t
 
fuŒ_‚ame
 = { 0, 0, 
NULL
 };

141 c⁄° *
home
 = 
	`gëív
("HOME");

142 i‡(! 
home
Ë 
NULL
;

144 
	`kputs
(
home
, &
fuŒ_‚ame
);

145 
	`kputs
(&
‚ame
[1], &
fuŒ_‚ame
);

147 
Â
 = 
	`f›í
(
fuŒ_‚ame
.
s
, 
mode
);

148 
	`‰ì
(
fuŒ_‚ame
.
s
);

151 
Â
 = 
	`f›í
(
‚ame
, 
mode
);

153  
Â
;

154 
	}
}

156 
	$∑r£_öi
(c⁄° *
‚ame
, c⁄° *
£˘i⁄
, ...)

158 
k°rög_t
 
löe
 = { 0, 0, 
NULL
 };

159 
a˘ive
 = 1;

160 *
s
;

162 
FILE
 *
Â
 = 
	`ex∑nd_tûde_›í
(
‚ame
, "r");

163 i‡(
Â
 =
NULL
) ;

165 
löe
.
l
 = 0, 
	`kgëlöe
(&löe, (
kgës_func
 *Ë
fgës
, 
Â
) >= 0)

166 i‡(
löe
.
s
[0] ='[' && (†
	`°rchr
÷öe.s, ']')Ë!
NULL
) {

167 *
s
 = '\0';

168 
a˘ive
 = (
	`°rcmp
(&
löe
.
s
[1], 
£˘i⁄
) == 0);

170 i‡(
a˘ive
 && (
s
 = 
	`°Ωbrk
(
löe
.s, ":=")Ë!
NULL
) {

171 c⁄° *
key
 = 
löe
.
s
, *
vÆue
 = &s[1], *
akey
;

172 
va_li°
 
¨gs
;

174 
	`is•a˚_c
(*
key
)) key++;

175 
s
 > 
key
 && 
	`is•a˚_c
(s[-1])) s--;

176 *
s
 = '\0';

178 
	`is•a˚_c
(*
vÆue
)) value++;

179 
löe
.
l
 > 0 && 
	`is•a˚_c
÷öe.
s
[line.l-1]))

180 
löe
.
s
[--löe.
l
] = '\0';

182 
	`va_°¨t
(
¨gs
, 
£˘i⁄
);

183 (
akey
 = 
	`va_¨g
(
¨gs
, c⁄° *)Ë!
NULL
) {

184 
k°rög_t
 *
av¨
 = 
	`va_¨g
(
¨gs
, kstring_t *);

185 i‡(
	`°rcmp
(
key
, 
akey
Ë=0Ë{ 
	`kputs
(
vÆue
, 
av¨
); ; }

187 
	`va_íd
(
¨gs
);

190 
	`f˛o£
(
Â
);

191 
	`‰ì
(
löe
.
s
);

192 
	}
}

194 
	$∑r£_sim∂e
(c⁄° *
‚ame
, 
k°rög_t
 *
id
, k°rög_à*
£¸ë
)

196 
k°rög_t
 
ãxt
 = { 0, 0, 
NULL
 };

197 *
s
;

198 
size_t
 
Àn
;

200 
FILE
 *
Â
 = 
	`ex∑nd_tûde_›í
(
‚ame
, "r");

201 i‡(
Â
 =
NULL
) ;

203 
	`kgëlöe
(&
ãxt
, (
kgës_func
 *Ë
fgës
, 
Â
) >= 0)

204 
	`kputc
(' ', &
ãxt
);

205 
	`f˛o£
(
Â
);

207 
s
 = 
ãxt
.s;

208 
	`is•a˚_c
(*
s
)) s++;

209 
	`kput¢
(
s
, 
Àn
 = 
	`°rc•n
(s, " \t"), 
id
);

211 
s
 +
Àn
;

212 
	`is•a˚_c
(*
s
)) s++;

213 
	`kput¢
(
s
, 
	`°rc•n
(s, " \t"), 
£¸ë
);

215 
	`‰ì
(
ãxt
.
s
);

216 
	}
}

218 
hFILE
 * 
	$s3_ªwrôe
(c⁄° *
s3uæ
, c⁄° *
mode
, 
va_li°
 *
¨g•
)

220 c⁄° *
buckë
, *
∑th
;

221 
d©e_hdr
[40];

222 *
hódî_li°
[4], **
hódî
 = header_list;

224 
k°rög_t
 
mesßge
 = { 0, 0, 
NULL
 };

225 
k°rög_t
 
uæ
 = { 0, 0, 
NULL
 };

226 
k°rög_t
 
¥ofûe
 = { 0, 0, 
NULL
 };

227 
k°rög_t
 
id
 = { 0, 0, 
NULL
 };

228 
k°rög_t
 
£¸ë
 = { 0, 0, 
NULL
 };

229 
k°rög_t
 
ho°_ba£
 = { 0, 0, 
NULL
 };

230 
k°rög_t
 
tokí
 = { 0, 0, 
NULL
 };

231 
k°rög_t
 
tokí_hdr
 = { 0, 0, 
NULL
 };

232 
k°rög_t
 
auth_hdr
 = { 0, 0, 
NULL
 };

234 
time_t
 
now
 = 
	`time
(
NULL
);

235 #ifde‡
HAVE_GMTIME_R


236 
tm
 
tm_buf„r
;

237 
tm
 *tm = 
	`gmtime_r
(&
now
, &
tm_buf„r
);

239 
tm
 *tm = 
	`gmtime
(&
now
);

242 
	`kputs
(
	`°rchr
(
mode
, 'r')? "GET\n" : "PUT\n", &
mesßge
);

243 
	`kputc
('\n', &
mesßge
);

244 
	`kputc
('\n', &
mesßge
);

245 
	`°r·ime
(
d©e_hdr
,  d©e_hdr, "D©e: %a, %d %b %Y %H:%M:%S GMT", 
tm
);

246 *
hódî
++ = 
d©e_hdr
;

247 
	`kputs
(&
d©e_hdr
[6], &
mesßge
);

248 
	`kputc
('\n', &
mesßge
);

252 i‡(
s3uæ
[2] == '+') {

253 
buckë
 = 
	`°rchr
(
s3uæ
, ':') + 1;

254 
	`kput¢
(&
s3uæ
[3], 
buckë
 - &s3uæ[3], &
uæ
);

257 
	`kputs
("hâps:", &
uæ
);

258 
buckë
 = &
s3uæ
[3];

260 *
buckë
 ='/'Ë
	`kputc
(*buckë++, &
uæ
);

262 
∑th
 = 
buckë
 + 
	`°rc•n
(bucket, "/?#@");

263 i‡(*
∑th
 == '@') {

264 c⁄° *
cﬁ⁄
 = 
	`°Ωbrk
(
buckë
, ":@");

265 i‡(*
cﬁ⁄
 != ':') {

266 
	`uædecode_kput
(
buckë
, 
cﬁ⁄
 - buckë, &
¥ofûe
);

269 c⁄° *
cﬁ⁄2
 = 
	`°Ωbrk
(&
cﬁ⁄
[1], ":@");

270 
	`uædecode_kput
(
buckë
, 
cﬁ⁄
 - buckë, &
id
);

271 
	`uædecode_kput
(&
cﬁ⁄
[1], 
cﬁ⁄2
 - &cﬁ⁄[1], &
£¸ë
);

272 i‡(*
cﬁ⁄2
 == ':')

273 
	`uædecode_kput
(&
cﬁ⁄2
[1], 
∑th
 - &cﬁ⁄2[1], &
tokí
);

276 
buckë
 = &
∑th
[1];

277 
∑th
 = 
buckë
 + 
	`°rc•n
(bucket, "/?#");

281 c⁄° *
v
;

282 i‡((
v
 = 
	`gëív
("AWS_ACCESS_KEY_ID")Ë!
NULL
Ë
	`kputs
(v, &
id
);

283 i‡((
v
 = 
	`gëív
("AWS_SECRET_ACCESS_KEY")Ë!
NULL
Ë
	`kputs
(v, &
£¸ë
);

284 i‡((
v
 = 
	`gëív
("AWS_SESSION_TOKEN")Ë!
NULL
Ë
	`kputs
(v, &
tokí
);

286 i‡((
v
 = 
	`gëív
("AWS_DEFAULT_PROFILE")Ë!
NULL
Ë
	`kputs
(v, &
¥ofûe
);

287 i‡((
v
 = 
	`gëív
("AWS_PROFILE")Ë!
NULL
Ë
	`kputs
(v, &
¥ofûe
);

288 
	`kputs
("deÁu…", &
¥ofûe
);

291 i‡(
id
.
l
 == 0) {

292 c⁄° *
v
 = 
	`gëív
("AWS_SHARED_CREDENTIALS_FILE");

293 
	`∑r£_öi
(
v
? v : "~/.aws/¸edítüls", 
¥ofûe
.
s
,

294 "aws_ac˚ss_key_id", &
id
, "aws_£¸ë_ac˚ss_key", &
£¸ë
,

295 "aws_£ssi⁄_tokí", &
tokí
, 
NULL
);

297 i‡(
id
.
l
 == 0)

298 
	`∑r£_öi
("~/.s3cfg", 
¥ofûe
.
s
, "ac˚ss_key", &
id
,

299 "£¸ë_key", &
£¸ë
, "ac˚ss_tokí", &
tokí
,

300 "ho°_ba£", &
ho°_ba£
, 
NULL
);

301 i‡(
id
.
l
 == 0)

302 
	`∑r£_sim∂e
("~/.aws£¸ë", &
id
, &
£¸ë
);

304 i‡(
ho°_ba£
.
l
 == 0)

305 
	`kputs
("s3.amaz⁄aws.com", &
ho°_ba£
);

307 i‡(
	`is_dns_com∂ü¡
(
buckë
, 
∑th
)) {

308 
	`kput¢
(
buckë
, 
∑th
 - buckë, &
uæ
);

309 
	`kputc
('.', &
uæ
);

310 
	`kputs
(
ho°_ba£
.
s
, &
uæ
);

313 
	`kputs
(
ho°_ba£
.
s
, &
uæ
);

314 
	`kputc
('/', &
uæ
);

315 
	`kput¢
(
buckë
, 
∑th
 - buckë, &
uæ
);

317 
	`kputs
(
∑th
, &
uæ
);

319 i‡(
tokí
.
l
 > 0) {

320 
	`kputs
("x-amz-£curôy-tokí:", &
mesßge
);

321 
	`kputs
(
tokí
.
s
, &
mesßge
);

322 
	`kputc
('\n', &
mesßge
);

324 
	`kputs
("X-Amz-Securôy-Tokí: ", &
tokí_hdr
);

325 
	`kputs
(
tokí
.
s
, &
tokí_hdr
);

326 *
hódî
++ = 
tokí_hdr
.
s
;

329 
	`kputc
('/', &
mesßge
);

330 
	`kputs
(
buckë
, &
mesßge
);

334 i‡(
id
.
l
 > 0 && 
£¸ë
.l > 0) {

335 
dige°
[
DIGEST_BUFSIZ
];

336 
size_t
 
dige°_Àn
 = 
	`s3_sign
(
dige°
, &
£¸ë
, &
mesßge
);

338 
	`kputs
("Auth‹iz©i⁄: AWS ", &
auth_hdr
);

339 
	`kputs
(
id
.
s
, &
auth_hdr
);

340 
	`kputc
(':', &
auth_hdr
);

341 
	`ba£64_kput
(
dige°
, 
dige°_Àn
, &
auth_hdr
);

343 *
hódî
++ = 
auth_hdr
.
s
;

346 *
hódî
 = 
NULL
;

347 
hFILE
 *
Â
 = 
	`h›í
(
uæ
.
s
, 
mode
, "va_li°", 
¨g•
, "hâphdr:v", 
hódî_li°
,

348 
NULL
);

349 
	`‰ì
(
mesßge
.
s
);

350 
	`‰ì
(
uæ
.
s
);

351 
	`‰ì
(
¥ofûe
.
s
);

352 
	`‰ì
(
id
.
s
);

353 
	`‰ì
(
£¸ë
.
s
);

354 
	`‰ì
(
ho°_ba£
.
s
);

355 
	`‰ì
(
tokí
.
s
);

356 
	`‰ì
(
tokí_hdr
.
s
);

357 
	`‰ì
(
auth_hdr
.
s
);

358  
Â
;

359 
	}
}

361 
hFILE
 *
	$s3_›í
(c⁄° *
uæ
, c⁄° *
mode
)

363 
k°rög_t
 
mode_cﬁ⁄
 = { 0, 0, 
NULL
 };

364 
	`kputs
(
mode
, &
mode_cﬁ⁄
);

365 
	`kputc
(':', &
mode_cﬁ⁄
);

366 
hFILE
 *
Â
 = 
	`s3_ªwrôe
(
uæ
, 
mode_cﬁ⁄
.
s
, 
NULL
);

367 
	`‰ì
(
mode_cﬁ⁄
.
s
);

368  
Â
;

369 
	}
}

371 
hFILE
 *
	$s3_v›í
(c⁄° *
uæ
, c⁄° *
mode_cﬁ⁄
, 
va_li°
 
¨gs0
)

375 
va_li°
 
¨gs
;

376 
	`va_c›y
(
¨gs
, 
¨gs0
);

377 
hFILE
 *
Â
 = 
	`s3_ªwrôe
(
uæ
, 
mode_cﬁ⁄
, &
¨gs
);

378 
	`va_íd
(
¨gs
);

379  
Â
;

380 
	}
}

382 
	$PLUGIN_GLOBAL
(
hfûe_∂ugö_öô
,
_s3
)(
hFILE_∂ugö
 *
£lf
)

384 c⁄° 
hFILE_scheme_h™dÀr
 
h™dÀr
 =

385 { 
s3_›í
, 
hfûe_Æways_ªmŸe
, "Amaz⁄ S3", 2000 + 50, 
s3_v›í


388 #ifde‡
ENABLE_PLUGINS


390 c⁄° 
id
[] = "@(#)hfûe_s3Ölugö (ht¶ib)\t" 
HTS_VERSION
;

391 i‡(
hts_vîbo£
 >= 9)

392 
	`Ârötf
(
°dîr
, "[M::hfûe_s3.öô] vîsi⁄ %s\n", 
	`°rchr
(
id
, '\t')+1);

395 
£lf
->
«me
 = "Amazon S3";

396 
	`hfûe_add_scheme_h™dÀr
("s3", &
h™dÀr
);

397 
	`hfûe_add_scheme_h™dÀr
("s3+hâp", &
h™dÀr
);

398 
	`hfûe_add_scheme_h™dÀr
("s3+hâps", &
h™dÀr
);

400 
	}
}

	@htslib/hts.c

26 
	~<c⁄fig.h
>

28 
	~<zlib.h
>

29 
	~<°dio.h
>

30 
	~<°rög.h
>

31 
	~<°rögs.h
>

32 
	~<°dlib.h
>

33 
	~<limôs.h
>

34 
	~<f˙é.h
>

35 
	~<î∫o.h
>

36 
	~<sys/°©.h
>

37 
	~<as£π.h
>

39 
	~"ht¶ib/hts.h
"

40 
	~"ht¶ib/bgzf.h
"

41 
	~"¸am/¸am.h
"

42 
	~"ht¶ib/hfûe.h
"

43 
	~"ht¶ib/hts_ídün.h
"

44 
	~"vîsi⁄.h
"

45 
	~"hts_öã∫Æ.h
"

47 
	~"ht¶ib/khash.h
"

48 
	~"ht¶ib/k£q.h
"

49 
	~"ht¶ib/ks‹t.h
"

51 
	$KHASH_INIT2
(
s2i
,, 
kh_c°r_t
, 
öt64_t
, 1, 
kh_°r_hash_func
, 
kh_°r_hash_equÆ
)

53 
hts_vîbo£
 = 3;

55 c⁄° *
	$hts_vîsi⁄
()

57  
HTS_VERSION
;

58 
	}
}

60 c⁄° 
	g£q_¡16_èbÀ
[256] = {

80 c⁄° 
	g£q_¡16_°r
[] = "=ACMGRSVTWYHKDBN";

82 c⁄° 
	g£q_¡16_öt
[] = { 4, 0, 1, 4, 2, 4, 4, 4, 3, 4, 4, 4, 4, 4, 4, 4 };

88 
htsF‹m©C©eg‹y
 
	$f‹m©_ˇãg‹y
(
htsExa˘F‹m©
 
fmt
)

90 
fmt
) {

91 
bam
:

92 
ßm
:

93 
¸am
:

94  
£quí˚_d©a
;

96 
vcf
:

97 
bcf
:

98  
v¨ü¡_d©a
;

100 
bai
:

101 
¸ai
:

102 
csi
:

103 
gzi
:

104 
tbi
:

105  
ödex_fûe
;

107 
bed
:

108  
ªgi⁄_li°
;

110 
js⁄
:

111  
unknown_ˇãg‹y
;

113 
unknown_f‹m©
:

114 
bö¨y_f‹m©
:

115 
ãxt_f‹m©
:

116 
f‹m©_maximum
:

120  
unknown_ˇãg‹y
;

121 
	}
}

125 
size_t
 
	$decom¥ess_≥ek
(
hFILE
 *
Â
, *
de°
, 
size_t
 
de°size
)

130 
buf„r
[512];

131 
z_°ªam
 
zs
;

132 
ssize_t
 
≈ìk
 = 
	`h≥ek
(
Â
, 
buf„r
,  buffer);

134 i‡(
≈ìk
 < 0)  0;

136 
zs
.
zÆloc
 = 
NULL
;

137 
zs
.
z‰ì
 = 
NULL
;

138 
zs
.
√xt_ö
 = 
buf„r
;

139 
zs
.
avaû_ö
 = 
≈ìk
;

140 
zs
.
√xt_out
 = 
de°
;

141 
zs
.
avaû_out
 = 
de°size
;

142 i‡(
	`öÊ©eInô2
(&
zs
, 31Ë!
Z_OK
)  0;

144 
zs
.
tŸÆ_out
 < 
de°size
)

145 i‡(
	`öÊ©e
(&
zs
, 
Z_SYNC_FLUSH
Ë!
Z_OK
) ;

147 
de°size
 = 
zs
.
tŸÆ_out
;

148 
	`öÊ©eEnd
(&
zs
);

150  
de°size
;

151 
	}
}

157 
	$∑r£_vîsi⁄
(
htsF‹m©
 *
fmt
, c⁄° *
u
, c⁄° *
ulim
)

159 c⁄° *
s
 = (c⁄° *Ë
u
;

160 c⁄° *
¶im
 = (c⁄° *Ë
ulim
;

161 
v
;

163 
fmt
->
vîsi⁄
.
maj‹
 = fmt->vîsi⁄.
mö‹
 = -1;

165 
v
 = 0; 
s
 < 
¶im
 && 
	`isdigô_c
(*s); s++)

166 
v
 = 10 * v + *
s
 - '0';

168 i‡(
s
 < 
¶im
) {

169 
fmt
->
vîsi⁄
.
maj‹
 = 
v
;

170 i‡(*
s
 == '.') {

171 
s
++;

172 
v
 = 0; 
s
 < 
¶im
 && 
	`isdigô_c
(*s); s++)

173 
v
 = 10 * v + *
s
 - '0';

174 i‡(
s
 < 
¶im
)

175 
fmt
->
vîsi⁄
.
mö‹
 = 
v
;

178 
fmt
->
vîsi⁄
.
mö‹
 = 0;

180 
	}
}

183 
	$cmp_n⁄bœnk
(c⁄° *
key
, c⁄° *
u
, c⁄° *
ulim
)

185 c⁄° *
ukey
 = (c⁄° *Ë
key
;

187 *
ukey
)

188 i‡(
u
 >
ulim
)  +1;

189 i‡(
	`is•a˚_c
(*
u
)) u++;

190 i‡(*
u
 !*
ukey
)  (*ukey < *u)? -1 : +1;

191 
u
++, 
ukey
++;

194 
	}
}

196 
	$hts_dëe˘_f‹m©
(
hFILE
 *
hfûe
, 
htsF‹m©
 *
fmt
)

198 
s
[21];

199 
ssize_t
 
Àn
 = 
	`h≥ek
(
hfûe
, 
s
, 18);

200 i‡(
Àn
 < 0)  -1;

202 i‡(
Àn
 >2 && 
s
[0] == 0x1f && s[1] == 0x8b) {

205 
fmt
->
com¥essi⁄
 = (
Àn
 >18 && (
s
[3] & 4) &&

206 
	`memcmp
(&
s
[12], "BC\2\0", 4Ë=0)? 
bgzf
 : 
gzù
;

207 
Àn
 = 
	`decom¥ess_≥ek
(
hfûe
, 
s
,  s);

210 
fmt
->
com¥essi⁄
 = 
no_com¥essi⁄
;

211 
Àn
 = 
	`h≥ek
(
hfûe
, 
s
,  s);

213 i‡(
Àn
 < 0)  -1;

215 
fmt
->
com¥essi⁄_Àvñ
 = -1;

216 
fmt
->
•ecific
 = 
NULL
;

218 i‡(
Àn
 >6 && 
	`memcmp
(
s
,"CRAM",4) == 0 && s[4]>=1 && s[4]<=3 && s[5]<=1) {

219 
fmt
->
ˇãg‹y
 = 
£quí˚_d©a
;

220 
fmt
->
f‹m©
 = 
¸am
;

221 
fmt
->
vîsi⁄
.
maj‹
 = 
s
[4], fmt->vîsi⁄.
mö‹
 = s[5];

222 
fmt
->
com¥essi⁄
 = 
cu°om
;

225 i‡(
Àn
 >4 && 
s
[3] <= '\4') {

226 i‡(
	`memcmp
(
s
, "BAM\1", 4) == 0) {

227 
fmt
->
ˇãg‹y
 = 
£quí˚_d©a
;

228 
fmt
->
f‹m©
 = 
bam
;

230 
fmt
->
vîsi⁄
.
maj‹
 = 1, fmt->vîsi⁄.
mö‹
 = -1;

233 i‡(
	`memcmp
(
s
, "BAI\1", 4) == 0) {

234 
fmt
->
ˇãg‹y
 = 
ödex_fûe
;

235 
fmt
->
f‹m©
 = 
bai
;

236 
fmt
->
vîsi⁄
.
maj‹
 = -1, fmt->vîsi⁄.
mö‹
 = -1;

239 i‡(
	`memcmp
(
s
, "BCF\4", 4) == 0) {

240 
fmt
->
ˇãg‹y
 = 
v¨ü¡_d©a
;

241 
fmt
->
f‹m©
 = 
bcf
;

242 
fmt
->
vîsi⁄
.
maj‹
 = 1, fmt->vîsi⁄.
mö‹
 = -1;

245 i‡(
	`memcmp
(
s
, "BCF\2", 4) == 0) {

246 
fmt
->
ˇãg‹y
 = 
v¨ü¡_d©a
;

247 
fmt
->
f‹m©
 = 
bcf
;

248 
fmt
->
vîsi⁄
.
maj‹
 = 
s
[3];

249 
fmt
->
vîsi⁄
.
mö‹
 = (
Àn
 >5 && 
s
[4] <= 2)? s[4] : 0;

252 i‡(
	`memcmp
(
s
, "CSI\1", 4) == 0) {

253 
fmt
->
ˇãg‹y
 = 
ödex_fûe
;

254 
fmt
->
f‹m©
 = 
csi
;

255 
fmt
->
vîsi⁄
.
maj‹
 = 1, fmt->vîsi⁄.
mö‹
 = -1;

258 i‡(
	`memcmp
(
s
, "TBI\1", 4) == 0) {

259 
fmt
->
ˇãg‹y
 = 
ödex_fûe
;

260 
fmt
->
f‹m©
 = 
tbi
;

261 
fmt
->
vîsi⁄
.
maj‹
 = -1, fmt->vîsi⁄.
mö‹
 = -1;

265 i‡(
Àn
 >16 && 
	`memcmp
(
s
, "##fileformat=VCF", 16) == 0) {

266 
fmt
->
ˇãg‹y
 = 
v¨ü¡_d©a
;

267 
fmt
->
f‹m©
 = 
vcf
;

268 i‡(
Àn
 >21 && 
s
[16] == 'v')

269 
	`∑r£_vîsi⁄
(
fmt
, &
s
[17], &s[
Àn
]);

271 
fmt
->
vîsi⁄
.
maj‹
 = fmt->vîsi⁄.
mö‹
 = -1;

274 i‡(
Àn
 >4 && 
s
[0] == '@' &&

275 (
	`memcmp
(
s
, "@HD\t", 4) == 0 || memcmp(s, "@SQ\t", 4) == 0 ||

276 
	`memcmp
(
s
, "@RG\t", 4) == 0 || memcmp(s, "@PG\t", 4) == 0)) {

277 
fmt
->
ˇãg‹y
 = 
£quí˚_d©a
;

278 
fmt
->
f‹m©
 = 
ßm
;

281 i‡(
Àn
 >9 && 
	`memcmp
(
s
, "@HD\tVN:", 7) == 0)

282 
	`∑r£_vîsi⁄
(
fmt
, &
s
[7], &s[
Àn
]);

284 
fmt
->
vîsi⁄
.
maj‹
 = 1, fmt->vîsi⁄.
mö‹
 = -1;

287 i‡(
	`cmp_n⁄bœnk
("{\"", 
s
, &s[
Àn
]) == 0) {

288 
fmt
->
ˇãg‹y
 = 
unknown_ˇãg‹y
;

289 
fmt
->
f‹m©
 = 
js⁄
;

290 
fmt
->
vîsi⁄
.
maj‹
 = fmt->vîsi⁄.
mö‹
 = -1;

300 
fmt
->
ˇãg‹y
 = 
£quí˚_d©a
;

301 
fmt
->
f‹m©
 = 
ßm
;

302 
fmt
->
vîsi⁄
.
maj‹
 = 1, fmt->vîsi⁄.
mö‹
 = -1;

306 
fmt
->
ˇãg‹y
 = 
unknown_ˇãg‹y
;

307 
fmt
->
f‹m©
 = 
unknown_f‹m©
;

308 
fmt
->
vîsi⁄
.
maj‹
 = fmt->vîsi⁄.
mö‹
 = -1;

309 
fmt
->
com¥essi⁄
 = 
no_com¥essi⁄
;

311 
	}
}

313 *
	$hts_f‹m©_des¸ùti⁄
(c⁄° 
htsF‹m©
 *
f‹m©
)

315 
k°rög_t
 
°r
 = { 0, 0, 
NULL
 };

317 
f‹m©
->format) {

318 
ßm
: 
	`kputs
("SAM", &
°r
); ;

319 
bam
: 
	`kputs
("BAM", &
°r
); ;

320 
¸am
: 
	`kputs
("CRAM", &
°r
); ;

321 
vcf
: 
	`kputs
("VCF", &
°r
); ;

322 
bcf
:

323 i‡(
f‹m©
->
vîsi⁄
.
maj‹
 =1Ë
	`kputs
("Legacy BCF", &
°r
);

324 
	`kputs
("BCF", &
°r
);

326 
bai
: 
	`kputs
("BAI", &
°r
); ;

327 
¸ai
: 
	`kputs
("CRAI", &
°r
); ;

328 
csi
: 
	`kputs
("CSI", &
°r
); ;

329 
tbi
: 
	`kputs
("Tabix", &
°r
); ;

330 
js⁄
: 
	`kputs
("JSON", &
°r
); ;

331 : 
	`kputs
("unknown", &
°r
); ;

334 i‡(
f‹m©
->
vîsi⁄
.
maj‹
 >= 0) {

335 
	`kputs
(" vîsi⁄ ", &
°r
);

336 
	`kputw
(
f‹m©
->
vîsi⁄
.
maj‹
, &
°r
);

337 i‡(
f‹m©
->
vîsi⁄
.
mö‹
 >= 0) {

338 
	`kputc
('.', &
°r
);

339 
	`kputw
(
f‹m©
->
vîsi⁄
.
mö‹
, &
°r
);

343 
f‹m©
->
com¥essi⁄
) {

344 
cu°om
: 
	`kputs
(" com¥es£d", &
°r
); ;

345 
gzù
: 
	`kputs
(" gzù-com¥es£d", &
°r
); ;

346 
bgzf
:

347 
f‹m©
->format) {

348 
bam
:

349 
bcf
:

350 
csi
:

351 
tbi
:

353 
	`kputs
(" com¥es£d", &
°r
);

356 
	`kputs
(" BGZF-com¥es£d", &
°r
);

363 
f‹m©
->
ˇãg‹y
) {

364 
£quí˚_d©a
: 
	`kputs
(" sequí˚", &
°r
); ;

365 
v¨ü¡_d©a
: 
	`kputs
(" v¨ü¡ cÆlög", &
°r
); ;

366 
ödex_fûe
: 
	`kputs
(" index", &
°r
); ;

367 
ªgi⁄_li°
: 
	`kputs
(" gíomi¯ªgi⁄", &
°r
); ;

371 i‡(
f‹m©
->
com¥essi⁄
 =
no_com¥essi⁄
)

372 
f‹m©
->format) {

373 
ßm
:

374 
¸ai
:

375 
vcf
:

376 
bed
:

377 
js⁄
:

378 
	`kputs
("Åext", &
°r
);

382 
	`kputs
(" d©a", &
°r
);

386 
	`kputs
(" d©a", &
°r
);

388  
	`ks_ªÀa£
(&
°r
);

389 
	}
}

391 
htsFûe
 *
	$hts_›í_f‹m©
(c⁄° *
‚
, c⁄° *
mode
, c⁄° 
htsF‹m©
 *
fmt
)

393 
smode
[102], *
˝
, *
˝2
, *
mode_c
;

394 
htsFûe
 *
Â
 = 
NULL
;

395 
hFILE
 *
hfûe
;

396 
fmt_code
 = '\0';

398 
	`°∫˝y
(
smode
, 
mode
, 100);

399 
smode
[100]=0;

400 i‡((
˝
 = 
	`°rchr
(
smode
, ',')))

401 *
˝
 = '\0';

404 
˝2
 = 
˝
 = 
smode
; *cp; cp++) {

405 i‡(*
˝
 == 'b')

406 
fmt_code
 = 'b';

407 i‡(*
˝
 == 'c')

408 
fmt_code
 = 'c';

410 *
˝2
++ = *
˝
;

412 
mode_c
 = 
˝2
;

413 *
˝2
++ = 
fmt_code
;

414 *
˝2
++ = 0;

415 *
˝2
++ = 0;

418 i‡(
fmt
 && fmt->
f‹m©
 !
unknown_f‹m©
)

419 *
mode_c
 = "\0g\0\0b\0c\0\0b\0g\0\0"[
fmt
->
f‹m©
];

421 
hfûe
 = 
	`h›í
(
‚
, 
smode
);

422 i‡(
hfûe
 =
NULL
Ë
îr‹
;

424 
Â
 = 
	`hts_h›í
(
hfûe
, 
‚
, 
smode
);

425 i‡(
Â
 =
NULL
Ë
îr‹
;

427 i‡(
fmt
 && fmt->
•ecific
)

428 i‡(
	`hts_›t_≠∂y
(
Â
, 
fmt
->
•ecific
) != 0)

429 
îr‹
;

431  
Â
;

433 
îr‹
:

434 i‡(
hts_vîbo£
 >= 2)

435 
	`Ârötf
(
°dîr
, "[E::%s] faûÅÿ›í fûê'%s'\n", 
__func__
, 
‚
);

437 i‡(
hfûe
)

438 
	`h˛o£_abru±ly
(
hfûe
);

440  
NULL
;

441 
	}
}

443 
htsFûe
 *
	$hts_›í
(c⁄° *
‚
, c⁄° *
mode
) {

444  
	`hts_›í_f‹m©
(
‚
, 
mode
, 
NULL
);

445 
	}
}

455 
	$sˇn_keyw‹d
(c⁄° *
°r
, 
dñim
, *
buf
, 
size_t
 
buÊí
)

457 
size_t
 
i
 = 0;

458 *
°r
 && *°∏!
dñim
) {

459 i‡(
i
 < 
buÊí
-1Ë
buf
[i++] = 
	`tﬁowî_c
(*
°r
);

460 
°r
++;

463 
buf
[
i
] = '\0';

464  *
°r
? str+1 : str;

465 
	}
}

473 
	$hts_›t_add
(
hts_›t
 **
›ts
, c⁄° *
c_¨g
) {

474 
hts_›t
 *
o
, *
t
;

475 *
vÆ
;

483 i‡(!
c_¨g
)

486 i‡(!(
o
 = 
	`mÆloc
((*o))))

489 i‡(!(
o
->
¨g
 = 
	`°rdup
(
c_¨g
))) {

490 
	`‰ì
(
o
);

494 i‡(!(
vÆ
 = 
	`°rchr
(
o
->
¨g
, '=')))

495 
vÆ
 = "1";

497 *
vÆ
++ = '\0';

499 i‡(
	`°rcmp
(
o
->
¨g
, "decode_md") == 0 ||

500 
	`°rcmp
(
o
->
¨g
, "DECODE_MD") == 0)

501 
o
->
›t
 = 
CRAM_OPT_DECODE_MD
, o->
vÆ
.
i
 = 
	`©oi
(val);

503 i‡(
	`°rcmp
(
o
->
¨g
, "verbosity") == 0 ||

504 
	`°rcmp
(
o
->
¨g
, "VERBOSITY") == 0)

505 
o
->
›t
 = 
CRAM_OPT_VERBOSITY
, o->
vÆ
.
i
 = 
	`©oi
(val);

507 i‡(
	`°rcmp
(
o
->
¨g
, "seqs_per_slice") == 0 ||

508 
	`°rcmp
(
o
->
¨g
, "SEQS_PER_SLICE") == 0)

509 
o
->
›t
 = 
CRAM_OPT_SEQS_PER_SLICE
, o->
vÆ
.
i
 = 
	`©oi
(val);

511 i‡(
	`°rcmp
(
o
->
¨g
, "bases_per_slice") == 0 ||

512 
	`°rcmp
(
o
->
¨g
, "BASES_PER_SLICE") == 0)

513 
o
->
›t
 = 
CRAM_OPT_BASES_PER_SLICE
, o->
vÆ
.
i
 = 
	`©oi
(val);

515 i‡(
	`°rcmp
(
o
->
¨g
, "slices_per_container") == 0 ||

516 
	`°rcmp
(
o
->
¨g
, "SLICES_PER_CONTAINER") == 0)

517 
o
->
›t
 = 
CRAM_OPT_SLICES_PER_CONTAINER
, o->
vÆ
.
i
 = 
	`©oi
(val);

519 i‡(
	`°rcmp
(
o
->
¨g
, "embed_ref") == 0 ||

520 
	`°rcmp
(
o
->
¨g
, "EMBED_REF") == 0)

521 
o
->
›t
 = 
CRAM_OPT_EMBED_REF
, o->
vÆ
.
i
 = 
	`©oi
(val);

523 i‡(
	`°rcmp
(
o
->
¨g
, "no_ref") == 0 ||

524 
	`°rcmp
(
o
->
¨g
, "NO_REF") == 0)

525 
o
->
›t
 = 
CRAM_OPT_NO_REF
, o->
vÆ
.
i
 = 
	`©oi
(val);

527 i‡(
	`°rcmp
(
o
->
¨g
, "ignore_md5") == 0 ||

528 
	`°rcmp
(
o
->
¨g
, "IGNORE_MD5") == 0)

529 
o
->
›t
 = 
CRAM_OPT_IGNORE_MD5
, o->
vÆ
.
i
 = 
	`©oi
(val);

531 i‡(
	`°rcmp
(
o
->
¨g
, "use_bzip2") == 0 ||

532 
	`°rcmp
(
o
->
¨g
, "USE_BZIP2") == 0)

533 
o
->
›t
 = 
CRAM_OPT_USE_BZIP2
, o->
vÆ
.
i
 = 
	`©oi
(val);

535 i‡(
	`°rcmp
(
o
->
¨g
, "use_rans") == 0 ||

536 
	`°rcmp
(
o
->
¨g
, "USE_RANS") == 0)

537 
o
->
›t
 = 
CRAM_OPT_USE_RANS
, o->
vÆ
.
i
 = 
	`©oi
(val);

539 i‡(
	`°rcmp
(
o
->
¨g
, "use_lzma") == 0 ||

540 
	`°rcmp
(
o
->
¨g
, "USE_LZMA") == 0)

541 
o
->
›t
 = 
CRAM_OPT_USE_LZMA
, o->
vÆ
.
i
 = 
	`©oi
(val);

543 i‡(
	`°rcmp
(
o
->
¨g
, "reference") == 0 ||

544 
	`°rcmp
(
o
->
¨g
, "REFERENCE") == 0)

545 
o
->
›t
 = 
CRAM_OPT_REFERENCE
, o->
vÆ
.
s
 = val;

547 i‡(
	`°rcmp
(
o
->
¨g
, "version") == 0 ||

548 
	`°rcmp
(
o
->
¨g
, "VERSION") == 0)

549 
o
->
›t
 = 
CRAM_OPT_VERSION
, o->
vÆ
.
s
 =val;

551 i‡(
	`°rcmp
(
o
->
¨g
, "multi_seq_per_slice") == 0 ||

552 
	`°rcmp
(
o
->
¨g
, "MULTI_SEQ_PER_SLICE") == 0)

553 
o
->
›t
 = 
CRAM_OPT_MULTI_SEQ_PER_SLICE
, o->
vÆ
.
i
 = 
	`©oi
(val);

555 i‡(
	`°rcmp
(
o
->
¨g
, "nthreads") == 0 ||

556 
	`°rcmp
(
o
->
¨g
, "NTHREADS") == 0)

557 
o
->
›t
 = 
HTS_OPT_NTHREADS
, o->
vÆ
.
i
 = 
	`©oi
(val);

559 i‡(
	`°rcmp
(
o
->
¨g
, "cache_size") == 0 ||

560 
	`°rcmp
(
o
->
¨g
, "CACHE_SIZE") == 0) {

561 *
ídp
;

562 
o
->
›t
 = 
HTS_OPT_CACHE_SIZE
;

563 
o
->
vÆ
.
i
 = 
	`°πﬁ
(vÆ, &
ídp
, 0);

566 *
ídp
) {

567 'g': 'G': 
o
->
vÆ
.
i
 *= 1024;

568 'm': 'M': 
o
->
vÆ
.
i
 *= 1024;

569 'k': 'K': 
o
->
vÆ
.
i
 *= 1024; ;

572 
	`Ârötf
(
°dîr
, "Uƒecogni£d cachêsizêsuffix '%c'\n", *
ídp
);

573 
	`‰ì
(
o
->
¨g
);

574 
	`‰ì
(
o
);

579 i‡(
	`°rcmp
(
o
->
¨g
, "required_fields") == 0 ||

580 
	`°rcmp
(
o
->
¨g
, "REQUIRED_FIELDS") == 0)

581 
o
->
›t
 = 
CRAM_OPT_REQUIRED_FIELDS
, o->
vÆ
.
i
 = 
	`°πﬁ
(vÆ, 
NULL
, 0);

583 i‡(
	`°rcmp
(
o
->
¨g
, "lossy_names") == 0 ||

584 
	`°rcmp
(
o
->
¨g
, "LOSSY_NAMES") == 0)

585 
o
->
›t
 = 
CRAM_OPT_LOSSY_NAMES
, o->
vÆ
.
i
 = 
	`°πﬁ
(vÆ, 
NULL
, 0);

587 i‡(
	`°rcmp
(
o
->
¨g
, "name_prefix") == 0 ||

588 
	`°rcmp
(
o
->
¨g
, "NAME_PREFIX") == 0)

589 
o
->
›t
 = 
CRAM_OPT_PREFIX
, o->
vÆ
.
s
 = val;

592 
	`Ârötf
(
°dîr
, "Unknow¿›ti⁄ '%s'\n", 
o
->
¨g
);

593 
	`‰ì
(
o
->
¨g
);

594 
	`‰ì
(
o
);

598 
o
->
√xt
 = 
NULL
;

601 i‡(*
›ts
) {

602 
t
 = *
›ts
;

603 
t
->
√xt
)

604 
t
 =Å->
√xt
;

605 
t
->
√xt
 = 
o
;

607 *
›ts
 = 
o
;

611 
	}
}

619 
	$hts_›t_≠∂y
(
htsFûe
 *
Â
, 
hts_›t
 *
›ts
) {

620 
hts_›t
 *
œ°
 = 
NULL
;

622 ; 
›ts
; o±†(
œ°
=›ts)->
√xt
) {

623 
›ts
->
›t
) {

624 
CRAM_OPT_REFERENCE
:

625 
CRAM_OPT_VERSION
:

626 
CRAM_OPT_PREFIX
:

627 i‡(
	`hts_£t_›t
(
Â
, 
›ts
->
›t
, o±s->
vÆ
.
s
) != 0)

631 i‡(
	`hts_£t_›t
(
Â
, 
›ts
->
›t
, o±s->
vÆ
.
i
) != 0)

638 
	}
}

643 
	$hts_›t_‰ì
(
hts_›t
 *
›ts
) {

644 
hts_›t
 *
œ°
 = 
NULL
;

645 
›ts
) {

646 
›ts
 = (
œ°
=›ts)->
√xt
;

647 
	`‰ì
(
œ°
->
¨g
);

648 
	`‰ì
(
œ°
);

650 
	}
}

664 
	$hts_∑r£_›t_li°
(
htsF‹m©
 *
fmt
, c⁄° *
°r
) {

665 
°r
 && *str) {

666 c⁄° *
°r_°¨t
;

667 
Àn
;

668 
¨g
[8001];

670 *
°r
 && *str == ',')

671 
°r
++;

673 
°r_°¨t
 = 
°r
; *str && *str != ','; str++);

674 
Àn
 = 
°r
 - 
°r_°¨t
;

677 
	`°∫˝y
(
¨g
, 
°r_°¨t
, 
Àn
 < 8000 ?Üen : 8000);

678 
¨g
[
Àn
 < 8000 ?Üen : 8000] = '\0';

680 i‡(
	`hts_›t_add
((
hts_›t
 **)&
fmt
->
•ecific
, 
¨g
) != 0)

683 i‡(*
°r
)

684 
°r
++;

688 
	}
}

701 
	$hts_∑r£_f‹m©
(
htsF‹m©
 *
f‹m©
, c⁄° *
°r
) {

702 
fmt
[8];

703 c⁄° *
˝
 = 
	`sˇn_keyw‹d
(
°r
, ',', 
fmt
,  fmt);

705 
f‹m©
->
vîsi⁄
.
mö‹
 = 0;

706 
f‹m©
->
vîsi⁄
.
maj‹
 = 0;

708 i‡(
	`°rcmp
(
fmt
, "sam") == 0) {

709 
f‹m©
->
ˇãg‹y
 = 
£quí˚_d©a
;

710 
f‹m©
->f‹m© = 
ßm
;

711 
f‹m©
->
com¥essi⁄
 = 
no_com¥essi⁄
;;

712 
f‹m©
->
com¥essi⁄_Àvñ
 = 0;

713 } i‡(
	`°rcmp
(
fmt
, "bam") == 0) {

714 
f‹m©
->
ˇãg‹y
 = 
£quí˚_d©a
;

715 
f‹m©
->f‹m© = 
bam
;

716 
f‹m©
->
com¥essi⁄
 = 
bgzf
;

717 
f‹m©
->
com¥essi⁄_Àvñ
 = -1;

718 } i‡(
	`°rcmp
(
fmt
, "cram") == 0) {

719 
f‹m©
->
ˇãg‹y
 = 
£quí˚_d©a
;

720 
f‹m©
->f‹m© = 
¸am
;

721 
f‹m©
->
com¥essi⁄
 = 
cu°om
;

722 
f‹m©
->
com¥essi⁄_Àvñ
 = -1;

723 } i‡(
	`°rcmp
(
fmt
, "vcf") == 0) {

724 
f‹m©
->
ˇãg‹y
 = 
v¨ü¡_d©a
;

725 
f‹m©
->f‹m© = 
vcf
;

726 
f‹m©
->
com¥essi⁄
 = 
no_com¥essi⁄
;;

727 
f‹m©
->
com¥essi⁄_Àvñ
 = 0;

728 } i‡(
	`°rcmp
(
fmt
, "bcf") == 0) {

729 
f‹m©
->
ˇãg‹y
 = 
v¨ü¡_d©a
;

730 
f‹m©
->f‹m© = 
bcf
;

731 
f‹m©
->
com¥essi⁄
 = 
bgzf
;

732 
f‹m©
->
com¥essi⁄_Àvñ
 = -1;

737  
	`hts_∑r£_›t_li°
(
f‹m©
, 
˝
);

738 
	}
}

752 
	$hts_¥o˚ss_›ts
(
htsFûe
 *
Â
, c⁄° *
›ts
) {

753 
htsF‹m©
 
fmt
;

755 
fmt
.
•ecific
 = 
NULL
;

756 i‡(
	`hts_∑r£_›t_li°
(&
fmt
, 
›ts
) != 0)

759 i‡(
	`hts_›t_≠∂y
(
Â
, 
fmt
.
•ecific
) != 0) {

760 
	`hts_›t_‰ì
(
fmt
.
•ecific
);

764 
	`hts_›t_‰ì
(
fmt
.
•ecific
);

767 
	}
}

770 
htsFûe
 *
	$hts_h›í
(
hFILE
 *
hfûe
, c⁄° *
‚
, c⁄° *
mode
)

772 
hFILE
 *
hfûe_‹ig
 = 
hfûe
;

773 
htsFûe
 *
Â
 = (htsFûe*)
	`ˇŒoc
(1, (htsFile));

774 
sim∂e_mode
[101], *
˝
, *
›ts
;

775 
sim∂e_mode
[100] = '\0';

777 i‡(
Â
 =
NULL
Ë
îr‹
;

779 
Â
->
‚
 = 
	`°rdup
(fn);

780 
Â
->
is_be
 = 
	`ed_is_big
();

783 i‡((
˝
 = 
	`°rchr
(
mode
, ','))) {

784 
	`°∫˝y
(
sim∂e_mode
, 
mode
, 
˝
-mode <= 100 ? cp-mode : 100);

785 
sim∂e_mode
[
˝
-
mode
] = '\0';

786 
›ts
 = 
˝
+1;

788 
	`°∫˝y
(
sim∂e_mode
, 
mode
, 100);

789 
›ts
 = 
NULL
;

792 i‡(
	`°rchr
(
sim∂e_mode
, 'r')) {

793 i‡(
	`hts_dëe˘_f‹m©
(
hfûe
, &
Â
->
f‹m©
Ë< 0Ë
îr‹
;

795 i‡(
Â
->
f‹m©
.f‹m© =
js⁄
) {

796 
hFILE
 *
hfûe2
 = 
	`h›í_js⁄_ªdúe˘
(
hfûe
, 
sim∂e_mode
);

797 i‡(
hfûe2
 =
NULL
Ë
îr‹
;

800 
hfûe
 = 
hfûe2
;

801 i‡(
	`hts_dëe˘_f‹m©
(
hfûe
, &
Â
->
f‹m©
Ë< 0Ë
îr‹
;

804 i‡(
	`°rchr
(
sim∂e_mode
, 'w') || strchr(simple_mode, 'a')) {

805 
htsF‹m©
 *
fmt
 = &
Â
->
f‹m©
;

806 
Â
->
is_wrôe
 = 1;

808 i‡(
	`°rchr
(
sim∂e_mode
, 'b')Ë
fmt
->
f‹m©
 = 
bö¨y_f‹m©
;

809 i‡(
	`°rchr
(
sim∂e_mode
, 'c')Ë
fmt
->
f‹m©
 = 
¸am
;

810 
fmt
->
f‹m©
 = 
ãxt_f‹m©
;

812 i‡(
	`°rchr
(
sim∂e_mode
, 'z')Ë
fmt
->
com¥essi⁄
 = 
bgzf
;

813 i‡(
	`°rchr
(
sim∂e_mode
, 'g')Ë
fmt
->
com¥essi⁄
 = 
gzù
;

814 i‡(
	`°rchr
(
sim∂e_mode
, 'u')Ë
fmt
->
com¥essi⁄
 = 
no_com¥essi⁄
;

817 
fmt
->
f‹m©
) {

818 
bö¨y_f‹m©
: 
fmt
->
com¥essi⁄
 = 
bgzf
; ;

819 
¸am
: 
fmt
->
com¥essi⁄
 = 
cu°om
; ;

820 
ãxt_f‹m©
: 
fmt
->
com¥essi⁄
 = 
no_com¥essi⁄
; ;

821 : 
	`ab‹t
();

826 
fmt
->
ˇãg‹y
 = 
	`f‹m©_ˇãg‹y
(fmt->
f‹m©
);

828 
fmt
->
vîsi⁄
.
maj‹
 = fmt->vîsi⁄.
mö‹
 = -1;

829 
fmt
->
com¥essi⁄_Àvñ
 = -1;

830 
fmt
->
•ecific
 = 
NULL
;

832 { 
î∫o
 = 
EINVAL
; 
îr‹
; }

834 
Â
->
f‹m©
.format) {

835 
bö¨y_f‹m©
:

836 
bam
:

837 
bcf
:

838 
Â
->Â.
bgzf
 = 
	`bgzf_h›í
(
hfûe
, 
sim∂e_mode
);

839 i‡(
Â
->Â.
bgzf
 =
NULL
Ë
îr‹
;

840 
Â
->
is_bö
 = fp->
is_bgzf
 = 1;

843 
¸am
:

844 
Â
->Â.
¸am
 = 
	`¸am_d›í
(
hfûe
, 
‚
, 
sim∂e_mode
);

845 i‡(
Â
->Â.
¸am
 =
NULL
Ë
îr‹
;

846 i‡(!
Â
->
is_wrôe
)

847 
	`¸am_£t_›ti⁄
(
Â
->Â.
¸am
, 
CRAM_OPT_DECODE_MD
, 1);

848 
Â
->
is_¸am
 = 1;

851 
ãxt_f‹m©
:

852 
ßm
:

853 
vcf
:

854 i‡(
Â
->
f‹m©
.
com¥essi⁄
 !
no_com¥essi⁄
) {

855 
Â
->Â.
bgzf
 = 
	`bgzf_h›í
(
hfûe
, 
sim∂e_mode
);

856 i‡(
Â
->Â.
bgzf
 =
NULL
Ë
îr‹
;

857 
Â
->
is_bgzf
 = 1;

860 
Â
->Â.
hfûe
 = hfile;

864 
î∫o
 = 
ENOEXEC
;

865 
îr‹
;

868 i‡(
›ts
)

869 
	`hts_¥o˚ss_›ts
(
Â
, 
›ts
);

873 i‡(
hfûe
 !
hfûe_‹ig
Ë
	`h˛o£_abru±ly
(hfile_orig);

875  
Â
;

877 
îr‹
:

878 i‡(
hts_vîbo£
 >= 2)

879 
	`Ârötf
(
°dîr
, "[E::%s] faûÅÿ›í fûê'%s'\n", 
__func__
, 
‚
);

882 i‡(
hfûe
 !
hfûe_‹ig
Ë
	`h˛o£_abru±ly
(hfile);

884 i‡(
Â
) {

885 
	`‰ì
(
Â
->
‚
);

886 
	`‰ì
(
Â
->
‚_aux
);

887 
	`‰ì
(
Â
);

889  
NULL
;

890 
	}
}

892 
	$hts_˛o£
(
htsFûe
 *
Â
)

894 
ªt
, 
ßve
;

896 
Â
->
f‹m©
.format) {

897 
bö¨y_f‹m©
:

898 
bam
:

899 
bcf
:

900 
ªt
 = 
	`bgzf_˛o£
(
Â
->Â.
bgzf
);

903 
¸am
:

904 i‡(!
Â
->
is_wrôe
) {

905 
	`¸am_eof
(
Â
->Â.
¸am
)) {

907 
	`Ârötf
(
°dîr
, "[W::%s] EOF m¨kî i†ab£¡. Thêöpuài†¥obablyÅrunˇãd.\n", 
__func__
);

914 
ªt
 = 
	`¸am_˛o£
(
Â
->Â.
¸am
);

917 
ãxt_f‹m©
:

918 
ßm
:

919 
vcf
:

920 i‡(
Â
->
f‹m©
.
com¥essi⁄
 !
no_com¥essi⁄
)

921 
ªt
 = 
	`bgzf_˛o£
(
Â
->Â.
bgzf
);

923 
ªt
 = 
	`h˛o£
(
Â
->Â.
hfûe
);

927 
ªt
 = -1;

931 
ßve
 = 
î∫o
;

932 
	`‰ì
(
Â
->
‚
);

933 
	`‰ì
(
Â
->
‚_aux
);

934 
	`‰ì
(
Â
->
löe
.
s
);

935 
	`‰ì
(
Â
);

936 
î∫o
 = 
ßve
;

937  
ªt
;

938 
	}
}

940 c⁄° 
htsF‹m©
 *
	$hts_gë_f‹m©
(
htsFûe
 *
Â
)

942  
Â
? &Â->
f‹m©
 : 
NULL
;

943 
	}
}

945 c⁄° *
	$hts_f‹m©_fûe_exãnsi⁄
(c⁄° 
htsF‹m©
 *
f‹m©
) {

946 i‡(!
f‹m©
)

949 
f‹m©
->format) {

950 
ßm
:  "sam";

951 
bam
:  "bam";

952 
bai
:  "bai";

953 
¸am
:  "cram";

954 
¸ai
:  "crai";

955 
vcf
:  "vcf";

956 
bcf
:  "bcf";

957 
csi
:  "csi";

958 
gzi
:  "gzi";

959 
tbi
:  "tbi";

960 
bed
:  "bed";

963 
	}
}

965 
	$hts_£t_›t
(
htsFûe
 *
Â
, 
hts_fmt_›ti⁄
 
›t
, ...) {

966 
r
;

967 
va_li°
 
¨gs
;

969 
›t
) {

970 
HTS_OPT_NTHREADS
: {

971 
	`va_°¨t
(
¨gs
, 
›t
);

972 
¡hªads
 = 
	`va_¨g
(
¨gs
, );

973 
	`va_íd
(
¨gs
);

974  
	`hts_£t_thªads
(
Â
, 
¡hªads
);

977 
HTS_OPT_THREAD_POOL
: {

978 
	`va_°¨t
(
¨gs
, 
›t
);

979 
htsThªadPoﬁ
 *
p
 = 
	`va_¨g
(
¨gs
, htsThreadPool *);

980 
	`va_íd
(
¨gs
);

981  
	`hts_£t_thªad_poﬁ
(
Â
, 
p
);

984 
HTS_OPT_CACHE_SIZE
: {

985 
	`va_°¨t
(
¨gs
, 
›t
);

986 
ˇche_size
 = 
	`va_¨g
(
¨gs
, );

987 
	`va_íd
(
¨gs
);

988 
	`hts_£t_ˇche_size
(
Â
, 
ˇche_size
);

996 i‡(
Â
->
f‹m©
.f‹m© !
¸am
)

999 
	`va_°¨t
(
¨gs
, 
›t
);

1000 
r
 = 
	`¸am_£t_v›ti⁄
(
Â
->Â.
¸am
, 
›t
, 
¨gs
);

1001 
	`va_íd
(
¨gs
);

1003  
r
;

1004 
	}
}

1006 
BGZF
 *
hts_gë_bgzÂ
(
htsFûe
 *
Â
);

1008 
	$hts_£t_thªads
(
htsFûe
 *
Â
, 
n
)

1010 i‡(
Â
->
f‹m©
.
com¥essi⁄
 =
bgzf
) {

1011  
	`bgzf_mt
(
	`hts_gë_bgzÂ
(
Â
), 
n
, 256 );

1012 } i‡(
Â
->
f‹m©
.f‹m© =
¸am
) {

1013  
	`hts_£t_›t
(
Â
, 
CRAM_OPT_NTHREADS
, 
n
);

1016 
	}
}

1018 
	$hts_£t_thªad_poﬁ
(
htsFûe
 *
Â
, 
htsThªadPoﬁ
 *
p
) {

1019 i‡(
Â
->
f‹m©
.
com¥essi⁄
 =
bgzf
) {

1020  
	`bgzf_thªad_poﬁ
(
	`hts_gë_bgzÂ
(
Â
), 
p
->
poﬁ
,Ö->
qsize
);

1021 } i‡(
Â
->
f‹m©
.f‹m© =
¸am
) {

1022  
	`hts_£t_›t
(
Â
, 
CRAM_OPT_THREAD_POOL
, 
p
);

1025 
	}
}

1027 
	$hts_£t_ˇche_size
(
htsFûe
 *
Â
, 
n
)

1029 i‡(
Â
->
f‹m©
.
com¥essi⁄
 =
bgzf
)

1030 
	`bgzf_£t_ˇche_size
(
	`hts_gë_bgzÂ
(
Â
), 
n
);

1031 
	}
}

1033 
	$hts_£t_Ái_fûíame
(
htsFûe
 *
Â
, c⁄° *
‚_aux
)

1035 
	`‰ì
(
Â
->
‚_aux
);

1036 i‡(
‚_aux
) {

1037 
Â
->
‚_aux
 = 
	`°rdup
(fn_aux);

1038 i‡(
Â
->
‚_aux
 =
NULL
)  -1;

1040 
Â
->
‚_aux
 = 
NULL
;

1042 i‡(
Â
->
f‹m©
.f‹m© =
¸am
)

1043 i‡(
	`¸am_£t_›ti⁄
(
Â
->Â.
¸am
, 
CRAM_OPT_REFERENCE
, fp->
‚_aux
))

1047 
	}
}

1051 
BGZF
 *
	$hts_gë_bgzÂ
(
htsFûe
 *
Â
)

1053 i‡(
Â
->
is_bgzf
)

1054  
Â
->Â.
bgzf
;

1056  
NULL
;

1057 
	}
}

1058 
	$hts_u£ek
(
htsFûe
 *
Â
, 
uoff£t
, 
whîe
)

1060 i‡(
Â
->
is_bgzf
)

1061  
	`bgzf_u£ek
(
Â
->Â.
bgzf
, 
uoff£t
, 
whîe
);

1063  (
	`h£ek
(
Â
->Â.
hfûe
, 
uoff£t
, 
SEEK_SET
) >= 0)? 0 : -1;

1064 
	}
}

1065 
	$hts_uãŒ
(
htsFûe
 *
Â
)

1067 i‡(
Â
->
is_bgzf
)

1068  
	`bgzf_uãŒ
(
Â
->Â.
bgzf
);

1070  
	`hãŒ
(
Â
->Â.
hfûe
);

1071 
	}
}

1073 
	$hts_gëlöe
(
htsFûe
 *
Â
, 
dñimôî
, 
k°rög_t
 *
°r
)

1075 
ªt
;

1076 i‡(! (
dñimôî
 =
KS_SEP_LINE
 || delimiter == '\n')) {

1077 
	`Ârötf
(
°dîr
, "[hts_gëlöe] u√x≥˘ed dñimôî %d\n", 
dñimôî
);

1078 
	`ab‹t
();

1081 
Â
->
f‹m©
.
com¥essi⁄
) {

1082 
no_com¥essi⁄
:

1083 
°r
->
l
 = 0;

1084 
ªt
 = 
	`kgëlöe
(
°r
, (
kgës_func
 *Ë
hgës
, 
Â
->Â.
hfûe
);

1085 i‡(
ªt
 >0Ëªà
°r
->
l
;

1086 i‡(
	`hî∫o
(
Â
->Â.
hfûe
)Ë
ªt
 = -2, 
î∫o
 = herrno(fp->fp.hfile);

1087 
ªt
 = -1;

1090 
gzù
:

1091 
bgzf
:

1092 
ªt
 = 
	`bgzf_gëlöe
(
Â
->Â.
bgzf
, '\n', 
°r
);

1096 
	`ab‹t
();

1099 ++
Â
->
löío
;

1100  
ªt
;

1101 
	}
}

1103 **
	$hts_ªadli°
(c⁄° *
°rög
, 
is_fûe
, *
_n
)

1105 
m
 = 0, 
n
 = 0;

1106 **
s
 = 0;

1107 i‡–
is_fûe
 )

1109 
BGZF
 *
Â
 = 
	`bgzf_›í
(
°rög
, "r");

1110 i‡–!
Â
 )  
NULL
;

1112 
k°rög_t
 
°r
;

1113 
°r
.
s
 = 0; så.
l
 = så.
m
 = 0;

1114 
	`bgzf_gëlöe
(
Â
, '\n', &
°r
) >= 0)

1116 i‡(
°r
.
l
 == 0) ;

1117 
n
++;

1118 
	`hts_ex∑nd
(*,
n
,
m
,
s
);

1119 
s
[
n
-1] = 
	`°rdup
(
°r
.s);

1121 
	`bgzf_˛o£
(
Â
);

1122 
	`‰ì
(
°r
.
s
);

1126 c⁄° *
q
 = 
°rög
, *
p
 = string;

1129 i‡(*
p
 == ',' || *p == 0)

1131 
n
++;

1132 
	`hts_ex∑nd
(*,
n
,
m
,
s
);

1133 
s
[
n
-1] = (*)
	`ˇŒoc
(
p
 - 
q
 + 1, 1);

1134 
	`°∫˝y
(
s
[
n
-1], 
q
, 
p
 - q);

1135 
q
 = 
p
 + 1;

1137 i‡–!*
p
 ) ;

1138 
p
++;

1141 
s
 = (**)
	`ªÆloc
(s, 
n
 * (*));

1142 *
_n
 = 
n
;

1143  
s
;

1144 
	}
}

1146 **
	$hts_ªadlöes
(c⁄° *
‚
, *
_n
)

1148 
m
 = 0, 
n
 = 0;

1149 **
s
 = 0;

1150 
BGZF
 *
Â
 = 
	`bgzf_›í
(
‚
, "r");

1151 i‡–
Â
 ) {

1152 
k°rög_t
 
°r
;

1153 
°r
.
s
 = 0; så.
l
 = så.
m
 = 0;

1154 
	`bgzf_gëlöe
(
Â
, '\n', &
°r
) >= 0) {

1155 i‡(
°r
.
l
 == 0) ;

1156 i‡(
m
 =
n
) {

1157 
m
 = m? m<<1 : 16;

1158 
s
 = (**)
	`ªÆloc
(s, 
m
 * (*));

1160 
s
[
n
++] = 
	`°rdup
(
°r
.s);

1162 
	`bgzf_˛o£
(
Â
);

1163 
s
 = (**)
	`ªÆloc
(s, 
n
 * (*));

1164 
	`‰ì
(
°r
.
s
);

1165 } i‡(*
‚
 == ':') {

1166 c⁄° *
q
, *
p
;

1167 
q
 = 
p
 = 
‚
 + 1;; ++p)

1168 i‡(*
p
 == ',' || *p == 0) {

1169 i‡(
m
 =
n
) {

1170 
m
 = m? m<<1 : 16;

1171 
s
 = (**)
	`ªÆloc
(s, 
m
 * (*));

1173 
s
[
n
] = (*)
	`ˇŒoc
(
p
 - 
q
 + 1, 1);

1174 
	`°∫˝y
(
s
[
n
++], 
q
, 
p
 - q);

1175 
q
 = 
p
 + 1;

1176 i‡(*
p
 == 0) ;

1179 
s
 = (**)
	`ªÆloc
(s, 
n
 * (*));

1180 *
_n
 = 
n
;

1181  
s
;

1182 
	}
}

1185 
	$hts_fûe_ty≥
(c⁄° *
‚ame
)

1187 
Àn
 = 
	`°æí
(
‚ame
);

1188 i‡–!
	`°rˇ£cmp
(".vcf.gz",
‚ame
+
Àn
-7ËË 
FT_VCF_GZ
;

1189 i‡–!
	`°rˇ£cmp
(".vcf",
‚ame
+
Àn
-4ËË 
FT_VCF
;

1190 i‡–!
	`°rˇ£cmp
(".bcf",
‚ame
+
Àn
-4ËË 
FT_BCF_GZ
;

1191 i‡–!
	`°rcmp
("-",
‚ame
ËË 
FT_STDIN
;

1193 
hFILE
 *
f
 = 
	`h›í
(
‚ame
, "r");

1194 i‡(
f
 =
NULL
)  0;

1196 
htsF‹m©
 
fmt
;

1197 i‡(
	`hts_dëe˘_f‹m©
(
f
, &
fmt
Ë< 0Ë{ 
	`h˛o£_abru±ly
(f);  0; }

1198 i‡(
	`h˛o£
(
f
) < 0)  0;

1200 
fmt
.
f‹m©
) {

1201 
vcf
:  (
fmt
.
com¥essi⁄
 =
no_com¥essi⁄
)? 
FT_VCF
 : 
FT_VCF_GZ
;

1202 
bcf
:  (
fmt
.
com¥essi⁄
 =
no_com¥essi⁄
)? 
FT_BCF
 : 
FT_BCF_GZ
;

1205 
	}
}

1207 
	$hts_check_EOF
(
htsFûe
 *
Â
)

1209 i‡(
Â
->
f‹m©
.
com¥essi⁄
 =
bgzf
)

1210  
	`bgzf_check_EOF
(
	`hts_gë_bgzÂ
(
Â
));

1211 i‡(
Â
->
f‹m©
.f‹m© =
¸am
)

1212  
	`¸am_check_EOF
(
Â
->Â.
¸am
);

1215 
	}
}

1222 
	#HTS_MIN_MARKER_DIST
 0x10000

	)

1226 
	#META_BIN
(
idx
Ë((idx)->
n_bös
 + 1)

	)

1228 
	#∑ú64_…
(
a
,
b
Ë(◊).
u
 < (b).u)

	)

1230 
	$KSORT_INIT
(
_off
, 
hts_∑ú64_t
, 
∑ú64_…
)

1233 
öt32_t
 
m
, 
n
;

1234 
uöt64_t
 
loff
;

1235 
hts_∑ú64_t
 *
li°
;

1236 } 
	tbös_t
;

1238 
	$KHASH_MAP_INIT_INT
(
bö
, 
bös_t
)

1239 
	$khash_t
(
	tbö
Ë
	tbidx_t
;

1242 
öt32_t
 
n
, 
m
;

1243 
uöt64_t
 *
off£t
;

1244 } 
	tlidx_t
;

1246 
	s__hts_idx_t
 {

1247 
fmt
, 
mö_shi·
, 
n_lvls
, 
n_bös
;

1248 
uöt32_t
 
l_mëa
;

1249 
öt32_t
 
n
, 
m
;

1250 
uöt64_t
 
n_no_co‹
;

1251 
bidx_t
 **
bidx
;

1252 
lidx_t
 *
lidx
;

1253 
uöt8_t
 *
mëa
;

1255 
uöt32_t
 
œ°_bö
, 
ßve_bö
;

1256 
œ°_co‹
, 
œ°_tid
, 
ßve_tid
, 
föished
;

1257 
uöt64_t
 
œ°_off
, 
ßve_off
;

1258 
uöt64_t
 
off_beg
, 
off_íd
;

1259 
uöt64_t
 
n_m≠≥d
, 
n_unm≠≥d
;

1260 } 
z
;

1263 * 
	$idx_f‹m©_«me
(
fmt
) {

1264 
fmt
) {

1265 
HTS_FMT_CSI
:  "csi";

1266 
HTS_FMT_BAI
:  "bai";

1267 
HTS_FMT_TBI
:  "tbi";

1268 
HTS_FMT_CRAI
:  "crai";

1271 
	}
}

1273 
ölöe
 
	$ö£π_to_b
(
bidx_t
 *
b
, 
bö
, 
uöt64_t
 
beg
, uöt64_à
íd
)

1275 
khöt_t
 
k
;

1276 
bös_t
 *
l
;

1277 
ab£¡
;

1278 
k
 = 
	`kh_put
(
bö
, 
b
, bö, &
ab£¡
);

1279 i‡(
ab£¡
 < 0)  -1;

1280 
l
 = &
	`kh_vÆue
(
b
, 
k
);

1281 i‡(
ab£¡
) {

1282 
l
->
m
 = 1;Ü->
n
 = 0;

1283 
l
->
li°
 = (
hts_∑ú64_t
*)
	`ˇŒoc
÷->
m
, (hts_pair64_t));

1284 i‡(!
l
->
li°
) {

1285 
	`kh_dñ
(
bö
, 
b
, 
k
);

1288 } i‡(
l
->
n
 =l->
m
) {

1289 
uöt32_t
 
√w_m
 = 
l
->
m
 ?Ü->m << 1 : 1;

1290 
hts_∑ú64_t
 *
√w_li°
 = 
	`ªÆloc
(
l
->
li°
, 
√w_m
 * (hts_pair64_t));

1291 i‡(!
√w_li°
)  -1;

1292 
l
->
li°
 = 
√w_li°
;

1293 
l
->
m
 = 
√w_m
;

1295 
l
->
li°
[l->
n
].
u
 = 
beg
;

1296 
l
->
li°
[l->
n
++].
v
 = 
íd
;

1298 
	}
}

1300 
ölöe
 
	$ö£π_to_l
(
lidx_t
 *
l
, 
öt64_t
 
_beg
, i¡64_à
_íd
, 
uöt64_t
 
off£t
, 
mö_shi·
)

1302 
i
, 
beg
, 
íd
;

1303 
beg
 = 
_beg
 >> 
mö_shi·
;

1304 
íd
 = (
_íd
 - 1Ë>> 
mö_shi·
;

1305 i‡(
l
->
m
 < 
íd
 + 1) {

1306 
size_t
 
√w_m
 = 
l
->
m
 * 2 > 
íd
 + 1 ?Ü->m * 2 :Énd + 1;

1307 
uöt64_t
 *
√w_off£t
;

1309 
√w_off£t
 = (
uöt64_t
*)
	`ªÆloc
(
l
->
off£t
, 
√w_m
 * (uint64_t));

1310 i‡(!
√w_off£t
)  -1;

1313 
	`mem£t
(
√w_off£t
 + 
l
->
m
, 0xff, (
uöt64_t
Ë* (
√w_m
 -Ü->m));

1314 
l
->
m
 = 
√w_m
;

1315 
l
->
off£t
 = 
√w_off£t
;

1317 
i
 = 
beg
; i <
íd
; ++i) {

1318 i‡(
l
->
off£t
[
i
] =(
uöt64_t
)-1)Ü->offset[i] = offset;

1320 i‡(
l
->
n
 < 
íd
 + 1)Ü->n =Énd + 1;

1322 
	}
}

1324 
hts_idx_t
 *
	$hts_idx_öô
(
n
, 
fmt
, 
uöt64_t
 
off£t0
, 
mö_shi·
, 
n_lvls
)

1326 
hts_idx_t
 *
idx
;

1327 
idx
 = (
hts_idx_t
*)
	`ˇŒoc
(1, (hts_idx_t));

1328 i‡(
idx
 =
NULL
)  NULL;

1329 
idx
->
fmt
 = fmt;

1330 
idx
->
mö_shi·
 = min_shift;

1331 
idx
->
n_lvls
 =Ç_lvls;

1332 
idx
->
n_bös
 = ((1<<(3 * 
n_lvls
 + 3)) - 1) / 7;

1333 
idx
->
z
.
ßve_bö
 = idx->z.
ßve_tid
 = idx->z.
œ°_tid
 = idx->z.
œ°_bö
 = 0xffffffffu;

1334 
idx
->
z
.
ßve_off
 = idx->z.
œ°_off
 = idx->z.
off_beg
 = idx->z.
off_íd
 = 
off£t0
;

1335 
idx
->
z
.
œ°_co‹
 = 0xffffffffu;

1336 i‡(
n
) {

1337 
idx
->
n
 = idx->
m
 =Ç;

1338 
idx
->
bidx
 = (
bidx_t
**)
	`ˇŒoc
(
n
, (bidx_t*));

1339 i‡(
idx
->
bidx
 =
NULL
Ë{ 
	`‰ì
(idx);  NULL; }

1340 
idx
->
lidx
 = (
lidx_t
*Ë
	`ˇŒoc
(
n
, (lidx_t));

1341 i‡(
idx
->
lidx
 =
NULL
Ë{ 
	`‰ì
(idx->
bidx
); free(idx);  NULL; }

1343  
idx
;

1344 
	}
}

1346 
	$upd©e_loff
(
hts_idx_t
 *
idx
, 
i
, 
‰ì_lidx
)

1348 
bidx_t
 *
bidx
 = 
idx
->bidx[
i
];

1349 
lidx_t
 *
lidx
 = &
idx
->lidx[
i
];

1350 
khöt_t
 
k
;

1351 
l
;

1352 
uöt64_t
 
off£t0
 = 0;

1353 i‡(
bidx
) {

1354 
k
 = 
	`kh_gë
(
bö
, 
bidx
, 
	`META_BIN
(
idx
));

1355 i‡(
k
 !
	`kh_íd
(
bidx
))

1356 
off£t0
 = 
	`kh_vÆ
(
bidx
, 
k
).
li°
[0].
u
;

1357 
l
 = 0;Ü < 
lidx
->
n
 &&Üidx->
off£t
[l] =(
uöt64_t
)-1; ++l)

1358 
lidx
->
off£t
[
l
] = 
off£t0
;

1359 } 
l
 = 1;

1360 ; 
l
 < 
lidx
->
n
; ++l)

1361 i‡(
lidx
->
off£t
[
l
] =(
uöt64_t
)-1)

1362 
lidx
->
off£t
[
l
] =Üidx->offset[l-1];

1363 i‡(
bidx
 == 0) ;

1364 
k
 = 
	`kh_begö
(
bidx
); k !
	`kh_íd
(bidx); ++k)

1365 i‡(
	`kh_exi°
(
bidx
, 
k
))

1367 i‡–
	`kh_key
(
bidx
, 
k
Ë< 
idx
->
n_bös
 )

1369 
bŸ_bö
 = 
	`hts_bö_bŸ
(
	`kh_key
(
bidx
, 
k
), 
idx
->
n_lvls
);

1371 
	`kh_vÆ
(
bidx
, 
k
).
loff
 = 
bŸ_bö
 < 
lidx
->
n
 ?Üidx->
off£t
[bot_bin] : 0;

1374 
	`kh_vÆ
(
bidx
, 
k
).
loff
 = 0;

1376 i‡(
‰ì_lidx
) {

1377 
	`‰ì
(
lidx
->
off£t
);

1378 
lidx
->
m
 =Üidx->
n
 = 0;

1379 
lidx
->
off£t
 = 0;

1381 
	}
}

1383 
	$com¥ess_bönög
(
hts_idx_t
 *
idx
, 
i
)

1385 
bidx_t
 *
bidx
 = 
idx
->bidx[
i
];

1386 
khöt_t
 
k
;

1387 
l
, 
m
;

1388 i‡(
bidx
 == 0) ;

1390 
l
 = 
idx
->
n_lvls
;Ü > 0; --l) {

1391 
°¨t
 = 
	`hts_bö_fú°
(
l
);

1392 
k
 = 
	`kh_begö
(
bidx
); k !
	`kh_íd
(bidx); ++k) {

1393 
bös_t
 *
p
, *
q
;

1394 i‡(!
	`kh_exi°
(
bidx
, 
k
Ë|| 
	`kh_key
(bidx, kË>
idx
->
n_bös
 || kh_key(bidx, kË< 
°¨t
) ;

1395 
p
 = &
	`kh_vÆue
(
bidx
, 
k
);

1396 i‡(
l
 < 
idx
->
n_lvls
 && 
p
->
n
 > 1Ë
	`ks_öåos‹t
(
_off
,Ö->n,Ö->
li°
);

1397 i‡((
p
->
li°
[p->
n
 - 1].
v
>>16Ë- (p->li°[0].
u
>>16Ë< 
HTS_MIN_MARKER_DIST
) {

1398 
khöt_t
 
kp
;

1399 
kp
 = 
	`kh_gë
(
bö
, 
bidx
, 
	`hts_bö_∑ª¡
(
	`kh_key
(bidx, 
k
)));

1400 i‡(
kp
 =
	`kh_íd
(
bidx
)) ;

1401 
q
 = &
	`kh_vÆ
(
bidx
, 
kp
);

1402 i‡(
q
->
n
 + 
p
->¿> q->
m
) {

1403 
q
->
m
 = q->
n
 + 
p
->n;

1404 
	`kroundup32
(
q
->
m
);

1405 
q
->
li°
 = (
hts_∑ú64_t
*)
	`ªÆloc
(q->li°, q->
m
 * (hts_pair64_t));

1407 
	`mem˝y
(
q
->
li°
 + q->
n
, 
p
->li°,Ö->¿* (
hts_∑ú64_t
));

1408 
q
->
n
 +
p
->n;

1409 
	`‰ì
(
p
->
li°
);

1410 
	`kh_dñ
(
bö
, 
bidx
, 
k
);

1414 
k
 = 
	`kh_gë
(
bö
, 
bidx
, 0);

1415 i‡(
k
 !
	`kh_íd
(
bidx
)Ë
	`ks_öåos‹t
(
_off
, 
	`kh_vÆ
(bidx, k).
n
, kh_vÆ(bidx, k).
li°
);

1417 
k
 = 
	`kh_begö
(
bidx
); k !
	`kh_íd
(bidx); ++k) {

1418 
bös_t
 *
p
;

1419 i‡(!
	`kh_exi°
(
bidx
, 
k
Ë|| 
	`kh_key
(bidx, kË>
idx
->
n_bös
) ;

1420 
p
 = &
	`kh_vÆue
(
bidx
, 
k
);

1421 
l
 = 1, 
m
 = 0;Ü < 
p
->
n
; ++l) {

1422 i‡(
p
->
li°
[
m
].
v
>>16 >p->li°[
l
].
u
>>16) {

1423 i‡(
p
->
li°
[
m
].
v
 <Ö->li°[
l
].v)Ö->list[m].v =Ö->list[l].v;

1424 } 
p
->
li°
[++
m
] =Ö->li°[
l
];

1426 
p
->
n
 = 
m
 + 1;

1428 
	}
}

1430 
	$hts_idx_föish
(
hts_idx_t
 *
idx
, 
uöt64_t
 
föÆ_off£t
)

1432 
i
;

1433 i‡(
idx
 =
NULL
 || idx->
z
.
föished
) ;

1434 i‡(
idx
->
z
.
ßve_tid
 >= 0) {

1435 
	`ö£π_to_b
(
idx
->
bidx
[idx->
z
.
ßve_tid
], idx->z.
ßve_bö
, idx->z.
ßve_off
, 
föÆ_off£t
);

1436 
	`ö£π_to_b
(
idx
->
bidx
[idx->
z
.
ßve_tid
], 
	`META_BIN
(idx), idx->z.
off_beg
, 
föÆ_off£t
);

1437 
	`ö£π_to_b
(
idx
->
bidx
[idx->
z
.
ßve_tid
], 
	`META_BIN
(idx), idx->z.
n_m≠≥d
, idx->z.
n_unm≠≥d
);

1439 
i
 = 0; i < 
idx
->
n
; ++i) {

1440 
	`upd©e_loff
(
idx
, 
i
, (idx->
fmt
 =
HTS_FMT_CSI
));

1441 
	`com¥ess_bönög
(
idx
, 
i
);

1443 
idx
->
z
.
föished
 = 1;

1444 
	}
}

1446 
	$hts_idx_push
(
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
, 
uöt64_t
 
off£t
, 
is_m≠≥d
)

1448 
bö
;

1449 
öt64_t
 
maxpos
 = (öt64_tË1 << (
idx
->
mö_shi·
 + idx->
n_lvls
 * 3);

1450 i‡(
tid
<0Ë
beg
 = -1, 
íd
 = 0;

1451 i‡(
tid
 >0 && (
beg
 > 
maxpos
 || 
íd
 > maxpos)) {

1452 
pos_too_big
;

1454 i‡(
tid
 >
idx
->
m
) {

1455 
uöt32_t
 
√w_m
 = 
idx
->
m
 * 2 > 
tid
 + 1 ? idx->m * 2 :Åid + 1;

1456 
bidx_t
 **
√w_bidx
;

1457 
lidx_t
 *
√w_lidx
;

1459 
√w_bidx
 = (
bidx_t
**)
	`ªÆloc
(
idx
->
bidx
, 
√w_m
 * (bidx_t*));

1460 i‡(!
√w_bidx
)  -1;

1461 
idx
->
bidx
 = 
√w_bidx
;

1463 
√w_lidx
 = (
lidx_t
*Ë
	`ªÆloc
(
idx
->
lidx
, 
√w_m
 * (lidx_t));

1464 i‡(!
√w_lidx
)  -1;

1465 
idx
->
lidx
 = 
√w_lidx
;

1467 
	`mem£t
(&
idx
->
bidx
[idx->
m
], 0, (
√w_m
 - idx->mË* (
bidx_t
*));

1468 
	`mem£t
(&
idx
->
lidx
[idx->
m
], 0, (
√w_m
 - idx->mË* (
lidx_t
));

1469 
idx
->
m
 = 
√w_m
;

1471 i‡(
idx
->
n
 < 
tid
 + 1) idx->n =Åid + 1;

1472 i‡(
idx
->
z
.
föished
)  0;

1473 i‡(
idx
->
z
.
œ°_tid
 !
tid
 || (idx->z.last_tid >= 0 &&Åid < 0)) {

1474 i‡–
tid
>=0 && 
idx
->
n_no_co‹
 )

1476 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
,"[E::%s] NO_COORÑód†nŸ i¿®sögÀ blockáàthêíd %d %d\n", 
__func__
, 
tid
,
idx
->
z
.
œ°_tid
);

1479 i‡(
tid
>=0 && 
idx
->
bidx
[tid] != 0)

1481 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] chromosomêblock†nŸ c⁄töuous\n", 
__func__
);

1484 
idx
->
z
.
œ°_tid
 = 
tid
;

1485 
idx
->
z
.
œ°_bö
 = 0xffffffffu;

1486 } i‡(
tid
 >0 && 
idx
->
z
.
œ°_co‹
 > 
beg
) {

1487 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] uns‹ãdÖosôi⁄†⁄ sequí˚ #%d: %d fﬁlowed by %d\n", 
__func__
, 
tid
+1, 
idx
->
z
.
œ°_co‹
+1, 
beg
+1);

1490 i‡–
tid
>=0 )

1492 i‡(
idx
->
bidx
[
tid
] =0Ëidx->bidx[tid] = 
	`kh_öô
(
bö
);

1493 i‡(
is_m≠≥d
) {

1495 i‡(
beg
 < 0) beg = 0;

1496 i‡(
íd
 <= 0)Énd = 1;

1498 i‡(
	`ö£π_to_l
(&
idx
->
lidx
[
tid
], 
beg
, 
íd
,

1499 
idx
->
z
.
œ°_off
, idx->
mö_shi·
) < 0)  -1;

1502 
idx
->
n_no_co‹
++;

1503 
bö
 = 
	`hts_ªg2bö
(
beg
, 
íd
, 
idx
->
mö_shi·
, idx->
n_lvls
);

1504 i‡(()
idx
->
z
.
œ°_bö
 !
bö
) {

1505 i‡(
idx
->
z
.
ßve_bö
 != 0xffffffffu) {

1506 i‡(
	`ö£π_to_b
(
idx
->
bidx
[idx->
z
.
ßve_tid
], idx->z.
ßve_bö
,

1507 
idx
->
z
.
ßve_off
, idx->z.
œ°_off
) < 0)  -1;

1509 i‡(
idx
->
z
.
œ°_bö
 =0xffffffffu && idx->z.
ßve_bö
 != 0xffffffffu) {

1510 
idx
->
z
.
off_íd
 = idx->z.
œ°_off
;

1511 i‡(
	`ö£π_to_b
(
idx
->
bidx
[idx->
z
.
ßve_tid
], 
	`META_BIN
(idx),

1512 
idx
->
z
.
off_beg
, idx->z.
off_íd
) < 0)  -1;

1513 i‡(
	`ö£π_to_b
(
idx
->
bidx
[idx->
z
.
ßve_tid
], 
	`META_BIN
(idx),

1514 
idx
->
z
.
n_m≠≥d
, idx->z.
n_unm≠≥d
) < 0)  -1;

1515 
idx
->
z
.
n_m≠≥d
 = idx->z.
n_unm≠≥d
 = 0;

1516 
idx
->
z
.
off_beg
 = idx->z.
off_íd
;

1518 
idx
->
z
.
ßve_off
 = idx->z.
œ°_off
;

1519 
idx
->
z
.
ßve_bö
 = idx->z.
œ°_bö
 = 
bö
;

1520 
idx
->
z
.
ßve_tid
 = 
tid
;

1522 i‡(
is_m≠≥d
Ë++
idx
->
z
.
n_m≠≥d
;

1523 ++
idx
->
z
.
n_unm≠≥d
;

1524 
idx
->
z
.
œ°_off
 = 
off£t
;

1525 
idx
->
z
.
œ°_co‹
 = 
beg
;

1528 
pos_too_big
: {

1529 
öt64_t
 
max
 = 
íd
 > 
beg
 ?Énd : beg, 
s
 = 1 << 14;

1530 
n_lvls
 = 0;

1531 
max
 > 
s
) {

1532 
n_lvls
++;

1533 
s
 <<= 3;

1536 i‡(
hts_vîbo£
 >= 1) {

1537 i‡(
idx
->
fmt
 =
HTS_FMT_CSI
) {

1538 
	`Ârötf
(
°dîr
,

1542 
__func__
, 
beg
, 
íd
,

1543 
idx
->
mö_shi·
, idx->
n_lvls
,Ç_lvls);

1545 
	`Ârötf
(
°dîr
,

1549 
__func__
, 
beg
, 
íd
, 
	`idx_f‹m©_«me
(
idx
->
fmt
), 
n_lvls
);

1552 
î∫o
 = 
ERANGE
;

1555 
	}
}

1557 
	$hts_idx_de°roy
(
hts_idx_t
 *
idx
)

1559 
khöt_t
 
k
;

1560 
i
;

1561 i‡(
idx
 == 0) ;

1564 i‡(
idx
->
fmt
 =
HTS_FMT_CRAI
) {

1565 
hts_¸am_idx_t
 *
cidx
 = (hts_¸am_idx_à*Ë
idx
;

1566 
	`¸am_ödex_‰ì
(
cidx
->
¸am
);

1567 
	`‰ì
(
cidx
);

1571 
i
 = 0; i < 
idx
->
m
; ++i) {

1572 
bidx_t
 *
bidx
 = 
idx
->bidx[
i
];

1573 
	`‰ì
(
idx
->
lidx
[
i
].
off£t
);

1574 i‡(
bidx
 == 0) ;

1575 
k
 = 
	`kh_begö
(
bidx
); k !
	`kh_íd
(bidx); ++k)

1576 i‡(
	`kh_exi°
(
bidx
, 
k
))

1577 
	`‰ì
(
	`kh_vÆue
(
bidx
, 
k
).
li°
);

1578 
	`kh_de°roy
(
bö
, 
bidx
);

1580 
	`‰ì
(
idx
->
bidx
); fªe(idx->
lidx
); fªe(idx->
mëa
);

1581 
	`‰ì
(
idx
);

1582 
	}
}

1587 
ölöe
 
ssize_t
 
HTS_RESULT_USED
 
	$idx_wrôe_öt32
(
BGZF
 *
Â
, 
öt32_t
 
x
)

1589 i‡(
	`ed_is_big
()Ë
x
 = 
	`ed_sw≠_4
(x);

1590  
	`bgzf_wrôe
(
Â
, &
x
,  x);

1591 
	}
}

1593 
ölöe
 
ssize_t
 
HTS_RESULT_USED
 
	$idx_wrôe_uöt32
(
BGZF
 *
Â
, 
uöt32_t
 
x
)

1595 i‡(
	`ed_is_big
()Ë
x
 = 
	`ed_sw≠_4
(x);

1596  
	`bgzf_wrôe
(
Â
, &
x
,  x);

1597 
	}
}

1599 
ölöe
 
ssize_t
 
HTS_RESULT_USED
 
	$idx_wrôe_uöt64
(
BGZF
 *
Â
, 
uöt64_t
 
x
)

1601 i‡(
	`ed_is_big
()Ë
x
 = 
	`ed_sw≠_8
(x);

1602  
	`bgzf_wrôe
(
Â
, &
x
,  x);

1603 
	}
}

1605 
ölöe
 
	$sw≠_bös
(
bös_t
 *
p
)

1607 
i
;

1608 
i
 = 0; i < 
p
->
n
; ++i) {

1609 
	`ed_sw≠_8p
(&
p
->
li°
[
i
].
u
);

1610 
	`ed_sw≠_8p
(&
p
->
li°
[
i
].
v
);

1612 
	}
}

1614 
	$hts_idx_ßve_c‹e
(c⁄° 
hts_idx_t
 *
idx
, 
BGZF
 *
Â
, 
fmt
)

1616 
öt32_t
 
i
, 
j
;

1618 
	#check
(
ªt
Ëi‡(‘ëË< 0Ë -1

	)

1620 
	`check
(
	`idx_wrôe_öt32
(
Â
, 
idx
->
n
));

1621 i‡(
fmt
 =
HTS_FMT_TBI
 && 
idx
->
l_mëa
)

1622 
	`check
(
	`bgzf_wrôe
(
Â
, 
idx
->
mëa
, idx->
l_mëa
));

1624 
i
 = 0; i < 
idx
->
n
; ++i) {

1625 
khöt_t
 
k
;

1626 
bidx_t
 *
bidx
 = 
idx
->bidx[
i
];

1627 
lidx_t
 *
lidx
 = &
idx
->lidx[
i
];

1629 
	`check
(
	`idx_wrôe_öt32
(
Â
, 
bidx
? 
	`kh_size
(bidx) : 0));

1630 i‡(
bidx
)

1631 
k
 = 
	`kh_begö
(
bidx
); k !
	`kh_íd
(bidx); ++k)

1632 i‡(
	`kh_exi°
(
bidx
, 
k
)) {

1633 
bös_t
 *
p
 = &
	`kh_vÆue
(
bidx
, 
k
);

1634 
	`check
(
	`idx_wrôe_uöt32
(
Â
, 
	`kh_key
(
bidx
, 
k
)));

1635 i‡(
fmt
 =
HTS_FMT_CSI
Ë
	`check
(
	`idx_wrôe_uöt64
(
Â
, 
p
->
loff
));

1637 
	`check
(
	`idx_wrôe_öt32
(
Â
, 
p
->
n
));

1638 
j
 = 0; j < 
p
->
n
; ++j) {

1639 
	`check
(
	`idx_wrôe_uöt64
(
Â
, 
p
->
li°
[
j
].
u
));

1640 
	`check
(
	`idx_wrôe_uöt64
(
Â
, 
p
->
li°
[
j
].
v
));

1645 i‡(
fmt
 !
HTS_FMT_CSI
) {

1646 
	`check
(
	`idx_wrôe_öt32
(
Â
, 
lidx
->
n
));

1647 
j
 = 0; j < 
lidx
->
n
; ++j)

1648 
	`check
(
	`idx_wrôe_uöt64
(
Â
, 
lidx
->
off£t
[
j
]));

1652 
	`check
(
	`idx_wrôe_uöt64
(
Â
, 
idx
->
n_no_co‹
));

1654 #unde‡
check


1655 
	}
}

1657 
	$hts_idx_ßve
(c⁄° 
hts_idx_t
 *
idx
, c⁄° *
‚
, 
fmt
)

1659 
ªt
, 
ßve
;

1660 *
‚idx
 = (*)
	`ˇŒoc
(1, 
	`°æí
(
‚
) + 5);

1661 i‡(
‚idx
 =
NULL
)  -1;

1663 
	`°r˝y
(
‚idx
, 
‚
);

1664 
fmt
) {

1665 
HTS_FMT_BAI
: 
	`°rˇt
(
‚idx
, ".bai"); ;

1666 
HTS_FMT_CSI
: 
	`°rˇt
(
‚idx
, ".csi"); ;

1667 
HTS_FMT_TBI
: 
	`°rˇt
(
‚idx
, ".tbi"); ;

1668 : 
	`ab‹t
();

1671 
ªt
 = 
	`hts_idx_ßve_as
(
idx
, 
‚
, 
‚idx
, 
fmt
);

1672 
ßve
 = 
î∫o
;

1673 
	`‰ì
(
‚idx
);

1674 
î∫o
 = 
ßve
;

1675  
ªt
;

1676 
	}
}

1678 
	$hts_idx_ßve_as
(c⁄° 
hts_idx_t
 *
idx
, c⁄° *
‚
, c⁄° *
‚idx
, 
fmt
)

1680 
BGZF
 *
Â
;

1682 
	#check
(
ªt
Ëi‡(‘ëË< 0Ë
Áû


	)

1684 i‡(
‚idx
 =
NULL
Ë 
	`hts_idx_ßve
(
idx
, 
‚
, 
fmt
);

1686 
Â
 = 
	`bgzf_›í
(
‚idx
, (
fmt
 =
HTS_FMT_BAI
)? "wu" : "w");

1687 i‡(
Â
 =
NULL
)  -1;

1689 i‡(
fmt
 =
HTS_FMT_CSI
) {

1690 
	`check
(
	`bgzf_wrôe
(
Â
, "CSI\1", 4));

1691 
	`check
(
	`idx_wrôe_öt32
(
Â
, 
idx
->
mö_shi·
));

1692 
	`check
(
	`idx_wrôe_öt32
(
Â
, 
idx
->
n_lvls
));

1693 
	`check
(
	`idx_wrôe_uöt32
(
Â
, 
idx
->
l_mëa
));

1694 i‡(
idx
->
l_mëa
Ë
	`check
(
	`bgzf_wrôe
(
Â
, idx->
mëa
, idx->l_meta));

1695 } i‡(
fmt
 =
HTS_FMT_TBI
) {

1696 
	`check
(
	`bgzf_wrôe
(
Â
, "TBI\1", 4));

1697 } i‡(
fmt
 =
HTS_FMT_BAI
) {

1698 
	`check
(
	`bgzf_wrôe
(
Â
, "BAI\1", 4));

1699 } 
	`ab‹t
();

1701 
	`check
(
	`hts_idx_ßve_c‹e
(
idx
, 
Â
, 
fmt
));

1703  
	`bgzf_˛o£
(
Â
);

1704 #unde‡
check


1706 
Áû
:

1707 
	`bgzf_˛o£
(
Â
);

1709 
	}
}

1711 
	$hts_idx_lﬂd_c‹e
(
hts_idx_t
 *
idx
, 
BGZF
 *
Â
, 
fmt
)

1713 
öt32_t
 
i
, 
n
, 
is_be
;

1714 
is_be
 = 
	`ed_is_big
();

1715 i‡(
idx
 =
NULL
)  -4;

1716 
i
 = 0; i < 
idx
->
n
; ++i) {

1717 
bidx_t
 *
h
;

1718 
lidx_t
 *
l
 = &
idx
->
lidx
[
i
];

1719 
uöt32_t
 
key
;

1720 
j
, 
ab£¡
;

1721 
bös_t
 *
p
;

1722 
h
 = 
idx
->
bidx
[
i
] = 
	`kh_öô
(
bö
);

1723 i‡(
	`bgzf_ªad
(
Â
, &
n
, 4) != 4)  -1;

1724 i‡(
is_be
Ë
	`ed_sw≠_4p
(&
n
);

1725 
j
 = 0; j < 
n
; ++j) {

1726 
khöt_t
 
k
;

1727 i‡(
	`bgzf_ªad
(
Â
, &
key
, 4) != 4)  -1;

1728 i‡(
is_be
Ë
	`ed_sw≠_4p
(&
key
);

1729 
k
 = 
	`kh_put
(
bö
, 
h
, 
key
, &
ab£¡
);

1730 i‡(
ab£¡
 <= 0)  -3;

1731 
p
 = &
	`kh_vÆ
(
h
, 
k
);

1732 i‡(
fmt
 =
HTS_FMT_CSI
) {

1733 i‡(
	`bgzf_ªad
(
Â
, &
p
->
loff
, 8) != 8)  -1;

1734 i‡(
is_be
Ë
	`ed_sw≠_8p
(&
p
->
loff
);

1735 } 
p
->
loff
 = 0;

1736 i‡(
	`bgzf_ªad
(
Â
, &
p
->
n
, 4) != 4)  -1;

1737 i‡(
is_be
Ë
	`ed_sw≠_4p
(&
p
->
n
);

1738 
p
->
m
 =Ö->
n
;

1739 
p
->
li°
 = (
hts_∑ú64_t
*)
	`mÆloc
’->
m
 * (hts_pair64_t));

1740 i‡(
p
->
li°
 =
NULL
)  -2;

1741 i‡(
	`bgzf_ªad
(
Â
, 
p
->
li°
,Ö->
n
<<4) !=Ö->n<<4)  -1;

1742 i‡(
is_be
Ë
	`sw≠_bös
(
p
);

1744 i‡(
fmt
 !
HTS_FMT_CSI
) {

1745 
j
;

1746 i‡(
	`bgzf_ªad
(
Â
, &
l
->
n
, 4) != 4)  -1;

1747 i‡(
is_be
Ë
	`ed_sw≠_4p
(&
l
->
n
);

1748 
l
->
m
 =Ü->
n
;

1749 
l
->
off£t
 = (
uöt64_t
*)
	`mÆloc
÷->
n
 * (uint64_t));

1750 i‡(
l
->
off£t
 =
NULL
)  -2;

1751 i‡(
	`bgzf_ªad
(
Â
, 
l
->
off£t
,Ü->
n
 << 3) !=Ü->n << 3)  -1;

1752 i‡(
is_be
Ë
j
 = 0; j < 
l
->
n
; ++jË
	`ed_sw≠_8p
(&l->
off£t
[j]);

1753 
j
 = 1; j < 
l
->
n
; ++j)

1754 i‡(
l
->
off£t
[
j
] == 0)Ü->offset[j] =Ü->offset[j-1];

1755 
	`upd©e_loff
(
idx
, 
i
, 1);

1758 i‡(
	`bgzf_ªad
(
Â
, &
idx
->
n_no_co‹
, 8) != 8) idx->n_no_coor = 0;

1759 i‡(
is_be
Ë
	`ed_sw≠_8p
(&
idx
->
n_no_co‹
);

1761 
	}
}

1763 
hts_idx_t
 *
	$hts_idx_lﬂd_loˇl
(c⁄° *
‚
)

1765 
uöt8_t
 
magic
[4];

1766 
i
, 
is_be
;

1767 
hts_idx_t
 *
idx
 = 
NULL
;

1768 
uöt8_t
 *
mëa
 = 
NULL
;

1769 
BGZF
 *
Â
 = 
	`bgzf_›í
(
‚
, "r");

1770 i‡(
Â
 =
NULL
)  NULL;

1771 
is_be
 = 
	`ed_is_big
();

1772 i‡(
	`bgzf_ªad
(
Â
, 
magic
, 4Ë!4Ë
Áû
;

1774 i‡(
	`memcmp
(
magic
, "CSI\1", 4) == 0) {

1775 
uöt32_t
 
x
[3], 
n
;

1776 i‡(
	`bgzf_ªad
(
Â
, 
x
, 12Ë!12Ë
Áû
;

1777 i‡(
is_be
Ë
i
 = 0; i < 3; ++iË
	`ed_sw≠_4p
(&
x
[i]);

1778 i‡(
x
[2]) {

1779 i‡(
SIZE_MAX
 - 
x
[2] < 1Ë
Áû
;

1780 i‡((
mëa
 = (
uöt8_t
*)
	`mÆloc
((
size_t
Ë
x
[2] + 1)Ë=
NULL
Ë
Áû
;

1781 i‡(
	`bgzf_ªad
(
Â
, 
mëa
, 
x
[2]Ë!x[2]Ë
Áû
;

1783 
mëa
[
x
[2]] = '\0';

1785 i‡(
	`bgzf_ªad
(
Â
, &
n
, 4Ë!4Ë
Áû
;

1786 i‡(
is_be
Ë
	`ed_sw≠_4p
(&
n
);

1787 i‡((
idx
 = 
	`hts_idx_öô
(
n
, 
HTS_FMT_CSI
, 0, 
x
[0], x[1])Ë=
NULL
Ë
Áû
;

1788 
idx
->
l_mëa
 = 
x
[2];

1789 
idx
->
mëa
 = meta;

1790 
mëa
 = 
NULL
;

1791 i‡(
	`hts_idx_lﬂd_c‹e
(
idx
, 
Â
, 
HTS_FMT_CSI
Ë< 0Ë
Áû
;

1793 i‡(
	`memcmp
(
magic
, "TBI\1", 4) == 0) {

1794 
uöt8_t
 
x
[8 * 4];

1795 
uöt32_t
 
n
;

1797 i‡(
	`bgzf_ªad
(
Â
, 
x
, (x)Ë!(x)Ë
Áû
;

1798 
n
 = 
	`À_to_u32
(&
x
[0]);

1799 i‡((
idx
 = 
	`hts_idx_öô
(
n
, 
HTS_FMT_TBI
, 0, 14, 5)Ë=
NULL
Ë
Áû
;

1800 
n
 = 
	`À_to_u32
(&
x
[7*4]);

1801 i‡(
n
 > 
UINT32_MAX
 - 29Ë
Áû
;

1802 
idx
->
l_mëa
 = 28 + 
n
;

1803 i‡((
idx
->
mëa
 = (
uöt8_t
*)
	`mÆloc
(idx->
l_mëa
 + 1)Ë=
NULL
Ë
Áû
;

1806 
	`mem˝y
(
idx
->
mëa
, &
x
[1*4], 28);

1808 i‡(
	`bgzf_ªad
(
Â
, 
idx
->
mëa
 + 28, 
n
Ë!nË
Áû
;

1810 
idx
->
mëa
[idx->
l_mëa
] = '\0';

1811 i‡(
	`hts_idx_lﬂd_c‹e
(
idx
, 
Â
, 
HTS_FMT_TBI
Ë< 0Ë
Áû
;

1813 i‡(
	`memcmp
(
magic
, "BAI\1", 4) == 0) {

1814 
uöt32_t
 
n
;

1815 i‡(
	`bgzf_ªad
(
Â
, &
n
, 4Ë!4Ë
Áû
;

1816 i‡(
is_be
Ë
	`ed_sw≠_4p
(&
n
);

1817 
idx
 = 
	`hts_idx_öô
(
n
, 
HTS_FMT_BAI
, 0, 14, 5);

1818 i‡(
	`hts_idx_lﬂd_c‹e
(
idx
, 
Â
, 
HTS_FMT_BAI
Ë< 0Ë
Áû
;

1820 { 
î∫o
 = 
EINVAL
; 
Áû
; }

1822 
	`bgzf_˛o£
(
Â
);

1823  
idx
;

1825 
Áû
:

1826 
	`bgzf_˛o£
(
Â
);

1827 
	`hts_idx_de°roy
(
idx
);

1828 
	`‰ì
(
mëa
);

1829  
NULL
;

1830 
	}
}

1832 
	$hts_idx_£t_mëa
(
hts_idx_t
 *
idx
, 
uöt32_t
 
l_mëa
, 
uöt8_t
 *
mëa
,

1833 
is_c›y
)

1835 
uöt8_t
 *
√w_mëa
 = 
mëa
;

1836 i‡(
is_c›y
) {

1837 
size_t
 
l
 = 
l_mëa
;

1838 i‡(
l
 > 
SIZE_MAX
 - 1) {

1839 
î∫o
 = 
ENOMEM
;

1842 
√w_mëa
 = 
	`mÆloc
(
l
 + 1);

1843 i‡(!
√w_mëa
)  -1;

1844 
	`mem˝y
(
√w_mëa
, 
mëa
, 
l
);

1846 
mëa
[
l
 + 1] = '\0';

1848 i‡(
idx
->
mëa
Ë
	`‰ì
(idx->meta);

1849 
idx
->
l_mëa
 =Ü_meta;

1850 
idx
->
mëa
 = 
√w_mëa
;

1852 
	}
}

1854 
uöt8_t
 *
	$hts_idx_gë_mëa
(
hts_idx_t
 *
idx
, 
uöt32_t
 *
l_mëa
)

1856 *
l_mëa
 = 
idx
->l_meta;

1857  
idx
->
mëa
;

1858 
	}
}

1860 c⁄° **
	$hts_idx_£q«mes
(c⁄° 
hts_idx_t
 *
idx
, *
n
, 
hts_id2«me_f
 
gëid
, *
hdr
)

1862 i‡–!
idx
->
n
 )

1864 *
n
 = 0;

1865  
NULL
;

1868 
tid
 = 0, 
i
;

1869 c⁄° **
«mes
 = (c⁄° **Ë
	`ˇŒoc
(
idx
->
n
,(const *));

1870 
i
=0; i<
idx
->
n
; i++)

1872 
bidx_t
 *
bidx
 = 
idx
->bidx[
i
];

1873 i‡–!
bidx
 ) ;

1874 
«mes
[
tid
++] = 
	`gëid
(
hdr
,
i
);

1876 *
n
 = 
tid
;

1877  
«mes
;

1878 
	}
}

1880 
	$hts_idx_gë_°©
(c⁄° 
hts_idx_t
* 
idx
, 
tid
, 
uöt64_t
* 
m≠≥d
, uöt64_t* 
unm≠≥d
)

1882 i‡–
idx
->
fmt
 =
HTS_FMT_CRAI
 ) {

1883 *
m≠≥d
 = 0; *
unm≠≥d
 = 0;

1887 
bidx_t
 *
h
 = 
idx
->
bidx
[
tid
];

1888 
khöt_t
 
k
 = 
	`kh_gë
(
bö
, 
h
, 
	`META_BIN
(
idx
));

1889 i‡(
k
 !
	`kh_íd
(
h
)) {

1890 *
m≠≥d
 = 
	`kh_vÆ
(
h
, 
k
).
li°
[1].
u
;

1891 *
unm≠≥d
 = 
	`kh_vÆ
(
h
, 
k
).
li°
[1].
v
;

1894 *
m≠≥d
 = 0; *
unm≠≥d
 = 0;

1897 
	}
}

1899 
uöt64_t
 
	$hts_idx_gë_n_no_co‹
(c⁄° 
hts_idx_t
* 
idx
)

1901  
idx
->
n_no_co‹
;

1902 
	}
}

1908 
ölöe
 
	$ªg2bös
(
öt64_t
 
beg
, i¡64_à
íd
, 
hts_ôr_t
 *
ôr
, 
mö_shi·
, 
n_lvls
)

1910 
l
, 
t
, 
s
 = 
mö_shi·
 + (
n_lvls
<<1) +Ç_lvls;

1911 i‡(
beg
 >
íd
)  0;

1912 i‡(
íd
 >1LL<<
s
)Énd = 1LL<<s;

1913 --
íd
, 
l
 = 0, 
t
 = 0;Ü <
n_lvls
; 
s
 -= 3,Å += 1<<((l<<1)+l), ++l) {

1914 
b
, 
e
, 
n
, 
i
;

1915 
b
 = 
t
 + (
beg
>>
s
); 
e
 =Å + (
íd
>>s); 
n
 =É - b + 1;

1916 i‡(
ôr
->
bös
.
n
 +Ç > iå->bös.
m
) {

1917 
ôr
->
bös
.
m
 = iå->bös.
n
 +Ç;

1918 
	`kroundup32
(
ôr
->
bös
.
m
);

1919 
ôr
->
bös
.
a
 = (*)
	`ªÆloc
(ôr->bös.a, (Ë* iå->bös.
m
);

1921 
i
 = 
b
; i <
e
; ++iË
ôr
->
bös
.
a
[ôr->bös.
n
++] = i;

1923  
ôr
->
bös
.
n
;

1924 
	}
}

1926 
hts_ôr_t
 *
	$hts_ôr_quîy
(c⁄° 
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
, 
hts_ªadªc_func
 *
ªadªc
)

1928 
i
, 
n_off
, 
l
, 
bö
;

1929 
hts_∑ú64_t
 *
off
;

1930 
khöt_t
 
k
;

1931 
bidx_t
 *
bidx
;

1932 
uöt64_t
 
mö_off
, 
max_off
;

1933 
hts_ôr_t
 *
ôî
 = 0;

1934 i‡(
tid
 < 0) {

1935 
föished0
 = 0;

1936 
uöt64_t
 
off0
 = (uint64_t)-1;

1937 
khöt_t
 
k
;

1938 
tid
) {

1939 
HTS_IDX_START
:

1941 
i
=0; i<
idx
->
n
; i++)

1943 
bidx
 = 
idx
->bidx[
i
];

1944 
k
 = 
	`kh_gë
(
bö
, 
bidx
, 
	`META_BIN
(
idx
));

1945 i‡(
k
 =
	`kh_íd
(
bidx
)) ;

1946 i‡–
off0
 > 
	`kh_vÆ
(
bidx
, 
k
).
li°
[0].
u
 ) off0 = kh_val(bidx, k).list[0].u;

1948 i‡–
off0
==(
uöt64_t
)-1 && 
idx
->
n_no_co‹
 ) off0 = 0;

1951 
HTS_IDX_NOCOOR
:

1958 
i
 = 0; i < 
idx
->
n
; i++) {

1959 
bidx
 = 
idx
->bidx[
i
];

1960 
k
 = 
	`kh_gë
(
bö
, 
bidx
, 
	`META_BIN
(
idx
));

1961 i‡(
k
 !
	`kh_íd
(
bidx
)) {

1962 i‡(
off0
==(
uöt64_t
)-1 || off0 < 
	`kh_vÆ
(
bidx
, 
k
).
li°
[0].
v
) {

1963 
off0
 = 
	`kh_vÆ
(
bidx
, 
k
).
li°
[0].
v
;

1967 i‡–
off0
==(
uöt64_t
)-1 && 
idx
->
n_no_co‹
 ) off0 = 0;

1970 
HTS_IDX_REST
:

1971 
off0
 = 0;

1974 
HTS_IDX_NONE
:

1975 
föished0
 = 1;

1976 
off0
 = 0;

1982 i‡(
off0
 !(
uöt64_t
)-1) {

1983 
ôî
 = (
hts_ôr_t
*)
	`ˇŒoc
(1, (hts_itr_t));

1984 
ôî
->
ªad_ª°
 = 1;

1985 
ôî
->
föished
 = 
föished0
;

1986 
ôî
->
cuº_off
 = 
off0
;

1987 
ôî
->
ªadªc
 =Ñeadrec;

1988  
ôî
;

1992 i‡(
beg
 < 0) beg = 0;

1993 i‡(
íd
 < 
beg
)  0;

1994 i‡(
tid
 >
idx
->
n
 || (
bidx
 = idx->bidx[tid]Ë=
NULL
)  0;

1996 
ôî
 = (
hts_ôr_t
*)
	`ˇŒoc
(1, (hts_itr_t));

1997 
ôî
->
tid
 =Åid, iãr->
beg
 = beg, iãr->
íd
 =Énd; iãr->
i
 = -1;

1998 
ôî
->
ªadªc
 =Ñeadrec;

2000 i‡–!
	`kh_size
(
bidx
ËË{ 
ôî
->
föished
 = 1;  iter; }

2003 
bö
 = 
	`hts_bö_fú°
(
idx
->
n_lvls
Ë+ (
beg
>>idx->
mö_shi·
);

2005 
fú°
;

2006 
k
 = 
	`kh_gë
(
bö
, 
bidx
, bin);

2007 i‡(
k
 !
	`kh_íd
(
bidx
)) ;

2008 
fú°
 = (
	`hts_bö_∑ª¡
(
bö
)<<3) + 1;

2009 i‡(
bö
 > 
fú°
) --bin;

2010 
bö
 = 
	`hts_bö_∑ª¡
(bin);

2011 } 
bö
);

2012 i‡(
bö
 =0Ë
k
 = 
	`kh_gë
(bö, 
bidx
, bin);

2013 
mö_off
 = 
k
 !
	`kh_íd
(
bidx
)? 
	`kh_vÆ
(bidx, k).
loff
 : 0;

2016 
bö
 = 
	`hts_bö_fú°
(
idx
->
n_lvls
Ë+ ((
íd
-1Ë>> idx->
mö_shi·
) + 1;

2017 i‡(
bö
 >
idx
->
n_bös
) bin = 0;

2022 
bö
 % 8 =1Ëbö = 
	`hts_bö_∑ª¡
(bin);

2023 i‡(
bö
 =0Ë{ 
max_off
 = (
uöt64_t
)-1; ; }

2024 
k
 = 
	`kh_gë
(
bö
, 
bidx
, bin);

2025 i‡(
k
 !
	`kh_íd
(
bidx
Ë&& 
	`kh_vÆ
(bidx, k).
n
 > 0Ë{ 
max_off
 = kh_vÆ(bidx, k).
li°
[0].
u
; ; }

2026 
bö
++;

2030 
	`ªg2bös
(
beg
, 
íd
, 
ôî
, 
idx
->
mö_shi·
, idx->
n_lvls
);

2031 
i
 = 
n_off
 = 0; i < 
ôî
->
bös
.
n
; ++i)

2032 i‡((
k
 = 
	`kh_gë
(
bö
, 
bidx
, 
ôî
->
bös
.
a
[
i
])Ë!
	`kh_íd
(bidx))

2033 
n_off
 +
	`kh_vÆue
(
bidx
, 
k
).
n
;

2034 i‡(
n_off
 == 0) {

2036 
ôî
->
föished
 = 1;

2037  
ôî
;

2039 
off
 = (
hts_∑ú64_t
*)
	`ˇŒoc
(
n_off
, (hts_pair64_t));

2040 
i
 = 
n_off
 = 0; i < 
ôî
->
bös
.
n
; ++i) {

2041 i‡((
k
 = 
	`kh_gë
(
bö
, 
bidx
, 
ôî
->
bös
.
a
[
i
])Ë!
	`kh_íd
(bidx)) {

2042 
j
;

2043 
bös_t
 *
p
 = &
	`kh_vÆue
(
bidx
, 
k
);

2044 
j
 = 0; j < 
p
->
n
; ++j)

2045 i‡(
p
->
li°
[
j
].
v
 > 
mö_off
 &&Ö->li°[j].
u
 < 
max_off
)

2046 
off
[
n_off
++] = 
p
->
li°
[
j
];

2049 i‡(
n_off
 == 0) {

2050 
	`‰ì
(
off
);

2051 
ôî
->
föished
 = 1;

2052  
ôî
;

2054 
	`ks_öåos‹t
(
_off
, 
n_off
, 
off
);

2056 
i
 = 1, 
l
 = 0; i < 
n_off
; ++i)

2057 i‡(
off
[
l
].
v
 < off[
i
].v) off[++l] = off[i];

2058 
n_off
 = 
l
 + 1;

2060 
i
 = 1; i < 
n_off
; ++i)

2061 i‡(
off
[
i
-1].
v
 >off[i].
u
) off[i-1].v = off[i].u;

2063 
i
 = 1, 
l
 = 0; i < 
n_off
; ++i) {

2064 i‡(
off
[
l
].
v
>>16 =off[
i
].
u
>>16) off[l].v = off[i].v;

2065 
off
[++
l
] = off[
i
];

2067 
n_off
 = 
l
 + 1;

2068 
ôî
->
n_off
 =Ç_off; iãr->
off
 = off;

2069  
ôî
;

2070 
	}
}

2072 
	$hts_ôr_de°roy
(
hts_ôr_t
 *
ôî
)

2074 i‡(
ôî
Ë{ 
	`‰ì
(ôî->
off
); fªe(ôî->
bös
.
a
); free(iter); }

2075 
	}
}

2077 
ölöe
 
	$push_digô
(
i
, 
c
)

2080 
digô
 = 
c
 - '0';

2081  10 * 
i
 + 
digô
;

2082 
	}
}

2084 
	$hts_∑r£_decimÆ
(c⁄° *
°r
, **
°ªnd
, 
Êags
)

2086 
n
 = 0;

2087 
decimÆs
 = 0, 
e
 = 0, 
lo°
 = 0;

2088 
sign
 = '+', 
esign
 = '+';

2089 c⁄° *
s
;

2091 
	`is•a˚_c
(*
°r
)) str++;

2092 
s
 = 
°r
;

2094 i‡(*
s
 ='+' || *†='-'Ë
sign
 = *s++;

2095 *
s
)

2096 i‡(
	`isdigô_c
(*
s
)Ë
n
 = 
	`push_digô
(n, *s++);

2097 i‡(*
s
 =',' && (
Êags
 & 
HTS_PARSE_THOUSANDS_SEP
)) s++;

2100 i‡(*
s
 == '.') {

2101 
s
++;

2102 
	`isdigô_c
(*
s
)Ë
decimÆs
++, 
n
 = 
	`push_digô
(n, *s++);

2105 i‡(*
s
 == 'E' || *s == 'e') {

2106 
s
++;

2107 i‡(*
s
 ='+' || *†='-'Ë
esign
 = *s++;

2108 
	`isdigô_c
(*
s
)Ë
e
 = 
	`push_digô
(e, *s++);

2109 i‡(
esign
 ='-'Ë
e
 = -e;

2112 
e
 -
decimÆs
;

2113 
e
 > 0Ë
n
 *= 10,É--;

2114 
e
 < 0Ë
lo°
 +
n
 % 10,Ç /= 10,É++;

2116 i‡(
lo°
 > 0 && 
hts_vîbo£
 >= 3)

2117 
	`Ârötf
(
°dîr
, "[W::%s] discarding fractionalÖart of %.*s\n",

2118 
__func__
, ()(
s
 - 
°r
), str);

2120 i‡(
°ªnd
Ë*°ªnd = (*Ë
s
;

2121 i‡(*
s
 && 
hts_vîbo£
 >= 2)

2122 
	`Ârötf
(
°dîr
, "[W::%s] ignoring unknown charactersáfter %.*s[%s]\n",

2123 
__func__
, ()(
s
 - 
°r
), str, s);

2125  (
sign
 ='+')? 
n
 : -n;

2126 
	}
}

2128 c⁄° *
	$hts_∑r£_ªg
(c⁄° *
s
, *
beg
, *
íd
)

2130 *
hyphí
;

2131 c⁄° *
cﬁ⁄
 = 
	`°ºchr
(
s
, ':');

2132 i‡(
cﬁ⁄
 =
NULL
) {

2133 *
beg
 = 0; *
íd
 = 
INT_MAX
;

2134  
s
 + 
	`°æí
(s);

2137 *
beg
 = 
	`hts_∑r£_decimÆ
(
cﬁ⁄
+1, &
hyphí
, 
HTS_PARSE_THOUSANDS_SEP
) - 1;

2138 i‡(*
beg
 < 0) *beg = 0;

2140 i‡(*
hyphí
 ='\0'Ë*
íd
 = 
INT_MAX
;

2141 i‡(*
hyphí
 ='-'Ë*
íd
 = 
	`hts_∑r£_decimÆ
(hyphí+1, 
NULL
, 
HTS_PARSE_THOUSANDS_SEP
);

2142  
NULL
;

2144 i‡(*
beg
 >*
íd
Ë 
NULL
;

2145  
cﬁ⁄
;

2146 
	}
}

2148 
hts_ôr_t
 *
	$hts_ôr_quîys
(c⁄° 
hts_idx_t
 *
idx
, c⁄° *
ªg
, 
hts_«me2id_f
 
gëid
, *
hdr
, 
hts_ôr_quîy_func
 *
ôr_quîy
, 
hts_ªadªc_func
 *
ªadªc
)

2150 
tid
, 
beg
, 
íd
;

2151 c⁄° *
q
;

2153 i‡(
	`°rcmp
(
ªg
, ".") == 0)

2154  
	`ôr_quîy
(
idx
, 
HTS_IDX_START
, 0, 0, 
ªadªc
);

2155 i‡(
	`°rcmp
(
ªg
, "*") == 0)

2156  
	`ôr_quîy
(
idx
, 
HTS_IDX_NOCOOR
, 0, 0, 
ªadªc
);

2158 
q
 = 
	`hts_∑r£_ªg
(
ªg
, &
beg
, &
íd
);

2159 i‡(
q
) {

2160 
tmp_a
[1024], *
tmp
 =Åmp_a;

2161 i‡(
q
 - 
ªg
 + 1 > 1024)

2162 i‡(!(
tmp
 = 
	`mÆloc
(
q
 - 
ªg
 + 1)))

2163  
NULL
;

2164 
	`°∫˝y
(
tmp
, 
ªg
, 
q
 -Ñeg);

2165 
tmp
[
q
 - 
ªg
] = 0;

2166 
tid
 = 
	`gëid
(
hdr
, 
tmp
);

2167 i‡(
tmp
 !
tmp_a
)

2168 
	`‰ì
(
tmp
);

2172 
tid
 = 
	`gëid
(
hdr
, 
ªg
);

2173 
beg
 = 0; 
íd
 = 
INT_MAX
;

2176 i‡(
tid
 < 0Ë 
NULL
;

2177  
	`ôr_quîy
(
idx
, 
tid
, 
beg
, 
íd
, 
ªadªc
);

2178 
	}
}

2180 
	$hts_ôr_√xt
(
BGZF
 *
Â
, 
hts_ôr_t
 *
ôî
, *
r
, *
d©a
)

2182 
ªt
, 
tid
, 
beg
, 
íd
;

2183 i‡(
ôî
 =
NULL
 || iãr->
föished
)  -1;

2184 i‡(
ôî
->
ªad_ª°
) {

2185 i‡(
ôî
->
cuº_off
) {

2186 i‡(
	`bgzf_£ek
(
Â
, 
ôî
->
cuº_off
, 
SEEK_SET
) < 0)  -1;

2187 
ôî
->
cuº_off
 = 0;

2189 
ªt
 = 
ôî
->
	`ªadªc
(
Â
, 
d©a
, 
r
, &
tid
, &
beg
, &
íd
);

2190 i‡(
ªt
 < 0Ë
ôî
->
föished
 = 1;

2191 
ôî
->
cuº_tid
 = 
tid
;

2192 
ôî
->
cuº_beg
 = 
beg
;

2193 
ôî
->
cuº_íd
 = 
íd
;

2194  
ªt
;

2197 
	`as£π
(
ôî
->
off
 !
NULL
);

2199 i‡(
ôî
->
cuº_off
 =0 || iãr->cuº_of‡>ôî->
off
[ôî->
i
].
v
) {

2200 i‡(
ôî
->
i
 =ôî->
n_off
 - 1Ë{ 
ªt
 = -1; ; }

2201 i‡(
ôî
->
i
 < 0 || iãr->
off
[ôî->i].
v
 !ôî->off[ôî->i+1].
u
) {

2202 i‡(
	`bgzf_£ek
(
Â
, 
ôî
->
off
[ôî->
i
+1].
u
, 
SEEK_SET
) < 0)  -1;

2203 
ôî
->
cuº_off
 = 
	`bgzf_ãŒ
(
Â
);

2205 ++
ôî
->
i
;

2207 i‡((
ªt
 = 
ôî
->
	`ªadªc
(
Â
, 
d©a
, 
r
, &
tid
, &
beg
, &
íd
)) >= 0) {

2208 
ôî
->
cuº_off
 = 
	`bgzf_ãŒ
(
Â
);

2209 i‡(
tid
 !
ôî
->tid || 
beg
 >ôî->
íd
) {

2210 
ªt
 = -1; ;

2211 } i‡(
íd
 > 
ôî
->
beg
 && iter->end > beg) {

2212 
ôî
->
cuº_tid
 = 
tid
;

2213 
ôî
->
cuº_beg
 = 
beg
;

2214 
ôî
->
cuº_íd
 = 
íd
;

2215  
ªt
;

2219 
ôî
->
föished
 = 1;

2220  
ªt
;

2221 
	}
}

2227 *
	$ã°_™d_„tch
(c⁄° *
‚
)

2229 i‡(
	`hi§emŸe
(
‚
)) {

2230 c⁄° 
buf_size
 = 1 * 1024 * 1024;

2231 
hFILE
 *
Â_ªmŸe
;

2232 
FILE
 *
Â
;

2233 
uöt8_t
 *
buf
;

2234 
l
;

2235 c⁄° *
p
;

2236 
p
 = 
‚
 + 
	`°æí
(fn) - 1;Ö >= fn; --p)

2237 i‡(*
p
 == '/') ;

2238 ++
p
;

2240 i‡((
Â
 = 
	`f›í
((*)
p
, "rb")) != 0)

2242 
	`f˛o£
(
Â
);

2243  (*)
p
;

2246 i‡((
Â_ªmŸe
 = 
	`h›í
(
‚
, "r")) == 0)  0;

2247 i‡((
Â
 = 
	`f›í
(
p
, "w")) == 0) {

2248 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] faûÅÿ¸óã fûê'%s' i¿thêw‹kög dúe˘‹y\n", 
__func__
, 
p
);

2249 
	`h˛o£_abru±ly
(
Â_ªmŸe
);

2252 i‡(
hts_vîbo£
 >3Ë
	`Ârötf
(
°dîr
, "[M::%s] dow∆ﬂdög fûê'%s'Åÿloˇ»dúe˘‹y\n", 
__func__
, 
‚
);

2253 
buf
 = (
uöt8_t
*)
	`ˇŒoc
(
buf_size
, 1);

2254 (
l
 = 
	`hªad
(
Â_ªmŸe
, 
buf
, 
buf_size
)Ë> 0Ë
	`fwrôe
(buf, 1,Ü, 
Â
);

2255 
	`‰ì
(
buf
);

2256 
	`f˛o£
(
Â
);

2257 i‡(
	`h˛o£
(
Â_ªmŸe
Ë!0Ë
	`Ârötf
(
°dîr
, "[E::%s] faûÅÿ˛o£ÑemŸêfûê'%s'\n", 
__func__
, 
‚
);

2258  (*)
p
;

2260 
hFILE
 *
Â
;

2261 i‡((
Â
 = 
	`h›í
(
‚
, "r")) == 0)  0;

2262 
	`h˛o£_abru±ly
(
Â
);

2263  (*)
‚
;

2265 
	}
}

2267 *
	$hts_idx_gë‚
(c⁄° *
‚
, c⁄° *
ext
)

2269 
i
, 
l_‚
, 
l_ext
;

2270 *
‚idx
, *
ªt
;

2271 
l_‚
 = 
	`°æí
(
‚
); 
l_ext
 = såÀn(
ext
);

2272 
‚idx
 = (*)
	`ˇŒoc
(
l_‚
 + 
l_ext
 + 1, 1);

2273 
	`°r˝y
(
‚idx
, 
‚
); så˝y(‚idx + 
l_‚
, 
ext
);

2274 i‡((
ªt
 = 
	`ã°_™d_„tch
(
‚idx
)) == 0) {

2275 
i
 = 
l_‚
 - 1; i > 0; --i)

2276 i‡(
‚idx
[
i
] == '.') ;

2277 
	`°r˝y
(
‚idx
 + 
i
, 
ext
);

2278 
ªt
 = 
	`ã°_™d_„tch
(
‚idx
);

2280 i‡(
ªt
 == 0) {

2281 
	`‰ì
(
‚idx
);

2284 
l_‚
 = 
	`°æí
(
ªt
);

2285 
	`memmove
(
‚idx
, 
ªt
, 
l_‚
 + 1);

2286  
‚idx
;

2287 
	}
}

2289 
hts_idx_t
 *
	$hts_idx_lﬂd
(c⁄° *
‚
, 
fmt
)

2291 *
‚idx
;

2292 
hts_idx_t
 *
idx
;

2293 
‚idx
 = 
	`hts_idx_gë‚
(
‚
, ".csi");

2294 i‡(! 
‚idx
Ë‚idx = 
	`hts_idx_gë‚
(
‚
, 
fmt
 =
HTS_FMT_BAI
? ".bai" : ".tbi");

2295 i‡(
‚idx
 == 0)  0;

2297 
idx
 = 
	`hts_idx_lﬂd2
(
‚
, 
‚idx
);

2298 
	`‰ì
(
‚idx
);

2299  
idx
;

2300 
	}
}

2302 
hts_idx_t
 *
	$hts_idx_lﬂd2
(c⁄° *
‚
, c⁄° *
‚idx
)

2305 
°©
 
°©_idx
,
°©_maö
;

2306 i‡–!
	`°©
(
‚
, &
°©_maö
Ë&& !°©(
‚idx
, &
°©_idx
) )

2308 i‡–
hts_vîbo£
 >1 && 
°©_idx
.
°_mtime
 < 
°©_maö
.st_mtime )

2309 
	`Ârötf
(
°dîr
, "W¨nög: Thêödex fûêi†ﬁdîÅh™Åhêd©®fûe: %s\n", 
‚idx
);

2312  
	`hts_idx_lﬂd_loˇl
(
‚idx
);

2313 
	}
}

2322 
size_t
 
	$hts_ªÆloc_‹_dõ
(
size_t
 
n
, size_à
m
, size_à
m_sz
, size_à
size
,

2323 
˛ór
, **
±r
, c⁄° *
func
) {

2326 c⁄° 
size_t
 
ß„
 = (size_t) 1 << ((size_t) * 4);

2327 *
√w_±r
;

2328 
size_t
 
byãs
, 
√w_m
;

2330 
√w_m
 = 
n
;

2331 
	`kroundup_size_t
(
√w_m
);

2333 
byãs
 = 
size
 * 
√w_m
;

2338 i‡(
√w_m
 > (((
size_t
Ë1 << (
m_sz
 * 8 - 1)) - 1)

2339 || ((
size
 > 
ß„
 || 
√w_m
 > safe)

2340 && 
byãs
 / 
√w_m
 !
size
)) {

2341 
î∫o
 = 
ENOMEM
;

2342 
dõ
;

2345 
√w_±r
 = 
	`ªÆloc
(*
±r
, 
byãs
);

2346 i‡(
√w_±r
 =
NULL
Ë
dõ
;

2348 i‡(
˛ór
) {

2349 i‡(
√w_m
 > 
m
) {

2350 
	`mem£t
((*Ë
√w_±r
 + 
m
 * 
size
, 0, (
√w_m
 - m) * size);

2354 *
±r
 = 
√w_±r
;

2356  
√w_m
;

2358 
dõ
:

2359 i‡(
hts_vîbo£
 > 1)

2360 
	`Ârötf
(
°dîr
, "[E::%s] %s\n", 
func
, 
	`°ªº‹
(
î∫o
));

2361 
	`exô
(1);

2362 
	}
}

	@htslib/hts_internal.h

23 #i‚de‡
HTSLIB_HTS_INTERNAL_H


24 
	#HTSLIB_HTS_INTERNAL_H


	)

26 
	~<°ddef.h
>

27 
	~<˘y≥.h
>

29 
	~"ht¶ib/hts.h
"

31 #ifde‡
__˝lu•lus


35 
hFILE
;

43 
hts_decode_≥r˚¡
(*
de°
, 
size_t
 *
de°Àn
, c⁄° *
s
);

49 
size_t
 
hts_ba£64_decoded_Àngth
(size_à
Àn
);

56 
hts_decode_ba£64
(*
de°
, 
size_t
 *
de°Àn
, c⁄° *
s
);

70 
	shts_js⁄_tokí
 {

71 
ty≥
;

72 *
°r
;

76 } 
	thts_js⁄_tokí
;

89 
hts_js⁄_¢ext
(*
°r
, 
size_t
 *
°©e
, 
hts_js⁄_tokí
 *
tokí
);

101 
hts_js⁄_sskù_vÆue
(*
°r
, 
size_t
 *
°©e
, 
ty≥
);

113 
hts_js⁄_‚ext
(
hFILE
 *
Â
, 
hts_js⁄_tokí
 *
tokí
, 
k°rög_t
 *
k°r
);

124 
hts_js⁄_fskù_vÆue
(
hFILE
 *
Â
, 
ty≥
);

135 
ölöe
 
iß um_c
(
c
Ë{  
iß um
(() c); }

136 
ölöe
 
ißÕha_c
(
c
Ë{  
ißÕha
(() c); }

137 
ölöe
 
isdigô_c
(
c
Ë{  
isdigô
(() c); }

138 
ölöe
 
isgøph_c
(
c
Ë{  
isgøph
(() c); }

139 
ölöe
 
i¶owî_c
(
c
Ë{  
i¶owî
(() c); }

140 
ölöe
 
i•röt_c
(
c
Ë{  
i•röt
(() c); }

141 
ölöe
 
is•a˚_c
(
c
Ë{  
is•a˚
(() c); }

142 
ölöe
 
isuµî_c
(
c
Ë{  
isuµî
(() c); }

143 
ölöe
 
tﬁowî_c
(
c
Ë{  
tﬁowî
(() c); }

144 
ölöe
 
touµî_c
(
c
Ë{  
touµî
(() c); }

147 
¸am_fd
;

149 *
hts_idx_gë‚
(c⁄° *
‚
, c⁄° *
ext
);

155 
	shts_¸am_idx_t
 {

156 
fmt
;

157 
¸am_fd
 *
¸am
;

158 } 
	thts_¸am_idx_t
;

162 
hFILE
 *
h›í_js⁄_ªdúe˘
(hFILE *
hfûe
, c⁄° *
mode
);

165 
	shts_∑th_ôr
 {

166 
k°rög_t
 
∑th
, 
íåy
;

167 *
dúv
;

168 c⁄° *
∑thdú
, *
¥efix
, *
suffix
;

169 
size_t
 
¥efix_Àn
, 
suffix_Àn
, 
íåy_dú_l
;

172 
hts_∑th_ôr_£tup
(
hts_∑th_ôr
 *
ôr
, c⁄° *
∑th
,

173 c⁄° *
buûtö_∑th
, c⁄° *
¥efix
, 
size_t
 
¥efix_Àn
,

174 c⁄° *
suffix
, 
size_t
 
suffix_Àn
);

176 c⁄° *
hts_∑th_ôr_√xt
(
hts_∑th_ôr
 *
ôr
);

178 *
lﬂd_∂ugö
(**
∂ugöp
, c⁄° *
fûíame
, c⁄° *
symbﬁ
);

179 *
∂ugö_sym
(*
∂ugö
, c⁄° *
«me
, c⁄° **
îrmsg
);

180 
˛o£_∂ugö
(*
∂ugö
);

182 #ifde‡
__˝lu•lus


	@htslib/htsfile.c

25 
	~<c⁄fig.h
>

27 
	~<˘y≥.h
>

28 
	~<î∫o.h
>

29 
	~<°d¨g.h
>

30 
	~<°dio.h
>

31 
	~<°dlib.h
>

32 
	~<°rög.h
>

33 
	~<gë›t.h
>

34 
	~<uni°d.h
>

36 
	~"ht¶ib/hfûe.h
"

37 
	~"ht¶ib/hts.h
"

38 
	~"ht¶ib/ßm.h
"

39 
	~"ht¶ib/vcf.h
"

41 íum { 
	midítify
, 
	mvõw_hódîs
, 
	mvõw_Æl
 } 
	gmode
 = 
idítify
;

42 
	gshow_hódîs
 = 1;

43 
	gvîbo£
 = 0;

44 
	g°©us
 = 
EXIT_SUCCESS
;

46 
	$îr‹
(c⁄° *
f‹m©
, ...)

48 
îr
 = 
î∫o
;

49 
va_li°
 
¨gs
;

50 
	`va_°¨t
(
¨gs
, 
f‹m©
);

51 
	`fÊush
(
°dout
);

52 
	`Ârötf
(
°dîr
, "htsfile: ");

53 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨gs
);

54 i‡(
îr
Ë
	`Ârötf
(
°dîr
, ": %s\n", 
	`°ªº‹
(err));

55 
	`Ârötf
(
°dîr
, "\n");

56 
	`fÊush
(
°dîr
);

57 
	`va_íd
(
¨gs
);

58 
°©us
 = 
EXIT_FAILURE
;

59 
	}
}

61 
htsFûe
 *
	$dup_°dout
(c⁄° *
mode
)

63 
fd
 = 
	`dup
(
STDOUT_FILENO
);

64 
hFILE
 *
hÂ
 = (
fd
 >0)? 
	`hd›í
(fd, 
mode
Ë: 
NULL
;

65  
hÂ
? 
	`hts_h›í
(hÂ, "-", 
mode
Ë: 
NULL
;

66 
	}
}

68 
	$võw_ßm
(
ßmFûe
 *
ö
, c⁄° *
fûíame
)

70 
bam1_t
 *
b
 = 
NULL
;

71 
bam_hdr_t
 *
hdr
 = 
NULL
;

72 
ßmFûe
 *
out
 = 
NULL
;

74 
hdr
 = 
	`ßm_hdr_ªad
(
ö
);

75 i‡(
hdr
 =
NULL
) {

76 
î∫o
 = 0; 
	`îr‹
("ªadög hódî†‰om \"%s\" faûed", 
fûíame
);

77 
˛ón
;

80 
out
 = 
	`dup_°dout
("w");

81 i‡(
out
 =
NULL
Ë{ 
	`îr‹
("ª›íög sènd¨d ouçuàÁûed"); 
˛ón
; }

83 i‡(
show_hódîs
) {

84 i‡(
	`ßm_hdr_wrôe
(
out
, 
hdr
) != 0) {

85 
	`îr‹
("writing headersÅo standard output failed");

86 
˛ón
;

90 i‡(
mode
 =
võw_Æl
) {

91 
ªt
;

93 
b
 = 
	`bam_öô1
();

94 i‡(
b
 =
NULL
Ë{ 
	`îr‹
("ˇn'à¸óãÑec‹d"); 
˛ón
; }

96 (
ªt
 = 
	`ßm_ªad1
(
ö
, 
hdr
, 
b
)) >= 0) {

97 i‡(
	`ßm_wrôe1
(
out
, 
hdr
, 
b
) < 0) {

98 
	`îr‹
("writingÅo standard output failed");

99 
˛ón
;

103 i‡(
ªt
 < -1Ë{ 
	`îr‹
("ªadög \"%s\" faûed", 
fûíame
); 
˛ón
; }

106 
˛ón
:

107 
	`bam_hdr_de°roy
(
hdr
);

108 
	`bam_de°roy1
(
b
);

109 i‡(
out
Ë
	`hts_˛o£
(out);

110 
	}
}

112 
	$võw_vcf
(
vcfFûe
 *
ö
, c⁄° *
fûíame
)

114 
bcf1_t
 *
ªc
 = 
NULL
;

115 
bcf_hdr_t
 *
hdr
 = 
NULL
;

116 
vcfFûe
 *
out
 = 
NULL
;

118 
hdr
 = 
	`bcf_hdr_ªad
(
ö
);

119 i‡(
hdr
 =
NULL
) {

120 
î∫o
 = 0; 
	`îr‹
("ªadög hódî†‰om \"%s\" faûed", 
fûíame
);

121 
˛ón
;

124 
out
 = 
	`dup_°dout
("w");

125 i‡(
out
 =
NULL
Ë{ 
	`îr‹
("ª›íög sènd¨d ouçuàÁûed"); 
˛ón
; }

127 i‡(
show_hódîs
) {

128 i‡(
	`bcf_hdr_wrôe
(
out
, 
hdr
) != 0) {

129 
	`îr‹
("writing headersÅo standard output failed");

130 
˛ón
;

134 i‡(
mode
 =
võw_Æl
) {

135 
ªt
;

137 
ªc
 = 
	`bcf_öô
();

138 i‡(
ªc
 =
NULL
Ë{ 
	`îr‹
("ˇn'à¸óãÑec‹d"); 
˛ón
; }

140 (
ªt
 = 
	`bcf_ªad
(
ö
, 
hdr
, 
ªc
)) >= 0) {

141 i‡(
	`bcf_wrôe
(
out
, 
hdr
, 
ªc
) < 0) {

142 
	`îr‹
("writingÅo standard output failed");

143 
˛ón
;

147 i‡(
ªt
 < -1Ë{ 
	`îr‹
("ªadög \"%s\" faûed", 
fûíame
); 
˛ón
; }

150 
˛ón
:

151 i‡(
hdr
Ë
	`bcf_hdr_de°roy
(hdr);

152 i‡(
ªc
Ë
	`bcf_de°roy
(rec);

153 i‡(
out
Ë
	`hts_˛o£
(out);

154 
	}
}

156 
	$võw_øw
(
hFILE
 *
Â
, c⁄° *
fûíame
)

158 
c
, 
¥ev
;

159 
¥ev
 = '\n'; (
c
 = 
	`hgëc
(
Â
)Ë!
EOF
;Örev = c)

160 i‡(
	`i•röt
(
c
Ë|| c ='\n' || c ='\t'Ë
	`putch¨
(c);

161 i‡(
c
 ='\r'Ë
	`Âuts
("\\r", 
°dout
);

162 i‡(
c
 ='\0'Ë
	`Âuts
("\\0", 
°dout
);

163 
	`¥ötf
("\\x%02x", 
c
);

165 i‡(
¥ev
 !'\n'Ë
	`putch¨
('\n');

167 i‡(
	`hî∫o
(
Â
)) {

168 
î∫o
 = 
	`hî∫o
(
Â
);

169 
	`îr‹
("ªadög \"%s\" faûed", 
fûíame
);

171 
	}
}

173 
	$ußge
(
FILE
 *
Â
, 
°©us
)

175 
	`Ârötf
(
Â
,

182 
	`exô
(
°©us
);

183 
	}
}

185 
	$maö
(
¨gc
, **
¨gv
)

187 c⁄° 
›ti⁄
 
›ti⁄s
[] = {

188 { "hódî-⁄ly", 
no_¨gumít
, 
NULL
, 'h' },

189 { "no-hódî", 
no_¨gumít
, 
NULL
, 'H' },

190 { "võw", 
no_¨gumít
, 
NULL
, 'c' },

191 { "vîbo£", 
no_¨gumít
, 
NULL
, 'v' },

192 { "hñp", 
no_¨gumít
, 
NULL
, '?' },

193 { "vîsi⁄", 
no_¨gumít
, 
NULL
, 1 },

194 { 
NULL
, 0, NULL, 0 }

197 
c
, 
i
;

199 
°©us
 = 
EXIT_SUCCESS
;

200 (
c
 = 
	`gë›t_l⁄g
(
¨gc
, 
¨gv
, "chHv?", 
›ti⁄s
, 
NULL
)) >= 0)

201 
c
) {

202 'c': 
mode
 = 
võw_Æl
; ;

203 'h': 
mode
 = 
võw_hódîs
; 
show_hódîs
 = 1; ;

204 'H': 
show_hódîs
 = 0; ;

205 'v': 
hts_vîbo£
++; 
vîbo£
++; ;

207 
	`¥ötf
(

210 
	`hts_vîsi⁄
());

211 
	`exô
(
EXIT_SUCCESS
);

213 '?': 
	`ußge
(
°dout
, 
EXIT_SUCCESS
); ;

214 : 
	`ußge
(
°dîr
, 
EXIT_FAILURE
); ;

217 i‡(
›töd
 =
¨gc
Ë
	`ußge
(
°dîr
, 
EXIT_FAILURE
);

219 
i
 = 
›töd
; i < 
¨gc
; i++) {

220 
hFILE
 *
Â
 = 
	`h›í
(
¨gv
[
i
], "r");

221 i‡(
Â
 =
NULL
) {

222 
	`îr‹
("ˇn'à›í \"%s\"", 
¨gv
[
i
]);

226 i‡(
mode
 =
idítify
) {

227 
htsF‹m©
 
fmt
;

228 i‡(
	`hts_dëe˘_f‹m©
(
Â
, &
fmt
) < 0) {

229 
	`îr‹
("dëe˘ög \"%s\" f‹m© faûed", 
¨gv
[
i
]);

230 
	`h˛o£_abru±ly
(
Â
);

234 *
des¸ùti⁄
 = 
	`hts_f‹m©_des¸ùti⁄
(&
fmt
);

235 
	`¥ötf
("%s:\t%s\n", 
¨gv
[
i
], 
des¸ùti⁄
);

236 
	`‰ì
(
des¸ùti⁄
);

239 
htsFûe
 *
hts
 = 
	`hts_h›í
(
Â
, 
¨gv
[
i
], "r");

240 i‡(
hts
) {

241 
	`hts_gë_f‹m©
(
hts
)->
ˇãg‹y
) {

242 
£quí˚_d©a
:

243 
	`võw_ßm
(
hts
, 
¨gv
[
i
]);

245 
v¨ü¡_d©a
:

246 
	`võw_vcf
(
hts
, 
¨gv
[
i
]);

249 i‡(
vîbo£
)

250 
	`võw_øw
(
Â
, 
¨gv
[
i
]);

252 
î∫o
 = 0;

253 
	`îr‹
("ˇn'àvõw \"%s\": unknow¿f‹m©", 
¨gv
[
i
]);

258 i‡(
	`hts_˛o£
(
hts
Ë< 0Ë
	`îr‹
("˛osög \"%s\" faûed", 
¨gv
[
i
]);

259 
Â
 = 
NULL
;

261 i‡(
î∫o
 =
ENOEXEC
 && 
vîbo£
)

262 
	`võw_øw
(
Â
, 
¨gv
[
i
]);

264 
	`îr‹
("ˇn'àvõw \"%s\"", 
¨gv
[
i
]);

267 i‡(
Â
 && 
	`h˛o£
(ÂË< 0Ë
	`îr‹
("˛osög \"%s\" faûed", 
¨gv
[
i
]);

270  
°©us
;

271 
	}
}

	@htslib/htslib/bgzf.h

30 #i‚de‡
HTSLIB_BGZF_H


31 
	#HTSLIB_BGZF_H


	)

33 
	~<°döt.h
>

34 
	~<°dio.h
>

35 
	~<zlib.h
>

36 
	~<sys/ty≥s.h
>

38 
	~"hts_defs.h
"

40 #ifde‡
__˝lu•lus


44 
	#BGZF_BLOCK_SIZE
 0xff00

45 
	#BGZF_MAX_BLOCK_SIZE
 0x10000

	)

47 
	#BGZF_ERR_ZLIB
 1

	)

48 
	#BGZF_ERR_HEADER
 2

	)

49 
	#BGZF_ERR_IO
 4

	)

50 
	#BGZF_ERR_MISUSE
 8

	)

51 
	#BGZF_ERR_MT
 16

52 

	)

53 
hFILE
;

54 
hts_çoﬁ
;

55 
bgzf_mèux_t
;

56 
__bgzidx_t
 
	tbgzidx_t
;

58 
	sBGZF
 {

60 
îrcode
:16, 
ª£rved
:1, 
is_wrôe
:1, 
no_eof_block
:1, 
is_be
:1;

61 sig√d 
com¥ess_Àvñ
:9;

62 
œ°_block_eof
:1, 
is_com¥es£d
:1, 
is_gzù
:1;

63 
ˇche_size
;

64 
block_Àngth
, 
block_˛ígth
, 
block_off£t
;

65 
öt64_t
 
block_addªss
, 
uncom¥es£d_addªss
;

66 *
uncom¥es£d_block
, *
com¥es£d_block
;

67 *
ˇche
;

68 
hFILE
 *
Â
;

69 
bgzf_mèux_t
 *
mt
;

70 
bgzidx_t
 *
idx
;

71 
idx_buûd_Ÿf
;

72 
z_°ªam
 *
gz_°ªam
;

74 #i‚de‡
HTS_BGZF_TYPEDEF


75 
BGZF
 
	tBGZF
;

76 
	#HTS_BGZF_TYPEDEF


	)

79 #i‚de‡
KSTRING_T


80 
	#KSTRING_T
 
k°rög_t


	)

81 
	s__k°rög_t
 {

82 
size_t
 
l
, 
m
;

83 *
s
;

84 } 
	tk°rög_t
;

104 
BGZF
* 
bgzf_d›í
(
fd
, c⁄° *
mode
);

106 
	#bgzf_fd›í
(
fd
, 
mode
Ë
	`bgzf_d›í
((fd), (mode))

107 

	)

111 
BGZF
* 
bgzf_›í
(c⁄° * 
∑th
, c⁄° *
mode
);

116 
BGZF
* 
bgzf_h›í
(
hFILE
 *
Â
, c⁄° *
mode
);

124 
bgzf_˛o£
(
BGZF
 *
Â
);

134 
ssize_t
 
bgzf_ªad
(
BGZF
 *
Â
, *
d©a
, 
size_t
 
Àngth
Ë
HTS_RESULT_USED
;

145 
ssize_t
 
bgzf_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
Ë
HTS_RESULT_USED
;

157 
ssize_t
 
bgzf_block_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
);

169 
ssize_t
 
bgzf_øw_ªad
(
BGZF
 *
Â
, *
d©a
, 
size_t
 
Àngth
Ë
HTS_RESULT_USED
;

181 
ssize_t
 
bgzf_øw_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
Ë
HTS_RESULT_USED
;

189 
bgzf_Êush
(
BGZF
 *
Â
Ë
HTS_RESULT_USED
;

197 
	#bgzf_ãŒ
(
Â
Ë(((Â)->
block_addªss
 << 16Ë| ((Â)->
block_off£t
 & 0xFFFF))

	)

207 
öt64_t
 
bgzf_£ek
(
BGZF
 *
Â
, i¡64_à
pos
, 
whí˚
Ë
HTS_RESULT_USED
;

218 
bgzf_check_EOF
(
BGZF
 *
Â
);

230 
bgzf_com¥essi⁄
(
BGZF
 *
Â
);

238 
bgzf_is_bgzf
(c⁄° *
‚
Ë
HTS_DEPRECATED
("Use bgzf_compression() or hts_detect_format() instead");

250 
bgzf_£t_ˇche_size
(
BGZF
 *
Â
, 
size
);

256 
bgzf_Êush_åy
(
BGZF
 *
Â
, 
ssize_t
 
size
Ë
HTS_RESULT_USED
;

263 
bgzf_gëc
(
BGZF
 *
Â
);

273 
bgzf_gëlöe
(
BGZF
 *
Â
, 
dñim
, 
k°rög_t
 *
°r
);

278 
bgzf_ªad_block
(
BGZF
 *
Â
Ë
HTS_RESULT_USED
;

288 
bgzf_thªad_poﬁ
(
BGZF
 *
Â
, 
hts_çoﬁ
 *
poﬁ
, 
qsize
);

298 
bgzf_mt
(
BGZF
 *
Â
, 
n_thªads
, 
n_sub_blks
);

311 
bgzf_com¥ess
(*
d°
, 
size_t
 *
dÀn
, c⁄° *
§c
, size_à
¶í
, 
Àvñ
);

326 
bgzf_u£ek
(
BGZF
 *
Â
, 
uoff£t
, 
whîe
Ë
HTS_RESULT_USED
;

335 
bgzf_uãŒ
(
BGZF
 *
Â
);

344 
bgzf_ödex_buûd_öô
(
BGZF
 *
Â
);

353 
bgzf_ödex_lﬂd
(
BGZF
 *
Â
,

354 c⁄° *
b«me
, c⁄° *
suffix
Ë
HTS_RESULT_USED
;

371 
bgzf_ödex_lﬂd_hfûe
(
BGZF
 *
Â
, 
hFILE
 *
idx
,

372 c⁄° *
«me
Ë
HTS_RESULT_USED
;

381 
bgzf_ödex_dump
(
BGZF
 *
Â
,

382 c⁄° *
b«me
, c⁄° *
suffix
Ë
HTS_RESULT_USED
;

398 
bgzf_ödex_dump_hfûe
(
BGZF
 *
Â
, 
hFILE
 *
idx
,

399 c⁄° *
«me
Ë
HTS_RESULT_USED
;

401 #ifde‡
__˝lu•lus


	@htslib/htslib/cram.h

35 #i‚de‡
HTSLIB_CRAM_H


36 
	#HTSLIB_CRAM_H


	)

38 
	~<°d¨g.h
>

39 
	~<°döt.h
>

40 
	~<sys/ty≥s.h
>

42 
	~"hts.h
"

44 #ifde‡
__˝lu•lus


48 #i‚de‡
_CRAM_STRUCTS_H_


49 
	e¸am_block_mëhod
 {

50 
ERROR
 = -1,

51 
RAW
 = 0,

52 
GZIP
 = 1,

53 
BZIP2
 = 2,

54 
LZMA
 = 3,

55 
RANS
 = 4,

56 
RANS0
 = 4,

57 
RANS1
 = 10,

58 
GZIP_RLE
 = 11,

61 
	e¸am_c⁄ã¡_ty≥
 {

62 
	mCT_ERROR
 = -1,

63 
	mFILE_HEADER
 = 0,

64 
	mCOMPRESSION_HEADER
 = 1,

65 
	mMAPPED_SLICE
 = 2,

66 
	mUNMAPPED_SLICE
 = 3,

67 
	mEXTERNAL
 = 4,

68 
	mCORE
 = 5,

72 
SAM_hdr
 
	tSAM_hdr
;

73 
¸am_fûe_def
 
	t¸am_fûe_def
;

74 
¸am_fd
 
	t¸am_fd
;

75 
¸am_c⁄èöî
 
	t¸am_c⁄èöî
;

76 
¸am_block
 
	t¸am_block
;

77 
¸am_¶i˚
 
	t¸am_¶i˚
;

78 
¸am_mërics
 
	t¸am_mërics
;

79 
¸am_block_¶i˚_hdr
 
	t¸am_block_¶i˚_hdr
;

80 
¸am_block_com¥essi⁄_hdr
 
	t¸am_block_com¥essi⁄_hdr
;

81 
ªfs_t
 
	tªfs_t
;

83 
	ghFILE
;

92 
SAM_hdr
 *
¸am_fd_gë_hódî
(
¸am_fd
 *
fd
);

93 
¸am_fd_£t_hódî
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
);

95 
¸am_fd_gë_vîsi⁄
(
¸am_fd
 *
fd
);

96 
¸am_fd_£t_vîsi⁄
(
¸am_fd
 *
fd
, 
vîs
);

98 
¸am_maj‹_vîs
(
¸am_fd
 *
fd
);

99 
¸am_mö‹_vîs
(
¸am_fd
 *
fd
);

101 
hFILE
 *
¸am_fd_gë_Â
(
¸am_fd
 *
fd
);

102 
¸am_fd_£t_Â
(
¸am_fd
 *
fd
, 
hFILE
 *
Â
);

109 
öt32_t
 
¸am_c⁄èöî_gë_Àngth
(
¸am_c⁄èöî
 *
c
);

110 
¸am_c⁄èöî_£t_Àngth
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 
Àngth
);

111 
öt32_t
 
¸am_c⁄èöî_gë_num_blocks
(
¸am_c⁄èöî
 *
c
);

112 
¸am_c⁄èöî_£t_num_blocks
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 
num_blocks
);

113 
öt32_t
 *
¸am_c⁄èöî_gë_œndm¨ks
(
¸am_c⁄èöî
 *
c
, i¡32_à*
num_œndm¨ks
);

114 
¸am_c⁄èöî_£t_œndm¨ks
(
¸am_c⁄èöî
 *
c
, 
öt32_t
 
num_œndm¨ks
,

115 
öt32_t
 *
œndm¨ks
);

118 
¸am_c⁄èöî_is_em±y
(
¸am_fd
 *
fd
);

125 
öt32_t
 
¸am_block_gë_c⁄ã¡_id
(
¸am_block
 *
b
);

126 
öt32_t
 
¸am_block_gë_comp_size
(
¸am_block
 *
b
);

127 
öt32_t
 
¸am_block_gë_uncomp_size
(
¸am_block
 *
b
);

128 
öt32_t
 
¸am_block_gë_¸c32
(
¸am_block
 *
b
);

129 * 
¸am_block_gë_d©a
(
¸am_block
 *
b
);

131 
¸am_c⁄ã¡_ty≥
 
¸am_block_gë_c⁄ã¡_ty≥
(
¸am_block
 *
b
);

133 
¸am_block_£t_c⁄ã¡_id
(
¸am_block
 *
b
, 
öt32_t
 
id
);

134 
¸am_block_£t_comp_size
(
¸am_block
 *
b
, 
öt32_t
 
size
);

135 
¸am_block_£t_uncomp_size
(
¸am_block
 *
b
, 
öt32_t
 
size
);

136 
¸am_block_£t_¸c32
(
¸am_block
 *
b
, 
öt32_t
 
¸c
);

137 
¸am_block_£t_d©a
(
¸am_block
 *
b
, *
d©a
);

139 
¸am_block_≠≥nd
(
¸am_block
 *
b
, *
d©a
, 
size
);

140 
¸am_block_upd©e_size
(
¸am_block
 *
b
);

143 
size_t
 
¸am_block_gë_off£t
(
¸am_block
 *
b
);

144 
¸am_block_£t_off£t
(
¸am_block
 *
b
, 
size_t
 
off£t
);

150 
uöt32_t
 
¸am_block_size
(
¸am_block
 *
b
);

182 
¸am_å™scode_rg
(
¸am_fd
 *
ö
, cøm_fd *
out
,

183 
¸am_c⁄èöî
 *
c
,

184 
ƒg
, *
ö_rg
, *
out_rg
);

195 
¸am_c›y_¶i˚
(
¸am_fd
 *
ö
, cøm_fd *
out
, 
öt32_t
 
num_¶i˚
);

210 
SAM_hdr
 *
ßm_hdr_∑r£_
(c⁄° *
hdr
, 
Àn
);

233 
¸am_block
 *
¸am_√w_block
(
¸am_c⁄ã¡_ty≥
 
c⁄ã¡_ty≥
,

234 
c⁄ã¡_id
);

242 
¸am_block
 *
¸am_ªad_block
(
¸am_fd
 *
fd
);

250 
¸am_wrôe_block
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
);

254 
¸am_‰ì_block
(
¸am_block
 *
b
);

262 
¸am_uncom¥ess_block
(
¸am_block
 *
b
);

277 
¸am_com¥ess_block
(
¸am_fd
 *
fd
, 
¸am_block
 *
b
, 
¸am_mërics
 *
mërics
,

278 
mëhod
, 
Àvñ
);

292 
¸am_c⁄èöî
 *
¸am_√w_c⁄èöî
(
ƒec
, 
n¶i˚
);

293 
¸am_‰ì_c⁄èöî
(
¸am_c⁄èöî
 *
c
);

301 
¸am_c⁄èöî
 *
¸am_ªad_c⁄èöî
(
¸am_fd
 *
fd
);

309 
¸am_wrôe_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
h
);

319 
¸am_°‹e_c⁄èöî
(
¸am_fd
 *
fd
, 
¸am_c⁄èöî
 *
c
, *
d©
, *
size
);

321 
¸am_c⁄èöî_size
(
¸am_c⁄èöî
 *
c
);

336 
¸am_fd
 *
¸am_›í
(c⁄° *
fûíame
, c⁄° *
mode
);

344 
¸am_fd
 *
¸am_d›í
(
hFILE
 *
Â
, c⁄° *
fûíame
, c⁄° *
mode
);

352 
¸am_˛o£
(
¸am_fd
 *
fd
);

360 
¸am_£ek
(
¸am_fd
 *
fd
, 
off_t
 
off£t
, 
whí˚
);

369 
¸am_Êush
(
¸am_fd
 *
fd
);

378 
¸am_eof
(
¸am_fd
 *
fd
);

389 
¸am_£t_›ti⁄
(
¸am_fd
 *
fd
, 
hts_fmt_›ti⁄
 
›t
, ...);

400 
¸am_£t_v›ti⁄
(
¸am_fd
 *
fd
, 
hts_fmt_›ti⁄
 
›t
, 
va_li°
 
¨gs
);

413 
¸am_£t_hódî
(
¸am_fd
 *
fd
, 
SAM_hdr
 *
hdr
);

425 
¸am_check_EOF
(
¸am_fd
 *
fd
);

428 
öt32_put_blk
(
¸am_block
 *
b
, 
öt32_t
 
vÆ
);

440 
ßm_hdr_‰ì
(
SAM_hdr
 *
hdr
);

446 
ßm_hdr_Àngth
(
SAM_hdr
 *
hdr
);

452 *
ßm_hdr_°r
(
SAM_hdr
 *
hdr
);

484 
ßm_hdr_add_PG
(
SAM_hdr
 *
sh
, c⁄° *
«me
, ...);

495 *
°rögify_¨gv
(
¨gc
, *
¨gv
[]);

507 
ªfs_t
 *
¸am_gë_ªfs
(
htsFûe
 *
fd
);

511 #ifde‡
__˝lu•lus


	@htslib/htslib/faidx.h

29 #i‚de‡
HTSLIB_FAIDX_H


30 
	#HTSLIB_FAIDX_H


	)

32 
	~"hts_defs.h
"

34 #ifde‡
__˝lu•lus


52 
__Áidx_t
;

54 
__Áidx_t
 
	tÁidx_t
;

66 
Ái_buûd3
(c⁄° *
‚
, c⁄° *
‚Ái
, c⁄° *
‚gzi
Ë
HTS_RESULT_USED
;

75 
Ái_buûd
(c⁄° *
‚
Ë
HTS_RESULT_USED
;

78 
Ái_de°roy
(
Áidx_t
 *
Ái
);

80 
	eÁi_lﬂd_›ti⁄s
 {

81 
FAI_CREATE
 = 0x01,

98 
Áidx_t
 *
Ái_lﬂd3
(c⁄° *
‚
, c⁄° *
‚Ái
, c⁄° *
‚gzi
,

99 
Êags
);

107 
Áidx_t
 *
Ái_lﬂd
(c⁄° *
‚
);

118 *
Ái_„tch
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
ªg
, *
Àn
);

124 
Áidx_„tch_n£q
(c⁄° 
Áidx_t
 *
Ái
Ë
HTS_DEPRECATED
("Please use faidx_nseq instead");

137 *
Áidx_„tch_£q
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
c_«me
, 
p_beg_i
, 
p_íd_i
, *
Àn
);

144 
Áidx_has_£q
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
£q
);

147 
Áidx_n£q
(c⁄° 
Áidx_t
 *
Ái
);

150 c⁄° *
Áidx_i£q
(c⁄° 
Áidx_t
 *
Ái
, 
i
);

153 
Áidx_£q_Àn
(c⁄° 
Áidx_t
 *
Ái
, c⁄° *
£q
);

155 #ifde‡
__˝lu•lus


	@htslib/htslib/hfile.h

26 #i‚de‡
HTSLIB_HFILE_H


27 
	#HTSLIB_HFILE_H


	)

29 
	~<°rög.h
>

31 
	~<sys/ty≥s.h
>

33 
	~"hts_defs.h
"

35 #ifde‡
__˝lu•lus


39 
hFILE_backíd
;

46 
	shFILE
 {

48 *
buf„r
, *
begö
, *
íd
, *
limô
;

49 c⁄° 
hFILE_backíd
 *
backíd
;

50 
off_t
 
off£t
;

51 
©_eof
:1, 
mobûe
:1, 
ªad⁄ly
:1;

52 
has_î∫o
;

54 } 
	thFILE
;

64 
hFILE
 *
h›í
(c⁄° *
fûíame
, c⁄° *
mode
, ...Ë
HTS_RESULT_USED
;

71 
hFILE
 *
hd›í
(
fd
, c⁄° *
mode
Ë
HTS_RESULT_USED
;

79 
hi§emŸe
(c⁄° *
fûíame
Ë
HTS_RESULT_USED
;

84 
h˛o£
(
hFILE
 *
Â
Ë
HTS_RESULT_USED
;

89 
h˛o£_abru±ly
(
hFILE
 *
Â
);

97 
ölöe
 
hî∫o
(
hFILE
 *
Â
)

99  
Â
->
has_î∫o
;

103 
ölöe
 
h˛óªº
(
hFILE
 *
Â
)

105 
Â
->
has_î∫o
 = 0;

112 
off_t
 
h£ek
(
hFILE
 *
Â
, off_à
off£t
, 
whí˚
Ë
HTS_RESULT_USED
;

117 
ölöe
 
off_t
 
hãŒ
(
hFILE
 *
Â
)

119  
Â
->
off£t
 + (Â->
begö
 - fp->
buf„r
);

125 
ölöe
 
hgëc
(
hFILE
 *
Â
)

127 
hgëc2
(
hFILE
 *);

128  (
	gÂ
->
	gíd
 > fp->
	gbegö
)? (Ë*(Â->begö++Ë: 
hgëc2
(
Â
);

143 
ssize_t
 
hgëdñim
(*
buf„r
, 
size_t
 
size
, 
dñim
, 
hFILE
 *
Â
)

144 
	gHTS_RESULT_USED
;

155 
ölöe
 
ssize_t
 
HTS_RESULT_USED


156 
hgë 
(*
buf„r
, 
size_t
 
size
, 
hFILE
 *
Â
)

158  
hgëdñim
(
buf„r
, 
size
, '\n', 
Â
);

171 *
hgës
(*
buf„r
, 
size
, 
hFILE
 *
Â
Ë
	gHTS_RESULT_USED
;

184 
ssize_t
 
h≥ek
(
hFILE
 *
Â
, *
buf„r
, 
size_t
 
nbyãs
Ë
	gHTS_RESULT_USED
;

192 
ölöe
 
ssize_t
 
HTS_RESULT_USED


193 
hªad
(
hFILE
 *
Â
, *
buf„r
, 
size_t
 
nbyãs
)

195 
ssize_t
 
hªad2
(
hFILE
 *, *, 
size_t
, size_t);

197 
size_t
 
	gn
 = 
Â
->
íd
 - fp->
begö
;

198 i‡(
	gn
 > 
	gnbyãs
Ë¿
nbyãs
;

199 
mem˝y
(
buf„r
, 
Â
->
begö
, 
n
);

200 
	gÂ
->
	gbegö
 +
n
;

201  (
	gn
 =
nbyãs
)? (
ssize_t
Ë
n
 : 
hªad2
(
Â
, 
buf„r
,Çbytes,Ç);

207 
ölöe
 
hputc
(
c
, 
hFILE
 *
Â
)

209 
hputc2
(, 
hFILE
 *);

210 i‡(
	gÂ
->
	gbegö
 < fp->
	glimô
Ë*(Â->begö++Ë
c
;

211 
	gc
 = 
hputc2
(
c
, 
Â
);

212  
	gc
;

218 
ölöe
 
hputs
(c⁄° *
ãxt
, 
hFILE
 *
Â
)

220 
hputs2
(c⁄° *, 
size_t
, size_t, 
hFILE
 *);

222 
size_t
 
	gnbyãs
 = 
°æí
(
ãxt
), 
	gn
 = 
Â
->
limô
 - fp->
begö
;

223 i‡(
	gn
 > 
	gnbyãs
Ë¿
nbyãs
;

224 
mem˝y
(
Â
->
begö
, 
ãxt
, 
n
);

225 
	gÂ
->
	gbegö
 +
n
;

226  (
	gn
 =
nbyãs
)? 0 : 
hputs2
(
ãxt
,Çbyãs, 
n
, 
Â
);

234 
ölöe
 
ssize_t
 
HTS_RESULT_USED


235 
hwrôe
(
hFILE
 *
Â
, c⁄° *
buf„r
, 
size_t
 
nbyãs
)

237 
ssize_t
 
hwrôe2
(
hFILE
 *, c⁄° *, 
size_t
, size_t);

239 
size_t
 
	gn
 = 
Â
->
limô
 - fp->
begö
;

240 i‡(
	gn
 > 
	gnbyãs
Ë¿
nbyãs
;

241 
mem˝y
(
Â
->
begö
, 
buf„r
, 
n
);

242 
	gÂ
->
	gbegö
 +
n
;

243  (
	gn
==
nbyãs
)? (
ssize_t
Ë
n
 : 
hwrôe2
(
Â
, 
buf„r
,Çbytes,Ç);

251 
hÊush
(
hFILE
 *
Â
Ë
	gHTS_RESULT_USED
;

253 #ifde‡
__˝lu•lus


	@htslib/htslib/hts.h

28 #i‚de‡
HTSLIB_HTS_H


29 
	#HTSLIB_HTS_H


	)

31 
	~<°ddef.h
>

32 
	~<°döt.h
>

34 
	~"hts_defs.h
"

36 #ifde‡
__˝lu•lus


40 #i‚de‡
HTS_BGZF_TYPEDEF


41 
BGZF
 
	tBGZF
;

42 
	#HTS_BGZF_TYPEDEF


	)

44 
	g¸am_fd
;

45 
	ghFILE
;

46 
	ghts_çoﬁ
;

48 #i‚de‡
KSTRING_T


49 
	#KSTRING_T
 
k°rög_t


	)

50 
	s__k°rög_t
 {

51 
size_t
 
	gl
, 
	gm
;

52 *
	gs
;

53 } 
	tk°rög_t
;

56 #i‚de‡
kroundup32


57 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

81 
	#hts_ex∑nd
(
ty≥_t
, 
n
, 
m
, 
±r
) do { \

82 i‡((
n
Ë> (
m
)) { \

83 
size_t
 
	`hts_ªÆloc_‹_dõ
(size_t, size_t, size_t, size_t, \

85 (
m
Ë
	`hts_ªÆloc_‹_dõ
((
n
) >= 1 ? (n) : 1, (m), (m), \

86 (
ty≥_t
), 0, \

87 (**)&(
±r
), 
__func__
); \

89 } 0)

	)

110 
	#hts_ex∑nd0
(
ty≥_t
, 
n
, 
m
, 
±r
) do { \

111 i‡((
n
Ë> (
m
)) { \

112 
size_t
 
	`hts_ªÆloc_‹_dõ
(size_t, size_t, size_t, size_t, \

114 (
m
Ë
	`hts_ªÆloc_‹_dõ
((
n
) >= 1 ? (n) : 1, (m), (m), \

115 (
ty≥_t
), 1, \

116 (**)&(
±r
), 
__func__
); \

118 } 0)

	)

127 
	ehtsF‹m©C©eg‹y
 {

128 
	gunknown_ˇãg‹y
,

129 
	g£quí˚_d©a
,

130 
	gv¨ü¡_d©a
,

131 
	gödex_fûe
,

132 
	gªgi⁄_li°
,

133 
	gˇãg‹y_maximum
 = 32767

136 
	ehtsExa˘F‹m©
 {

137 
	gunknown_f‹m©
,

138 
	gbö¨y_f‹m©
, 
	gãxt_f‹m©
,

139 
	gßm
, 
	gbam
, 
	gbai
, 
	g¸am
, 
	g¸ai
, 
	gvcf
, 
	gbcf
, 
	gcsi
, 
	ggzi
, 
	gtbi
, 
	gbed
,

140 
	gjs⁄
,

141 
	gf‹m©_maximum
 = 32767

144 
	ehtsCom¥essi⁄
 {

145 
	gno_com¥essi⁄
, 
	ggzù
, 
	gbgzf
, 
	gcu°om
,

146 
	gcom¥essi⁄_maximum
 = 32767

149 
	shtsF‹m©
 {

150 
htsF‹m©C©eg‹y
 
	gˇãg‹y
;

151 
htsExa˘F‹m©
 
	gf‹m©
;

152 °ru˘ { 
	gmaj‹
, 
	gmö‹
; } 
	gvîsi⁄
;

153 
htsCom¥essi⁄
 
	gcom¥essi⁄
;

154 
	gcom¥essi⁄_Àvñ
;

155 *
	g•ecific
;

156 } 
	thtsF‹m©
;

166 
uöt32_t
 
	gis_bö
:1, 
	gis_wrôe
:1, 
	gis_be
:1, 
	gis_¸am
:1, 
	gis_bgzf
:1, 
	gdummy
:27;

167 
öt64_t
 
	glöío
;

168 
k°rög_t
 
	glöe
;

169 *
	g‚
, *
	g‚_aux
;

171 
BGZF
 *
	gbgzf
;

172 
¸am_fd
 *
	g¸am
;

173 
hFILE
 *
	ghfûe
;

174 } 
	gÂ
;

175 
htsF‹m©
 
	gf‹m©
;

176 } 
	thtsFûe
;

186 
hts_çoﬁ
 *
	gpoﬁ
;

187 
	gqsize
;

188 } 
	thtsThªadPoﬁ
;

191 
	eßm_fõlds
 {

192 
	gSAM_QNAME
 = 0x00000001,

193 
	gSAM_FLAG
 = 0x00000002,

194 
	gSAM_RNAME
 = 0x00000004,

195 
	gSAM_POS
 = 0x00000008,

196 
	gSAM_MAPQ
 = 0x00000010,

197 
	gSAM_CIGAR
 = 0x00000020,

198 
	gSAM_RNEXT
 = 0x00000040,

199 
	gSAM_PNEXT
 = 0x00000080,

200 
	gSAM_TLEN
 = 0x00000100,

201 
	gSAM_SEQ
 = 0x00000200,

202 
	gSAM_QUAL
 = 0x00000400,

203 
	gSAM_AUX
 = 0x00000800,

204 
	gSAM_RGAUX
 = 0x00001000,

208 
	ehts_fmt_›ti⁄
 {

210 
	gCRAM_OPT_DECODE_MD
,

211 
	gCRAM_OPT_PREFIX
,

212 
	gCRAM_OPT_VERBOSITY
,

213 
	gCRAM_OPT_SEQS_PER_SLICE
,

214 
	gCRAM_OPT_SLICES_PER_CONTAINER
,

215 
	gCRAM_OPT_RANGE
,

216 
	gCRAM_OPT_VERSION
,

217 
	gCRAM_OPT_EMBED_REF
,

218 
	gCRAM_OPT_IGNORE_MD5
,

219 
	gCRAM_OPT_REFERENCE
,

220 
	gCRAM_OPT_MULTI_SEQ_PER_SLICE
,

221 
	gCRAM_OPT_NO_REF
,

222 
	gCRAM_OPT_USE_BZIP2
,

223 
	gCRAM_OPT_SHARED_REF
,

224 
	gCRAM_OPT_NTHREADS
,

225 
	gCRAM_OPT_THREAD_POOL
,

226 
	gCRAM_OPT_USE_LZMA
,

227 
	gCRAM_OPT_USE_RANS
,

228 
	gCRAM_OPT_REQUIRED_FIELDS
,

229 
	gCRAM_OPT_LOSSY_NAMES
,

230 
	gCRAM_OPT_BASES_PER_SLICE
,

233 
	gHTS_OPT_COMPRESSION_LEVEL
 = 100,

234 
	gHTS_OPT_NTHREADS
,

235 
	gHTS_OPT_THREAD_POOL
,

236 
	gHTS_OPT_CACHE_SIZE
,

240 
	#¸am_›ti⁄
 
hts_fmt_›ti⁄


	)

242 
	shts_›t
 {

243 *
	g¨g
;

244 
hts_fmt_›ti⁄
 
	g›t
;

246 
	gi
;

247 *
	gs
;

248 } 
	gvÆ
;

249 
hts_›t
 *
	g√xt
;

250 } 
	thts_›t
;

252 
	#HTS_FILE_OPTS_INIT
 {{0},0}

	)

264 
hts_›t_add
(
hts_›t
 **
›ts
, c⁄° *
c_¨g
);

272 
hts_›t_≠∂y
(
htsFûe
 *
Â
, 
hts_›t
 *
›ts
);

277 
hts_›t_‰ì
(
hts_›t
 *
›ts
);

287 
hts_∑r£_f‹m©
(
htsF‹m©
 *
›t
, c⁄° *
°r
);

300 
hts_∑r£_›t_li°
(
htsF‹m©
 *
›t
, c⁄° *
°r
);

302 
hts_vîbo£
;

309 c⁄° 
£q_¡16_èbÀ
[256];

314 c⁄° 
£q_¡16_°r
[];

319 c⁄° 
£q_¡16_öt
[];

326 c⁄° *
hts_vîsi⁄
();

334 
hts_dëe˘_f‹m©
(
hFILE
 *
Â
, 
htsF‹m©
 *
fmt
);

341 *
hts_f‹m©_des¸ùti⁄
(c⁄° 
htsF‹m©
 *
f‹m©
);

370 
htsFûe
 *
hts_›í
(c⁄° *
‚
, c⁄° *
mode
);

386 
htsFûe
 *
hts_›í_f‹m©
(c⁄° *
‚
, c⁄° *
mode
, c⁄° 
htsF‹m©
 *
fmt
);

393 
htsFûe
 *
hts_h›í
(
hFILE
 *
Â
, c⁄° *
‚
, c⁄° *
mode
);

400 
hts_˛o£
(
htsFûe
 *
Â
);

407 c⁄° 
htsF‹m©
 *
hts_gë_f‹m©
(
htsFûe
 *
Â
);

414 c⁄° *
hts_f‹m©_fûe_exãnsi⁄
(c⁄° 
htsF‹m©
 *
f‹m©
);

423 
hts_£t_›t
(
htsFûe
 *
Â
, 
hts_fmt_›ti⁄
 
›t
, ...);

425 
hts_gëlöe
(
htsFûe
 *
Â
, 
dñimôî
, 
k°rög_t
 *
°r
);

426 **
hts_ªadlöes
(c⁄° *
‚
, *
_n
);

435 **
hts_ªadli°
(c⁄° *
‚
, 
is_fûe
, *
_n
);

445 
hts_£t_thªads
(
htsFûe
 *
Â
, 
n
);

453 
hts_£t_thªad_poﬁ
(
htsFûe
 *
Â
, 
htsThªadPoﬁ
 *
p
);

461 
hts_£t_ˇche_size
(
htsFûe
 *
Â
, 
n
);

470 
hts_£t_Ái_fûíame
(
htsFûe
 *
Â
, c⁄° *
‚_aux
);

483 
hts_check_EOF
(
htsFûe
 *
Â
);

499 
	#HTS_IDX_NOCOOR
 (-2)

	)

500 
	#HTS_IDX_START
 (-3)

	)

501 
	#HTS_IDX_REST
 (-4)

	)

502 
	#HTS_IDX_NONE
 (-5)

	)

504 
	#HTS_FMT_CSI
 0

	)

505 
	#HTS_FMT_BAI
 1

	)

506 
	#HTS_FMT_TBI
 2

	)

507 
	#HTS_FMT_CRAI
 3

	)

509 
	g__hts_idx_t
;

510 
__hts_idx_t
 
	thts_idx_t
;

513 
uöt64_t
 
	gu
, 
	gv
;

514 } 
	thts_∑ú64_t
;

516 
	thts_ªadªc_func
(
	tBGZF
 *
	tÂ
, *
	td©a
, *
	tr
, *
	ttid
, *
	tbeg
, *
	tíd
);

519 
uöt32_t
 
	gªad_ª°
:1, 
	gföished
:1, 
	gis_¸am
:1, 
	gdummy
:29;

520 
	gtid
, 
	gbeg
, 
	gíd
, 
	gn_off
, 
	gi
;

521 
	gcuº_tid
, 
	gcuº_beg
, 
	gcuº_íd
;

522 
uöt64_t
 
	gcuº_off
;

523 
hts_∑ú64_t
 *
	goff
;

524 
hts_ªadªc_func
 *
	gªadªc
;

526 
	gn
, 
	gm
;

527 *
	ga
;

528 } 
	gbös
;

529 } 
	thts_ôr_t
;

531 
	#hts_bö_fú°
(
l
Ë(((1<<((÷)<<1Ë+ (l))Ë- 1Ë/ 7)

	)

532 
	#hts_bö_∑ª¡
(
l
Ë((÷Ë- 1Ë>> 3)

	)

534 
hts_idx_t
 *
hts_idx_öô
(
n
, 
fmt
, 
uöt64_t
 
off£t0
, 
mö_shi·
, 
n_lvls
);

535 
hts_idx_de°roy
(
hts_idx_t
 *
idx
);

536 
hts_idx_push
(
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
, 
uöt64_t
 
off£t
, 
is_m≠≥d
);

537 
hts_idx_föish
(
hts_idx_t
 *
idx
, 
uöt64_t
 
föÆ_off£t
);

545 
hts_idx_ßve
(c⁄° 
hts_idx_t
 *
idx
, c⁄° *
‚
, 
fmt
Ë
	gHTS_RESULT_USED
;

554 
hts_idx_ßve_as
(c⁄° 
hts_idx_t
 *
idx
, c⁄° *
‚
, c⁄° *
‚idx
, 
fmt
Ë
	gHTS_RESULT_USED
;

562 
hts_idx_t
 *
hts_idx_lﬂd
(c⁄° *
‚
, 
fmt
);

569 
hts_idx_t
 *
hts_idx_lﬂd2
(c⁄° *
‚
, c⁄° *
‚idx
);

583 
uöt8_t
 *
hts_idx_gë_mëa
(
hts_idx_t
 *
idx
, 
uöt32_t
 *
l_mëa
);

597 
hts_idx_£t_mëa
(
hts_idx_t
 *
idx
, 
uöt32_t
 
l_mëa
, 
uöt8_t
 *
mëa
, 
is_c›y
);

599 
hts_idx_gë_°©
(c⁄° 
hts_idx_t
* 
idx
, 
tid
, 
uöt64_t
* 
m≠≥d
, uöt64_t* 
unm≠≥d
);

600 
uöt64_t
 
hts_idx_gë_n_no_co‹
(c⁄° 
hts_idx_t
* 
idx
);

603 
	#HTS_PARSE_THOUSANDS_SEP
 1

604 

	)

617 
hts_∑r£_decimÆ
(c⁄° *
°r
, **
°ªnd
, 
Êags
);

626 c⁄° *
hts_∑r£_ªg
(c⁄° *
°r
, *
beg
, *
íd
);

628 
hts_ôr_t
 *
hts_ôr_quîy
(c⁄° 
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
, 
hts_ªadªc_func
 *
ªadªc
);

629 
hts_ôr_de°roy
(
hts_ôr_t
 *
ôî
);

631 (*
	ghts_«me2id_f
)(*, const *);

632 c⁄° *(*
	thts_id2«me_f
)(*, );

633 
hts_ôr_t
 *
	thts_ôr_quîy_func
(c⁄° 
	thts_idx_t
 *
	tidx
, 
	ttid
, 
	tbeg
, 
	tíd
, 
	thts_ªadªc_func
 *
	tªadªc
);

635 
hts_ôr_t
 *
hts_ôr_quîys
(c⁄° 
hts_idx_t
 *
idx
, c⁄° *
ªg
, 
hts_«me2id_f
 
gëid
, *
hdr
, 
hts_ôr_quîy_func
 *
ôr_quîy
, 
hts_ªadªc_func
 *
ªadªc
);

636 
hts_ôr_√xt
(
BGZF
 *
Â
, 
hts_ôr_t
 *
ôî
, *
r
, *
d©a
Ë
	gHTS_RESULT_USED
;

637 c⁄° **
hts_idx_£q«mes
(c⁄° 
hts_idx_t
 *
idx
, *
n
, 
hts_id2«me_f
 
gëid
, *
hdr
);

644 
	#FT_UNKN
 0

	)

645 
	#FT_GZ
 1

	)

646 
	#FT_VCF
 2

	)

647 
	#FT_VCF_GZ
 (
FT_GZ
|
FT_VCF
)

	)

648 
	#FT_BCF
 (1<<2)

	)

649 
	#FT_BCF_GZ
 (
FT_GZ
|
FT_BCF
)

	)

650 
	#FT_STDIN
 (1<<3)

	)

651 
hts_fûe_ty≥
(c⁄° *
‚ame
);

658 
	gîrmod_t
;

659 
îrmod_t
 
	tîrmod_t
;

661 
îrmod_t
 *
îrmod_öô
(
dïc‹r
);

662 
îrmod_de°roy
(
îrmod_t
 *
em
);

670 
îrmod_ˇl
(c⁄° 
îrmod_t
 *
em
, 
n
, 
m
, 
uöt16_t
 *
ba£s
, *
q
);

677 
	s¥obÆn_∑r_t
 {

678 
	gd
, 
	ge
;

679 
	gbw
;

680 } 
	t¥obÆn_∑r_t
;

682 
¥obÆn_gloˇl
(c⁄° 
uöt8_t
 *
ªf
, 
l_ªf
, c⁄° uöt8_à*
quîy
, 
l_quîy
, c⁄° uöt8_à*
iquÆ
, c⁄° 
¥obÆn_∑r_t
 *
c
, *
°©e
, uöt8_à*
q
);

689 
	ghts_md5_c⁄ãxt
;

690 
hts_md5_c⁄ãxt
 
	thts_md5_c⁄ãxt
;

706 
hts_md5_c⁄ãxt
 *
hts_md5_öô
();

709 
hts_md5_upd©e
(
hts_md5_c⁄ãxt
 *
˘x
, c⁄° *
d©a
, 
size
);

712 
hts_md5_föÆ
(*
dige°
, 
hts_md5_c⁄ãxt
 *
˘x
);

717 
hts_md5_ª£t
(
hts_md5_c⁄ãxt
 *
˘x
);

722 
hts_md5_hex
(*
hex
, c⁄° *
dige°
);

725 
hts_md5_de°roy
(
hts_md5_c⁄ãxt
 *
˘x
);

728 
ölöe
 
hts_ªg2bö
(
öt64_t
 
beg
, i¡64_à
íd
, 
mö_shi·
, 
n_lvls
)

730 
	gl
, 
	gs
 = 
mö_shi·
, 
	gt
 = ((1<<((
n_lvls
<<1) +Ç_lvls)) - 1) / 7;

731 --
	gíd
, 
	gl
 = 
n_lvls
;Ü > 0; --l, 
	gs
 +3, 
	gt
 -1<<((
l
<<1)+l))

732 i‡(
beg
>>
s
 =
íd
>>sË 
t
 + (beg>>s);

736 
ölöe
 
hts_bö_bŸ
(
bö
, 
n_lvls
)

738 
	gl
, 
	gb
;

739 
	gl
 = 0, 
	gb
 = 
bö
; b; ++l, b = 
hts_bö_∑ª¡
(
b
));

740  (
	gbö
 - 
hts_bö_fú°
(
l
)Ë<< (
	gn_lvls
 - 
	gl
) * 3;

747 
ölöe
 
ed_is_big
()

749 
	g⁄e
= 1;

750  !(*((*)(&
	g⁄e
)));

752 
ölöe
 
uöt16_t
 
ed_sw≠_2
(uöt16_à
v
)

754  (
	guöt16_t
)(((
	gv
 & 0x00FF00FFU) << 8) | ((v & 0xFF00FF00U) >> 8));

756 
ölöe
 *
ed_sw≠_2p
(*
x
)

758 *(
	guöt16_t
*)
	gx
 = 
ed_sw≠_2
(*(
uöt16_t
*)
x
);

759  
	gx
;

761 
ölöe
 
uöt32_t
 
ed_sw≠_4
(uöt32_à
v
)

763 
	gv
 = ((
v
 & 0x0000FFFFU) << 16) | (v >> 16);

764  ((
	gv
 & 0x00FF00FFU) << 8) | ((v & 0xFF00FF00U) >> 8);

766 
ölöe
 *
ed_sw≠_4p
(*
x
)

768 *(
	guöt32_t
*)
	gx
 = 
ed_sw≠_4
(*(
uöt32_t
*)
x
);

769  
	gx
;

771 
ölöe
 
uöt64_t
 
ed_sw≠_8
(uöt64_à
v
)

773 
	gv
 = ((
v
 & 0x00000000FFFFFFFFLLU) << 32) | (v >> 32);

774 
	gv
 = ((
v
 & 0x0000FFFF0000FFFFLLU) << 16) | ((v & 0xFFFF0000FFFF0000LLU) >> 16);

775  ((
	gv
 & 0x00FF00FF00FF00FFLLU) << 8) | ((v & 0xFF00FF00FF00FF00LLU) >> 8);

777 
ölöe
 *
ed_sw≠_8p
(*
x
)

779 *(
	guöt64_t
*)
	gx
 = 
ed_sw≠_8
(*(
uöt64_t
*)
x
);

780  
	gx
;

783 #ifde‡
__˝lu•lus


	@htslib/htslib/hts_defs.h

25 #i‚de‡
HTSLIB_HTS_DEFS_H


26 
	#HTSLIB_HTS_DEFS_H


	)

28 #ifde‡
__˛™g__


29 #ifde‡
__has_©åibuã


30 
	#HTS_COMPILER_HAS
(
©åibuã
Ë
	`__has_©åibuã
◊âribuã)

	)

33 #ñi‡
deföed
 
__GNUC__


34 
	#HTS_GCC_AT_LEAST
(
maj‹
, 
mö‹
) \

35 (
__GNUC__
 > (
maj‹
Ë|| (__GNUC__ =(maj‹Ë&& 
__GNUC_MINOR__
 >(
mö‹
)))

	)

38 #i‚de‡
HTS_COMPILER_HAS


39 
	#HTS_COMPILER_HAS
(
©åibuã
Ë0

	)

41 #i‚de‡
HTS_GCC_AT_LEAST


42 
	#HTS_GCC_AT_LEAST
(
maj‹
, 
mö‹
Ë0

	)

45 #i‡
HTS_COMPILER_HAS
(
__n‹ëu∫__
Ë|| 
HTS_GCC_AT_LEAST
(3,0)

46 
	#HTS_NORETURN
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

	)

48 
	#HTS_NORETURN


	)

52 #i‡
HTS_COMPILER_HAS
(
__w¨n_unu£d_ªsu…__
Ë|| 
HTS_GCC_AT_LEAST
(4,5)

53 
	#HTS_RESULT_USED
 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

55 
	#HTS_RESULT_USED


	)

58 #i‡
HTS_COMPILER_HAS
(
__unu£d__
Ë|| 
HTS_GCC_AT_LEAST
(3,0)

59 
	#HTS_UNUSED
 
	`__©åibuã__
 ((
__unu£d__
))

	)

61 
	#HTS_UNUSED


	)

64 #i‡
HTS_COMPILER_HAS
(
__dïªˇãd__
Ë|| 
HTS_GCC_AT_LEAST
(4,5)

65 
	#HTS_DEPRECATED
(
mesßge
Ë
	`__©åibuã__
 ((
	`__dïªˇãd__
 (mesßge)))

	)

66 #ñi‡
HTS_GCC_AT_LEAST
(3,1)

67 
	#HTS_DEPRECATED
(
mesßge
Ë
	`__©åibuã__
 ((
__dïªˇãd__
))

	)

69 
	#HTS_DEPRECATED
(
mesßge
)

	)

72 #i‡
HTS_COMPILER_HAS
(
__f‹m©__
Ë|| 
HTS_GCC_AT_LEAST
(3,0)

73 
	#HTS_FORMAT
(
ty≥
, 
idx
, 
fú°
Ë
	`__©åibuã__
((
	`__f‹m©__
 (ty≥, idx, fú°)))

	)

75 
	#HTS_FORMAT
(
ty≥
, 
idx
, 
fú°
)

	)

	@htslib/htslib/hts_endian.h

26 #i‚de‡
HTS_ENDIAN_H


27 
	#HTS_ENDIAN_H


	)

29 
	~<°döt.h
>

42 #i‡(
deföed
(
__i386__
Ë|| deföed(
__i386
Ë|| deföed(
__amd64__
Ë|| deföed(
__amd64
Ë|| deföed(
__x86_64__
Ë|| deföed(
__x86_64
Ë|| deföed(
__i686__
Ë|| deföed(
__i686
)Ë&& !deföed(
HTS_x86
)

43 
	#HTS_x86


	)

50 #i‚de‡
HTS_LITTLE_ENDIAN


51 #i‡(
deföed
(
__BYTE_ORDER__
Ë&& __BYTE_ORDER__ =
__ORDER_LITTLE_ENDIAN__
) \

52 || 
deföed
(
__LITTLE_ENDIAN__
) \

53 || 
deföed
(
HTS_x86
) \

54 || 
deföed
(
__ARMEL__
Ë|| deföed(
__THUMBEL__
Ë|| deföed(
__AARCH64EL__
) \

55 || 
deföed
(
_MIPSEL
Ë|| deföed(
__MIPSEL
Ë|| 
	$deföed
(
__MIPSEL__
)

56 
	#HTS_LITTLE_ENDIAN


	)

64 #i‚de‡
HTS_BIG_ENDIAN


65 #i‡(
	`deföed
(
__BYTE_ORDER__
Ë&& __BYTE_ORDER__ =
__ORDER_BIG_ENDIAN__
) \

66 || 
	`deföed
(
__BIG_ENDIAN__
) \

67 || 
	`deföed
(
__ARMEB__
Ë|| deföed(
__THUMBEB__
Ë|| deföed(
__AAARCHEB__
) \

68 || 
	`deföed
(
_MIPSEB
Ë|| deföed(
__MIPSEB
Ë|| 
	$deföed
(
__MIPSEB__
)

69 
	#HTS_BIG_ENDIAN


	)

77 #i‡
	`deföed
(
HTS_ENDIAN_NEUTRAL
Ë|| (deföed(
HTS_LITTLE_ENDIAN
Ë&& deföed(
HTS_BIG_ENDIAN
))

79 #unde‡
HTS_LITTLE_ENDIAN


80 #unde‡
HTS_BIG_ENDIAN


94 #i‚de‡
HTS_ALLOW_UNALIGNED


95 #i‡
	`deföed
(
HTS_x86
)

96 
	#HTS_ALLOW_UNALIGNED
 1

	)

98 
	#HTS_ALLOW_UNALIGNED
 0

	)

102 #i‡
HTS_ALLOW_UNALIGNED
 != 0

103 #i‡
	`deföed
 (
__GNUC__
Ë&& (__GNUC__ > 4 || (__GNUC__ =4 && 
__GNUC_MINOR__
 >= 3))

106 
uöt16_t
 
	tuöt16_u
 
	t__©åibuã__
 ((
	t__Æig√d__
 (1)));

107 
uöt32_t
 
	tuöt32_u
 
	t__©åibuã__
 ((
	t__Æig√d__
 (1)));

108 
uöt64_t
 
	tuöt64_u
 
	t__©åibuã__
 ((
	t__Æig√d__
 (1)));

110 
uöt16_t
 
	tuöt16_u
;

111 
uöt32_t
 
	tuöt32_u
;

112 
uöt64_t
 
	tuöt64_u
;

121 
ölöe
 
uöt16_t
 
	$À_to_u16
(c⁄° 
uöt8_t
 *
buf
) {

122 #i‡
	`deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

123  *((
uöt16_u
 *Ë
buf
);

125  (
uöt16_t
Ë
buf
[0] | ((uint16_t) buf[1] << 8);

127 
	}
}

134 
ölöe
 
uöt32_t
 
	$À_to_u32
(c⁄° 
uöt8_t
 *
buf
) {

135 #i‡
	`deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

136  *((
uöt32_u
 *Ë
buf
);

138  ((
uöt32_t
Ë
buf
[0] |

139 ((
uöt32_t
Ë
buf
[1] << 8) |

140 ((
uöt32_t
Ë
buf
[2] << 16) |

141 ((
uöt32_t
Ë
buf
[3] << 24));

143 
	}
}

150 
ölöe
 
uöt64_t
 
	$À_to_u64
(c⁄° 
uöt8_t
 *
buf
) {

151 #i‡
	`deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

152  *((
uöt64_u
 *Ë
buf
);

154  ((
uöt64_t
Ë
buf
[0] |

155 ((
uöt64_t
Ë
buf
[1] << 8) |

156 ((
uöt64_t
Ë
buf
[2] << 16) |

157 ((
uöt64_t
Ë
buf
[3] << 24) |

158 ((
uöt64_t
Ë
buf
[4] << 32) |

159 ((
uöt64_t
Ë
buf
[5] << 40) |

160 ((
uöt64_t
Ë
buf
[6] << 48) |

161 ((
uöt64_t
Ë
buf
[7] << 56));

163 
	}
}

169 
ölöe
 
	$u16_to_À
(
uöt16_t
 
vÆ
, 
uöt8_t
 *
buf
) {

170 #i‡
	`deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

171 *((
uöt16_u
 *Ë
buf
Ë
vÆ
;

173 
buf
[0] = 
vÆ
 & 0xff;

174 
buf
[1] = (
vÆ
 >> 8) & 0xff;

176 
	}
}

182 
ölöe
 
	$u32_to_À
(
uöt32_t
 
vÆ
, 
uöt8_t
 *
buf
) {

183 #i‡
	`deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

184 *((
uöt32_u
 *Ë
buf
Ë
vÆ
;

186 
buf
[0] = 
vÆ
 & 0xff;

187 
buf
[1] = (
vÆ
 >> 8) & 0xff;

188 
buf
[2] = (
vÆ
 >> 16) & 0xff;

189 
buf
[3] = (
vÆ
 >> 24) & 0xff;

191 
	}
}

197 
ölöe
 
	$u64_to_À
(
uöt64_t
 
vÆ
, 
uöt8_t
 *
buf
) {

198 #i‡
	`deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

199 *((
uöt64_u
 *Ë
buf
Ë
vÆ
;

201 
buf
[0] = 
vÆ
 & 0xff;

202 
buf
[1] = (
vÆ
 >> 8) & 0xff;

203 
buf
[2] = (
vÆ
 >> 16) & 0xff;

204 
buf
[3] = (
vÆ
 >> 24) & 0xff;

205 
buf
[4] = (
vÆ
 >> 32) & 0xff;

206 
buf
[5] = (
vÆ
 >> 40) & 0xff;

207 
buf
[6] = (
vÆ
 >> 48) & 0xff;

208 
buf
[7] = (
vÆ
 >> 56) & 0xff;

210 
	}
}

222 
ölöe
 
öt8_t
 
	$À_to_i8
(c⁄° 
uöt8_t
 *
buf
) {

223  *
buf
 < 0x80 ? *bu‡: -((
öt8_t
) (0xff - *buf)) - 1;

224 
	}
}

232 
ölöe
 
öt16_t
 
	$À_to_i16
(c⁄° 
uöt8_t
 *
buf
) {

233 
uöt16_t
 
v
 = 
	`À_to_u16
(
buf
);

234  
v
 < 0x8000 ? v : -((
öt16_t
) (0xffff - v)) - 1;

235 
	}
}

243 
ölöe
 
öt32_t
 
	$À_to_i32
(c⁄° 
uöt8_t
 *
buf
) {

244 
uöt32_t
 
v
 = 
	`À_to_u32
(
buf
);

245  
v
 < 0x80000000U ? v : -((
öt32_t
) (0xffffffffU - v)) - 1;

246 
	}
}

254 
ölöe
 
öt64_t
 
	$À_to_i64
(c⁄° 
uöt8_t
 *
buf
) {

255 
uöt64_t
 
v
 = 
	`À_to_u64
(
buf
);

256  (
v
 < 0x8000000000000000ULL

257 ? 
v
 : -((
öt64_t
) (0xffffffffffffffffULL - v)) - 1);

258 
	}
}

266 
ölöe
 
	$i16_to_À
(
öt16_t
 
vÆ
, 
uöt8_t
 *
buf
) {

267 
	`u16_to_À
(
vÆ
, 
buf
);

268 
	}
}

274 
ölöe
 
	$i32_to_À
(
öt32_t
 
vÆ
, 
uöt8_t
 *
buf
) {

275 
	`u32_to_À
(
vÆ
, 
buf
);

276 
	}
}

282 
ölöe
 
	$i64_to_À
(
öt64_t
 
vÆ
, 
uöt8_t
 *
buf
) {

283 
	`u64_to_À
(
vÆ
, 
buf
);

284 
	}
}

300 
ölöe
 
	$À_to_Êﬂt
(c⁄° 
uöt8_t
 *
buf
) {

302 
uöt32_t
 
u
;

303 
f
;

304 } 
c⁄vît
;

306 
c⁄vît
.
u
 = 
	`À_to_u32
(
buf
);

307  
c⁄vît
.
f
;

308 
	}
}

316 
ölöe
 
	$À_to_doubÀ
(c⁄° 
uöt8_t
 *
buf
) {

318 
uöt64_t
 
u
;

319 
f
;

320 } 
c⁄vît
;

322 
c⁄vît
.
u
 = 
	`À_to_u64
(
buf
);

323  
c⁄vît
.
f
;

324 
	}
}

330 
ölöe
 
	$Êﬂt_to_À
(
vÆ
, 
uöt8_t
 *
buf
) {

332 
uöt32_t
 
u
;

333 
f
;

334 } 
c⁄vît
;

336 
c⁄vît
.
f
 = 
vÆ
;

337 
	`u32_to_À
(
c⁄vît
.
u
, 
buf
);

338 
	}
}

344 
ölöe
 
	$doubÀ_to_À
(
vÆ
, 
uöt8_t
 *
buf
) {

346 
uöt64_t
 
u
;

347 
f
;

348 } 
c⁄vît
;

350 
c⁄vît
.
f
 = 
vÆ
;

351 
	`u64_to_À
(
c⁄vît
.
u
, 
buf
);

352 
	}
}

	@htslib/htslib/kbitset.h

26 #i‚de‡
KBITSET_H


27 
	#KBITSET_H


	)

55 
	~<limôs.h
>

56 
	~<°dlib.h
>

57 
	~<°rög.h
>

59 
	#KBS_ELTBITS
 (
CHAR_BIT
 *  ())

	)

60 
	#KBS_ELT
(
i
Ë((iË/ 
KBS_ELTBITS
)

	)

61 
	#KBS_MASK
(
i
Ë(1UL << ((iË% 
KBS_ELTBITS
))

	)

63 
	skbô£t_t
 {

64 
size_t
 
	mn
;

65 
	mb
[1];

66 } 
	tkbô£t_t
;

70 
ölöe
 
kbô£t_t
 *
	$kbs_öô2
(
size_t
 
ni
, 
fûl
)

72 
size_t
 
n
 = (
ni
 + 
KBS_ELTBITS
-1) / KBS_ELTBITS;

73 
kbô£t_t
 *
bs
 =

74 (
kbô£t_t
 *Ë
	`mÆloc
((kbô£t_tË+ 
n
 * ());

75 i‡(
bs
 =
NULL
)  NULL;

76 
bs
->
n
 =Ç;

77 
	`mem£t
(
bs
->
b
, 
fûl
? ~0 : 0, 
n
 *  ());

78 
bs
->
b
[
n
] = ~0UL;

79  
bs
;

80 
	}
}

83 
ölöe
 
kbô£t_t
 *
	$kbs_öô
(
size_t
 
ni
)

85  
	`kbs_öô2
(
ni
, 0);

86 
	}
}

89 
ölöe
 
	$kbs_de°roy
(
kbô£t_t
 *
bs
)

91 
	`‰ì
(
bs
);

92 
	}
}

95 
ölöe
 
	$kbs_˛ór
(
kbô£t_t
 *
bs
)

97 
	`mem£t
(
bs
->
b
, 0, bs->
n
 *  ());

98 
	}
}

101 
ölöe
 
	$kbs_ö£π_Æl
(
kbô£t_t
 *
bs
)

103 
	`mem£t
(
bs
->
b
, ~0, bs->
n
 *  ());

104 
	}
}

107 
ölöe
 
	$kbs_ö£π
(
kbô£t_t
 *
bs
, 
i
)

109 
bs
->
b
[
	`KBS_ELT
(
i
)] |
	`KBS_MASK
(i);

110 
	}
}

113 
ölöe
 
	$kbs_dñëe
(
kbô£t_t
 *
bs
, 
i
)

115 
bs
->
b
[
	`KBS_ELT
(
i
)] &~
	`KBS_MASK
(i);

116 
	}
}

119 
ölöe
 
	$kbs_exi°s
(c⁄° 
kbô£t_t
 *
bs
, 
i
)

121  (
bs
->
b
[
	`KBS_ELT
(
i
)] & 
	`KBS_MASK
(i)) != 0;

122 
	}
}

124 
	skbô£t_ôî_t
 {

125 
	mmask
;

126 
size_t
 
	mñt
;

127 
	mi
;

128 } 
	tkbô£t_ôî_t
;

131 
ölöe
 
	$kbs_°¨t
(
kbô£t_ôî_t
 *
ôr
)

133 
ôr
->
mask
 = 1;

134 
ôr
->
ñt
 = 0;

135 
ôr
->
i
 = 0;

136 
	}
}

139 
ölöe
 
	$kbs_√xt
(c⁄° 
kbô£t_t
 *
bs
, 
kbô£t_ôî_t
 *
ôr
)

141 
b
 = 
bs
->b[
ôr
->
ñt
];

144 i‡(
ôr
->
mask
 == 0) {

145 (
b
 = 
bs
->b[++
ôr
->
ñt
]Ë=0Ëôr->
i
 +
KBS_ELTBITS
;

146 i‡(
ôr
->
ñt
 =
bs
->
n
)  -1;

147 
ôr
->
mask
 = 1;

150 i‡(
b
 & 
ôr
->
mask
) ;

152 
ôr
->
i
++;

153 
ôr
->
mask
 <<= 1;

156 
ôr
->
mask
 <<= 1;

157  
ôr
->
i
++;

158 
	}
}

	@htslib/htslib/kfunc.h

27 #i‚de‡
HTSLIB_KFUNC_H


28 
	#HTSLIB_KFUNC_H


	)

30 #ifde‡
__˝lu•lus


38 
kf_lgamma
(
z
);

44 
kf_îfc
(
x
);

59 
kf_gamm≠
(
s
, 
z
);

60 
kf_gammaq
(
s
, 
z
);

69 
kf_bëai
(
a
, 
b
, 
x
);

77 
kt_fishî_exa˘
(
n11
, 
n12
, 
n21
, 
n22
, *
_À·
, *
_right
, *
two
);

79 #ifde‡
__˝lu•lus


	@htslib/htslib/khash.h

117 #i‚de‡
__AC_KHASH_H


118 
	#__AC_KHASH_H


	)

126 
	#AC_VERSION_KHASH_H
 "0.2.8"

	)

128 
	~<°dlib.h
>

129 
	~<°rög.h
>

130 
	~<limôs.h
>

134 #i‡
UINT_MAX
 == 0xffffffffu

135 
	tkhöt32_t
;

136 #ñi‡
ULONG_MAX
 == 0xffffffffu

137 
	tkhöt32_t
;

140 #i‡
ULONG_MAX
 =
ULLONG_MAX


141 
	tkhöt64_t
;

143 
	tkhöt64_t
;

146 #i‚de‡
kh_ölöe


147 #ifde‡
_MSC_VER


148 
	#kh_ölöe
 
__ölöe


	)

150 
	#kh_ölöe
 
ölöe


	)

154 #i‚de‡
klib_unu£d


155 #i‡(
deföed
 
__˛™g__
 && 
__˛™g_maj‹__
 >3Ë|| (deföed 
__GNUC__
 && __GNUC__ >= 3)

156 
	#klib_unu£d
 
	`__©åibuã__
 ((
__unu£d__
))

	)

158 
	#klib_unu£d


	)

162 
khöt32_t
 
	tkhöt_t
;

163 
khöt_t
 
	tkhôî_t
;

165 
	#__ac_i£m±y
(
Êag
, 
i
Ë((Êag[i>>4]>>((i&0xfU)<<1))&2)

	)

166 
	#__ac_isdñ
(
Êag
, 
i
Ë((Êag[i>>4]>>((i&0xfU)<<1))&1)

	)

167 
	#__ac_i£ôhî
(
Êag
, 
i
Ë((Êag[i>>4]>>((i&0xfU)<<1))&3)

	)

168 
	#__ac_£t_isdñ_Ál£
(
Êag
, 
i
Ë(Êag[i>>4]&=~(1ul<<((i&0xfU)<<1)))

	)

169 
	#__ac_£t_i£m±y_Ál£
(
Êag
, 
i
Ë(Êag[i>>4]&=~(2ul<<((i&0xfU)<<1)))

	)

170 
	#__ac_£t_isbŸh_Ál£
(
Êag
, 
i
Ë(Êag[i>>4]&=~(3ul<<((i&0xfU)<<1)))

	)

171 
	#__ac_£t_isdñ_åue
(
Êag
, 
i
Ë(Êag[i>>4]|=1ul<<((i&0xfU)<<1))

	)

173 
	#__ac_fsize
(
m
Ë((mË< 16? 1 : (m)>>4)

	)

175 #i‚de‡
kroundup32


176 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

179 #i‚de‡
kˇŒoc


180 
	#kˇŒoc
(
N
,
Z
Ë
	`ˇŒoc
(N,Z)

	)

182 #i‚de‡
kmÆloc


183 
	#kmÆloc
(
Z
Ë
	`mÆloc
(Z)

	)

185 #i‚de‡
kªÆloc


186 
	#kªÆloc
(
P
,
Z
Ë
	`ªÆloc
(P,Z)

	)

188 #i‚de‡
k‰ì


189 
	#k‰ì
(
P
Ë
	`‰ì
(P)

	)

192 c⁄° 
	g__ac_HASH_UPPER
 = 0.77;

194 
	#__KHASH_TYPE
(
«me
, 
khkey_t
, 
khvÆ_t
) \

195 
kh_
##
	t«me
##
	t_s
 { \

196 
khöt_t
 
n_buckës
, 
size
, 
n_occupõd
, 
uµî_bound
; \

197 
khöt32_t
 *
Êags
; \

198 
khkey_t
 *
keys
; \

199 
khvÆ_t
 *
vÆs
; \

200 } 
	tkh_
##
	t«me
##
	t_t
;

	)

202 
	#__KHASH_PROTOTYPES
(
«me
, 
khkey_t
, 
khvÆ_t
) \

203 
kh_
##
«me
##
_t
 *
kh_öô_
##
	`«me
(); \

204 
kh_de°roy_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
); \

205 
kh_˛ór_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
); \

206 
khöt_t
 
kh_gë_
##
	`«me
(c⁄° 
kh_
##
«me
##
_t
 *
h
, 
khkey_t
 
key
); \

207 
kh_ªsize_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
, 
khöt_t
 
√w_n_buckës
); \

208 
khöt_t
 
kh_put_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
, 
khkey_t
 
key
, *
ªt
); \

209 
kh_dñ_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
, 
khöt_t
 
x
);

	)

211 
	#__KHASH_IMPL
(
«me
, 
SCOPE
, 
khkey_t
, 
khvÆ_t
, 
kh_is_m≠
, 
__hash_func
, 
__hash_equÆ
) \

212 
SCOPE
 
kh_
##
«me
##
_t
 *
kh_öô_
##
	`«me
() { \

213  (
kh_
##
«me
##
_t
*)
	`kˇŒoc
(1, (kh_##name##_t)); \

215 
SCOPE
 
kh_de°roy_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
) \

217 i‡(
h
) { \

218 
	`k‰ì
((*)
h
->
keys
); k‰ì(h->
Êags
); \

219 
	`k‰ì
((*)
h
->
vÆs
); \

220 
	`k‰ì
(
h
); \

223 
SCOPE
 
kh_˛ór_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
) \

225 i‡(
h
 && h->
Êags
) { \

226 
	`mem£t
(
h
->
Êags
, 0xØ, 
	`__ac_fsize
(h->
n_buckës
Ë* (
khöt32_t
)); \

227 
h
->
size
 = h->
n_occupõd
 = 0; \

230 
SCOPE
 
khöt_t
 
kh_gë_
##
	`«me
(c⁄° 
kh_
##
«me
##
_t
 *
h
, 
khkey_t
 
key
) \

232 i‡(
h
->
n_buckës
) { \

233 
khöt_t
 
k
, 
i
, 
œ°
, 
mask
, 
°ï
 = 0; \

234 
mask
 = 
h
->
n_buckës
 - 1; \

235 
k
 = 
	`__hash_func
(
key
); 
i
 = k & 
mask
; \

236 
œ°
 = 
i
; \

237 !
	`__ac_i£m±y
(
h
->
Êags
, 
i
Ë&& (
	`__ac_isdñ
(h->Êags, iË|| !
	`__hash_equÆ
(h->
keys
[i], 
key
))) { \

238 
i
 = (ò+ (++
°ï
)Ë& 
mask
; \

239 i‡(
i
 =
œ°
Ë 
h
->
n_buckës
; \

241  
	`__ac_i£ôhî
(
h
->
Êags
, 
i
)? h->
n_buckës
 : i; \

244 
SCOPE
 
kh_ªsize_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
, 
khöt_t
 
√w_n_buckës
) \

246 
khöt32_t
 *
√w_Êags
 = 0; \

247 
khöt_t
 
j
 = 1; \

249 
	`kroundup32
(
√w_n_buckës
); \

250 i‡(
√w_n_buckës
 < 4)Çew_n_buckets = 4; \

251 i‡(
h
->
size
 >(
khöt_t
)(
√w_n_buckës
 * 
__ac_HASH_UPPER
 + 0.5)Ë
j
 = 0; \

253 
√w_Êags
 = (
khöt32_t
*)
	`kmÆloc
(
	`__ac_fsize
(
√w_n_buckës
) * (khint32_t)); \

254 i‡(!
√w_Êags
)  -1; \

255 
	`mem£t
(
√w_Êags
, 0xØ, 
	`__ac_fsize
(
√w_n_buckës
Ë* (
khöt32_t
)); \

256 i‡(
h
->
n_buckës
 < 
√w_n_buckës
) { \

257 
khkey_t
 *
√w_keys
 = (khkey_t*)
	`kªÆloc
((*)
h
->
keys
, 
√w_n_buckës
 * (khkey_t)); \

258 i‡(!
√w_keys
Ë{ 
	`k‰ì
(
√w_Êags
);  -1; } \

259 
h
->
keys
 = 
√w_keys
; \

260 i‡(
kh_is_m≠
) { \

261 
khvÆ_t
 *
√w_vÆs
 = (khvÆ_t*)
	`kªÆloc
((*)
h
->
vÆs
, 
√w_n_buckës
 * (khval_t)); \

262 i‡(!
√w_vÆs
Ë{ 
	`k‰ì
(
√w_Êags
);  -1; } \

263 
h
->
vÆs
 = 
√w_vÆs
; \

268 i‡(
j
) { \

269 
j
 = 0; j !
h
->
n_buckës
; ++j) { \

270 i‡(
	`__ac_i£ôhî
(
h
->
Êags
, 
j
) == 0) { \

271 
khkey_t
 
key
 = 
h
->
keys
[
j
]; \

272 
khvÆ_t
 
vÆ
; \

273 
khöt_t
 
√w_mask
; \

274 
√w_mask
 = 
√w_n_buckës
 - 1; \

275 i‡(
kh_is_m≠
Ë
vÆ
 = 
h
->
vÆs
[
j
]; \

276 
	`__ac_£t_isdñ_åue
(
h
->
Êags
, 
j
); \

278 
khöt_t
 
k
, 
i
, 
°ï
 = 0; \

279 
k
 = 
	`__hash_func
(
key
); \

280 
i
 = 
k
 & 
√w_mask
; \

281 !
	`__ac_i£m±y
(
√w_Êags
, 
i
)Ëò(ò+ (++
°ï
)Ë& 
√w_mask
; \

282 
	`__ac_£t_i£m±y_Ál£
(
√w_Êags
, 
i
); \

283 i‡(
i
 < 
h
->
n_buckës
 && 
	`__ac_i£ôhî
(h->
Êags
, i) == 0) { \

284 { 
khkey_t
 
tmp
 = 
h
->
keys
[
i
]; h->keys[i] = 
key
; key =Åmp; } \

285 i‡(
kh_is_m≠
Ë{ 
khvÆ_t
 
tmp
 = 
h
->
vÆs
[
i
]; h->vÆs[i] = 
vÆ
; val =Åmp; } \

286 
	`__ac_£t_isdñ_åue
(
h
->
Êags
, 
i
); \

288 
h
->
keys
[
i
] = 
key
; \

289 i‡(
kh_is_m≠
Ë
h
->
vÆs
[
i
] = 
vÆ
; \

295 i‡(
h
->
n_buckës
 > 
√w_n_buckës
) { \

296 
h
->
keys
 = (
khkey_t
*)
	`kªÆloc
((*)h->keys, 
√w_n_buckës
 * (khkey_t)); \

297 i‡(
kh_is_m≠
Ë
h
->
vÆs
 = (
khvÆ_t
*)
	`kªÆloc
((*)h->vÆs, 
√w_n_buckës
 * (khval_t)); \

299 
	`k‰ì
(
h
->
Êags
); \

300 
h
->
Êags
 = 
√w_Êags
; \

301 
h
->
n_buckës
 = 
√w_n_buckës
; \

302 
h
->
n_occupõd
 = h->
size
; \

303 
h
->
uµî_bound
 = (
khöt_t
)(h->
n_buckës
 * 
__ac_HASH_UPPER
 + 0.5); \

307 
SCOPE
 
khöt_t
 
kh_put_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
, 
khkey_t
 
key
, *
ªt
) \

309 
khöt_t
 
x
; \

310 i‡(
h
->
n_occupõd
 >h->
uµî_bound
) { \

311 i‡(
h
->
n_buckës
 > (h->
size
<<1)) { \

312 i‡(
kh_ªsize_
##
	`«me
(
h
, h->
n_buckës
 - 1) < 0) { \

313 *
ªt
 = -1;  
h
->
n_buckës
; \

315 } i‡(
kh_ªsize_
##
	`«me
(
h
, h->
n_buckës
 + 1) < 0) { \

316 *
ªt
 = -1;  
h
->
n_buckës
; \

320 
khöt_t
 
k
, 
i
, 
sôe
, 
œ°
, 
mask
 = 
h
->
n_buckës
 - 1, 
°ï
 = 0; \

321 
x
 = 
sôe
 = 
h
->
n_buckës
; 
k
 = 
	`__hash_func
(
key
); 
i
 = k & 
mask
; \

322 i‡(
	`__ac_i£m±y
(
h
->
Êags
, 
i
)Ë
x
 = i; \

324 
œ°
 = 
i
; \

325 !
	`__ac_i£m±y
(
h
->
Êags
, 
i
Ë&& (
	`__ac_isdñ
(h->Êags, iË|| !
	`__hash_equÆ
(h->
keys
[i], 
key
))) { \

326 i‡(
	`__ac_isdñ
(
h
->
Êags
, 
i
)Ë
sôe
 = i; \

327 
i
 = (ò+ (++
°ï
)Ë& 
mask
; \

328 i‡(
i
 =
œ°
Ë{ 
x
 = 
sôe
; ; } \

330 i‡(
x
 =
h
->
n_buckës
) { \

331 i‡(
	`__ac_i£m±y
(
h
->
Êags
, 
i
Ë&& 
sôe
 !h->
n_buckës
Ë
x
 = site; \

332 
x
 = 
i
; \

336 i‡(
	`__ac_i£m±y
(
h
->
Êags
, 
x
)) { \

337 
h
->
keys
[
x
] = 
key
; \

338 
	`__ac_£t_isbŸh_Ál£
(
h
->
Êags
, 
x
); \

339 ++
h
->
size
; ++h->
n_occupõd
; \

340 *
ªt
 = 1; \

341 } i‡(
	`__ac_isdñ
(
h
->
Êags
, 
x
)) { \

342 
h
->
keys
[
x
] = 
key
; \

343 
	`__ac_£t_isbŸh_Ál£
(
h
->
Êags
, 
x
); \

344 ++
h
->
size
; \

345 *
ªt
 = 2; \

346 } *
ªt
 = 0; \

347  
x
; \

349 
SCOPE
 
kh_dñ_
##
	`«me
(
kh_
##
«me
##
_t
 *
h
, 
khöt_t
 
x
) \

351 i‡(
x
 !
h
->
n_buckës
 && !
	`__ac_i£ôhî
(h->
Êags
, x)) { \

352 
	`__ac_£t_isdñ_åue
(
h
->
Êags
, 
x
); \

353 --
h
->
size
; \

355 }

	)

357 
	#KHASH_DECLARE
(
«me
, 
khkey_t
, 
khvÆ_t
) \

358 
	`__KHASH_TYPE
(
«me
, 
khkey_t
, 
khvÆ_t
) \

359 
	`__KHASH_PROTOTYPES
(
«me
, 
khkey_t
, 
khvÆ_t
)

	)

361 
	#KHASH_INIT2
(
«me
, 
SCOPE
, 
khkey_t
, 
khvÆ_t
, 
kh_is_m≠
, 
__hash_func
, 
__hash_equÆ
) \

362 
	`__KHASH_TYPE
(
«me
, 
khkey_t
, 
khvÆ_t
) \

363 
	`__KHASH_IMPL
(
«me
, 
SCOPE
, 
khkey_t
, 
khvÆ_t
, 
kh_is_m≠
, 
__hash_func
, 
__hash_equÆ
)

	)

365 
	#KHASH_INIT
(
«me
, 
khkey_t
, 
khvÆ_t
, 
kh_is_m≠
, 
__hash_func
, 
__hash_equÆ
) \

366 
	`KHASH_INIT2
(
«me
, 
kh_ölöe
 
klib_unu£d
, 
khkey_t
, 
khvÆ_t
, 
kh_is_m≠
, 
__hash_func
, 
__hash_equÆ
)

	)

375 
	#kh_öt_hash_func
(
key
Ë(
khöt32_t
)(key)

	)

379 
	#kh_öt_hash_equÆ
(
a
, 
b
Ë(◊Ë=(b))

	)

385 
	#kh_öt64_hash_func
(
key
Ë(
khöt32_t
)((key)>>33^(key)^(key)<<11)

	)

389 
	#kh_öt64_hash_equÆ
(
a
, 
b
Ë(◊Ë=(b))

	)

395 
kh_ölöe
 
khöt_t
 
	$__ac_X31_hash_°rög
(c⁄° *
s
)

397 
khöt_t
 
h
 = (khöt_t)*
s
;

398 i‡(
h
Ë++
s
 ; *s; ++sËh = (h << 5Ë- h + (
khöt_t
)*s;

399  
h
;

400 
	}
}

406 
	#kh_°r_hash_func
(
key
Ë
	`__ac_X31_hash_°rög
(key)

	)

410 
	#kh_°r_hash_equÆ
(
a
, 
b
Ë(
	`°rcmp
◊, bË=0)

	)

412 
kh_ölöe
 
khöt_t
 
	$__ac_W™g_hash
(
khöt_t
 
key
)

414 
key
 += ~(key << 15);

415 
key
 ^= (key >> 10);

416 
key
 += (key << 3);

417 
key
 ^= (key >> 6);

418 
key
 += ~(key << 11);

419 
key
 ^= (key >> 16);

420  
key
;

421 
	}
}

422 
	#kh_öt_hash_func2
(
k
Ë
	`__ac_W™g_hash
((
khöt_t
)
key
)

	)

432 
	#khash_t
(
«me
Ë
kh_
##«me##
_t


	)

439 
	#kh_öô
(
«me
Ë
kh_öô_
##
	`«me
()

	)

446 
	#kh_de°roy
(
«me
, 
h
Ë
kh_de°roy_
##
	`«me
(h)

	)

453 
	#kh_˛ór
(
«me
, 
h
Ë
kh_˛ór_
##
	`«me
(h)

	)

461 
	#kh_ªsize
(
«me
, 
h
, 
s
Ë
kh_ªsize_
##
	`«me
(h, s)

	)

474 
	#kh_put
(
«me
, 
h
, 
k
, 
r
Ë
kh_put_
##
	`«me
(h, k,Ñ)

	)

483 
	#kh_gë
(
«me
, 
h
, 
k
Ë
kh_gë_
##
	`«me
(h, k)

	)

491 
	#kh_dñ
(
«me
, 
h
, 
k
Ë
kh_dñ_
##
	`«me
(h, k)

	)

499 
	#kh_exi°
(
h
, 
x
Ë(!
	`__ac_i£ôhî
((h)->
Êags
, (x)))

	)

507 
	#kh_key
(
h
, 
x
Ë((h)->
keys
[x])

	)

516 
	#kh_vÆ
(
h
, 
x
Ë((h)->
vÆs
[x])

	)

521 
	#kh_vÆue
(
h
, 
x
Ë((h)->
vÆs
[x])

	)

528 
	#kh_begö
(
h
Ë(
khöt_t
)(0)

	)

535 
	#kh_íd
(
h
Ë((h)->
n_buckës
)

	)

542 
	#kh_size
(
h
Ë((h)->
size
)

	)

549 
	#kh_n_buckës
(
h
Ë((h)->
n_buckës
)

	)

558 
	#kh_f‹óch
(
h
, 
kv¨
, 
vv¨
, 
code
Ë{ 
khöt_t
 
__i
; \

559 
__i
 = 
	`kh_begö
(
h
); __ò!
	`kh_íd
(h); ++__i) { \

560 i‡(!
	`kh_exi°
(
h
,
__i
)) ; \

561 (
kv¨
Ë
	`kh_key
(
h
,
__i
); \

562 (
vv¨
Ë
	`kh_vÆ
(
h
,
__i
); \

563 
code
; \

564 } }

	)

572 
	#kh_f‹óch_vÆue
(
h
, 
vv¨
, 
code
Ë{ 
khöt_t
 
__i
; \

573 
__i
 = 
	`kh_begö
(
h
); __ò!
	`kh_íd
(h); ++__i) { \

574 i‡(!
	`kh_exi°
(
h
,
__i
)) ; \

575 (
vv¨
Ë
	`kh_vÆ
(
h
,
__i
); \

576 
code
; \

577 } }

	)

585 
	#KHASH_SET_INIT_INT
(
«me
) \

586 
	`KHASH_INIT
(
«me
, 
khöt32_t
, , 0, 
kh_öt_hash_func
, 
kh_öt_hash_equÆ
)

	)

593 
	#KHASH_MAP_INIT_INT
(
«me
, 
khvÆ_t
) \

594 
	`KHASH_INIT
(
«me
, 
khöt32_t
, 
khvÆ_t
, 1, 
kh_öt_hash_func
, 
kh_öt_hash_equÆ
)

	)

600 
	#KHASH_SET_INIT_INT64
(
«me
) \

601 
	`KHASH_INIT
(
«me
, 
khöt64_t
, , 0, 
kh_öt64_hash_func
, 
kh_öt64_hash_equÆ
)

	)

608 
	#KHASH_MAP_INIT_INT64
(
«me
, 
khvÆ_t
) \

609 
	`KHASH_INIT
(
«me
, 
khöt64_t
, 
khvÆ_t
, 1, 
kh_öt64_hash_func
, 
kh_öt64_hash_equÆ
)

	)

611 c⁄° *
	tkh_c°r_t
;

616 
	#KHASH_SET_INIT_STR
(
«me
) \

617 
	`KHASH_INIT
(
«me
, 
kh_c°r_t
, , 0, 
kh_°r_hash_func
, 
kh_°r_hash_equÆ
)

	)

624 
	#KHASH_MAP_INIT_STR
(
«me
, 
khvÆ_t
) \

625 
	`KHASH_INIT
(
«me
, 
kh_c°r_t
, 
khvÆ_t
, 1, 
kh_°r_hash_func
, 
kh_°r_hash_equÆ
)

	)

	@htslib/htslib/khash_str2int.h

25 #i‚de‡
HTSLIB_KHASH_STR2INT_H


26 
	#HTSLIB_KHASH_STR2INT_H


	)

28 
	~<ht¶ib/khash.h
>

30 
	$KHASH_MAP_INIT_STR
(
°r2öt
, )

36 
ölöe
 *
	$khash_°r2öt_öô
()

38  
	`kh_öô
(
°r2öt
);

39 
	}
}

44 
ölöe
 
	$khash_°r2öt_de°roy
(*
_hash
)

46 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

47 i‡(
hash
Ë
	`kh_de°roy
(
°r2öt
, hash);

48 
	}
}

53 
ölöe
 
	$khash_°r2öt_de°roy_‰ì
(*
_hash
)

55 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

56 
khöt_t
 
k
;

57 i‡(
hash
 == 0) ;

58 
k
 = 0; k < 
	`kh_íd
(
hash
); ++k)

59 i‡(
	`kh_exi°
(
hash
, 
k
)Ë
	`‰ì
((*)
	`kh_key
(hash, k));

60 
	`kh_de°roy
(
°r2öt
, 
hash
);

61 
	}
}

66 
ölöe
 
	$khash_°r2öt_has_key
(*
_hash
, c⁄° *
°r
)

68 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

69 
khöt_t
 
k
 = 
	`kh_gë
(
°r2öt
, 
hash
, 
°r
);

70 i‡–
k
 =
	`kh_íd
(
hash
) )  0;

72 
	}
}

78 
ölöe
 
	$khash_°r2öt_gë
(*
_hash
, c⁄° *
°r
, *
vÆue
)

80 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

81 
khöt_t
 
k
;

82 i‡–!
hash
 )  -1;

83 
k
 = 
	`kh_gë
(
°r2öt
, 
hash
, 
°r
);

84 i‡–
k
 =
	`kh_íd
(
hash
) )  -1;

85 i‡–!
vÆue
 )  0;

86 *
vÆue
 = 
	`kh_vÆ
(
hash
, 
k
);

88 
	}
}

96 
ölöe
 
	$khash_°r2öt_öc
(*
_hash
, c⁄° *
°r
)

98 
khöt_t
 
k
;

99 
ªt
;

100 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

101 i‡–!
hash
 )  -1;

102 
k
 = 
	`kh_put
(
°r2öt
, 
hash
, 
°r
, &
ªt
);

103 i‡(
ªt
 =0Ë 
	`kh_vÆ
(
hash
, 
k
);

104 
	`kh_vÆ
(
hash
, 
k
Ë
	`kh_size
(hash) - 1;

105  
	`kh_vÆ
(
hash
, 
k
);

106 
	}
}

113 
ölöe
 
	$khash_°r2öt_£t
(*
_hash
, c⁄° *
°r
, 
vÆue
)

115 
khöt_t
 
k
;

116 
ªt
;

117 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

118 i‡–!
hash
 )  -1;

119 
k
 = 
	`kh_put
(
°r2öt
, 
hash
, 
°r
, &
ªt
);

120 
	`kh_vÆ
(
hash
,
k
Ë
vÆue
;

121  
k
;

122 
	}
}

127 
ölöe
 
	$khash_°r2öt_size
(*
_hash
)

129 
	`khash_t
(
°r2öt
Ë*
hash
 = (khash_t(°r2öt)*)
_hash
;

130  
	`kh_size
(
hash
);

131 
	}
}

	@htslib/htslib/klist.h

26 #i‚de‡
_AC_KLIST_H


27 
	#_AC_KLIST_H


	)

29 
	~<°dlib.h
>

31 #i‚de‡
klib_unu£d


32 #i‡(
deföed
 
__˛™g__
 && 
__˛™g_maj‹__
 >3Ë|| (deföed 
__GNUC__
 && __GNUC__ >= 3)

33 
	#klib_unu£d
 
	`__©åibuã__
 ((
__unu£d__
))

	)

35 
	#klib_unu£d


	)

39 
	#KMEMPOOL_INIT2
(
SCOPE
, 
«me
, 
km±y≥_t
, 
kmp‰ì_f
) \

41 
size_t
 
˙t
, 
n
, 
max
; \

42 
km±y≥_t
 **
buf
; \

43 } 
	tkmp_
##
	t«me
##
	t_t
; \

44 
SCOPE
 
kmp_
##
«me
##
_t
 *
kmp_öô_
##
	`«me
() { \

45  
	`ˇŒoc
(1, (
kmp_
##
«me
##
_t
)); \

47 
SCOPE
 
kmp_de°roy_
##
	`«me
(
kmp_
##
«me
##
_t
 *
mp
) { \

48 
size_t
 
k
; \

49 
k
 = 0; k < 
mp
->
n
; ++k) { \

50 
	`kmp‰ì_f
(
mp
->
buf
[
k
]); 
	`‰ì
(mp->buf[k]); \

52 
	`‰ì
(
mp
->
buf
); free(mp); \

54 
SCOPE
 
km±y≥_t
 *
kmp_Æloc_
##
	`«me
(
kmp_
##
«me
##
_t
 *
mp
) { \

55 ++
mp
->
˙t
; \

56 i‡(
mp
->
n
 =0Ë 
	`ˇŒoc
(1, (
km±y≥_t
)); \

57  
mp
->
buf
[--mp->
n
]; \

59 
SCOPE
 
kmp_‰ì_
##
	`«me
(
kmp_
##
«me
##
_t
 *
mp
, 
km±y≥_t
 *
p
) { \

60 --
mp
->
˙t
; \

61 i‡(
mp
->
n
 =mp->
max
) { \

62 
mp
->
max
 = mp->max? mp->max<<1 : 16; \

63 
mp
->
buf
 = 
	`ªÆloc
(mp->buf, (
km±y≥_t
 *Ë* mp->
max
); \

65 
mp
->
buf
[mp->
n
++] = 
p
; \

66 }

	)

68 
	#KMEMPOOL_INIT
(
«me
, 
km±y≥_t
, 
kmp‰ì_f
) \

69 
	`KMEMPOOL_INIT2
(
ölöe
 
klib_unu£d
, 
«me
, 
km±y≥_t
, 
kmp‰ì_f
)

	)

71 
	#kmempoﬁ_t
(
«me
Ë
kmp_
##«me##
_t


	)

72 
	#kmp_öô
(
«me
Ë
kmp_öô_
##
	`«me
()

	)

73 
	#kmp_de°roy
(
«me
, 
mp
Ë
kmp_de°roy_
##
	`«me
(mp)

	)

74 
	#kmp_Æloc
(
«me
, 
mp
Ë
kmp_Æloc_
##
	`«me
(mp)

	)

75 
	#kmp_‰ì
(
«me
, 
mp
, 
p
Ë
kmp_‰ì_
##
	`«me
(mp,Ö)

	)

77 
	#KLIST_INIT2
(
SCOPE
, 
«me
, 
k…y≥_t
, 
kmp‰ì_t
) \

78 
__kl1_
##
«me
 { \

79 
k…y≥_t
 
d©a
; \

80 
__kl1_
##
«me
 *
√xt
; \

82 
__kl1_
##
	t«me
 
	tkl1_
##name; \

83 
	`KMEMPOOL_INIT2
(
SCOPE
, 
«me
, 
kl1_
##«me, 
kmp‰ì_t
) \

85 
kl1_
##
«me
 *
hód
, *
èû
; \

86 
kmp_
##
«me
##
_t
 *
mp
; \

87 
size_t
 
size
; \

88 } 
	tkl_
##
	t«me
##
	t_t
; \

89 
SCOPE
 
kl_
##
«me
##
_t
 *
kl_öô_
##
	`«me
() { \

90 
kl_
##
«me
##
_t
 *
kl
 = 
	`ˇŒoc
(1, (kl_##name##_t)); \

91 
kl
->
mp
 = 
	`kmp_öô
(
«me
); \

92 
kl
->
hód
 = kl->
èû
 = 
	`kmp_Æloc
(
«me
, kl->
mp
); \

93 
kl
->
hód
->
√xt
 = 0; \

94  
kl
; \

96 
SCOPE
 
kl_de°roy_
##
	`«me
(
kl_
##
«me
##
_t
 *
kl
) { \

97 
kl1_
##
«me
 *
p
; \

98 
p
 = 
kl
->
hód
;Ö !kl->
èû
;Ö =Ö->
√xt
) \

99 
	`kmp_‰ì
(
«me
, 
kl
->
mp
, 
p
); \

100 
	`kmp_‰ì
(
«me
, 
kl
->
mp
, 
p
); \

101 
	`kmp_de°roy
(
«me
, 
kl
->
mp
); \

102 
	`‰ì
(
kl
); \

104 
SCOPE
 
k…y≥_t
 *
kl_pushp_
##
	`«me
(
kl_
##
«me
##
_t
 *
kl
) { \

105 
kl1_
##
«me
 *
q
, *
p
 = 
	`kmp_Æloc
“ame, 
kl
->
mp
); \

106 
q
 = 
kl
->
èû
; 
p
->
√xt
 = 0; kl->tail->next =Ö; kl->tail =Ö; \

107 ++
kl
->
size
; \

108  &
q
->
d©a
; \

110 
SCOPE
 
kl_shi·_
##
	`«me
(
kl_
##
«me
##
_t
 *
kl
, 
k…y≥_t
 *
d
) { \

111 
kl1_
##
«me
 *
p
; \

112 i‡(
kl
->
hód
->
√xt
 == 0)  -1; \

113 --
kl
->
size
; \

114 
p
 = 
kl
->
hód
; kl->hód = kl->hód->
√xt
; \

115 i‡(
d
Ë*d = 
p
->
d©a
; \

116 
	`kmp_‰ì
(
«me
, 
kl
->
mp
, 
p
); \

118 }

	)

120 
	#KLIST_INIT
(
«me
, 
k…y≥_t
, 
kmp‰ì_t
) \

121 
	`KLIST_INIT2
(
ölöe
 
klib_unu£d
, 
«me
, 
k…y≥_t
, 
kmp‰ì_t
)

	)

123 
	#klôî_t
(
«me
Ë
kl1_
##
	)
name

124 
	#kli°_t
(
«me
Ë
kl_
##«me##
_t


	)

125 
	#kl_vÆ
(
ôî
Ë((ôî)->
d©a
)

	)

126 
	#kl_√xt
(
ôî
Ë((ôî)->
√xt
)

	)

127 
	#kl_begö
(
kl
Ë((kl)->
hód
)

	)

128 
	#kl_íd
(
kl
Ë((kl)->
èû
)

	)

130 
	#kl_öô
(
«me
Ë
kl_öô_
##
	`«me
()

	)

131 
	#kl_de°roy
(
«me
, 
kl
Ë
kl_de°roy_
##
	`«me
(kl)

	)

132 
	#kl_pushp
(
«me
, 
kl
Ë
kl_pushp_
##
	`«me
(kl)

	)

133 
	#kl_shi·
(
«me
, 
kl
, 
d
Ë
kl_shi·_
##
	`«me
(kl, d)

	)

	@htslib/htslib/knetfile.h

27 #i‚de‡
KNETFILE_H


28 
	#KNETFILE_H


	)

30 
	~<°döt.h
>

31 
	~<f˙é.h
>

32 
	~<sys/ty≥s.h
>

34 #i‚de‡
_WIN32


35 
	#√åód
(
fd
, 
±r
, 
Àn
Ë
	`ªad
(fd,Öå,Üí)

	)

36 
	#√twrôe
(
fd
, 
±r
, 
Àn
Ë
	`wrôe
(fd,Öå,Üí)

	)

37 
	#√t˛o£
(
fd
Ë
	`˛o£
(fd)

	)

39 
	~<wösock2.h
>

40 
	#√åód
(
fd
, 
±r
, 
Àn
Ë
	`ªcv
(fd,Öå,Üí, 0)

	)

41 
	#√twrôe
(
fd
, 
±r
, 
Àn
Ë
	`£nd
(fd,Öå,Üí, 0)

	)

42 
	#√t˛o£
(
fd
Ë
	`˛o£sockë
(fd)

	)

47 
	#KNF_TYPE_LOCAL
 1

	)

48 
	#KNF_TYPE_FTP
 2

	)

49 
	#KNF_TYPE_HTTP
 3

	)

51 
	sk√tFûe_s
 {

52 
	mty≥
, 
	mfd
;

53 
öt64_t
 
	moff£t
;

54 *
	mho°
, *
	mp‹t
;

57 
	m˘æ_fd
, 
	m∑sv_ù
[4], 
	m∑sv_p‹t
, 
	mmax_ª•⁄£
, 
	mno_ªc⁄√˘
, 
	mis_ªady
;

58 *
	mª•⁄£
, *
	mªå
, *
	msize_cmd
;

59 
öt64_t
 
	m£ek_off£t
;

60 
öt64_t
 
	mfûe_size
;

63 *
	m∑th
, *
	mhâp_ho°
;

64 } 
	tk√tFûe
;

66 
	#k√t_ãŒ
(
Â
Ë((Â)->
off£t
)

	)

67 
	#k√t_fûío
(
Â
Ë((Â)->
fd
)

	)

69 #ifde‡
__˝lu•lus


73 #ifde‡
_WIN32


74 
k√t_wö32_öô
();

75 
k√t_wö32_de°roy
();

78 
k√tFûe
 *
k√t_›í
(c⁄° *
‚
, c⁄° *
mode
);

83 
k√tFûe
 *
k√t_d›í
(
fd
, c⁄° *
mode
);

89 
ssize_t
 
k√t_ªad
(
k√tFûe
 *
Â
, *
buf
, 
size_t
 
Àn
);

95 
off_t
 
k√t_£ek
(
k√tFûe
 *
Â
, off_à
off
, 
whí˚
);

96 
k√t_˛o£
(
k√tFûe
 *
Â
);

98 #ifde‡
__˝lu•lus


	@htslib/htslib/kseq.h

28 #i‚de‡
AC_KSEQ_H


29 
	#AC_KSEQ_H


	)

31 
	~<˘y≥.h
>

32 
	~<°rög.h
>

33 
	~<°dlib.h
>

35 
	#KS_SEP_SPACE
 0

36 
	#KS_SEP_TAB
 1

37 
	#KS_SEP_LINE
 2

38 
	#KS_SEP_MAX
 2

	)

40 
	#__KS_TYPE
(
ty≥_t
) \

41 
	s__k°ªam_t
 { \

42 
begö
, 
íd
; \

43 
is_eof
:2, 
bufsize
:30; \

44 
uöt64_t
 
£ek_pos
; \

45 
ty≥_t
 
f
; \

46 *
buf
; \

47 } 
	tk°ªam_t
;

	)

49 
	#ks_eof
(
ks
Ë((ks)->
is_eof
 && (ks)->
begö
 >(ks)->
íd
)

	)

50 
	#ks_ªwöd
(
ks
Ë((ks)->
is_eof
 = (ks)->
begö
 = (ks)->
íd
 = 0)

	)

52 
	#__KS_BASIC
(
SCOPE
, 
ty≥_t
, 
__bufsize
) \

53 
SCOPE
 
k°ªam_t
 *
	`ks_öô
(
ty≥_t
 
f
) \

55 
k°ªam_t
 *
ks
 = (k°ªam_t*)
	`ˇŒoc
(1, (kstream_t)); \

56 
ks
->
f
 = f; ks->
bufsize
 = 
__bufsize
; \

57 
ks
->
buf
 = (*)
	`mÆloc
(
__bufsize
); \

58  
ks
; \

60 
SCOPE
 
	`ks_de°roy
(
k°ªam_t
 *
ks
) \

62 i‡(!
ks
) ; \

63 
	`‰ì
(
ks
->
buf
); \

64 
	`‰ì
(
ks
); \

65 }

	)

67 
	#__KS_INLINED
(
__ªad
) \

68 
ölöe
 
	`ks_gëc
(
k°ªam_t
 *
ks
) \

70 i‡(
ks
->
is_eof
 && ks->
begö
 >ks->
íd
)  -1; \

71 i‡(
ks
->
begö
 >ks->
íd
) { \

72 
ks
->
begö
 = 0; \

73 
ks
->
íd
 = 
	`__ªad
(ks->
f
, ks->
buf
, ks->
bufsize
); \

74 i‡(
ks
->
íd
 =0Ë{ ks->
is_eof
 = 1;  -1; } \

76 
ks
->
£ek_pos
++; \

77  ()
ks
->
buf
[ks->
begö
++]; \

79 
ölöe
 
	`ks_gëu¡û
(
k°ªam_t
 *
ks
, 
dñimôî
, 
k°rög_t
 *
°r
, *
dªt
) \

80 {  
	`ks_gëu¡û2
(
ks
, 
dñimôî
, 
°r
, 
dªt
, 0); }

	)

82 #i‚de‡
KSTRING_T


83 
	#KSTRING_T
 
k°rög_t


	)

84 
	s__k°rög_t
 {

85 
size_t
 
	ml
, 
	mm
;

86 *
	ms
;

87 } 
	tk°rög_t
;

90 #i‚de‡
kroundup32


91 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

94 
	#__KS_GETUNTIL
(
SCOPE
, 
__ªad
) \

95 
SCOPE
 
	`ks_gëu¡û2
(
k°ªam_t
 *
ks
, 
dñimôî
, 
k°rög_t
 *
°r
, *
dªt
, 
≠≥nd
) \

97 
gŸ™y
 = 0; \

98 i‡(
dªt
) *dret = 0; \

99 
°r
->
l
 = 
≠≥nd
? str->l : 0; \

100 
uöt64_t
 
£ek_pos
 = 
°r
->
l
; \

102 
i
; \

103 i‡(
ks
->
begö
 >ks->
íd
) { \

104 i‡(!
ks
->
is_eof
) { \

105 
ks
->
begö
 = 0; \

106 
ks
->
íd
 = 
	`__ªad
(ks->
f
, ks->
buf
, ks->
bufsize
); \

107 i‡(
ks
->
íd
 =0Ë{ ks->
is_eof
 = 1; ; } \

110 i‡(
dñimôî
 =
KS_SEP_LINE
) { \

111 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

112 i‡(
ks
->
buf
[
i
] == '\n') ; \

113 } i‡(
dñimôî
 > 
KS_SEP_MAX
) { \

114 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

115 i‡(
ks
->
buf
[
i
] =
dñimôî
) ; \

116 } i‡(
dñimôî
 =
KS_SEP_SPACE
) { \

117 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

118 i‡(
	`is•a˚
(
ks
->
buf
[
i
])) ; \

119 } i‡(
dñimôî
 =
KS_SEP_TAB
) { \

120 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

121 i‡(
	`is•a˚
(
ks
->
buf
[
i
]) && ks->buf[i] != ' ') ; \

122 } 
i
 = 0; \

123 i‡(
°r
->
m
 - så->
l
 < (
size_t
)(
i
 - 
ks
->
begö
 + 1)) { \

124 
°r
->
m
 = så->
l
 + (
i
 - 
ks
->
begö
) + 1; \

125 
	`kroundup32
(
°r
->
m
); \

126 
°r
->
s
 = (*)
	`ªÆloc
(°r->s, så->
m
); \

128 
£ek_pos
 +
i
 - 
ks
->
begö
; i‡–ò< ks->
íd
 ) seek_pos++; \

129 
gŸ™y
 = 1; \

130 
	`mem˝y
(
°r
->
s
 + så->
l
, 
ks
->
buf
 + ks->
begö
, 
i
 - ks->begin); \

131 
°r
->
l
 = så->»+ (
i
 - 
ks
->
begö
); \

132 
ks
->
begö
 = 
i
 + 1; \

133 i‡(
i
 < 
ks
->
íd
) { \

134 i‡(
dªt
Ë*dªà
ks
->
buf
[
i
]; \

138 i‡(!
gŸ™y
 && 
	`ks_eof
(
ks
))  -1; \

139 
ks
->
£ek_pos
 += seek_pos; \

140 i‡(
°r
->
s
 == 0) { \

141 
°r
->
m
 = 1; \

142 
°r
->
s
 = (*)
	`ˇŒoc
(1, 1); \

143 } i‡(
dñimôî
 =
KS_SEP_LINE
 && 
°r
->
l
 > 1 && så->
s
[str->l-1] == '\r') --str->l; \

144 
°r
->
s
[°r->
l
] = '\0'; \

145  
°r
->
l
; \

146 }

	)

148 
	#KSTREAM_INIT2
(
SCOPE
, 
ty≥_t
, 
__ªad
, 
__bufsize
) \

149 
	`__KS_TYPE
(
ty≥_t
) \

150 
	`__KS_BASIC
(
SCOPE
, 
ty≥_t
, 
__bufsize
) \

151 
	`__KS_GETUNTIL
(
SCOPE
, 
__ªad
) \

152 
	`__KS_INLINED
(
__ªad
)

	)

154 
	#KSTREAM_INIT
(
ty≥_t
, 
__ªad
, 
__bufsize
Ë
	`KSTREAM_INIT2
(,Åy≥_t, __ªad, __bufsize)

	)

156 
	#KSTREAM_DECLARE
(
ty≥_t
, 
__ªad
) \

157 
	`__KS_TYPE
(
ty≥_t
) \

158 
	`ks_gëu¡û2
(
k°ªam_t
 *
ks
, 
dñimôî
, 
k°rög_t
 *
°r
, *
dªt
, 
≠≥nd
); \

159 
k°ªam_t
 *
	`ks_öô
(
ty≥_t
 
f
); \

160 
	`ks_de°roy
(
k°ªam_t
 *
ks
); \

161 
	`__KS_INLINED
(
__ªad
)

	)

167 
	#k£q_ªwöd
(
ks
Ë((ks)->
œ°_ch¨
 = (ks)->
f
->
is_eof
 = (ks)->f->
begö
 = (ks)->f->
íd
 = 0)

	)

169 
	#__KSEQ_BASIC
(
SCOPE
, 
ty≥_t
) \

170 
SCOPE
 
k£q_t
 *
	`k£q_öô
(
ty≥_t
 
fd
) \

172 
k£q_t
 *
s
 = (k£q_t*)
	`ˇŒoc
(1, (kseq_t)); \

173 
s
->
f
 = 
	`ks_öô
(
fd
); \

174  
s
; \

176 
SCOPE
 
	`k£q_de°roy
(
k£q_t
 *
ks
) \

178 i‡(!
ks
) ; \

179 
	`‰ì
(
ks
->
«me
.
s
); fªe(ks->
commít
.s); fªe(ks->
£q
.s); fªe(ks->
quÆ
.s); \

180 
	`ks_de°roy
(
ks
->
f
); \

181 
	`‰ì
(
ks
); \

182 }

	)

189 
	#__KSEQ_READ
(
SCOPE
) \

190 
SCOPE
 
	`k£q_ªad
(
k£q_t
 *
£q
) \

192 
c
; \

193 
k°ªam_t
 *
ks
 = 
£q
->
f
; \

194 i‡(
£q
->
œ°_ch¨
 == 0) { \

195 (
c
 = 
	`ks_gëc
(
ks
)) != -1 && c != '>' && c != '@'); \

196 i‡(
c
 == -1)  -1; \

197 
£q
->
œ°_ch¨
 = 
c
; \

199 
£q
->
commít
.
l
 = seq->£q.»£q->
quÆ
.l = 0; \

200 i‡(
	`ks_gëu¡û
(
ks
, 0, &
£q
->
«me
, &
c
) < 0)  -1; \

201 i‡(
c
 !'\n'Ë
	`ks_gëu¡û
(
ks
, 
KS_SEP_LINE
, &
£q
->
commít
, 0); \

202 i‡(
£q
->£q.
s
 == 0) { \

203 
£q
->£q.
m
 = 256; \

204 
£q
->£q.
s
 = (*)
	`mÆloc
(£q->£q.
m
); \

206 (
c
 = 
	`ks_gëc
(
ks
)) != -1 && c != '>' && c != '+' && c != '@') { \

207 i‡(
c
 == '\n') ; \

208 
£q
->£q.
s
[£q->£q.
l
++] = 
c
; \

209 
	`ks_gëu¡û2
(
ks
, 
KS_SEP_LINE
, &
£q
->seq, 0, 1); \

211 i‡(
c
 ='>' || c ='@'Ë
£q
->
œ°_ch¨
 = c; \

212 i‡(
£q
->£q.
l
 + 1 >£q->£q.
m
) { \

213 
£q
->£q.
m
 = seq->£q.
l
 + 2; \

214 
	`kroundup32
(
£q
->£q.
m
); \

215 
£q
->£q.
s
 = (*)
	`ªÆloc
(£q->£q.s, seq->£q.
m
); \

217 
£q
->£q.
s
[£q->£q.
l
] = 0; \

218 i‡(
c
 !'+'Ë 
£q
->£q.
l
; \

219 i‡(
£q
->
quÆ
.
m
 < seq->seq.m) { \

220 
£q
->
quÆ
.
m
 = seq->seq.m; \

221 
£q
->
quÆ
.
s
 = (*)
	`ªÆloc
(£q->quÆ.s, seq->quÆ.
m
); \

223 (
c
 = 
	`ks_gëc
(
ks
)) != -1 && c != '\n'); \

224 i‡(
c
 == -1)  -2; \

225 
	`ks_gëu¡û2
(
ks
, 
KS_SEP_LINE
, &
£q
->
quÆ
, 0, 1Ë>0 && seq->quÆ.
l
 < seq->seq.l); \

226 
£q
->
œ°_ch¨
 = 0; \

227 i‡(
£q
->£q.
l
 !£q->
quÆ
.l)  -2; \

228  
£q
->£q.
l
; \

229 }

	)

231 
	#__KSEQ_TYPE
(
ty≥_t
) \

233 
k°rög_t
 
«me
, 
commít
, 
£q
, 
quÆ
; \

234 
œ°_ch¨
; \

235 
k°ªam_t
 *
f
; \

236 } 
	tk£q_t
;

	)

238 
	#KSEQ_INIT2
(
SCOPE
, 
ty≥_t
, 
__ªad
) \

239 
	`KSTREAM_INIT
(
ty≥_t
, 
__ªad
, 16384) \

240 
	`__KSEQ_TYPE
(
ty≥_t
) \

241 
	`__KSEQ_BASIC
(
SCOPE
, 
ty≥_t
) \

242 
	`__KSEQ_READ
(
SCOPE
)

	)

244 
	#KSEQ_INIT
(
ty≥_t
, 
__ªad
Ë
	`KSEQ_INIT2
(,Åy≥_t, __ªad)

	)

246 
	#KSEQ_DECLARE
(
ty≥_t
) \

247 
	`__KS_TYPE
(
ty≥_t
) \

248 
	`__KSEQ_TYPE
(
ty≥_t
) \

249 
k£q_t
 *
	`k£q_öô
(
ty≥_t
 
fd
); \

250 
	`k£q_de°roy
(
k£q_t
 *
ks
); \

251 
	`k£q_ªad
(
k£q_t
 *
£q
);

	)

	@htslib/htslib/ksort.h

62 #i‚de‡
AC_KSORT_H


63 
	#AC_KSORT_H


	)

65 
	~<°dlib.h
>

66 
	~<°rög.h
>

69 *
	mÀ·
, *
	mright
;

70 
	mdïth
;

71 } 
	tks_is‹t_°ack_t
;

73 
	#KSORT_SWAP
(
ty≥_t
, 
a
, 
b
Ë{ ty≥_à
t
=◊); (a)=(b); (b)Ò; }

	)

75 
	#KSORT_INIT
(
«me
, 
ty≥_t
, 
__s‹t_…
) \

76 
ks_mîges‹t_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
¨øy
[],Åy≥_à
ãmp
[]) \

78 
ty≥_t
 *
a2
[2], *
a
, *
b
; \

79 
cuº
, 
shi·
; \

81 
a2
[0] = 
¨øy
; \

82 
a2
[1] = 
ãmp
?Åem∞: (
ty≥_t
*)
	`mÆloc
(—y≥_tË* 
n
); \

83 
cuº
 = 0, 
shi·
 = 0; (1ul<<shi·Ë< 
n
; ++shift) { \

84 
a
 = 
a2
[
cuº
]; 
b
 =á2[1-curr]; \

85 i‡(
shi·
 == 0) { \

86 
ty≥_t
 *
p
 = 
b
, *
i
, *
eb
 = 
a
 + 
n
; \

87 
i
 = 
a
; i < 
eb
; i += 2) { \

88 i‡(
i
 =
eb
 - 1Ë*
p
++ = *i; \

90 i‡(
	`__s‹t_…
(*(
i
+1), *i)) { \

91 *
p
++ = *(
i
+1); *p++ = *i; \

93 *
p
++ = *
i
; *p++ = *(i+1); \

98 
size_t
 
i
, 
°ï
 = 1ul<<
shi·
; \

99 
i
 = 0; i < 
n
; i +
°ï
<<1) { \

100 
ty≥_t
 *
p
, *
j
, *
k
, *
ó
, *
eb
; \

101 i‡(
n
 < 
i
 + 
°ï
) { \

102 
ó
 = 
a
 + 
n
; 
eb
 =á; \

104 
ó
 = 
a
 + 
i
 + 
°ï
; \

105 
eb
 = 
a
 + (
n
 < 
i
 + (
°ï
<<1)?Ç : i + (step<<1)); \

107 
j
 = 
a
 + 
i
; 
k
 =á + i + 
°ï
; 
p
 = 
b
 + i; \

108 
j
 < 
ó
 && 
k
 < 
eb
) { \

109 i‡(
	`__s‹t_…
(*
k
, *
j
)Ë*
p
++ = *k++; \

110 *
p
++ = *
j
++; \

112 
j
 < 
ó
Ë*
p
++ = *j++; \

113 
k
 < 
eb
Ë*
p
++ = *k++; \

116 
cuº
 = 1 - curr; \

118 i‡(
cuº
 == 1) { \

119 
ty≥_t
 *
p
 = 
a2
[0], *
i
 =á2[1], *
eb
 = 
¨øy
 + 
n
; \

120 ; 
p
 < 
eb
; ++
i
) *p++ = *i; \

122 i‡(
ãmp
 =0Ë
	`‰ì
(
a2
[1]); \

124 
ks_hó∑dju°_
##
	`«me
(
size_t
 
i
, size_à
n
, 
ty≥_t
 
l
[]) \

126 
size_t
 
k
 = 
i
; \

127 
ty≥_t
 
tmp
 = 
l
[
i
]; \

128 (
k
 = (k << 1Ë+ 1Ë< 
n
) { \

129 i‡(
k
 !
n
 - 1 && 
	`__s‹t_…
(
l
[k],Ü[k+1])) ++k; \

130 i‡(
	`__s‹t_…
(
l
[
k
], 
tmp
)) ; \

131 
l
[
i
] =Ü[
k
]; i = k; \

133 
l
[
i
] = 
tmp
; \

135 
ks_hópmake_
##
	`«me
(
size_t
 
lsize
, 
ty≥_t
 
l
[]) \

137 
size_t
 
i
; \

138 
i
 = (
lsize
 >> 1Ë- 1; i !(
size_t
)(-1); --i) \

139 
ks_hó∑dju°_
##
	`«me
(
i
, 
lsize
, 
l
); \

141 
ks_hóps‹t_
##
	`«me
(
size_t
 
lsize
, 
ty≥_t
 
l
[]) \

143 
size_t
 
i
; \

144 
i
 = 
lsize
 - 1; i > 0; --i) { \

145 
ty≥_t
 
tmp
; \

146 
tmp
 = *
l
; *»l[
i
];Ü[i] =Åmp; 
ks_hó∑dju°_
##
	`«me
(0, i,Ü); \

149 
ölöe
 
__ks_ö£πs‹t_
##
	`«me
(
ty≥_t
 *
s
,Åy≥_à*
t
) \

151 
ty≥_t
 *
i
, *
j
, 
sw≠_tmp
; \

152 
i
 = 
s
 + 1; i < 
t
; ++i) \

153 
j
 = 
i
; j > 
s
 && 
	`__s‹t_…
(*j, *(j-1)); --j) { \

154 
sw≠_tmp
 = *
j
; *j = *(j-1); *(j-1) = swap_tmp; \

157 
ks_combs‹t_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
a
[]) \

159 c⁄° 
shrök_Á˘‹
 = 1.2473309501039786540366528676643; \

160 
do_sw≠
; \

161 
size_t
 
g≠
 = 
n
; \

162 
ty≥_t
 
tmp
, *
i
, *
j
; \

164 i‡(
g≠
 > 2) { \

165 
g≠
 = (
size_t
)(g≠ / 
shrök_Á˘‹
); \

166 i‡(
g≠
 == 9 || gap == 10) gap = 11; \

168 
do_sw≠
 = 0; \

169 
i
 = 
a
; i <á + 
n
 - 
g≠
; ++i) { \

170 
j
 = 
i
 + 
g≠
; \

171 i‡(
	`__s‹t_…
(*
j
, *
i
)) { \

172 
tmp
 = *
i
; *ò*
j
; *j =Åmp; \

173 
do_sw≠
 = 1; \

176 } 
do_sw≠
 || 
g≠
 > 2); \

177 i‡(
g≠
 !1Ë
__ks_ö£πs‹t_
##
	`«me
(
a
,á + 
n
); \

179 
ks_öåos‹t_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
a
[]) \

181 
d
; \

182 
ks_is‹t_°ack_t
 *
t›
, *
°ack
; \

183 
ty≥_t
 
Ω
, 
sw≠_tmp
; \

184 
ty≥_t
 *
s
, *
t
, *
i
, *
j
, *
k
; \

186 i‡(
n
 < 1) ; \

187 i‡(
n
 == 2) { \

188 i‡(
	`__s‹t_…
(
a
[1],á[0])Ë{ 
sw≠_tmp
 =á[0];á[0] =á[1];á[1] = swap_tmp; } \

191 
d
 = 2; 1ul<<d < 
n
; ++d); \

192 
°ack
 = (
ks_is‹t_°ack_t
*)
	`mÆloc
((ks_is‹t_°ack_tË* (((
size_t
)*
d
)+2)); \

193 
t›
 = 
°ack
; 
s
 = 
a
; 
t
 =á + (
n
-1); 
d
 <<= 1; \

195 i‡(
s
 < 
t
) { \

196 i‡(--
d
 == 0) { \

197 
ks_combs‹t_
##
	`«me
(
t
 - 
s
 + 1, s); \

198 
t
 = 
s
; \

201 
i
 = 
s
; 
j
 = 
t
; 
k
 = i + ((j-i)>>1) + 1; \

202 i‡(
	`__s‹t_…
(*
k
, *
i
)) { \

203 i‡(
	`__s‹t_…
(*
k
, *
j
)) k = j; \

204 } 
k
 = 
	`__s‹t_…
(*
j
, *
i
)? i : j; \

205 
Ω
 = *
k
; \

206 i‡(
k
 !
t
Ë{ 
sw≠_tmp
 = *k; *k = *t; *t = swap_tmp; } \

208 dÿ++
i
; 
	`__s‹t_…
(*i, 
Ω
)); \

209 dÿ--
j
; 
i
 <j && 
	`__s‹t_…
(
Ω
, *j)); \

210 i‡(
j
 <
i
) ; \

211 
sw≠_tmp
 = *
i
; *ò*
j
; *j = swap_tmp; \

213 
sw≠_tmp
 = *
i
; *ò*
t
; *t = swap_tmp; \

214 i‡(
i
-
s
 > 
t
-i) { \

215 i‡(
i
-
s
 > 16Ë{ 
t›
->
À·
 = s;Å›->
right
 = i-1;Å›->
dïth
 = 
d
; ++top; } \

216 
s
 = 
t
-
i
 > 16? i+1 :Å; \

218 i‡(
t
-
i
 > 16Ë{ 
t›
->
À·
 = i+1;Å›->
right
 =Å;Å›->
dïth
 = 
d
; ++top; } \

219 
t
 = 
i
-
s
 > 16? i-1 : s; \

222 i‡(
t›
 =
°ack
) { \

223 
	`‰ì
(
°ack
); \

224 
__ks_ö£πs‹t_
##
	`«me
(
a
,á+
n
); \

226 } { --
t›
; 
s
 = (
ty≥_t
*È›->
À·
; 
t
 = (ty≥_t*È›->
right
; 
d
 =Å›->
dïth
; } \

232 
ty≥_t
 
ks_ksmÆl_
##
	`«me
(
size_t
 
n
,Åy≥_à
¨r
[], size_à
kk
) \

234 
ty≥_t
 *
low
, *
high
, *
k
, *
Œ
, *
hh
, *
mid
; \

235 
low
 = 
¨r
; 
high
 =áº + 
n
 - 1; 
k
 =áº + 
kk
; \

237 i‡(
high
 <
low
Ë *
k
; \

238 i‡(
high
 =
low
 + 1) { \

239 i‡(
	`__s‹t_…
(*
high
, *
low
)Ë
	`KSORT_SWAP
(
ty≥_t
, *low, *high); \

240  *
k
; \

242 
mid
 = 
low
 + (
high
 -Üow) / 2; \

243 i‡(
	`__s‹t_…
(*
high
, *
mid
)Ë
	`KSORT_SWAP
(
ty≥_t
, *mid, *high); \

244 i‡(
	`__s‹t_…
(*
high
, *
low
)Ë
	`KSORT_SWAP
(
ty≥_t
, *low, *high); \

245 i‡(
	`__s‹t_…
(*
low
, *
mid
)Ë
	`KSORT_SWAP
(
ty≥_t
, *mid, *low); \

246 
	`KSORT_SWAP
(
ty≥_t
, *
mid
, *(
low
+1)); \

247 
Œ
 = 
low
 + 1; 
hh
 = 
high
; \

249 dÿ++
Œ
; 
	`__s‹t_…
(*Œ, *
low
)); \

250 dÿ--
hh
; 
	`__s‹t_…
(*
low
, *hh)); \

251 i‡(
hh
 < 
Œ
) ; \

252 
	`KSORT_SWAP
(
ty≥_t
, *
Œ
, *
hh
); \

254 
	`KSORT_SWAP
(
ty≥_t
, *
low
, *
hh
); \

255 i‡(
hh
 <
k
Ë
low
 = 
Œ
; \

256 i‡(
hh
 >
k
Ë
high
 = hh - 1; \

259 
ks_shufÊe_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
a
[]) \

261 
i
, 
j
; \

262 
i
 = 
n
; i > 1; --i) { \

263 
ty≥_t
 
tmp
; \

264 
j
 = ()(
	`dønd48
(Ë* 
i
); \

265 
tmp
 = 
a
[
j
];á[j] =á[
i
-1];á[i-1] =Åmp; \

267 }

	)

269 
	#ks_mîges‹t
(
«me
, 
n
, 
a
, 
t
Ë
ks_mîges‹t_
##
	`«me
“,á,Å)

	)

270 
	#ks_öåos‹t
(
«me
, 
n
, 
a
Ë
ks_öåos‹t_
##
	`«me
“,á)

	)

271 
	#ks_combs‹t
(
«me
, 
n
, 
a
Ë
ks_combs‹t_
##
	`«me
“,á)

	)

272 
	#ks_hóps‹t
(
«me
, 
n
, 
a
Ë
ks_hóps‹t_
##
	`«me
“,á)

	)

273 
	#ks_hópmake
(
«me
, 
n
, 
a
Ë
ks_hópmake_
##
	`«me
“,á)

	)

274 
	#ks_hó∑dju°
(
«me
, 
i
, 
n
, 
a
Ë
ks_hó∑dju°_
##
	`«me
(i,Ç,á)

	)

275 
	#ks_ksmÆl
(
«me
, 
n
, 
a
, 
k
Ë
ks_ksmÆl_
##
	`«me
“,á, k)

	)

276 
	#ks_shufÊe
(
«me
, 
n
, 
a
Ë
ks_shufÊe_
##
	`«me
“,á)

	)

278 
	#ks_…_gíîic
(
a
, 
b
Ë(◊Ë< (b))

	)

279 
	#ks_…_°r
(
a
, 
b
Ë(
	`°rcmp
(◊), (b)Ë< 0)

	)

281 c⁄° *
	tks°r_t
;

283 
	#KSORT_INIT_GENERIC
(
ty≥_t
Ë
	`KSORT_INIT
—y≥_t,Åy≥_t, 
ks_…_gíîic
)

	)

284 
	#KSORT_INIT_STR
 
	`KSORT_INIT
(
°r
, 
ks°r_t
, 
ks_…_°r
)

	)

	@htslib/htslib/kstring.h

26 #i‚de‡
KSTRING_H


27 
	#KSTRING_H


	)

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<°d¨g.h
>

32 
	~<°döt.h
>

33 
	~<°dio.h
>

35 #i‚de‡
kroundup32


36 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

39 #i‚de‡
kroundup_size_t


40 
	#kroundup_size_t
(
x
) (--(x), \

41 (
x
)|=(x)>>((
size_t
)/8), \

42 (
x
)|=(x)>>((
size_t
)/4), \

43 (
x
)|=(x)>>((
size_t
)/2), \

44 (
x
)|=(x)>>((
size_t
)), \

45 (
x
)|=(x)>>((
size_t
)*2), \

46 (
x
)|=(x)>>((
size_t
)*4), \

47 ++(
x
))

	)

50 #i‡
deföed
 
__GNUC__
 && (__GNUC__ > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 > 4))

51 
	#KS_ATTR_PRINTF
(
fmt
, 
¨g
Ë
	`__©åibuã__
((
	`__f‹m©__
 (
__¥ötf__
, fmt,árg)))

	)

53 
	#KS_ATTR_PRINTF
(
fmt
, 
¨g
)

	)

65 #i‚de‡
KSTRING_T


66 
	#KSTRING_T
 
k°rög_t


	)

67 
	s__k°rög_t
 {

68 
size_t
 
	ml
, 
	mm
;

69 *
	ms
;

70 } 
	tk°rög_t
;

74 
uöt64_t
 
	mèb
[4];

75 
	m£p
, 
	mföished
;

76 c⁄° *
	mp
;

77 } 
	tks_tokaux_t
;

79 #ifde‡
__˝lu•lus


83 
kv•rötf
(
k°rög_t
 *
s
, c⁄° *
fmt
, 
va_li°
 
≠
Ë
KS_ATTR_PRINTF
(2,0);

84 
k•rötf
(
k°rög_t
 *
s
, c⁄° *
fmt
, ...Ë
KS_ATTR_PRINTF
(2,3);

85 
kputd
(
d
, 
k°rög_t
 *
s
);

86 
k•lô_c‹e
(*
s
, 
dñimôî
, *
_max
, **
_off£ts
);

87 *
k°r°r
(c⁄° *
°r
, c⁄° *
∑t
, **
_¥ï
);

88 *
k°∫°r
(c⁄° *
°r
, c⁄° *
∑t
, 
n
, **
_¥ï
);

89 *
kmemmem
(c⁄° *
_°r
, 
n
, c⁄° *
_∑t
, 
m
, **
_¥ï
);

95 *
k°πok
(c⁄° *
°r
, c⁄° *
£p
, 
ks_tokaux_t
 *
aux
);

101 *
	tkgës_func
(*, , *);

102 
kgëlöe
(
k°rög_t
 *
s
, 
kgës_func
 *
fgës
, *
Â
);

104 #ifde‡
__˝lu•lus


108 
ölöe
 
	$ks_ªsize
(
k°rög_t
 *
s
, 
size_t
 
size
)

110 i‡(
s
->
m
 < 
size
) {

111 *
tmp
;

112 
	`kroundup_size_t
(
size
);

113 
tmp
 = (*)
	`ªÆloc
(
s
->s, 
size
);

114 i‡(!
tmp
)

116 
s
->†
tmp
;

117 
s
->
m
 = 
size
;

120 
	}
}

122 
ölöe
 *
	$ks_°r
(
k°rög_t
 *
s
)

124  
s
->s;

125 
	}
}

127 
ölöe
 
size_t
 
	$ks_Àn
(
k°rög_t
 *
s
)

129  
s
->
l
;

130 
	}
}

136 
ölöe
 *
	$ks_ªÀa£
(
k°rög_t
 *
s
)

138 *
ss
 = 
s
->s;

139 
s
->
l
 = s->
m
 = 0;

140 
s
->†
NULL
;

141  
ss
;

142 
	}
}

144 
ölöe
 
	$kput¢
(c⁄° *
p
, 
l
, 
k°rög_t
 *
s
)

146 i‡(
	`ks_ªsize
(
s
, s->
l
 +Ü + 2) < 0)

147  
EOF
;

148 
	`mem˝y
(
s
->†+ s->
l
, 
p
,Ü);

149 
s
->
l
 +=Ü;

150 
s
->s[s->
l
] = 0;

151  
l
;

152 
	}
}

154 
ölöe
 
	$kputs
(c⁄° *
p
, 
k°rög_t
 *
s
)

156  
	`kput¢
(
p
, 
	`°æí
’), 
s
);

157 
	}
}

159 
ölöe
 
	$kputc
(
c
, 
k°rög_t
 *
s
)

161 i‡(
	`ks_ªsize
(
s
, s->
l
 + 2) < 0)

162  
EOF
;

163 
s
->s[s->
l
++] = 
c
;

164 
s
->s[s->
l
] = 0;

165  
c
;

166 
	}
}

168 
ölöe
 
	$kputc_
(
c
, 
k°rög_t
 *
s
)

170 i‡(
	`ks_ªsize
(
s
, s->
l
 + 1) < 0)

171  
EOF
;

172 
s
->s[s->
l
++] = 
c
;

174 
	}
}

176 
ölöe
 
	$kput¢_
(c⁄° *
p
, 
l
, 
k°rög_t
 *
s
)

178 i‡(
	`ks_ªsize
(
s
, s->
l
 +Ü) < 0)

179  
EOF
;

180 
	`mem˝y
(
s
->†+ s->
l
, 
p
,Ü);

181 
s
->
l
 +=Ü;

182  
l
;

183 
	}
}

185 
ölöe
 
	$kputw
(
c
, 
k°rög_t
 *
s
)

187 
buf
[16];

188 
i
, 
l
 = 0;

189 
x
 = 
c
;

190 i‡(
c
 < 0Ë
x
 = -x;

191 dÿ{ 
buf
[
l
++] = 
x
%10 + '0'; x /= 10; } x > 0);

192 i‡(
c
 < 0Ë
buf
[
l
++] = '-';

193 i‡(
	`ks_ªsize
(
s
, s->
l
 +Ü + 2) < 0)

194  
EOF
;

195 
i
 = 
l
 - 1; i >0; --iË
s
->s[s->l++] = 
buf
[i];

196 
s
->s[s->
l
] = 0;

198 
	}
}

200 
ölöe
 
	$kputuw
(
c
, 
k°rög_t
 *
s
)

202 
buf
[16];

203 
l
, 
i
;

204 
x
;

205 i‡(
c
 =0Ë 
	`kputc
('0', 
s
);

206 
l
 = 0, 
x
 = 
c
; x > 0; x /10Ë
buf
[l++] = x%10 + '0';

207 i‡(
	`ks_ªsize
(
s
, s->
l
 +Ü + 2) < 0)

208  
EOF
;

209 
i
 = 
l
 - 1; i >0; --iË
s
->s[s->l++] = 
buf
[i];

210 
s
->s[s->
l
] = 0;

212 
	}
}

214 
ölöe
 
	$kpué
(
c
, 
k°rög_t
 *
s
)

216 
buf
[32];

217 
i
, 
l
 = 0;

218 
x
 = 
c
;

219 i‡(
c
 < 0Ë
x
 = -x;

220 dÿ{ 
buf
[
l
++] = 
x
%10 + '0'; x /= 10; } x > 0);

221 i‡(
c
 < 0Ë
buf
[
l
++] = '-';

222 i‡(
	`ks_ªsize
(
s
, s->
l
 +Ü + 2) < 0)

223  
EOF
;

224 
i
 = 
l
 - 1; i >0; --iË
s
->s[s->l++] = 
buf
[i];

225 
s
->s[s->
l
] = 0;

227 
	}
}

233 
ölöe
 *
	$k•lô
(
k°rög_t
 *
s
, 
dñimôî
, *
n
)

235 
max
 = 0, *
off£ts
 = 0;

236 *
n
 = 
	`k•lô_c‹e
(
s
->s, 
dñimôî
, &
max
, &
off£ts
);

237  
off£ts
;

238 
	}
}

	@htslib/htslib/regidx.h

53 #i‚de‡
HTSLIB_REGIDX_H


54 
	#HTSLIB_REGIDX_H


	)

56 
	~<°dio.h
>

57 
	~<öây≥s.h
>

59 #ifde‡
__˝lu•lus


63 
_ªgidx_t
 
	tªgidx_t
;

66 
uöt32_t
 
°¨t
, 
íd
;

68 
	tªg_t
;

71 
i
, 
n
;

72 
ªg_t
 *
ªg
;

73 *
∑ylﬂd
;

75 
	tªgôr_t
;

77 
	#REGITR_START
(
ôr
Ë(ôr).
ªg
[(ôr).
i
].
°¨t


	)

78 
	#REGITR_END
(
ôr
Ë(ôr).
ªg
[(ôr).
i
].
íd


	)

79 
	#REGITR_PAYLOAD
(
ôr
,
ty≥_t
Ë(—y≥_t*)(ôr).
∑ylﬂd
)[(ôr).
i
]

	)

80 
	#REGITR_OVERLAP
(
ôr
,
‰om
,
to
Ë(ôr.
i
 < iå.
n
 && 
	`REGITR_START
(ôr)<Òÿ&& 
	`REGITR_END
(ôr)>=‰om )

	)

94 (*
ªgidx_∑r£_f
)(c⁄° *
	tlöe
, **
	tchr_beg
, **
	tchr_íd
, 
	tªg_t
 *
	tªg
, *
	t∑ylﬂd
, *
	tu§
);

95 (*
ªgidx_‰ì_f
)(*
	t∑ylﬂd
);

97 
ªgidx_∑r£_bed
(c⁄° *,**,**,
ªg_t
*,*,*);

98 
ªgidx_∑r£_èb
(c⁄° *,**,**,
ªg_t
*,*,*);

113 
ªgidx_t
 *
ªgidx_öô
(c⁄° *
‚ame
, 
ªgidx_∑r£_f
 
∑r£f
, 
ªgidx_‰ì_f
 
‰ìf
, 
size_t
 
∑ylﬂd_size
, *
u§
);

118 
ªgidx_de°roy
(
ªgidx_t
 *
idx
);

128 
ªgidx_ovîœp
(
ªgidx_t
 *
idx
, c⁄° *
chr
, 
uöt32_t
 
°¨t
, uöt32_à
íd
, 
ªgôr_t
 *
ôr
);

138 
ªgidx_ö£π
(
ªgidx_t
 *
idx
, *
löe
);

143 **
ªgidx_£q_«mes
(
ªgidx_t
 *
idx
, *
n
);

149 
ªgidx_£q_ƒegs
(
ªgidx_t
 *
idx
, c⁄° *
£q
);

150 
ªgidx_ƒegs
(
ªgidx_t
 *
idx
);

152 #ifde‡
__˝lu•lus


	@htslib/htslib/sam.h

27 #i‚de‡
HTSLIB_SAM_H


28 
	#HTSLIB_SAM_H


	)

30 
	~<°döt.h
>

31 
	~"hts.h
"

33 #ifde‡
__˝lu•lus


52 
öt32_t
 
n_èrgës
, 
ign‹e_ßm_îr
;

53 
uöt32_t
 
l_ãxt
;

54 
uöt32_t
 *
èrgë_Àn
;

55 
öt8_t
 *
cig¨_èb
;

56 **
èrgë_«me
;

57 *
ãxt
;

58 *
sdi˘
;

59 } 
	tbam_hdr_t
;

65 
	#BAM_CMATCH
 0

	)

66 
	#BAM_CINS
 1

	)

67 
	#BAM_CDEL
 2

	)

68 
	#BAM_CREF_SKIP
 3

	)

69 
	#BAM_CSOFT_CLIP
 4

	)

70 
	#BAM_CHARD_CLIP
 5

	)

71 
	#BAM_CPAD
 6

	)

72 
	#BAM_CEQUAL
 7

	)

73 
	#BAM_CDIFF
 8

	)

74 
	#BAM_CBACK
 9

	)

76 
	#BAM_CIGAR_STR
 "MIDNSHP=XB"

	)

77 
	#BAM_CIGAR_SHIFT
 4

	)

78 
	#BAM_CIGAR_MASK
 0xf

	)

79 
	#BAM_CIGAR_TYPE
 0x3C1A7

	)

81 
	#bam_cig¨_›
(
c
Ë((c)&
BAM_CIGAR_MASK
)

	)

82 
	#bam_cig¨_›Àn
(
c
Ë((c)>>
BAM_CIGAR_SHIFT
)

	)

83 
	#bam_cig¨_›chr
(
c
Ë(
BAM_CIGAR_STR
[
	`bam_cig¨_›
(c)])

	)

84 
	#bam_cig¨_gí
(
l
, 
o
Ë(÷)<<
BAM_CIGAR_SHIFT
|(o))

	)

105 
	#bam_cig¨_ty≥
(
o
Ë(
BAM_CIGAR_TYPE
>>((o)<<1)&3)

106 

	)

108 
	#BAM_FPAIRED
 1

	)

110 
	#BAM_FPROPER_PAIR
 2

	)

112 
	#BAM_FUNMAP
 4

	)

114 
	#BAM_FMUNMAP
 8

	)

116 
	#BAM_FREVERSE
 16

	)

118 
	#BAM_FMREVERSE
 32

	)

120 
	#BAM_FREAD1
 64

	)

122 
	#BAM_FREAD2
 128

	)

124 
	#BAM_FSECONDARY
 256

	)

126 
	#BAM_FQCFAIL
 512

	)

128 
	#BAM_FDUP
 1024

	)

130 
	#BAM_FSUPPLEMENTARY
 2048

	)

151 
öt32_t
 
tid
;

152 
öt32_t
 
pos
;

153 
uöt16_t
 
bö
;

154 
uöt8_t
 
quÆ
;

155 
uöt8_t
 
l_q«me
;

156 
uöt16_t
 
Êag
;

157 
uöt8_t
 
unu£d1
;

158 
uöt8_t
 
l_exå™ul
;

159 
uöt32_t
 
n_cig¨
;

160 
öt32_t
 
l_q£q
;

161 
öt32_t
 
mtid
;

162 
öt32_t
 
mpos
;

163 
öt32_t
 
isize
;

164 } 
	tbam1_c‹e_t
;

184 
bam1_c‹e_t
 
c‹e
;

185 
l_d©a
;

186 
uöt32_t
 
m_d©a
;

187 
uöt8_t
 *
d©a
;

188 #i‚de‡
BAM_NO_ID


189 
uöt64_t
 
id
;

191 } 
	tbam1_t
;

198 
	#bam_is_ªv
(
b
Ë(((b)->
c‹e
.
Êag
&
BAM_FREVERSE
Ë!0)

	)

204 
	#bam_is_mªv
(
b
Ë(((b)->
c‹e
.
Êag
&
BAM_FMREVERSE
Ë!0)

	)

210 
	#bam_gë_q«me
(
b
Ë((*)(b)->
d©a
)

	)

220 
	#bam_gë_cig¨
(
b
Ë((
uöt32_t
*)((b)->
d©a
 + (b)->
c‹e
.
l_q«me
))

	)

231 
	#bam_gë_£q
(
b
Ë((b)->
d©a
 + ((b)->
c‹e
.
n_cig¨
<<2Ë+ (b)->c‹e.
l_q«me
)

	)

237 
	#bam_gë_quÆ
(
b
Ë((b)->
d©a
 + ((b)->
c‹e
.
n_cig¨
<<2Ë+ (b)->c‹e.
l_q«me
 + (((b)->c‹e.
l_q£q
 + 1)>>1))

	)

243 
	#bam_gë_aux
(
b
Ë((b)->
d©a
 + ((b)->
c‹e
.
n_cig¨
<<2Ë+ (b)->c‹e.
l_q«me
 + (((b)->c‹e.
l_q£q
 + 1)>>1Ë+ (b)->c‹e.l_q£q)

	)

249 
	#bam_gë_l_aux
(
b
Ë((b)->
l_d©a
 - ((b)->
c‹e
.
n_cig¨
<<2Ë- (b)->c‹e.
l_q«me
 - (b)->c‹e.
l_q£q
 - (((b)->c‹e.l_q£q + 1)>>1))

	)

256 
	#bam_£qi
(
s
, 
i
Ë((s)[(i)>>1] >> ((~(i)&1)<<2Ë& 0xf)

	)

266 
bam_hdr_t
 *
bam_hdr_öô
();

267 
bam_hdr_t
 *
bam_hdr_ªad
(
BGZF
 *
Â
);

268 
bam_hdr_wrôe
(
BGZF
 *
Â
, c⁄° 
bam_hdr_t
 *
h
Ë
HTS_RESULT_USED
;

269 
bam_hdr_de°roy
(
bam_hdr_t
 *
h
);

270 
bam_«me2id
(
bam_hdr_t
 *
h
, c⁄° *
ªf
);

271 
bam_hdr_t
* 
bam_hdr_dup
(c⁄° bam_hdr_à*
h0
);

273 
bam1_t
 *
bam_öô1
();

274 
bam_de°roy1
(
bam1_t
 *
b
);

275 
bam_ªad1
(
BGZF
 *
Â
, 
bam1_t
 *
b
Ë
HTS_RESULT_USED
;

276 
bam_wrôe1
(
BGZF
 *
Â
, c⁄° 
bam1_t
 *
b
Ë
HTS_RESULT_USED
;

277 
bam1_t
 *
bam_c›y1
(bam1_à*
bd°
, c⁄° bam1_à*
b§c
);

278 
bam1_t
 *
bam_dup1
(c⁄° bam1_à*
b§c
);

280 
bam_cig¨2qÀn
(
n_cig¨
, c⁄° 
uöt32_t
 *
cig¨
);

281 
bam_cig¨2æí
(
n_cig¨
, c⁄° 
uöt32_t
 *
cig¨
);

294 
öt32_t
 
bam_ídpos
(c⁄° 
bam1_t
 *
b
);

296 
bam_°r2Êag
(c⁄° *
°r
);

297 *
bam_Êag2°r
(
Êag
);

305 
	#bam_ôr_de°roy
(
ôî
Ë
	`hts_ôr_de°roy
(ôî)

	)

306 
	#bam_ôr_quîyi
(
idx
, 
tid
, 
beg
, 
íd
Ë
	`ßm_ôr_quîyi
(idx,Åid, beg,Énd)

	)

307 
	#bam_ôr_quîys
(
idx
, 
hdr
, 
ªgi⁄
Ë
	`ßm_ôr_quîys
(idx, hdr,Ñegi⁄)

	)

308 
	#bam_ôr_√xt
(
htsÂ
, 
ôr
, 
r
Ë
	`hts_ôr_√xt
((htsÂ)->
Â
.
bgzf
, (ôr), (r), 0)

	)

312 
	#bam_ödex_lﬂd
(
‚
Ë
	`hts_idx_lﬂd
((‚), 
HTS_FMT_BAI
)

	)

313 
	#bam_ödex_buûd
(
‚
, 
mö_shi·
Ë(
	`ßm_ödex_buûd
((‚), (mö_shi·)))

	)

320 
hts_idx_t
 *
ßm_ödex_lﬂd
(
htsFûe
 *
Â
, c⁄° *
‚
);

328 
hts_idx_t
 *
ßm_ödex_lﬂd2
(
htsFûe
 *
Â
, c⁄° *
‚
, c⁄° *
‚idx
);

337 
ßm_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
Ë
HTS_RESULT_USED
;

346 
ßm_ödex_buûd2
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
Ë
HTS_RESULT_USED
;

347 
ßm_ödex_buûd3
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, 
¡hªads
Ë
HTS_RESULT_USED
;

349 
	#ßm_ôr_de°roy
(
ôî
Ë
	`hts_ôr_de°roy
(ôî)

	)

350 
hts_ôr_t
 *
ßm_ôr_quîyi
(c⁄° 
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
);

351 
hts_ôr_t
 *
ßm_ôr_quîys
(c⁄° 
hts_idx_t
 *
idx
, 
bam_hdr_t
 *
hdr
, c⁄° *
ªgi⁄
);

352 
	#ßm_ôr_√xt
(
htsÂ
, 
ôr
, 
r
Ë
	`hts_ôr_√xt
((htsÂ)->
Â
.
bgzf
, (ôr), (r), (htsÂ))

	)

358 
	#ßm_›í
(
‚
, 
mode
Ë(
	`hts_›í
((‚), (mode)))

	)

359 
	#ßm_›í_f‹m©
(
‚
, 
mode
, 
fmt
Ë(
	`hts_›í_f‹m©
((‚), (mode), (fmt)))

	)

360 
	#ßm_˛o£
(
Â
Ë
	`hts_˛o£
(Â)

	)

362 
ßm_›í_mode
(*
mode
, c⁄° *
‚
, c⁄° *
f‹m©
);

367 *
ßm_›í_mode_›ts
(c⁄° *
‚
,

368 c⁄° *
mode
,

369 c⁄° *
f‹m©
);

371 
htsFûe
 
	tßmFûe
;

372 
bam_hdr_t
 *
ßm_hdr_∑r£
(
l_ãxt
, c⁄° *
ãxt
);

373 
bam_hdr_t
 *
ßm_hdr_ªad
(
ßmFûe
 *
Â
);

374 
ßm_hdr_wrôe
(
ßmFûe
 *
Â
, c⁄° 
bam_hdr_t
 *
h
Ë
HTS_RESULT_USED
;

376 
ßm_∑r£1
(
k°rög_t
 *
s
, 
bam_hdr_t
 *
h
, 
bam1_t
 *
b
Ë
HTS_RESULT_USED
;

377 
ßm_f‹m©1
(c⁄° 
bam_hdr_t
 *
h
, c⁄° 
bam1_t
 *
b
, 
k°rög_t
 *
°r
Ë
HTS_RESULT_USED
;

378 
ßm_ªad1
(
ßmFûe
 *
Â
, 
bam_hdr_t
 *
h
, 
bam1_t
 *
b
Ë
HTS_RESULT_USED
;

379 
ßm_wrôe1
(
ßmFûe
 *
Â
, c⁄° 
bam_hdr_t
 *
h
, c⁄° 
bam1_t
 *
b
Ë
HTS_RESULT_USED
;

394 
uöt8_t
 *
bam_aux_gë
(c⁄° 
bam1_t
 *
b
, c⁄° 
èg
[2]);

402 
öt64_t
 
bam_aux2i
(c⁄° 
uöt8_t
 *
s
);

410 
bam_aux2f
(c⁄° 
uöt8_t
 *
s
);

417 
bam_aux2A
(c⁄° 
uöt8_t
 *
s
);

424 *
bam_aux2Z
(c⁄° 
uöt8_t
 *
s
);

431 
uöt32_t
 
bam_auxB_Àn
(c⁄° 
uöt8_t
 *
s
);

441 
öt64_t
 
bam_auxB2i
(c⁄° 
uöt8_t
 *
s
, 
uöt32_t
 
idx
);

452 
bam_auxB2f
(c⁄° 
uöt8_t
 *
s
, 
uöt32_t
 
idx
);

465 
bam_aux_≠≥nd
(
bam1_t
 *
b
, c⁄° 
èg
[2], 
ty≥
, 
Àn
, c⁄° 
uöt8_t
 *
d©a
);

474 
bam_aux_dñ
(
bam1_t
 *
b
, 
uöt8_t
 *
s
);

483 
bam_aux_upd©e_°r
(
bam1_t
 *
b
, c⁄° 
èg
[2], 
Àn
, c⁄° *
d©a
);

489 #i‡!
deföed
(
BAM_NO_PILEUP
)

501 *
p
;

502 
öt64_t
 
i
;

503 
f
;

504 } 
	tbam_pûeup_cd
;

525 
bam1_t
 *
b
;

526 
öt32_t
 
qpos
;

527 
ödñ
, 
Àvñ
;

528 
uöt32_t
 
is_dñ
:1, 
is_hód
:1, 
is_èû
:1, 
is_ªfskù
:1, 
aux
:28;

529 
bam_pûeup_cd
 
cd
;

530 } 
	tbam_pûeup1_t
;

532 (*
bam_∂p_auto_f
)(*
	td©a
, 
	tbam1_t
 *
	tb
);

534 
__bam_∂p_t
;

535 
__bam_∂p_t
 *
	tbam_∂p_t
;

537 
__bam_m∂p_t
;

538 
__bam_m∂p_t
 *
	tbam_m∂p_t
;

546 
bam_∂p_t
 
bam_∂p_öô
(
bam_∂p_auto_f
 
func
, *
d©a
);

547 
bam_∂p_de°roy
(
bam_∂p_t
 
ôî
);

548 
bam_∂p_push
(
bam_∂p_t
 
ôî
, c⁄° 
bam1_t
 *
b
);

549 c⁄° 
bam_pûeup1_t
 *
bam_∂p_√xt
(
bam_∂p_t
 
ôî
, *
_tid
, *
_pos
, *
_n_∂p
);

550 c⁄° 
bam_pûeup1_t
 *
bam_∂p_auto
(
bam_∂p_t
 
ôî
, *
_tid
, *
_pos
, *
_n_∂p
);

551 
bam_∂p_£t_max˙t
(
bam_∂p_t
 
ôî
, 
max˙t
);

552 
bam_∂p_ª£t
(
bam_∂p_t
 
ôî
);

562 
bam_∂p_c⁄°ru˘‹
(
bam_∂p_t
 
∂p
,

563 (*
func
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
));

564 
bam_∂p_de°ru˘‹
(
bam_∂p_t
 
∂p
,

565 (*
func
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
));

567 
bam_m∂p_t
 
bam_m∂p_öô
(
n
, 
bam_∂p_auto_f
 
func
, **
d©a
);

576 
bam_m∂p_öô_ovîœps
(
bam_m∂p_t
 
ôî
);

577 
bam_m∂p_de°roy
(
bam_m∂p_t
 
ôî
);

578 
bam_m∂p_£t_max˙t
(
bam_m∂p_t
 
ôî
, 
max˙t
);

579 
bam_m∂p_auto
(
bam_m∂p_t
 
ôî
, *
_tid
, *
_pos
, *
n_∂p
, c⁄° 
bam_pûeup1_t
 **
∂p
);

580 
bam_m∂p_ª£t
(
bam_m∂p_t
 
ôî
);

581 
bam_m∂p_c⁄°ru˘‹
(
bam_m∂p_t
 
ôî
,

582 (*
func
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
));

583 
bam_m∂p_de°ru˘‹
(
bam_m∂p_t
 
ôî
,

584 (*
func
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
));

593 
ßm_ˇp_m≠q
(
bam1_t
 *
b
, c⁄° *
ªf
, 
ªf_Àn
, 
thªs
);

594 
ßm_¥ob_ªÆn
(
bam1_t
 *
b
, c⁄° *
ªf
, 
ªf_Àn
, 
Êag
);

596 #ifde‡
__˝lu•lus


	@htslib/htslib/synced_bcf_reader.h

56 #i‚de‡
HTSLIB_SYNCED_BCF_READER_H


57 
	#HTSLIB_SYNCED_BCF_READER_H


	)

59 
	~"hts.h
"

60 
	~"vcf.h
"

61 
	~"tbx.h
"

63 #ifde‡
__˝lu•lus


78 
	#COLLAPSE_NONE
 0

79 
	#COLLAPSE_SNPS
 1

80 
	#COLLAPSE_INDELS
 2

81 
	#COLLAPSE_ANY
 4

82 
	#COLLAPSE_SOME
 8

83 
	#COLLAPSE_BOTH
 (
COLLAPSE_SNPS
|
COLLAPSE_INDELS
)

	)

85 
	#BCF_SR_PAIR_SNPS
 (1<<0)

86 
	#BCF_SR_PAIR_INDELS
 (1<<1)

87 
	#BCF_SR_PAIR_ANY
 (1<<2)

88 
	#BCF_SR_PAIR_SOME
 (1<<3)

89 
	#BCF_SR_PAIR_SNP_REF
 (1<<4)

90 
	#BCF_SR_PAIR_INDEL_REF
 (1<<5)

91 
	#BCF_SR_PAIR_EXACT
 (1<<6)

92 
	#BCF_SR_PAIR_BOTH
 (
BCF_SR_PAIR_SNPS
|
BCF_SR_PAIR_INDELS
)

	)

93 
	#BCF_SR_PAIR_BOTH_REF
 (
BCF_SR_PAIR_SNPS
|
BCF_SR_PAIR_INDELS
|
BCF_SR_PAIR_SNP_REF
|
BCF_SR_PAIR_INDEL_REF
)

	)

97 
BCF_SR_REQUIRE_IDX
,

98 
BCF_SR_PAIR_LOGIC


100 
	tbcf_§_›t_t
;

102 
	s_bcf_§_ªgi⁄s_t


105 
tbx_t
 *
tbx
;

106 
hts_ôr_t
 *
ôr
;

107 
k°rög_t
 
löe
;

108 
htsFûe
 *
fûe
;

109 *
‚ame
;

110 
is_bö
;

111 **
Æs
;

112 
k°rög_t
 
Æs_°r
;

113 
«ls
, 
mÆs
;

114 
Æs_ty≥
;

117 (*
mis£d_ªg_h™dÀr
)(
_bcf_§_ªgi⁄s_t
 *, *);

118 *
mis£d_ªg_d©a
;

121 
_ªgi⁄_t
 *
ªgs
;

124 *
£q_hash
;

125 **
£q_«mes
;

126 
n£qs
;

127 
i£q
;

128 
°¨t
, 
íd
;

129 
¥ev_£q
, 
¥ev_°¨t
;

131 
	tbcf_§_ªgi⁄s_t
;

135 
htsFûe
 *
fûe
;

136 
tbx_t
 *
tbx_idx
;

137 
hts_idx_t
 *
bcf_idx
;

138 
bcf_hdr_t
 *
hódî
;

139 
hts_ôr_t
 *
ôr
;

140 *
‚ame
;

141 
bcf1_t
 **
buf„r
;

142 
nbuf„r
, 
mbuf„r
;

143 
nfûãr_ids
, *
fûãr_ids
;

144 *
ßm∂es
, 
n_sm∂
;

146 
	tbcf_§_t
;

150 
›í_Áûed
, 
nŸ_bgzf
, 
idx_lﬂd_Áûed
, 
fûe_ty≥_îr‹
, 
≠i_ußge_îr‹
,

151 
hódî_îr‹
, 
no_eof
, 
no_mem‹y
, 
vcf_∑r£_îr‹
, 
bcf_ªad_îr‹


153 
	tbcf_§_îr‹
;

158 
cﬁœp£
;

159 *
≠∂y_fûãrs
;

164 
ªquúe_ödex
;

165 
max_u≈ack
;

166 *
has_löe
;

167 
bcf_§_îr‹
 
î∫um
;

170 
bcf_§_t
 *
ªadîs
;

171 
ƒódîs
;

172 
°ªamög
;

173 
ex∂icô_ªgs
;

174 **
ßm∂es
;

175 
bcf_§_ªgi⁄s_t
 *
ªgi⁄s
, *
èrgës
;

176 
èrgës_Æs
;

177 
èrgës_ex˛ude
;

178 
k°rög_t
 
tmps
;

179 
n_sm∂
;

181 
n_thªads
;

182 
htsThªadPoﬁ
 *
p
;

183 *
aux
;

185 
	tbcf_§s_t
;

188 
bcf_§s_t
 *
bcf_§_öô
();

191 
bcf_§_de°roy
(
bcf_§s_t
 *
ªadîs
);

193 *
bcf_§_°ªº‹
(
î∫um
);

195 
bcf_§_£t_›t
(
bcf_§s_t
 *
ªadîs
, 
bcf_§_›t_t
 
›t
, ...);

204 
bcf_§_£t_thªads
(
bcf_§s_t
 *
fûes
, 
n_thªads
);

207 
bcf_§_de°roy_thªads
(
bcf_§s_t
 *
fûes
);

219 
bcf_§_add_ªadî
(
bcf_§s_t
 *
ªadîs
, c⁄° *
‚ame
);

220 
bcf_§_ªmove_ªadî
(
bcf_§s_t
 *
fûes
, 
i
);

230 
bcf_§_√xt_löe
(
bcf_§s_t
 *
ªadîs
);

231 
	#bcf_§_has_löe
(
ªadîs
, 
i
Ë‘ódîs)->
has_löe
[i]

	)

232 
	#bcf_§_gë_löe
(
_ªadîs
, 
i
Ë((_ªadîs)->
has_löe
[i] ? ((_ªadîs)->
ªadîs
[i].
buf„r
[0]Ë: 
NULL
)

	)

233 
	#bcf_§_sw≠_löe
(
_ªadîs
, 
i
, 
lõu
Ë{ 
bcf1_t
 *
tmp
 =Üõu;Üõu = (_ªadîs)->
ªadîs
[i].
buf„r
[0]; (_ªadîs)->ªadîs[i].buf„r[0] =Åmp; }

	)

234 
	#bcf_§_ªgi⁄_d⁄e
(
_ªadîs
,
i
Ë(!(_ªadîs)->
has_löe
[i] && !(_ªadîs)->
ªadîs
[i].
nbuf„r
 ? 1 : 0)

	)

235 
	#bcf_§_gë_hódî
(
_ªadîs
, 
i
Ë(_ªadîs)->
ªadîs
[i].
hódî


	)

236 
	#bcf_§_gë_ªadî
(
_ªadîs
, 
i
Ë&((_ªadîs)->
ªadîs
[i])

	)

244 
bcf_§_£ek
(
bcf_§s_t
 *
ªadîs
, c⁄° *
£q
, 
pos
);

257 
bcf_§_£t_ßm∂es
(
bcf_§s_t
 *
ªadîs
, c⁄° *
ßm∂es
, 
is_fûe
);

285 
bcf_§_£t_èrgës
(
bcf_§s_t
 *
ªadîs
, c⁄° *
èrgës
, 
is_fûe
, 
ÆÀÀs
);

286 
bcf_§_£t_ªgi⁄s
(
bcf_§s_t
 *
ªadîs
, c⁄° *
ªgi⁄s
, 
is_fûe
);

310 
bcf_§_ªgi⁄s_t
 *
bcf_§_ªgi⁄s_öô
(c⁄° *
ªgi⁄s
, 
is_fûe
, 
chr
, 
‰om
, 
to
);

311 
bcf_§_ªgi⁄s_de°roy
(
bcf_§_ªgi⁄s_t
 *
ªgi⁄s
);

319 
bcf_§_ªgi⁄s_£ek
(
bcf_§_ªgi⁄s_t
 *
ªgi⁄s
, c⁄° *
chr
);

328 
bcf_§_ªgi⁄s_√xt
(
bcf_§_ªgi⁄s_t
 *
ªg
);

339 
bcf_§_ªgi⁄s_ovîœp
(
bcf_§_ªgi⁄s_t
 *
ªg
, c⁄° *
£q
, 
°¨t
, 
íd
);

345 
bcf_§_ªgi⁄s_Êush
(
bcf_§_ªgi⁄s_t
 *
ªgs
);

347 #ifde‡
__˝lu•lus


	@htslib/htslib/tbx.h

27 #i‚de‡
HTSLIB_TBX_H


28 
	#HTSLIB_TBX_H


	)

30 
	~"hts.h
"

32 #ifde‡
__˝lu•lus


36 
	#TBX_MAX_SHIFT
 31

	)

38 
	#TBX_GENERIC
 0

	)

39 
	#TBX_SAM
 1

	)

40 
	#TBX_VCF
 2

	)

41 
	#TBX_UCSC
 0x10000

	)

44 
öt32_t
 
¥e£t
;

45 
öt32_t
 
sc
, 
bc
, 
ec
;

46 
öt32_t
 
mëa_ch¨
, 
löe_skù
;

47 } 
	ttbx_c⁄f_t
;

50 
tbx_c⁄f_t
 
c⁄f
;

51 
hts_idx_t
 *
idx
;

52 *
di˘
;

53 } 
	ttbx_t
;

55 c⁄° 
tbx_c⁄f_t
 
tbx_c⁄f_gff
, 
tbx_c⁄f_bed
, 
tbx_c⁄f_p¶tbl
, 
tbx_c⁄f_ßm
, 
tbx_c⁄f_vcf
;

57 
	#tbx_ôr_de°roy
(
ôî
Ë
	`hts_ôr_de°roy
(ôî)

	)

58 
	#tbx_ôr_quîyi
(
tbx
, 
tid
, 
beg
, 
íd
Ë
	`hts_ôr_quîy
(—bx)->
idx
, (tid), (beg), (íd), 
tbx_ªadªc
)

	)

59 
	#tbx_ôr_quîys
(
tbx
, 
s
Ë
	`hts_ôr_quîys
(—bx)->
idx
, (s), (
hts_«me2id_f
)(
tbx_«me2id
), (tbx), 
hts_ôr_quîy
, 
tbx_ªadªc
)

	)

60 
	#tbx_ôr_√xt
(
htsÂ
, 
tbx
, 
ôr
, 
r
Ë
	`hts_ôr_√xt
(
	`hts_gë_bgzÂ
(htsÂ), (ôr), (r), (tbx))

	)

61 
	#tbx_bgzf_ôr_√xt
(
bgzÂ
, 
tbx
, 
ôr
, 
r
Ë
	`hts_ôr_√xt
((bgzÂ), (ôr), (r), (tbx))

	)

63 
tbx_«me2id
(
tbx_t
 *
tbx
, c⁄° *
ss
);

66 
BGZF
 *
hts_gë_bgzÂ
(
htsFûe
 *
Â
);

67 
tbx_ªadªc
(
BGZF
 *
Â
, *
tbxv
, *
sv
, *
tid
, *
beg
, *
íd
);

69 
tbx_t
 *
tbx_ödex
(
BGZF
 *
Â
, 
mö_shi·
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
);

70 
tbx_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
);

71 
tbx_ödex_buûd2
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
);

72 
tbx_ödex_buûd3
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, 
n_thªads
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
);

73 
tbx_t
 *
tbx_ödex_lﬂd
(c⁄° *
‚
);

74 
tbx_t
 *
tbx_ödex_lﬂd2
(c⁄° *
‚
, c⁄° *
‚idx
);

75 c⁄° **
tbx_£q«mes
(
tbx_t
 *
tbx
, *
n
);

76 
tbx_de°roy
(
tbx_t
 *
tbx
);

78 #ifde‡
__˝lu•lus


	@htslib/htslib/thread_pool.h

47 #i‚de‡
HTSLIB_THREAD_POOL_H


48 
	#HTSLIB_THREAD_POOL_H


	)

50 #ifde‡
__˝lu•lus


74 
hts_çoﬁ_¥o˚ss
 
	thts_çoﬁ_¥o˚ss
;

83 
hts_çoﬁ
 
	thts_çoﬁ
;

88 
hts_çoﬁ_ªsu…
 
	thts_çoﬁ_ªsu…
;

102 
hts_çoﬁ
 *
hts_çoﬁ_öô
(
n
);

108 
hts_çoﬁ_size
(
hts_çoﬁ
 *
p
);

123 
hts_çoﬁ_di•©ch
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
,

124 *(*
func
)(*
¨g
), *arg);

125 
hts_çoﬁ_di•©ch2
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
,

126 *(*
func
)(*
¨g
), *¨g, 
n⁄block
);

132 
hts_çoﬁ_wake_di•©ch
(
hts_çoﬁ_¥o˚ss
 *
q
);

145 
hts_çoﬁ_¥o˚ss_Êush
(
hts_çoﬁ_¥o˚ss
 *
q
);

159 
hts_çoﬁ_¥o˚ss_ª£t
(
hts_çoﬁ_¥o˚ss
 *
q
, 
‰ì_ªsu…s
);

162 
hts_çoﬁ_¥o˚ss_qsize
(
hts_çoﬁ_¥o˚ss
 *
q
);

169 
hts_çoﬁ_de°roy
(
hts_çoﬁ
 *
p
);

175 
hts_çoﬁ_kûl
(
hts_çoﬁ
 *
p
);

187 
hts_çoﬁ_ªsu…
 *
hts_çoﬁ_√xt_ªsu…
(
hts_çoﬁ_¥o˚ss
 *
q
);

199 
hts_çoﬁ_ªsu…
 *
hts_çoﬁ_√xt_ªsu…_waô
(
hts_çoﬁ_¥o˚ss
 *
q
);

205 
hts_çoﬁ_dñëe_ªsu…
(
hts_çoﬁ_ªsu…
 *
r
, 
‰ì_d©a
);

211 *
hts_çoﬁ_ªsu…_d©a
(
hts_çoﬁ_ªsu…
 *
r
);

223 
hts_çoﬁ_¥o˚ss
 *
hts_çoﬁ_¥o˚ss_öô
(
hts_çoﬁ
 *
p
, 
qsize
, 
ö_⁄ly
);

229 
hts_çoﬁ_¥o˚ss_de°roy
(
hts_çoﬁ_¥o˚ss
 *
q
);

239 
hts_çoﬁ_¥o˚ss_Êush
(
hts_çoﬁ_¥o˚ss
 *
q
);

245 
hts_çoﬁ_¥o˚ss_em±y
(
hts_çoﬁ_¥o˚ss
 *
q
);

250 
hts_çoﬁ_¥o˚ss_Àn
(
hts_çoﬁ_¥o˚ss
 *
q
);

256 
hts_çoﬁ_¥o˚ss_sz
(
hts_çoﬁ_¥o˚ss
 *
q
);

264 
hts_çoﬁ_¥o˚ss_shutdown
(
hts_çoﬁ_¥o˚ss
 *
q
);

274 
hts_çoﬁ_¥o˚ss_©èch
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
);

275 
hts_çoﬁ_¥o˚ss_dëach
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
);

283 
hts_çoﬁ_¥o˚ss_ªf_ö¸
(
hts_çoﬁ_¥o˚ss
 *
q
);

284 
hts_çoﬁ_¥o˚ss_ªf_de¸
(
hts_çoﬁ_¥o˚ss
 *
q
);

286 #ifde‡
__˝lu•lus


	@htslib/htslib/vcf.h

33 #i‚de‡
HTSLIB_VCF_H


34 
	#HTSLIB_VCF_H


	)

36 
	~<°döt.h
>

37 
	~<limôs.h
>

38 
	~<as£π.h
>

39 
	~"hts.h
"

40 
	~"k°rög.h
"

41 
	~"hts_defs.h
"

42 
	~"hts_ídün.h
"

44 #ifde‡
__˝lu•lus


52 
	#BCF_HL_FLT
 0

53 
	#BCF_HL_INFO
 1

	)

54 
	#BCF_HL_FMT
 2

	)

55 
	#BCF_HL_CTG
 3

	)

56 
	#BCF_HL_STR
 4

57 
	#BCF_HL_GEN
 5

58 

	)

59 
	#BCF_HT_FLAG
 0

60 
	#BCF_HT_INT
 1

	)

61 
	#BCF_HT_REAL
 2

	)

62 
	#BCF_HT_STR
 3

	)

64 
	#BCF_VL_FIXED
 0

65 
	#BCF_VL_VAR
 1

	)

66 
	#BCF_VL_A
 2

	)

67 
	#BCF_VL_G
 3

	)

68 
	#BCF_VL_R
 4

	)

82 
	#BCF_DT_ID
 0

83 
	#BCF_DT_CTG
 1

	)

84 
	#BCF_DT_SAMPLE
 2

	)

88 
ty≥
;

89 *
key
;

90 *
vÆue
;

91 
nkeys
;

92 **
keys
, **
vÆs
;

93 } 
	tbcf_hªc_t
;

96 
uöt32_t
 
öfo
[3];

98 
bcf_hªc_t
 *
hªc
[3];

99 
id
;

100 } 
	tbcf_idöfo_t
;

103 c⁄° *
key
;

104 c⁄° 
bcf_idöfo_t
 *
vÆ
;

105 } 
	tbcf_id∑ú_t
;

109 
öt32_t
 
n
[3];

110 
bcf_id∑ú_t
 *
id
[3];

111 *
di˘
[3];

112 **
ßm∂es
;

113 
bcf_hªc_t
 **
hªc
;

114 
nhªc
, 
dúty
;

115 
¡øn¶
, *
å™¶
[2];

116 
nßm∂es_‹i
;

117 
uöt8_t
 *
kìp_ßm∂es
;

118 
k°rög_t
 
mem
;

119 
öt32_t
 
m
[3];

120 } 
	tbcf_hdr_t
;

122 
uöt8_t
 
bcf_ty≥_shi·
[];

128 
	#BCF_BT_NULL
 0

	)

129 
	#BCF_BT_INT8
 1

	)

130 
	#BCF_BT_INT16
 2

	)

131 
	#BCF_BT_INT32
 3

	)

132 
	#BCF_BT_FLOAT
 5

	)

133 
	#BCF_BT_CHAR
 7

	)

135 
	#VCF_REF
 0

	)

136 
	#VCF_SNP
 1

	)

137 
	#VCF_MNP
 2

	)

138 
	#VCF_INDEL
 4

	)

139 
	#VCF_OTHER
 8

	)

140 
	#VCF_BND
 16

141 

	)

143 
	gty≥
, 
	gn
;

144 } 
	tv¨ü¡_t
;

147 
	gid
;

148 
	gn
, 
	gsize
, 
	gty≥
;

149 
uöt8_t
 *
	gp
;

150 
uöt32_t
 
	gp_Àn
;

151 
uöt32_t
 
	gp_off
:31, 
	gp_‰ì
:1;

152 } 
	tbcf_fmt_t
;

155 
	gkey
;

156 
	gty≥
, 
	gÀn
;

158 
öt32_t
 
	gi
;

159 
	gf
;

160 } 
	gv1
;

161 
uöt8_t
 *
	gv±r
;

162 
uöt32_t
 
	gv±r_Àn
;

163 
uöt32_t
 
	gv±r_off
:31,

164 
	gv±r_‰ì
:1;

166 } 
	tbcf_öfo_t
;

169 
	#BCF1_DIRTY_ID
 1

	)

170 
	#BCF1_DIRTY_ALS
 2

	)

171 
	#BCF1_DIRTY_FLT
 4

	)

172 
	#BCF1_DIRTY_INF
 8

	)

175 
	gm_fmt
, 
	gm_öfo
, 
	gm_id
, 
	gm_Æs
, 
	gm_ÆÀÀ
, 
	gm_Êt
;

176 
	gn_Êt
;

177 *
	gÊt
;

178 *
	gid
, *
	gÆs
;

179 **
	gÆÀÀ
;

180 
bcf_öfo_t
 *
	göfo
;

181 
bcf_fmt_t
 *
	gfmt
;

182 
v¨ü¡_t
 *
	gv¨
;

183 
	gn_v¨
, 
	gv¨_ty≥
;

184 
	gsh¨ed_dúty
;

185 
	gödiv_dúty
;

186 } 
	tbcf_dec_t
;

189 
	#BCF_ERR_CTG_UNDEF
 1

	)

190 
	#BCF_ERR_TAG_UNDEF
 2

	)

191 
	#BCF_ERR_NCOLS
 4

	)

192 
	#BCF_ERR_LIMITS
 8

	)

193 
	#BCF_ERR_CHAR
 16

	)

194 
	#BCF_ERR_CTG_INVALID
 32

	)

195 
	#BCF_ERR_TAG_INVALID
 64

	)

209 
öt32_t
 
	grid
;

210 
öt32_t
 
	gpos
;

211 
öt32_t
 
	gæí
;

212 
	gquÆ
;

213 
uöt32_t
 
	gn_öfo
:16, 
	gn_ÆÀÀ
:16;

214 
uöt32_t
 
	gn_fmt
:8, 
	gn_ßm∂e
:24;

215 
k°rög_t
 
	gsh¨ed
, 
	gödiv
;

216 
bcf_dec_t
 
	gd
;

217 
	gmax_u≈ack
;

218 
	gu≈acked
;

219 
	gu≈ack_size
[3];

220 
	gîrcode
;

221 } 
	tbcf1_t
;

240 
	#bcf_öô1
(Ë
	`bcf_öô
()

	)

241 
	#bcf_ªad1
(
Â
,
h
,
v
Ë
	`bcf_ªad
((Â),(h),(v))

	)

242 
	#vcf_ªad1
(
Â
,
h
,
v
Ë
	`vcf_ªad
((Â),(h),(v))

	)

243 
	#bcf_wrôe1
(
Â
,
h
,
v
Ë
	`bcf_wrôe
((Â),(h),(v))

	)

244 
	#vcf_wrôe1
(
Â
,
h
,
v
Ë
	`vcf_wrôe
((Â),(h),(v))

	)

245 
	#bcf_de°roy1
(
v
Ë
	`bcf_de°roy
(v)

	)

246 
	#bcf_em±y1
(
v
Ë
	`bcf_em±y
(v)

	)

247 
	#vcf_∑r£1
(
s
,
h
,
v
Ë
	`vcf_∑r£
((s),(h),(v))

	)

248 
	#bcf_˛ór1
(
v
Ë
	`bcf_˛ór
(v)

	)

249 
	#vcf_f‹m©1
(
h
,
v
,
s
Ë
	`vcf_f‹m©
((h),(v),(s))

	)

258 
bcf_hdr_t
 *
bcf_hdr_öô
(c⁄° *
mode
);

261 
bcf_hdr_de°roy
(
bcf_hdr_t
 *
h
);

264 
bcf1_t
 *
bcf_öô
();

267 
bcf_de°roy
(
bcf1_t
 *
v
);

273 
bcf_em±y
(
bcf1_t
 *
v
);

280 
bcf_˛ór
(
bcf1_t
 *
v
);

284 
htsFûe
 
	tvcfFûe
;

285 
	#bcf_›í
(
‚
, 
mode
Ë
	`hts_›í
((‚), (mode))

	)

286 
	#vcf_›í
(
‚
, 
mode
Ë
	`hts_›í
((‚), (mode))

	)

287 
	#bcf_˛o£
(
Â
Ë
	`hts_˛o£
(Â)

	)

288 
	#vcf_˛o£
(
Â
Ë
	`hts_˛o£
(Â)

	)

291 
bcf_hdr_t
 *
bcf_hdr_ªad
(
htsFûe
 *
Â
);

315 
bcf_hdr_£t_ßm∂es
(
bcf_hdr_t
 *
hdr
, c⁄° *
ßm∂es
, 
is_fûe
);

316 
bcf_sub£t_f‹m©
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
ªc
);

320 
bcf_hdr_wrôe
(
htsFûe
 *
Â
, 
bcf_hdr_t
 *
h
);

326 
vcf_∑r£
(
k°rög_t
 *
s
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
);

329 
vcf_f‹m©
(c⁄° 
bcf_hdr_t
 *
h
, c⁄° 
bcf1_t
 *
v
, 
k°rög_t
 *
s
);

339 
bcf_ªad
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
);

348 
	#BCF_UN_STR
 1

349 
	#BCF_UN_FLT
 2

350 
	#BCF_UN_INFO
 4

351 
	#BCF_UN_SHR
 (
BCF_UN_STR
|
BCF_UN_FLT
|
BCF_UN_INFO
)

352 
	#BCF_UN_FMT
 8

353 
	#BCF_UN_IND
 
BCF_UN_FMT


354 
	#BCF_UN_ALL
 (
BCF_UN_SHR
|
BCF_UN_FMT
)

355 
	`bcf_u≈ack
(
bcf1_t
 *
b
, 
which
);

	)

364 
bcf1_t
 *
bcf_dup
(bcf1_à*
§c
);

365 
bcf1_t
 *
bcf_c›y
(bcf1_à*
d°
, bcf1_à*
§c
);

370 
bcf_wrôe
(
htsFûe
 *
Â
, 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
);

377 
bcf_hdr_t
 *
vcf_hdr_ªad
(
htsFûe
 *
Â
);

378 
vcf_hdr_wrôe
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
);

379 
vcf_ªad
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
);

380 
vcf_wrôe
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
);

383 
bcf_ªadªc
(
BGZF
 *
Â
, *
nuŒ
, *
v
, *
tid
, *
beg
, *
íd
);

392 
bcf_hdr_t
 *
bcf_hdr_dup
(c⁄° bcf_hdr_à*
hdr
);

400 
bcf_hdr_comböe
(
bcf_hdr_t
 *
d°
, c⁄° bcf_hdr_à*
§c
Ë
HTS_DEPRECATED
("Please use bcf_hdr_merge instead");

416 
bcf_hdr_t
 *
bcf_hdr_mîge
(bcf_hdr_à*
d°
, c⁄° bcf_hdr_à*
§c
);

422 
bcf_hdr_add_ßm∂e
(
bcf_hdr_t
 *
hdr
, c⁄° *
ßm∂e
);

425 
bcf_hdr_£t
(
bcf_hdr_t
 *
hdr
, c⁄° *
‚ame
);

432 
bcf_hdr_f‹m©
(c⁄° 
bcf_hdr_t
 *
hdr
, 
is_bcf
, 
k°rög_t
 *
°r
);

439 *
bcf_hdr_fmt_ãxt
(c⁄° 
bcf_hdr_t
 *
hdr
, 
is_bcf
, *
Àn
)

440 
HTS_DEPRECATED
("use bcf_hdr_format() instead");

443 
bcf_hdr_≠≥nd
(
bcf_hdr_t
 *
h
, c⁄° *
löe
);

444 
bcf_hdr_¥ötf
(
bcf_hdr_t
 *
h
, c⁄° *
f‹m©
, ...);

447 c⁄° *
bcf_hdr_gë_vîsi⁄
(c⁄° 
bcf_hdr_t
 *
hdr
);

448 
bcf_hdr_£t_vîsi⁄
(
bcf_hdr_t
 *
hdr
, c⁄° *
vîsi⁄
);

455 
bcf_hdr_ªmove
(
bcf_hdr_t
 *
h
, 
ty≥
, c⁄° *
key
);

468 
bcf_hdr_t
 *
bcf_hdr_sub£t
(c⁄° bcf_hdr_à*
h0
, 
n
, *c⁄°* 
ßm∂es
, *
im≠
);

471 c⁄° **
bcf_hdr_£q«mes
(c⁄° 
bcf_hdr_t
 *
h
, *
n£qs
);

474 
	#bcf_hdr_nßm∂es
(
hdr
Ë(hdr)->
n
[
BCF_DT_SAMPLE
]

	)

478 
bcf_hdr_∑r£
(
bcf_hdr_t
 *
hdr
, *
htxt
);

479 
bcf_hdr_sync
(
bcf_hdr_t
 *
h
);

480 
bcf_hªc_t
 *
bcf_hdr_∑r£_löe
(c⁄° 
bcf_hdr_t
 *
h
, c⁄° *
löe
, *
Àn
);

481 
bcf_hªc_f‹m©
(c⁄° 
bcf_hªc_t
 *
hªc
, 
k°rög_t
 *
°r
);

482 
bcf_hdr_add_hªc
(
bcf_hdr_t
 *
hdr
, 
bcf_hªc_t
 *
hªc
);

491 
bcf_hªc_t
 *
bcf_hdr_gë_hªc
(c⁄° 
bcf_hdr_t
 *
hdr
, 
ty≥
, c⁄° *
key
, c⁄° *
vÆue
, c⁄° *
°r_˛ass
);

492 
bcf_hªc_t
 *
bcf_hªc_dup
(bcf_hªc_à*
hªc
);

493 
bcf_hªc_add_key
(
bcf_hªc_t
 *
hªc
, c⁄° *
°r
, 
Àn
);

494 
bcf_hªc_£t_vÆ
(
bcf_hªc_t
 *
hªc
, 
i
, c⁄° *
°r
, 
Àn
, 
is_quŸed
);

495 
bcf_hªc_föd_key
(
bcf_hªc_t
 *
hªc
, c⁄° *
key
);

496 
hªc_add_idx
(
bcf_hªc_t
 *
hªc
, 
idx
);

497 
bcf_hªc_de°roy
(
bcf_hªc_t
 *
hªc
);

506 
bcf_sub£t
(c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
, 
n
, *
im≠
);

515 
bcf_å™¶©e
(c⁄° 
bcf_hdr_t
 *
d°_hdr
, bcf_hdr_à*
§c_hdr
, 
bcf1_t
 *
§c_löe
);

520 
bcf_gë_v¨ü¡_ty≥s
(
bcf1_t
 *
ªc
);

521 
bcf_gë_v¨ü¡_ty≥
(
bcf1_t
 *
ªc
, 
ôh_ÆÀÀ
);

522 
bcf_is_¢p
(
bcf1_t
 *
v
);

529 
bcf_upd©e_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, *
Êt_ids
, 
n
);

536 
bcf_add_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, 
Êt_id
);

542 
bcf_ªmove_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, 
Êt_id
, 
∑ss
);

546 
bcf_has_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, *
fûãr
);

553 
bcf_upd©e_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° **
ÆÀÀs
, 
«ls
);

554 
bcf_upd©e_ÆÀÀs_°r
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
ÆÀÀs_°rög
);

560 
bcf_upd©e_id
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
id
);

561 
bcf_add_id
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
id
);

576 
	#bcf_upd©e_öfo_öt32
(
hdr
,
löe
,
key
,
vÆues
,
n
Ë
	`bcf_upd©e_öfo
((hdr),÷öe),(key),(vÆues),“),
BCF_HT_INT
)

	)

577 
	#bcf_upd©e_öfo_Êﬂt
(
hdr
,
löe
,
key
,
vÆues
,
n
Ë
	`bcf_upd©e_öfo
((hdr),÷öe),(key),(vÆues),“),
BCF_HT_REAL
)

	)

578 
	#bcf_upd©e_öfo_Êag
(
hdr
,
löe
,
key
,
°rög
,
n
Ë
	`bcf_upd©e_öfo
((hdr),÷öe),(key),(°rög),“),
BCF_HT_FLAG
)

	)

579 
	#bcf_upd©e_öfo_°rög
(
hdr
,
löe
,
key
,
°rög
Ë
	`bcf_upd©e_öfo
((hdr),÷öe),(key),(°rög),1,
BCF_HT_STR
)

	)

580 
bcf_upd©e_öfo
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
, c⁄° *
vÆues
, 
n
, 
ty≥
);

598 
	#bcf_upd©e_f‹m©_öt32
(
hdr
,
löe
,
key
,
vÆues
,
n
Ë
	`bcf_upd©e_f‹m©
((hdr),÷öe),(key),(vÆues),“),
BCF_HT_INT
)

	)

599 
	#bcf_upd©e_f‹m©_Êﬂt
(
hdr
,
löe
,
key
,
vÆues
,
n
Ë
	`bcf_upd©e_f‹m©
((hdr),÷öe),(key),(vÆues),“),
BCF_HT_REAL
)

	)

600 
	#bcf_upd©e_f‹m©_ch¨
(
hdr
,
löe
,
key
,
vÆues
,
n
Ë
	`bcf_upd©e_f‹m©
((hdr),÷öe),(key),(vÆues),“),
BCF_HT_STR
)

	)

601 
	#bcf_upd©e_gíŸy≥s
(
hdr
,
löe
,
gts
,
n
Ë
	`bcf_upd©e_f‹m©
((hdr),÷öe),"GT",(gts),“),
BCF_HT_INT
)

602 
	`bcf_upd©e_f‹m©_°rög
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
, c⁄° **
vÆues
, 
n
);

	)

603 
bcf_upd©e_f‹m©
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
, c⁄° *
vÆues
, 
n
, 
ty≥
);

608 
	#bcf_gt_pha£d
(
idx
Ë(((idx)+1)<<1|1)

	)

609 
	#bcf_gt_u≈ha£d
(
idx
Ë(((idx)+1)<<1)

	)

610 
	#bcf_gt_missög
 0

	)

611 
	#bcf_gt_is_missög
(
vÆ
Ë((vÆ)>>1 ? 0 : 1)

	)

612 
	#bcf_gt_is_pha£d
(
idx
Ë((idx)&1)

	)

613 
	#bcf_gt_ÆÀÀ
(
vÆ
Ë(((vÆ)>>1)-1)

	)

616 
	#bcf_ÆÀÀs2gt
(
a
,
b
Ë(◊)>(b)?(◊)*(◊)+1)/2+(b)):((b)*((b)+1)/2+◊)))

	)

617 
ölöe
 
bcf_gt2ÆÀÀs
(
igt
, *
a
, *
b
)

619 
	gk
 = 0, 
	gdk
 = 1;

620  
	gk
<
	gigt
 ) { 
	gdk
++; k +
dk
; }

621 *
	gb
 = 
dk
 - 1; *
	ga
 = 
igt
 - 
k
 + *
b
;

633 
bcf_fmt_t
 *
bcf_gë_fmt
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
);

634 
bcf_öfo_t
 *
bcf_gë_öfo
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
);

644 
bcf_fmt_t
 *
bcf_gë_fmt_id
(
bcf1_t
 *
löe
, c⁄° 
id
);

645 
bcf_öfo_t
 *
bcf_gë_öfo_id
(
bcf1_t
 *
löe
, c⁄° 
id
);

666 
	#bcf_gë_öfo_öt32
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_öfo_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_INT
)

	)

667 
	#bcf_gë_öfo_Êﬂt
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_öfo_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_REAL
)

	)

668 
	#bcf_gë_öfo_°rög
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_öfo_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_STR
)

	)

669 
	#bcf_gë_öfo_Êag
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_öfo_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_FLAG
)

	)

670 
bcf_gë_öfo_vÆues
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
èg
, **
d°
, *
nd°
, 
ty≥
);

724 
	#bcf_gë_f‹m©_öt32
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_f‹m©_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_INT
)

	)

725 
	#bcf_gë_f‹m©_Êﬂt
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_f‹m©_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_REAL
)

	)

726 
	#bcf_gë_f‹m©_ch¨
(
hdr
,
löe
,
èg
,
d°
,
nd°
Ë
	`bcf_gë_f‹m©_vÆues
(hdr,löe,èg,(**)(d°),nd°,
BCF_HT_STR
)

	)

727 
	#bcf_gë_gíŸy≥s
(
hdr
,
löe
,
d°
,
nd°
Ë
	`bcf_gë_f‹m©_vÆues
(hdr,löe,"GT",(**)(d°),nd°,
BCF_HT_INT
)

	)

728 
bcf_gë_f‹m©_°rög
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
èg
, ***
d°
, *
nd°
);

729 
bcf_gë_f‹m©_vÆues
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
èg
, **
d°
, *
nd°
, 
ty≥
);

746 
bcf_hdr_id2öt
(c⁄° 
bcf_hdr_t
 *
hdr
, 
ty≥
, c⁄° *
id
);

747 
	#bcf_hdr_öt2id
(
hdr
,
ty≥
,
öt_id
Ë((hdr)->
id
[ty≥][öt_id].
key
)

	)

753 
ölöe
 
bcf_hdr_«me2id
(c⁄° 
bcf_hdr_t
 *
hdr
, c⁄° *
id
Ë{  
bcf_hdr_id2öt
(hdr, 
BCF_DT_CTG
, id); }

754 
ölöe
 c⁄° *
bcf_hdr_id2«me
(c⁄° 
bcf_hdr_t
 *
hdr
, 
rid
Ë{  
	ghdr
->
	gid
[
BCF_DT_CTG
][rid].
	gkey
; }

755 
ölöe
 c⁄° *
bcf_£q«me
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
ªc
Ë{  
	ghdr
->
	gid
[
BCF_DT_CTG
][ªc->
rid
].
	gkey
; }

771 
	#bcf_hdr_id2Àngth
(
hdr
,
ty≥
,
öt_id
Ë((hdr)->
id
[
BCF_DT_ID
][öt_id].
vÆ
->
öfo
[ty≥]>>8 & 0xf)

	)

772 
	#bcf_hdr_id2numbî
(
hdr
,
ty≥
,
öt_id
Ë((hdr)->
id
[
BCF_DT_ID
][öt_id].
vÆ
->
öfo
[ty≥]>>12)

	)

773 
	#bcf_hdr_id2ty≥
(
hdr
,
ty≥
,
öt_id
Ë((hdr)->
id
[
BCF_DT_ID
][öt_id].
vÆ
->
öfo
[ty≥]>>4 & 0xf)

	)

774 
	#bcf_hdr_id2cﬁty≥
(
hdr
,
ty≥
,
öt_id
Ë((hdr)->
id
[
BCF_DT_ID
][öt_id].
vÆ
->
öfo
[ty≥] & 0xf)

	)

775 
	#bcf_hdr_idöfo_exi°s
(
hdr
,
ty≥
,
öt_id
Ë((öt_id<0 || 
	`bcf_hdr_id2cﬁty≥
(hdr,ty≥,öt_id)==0xfË? 0 : 1)

	)

776 
	#bcf_hdr_id2hªc
(
hdr
,
di˘_ty≥
,
cﬁ_ty≥
,
öt_id
Ë((hdr)->
id
[(di˘_ty≥)==
BCF_DT_CTG
?BCF_DT_CTG:
BCF_DT_ID
][öt_id].
vÆ
->
hªc
[(di˘_ty≥)==BCF_DT_CTG?0:(cﬁ_ty≥)])

	)

778 
bcf_fmt_¨øy
(
k°rög_t
 *
s
, 
n
, 
ty≥
, *
d©a
);

779 
uöt8_t
 *
bcf_fmt_sized_¨øy
(
k°rög_t
 *
s
, uöt8_à*
±r
);

781 
bcf_íc_vch¨
(
k°rög_t
 *
s
, 
l
, c⁄° *
a
);

782 
bcf_íc_vöt
(
k°rög_t
 *
s
, 
n
, 
öt32_t
 *
a
, 
wsize
);

783 
bcf_íc_vÊﬂt
(
k°rög_t
 *
s
, 
n
, *
a
);

794 
	#bcf_ôr_de°roy
(
ôî
Ë
	`hts_ôr_de°roy
(ôî)

	)

795 
	#bcf_ôr_quîyi
(
idx
, 
tid
, 
beg
, 
íd
Ë
	`hts_ôr_quîy
((idx), (tid), (beg), (íd), 
bcf_ªadªc
)

	)

796 
	#bcf_ôr_quîys
(
idx
, 
hdr
, 
s
Ë
	`hts_ôr_quîys
((idx), (s), (
hts_«me2id_f
)(
bcf_hdr_«me2id
), (hdr), 
hts_ôr_quîy
, 
bcf_ªadªc
)

	)

797 
	#bcf_ôr_√xt
(
htsÂ
, 
ôr
, 
r
Ë
	`hts_ôr_√xt
((htsÂ)->
Â
.
bgzf
, (ôr), (r), 0)

	)

798 
	#bcf_ödex_lﬂd
(
‚
Ë
	`hts_idx_lﬂd
(‚, 
HTS_FMT_CSI
)

	)

799 
	#bcf_ödex_£q«mes
(
idx
, 
hdr
, 
≈å
Ë
	`hts_idx_£q«mes
((idx),“±r),(
hts_id2«me_f
)(
bcf_hdr_id2«me
),(hdr))

	)

801 
hts_idx_t
 *
bcf_ödex_lﬂd2
(c⁄° *
‚
, c⁄° *
‚idx
);

816 
bcf_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
);

832 
bcf_ödex_buûd2
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
);

849 
bcf_ödex_buûd3
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, 
n_thªads
);

868 
	#bcf_öt8_ve˘‹_íd
 (
INT8_MIN
+1)

	)

869 
	#bcf_öt16_ve˘‹_íd
 (
INT16_MIN
+1)

	)

870 
	#bcf_öt32_ve˘‹_íd
 (
INT32_MIN
+1)

	)

871 
	#bcf_°r_ve˘‹_íd
 0

	)

872 
	#bcf_öt8_missög
 
INT8_MIN


	)

873 
	#bcf_öt16_missög
 
INT16_MIN


	)

874 
	#bcf_öt32_missög
 
INT32_MIN


	)

875 
	#bcf_°r_missög
 0x07

	)

876 
uöt32_t
 
bcf_Êﬂt_ve˘‹_íd
;

877 
uöt32_t
 
bcf_Êﬂt_missög
;

878 
ölöe
 
bcf_Êﬂt_£t
(*
±r
, 
uöt32_t
 
vÆue
)

880 uni⁄ { 
uöt32_t
 
	gi
; 
	gf
; } 
	gu
;

881 
	gu
.
	gi
 = 
vÆue
;

882 *
	g±r
 = 
u
.
f
;

884 
	#bcf_Êﬂt_£t_ve˘‹_íd
(
x
Ë
	`bcf_Êﬂt_£t
(&(x),
bcf_Êﬂt_ve˘‹_íd
)

	)

885 
	#bcf_Êﬂt_£t_missög
(
x
Ë
	`bcf_Êﬂt_£t
(&(x),
bcf_Êﬂt_missög
)

	)

886 
ölöe
 
bcf_Êﬂt_is_missög
(
f
)

888 uni⁄ { 
uöt32_t
 
	gi
; 
	gf
; } 
	gu
;

889 
	gu
.
	gf
 = 
f
;

890  
	gu
.
	gi
==
bcf_Êﬂt_missög
 ? 1 : 0;

892 
ölöe
 
bcf_Êﬂt_is_ve˘‹_íd
(
f
)

894 uni⁄ { 
uöt32_t
 
	gi
; 
	gf
; } 
	gu
;

895 
	gu
.
	gf
 = 
f
;

896  
	gu
.
	gi
==
bcf_Êﬂt_ve˘‹_íd
 ? 1 : 0;

899 
ölöe
 
bcf_f‹m©_gt
(
bcf_fmt_t
 *
fmt
, 
ißm∂e
, 
k°rög_t
 *
°r
)

901 
	#BRANCH
(
ty≥_t
, 
missög
, 
ve˘‹_íd
) { \

902 
ty≥_t
 *
±r
 = (ty≥_t*Ë(
fmt
->
p
 + 
ißm∂e
*fmt->
size
); \

903 
i
; \

904 
i
=0; i<
fmt
->
n
 && 
±r
[i]!=
ve˘‹_íd
; i++) \

906 i‡–
i
 ) 
	`kputc
("/|"[
±r
[i]&1], 
°r
); \

907 i‡–!(
±r
[
i
]>>1ËË
	`kputc
('.', 
°r
); \

908 
	`kputw
((
±r
[
i
]>>1Ë- 1, 
°r
); \

910 i‡(
i
 =0Ë
	`kputc
('.', 
°r
); \

911 }

	)

912 
	gfmt
->
	gty≥
) {

913 
	gBCF_BT_INT8
: 
BRANCH
(
öt8_t
, 
bcf_öt8_missög
, 
bcf_öt8_ve˘‹_íd
); ;

914 
	gBCF_BT_INT16
: 
BRANCH
(
öt16_t
, 
bcf_öt16_missög
, 
bcf_öt16_ve˘‹_íd
); ;

915 
	gBCF_BT_INT32
: 
BRANCH
(
öt32_t
, 
bcf_öt32_missög
, 
bcf_öt32_ve˘‹_íd
); ;

916 
	gBCF_BT_NULL
: 
kputc
('.', 
°r
); ;

917 : 
Ârötf
(
°dîr
,"FIXME:Åy≥ %d i¿bcf_f‹m©_gt?\n", 
fmt
->
ty≥
); 
ab‹t
(); ;

919 #unde‡
BRANCH


922 
ölöe
 
bcf_íc_size
(
k°rög_t
 *
s
, 
size
, 
ty≥
)

924 i‡(
	gsize
 >= 15) {

925 
kputc
(15<<4|
ty≥
, 
s
);

926 i‡(
	gsize
 >= 128) {

927 i‡(
size
 >= 32768) {

928 
öt32_t
 
x
 = 
size
;

929 
kputc
(1<<4|
BCF_BT_INT32
, 
s
);

930 
kput¢
((*)&
x
, 4, 
s
);

932 
öt16_t
 
	gx
 = 
size
;

933 
kputc
(1<<4|
BCF_BT_INT16
, 
s
);

934 
kput¢
((*)&
x
, 2, 
s
);

937 
kputc
(1<<4|
BCF_BT_INT8
, 
s
);

938 
kputc
(
size
, 
s
);

940 } 
kputc
(
size
<<4|
ty≥
, 
s
);

943 
ölöe
 
bcf_íc_öây≥
(
x
)

945 i‡(
	gx
 <
INT8_MAX
 && 
x
 > 
bcf_öt8_missög
Ë 
BCF_BT_INT8
;

946 i‡(
	gx
 <
INT16_MAX
 && 
x
 > 
bcf_öt16_missög
Ë 
BCF_BT_INT16
;

947  
	gBCF_BT_INT32
;

950 
ölöe
 
bcf_íc_öt1
(
k°rög_t
 *
s
, 
öt32_t
 
x
)

952 i‡(
	gx
 =
bcf_öt32_ve˘‹_íd
) {

953 
bcf_íc_size
(
s
, 1, 
BCF_BT_INT8
);

954 
kputc
(
bcf_öt8_ve˘‹_íd
, 
s
);

955 } i‡(
	gx
 =
bcf_öt32_missög
) {

956 
bcf_íc_size
(
s
, 1, 
BCF_BT_INT8
);

957 
kputc
(
bcf_öt8_missög
, 
s
);

958 } i‡(
	gx
 <
INT8_MAX
 && 
x
 > 
bcf_öt8_missög
) {

959 
bcf_íc_size
(
s
, 1, 
BCF_BT_INT8
);

960 
kputc
(
x
, 
s
);

961 } i‡(
	gx
 <
INT16_MAX
 && 
x
 > 
bcf_öt16_missög
) {

962 
öt16_t
 
z
 = 
x
;

963 
bcf_íc_size
(
s
, 1, 
BCF_BT_INT16
);

964 
kput¢
((*)&
z
, 2, 
s
);

966 
öt32_t
 
	gz
 = 
x
;

967 
bcf_íc_size
(
s
, 1, 
BCF_BT_INT32
);

968 
kput¢
((*)&
z
, 4, 
s
);

972 
ölöe
 
öt32_t
 
bcf_dec_öt1
(c⁄° 
uöt8_t
 *
p
, 
ty≥
, uöt8_à**
q
)

974 i‡(
	gty≥
 =
BCF_BT_INT8
) {

975 *
q
 = (
uöt8_t
*)
p
 + 1;

976  
À_to_i8
(
p
);

977 } i‡(
	gty≥
 =
BCF_BT_INT16
) {

978 *
q
 = (
uöt8_t
*)
p
 + 2;

979  
À_to_i16
(
p
);

981 *
	gq
 = (
uöt8_t
*)
p
 + 4;

982  
À_to_i32
(
p
);

986 
ölöe
 
öt32_t
 
bcf_dec_ty≥d_öt1
(c⁄° 
uöt8_t
 *
p
, uöt8_à**
q
)

988  
bcf_dec_öt1
(
p
 + 1, *p&0xf, 
q
);

991 
ölöe
 
öt32_t
 
bcf_dec_size
(c⁄° 
uöt8_t
 *
p
, uöt8_à**
q
, *
ty≥
)

993 *
	gty≥
 = *
p
 & 0xf;

994 i‡(*
	gp
>>4 != 15) {

995 *
q
 = (
uöt8_t
*)
p
 + 1;

996  *
	gp
>>4;

997 }  
bcf_dec_ty≥d_öt1
(
p
 + 1, 
q
);

1000 #ifde‡
__˝lu•lus


	@htslib/htslib/vcf_sweep.h

26 #i‚de‡
HTSLIB_VCF_SWEEP_H


27 
	#HTSLIB_VCF_SWEEP_H


	)

29 
	~"hts.h
"

30 
	~"vcf.h
"

32 #ifde‡
__˝lu•lus


36 
_bcf_swìp_t
 
	tbcf_swìp_t
;

38 
bcf_swìp_t
 *
bcf_swìp_öô
(c⁄° *
‚ame
);

39 
bcf_swìp_de°roy
(
bcf_swìp_t
 *
sw
);

40 
bcf_hdr_t
 *
bcf_swìp_hdr
(
bcf_swìp_t
 *
sw
);

41 
bcf1_t
 *
bcf_swìp_fwd
(
bcf_swìp_t
 *
sw
);

42 
bcf1_t
 *
bcf_swìp_bwd
(
bcf_swìp_t
 *
sw
);

44 #ifde‡
__˝lu•lus


	@htslib/htslib/vcfutils.h

26 #i‚de‡
HTSLIB_VCFUTILS_H


27 
	#HTSLIB_VCFUTILS_H


	)

29 
	~"vcf.h
"

31 #ifde‡
__˝lu•lus


35 
kbô£t_t
;

47 
bcf_åim_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
);

58 
bcf_ªmove_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
, 
mask
Ë
HTS_DEPRECATED
("Please use bcf_remove_allele_set instead");

71 
bcf_ªmove_ÆÀÀ_£t
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
, c⁄° 
kbô£t_t
 *
rm_£t
);

87 
bcf_ˇlc_ac
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
, *
ac
, 
which
);

105 
	#GT_HOM_RR
 0

106 
	#GT_HOM_AA
 1

	)

107 
	#GT_HET_RA
 2

	)

108 
	#GT_HET_AA
 3

	)

109 
	#GT_HAPL_R
 4

	)

110 
	#GT_HAPL_A
 5

	)

111 
	#GT_UNKN
 6

	)

112 
bcf_gt_ty≥
(
bcf_fmt_t
 *
fmt_±r
, 
ißm∂e
, *
ül
, *
jÆ
);

114 
ölöe
 
bcf_acgt2öt
(
c
)

116 i‡–()
c
>96 ) c -= 32;

117 i‡–
c
=='A' )  0;

118 i‡–
c
=='C' )  1;

119 i‡–
c
=='G' )  2;

120 i‡–
c
=='T' )  3;

124 
	#bcf_öt2acgt
(
i
Ë"ACGT"[i]

	)

132 
	#bcf_ij2G
(
i
, 
j
Ë((j)*((j)+1)/2+(i))

	)

134 #ifde‡
__˝lu•lus


	@htslib/kfunc.c

27 
	~<c⁄fig.h
>

29 
	~<m©h.h
>

30 
	~<°dlib.h
>

31 
	~"ht¶ib/kfunc.h
"

37 
	$kf_lgamma
(
z
)

39 
x
 = 0;

40 
x
 +0.1659470187408462e-06 / (
z
+7);

41 
x
 +0.9934937113930748e-05 / (
z
+6);

42 
x
 -0.1385710331296526 / (
z
+5);

43 
x
 +12.50734324009056 / (
z
+4);

44 
x
 -176.6150291498386 / (
z
+3);

45 
x
 +771.3234287757674 / (
z
+2);

46 
x
 -1259.139216722289 / (
z
+1);

47 
x
 +676.5203681218835 / 
z
;

48 
x
 += 0.9999999999995183;

49  
	`log
(
x
Ë- 5.58106146679532777 - 
z
 + (z-0.5) *Üog(z+6.5);

50 
	}
}

56 
	$kf_îfc
(
x
)

58 c⁄° 
p0
 = 220.2068679123761;

59 c⁄° 
p1
 = 221.2135961699311;

60 c⁄° 
p2
 = 112.0792914978709;

61 c⁄° 
p3
 = 33.912866078383;

62 c⁄° 
p4
 = 6.37396220353165;

63 c⁄° 
p5
 = .7003830644436881;

64 c⁄° 
p6
 = .03526249659989109;

65 c⁄° 
q0
 = 440.4137358247522;

66 c⁄° 
q1
 = 793.8265125199484;

67 c⁄° 
q2
 = 637.3336333788311;

68 c⁄° 
q3
 = 296.5642487796737;

69 c⁄° 
q4
 = 86.78073220294608;

70 c⁄° 
q5
 = 16.06417757920695;

71 c⁄° 
q6
 = 1.755667163182642;

72 c⁄° 
q7
 = .08838834764831844;

73 
ex≤é
, 
z
, 
p
;

74 
z
 = 
	`Ábs
(
x
Ë* 
M_SQRT2
;

75 i‡(
z
 > 37.Ë 
x
 > 0.? 0. : 2.;

76 
ex≤é
 = 
	`exp
(
z
 * z * - .5);

77 i‡(
z
 < 10. / 
M_SQRT2
)

78 
p
 = 
ex≤é
 * ((((((
p6
 * 
z
 + 
p5
Ë* z + 
p4
Ë* z + 
p3
Ë* z + 
p2
Ë* z + 
p1
Ë* z + 
p0
)

79 / (((((((
q7
 * 
z
 + 
q6
Ë* z + 
q5
Ë* z + 
q4
Ë* z + 
q3
Ë* z + 
q2
Ë* z + 
q1
Ë* z + 
q0
);

80 
p
 = 
ex≤é
 / 2.506628274631001 / (
z
 + 1. / (z + 2. / (z + 3. / (z + 4. / (z + .65)))));

81  
x
 > 0.? 2. * 
p
 : 2. * (1. -Ö);

82 
	}
}

97 
	#KF_GAMMA_EPS
 1e-14

	)

98 
	#KF_TINY
 1e-290

	)

101 
	$_kf_gamm≠
(
s
, 
z
)

103 
sum
, 
x
;

104 
k
;

105 
k
 = 1, 
sum
 = 
x
 = 1.; k < 100; ++k) {

106 
sum
 +(
x
 *
z
 / (
s
 + 
k
));

107 i‡(
x
 / 
sum
 < 
KF_GAMMA_EPS
) ;

109  
	`exp
(
s
 * 
	`log
(
z
Ë- z - 
	`kf_lgamma
(†+ 1.Ë+Üog(
sum
));

110 
	}
}

112 
	$_kf_gammaq
(
s
, 
z
)

114 
j
;

115 
C
, 
D
, 
f
;

116 
f
 = 1. + 
z
 - 
s
; 
C
 = f; 
D
 = 0.;

119 
j
 = 1; j < 100; ++j) {

120 
a
 = 
j
 * (
s
 - j), 
b
 = (j<<1Ë+ 1 + 
z
 - s, 
d
;

121 
D
 = 
b
 + 
a
 * D;

122 i‡(
D
 < 
KF_TINY
) D = KF_TINY;

123 
C
 = 
b
 + 
a
 / C;

124 i‡(
C
 < 
KF_TINY
) C = KF_TINY;

125 
D
 = 1. / D;

126 
d
 = 
C
 * 
D
;

127 
f
 *
d
;

128 i‡(
	`Ábs
(
d
 - 1.Ë< 
KF_GAMMA_EPS
) ;

130  
	`exp
(
s
 * 
	`log
(
z
Ë- z - 
	`kf_lgamma
(sË-Üog(
f
));

131 
	}
}

133 
	$kf_gamm≠
(
s
, 
z
)

135  
z
 <1. || z < 
s
? 
	`_kf_gamm≠
(s, zË: 1. - 
	`_kf_gammaq
(s, z);

136 
	}
}

138 
	$kf_gammaq
(
s
, 
z
)

140  
z
 <1. || z < 
s
? 1. - 
	`_kf_gamm≠
(s, zË: 
	`_kf_gammaq
(s, z);

141 
	}
}

150 
	$kf_bëai_aux
(
a
, 
b
, 
x
)

152 
C
, 
D
, 
f
;

153 
j
;

154 i‡(
x
 == 0.)  0.;

155 i‡(
x
 == 1.)  1.;

156 
f
 = 1.; 
C
 = f; 
D
 = 0.;

158 
j
 = 1; j < 200; ++j) {

159 
Ø
, 
d
;

160 
m
 = 
j
>>1;

161 
Ø
 = (
j
&1)? -(
a
 + 
m
Ë* (®+ 
b
 + mË* 
x
 / ((a + 2*m) * (a + 2*m + 1))

162 : 
m
 * (
b
 - mË* 
x
 / ((
a
 + 2*m - 1) * (a + 2*m));

163 
D
 = 1. + 
Ø
 * D;

164 i‡(
D
 < 
KF_TINY
) D = KF_TINY;

165 
C
 = 1. + 
Ø
 / C;

166 i‡(
C
 < 
KF_TINY
) C = KF_TINY;

167 
D
 = 1. / D;

168 
d
 = 
C
 * 
D
;

169 
f
 *
d
;

170 i‡(
	`Ábs
(
d
 - 1.Ë< 
KF_GAMMA_EPS
) ;

172  
	`exp
(
	`kf_lgamma
(
a
+
b
Ë- kf_lgamma◊Ë- kf_lgamma(bË+á * 
	`log
(
x
Ë+ b *Üog(1.-x)Ë/á / 
f
;

173 
	}
}

174 
	$kf_bëai
(
a
, 
b
, 
x
)

176  
x
 < (
a
 + 1.Ë/ (®+ 
b
 + 2.)? 
	`kf_bëai_aux
(a, b, x) : 1. - kf_betai_aux(b,á, 1. - x);

177 
	}
}

179 #ifde‡
KF_MAIN


180 
	~<°dio.h
>

181 
	$maö
(
¨gc
, *
¨gv
[])

183 
x
 = 5.5, 
y
 = 3;

184 
a
, 
b
;

185 
	`¥ötf
("îfc(%lg): %lg, %lg\n", 
x
, 
	`îfc
(x), 
	`kf_îfc
(x));

186 
	`¥ötf
("uµî-gamma(%lg,%lg): %lg\n", 
x
, 
y
, 
	`kf_gammaq
(y, x)*
	`tgamma
(y));

187 
a
 = 2; 
b
 = 2; 
x
 = 0.5;

188 
	`¥ötf
("öcom∂ëe-bëa(%lg,%lg,%lg): %lg\n", 
a
, 
b
, 
x
, 
	`kf_bëai
◊, b, xË/ 
	`exp
(
	`kf_lgamma
(a+b) - kf_lgamma(a) - kf_lgamma(b)));

190 
	}
}

195 
	$lböom
(
n
, 
k
)

197 i‡(
k
 =0 || 
n
 == k)  0;

198  
	`lgamma
(
n
+1Ë-Ügamma(
k
+1) -Ügamma(n-k+1);

199 
	}
}

207 
	$hy≥rgeo
(
n11
, 
n1_
, 
n_1
, 
n
)

209  
	`exp
(
	`lböom
(
n1_
, 
n11
Ë+Üböom(
n
-n1_, 
n_1
-n11) -Übinom(n,Ç_1));

210 
	}
}

213 
	mn11
, 
	mn1_
, 
	mn_1
, 
	mn
;

214 
	mp
;

215 } 
	thgacc_t
;

218 
	$hy≥rgeo_acc
(
n11
, 
n1_
, 
n_1
, 
n
, 
hgacc_t
 *
aux
)

220 i‡(
n1_
 || 
n_1
 || 
n
) {

221 
aux
->
n11
 =Ç11;áux->
n1_
 =Ç1_;áux->
n_1
 =Ç_1;áux->
n
 =Ç;

223 i‡(
n11
%11 &&Ç11 + 
aux
->
n
 -áux->
n1_
 -áux->
n_1
) {

224 i‡(
n11
 =
aux
->n11 + 1) {

225 
aux
->
p
 *()◊ux->
n1_
 -áux->
n11
) /Ç11

226 * (
aux
->
n_1
 -áux->
n11
Ë/ (n11 +áux->
n
 -áux->
n1_
 -áux->n_1);

227 
aux
->
n11
 =Ç11;

228  
aux
->
p
;

230 i‡(
n11
 =
aux
->n11 - 1) {

231 
aux
->
p
 *(Ôux->
n11
 / (aux->
n1_
 -Ç11)

232 * (
aux
->
n11
 +áux->
n
 -áux->
n1_
 -áux->
n_1
) / (aux->n_1 -Ç11);

233 
aux
->
n11
 =Ç11;

234  
aux
->
p
;

237 
aux
->
n11
 =Ç11;

239 
aux
->
p
 = 
	`hy≥rgeo
◊ux->
n11
,áux->
n1_
,áux->
n_1
,áux->
n
);

240  
aux
->
p
;

241 
	}
}

243 
	$kt_fishî_exa˘
(
n11
, 
n12
, 
n21
, 
n22
, *
_À·
, *
_right
, *
two
)

245 
i
, 
j
, 
max
, 
mö
;

246 
p
, 
q
, 
À·
, 
right
;

247 
hgacc_t
 
aux
;

248 
n1_
, 
n_1
, 
n
;

250 
n1_
 = 
n11
 + 
n12
; 
n_1
 =Ç11 + 
n21
; 
n
 =Ç11 +Ç12 +Ç21 + 
n22
;

251 
max
 = (
n_1
 < 
n1_
) ?Ç_1 :Ç1_;

252 
mö
 = 
n1_
 + 
n_1
 - 
n
;

253 i‡(
mö
 < 0) min = 0;

254 *
two
 = *
_À·
 = *
_right
 = 1.;

255 i‡(
mö
 =
max
)  1.;

256 
q
 = 
	`hy≥rgeo_acc
(
n11
, 
n1_
, 
n_1
, 
n
, &
aux
);

258 
p
 = 
	`hy≥rgeo_acc
(
mö
, 0, 0, 0, &
aux
);

259 
À·
 = 0., 
i
 = 
mö
 + 1; 
p
 < 0.99999999 * 
q
 && i<=
max
; ++i)

260 
À·
 +
p
,Ö = 
	`hy≥rgeo_acc
(
i
, 0, 0, 0, &
aux
);

261 --
i
;

262 i‡(
p
 < 1.00000001 * 
q
Ë
À·
 +=Ö;

263 --
i
;

265 
p
 = 
	`hy≥rgeo_acc
(
max
, 0, 0, 0, &
aux
);

266 
right
 = 0., 
j
 = 
max
 - 1; 
p
 < 0.99999999 * 
q
 && j>=0; --j)

267 
right
 +
p
,Ö = 
	`hy≥rgeo_acc
(
j
, 0, 0, 0, &
aux
);

268 ++
j
;

269 i‡(
p
 < 1.00000001 * 
q
Ë
right
 +=Ö;

270 ++
j
;

272 *
two
 = 
À·
 + 
right
;

273 i‡(*
two
 > 1.) *two = 1.;

275 i‡(
	`abs
(
i
 - 
n11
Ë<ábs(
j
 -Ç11)Ë
right
 = 1. - 
À·
 + 
q
;

276 
À·
 = 1.0 - 
right
 + 
q
;

277 *
_À·
 = 
À·
; *
_right
 = 
right
;

278  
q
;

279 
	}
}

	@htslib/knetfile.c

31 
	~<c⁄fig.h
>

33 
	~<time.h
>

34 
	~<°dio.h
>

35 
	~<˘y≥.h
>

36 
	~<°dlib.h
>

37 
	~<°rög.h
>

38 
	~<î∫o.h
>

39 
	~<uni°d.h
>

40 
	~<sys/ty≥s.h
>

42 #i‚de‡
_WIN32


43 
	~<√tdb.h
>

44 
	~<¨∑/öë.h
>

45 
	~<sys/sockë.h
>

46 
	~<sys/£À˘.h
>

49 
	~"ht¶ib/k√tfûe.h
"

63 
	$sockë_waô
(
fd
, 
is_ªad
)

65 
fd_£t
 
fds
, *
fdr
 = 0, *
fdw
 = 0;

66 
timevÆ
 
tv
;

67 
ªt
;

68 
tv
.
tv_£c
 = 5;Åv.
tv_u£c
 = 0;

69 
	`FD_ZERO
(&
fds
);

70 
	`FD_SET
(
fd
, &
fds
);

71 i‡(
is_ªad
Ë
fdr
 = &
fds
;

72 
fdw
 = &
fds
;

73 
ªt
 = 
	`£À˘
(
fd
+1, 
fdr
, 
fdw
, 0, &
tv
);

74 #i‚de‡
_WIN32


75 i‡(
ªt
 =-1Ë
	`≥º‹
("select");

77 i‡(
ªt
 == 0)

78 
	`Ârötf
(
°dîr
, "selectÅime-out\n");

79 i‡(
ªt
 =
SOCKET_ERROR
)

80 
	`Ârötf
(
°dîr
, "£À˘: %d\n", 
	`WSAGëLa°Eº‹
());

82  
ªt
;

83 
	}
}

85 #i‚de‡
_WIN32


89 
	$sockë_c⁄√˘
(c⁄° *
ho°
, c⁄° *
p‹t
)

91 
	#__îr_c⁄√˘
(
func
Ëdÿ{ 
	`≥º‹
(func); 
	`‰ìaddröfo
(
ªs
);  -1; } 0)

	)

93 
ai_îr
, 
⁄
 = 1, 
fd
;

94 
lögî
 
 g
 = { 0, 0 };

95 
addröfo
 
höts
, *
ªs
 = 0;

96 
	`mem£t
(&
höts
, 0, (
addröfo
));

97 
höts
.
ai_Ámûy
 = 
AF_UNSPEC
;

98 
höts
.
ai_sockty≥
 = 
SOCK_STREAM
;

101 i‡((
ai_îr
 = 
	`gëaddröfo
(
ho°
, 
p‹t
, &
höts
, &
ªs
)Ë!0Ë{ 
	`Ârötf
(
°dîr
, "ˇn'àªsﬁvê%s:%s: %s\n", ho°,Ö‹t, 
	`gai_°ªº‹
(ai_err));  -1; }

102 i‡((
fd
 = 
	`sockë
(
ªs
->
ai_Ámûy
,Ñes->
ai_sockty≥
,Ñes->
ai_¥Ÿocﬁ
)Ë=-1Ë
	`__îr_c⁄√˘
("socket");

106 i‡(
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
⁄
, (⁄)Ë=-1Ë
	`__îr_c⁄√˘
("setsockopt");

107 i‡(
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_LINGER
, &
 g
, ÷ng)Ë=-1Ë
	`__îr_c⁄√˘
("setsockopt");

108 i‡(
	`c⁄√˘
(
fd
, 
ªs
->
ai_addr
,Ñes->
ai_addæí
Ë!0Ë
	`__îr_c⁄√˘
("connect");

109 
	`‰ìaddröfo
(
ªs
);

110  
fd
;

111 
	}
}

114 *
	$öt64to°r
(*
buf
, 
öt64_t
 
x
)

116 
˙t
;

117 
i
 = 0;

119 
buf
[
i
++] = '0' + 
x
 % 10;

120 
x
 /= 10;

121 } 
x
);

122 
buf
[
i
] = 0;

123 
˙t
 = 
i
, i = 0; i < cnt/2; ++i) {

124 
c
 = 
buf
[
i
]; buf[i] = buf[
˙t
-i-1]; buf[cnt-i-1] = c;

126  
buf
;

127 
	}
}

129 
öt64_t
 
	$°πoöt64
(c⁄° *
buf
)

131 
öt64_t
 
x
;

132 
x
 = 0; *
buf
 != '\0'; ++buf)

133 
x
 = x * 10 + ((
öt64_t
Ë*
buf
 - 48);

134  
x
;

135 
	}
}

137 
	$k√t_wö32_öô
()

139 
WSADATA
 
wßD©a
;

140  
	`WSASèπup
(
	`MAKEWORD
(2, 2), &
wßD©a
);

141 
	}
}

142 
	$k√t_wö32_de°roy
()

144 
	`WSACÀ™up
();

145 
	}
}

150 
SOCKET
 
	$sockë_c⁄√˘
(c⁄° *
ho°
, c⁄° *
p‹t
)

152 
	#__îr_c⁄√˘
(
func
) \

154 
	`Ârötf
(
°dîr
, "%s: %d\n", 
func
, 
	`WSAGëLa°Eº‹
()); \

156 } 0)

	)

158 
⁄
 = 1;

159 
SOCKET
 
fd
;

160 
lögî
 
 g
 = { 0, 0 };

161 
sockaddr_ö
 
£rvî
;

162 
ho°ít
 *
hp
 = 0;

164 i‡((
fd
 = 
	`sockë
(
AF_INET
, 
SOCK_STREAM
, 
IPPROTO_TCP
)Ë=
INVALID_SOCKET
Ë
	`__îr_c⁄√˘
("socket");

165 i‡(
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (*)&
⁄
, (⁄)Ë=-1Ë
	`__îr_c⁄√˘
("setsockopt");

166 i‡(
	`£tsock›t
(
fd
, 
SOL_SOCKET
, 
SO_LINGER
, (*)&
 g
, ÷ng)Ë=-1Ë
	`__îr_c⁄√˘
("setsockopt");

168 i‡(
	`ißÕha
(
ho°
[0])Ë
hp
 = 
	`gëho°by«me
(host);

170 
ö_addr
 
addr
;

171 
addr
.
s_addr
 = 
	`öë_addr
(
ho°
);

172 
hp
 = 
	`gëho°byaddr
((*)&
addr
, 4, 
AF_INET
);

174 i‡(
hp
 =0Ë
	`__îr_c⁄√˘
("gethost");

176 
£rvî
.
sö_addr
.
s_addr
 = *((*)
hp
->
h_addr
);

177 
£rvî
.
sö_Ámûy

AF_INET
;

178 
£rvî
.
sö_p‹t
 = 
	`ht⁄s
(
	`©oi
(
p‹t
));

179 i‡(
	`c⁄√˘
(
fd
, (
sockaddr
*)&
£rvî
, (£rvî)Ë!0Ë
	`__îr_c⁄√˘
("connect");

181  
fd
;

182 
	}
}

185 
off_t
 
	$my_√åód
(
fd
, *
buf
, 
off_t
 
Àn
)

187 
off_t
 
ª°
 = 
Àn
, 
cuº
, 
l
 = 0;

190 
ª°
) {

191 i‡(
	`sockë_waô
(
fd
, 1) <= 0) ;

192 
cuº
 = 
	`√åód
(
fd
, (*)((*)
buf
 + 
l
), 
ª°
);

197 i‡(
cuº
 == 0) ;

198 
l
 +
cuº
; 
ª°
 -= curr;

200  
l
;

201 
	}
}

207 
	$k·p_gë_ª•⁄£
(
k√tFûe
 *
·p
)

209 #i‚de‡
_WIN32


210 
c
;

212 
c
;

214 
n
 = 0;

215 *
p
;

216 i‡(
	`sockë_waô
(
·p
->
˘æ_fd
, 1) <= 0)  0;

217 
	`√åód
(
·p
->
˘æ_fd
, &
c
, 1)) {

219 i‡(
n
 >
·p
->
max_ª•⁄£
) {

220 
·p
->
max_ª•⁄£
 = ftp->max_response? ftp->max_response<<1 : 256;

221 
·p
->
ª•⁄£
 = (*)
	`ªÆloc
(·p->ª•⁄£, fç->
max_ª•⁄£
);

223 
·p
->
ª•⁄£
[
n
++] = 
c
;

224 i‡(
c
 == '\n') {

225 i‡(
n
 >4 && 
	`isdigô
(
·p
->
ª•⁄£
[0]) && isdigit(ftp->response[1]) && isdigit(ftp->response[2])

226 && 
·p
->
ª•⁄£
[3] != '-') ;

227 
n
 = 0;

231 i‡(
n
 < 2)  -1;

232 
·p
->
ª•⁄£
[
n
-2] = 0;

233  
	`°πﬁ
(
·p
->
ª•⁄£
, &
p
, 0);

234 
	}
}

236 
	$k·p_£nd_cmd
(
k√tFûe
 *
·p
, c⁄° *
cmd
, 
is_gë
)

238 i‡(
	`sockë_waô
(
·p
->
˘æ_fd
, 0) <= 0)  -1;

239 
Àn
 = 
	`°æí
(
cmd
);

240 i‡–
	`√twrôe
(
·p
->
˘æ_fd
, 
cmd
, 
Àn
) !=Üen )  -1;

241  
is_gë
? 
	`k·p_gë_ª•⁄£
(
·p
) : 0;

242 
	}
}

244 
	$k·p_∑sv_¥ï
(
k√tFûe
 *
·p
)

246 *
p
;

247 
v
[6];

248 
	`k·p_£nd_cmd
(
·p
, "PASV\r\n", 1);

249 
p
 = 
·p
->
ª•⁄£
; *p && *p != '('; ++p);

250 i‡(*
p
 != '(')  -1;

251 ++
p
;

252 
	`ssˇnf
(
p
, "%d,%d,%d,%d,%d,%d", &
v
[0], &v[1], &v[2], &v[3], &v[4], &v[5]);

253 
	`mem˝y
(
·p
->
∑sv_ù
, 
v
, 4 * ());

254 
·p
->
∑sv_p‹t
 = (
v
[4]<<8&0xff00) + v[5];

256 
	}
}

259 
	$k·p_∑sv_c⁄√˘
(
k√tFûe
 *
·p
)

261 
ho°
[80], 
p‹t
[10];

262 i‡(
·p
->
∑sv_p‹t
 == 0) {

263 
	`Ârötf
(
°dîr
, "[kftp_pasv_connect] kftp_pasv_prep() isÇot called before hand.\n");

266 
	`•rötf
(
ho°
, "%d.%d.%d.%d", 
·p
->
∑sv_ù
[0], ftp->pasv_ip[1], ftp->pasv_ip[2], ftp->pasv_ip[3]);

267 
	`•rötf
(
p‹t
, "%d", 
·p
->
∑sv_p‹t
);

268 
·p
->
fd
 = 
	`sockë_c⁄√˘
(
ho°
, 
p‹t
);

269 i‡(
·p
->
fd
 == -1)  -1;

271 
	}
}

273 
	$k·p_c⁄√˘
(
k√tFûe
 *
·p
)

275 
·p
->
˘æ_fd
 = 
	`sockë_c⁄√˘
(·p->
ho°
, fç->
p‹t
);

276 i‡(
·p
->
˘æ_fd
 == -1)  -1;

277 
	`k·p_gë_ª•⁄£
(
·p
);

278 
	`k·p_£nd_cmd
(
·p
, "USERánonymous\r\n", 1);

279 
	`k·p_£nd_cmd
(
·p
, "PASS kftp@\r\n", 1);

280 
	`k·p_£nd_cmd
(
·p
, "TYPE I\r\n", 1);

282 
	}
}

284 
	$k·p_ªc⁄√˘
(
k√tFûe
 *
·p
)

286 i‡(
·p
->
˘æ_fd
 != -1) {

287 
	`√t˛o£
(
·p
->
˘æ_fd
);

288 
·p
->
˘æ_fd
 = -1;

290 
	`√t˛o£
(
·p
->
fd
);

291 
·p
->
fd
 = -1;

292  
	`k·p_c⁄√˘
(
·p
);

293 
	}
}

296 
k√tFûe
 *
	$k·p_∑r£_uæ
(c⁄° *
‚
, c⁄° *
mode
)

298 
k√tFûe
 *
Â
;

299 *
p
;

300 
l
;

301 i‡(
	`°r°r
(
‚
, "ftp://") != fn)  0;

302 
p
 = (*)
‚
 + 6; *p && *p != '/'; ++p);

303 i‡(*
p
 != '/')  0;

304 
l
 = 
p
 - 
‚
 - 6;

305 
Â
 = (
k√tFûe
*)
	`ˇŒoc
(1, (knetFile));

306 
Â
->
ty≥
 = 
KNF_TYPE_FTP
;

307 
Â
->
fd
 = -1;

310 
Â
->
p‹t
 = 
	`°rdup
("21");

311 
Â
->
ho°
 = (*)
	`ˇŒoc
(
l
 + 1, 1);

312 i‡(
	`°rchr
(
mode
, 'c')Ë
Â
->
no_ªc⁄√˘
 = 1;

313 
	`°∫˝y
(
Â
->
ho°
, 
‚
 + 6, 
l
);

314 
Â
->
ªå
 = (*)
	`ˇŒoc
(
	`°æí
(
p
) + 8, 1);

315 
	`•rötf
(
Â
->
ªå
, "RETR %s\r\n", 
p
);

316 
Â
->
size_cmd
 = (*)
	`ˇŒoc
(
	`°æí
(
p
) + 8, 1);

317 
	`•rötf
(
Â
->
size_cmd
, "SIZE %s\r\n", 
p
);

318 
Â
->
£ek_off£t
 = 0;

319  
Â
;

320 
	}
}

322 
	$k·p_c⁄√˘_fûe
(
k√tFûe
 *
Â
)

324 
ªt
;

325 
fûe_size
;

326 i‡(
Â
->
fd
 != -1) {

327 
	`√t˛o£
(
Â
->
fd
);

328 i‡(
Â
->
no_ªc⁄√˘
Ë
	`k·p_gë_ª•⁄£
(fp);

330 
	`k·p_∑sv_¥ï
(
Â
);

331 
	`k·p_£nd_cmd
(
Â
, fp->
size_cmd
, 1);

332 #i‚de‡
_WIN32


335 i‡–
	`ssˇnf
(
Â
->
ª•⁄£
,"%*d %Œd", &
fûe_size
) != 1 )  -1;

337 c⁄° *
p
 = 
Â
->
ª•⁄£
;

338 *
p
 != ' ') ++p;

339 *
p
 < '0' || *p > '9') ++p;

340 
fûe_size
 = 
	`°πoöt64
(
p
);

342 
Â
->
fûe_size
 = file_size;

343 i‡(
Â
->
off£t
>=0) {

344 
tmp
[32];

345 #i‚de‡
_WIN32


346 
	`•rötf
(
tmp
, "REST %Œd\r\n", ()
Â
->
off£t
);

348 
	`°r˝y
(
tmp
, "REST ");

349 
	`öt64to°r
(
tmp
 + 5, 
Â
->
off£t
);

350 
	`°rˇt
(
tmp
, "\r\n");

352 
	`k·p_£nd_cmd
(
Â
, 
tmp
, 1);

354 
	`k·p_£nd_cmd
(
Â
, fp->
ªå
, 0);

355 
	`k·p_∑sv_c⁄√˘
(
Â
);

356 
ªt
 = 
	`k·p_gë_ª•⁄£
(
Â
);

357 i‡(
ªt
 != 150) {

358 
	`Ârötf
(
°dîr
, "[k·p_c⁄√˘_fûe] %s\n", 
Â
->
ª•⁄£
);

359 
	`√t˛o£
(
Â
->
fd
);

360 
Â
->
fd
 = -1;

363 
Â
->
is_ªady
 = 1;

365 
	}
}

372 
k√tFûe
 *
	$khâp_∑r£_uæ
(c⁄° *
‚
, c⁄° *
mode
)

374 
k√tFûe
 *
Â
;

375 *
p
, *
¥oxy
, *
q
;

376 
l
;

377 i‡(
	`°r°r
(
‚
, "http://") != fn)  0;

379 
p
 = (*)
‚
 + 7; *p && *p != '/'; ++p);

380 
l
 = 
p
 - 
‚
 - 7;

381 
Â
 = (
k√tFûe
*)
	`ˇŒoc
(1, (knetFile));

382 
Â
->
hâp_ho°
 = (*)
	`ˇŒoc
(
l
 + 1, 1);

383 
	`°∫˝y
(
Â
->
hâp_ho°
, 
‚
 + 7, 
l
);

384 
Â
->
hâp_ho°
[
l
] = 0;

385 
q
 = 
Â
->
hâp_ho°
; *q && *q != ':'; ++q);

386 i‡(*
q
 == ':') *q++ = 0;

388 
¥oxy
 = 
	`gëív
("http_proxy");

390 i‡(
¥oxy
 == 0) {

391 
Â
->
ho°
 = 
	`°rdup
(Â->
hâp_ho°
);

392 
Â
->
p‹t
 = 
	`°rdup
(*
q
? q : "80");

393 
Â
->
∑th
 = 
	`°rdup
(*
p
?Ö : "/");

395 
Â
->
ho°
 = (
	`°r°r
(
¥oxy
, "hâp://"Ë=¥oxy)? 
	`°rdup
(proxy + 7) : strdup(proxy);

396 
q
 = 
Â
->
ho°
; *q && *q != ':'; ++q);

397 i‡(*
q
 == ':') *q++ = 0;

398 
Â
->
p‹t
 = 
	`°rdup
(*
q
? q : "80");

399 
Â
->
∑th
 = 
	`°rdup
(
‚
);

401 
Â
->
ty≥
 = 
KNF_TYPE_HTTP
;

402 
Â
->
˘æ_fd
 = fp->
fd
 = -1;

403 
Â
->
£ek_off£t
 = 0;

404  
Â
;

405 
	}
}

407 
	$khâp_c⁄√˘_fûe
(
k√tFûe
 *
Â
)

409 
ªt
, 
l
 = 0;

410 *
buf
, *
p
;

411 i‡(
Â
->
fd
 !-1Ë
	`√t˛o£
(fp->fd);

412 
Â
->
fd
 = 
	`sockë_c⁄√˘
(Â->
ho°
, fp->
p‹t
);

413 
buf
 = (*)
	`ˇŒoc
(0x10000, 1);

414 
l
 +
	`•rötf
(
buf
 +Ü, "GET %†HTTP/1.0\r\nHo°: %s\r\n", 
Â
->
∑th
, fp->
hâp_ho°
);

415 i‡(
Â
->
off£t
 !0Ë
l
 +
	`•rötf
(
buf
 +Ü, "Range: bytes=%lld-\r\n", ()fp->offset);

416 
l
 +
	`•rötf
(
buf
 +Ü, "\r\n");

417 i‡–
	`√twrôe
(
Â
->
fd
, 
buf
, 
l
Ë!»Ë{ 
	`‰ì
(buf);  -1; }

418 
l
 = 0;

419 
	`√åód
(
Â
->
fd
, 
buf
 + 
l
, 1)) {

420 i‡(
buf
[
l
] == '\n' &&Ü >= 3)

421 i‡(
	`°∫cmp
(
buf
 + 
l
 - 3, "\r\n\r\n", 4) == 0) ;

422 ++
l
;

424 
buf
[
l
] = 0;

425 i‡(
l
 < 14) {

426 
	`‰ì
(
buf
);

427 
	`√t˛o£
(
Â
->
fd
);

428 
Â
->
fd
 = -1;

431 
ªt
 = 
	`°πﬁ
(
buf
 + 8, &
p
, 0);

432 i‡(
ªt
 =200 && 
Â
->
off£t
>0) {

433 
off_t
 
ª°
 = 
Â
->
off£t
;

434 
ª°
) {

435 
off_t
 
l
 = 
ª°
 < 0x10000?Ñest : 0x10000;

436 
ª°
 -
	`my_√åód
(
Â
->
fd
, 
buf
, 
l
);

438 } i‡(
ªt
 != 206 &&Ñet != 200) {

440 
	`‰ì
(
buf
);

441 
	`√t˛o£
(
Â
->
fd
);

442 
ªt
) {

443 401: 
î∫o
 = 
EPERM
; ;

444 403: 
î∫o
 = 
EACCES
; ;

445 404: 
î∫o
 = 
ENOENT
; ;

446 407: 
î∫o
 = 
EPERM
; ;

447 408: 
î∫o
 = 
ETIMEDOUT
; ;

448 410: 
î∫o
 = 
ENOENT
; ;

449 503: 
î∫o
 = 
EAGAIN
; ;

450 504: 
î∫o
 = 
ETIMEDOUT
; ;

451 : 
î∫o
 = (
ªt
 >400 &&Ñë < 500)? 
EINVAL
 : 
EIO
; ;

453 
Â
->
fd
 = -1;

456 
	`‰ì
(
buf
);

457 
Â
->
is_ªady
 = 1;

459 
	}
}

465 
k√tFûe
 *
	$k√t_›í
(c⁄° *
‚
, c⁄° *
mode
)

467 
k√tFûe
 *
Â
 = 0;

468 i‡(
mode
[0] != 'r') {

469 
	`Ârötf
(
°dîr
, "[knet_open] only mode \"r\" is supported.\n");

470 
î∫o
 = 
ENOTSUP
;

473 i‡(
	`°r°r
(
‚
, "ftp://") == fn) {

474 
Â
 = 
	`k·p_∑r£_uæ
(
‚
, 
mode
);

475 i‡(
Â
 == 0)  0;

476 i‡(
	`k·p_c⁄√˘
(
Â
) == -1) {

477 
	`k√t_˛o£
(
Â
);

480 
	`k·p_c⁄√˘_fûe
(
Â
);

481 } i‡(
	`°r°r
(
‚
, "http://") == fn) {

482 
Â
 = 
	`khâp_∑r£_uæ
(
‚
, 
mode
);

483 i‡(
Â
 == 0)  0;

484 
	`khâp_c⁄√˘_fûe
(
Â
);

486 #ifde‡
_WIN32


490 
fd
 = 
	`›í
(
‚
, 
O_RDONLY
 | 
O_BINARY
);

492 
fd
 = 
	`›í
(
‚
, 
O_RDONLY
);

494 i‡(
fd
 == -1) {

495 
	`≥º‹
("open");

498 
Â
 = (
k√tFûe
*)
	`ˇŒoc
(1, (knetFile));

499 
Â
->
ty≥
 = 
KNF_TYPE_LOCAL
;

500 
Â
->
fd
 = fd;

501 
Â
->
˘æ_fd
 = -1;

503 i‡(
Â
 && fp->
fd
 == -1) {

504 
	`k√t_˛o£
(
Â
);

507  
Â
;

508 
	}
}

510 
k√tFûe
 *
	$k√t_d›í
(
fd
, c⁄° *
mode
)

512 
k√tFûe
 *
Â
 = (k√tFûe*)
	`ˇŒoc
(1, (knetFile));

513 
Â
->
ty≥
 = 
KNF_TYPE_LOCAL
;

514 
Â
->
fd
 = fd;

515  
Â
;

516 
	}
}

518 
ssize_t
 
	$k√t_ªad
(
k√tFûe
 *
Â
, *
buf
, 
size_t
 
Àn
)

520 
off_t
 
l
 = 0;

521 i‡(
Â
->
fd
 == -1)  0;

522 i‡(
Â
->
ty≥
 =
KNF_TYPE_FTP
) {

523 i‡(
Â
->
is_ªady
 == 0) {

524 i‡(!
Â
->
no_ªc⁄√˘
Ë
	`k·p_ªc⁄√˘
(fp);

525 
	`k·p_c⁄√˘_fûe
(
Â
);

527 } i‡(
Â
->
ty≥
 =
KNF_TYPE_HTTP
) {

528 i‡(
Â
->
is_ªady
 == 0)

529 
	`khâp_c⁄√˘_fûe
(
Â
);

531 i‡(
Â
->
ty≥
 =
KNF_TYPE_LOCAL
) {

532 
size_t
 
ª°
 = 
Àn
;

533 
ssize_t
 
cuº
;

534 
ª°
) {

536 
cuº
 = 
	`ªad
(
Â
->
fd
, (*)((*)
buf
 + 
l
), 
ª°
);

537 } 
cuº
 < 0 && 
EINTR
 =
î∫o
);

538 i‡(
cuº
 < 0)  -1;

539 i‡(
cuº
 == 0) ;

540 
l
 +
cuº
; 
ª°
 -= curr;

542 } 
l
 = 
	`my_√åód
(
Â
->
fd
, 
buf
, 
Àn
);

543 
Â
->
off£t
 +
l
;

544  
l
;

545 
	}
}

547 
off_t
 
	$k√t_£ek
(
k√tFûe
 *
Â
, 
off_t
 
off
, 
whí˚
)

549 i‡(
whí˚
 =
SEEK_SET
 && 
off
 =
Â
->
off£t
)  0;

550 i‡(
Â
->
ty≥
 =
KNF_TYPE_LOCAL
) {

552 
off_t
 
off£t
 = 
	`l£ek
(
Â
->
fd
, 
off
, 
whí˚
);

553 i‡(
off£t
 == -1)  -1;

554 
Â
->
off£t
 = offset;

555  
Â
->
off£t
;

556 } i‡(
Â
->
ty≥
 =
KNF_TYPE_FTP
) {

557 i‡(
whí˚
 =
SEEK_CUR
Ë
Â
->
off£t
 +
off
;

558 i‡(
whí˚
 =
SEEK_SET
Ë
Â
->
off£t
 = 
off
;

559 i‡(
whí˚
 =
SEEK_END
Ë
Â
->
off£t
 = fp->
fûe_size
 + 
off
;

561 
Â
->
is_ªady
 = 0;

562  
Â
->
off£t
;

563 } i‡(
Â
->
ty≥
 =
KNF_TYPE_HTTP
) {

564 i‡(
whí˚
 =
SEEK_END
) {

565 
	`Ârötf
(
°dîr
, "[knet_seek] SEEK_END isÇot supported for HTTP. Offset is unchanged.\n");

566 
î∫o
 = 
ESPIPE
;

569 i‡(
whí˚
 =
SEEK_CUR
Ë
Â
->
off£t
 +
off
;

570 i‡(
whí˚
 =
SEEK_SET
Ë
Â
->
off£t
 = 
off
;

572 
Â
->
is_ªady
 = 0;

573  
Â
->
off£t
;

575 
î∫o
 = 
EINVAL
;

576 
	`Ârötf
(
°dîr
,"[k√t_£ek] %s\n", 
	`°ªº‹
(
î∫o
));

578 
	}
}

580 
	$k√t_˛o£
(
k√tFûe
 *
Â
)

582 i‡(
Â
 == 0)  0;

583 i‡(
Â
->
˘æ_fd
 !-1Ë
	`√t˛o£
(fp->ctrl_fd);

584 i‡(
Â
->
fd
 != -1) {

587 i‡(
Â
->
ty≥
 =
KNF_TYPE_LOCAL
Ë
	`˛o£
(Â->
fd
);

588 
	`√t˛o£
(
Â
->
fd
);

590 
	`‰ì
(
Â
->
ho°
); fªe(Â->
p‹t
);

591 
	`‰ì
(
Â
->
ª•⁄£
); fªe(Â->
ªå
);

592 
	`‰ì
(
Â
->
∑th
); fªe(Â->
hâp_ho°
);

593 
	`‰ì
(
Â
);

595 
	}
}

597 #ifde‡
KNETFILE_MAIN


598 
	$maö
()

600 *
buf
;

601 
k√tFûe
 *
Â
;

602 
ty≥
 = 4, 
l
;

603 #ifde‡
_WIN32


604 
	`k√t_wö32_öô
();

606 
buf
 = 
	`ˇŒoc
(0x100000, 1);

607 i‡(
ty≥
 == 0) {

608 
Â
 = 
	`k√t_›í
("knetfile.c", "r");

609 
	`k√t_£ek
(
Â
, 1000, 
SEEK_SET
);

610 } i‡(
ty≥
 == 1) {

611 
Â
 = 
	`k√t_›í
("ftp://ftp.ncbi.nih.gov/1000genomes/ftp/data/NA12878/alignment/NA12878.chrom6.SLX.SRP000032.2009_06.bam", "r");

612 
	`k√t_£ek
(
Â
, 2500000000Œ, 
SEEK_SET
);

613 
l
 = 
	`k√t_ªad
(
Â
, 
buf
, 255);

614 } i‡(
ty≥
 == 2) {

615 
Â
 = 
	`k√t_›í
("ftp://ftp.sanger.ac.uk/pub4/treefam/tmp/index.shtml", "r");

616 
	`k√t_£ek
(
Â
, 1000, 
SEEK_SET
);

617 } i‡(
ty≥
 == 3) {

618 
Â
 = 
	`k√t_›í
("http://www.sanger.ac.uk/Users/lh3/index.shtml", "r");

619 
	`k√t_£ek
(
Â
, 1000, 
SEEK_SET
);

620 } i‡(
ty≥
 == 4) {

621 
Â
 = 
	`k√t_›í
("http://www.sanger.ac.uk/Users/lh3/ex1.bam", "r");

622 
	`k√t_ªad
(
Â
, 
buf
, 10000);

623 
	`k√t_£ek
(
Â
, 20000, 
SEEK_SET
);

624 
	`k√t_£ek
(
Â
, 10000, 
SEEK_SET
);

625 
l
 = 
	`k√t_ªad
(
Â
, 
buf
+10000, 10000000) + 10000;

627 i‡(
ty≥
 != 4 &&Åype != 1) {

628 
	`k√t_ªad
(
Â
, 
buf
, 255);

629 
buf
[255] = 0;

630 
	`¥ötf
("%s\n", 
buf
);

631 } 
	`wrôe
(
	`fûío
(
°dout
), 
buf
, 
l
);

632 
	`k√t_˛o£
(
Â
);

633 
	`‰ì
(
buf
);

635 
	}
}

	@htslib/kstring.c

26 
	~<c⁄fig.h
>

28 
	~<°d¨g.h
>

29 
	~<°dio.h
>

30 
	~<˘y≥.h
>

31 
	~<°rög.h
>

32 
	~<°döt.h
>

33 
	~<m©h.h
>

34 
	~"ht¶ib/k°rög.h
"

36 
	$kputd
(
d
, 
k°rög_t
 *
s
) {

37 
Àn
 = 0;

38 
buf
[21], *
˝
 = buf+20, *
ï
;

39 i‡(
d
 == 0) {

40 i‡(
	`signbô
(
d
)) {

41 
	`kput¢
("-0",2,
s
);

44 
	`kput¢
("0",1,
s
);

49 i‡(
d
 < 0) {

50 
	`kputc
('-',
s
);

51 
Àn
 = 1;

52 
d
=-d;

54 i‡(!(
d
 >= 0.0001 && d <= 999999)) {

55 i‡(
	`ks_ªsize
(
s
, s->
l
 + 50) < 0)

56  
EOF
;

58 
s2
 = 
	`•rötf
(
s
->†+ s->
l
, "%g", 
d
);

59 
Àn
 +
s2
;

60 
s
->
l
 +
s2
;

61  
Àn
;

64 
uöt64_t
 
i
 = 
d
*10000000000;

70 i‡(
d
<.0001)

71 
i
+=0;

72 i‡(
d
<0.001)

73 
i
+=5;

74 i‡(
d
 < 0.01)

75 
i
+=50;

76 i‡(
d
 < 0.1)

77 
i
+=500;

78 i‡(
d
 < 1)

79 
i
+=5000;

80 i‡(
d
 < 10)

81 
i
+=50000;

82 i‡(
d
 < 100)

83 
i
+=500000;

84 i‡(
d
 < 1000)

85 
i
+=5000000;

86 i‡(
d
 < 10000)

87 
i
+=50000000;

88 i‡(
d
 < 100000)

89 
i
+=500000000;

91 
i
+=5000000000;

94 *--
˝
 = '0' + 
i
%10;

95 
i
 /= 10;

96 } 
i
 >= 1);

97 
buf
[20] = 0;

98 
p
 = 
buf
+20-
˝
;

99 i‡(
p
 <= 10) {

101 
˝
[6] = 0; 
ï
 = cp+5;

102 
p
 < 10) {

103 *--
˝
 = '0';

104 
p
++;

106 *--
˝
 = '.';

107 *--
˝
 = '0';

109 *
xp
 = --
˝
;

110 
p
 > 10) {

111 
xp
[0] = xp[1];

112 
p
--;

113 
xp
++;

115 
xp
[0] = '.';

116 
˝
[7] = 0; 
ï
=cp+6;

117 i‡(
˝
[6] == '.') cp[6] = 0;

121 *
ï
 ='0' &&É∞> 
˝
)

122 
ï
--;

123 *
z
 = 
ï
+1;

124 
ï
 > 
˝
) {

125 i‡(*
ï
 == '.') {

126 i‡(
z
[-1] == '.')

127 
z
[-1] = 0;

129 
z
[0] = 0;

132 
ï
--;

135 
¶
 = 
	`°æí
(
˝
);

136 
Àn
 +
¶
;

137 
	`kput¢
(
˝
, 
¶
, 
s
);

138  
Àn
;

139 
	}
}

141 
	$kv•rötf
(
k°rög_t
 *
s
, c⁄° *
fmt
, 
va_li°
 
≠
)

143 
va_li°
 
¨gs
;

144 
l
;

145 
	`va_c›y
(
¨gs
, 
≠
);

147 i‡(
fmt
[0] == '%' && fmt[1] == 'g' && fmt[2] == 0) {

148 
d
 = 
	`va_¨g
(
¨gs
, );

149 
l
 = 
	`kputd
(
d
, 
s
);

150 
	`va_íd
(
¨gs
);

151  
l
;

154 
l
 = 
	`v¢¥ötf
(
s
->†+ s->l, s->
m
 - s->l, 
fmt
, 
¨gs
);

155 
	`va_íd
(
¨gs
);

156 i‡(
l
 + 1 > 
s
->
m
 - s->l) {

157 i‡(
	`ks_ªsize
(
s
, s->
l
 +Ü + 2) < 0)

159 
	`va_c›y
(
¨gs
, 
≠
);

160 
l
 = 
	`v¢¥ötf
(
s
->†+ s->l, s->
m
 - s->l, 
fmt
, 
¨gs
);

161 
	`va_íd
(
¨gs
);

163 
s
->
l
 +=Ü;

164  
l
;

165 
	}
}

167 
	$k•rötf
(
k°rög_t
 *
s
, c⁄° *
fmt
, ...)

169 
va_li°
 
≠
;

170 
l
;

171 
	`va_°¨t
(
≠
, 
fmt
);

172 
l
 = 
	`kv•rötf
(
s
, 
fmt
, 
≠
);

173 
	`va_íd
(
≠
);

174  
l
;

175 
	}
}

177 *
	$k°πok
(c⁄° *
°r
, c⁄° *
£p
, 
ks_tokaux_t
 *
aux
)

179 c⁄° *
p
, *
°¨t
;

180 i‡(
£p
) {

181 i‡(
°r
 =0 && (
aux
->
èb
[0]&1))  0;

182 
aux
->
föished
 = 0;

183 i‡(
£p
[1]) {

184 
aux
->
£p
 = -1;

185 
aux
->
èb
[0] =áux->tab[1] =áux->tab[2] =áux->tab[3] = 0;

186 
p
 = 
£p
; *p; ++pË
aux
->
èb
[*p>>6] |= 1ull<<(*p&0x3f);

187 } 
aux
->
£p
 = sep[0];

189 i‡(
aux
->
föished
)  0;

190 i‡(
°r
Ë
aux
->
p
 = så - 1,áux->
föished
 = 0;

191 i‡(
aux
->
£p
 < 0) {

192 
p
 = 
°¨t
 = 
aux
->p + 1; *p; ++p)

193 i‡(
aux
->
èb
[*
p
>>6]>>(*p&0x3f)&1) ;

195 
p
 = 
°¨t
 = 
aux
->p + 1; *p; ++p)

196 i‡(*
p
 =
aux
->
£p
) ;

198 
aux
->
p
 =Ö;

199 i‡(*
p
 =0Ë
aux
->
föished
 = 1;

200  (*)
°¨t
;

201 
	}
}

204 
	$k•lô_c‹e
(*
s
, 
dñimôî
, *
_max
, **
_off£ts
)

206 
i
, 
n
, 
max
, 
œ°_ch¨
, 
œ°_°¨t
, *
off£ts
, 
l
;

207 
n
 = 0; 
max
 = *
_max
; 
off£ts
 = *
_off£ts
;

208 
l
 = 
	`°æí
(
s
);

210 
	#__k•lô_aux
 do { \

211 i‡(
_off£ts
) { \

212 
s
[
i
] = 0; \

213 i‡(
n
 =
max
) { \

214 *
tmp
; \

215 
max
 = max? max<<1 : 2; \

216 i‡((
tmp
 = (*)
	`ªÆloc
(
off£ts
, (Ë* 
max
))) { \

217 
off£ts
 = 
tmp
; \

219 
	`‰ì
(
off£ts
); \

220 *
_off£ts
 = 
NULL
; \

224 
off£ts
[
n
++] = 
œ°_°¨t
; \

225 } ++
n
; \

226 } 0)

	)

228 
i
 = 0, 
œ°_ch¨
 = 
œ°_°¨t
 = 0; i <
l
; ++i) {

229 i‡(
dñimôî
 == 0) {

230 i‡(
	`is•a˚
(
s
[
i
]) || s[i] == 0) {

231 i‡(
	`isgøph
(
œ°_ch¨
)Ë
__k•lô_aux
;

233 i‡(
	`is•a˚
(
œ°_ch¨
Ë||Üa°_ch¨ =0Ë
œ°_°¨t
 = 
i
;

236 i‡(
s
[
i
] =
dñimôî
 || s[i] == 0) {

237 i‡(
œ°_ch¨
 !0 &&Üa°_ch¨ !
dñimôî
Ë
__k•lô_aux
;

239 i‡(
œ°_ch¨
 =
dñimôî
 ||Üa°_ch¨ =0Ë
œ°_°¨t
 = 
i
;

242 
œ°_ch¨
 = 
s
[
i
];

244 *
_max
 = 
max
; *
_off£ts
 = 
off£ts
;

245  
n
;

246 
	}
}

248 
	$kgëlöe
(
k°rög_t
 *
s
, 
kgës_func
 *
fgës_‚
, *
Â
)

250 
size_t
 
l0
 = 
s
->
l
;

252 
s
->
l
 =
l0
 || s->s[s->l-1] != '\n') {

253 i‡(
s
->
m
 - s->
l
 < 200) {

254 i‡(
	`ks_ªsize
(
s
, s->
m
 + 200) < 0)

255  
EOF
;

257 i‡(
	`fgës_‚
(
s
->†+ s->
l
, s->
m
 - s->l, 
Â
Ë=
NULL
) ;

258 
s
->
l
 +
	`°æí
(s->s + s->l);

261 i‡(
s
->
l
 =
l0
Ë 
EOF
;

263 i‡(
s
->
l
 > 
l0
 && s->s[s->l-1] == '\n') {

264 
s
->
l
--;

265 i‡(
s
->
l
 > 
l0
 && s->s[s->l-1] == '\r') s->l--;

267 
s
->s[s->
l
] = '\0';

269 
	}
}

275 
	tubyã_t
;

278 *
	$ksBM_¥ï
(c⁄° 
ubyã_t
 *
∑t
, 
m
)

280 
i
, *
suff
, *
¥ï
, *
bmGs
, *
bmBc
;

281 
¥ï
 = (*)
	`ˇŒoc
(
m
 + 256, ());

282 
bmGs
 = 
¥ï
; 
bmBc
 =Öª∞+ 
m
;

284 
i
 = 0; i < 256; ++iË
bmBc
[i] = 
m
;

285 
i
 = 0; i < 
m
 - 1; ++iË
bmBc
[
∑t
[i]] = m - i - 1;

287 
suff
 = (*)
	`ˇŒoc
(
m
, ());

289 
f
 = 0, 
g
;

290 
suff
[
m
 - 1] = m;

291 
g
 = 
m
 - 1;

292 
i
 = 
m
 - 2; i >= 0; --i) {

293 i‡(
i
 > 
g
 && 
suff
[ò+ 
m
 - 1 - 
f
] < i - g)

294 
suff
[
i
] = suff[ò+ 
m
 - 1 - 
f
];

296 i‡(
i
 < 
g
) g = i;

297 
f
 = 
i
;

298 
g
 >0 && 
∑t
[g] =∑t[g + 
m
 - 1 - 
f
]) --g;

299 
suff
[
i
] = 
f
 - 
g
;

304 
j
 = 0;

305 
i
 = 0; i < 
m
; ++iË
bmGs
[i] = m;

306 
i
 = 
m
 - 1; i >= 0; --i)

307 i‡(
suff
[
i
] == i + 1)

308 ; 
j
 < 
m
 - 1 - 
i
; ++j)

309 i‡(
bmGs
[
j
] =
m
)

310 
bmGs
[
j
] = 
m
 - 1 - 
i
;

311 
i
 = 0; i <
m
 - 2; ++i)

312 
bmGs
[
m
 - 1 - 
suff
[
i
]] = m - 1 - i;

314 
	`‰ì
(
suff
);

315  
¥ï
;

316 
	}
}

318 *
	$kmemmem
(c⁄° *
_°r
, 
n
, c⁄° *
_∑t
, 
m
, **
_¥ï
)

320 
i
, 
j
, *
¥ï
 = 0, *
bmGs
, *
bmBc
;

321 c⁄° 
ubyã_t
 *
°r
, *
∑t
;

322 
°r
 = (c⁄° 
ubyã_t
*)
_°r
; 
∑t
 = (c⁄° ubyã_t*)
_∑t
;

323 
¥ï
 = (
_¥ï
 =0 || *_¥ï =0)? 
	`ksBM_¥ï
(
∑t
, 
m
) : *_prep;

324 i‡(
_¥ï
 && *_¥ï =0Ë*_¥ï = 
¥ï
;

325 
bmGs
 = 
¥ï
; 
bmBc
 =Öª∞+ 
m
;

326 
j
 = 0;

327 
j
 <
n
 - 
m
) {

328 
i
 = 
m
 - 1; i >0 && 
∑t
[i] =
°r
[i+
j
]; --i);

329 i‡(
i
 >= 0) {

330 
max
 = 
bmBc
[
°r
[
i
+
j
]] - 
m
 + 1 + i;

331 i‡(
max
 < 
bmGs
[
i
]) max = bmGs[i];

332 
j
 +
max
;

333 }  (*)(
°r
 + 
j
);

335 i‡(
_¥ï
 =0Ë
	`‰ì
(
¥ï
);

337 
	}
}

339 *
	$k°r°r
(c⁄° *
°r
, c⁄° *
∑t
, **
_¥ï
)

341  (*)
	`kmemmem
(
°r
, 
	`°æí
(°r), 
∑t
, såÀn’©), 
_¥ï
);

342 
	}
}

344 *
	$k°∫°r
(c⁄° *
°r
, c⁄° *
∑t
, 
n
, **
_¥ï
)

346  (*)
	`kmemmem
(
°r
, 
n
, 
∑t
, 
	`°æí
’©), 
_¥ï
);

347 
	}
}

353 #ifde‡
KSTRING_MAIN


354 
	~<°dio.h
>

355 
	$maö
()

357 
k°rög_t
 *
s
;

358 *
fõlds
, 
n
, 
i
;

359 
ks_tokaux_t
 
aux
;

360 *
p
;

361 
s
 = (
k°rög_t
*)
	`ˇŒoc
(1, (kstring_t));

363 
	`k•rötf
(
s
, "ábcdefg: %d ", 100);

364 
	`¥ötf
("'%s'\n", 
s
->s);

366 
fõlds
 = 
	`k•lô
(
s
, 0, &
n
);

367 
i
 = 0; i < 
n
; ++i)

368 
	`¥ötf
("fõld[%d] = '%s'\n", 
i
, 
s
->†+ 
fõlds
[i]);

370 
s
->
l
 = 0;

371 
p
 = 
	`k°πok
("ab:cde:fg/hij::k", ":/", &
aux
);Ö;Ö = kstrtok(0, 0, &aux)) {

372 
	`kput¢
(
p
, 
aux
.∞-Ö, 
s
);

373 
	`kputc
('\n', 
s
);

375 
	`¥ötf
("%s", 
s
->s);

377 
	`‰ì
(
s
->s); fªe(s); fªe(
fõlds
);

380 *
°r
 = "abcdefgcdgcagtcakcdcd";

381 *
∑t
 = "cd";

382 *
ªt
, *
s
 = 
°r
;

383 *
¥ï
 = 0;

384 (
ªt
 = 
	`k°r°r
(
s
, 
∑t
, &
¥ï
)) != 0) {

385 
	`¥ötf
("m©ch: %s\n", 
ªt
);

386 
s
 = 
ªt
 + 
¥ï
[0];

388 
	`‰ì
(
¥ï
);

391 
	}
}

	@htslib/md5.c

49 
	~<c⁄fig.h
>

51 
	~<°dlib.h
>

52 
	~"ht¶ib/hts.h
"

53 
	~"ht¶ib/hts_ídün.h
"

55 #i‚de‡
HAVE_OPENSSL


57 
	~<°rög.h
>

60 
	thts_md5_u32∂us
;

62 
	shts_md5_c⁄ãxt
 {

63 
hts_md5_u32∂us
 
	mlo
, 
	mhi
;

64 
hts_md5_u32∂us
 
	ma
, 
	mb
, 
	mc
, 
	md
;

65 
	mbuf„r
[64];

66 
hts_md5_u32∂us
 
	mblock
[16];

76 
	#F
(
x
, 
y
, 
z
Ë((zË^ ((xË& ((yË^ (z))))

	)

77 
	#G
(
x
, 
y
, 
z
Ë((yË^ ((zË& ((xË^ (y))))

	)

78 
	#H
(
x
, 
y
, 
z
Ë(((xË^ (y)Ë^ (z))

	)

79 
	#H2
(
x
, 
y
, 
z
Ë((xË^ ((yË^ (z)))

	)

80 
	#I
(
x
, 
y
, 
z
Ë((yË^ ((xË| ~(z)))

	)

85 
	#STEP
(
f
, 
a
, 
b
, 
c
, 
d
, 
x
, 
t
, 
s
) \

86 (
a
Ë+
	`f
((
b
), (
c
), (
d
)Ë+ (
x
Ë+ (
t
); \

87 (
a
Ë((◊Ë<< (
s
)) | (((a) & 0xffffffff) >> (32 - (s)))); \

88 (
a
Ë+(
b
);

	)

98 #i‡
deföed
(
HTS_LITTLE_ENDIAN
Ë&& 
HTS_ALLOW_UNALIGNED
 != 0

99 
	#SET
(
n
) \

100 (*(
hts_md5_u32∂us
 *)&
±r
[(
n
Ë* 4])

	)

101 
	#GET
(
n
) \

102 
	`SET
(
n
)

	)

104 
	#SET
(
n
) \

105 (
˘x
->
block
[(
n
)] = \

106 (
hts_md5_u32∂us
)
±r
[(
n
) * 4] | \

107 ((
hts_md5_u32∂us
)
±r
[(
n
) * 4 + 1] << 8) | \

108 ((
hts_md5_u32∂us
)
±r
[(
n
) * 4 + 2] << 16) | \

109 ((
hts_md5_u32∂us
)
±r
[(
n
Ë* 4 + 3] << 24))

	)

110 
	#GET
(
n
) \

111 (
˘x
->
block
[(
n
)])

	)

118 c⁄° *
	$body
(
hts_md5_c⁄ãxt
 *
˘x
, c⁄° *
d©a
, 
size
)

120 c⁄° *
±r
;

121 
hts_md5_u32∂us
 
a
, 
b
, 
c
, 
d
;

122 
hts_md5_u32∂us
 
ßved_a
, 
ßved_b
, 
ßved_c
, 
ßved_d
;

124 
±r
 = (c⁄° *)
d©a
;

126 
a
 = 
˘x
->a;

127 
b
 = 
˘x
->b;

128 
c
 = 
˘x
->c;

129 
d
 = 
˘x
->d;

132 
ßved_a
 = 
a
;

133 
ßved_b
 = 
b
;

134 
ßved_c
 = 
c
;

135 
ßved_d
 = 
d
;

138 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(0), 0xd76aa478, 7)

139 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(1), 0xe8c7b756, 12)

140 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(2), 0x242070db, 17)

141 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(3), 0xc1bdceee, 22)

142 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(4), 0xf57c0faf, 7)

143 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(5), 0x4787c62a, 12)

144 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(6), 0xa8304613, 17)

145 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(7), 0xfd469501, 22)

146 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(8), 0x698098d8, 7)

147 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(9), 0x8b44f7af, 12)

148 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(10), 0xffff5bb1, 17)

149 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(11), 0x895cd7be, 22)

150 
	`STEP
(
F
, 
a
, 
b
, 
c
, 
d
, 
	`SET
(12), 0x6b901122, 7)

151 
	`STEP
(
F
, 
d
, 
a
, 
b
, 
c
, 
	`SET
(13), 0xfd987193, 12)

152 
	`STEP
(
F
, 
c
, 
d
, 
a
, 
b
, 
	`SET
(14), 0xa679438e, 17)

153 
	`STEP
(
F
, 
b
, 
c
, 
d
, 
a
, 
	`SET
(15), 0x49b40821, 22)

156 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(1), 0xf61e2562, 5)

157 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(6), 0xc040b340, 9)

158 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(11), 0x265e5a51, 14)

159 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(0), 0xe9b6c7aa, 20)

160 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(5), 0xd62f105d, 5)

161 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(10), 0x02441453, 9)

162 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(15), 0xd8a1e681, 14)

163 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(4), 0xe7d3fbc8, 20)

164 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(9), 0x21e1cde6, 5)

165 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(14), 0xc33707d6, 9)

166 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(3), 0xf4d50d87, 14)

167 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(8), 0x455a14ed, 20)

168 
	`STEP
(
G
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(13), 0xa9e3e905, 5)

169 
	`STEP
(
G
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(2), 0xfcefa3f8, 9)

170 
	`STEP
(
G
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(7), 0x676f02d9, 14)

171 
	`STEP
(
G
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(12), 0x8d2a4c8a, 20)

174 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(5), 0xfffa3942, 4)

175 
	`STEP
(
H2
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(8), 0x8771f681, 11)

176 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(11), 0x6d9d6122, 16)

177 
	`STEP
(
H2
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(14), 0xfde5380c, 23)

178 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(1), 0xa4beea44, 4)

179 
	`STEP
(
H2
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(4), 0x4bdecfa9, 11)

180 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(7), 0xf6bb4b60, 16)

181 
	`STEP
(
H2
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(10), 0xbebfbc70, 23)

182 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(13), 0x289b7ec6, 4)

183 
	`STEP
(
H2
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(0), 0xeaa127fa, 11)

184 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(3), 0xd4ef3085, 16)

185 
	`STEP
(
H2
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(6), 0x04881d05, 23)

186 
	`STEP
(
H
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(9), 0xd9d4d039, 4)

187 
	`STEP
(
H2
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(12), 0xe6db99e5, 11)

188 
	`STEP
(
H
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(15), 0x1fa27cf8, 16)

189 
	`STEP
(
H2
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(2), 0xc4ac5665, 23)

192 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(0), 0xf4292244, 6)

193 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(7), 0x432aff97, 10)

194 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(14), 0xab9423a7, 15)

195 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(5), 0xfc93a039, 21)

196 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(12), 0x655b59c3, 6)

197 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(3), 0x8f0ccc92, 10)

198 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(10), 0xffeff47d, 15)

199 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(1), 0x85845dd1, 21)

200 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(8), 0x6fa87e4f, 6)

201 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(15), 0xfe2ce6e0, 10)

202 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(6), 0xa3014314, 15)

203 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(13), 0x4e0811a1, 21)

204 
	`STEP
(
I
, 
a
, 
b
, 
c
, 
d
, 
	`GET
(4), 0xf7537e82, 6)

205 
	`STEP
(
I
, 
d
, 
a
, 
b
, 
c
, 
	`GET
(11), 0xbd3af235, 10)

206 
	`STEP
(
I
, 
c
, 
d
, 
a
, 
b
, 
	`GET
(2), 0x2ad7d2bb, 15)

207 
	`STEP
(
I
, 
b
, 
c
, 
d
, 
a
, 
	`GET
(9), 0xeb86d391, 21)

209 
a
 +
ßved_a
;

210 
b
 +
ßved_b
;

211 
c
 +
ßved_c
;

212 
d
 +
ßved_d
;

214 
±r
 += 64;

215 } 
size
 -= 64);

217 
˘x
->
a
 =á;

218 
˘x
->
b
 = b;

219 
˘x
->
c
 = c;

220 
˘x
->
d
 = d;

222  
±r
;

223 
	}
}

225 
	$hts_md5_ª£t
(
hts_md5_c⁄ãxt
 *
˘x
)

227 
˘x
->
a
 = 0x67452301;

228 
˘x
->
b
 = 0xefcdab89;

229 
˘x
->
c
 = 0x98badcfe;

230 
˘x
->
d
 = 0x10325476;

232 
˘x
->
lo
 = 0;

233 
˘x
->
hi
 = 0;

234 
	}
}

236 
	$hts_md5_upd©e
(
hts_md5_c⁄ãxt
 *
˘x
, c⁄° *
d©a
, 
size
)

238 
hts_md5_u32∂us
 
ßved_lo
;

239 
u£d
, 
avaûabÀ
;

241 
ßved_lo
 = 
˘x
->
lo
;

242 i‡((
˘x
->
lo
 = (
ßved_lo
 + 
size
) & 0x1fffffff) < saved_lo)

243 
˘x
->
hi
++;

244 
˘x
->
hi
 +
size
 >> 29;

246 
u£d
 = 
ßved_lo
 & 0x3f;

248 i‡(
u£d
) {

249 
avaûabÀ
 = 64 - 
u£d
;

251 i‡(
size
 < 
avaûabÀ
) {

252 
	`mem˝y
(&
˘x
->
buf„r
[
u£d
], 
d©a
, 
size
);

256 
	`mem˝y
(&
˘x
->
buf„r
[
u£d
], 
d©a
, 
avaûabÀ
);

257 
d©a
 = (c⁄° *)d©®+ 
avaûabÀ
;

258 
size
 -
avaûabÀ
;

259 
	`body
(
˘x
, ctx->
buf„r
, 64);

262 i‡(
size
 >= 64) {

263 
d©a
 = 
	`body
(
˘x
, d©a, 
size
 & ~()0x3f);

264 
size
 &= 0x3f;

267 
	`mem˝y
(
˘x
->
buf„r
, 
d©a
, 
size
);

268 
	}
}

270 
	$hts_md5_föÆ
(*
ªsu…
, 
hts_md5_c⁄ãxt
 *
˘x
)

272 
u£d
, 
avaûabÀ
;

274 
u£d
 = 
˘x
->
lo
 & 0x3f;

276 
˘x
->
buf„r
[
u£d
++] = 0x80;

278 
avaûabÀ
 = 64 - 
u£d
;

280 i‡(
avaûabÀ
 < 8) {

281 
	`mem£t
(&
˘x
->
buf„r
[
u£d
], 0, 
avaûabÀ
);

282 
	`body
(
˘x
, ctx->
buf„r
, 64);

283 
u£d
 = 0;

284 
avaûabÀ
 = 64;

287 
	`mem£t
(&
˘x
->
buf„r
[
u£d
], 0, 
avaûabÀ
 - 8);

289 
˘x
->
lo
 <<= 3;

290 
˘x
->
buf„r
[56] = ctx->
lo
;

291 
˘x
->
buf„r
[57] = ctx->
lo
 >> 8;

292 
˘x
->
buf„r
[58] = ctx->
lo
 >> 16;

293 
˘x
->
buf„r
[59] = ctx->
lo
 >> 24;

294 
˘x
->
buf„r
[60] = ctx->
hi
;

295 
˘x
->
buf„r
[61] = ctx->
hi
 >> 8;

296 
˘x
->
buf„r
[62] = ctx->
hi
 >> 16;

297 
˘x
->
buf„r
[63] = ctx->
hi
 >> 24;

299 
	`body
(
˘x
, ctx->
buf„r
, 64);

301 
ªsu…
[0] = 
˘x
->
a
;

302 
ªsu…
[1] = 
˘x
->
a
 >> 8;

303 
ªsu…
[2] = 
˘x
->
a
 >> 16;

304 
ªsu…
[3] = 
˘x
->
a
 >> 24;

305 
ªsu…
[4] = 
˘x
->
b
;

306 
ªsu…
[5] = 
˘x
->
b
 >> 8;

307 
ªsu…
[6] = 
˘x
->
b
 >> 16;

308 
ªsu…
[7] = 
˘x
->
b
 >> 24;

309 
ªsu…
[8] = 
˘x
->
c
;

310 
ªsu…
[9] = 
˘x
->
c
 >> 8;

311 
ªsu…
[10] = 
˘x
->
c
 >> 16;

312 
ªsu…
[11] = 
˘x
->
c
 >> 24;

313 
ªsu…
[12] = 
˘x
->
d
;

314 
ªsu…
[13] = 
˘x
->
d
 >> 8;

315 
ªsu…
[14] = 
˘x
->
d
 >> 16;

316 
ªsu…
[15] = 
˘x
->
d
 >> 24;

318 
	`mem£t
(
˘x
, 0, (*ctx));

319 
	}
}

322 
hts_md5_c⁄ãxt
 *
	$hts_md5_öô
()

324 
hts_md5_c⁄ãxt
 *
˘x
 = 
	`mÆloc
((*ctx));

325 i‡(!
˘x
)

326  
NULL
;

328 
	`hts_md5_ª£t
(
˘x
);

329  
˘x
;

330 
	}
}

334 
	~<›ís¶/md5.h
>

335 
	~<as£π.h
>

343 
hts_md5_c⁄ãxt
 *
	$hts_md5_öô
()

345 
MD5_CTX
 *
˘x
 = 
	`mÆloc
((*ctx));

346 i‡(!
˘x
)

347  
NULL
;

349 
	`MD5_Inô
(
˘x
);

351  (
hts_md5_c⁄ãxt
 *)
˘x
;

352 
	}
}

354 
	$hts_md5_ª£t
(
hts_md5_c⁄ãxt
 *
˘x
)

356 
	`MD5_Inô
((
MD5_CTX
 *)
˘x
);

357 
	}
}

359 
	$hts_md5_upd©e
(
hts_md5_c⁄ãxt
 *
˘x
, c⁄° *
d©a
, 
size
)

361 
	`MD5_Upd©e
((
MD5_CTX
 *)
˘x
, 
d©a
, 
size
);

362 
	}
}

364 
	$hts_md5_föÆ
(*
ªsu…
, 
hts_md5_c⁄ãxt
 *
˘x
)

366 
	`MD5_FöÆ
(
ªsu…
, (
MD5_CTX
 *)
˘x
);

367 
	}
}

371 
	$hts_md5_de°roy
(
hts_md5_c⁄ãxt
 *
˘x
)

373 i‡(!
˘x
)

376 
	`‰ì
(
˘x
);

377 
	}
}

379 
	$hts_md5_hex
(*
hex
, c⁄° *
dige°
)

381 
i
;

382 
i
 = 0; i < 16; i++) {

383 
hex
[
i
*2+0] = "0123456789abcdef"[(
dige°
[i]>>4)&0xf];

384 
hex
[
i
*2+1] = "0123456789abcdef"[
dige°
[i]&0xf];

386 
hex
[32] = 0;

387 
	}
}

	@htslib/multipart.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<°rög.h
>

29 
	~<î∫o.h
>

31 
	~"ht¶ib/k°rög.h
"

33 
	~"hts_öã∫Æ.h
"

34 
	~"hfûe_öã∫Æ.h
"

36 #i‚de‡
EPROTO


37 
	#EPROTO
 
ENOEXEC


	)

40 
	shfûe_∑π
 {

41 *
	muæ
;

42 **
	mhódîs
;

43 } 
	thfûe_∑π
;

46 
hFILE
 
	mba£
;

47 
hfûe_∑π
 *
	m∑πs
;

48 
size_t
 
	m≈¨ts
, 
	mmax∑πs
, 
	mcuºít
;

49 
hFILE
 *
	mcuºítÂ
;

50 } 
	thFILE_mu…ù¨t
;

52 
	$‰ì_∑π
(
hfûe_∑π
 *
p
)

54 
	`‰ì
(
p
->
uæ
);

55 i‡(
p
->
hódîs
) {

56 **
hdr
;

57 
hdr
 = 
p
->
hódîs
; *hdr; hdr++Ë
	`‰ì
(*hdr);

58 
	`‰ì
(
p
->
hódîs
);

61 
p
->
uæ
 = 
NULL
;

62 
p
->
hódîs
 = 
NULL
;

63 
	}
}

65 
	$‰ì_Æl_∑πs
(
hFILE_mu…ù¨t
 *
Â
)

67 
size_t
 
i
;

68 
i
 = 0; i < 
Â
->
≈¨ts
; i++Ë
	`‰ì_∑π
(&Â->
∑πs
[i]);

69 
	`‰ì
(
Â
->
∑πs
);

70 
	}
}

72 
ssize_t
 
	$mu…ù¨t_ªad
(
hFILE
 *
Âv
, *
buf„r
, 
size_t
 
nbyãs
)

74 
hFILE_mu…ù¨t
 *
Â
 = (hFILE_mu…ù¨à*Ë
Âv
;

75 
size_t
 
n
;

77 
›í_√xt
:

78 i‡(
Â
->
cuºítÂ
 =
NULL
) {

79 i‡(
Â
->
cuºít
 < fp->
≈¨ts
) {

80 c⁄° 
hfûe_∑π
 *
p
 = &
Â
->
∑πs
[Â->
cuºít
];

81 i‡(
hts_vîbo£
 >= 5)

82 
	`Ârötf
(
°dîr
, "[M::multipart_read] openingÖart #%zu of %zu:"

83 " \"%.120s%s\"\n", 
Â
->
cuºít
+1, fp->
≈¨ts
, 
p
->
uæ
,

84 (
	`°æí
(
p
->
uæ
) > 120)? "..." : "");

86 
Â
->
cuºítÂ
 = 
p
->
hódîs
?

87 
	`h›í
(
p
->
uæ
, "r:", "hâphdr:v",Ö->
hódîs
, 
NULL
)

88 : 
	`h›í
(
p
->
uæ
, "r");

90 i‡(
Â
->
cuºítÂ
 =
NULL
)  -1;

95 
n
 = 
Â
->
cuºítÂ
->
mobûe
?

96 
Â
->
cuºítÂ
->
backíd
->
	`ªad
(Â->cuºítÂ, 
buf„r
, 
nbyãs
)

97 : 
	`hªad
(
Â
->
cuºítÂ
, 
buf„r
, 
nbyãs
);

99 i‡(
n
 == 0) {

101 
hFILE
 *
¥evÂ
 = 
Â
->
cuºítÂ
;

102 
	`‰ì_∑π
(&
Â
->
∑πs
[Â->
cuºít
]);

103 
Â
->
cuºít
++;

104 
Â
->
cuºítÂ
 = 
NULL
;

105 i‡(
	`h˛o£
(
¥evÂ
) < 0)  -1;

106 
›í_√xt
;

109  
n
;

110 
	}
}

112 
ssize_t
 
	$mu…ù¨t_wrôe
(
hFILE
 *
Âv
, c⁄° *
buf„r
, 
size_t
 
nbyãs
)

114 
î∫o
 = 
EROFS
;

116 
	}
}

118 
off_t
 
	$mu…ù¨t_£ek
(
hFILE
 *
Âv
, 
off_t
 
off£t
, 
whí˚
)

120 
î∫o
 = 
ESPIPE
;

122 
	}
}

124 
	$mu…ù¨t_˛o£
(
hFILE
 *
Âv
)

126 
hFILE_mu…ù¨t
 *
Â
 = (hFILE_mu…ù¨à*Ë
Âv
;

128 
	`‰ì_Æl_∑πs
(
Â
);

129 i‡(
Â
->
cuºítÂ
) {

130 i‡(
	`h˛o£
(
Â
->
cuºítÂ
) < 0)  -1;

134 
	}
}

136 c⁄° 
hFILE_backíd
 
	gmu…ù¨t_backíd
 =

138 
mu…ù¨t_ªad
, 
mu…ù¨t_wrôe
, 
mu…ù¨t_£ek
, 
NULL
, 
mu…ù¨t_˛o£


148 
	$∑r£_ga4gh_ªdúe˘_js⁄
(
hFILE_mu…ù¨t
 *
Â
, 
hFILE
 *
js⁄
,

149 
k°rög_t
 *
b
, k°rög_à*
hódî
)

151 
hts_js⁄_tokí
 
t
;

153 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
Ë!'{'ËÅ.
ty≥
;

154 
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
) != '}') {

155 i‡(
t
.
ty≥
 != 's')  '?';

157 i‡(
	`°rcmp
(
t
.
°r
, "urls") == 0) {

158 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
Ë!'['ËÅ.
ty≥
;

160 
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
) != ']') {

161 
hfûe_∑π
 *
∑π
;

162 
size_t
 
n
 = 0, 
max
 = 0;

164 
	`hts_ex∑nd
(
hfûe_∑π
, 
Â
->
≈¨ts
+1, fp->
max∑πs
, fp->
∑πs
);

165 
∑π
 = &
Â
->
∑πs
[Â->
≈¨ts
++];

166 
∑π
->
uæ
 = 
NULL
;

167 
∑π
->
hódîs
 = 
NULL
;

169 i‡(
t
.
ty≥
 != '{') Å.type;

170 
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
) != '}') {

171 i‡(
t
.
ty≥
 != 's')  '?';

173 i‡(
	`°rcmp
(
t
.
°r
, "url") == 0) {

174 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
Ë!'s'ËÅ.
ty≥
;

175 
∑π
->
uæ
 = 
	`ks_ªÀa£
(
b
);

177 i‡(
	`°rcmp
(
t
.
°r
, "headers") == 0) {

178 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
Ë!'{'ËÅ.
ty≥
;

180 
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
hódî
) != '}') {

181 i‡(
t
.
ty≥
 != 's')  '?';

183 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
) != 's')

184  
t
.
ty≥
;

186 
	`kputs
(": ", 
hódî
);

187 
	`kputs
(
t
.
°r
, 
hódî
);

188 
n
++;

189 
	`hts_ex∑nd
(*, 
n
+1, 
max
, 
∑π
->
hódîs
);

190 
∑π
->
hódîs
[
n
-1] = 
	`ks_ªÀa£
(
hódî
);

191 
∑π
->
hódîs
[
n
] = 
NULL
;

194 i‡(
	`hts_js⁄_fskù_vÆue
(
js⁄
, '\0') != 'v')

198 i‡(! 
∑π
->
uæ
)  'i';

201 i‡(
	`°rcmp
(
t
.
°r
, "format") == 0) {

202 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
Ë!'s'ËÅ.
ty≥
;

204 i‡(
hts_vîbo£
 >= 5)

205 
	`Ârötf
(
°dîr
, "[M::multipart_open] GA4GH JSONÑedirection "

206 "tÿmu…ù¨à%†d©a\n", 
t
.
°r
);

208 i‡(
	`hts_js⁄_fskù_vÆue
(
js⁄
, '\0') != 'v')  '?';

211 i‡(
	`hts_js⁄_‚ext
(
js⁄
, &
t
, 
b
) != '\0')  '?';

214 
	}
}

216 
hFILE
 *
	$h›í_js⁄_ªdúe˘
(
hFILE
 *
hfûe
, c⁄° *
mode
)

218 
hFILE_mu…ù¨t
 *
Â
;

219 
k°rög_t
 
s1
 = { 0, 0, 
NULL
 }, 
s2
 = { 0, 0, NULL };

220 
ªt
;

222 
Â
 = (
hFILE_mu…ù¨t
 *Ë
	`hfûe_öô
( (hFILE_mu…ù¨t), 
mode
, 0);

223 i‡(
Â
 =
NULL
)  NULL;

225 
Â
->
∑πs
 = 
NULL
;

226 
Â
->
≈¨ts
 = fp->
max∑πs
 = 0;

228 
ªt
 = 
	`∑r£_ga4gh_ªdúe˘_js⁄
(
Â
, 
hfûe
, &
s1
, &
s2
);

229 
	`‰ì
(
s1
.
s
);

230 
	`‰ì
(
s2
.
s
);

231 i‡(
ªt
 != 'v') {

232 
	`‰ì_Æl_∑πs
(
Â
);

233 
	`hfûe_de°roy
((
hFILE
 *Ë
Â
);

234 
î∫o
 = (
ªt
 ='?' ||Ñë ='\0')? 
EPROTO
 : 
EINVAL
;

235  
NULL
;

238 
Â
->
cuºít
 = 0;

239 
Â
->
cuºítÂ
 = 
NULL
;

240 
Â
->
ba£
.
backíd
 = &
mu…ù¨t_backíd
;

241  &
Â
->
ba£
;

242 
	}
}

	@htslib/plugin.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<î∫o.h
>

32 
	~<dúít.h
>

33 
	~<dlf˙.h
>

35 
	~"hts_öã∫Æ.h
"

36 
	~"ht¶ib/k°rög.h
"

38 #i‚de‡
PLUGINPATH


39 
	#PLUGINPATH
 ""

	)

42 
DIR
 *
	$›í_√xtdú
(
hts_∑th_ôr
 *
ôr
)

44 
DIR
 *
dú
;

47 c⁄° *
cﬁ⁄
 = 
	`°rchr
(
ôr
->
∑thdú
, ':');

48 i‡(
cﬁ⁄
 =
NULL
)  NULL;

50 
ôr
->
íåy
.
l
 = 0;

51 
	`kput¢
(
ôr
->
∑thdú
, 
cﬁ⁄
 - iå->∑thdú, &ôr->
íåy
);

52 
ôr
->
∑thdú
 = &
cﬁ⁄
[1];

53 i‡(
ôr
->
íåy
.
l
 == 0) ;

55 
dú
 = 
	`›ídú
(
ôr
->
íåy
.
s
);

56 i‡(
dú
) ;

58 i‡(
hts_vîbo£
 >= 4)

59 
	`Ârötf
(
°dîr
,

61 
ôr
->
íåy
.
s
, 
	`°ªº‹
(
î∫o
));

64 i‡(
ôr
->
íåy
.
s
[ôr->íåy.
l
-1] !'/'Ë
	`kputc
('/', &itr->entry);

65 
ôr
->
íåy_dú_l
 = iå->
íåy
.
l
;

66  
dú
;

67 
	}
}

69 
	$hts_∑th_ôr_£tup
(
hts_∑th_ôr
 *
ôr
, c⁄° *
∑th
,

70 c⁄° *
buûtö_∑th
, c⁄° *
¥efix
, 
size_t
 
¥efix_Àn
,

71 c⁄° *
suffix
, 
size_t
 
suffix_Àn
)

73 
ôr
->
¥efix
 =Örefix;

74 
ôr
->
¥efix_Àn
 =Örefix_len;

76 i‡(
suffix
Ë
ôr
->suffix = suffix, iå->
suffix_Àn
 = suffix_len;

77 
ôr
->
suffix
 = 
PLUGIN_EXT
, iå->
suffix_Àn
 = 
	`°æí
(PLUGIN_EXT);

79 
ôr
->
∑th
.
l
 = iå->∑th.
m
 = 0; iå->∑th.
s
 = 
NULL
;

80 
ôr
->
íåy
.
l
 = iå->íåy.
m
 = 0; iå->íåy.
s
 = 
NULL
;

82 i‡(! 
buûtö_∑th
Ëbuûtö_∑th = 
PLUGINPATH
;

83 i‡(! 
∑th
) {

84 
∑th
 = 
	`gëív
("HTS_PATH");

85 i‡(! 
∑th
)Öath = "";

89 
size_t
 
Àn
 = 
	`°rc•n
(
∑th
, ":");

90 i‡(
Àn
 =0Ë
	`kputs
(
buûtö_∑th
, &
ôr
->
∑th
);

91 
	`kput¢
(
∑th
, 
Àn
, &
ôr
->path);

92 
	`kputc
(':', &
ôr
->
∑th
);

94 
∑th
 +
Àn
;

95 i‡(*
∑th
 == ':')Öath++;

100 
ôr
->
∑thdú
 = iå->
∑th
.
s
;

101 
ôr
->
dúv
 = 
	`›í_√xtdú
(itr);

102 
	}
}

104 c⁄° *
	$hts_∑th_ôr_√xt
(
hts_∑th_ôr
 *
ôr
)

106 
ôr
->
dúv
) {

107 
dúít
 *
e
;

108 (
e
 = 
	`ªaddú
((
DIR
 *Ë
ôr
->
dúv
)Ë!
NULL
) {

109 
size_t
 
d_«me_Àn
 = 
	`°æí
(
e
->
d_«me
);

110 i‡(
	`°∫cmp
(
e
->
d_«me
, 
ôr
->
¥efix
, iå->
¥efix_Àn
) == 0 &&

111 
d_«me_Àn
 >
ôr
->
suffix_Àn
 &&

112 
	`°∫cmp
(
e
->
d_«me
 + 
d_«me_Àn
 - 
ôr
->
suffix_Àn
, iå->
suffix
,

113 
ôr
->
suffix_Àn
) == 0) {

114 
ôr
->
íåy
.
l
 = iå->
íåy_dú_l
;

115 
	`kputs
(
e
->
d_«me
, &
ôr
->
íåy
);

116  
ôr
->
íåy
.
s
;

120 
	`˛o£dú
((
DIR
 *Ë
ôr
->
dúv
);

121 
ôr
->
dúv
 = 
	`›í_√xtdú
(itr);

124 
ôr
->
∑thdú
 = 
NULL
;

125 
	`‰ì
(
ôr
->
∑th
.
s
); iå->∑th.†
NULL
;

126 
	`‰ì
(
ôr
->
íåy
.
s
); iå->íåy.†
NULL
;

127  
NULL
;

128 
	}
}

131 #i‚de‡
RTLD_NOLOAD


132 
	#RTLD_NOLOAD
 0

	)

135 *
	$lﬂd_∂ugö
(**
∂ugöp
, c⁄° *
fûíame
, c⁄° *
symbﬁ
)

137 *
lib
 = 
	`dl›í
(
fûíame
, 
RTLD_NOW
 | 
RTLD_LOCAL
);

138 i‡(
lib
 =
NULL
Ë
îr‹
;

140 *
sym
 = 
	`dlsym
(
lib
, 
symbﬁ
);

141 i‡(
sym
 =
NULL
) {

143 *
libg
 = 
	`dl›í
(
fûíame
, 
RTLD_NOLOAD
 | 
RTLD_NOW
 | 
RTLD_GLOBAL
);

144 i‡(
libg
 =
NULL
Ë
îr‹
;

145 
	`dl˛o£
(
lib
);

146 
lib
 = 
libg
;

148 
k°rög_t
 
symbﬁg
 = { 0, 0, 
NULL
 };

149 
	`kputs
(
symbﬁ
, &
symbﬁg
);

150 
	`kputc
('_', &
symbﬁg
);

151 c⁄° *
¶ash
 = 
	`°ºchr
(
fûíame
, '/');

152 c⁄° *
ba£«me
 = 
¶ash
? sœsh+1 : 
fûíame
;

153 
	`kput¢
(
ba£«me
, 
	`°rc•n
(ba£«me, ".-+"), &
symbﬁg
);

155 
sym
 = 
	`dlsym
(
lib
, 
symbﬁg
.
s
);

156 
	`‰ì
(
symbﬁg
.
s
);

157 i‡(
sym
 =
NULL
Ë
îr‹
;

160 *
∂ugöp
 = 
lib
;

161  
sym
;

163 
îr‹
:

164 i‡(
hts_vîbo£
 >= 4)

165 
	`Ârötf
(
°dîr
, "[W::%s] can'tÜoadÖlugin \"%s\": %s\n",

166 
__func__
, 
fûíame
, 
	`dÀº‹
());

167 i‡(
lib
Ë
	`dl˛o£
(lib);

168  
NULL
;

169 
	}
}

171 *
	$∂ugö_sym
(*
∂ugö
, c⁄° *
«me
, c⁄° **
îrmsg
)

173 *
sym
 = 
	`dlsym
(
∂ugö
, 
«me
);

174 i‡(
sym
 =
NULL
Ë*
îrmsg
 = 
	`dÀº‹
();

175  
sym
;

176 
	}
}

178 
	$˛o£_∂ugö
(*
∂ugö
)

180 i‡(
	`dl˛o£
(
∂ugö
) != 0) {

181 i‡(
hts_vîbo£
 >= 4)

182 
	`Ârötf
(
°dîr
, "[W::%s] dlclose() failed: %s\n",

183 
__func__
, 
	`dÀº‹
());

185 
	}
}

	@htslib/probaln.c

26 
	~<c⁄fig.h
>

28 
	~<°dlib.h
>

29 
	~<°dio.h
>

30 
	~<°rög.h
>

31 
	~<°döt.h
>

32 
	~<m©h.h
>

33 
	~"ht¶ib/hts.h
"

39 
	#EI
 .25

	)

40 
	#EM
 .33333333333

	)

42 
	gg_quÆ2¥ob
[256];

44 
	#£t_u
(
u
, 
b
, 
i
, 
k
Ë{ 
x
=(i)-(b); x=x>0?x:0; (u)=((k)-x+1)*3; }

	)

71 
	$¥obÆn_gloˇl
(c⁄° 
uöt8_t
 *
_ªf
, 
l_ªf
, c⁄° uöt8_à*
_quîy
, 
l_quîy
,

72 c⁄° 
uöt8_t
 *
iquÆ
, c⁄° 
¥obÆn_∑r_t
 *
c
, *
°©e
, uöt8_à*
q
)

74 *
f
, *
b
 = 0, *
s
, 
m
[9], 
sI
, 
sM
, 
bI
, 
bM
;

75 *
quÆ
, *
_quÆ
;

76 c⁄° 
uöt8_t
 *
ªf
, *
quîy
;

77 
bw
, 
bw2
, 
i
, 
k
, 
is_backw¨d
 = 1, 
Pr
;

79 i‡–
l_ªf
<=0 || 
l_quîy
<=0 )  0;

82 
is_backw¨d
 = 
°©e
 && 
q
? 1 : 0;

83 
ªf
 = 
_ªf
 - 1; 
quîy
 = 
_quîy
 - 1;

84 
bw
 = 
l_ªf
 > 
l_quîy
?Ü_ref :Ü_query;

85 i‡(
bw
 > 
c
->bw) bw = c->bw;

86 i‡(
bw
 < 
	`abs
(
l_ªf
 - 
l_quîy
)) bw =ábs(l_ref -Ü_query);

87 
bw2
 = 
bw
 * 2 + 1;

88 
i_dim
 = 
bw2
*3+6;

91 
f
 = 
	`ˇŒoc
((
l_quîy
+1)*
i_dim
, ());

92 i‡(
is_backw¨d
Ë
b
 = 
	`ˇŒoc
((
l_quîy
+1)*
i_dim
, ());

93 
s
 = 
	`mÆloc
((
l_quîy
+2) * ());

95 
_quÆ
 = 
	`mÆloc
(
l_quîy
 * ());

96 i‡(
g_quÆ2¥ob
[0] == 0)

97 
i
 = 0; i < 256; ++i)

98 
g_quÆ2¥ob
[
i
] = 
	`pow
(10, -i/10.);

99 
i
 = 0; i < 
l_quîy
; ++iË
_quÆ
[i] = 
g_quÆ2¥ob
[
iquÆ
? iqual[i] : 30];

100 
quÆ
 = 
_quÆ
 - 1;

102 
sM
 = 
sI
 = 1. / (2 * 
l_quîy
 + 2);

103 
m
[0*3+0] = (1 - 
c
->
d
 - c->dË* (1 - 
sM
); m[0*3+1] = m[0*3+2] = c->d * (1 - sM);

104 
m
[1*3+0] = (1 - 
c
->
e
Ë* (1 - 
sI
); m[1*3+1] = c->e * (1 - sI); m[1*3+2] = 0.;

105 
m
[2*3+0] = 1 - 
c
->
e
; m[2*3+1] = 0.; m[2*3+2] = c->e;

106 
bM
 = (1 - 
c
->
d
Ë/ 
l_ªf
; 
bI
 = c->d /Ü_ref;

109 
	`£t_u
(
k
, 
bw
, 0, 0);

110 
f
[0*
i_dim
+
k
] = 
s
[0] = 1.;

112 *
fi
 = &
f
[1*
i_dim
], 
sum
;

113 
beg
 = 1, 
íd
 = 
l_ªf
 < 
bw
 + 1?Ü_ref : bw + 1;

114 
k
 = 
beg
, 
sum
 = 0.; k <
íd
; ++k) {

115 
u
;

116 
e
 = (
ªf
[
k
] > 3 || 
quîy
[1] > 3)? 1. :Ñef[k] =quîy[1]? 1. - 
quÆ
[1] : quÆ[1] * 
EM
;

117 
	`£t_u
(
u
, 
bw
, 1, 
k
);

118 
fi
[
u
+0] = 
e
 * 
bM
; fi[u+1] = 
EI
 * 
bI
;

119 
sum
 +
fi
[
u
] + fi[u+1];

121 
s
[1] = 
sum
;

124 
i
 = 2; i <
l_quîy
; ++i) {

125 *
fi
 = &
f
[
i
*
i_dim
], *
fi1
 = &f[(i-1)*i_dim], 
sum
, 
qli
 = 
quÆ
[i];

126 
beg
 = 1, 
íd
 = 
l_ªf
, 
x
;

127 
uöt8_t
 
qyi
 = 
quîy
[
i
];

128 
x
 = 
i
 - 
bw
; 
beg
 = beg > x? beg : x;

129 
x
 = 
i
 + 
bw
; 
íd
 =Énd < x?Énd : x;

130 
E
[] = {

131 
qli
 * 
EM
,

132 1. - 
qli
,

136 
M
 = 1./
s
[
i
-1];

137 
k
 = 
beg
, 
sum
 = 0.; k <
íd
; ++k) {

138 
u
, 
v11
, 
v01
, 
v10
;

139 
e
;

140 
e
 = 
E
[(
ªf
[
k
] > 3 || 
qyi
 > 3)*2 + (ref[k] == qyi)];

141 
	`£t_u
(
u
, 
bw
, 
i
, 
k
); së_u(
v11
, bw, i-1, k-1); së_u(
v10
, bw, i-1, k); së_u(
v01
, bw, i, k-1);

142 
fi
[
u
+0] = 
e
 * (
m
[0] * 
M
*
fi1
[
v11
+0] + m[3] * M*fi1[v11+1] + m[6] * M*fi1[v11+2]);

143 
fi
[
u
+1] = 
EI
 * (
m
[1] * 
M
*
fi1
[
v10
+0] + m[4] * M*fi1[v10+1]);

144 
fi
[
u
+2] = 
m
[2] * fi[
v01
+0] + m[8] * fi[v01+2];

145 
sum
 +
fi
[
u
] + fi[u+1] + fi[u+2];

148 
s
[
i
] = 
sum
;

151 
sum
;

152 
M
 = 1./
s
[
l_quîy
];

153 
k
 = 1, 
sum
 = 0.; k <
l_ªf
; ++k) {

154 
u
;

155 
	`£t_u
(
u
, 
bw
, 
l_quîy
, 
k
);

156 i‡(
u
 < 3 || u >
bw2
*3+3) ;

157 
sum
 +
M
*
f
[
l_quîy
*
i_dim
 + 
u
+0] * 
sM
 + M*f[l_quîy*i_dim + u+1] * 
sI
;

159 
s
[
l_quîy
+1] = 
sum
;

162 
p
 = 1., 
Pr1
 = 0.;

163 
i
 = 0; i <
l_quîy
 + 1; ++i) {

164 
p
 *
s
[
i
];

165 i‡(
p
 < 1e-100Ë
Pr1
 +-4.343 * 
	`log
(p),Ö = 1.;

167 
Pr1
 +-4.343 * 
	`log
(
p
 * 
l_ªf
 * 
l_quîy
);

168 
Pr
 = ()(
Pr1
 + .499);

169 i‡(!
is_backw¨d
) {

170 
	`‰ì
(
f
); fªe(
s
); fªe(
_quÆ
);

171  
Pr
;

176 
k
 = 1; k <
l_ªf
; ++k) {

177 
u
;

178 *
bi
 = &
b
[
l_quîy
*
i_dim
];

179 
	`£t_u
(
u
, 
bw
, 
l_quîy
, 
k
);

180 i‡(
u
 < 3 || u >
bw2
*3+3) ;

181 
bi
[
u
+0] = 
sM
 / 
s
[
l_quîy
] / s[l_quîy+1]; bi[u+1] = 
sI
 / s[l_query] / s[l_query+1];

184 
i
 = 
l_quîy
 - 1; i >= 1; --i) {

185 
beg
 = 1, 
íd
 = 
l_ªf
, 
x
, 
_beg
, 
_íd
;

186 *
bi
 = &
b
[
i
*
i_dim
], *
bi1
 = &b[(i+1)*i_dim], 
y
 = (ò> 1), 
qli1
 = 
quÆ
[i+1];

187 
uöt8_t
 
qyi1
 = 
quîy
[
i
+1];

188 
x
 = 
i
 - 
bw
; 
beg
 = beg > x? beg : x;

189 
x
 = 
i
 + 
bw
; 
íd
 =Énd < x?Énd : x;

190 
E
[] = {

191 
qli1
 * 
EM
,

192 1. - 
qli1
,

197 
k
 = 
íd
; k >
beg
; --k) {

198 
u
, 
v11
, 
v01
, 
v10
;

199 
e
;

200 
	`£t_u
(
u
, 
bw
, 
i
, 
k
); së_u(
v11
, bw, i+1, k+1); së_u(
v10
, bw, i+1, k); së_u(
v01
, bw, i, k+1);

201 
e
 = (
k
>=
l_ªf
)?0 :
E
[(
ªf
[k+1] > 3 || 
qyi1
 > 3)*2 + (ªf[k+1] =qyi1)] * 
bi1
[
v11
];

202 
bi
[
u
+0] = 
e
 * 
m
[0] + 
EI
 * m[1] * 
bi1
[
v10
+1] + m[2] * bi[
v01
+2];

203 
bi
[
u
+1] = 
e
 * 
m
[3] + 
EI
 * m[4] * 
bi1
[
v10
+1];

204 
bi
[
u
+2] = (
e
 * 
m
[6] + m[8] * bi[
v01
+2]Ë* 
y
;

208 
	`£t_u
(
_beg
, 
bw
, 
i
, 
beg
); së_u(
_íd
, bw, i, 
íd
); _end += 2;

209 
k
 = 
_beg
, 
y
 = 1./
s
[
i
]; k <
_íd
; ++kË
bi
[k] *= y;

212 
beg
 = 1, 
íd
 = 
l_ªf
 < 
bw
 + 1?Ü_ref : bw + 1;

213 
sum
 = 0.;

214 
k
 = 
íd
; k >
beg
; --k) {

215 
u
;

216 
e
 = (
ªf
[
k
] > 3 || 
quîy
[1] > 3)? 1. :Ñef[k] =quîy[1]? 1. - 
quÆ
[1] : quÆ[1] * 
EM
;

217 
	`£t_u
(
u
, 
bw
, 1, 
k
);

218 i‡(
u
 < 3 || u >
bw2
*3+3) ;

219 
sum
 +
e
 * 
b
[1*
i_dim
 + 
u
+0] * 
bM
 + 
EI
 * b[1*i_dim + u+1] * 
bI
;

221 
	`£t_u
(
k
, 
bw
, 0, 0);

222 
b
[0*
i_dim
 + 
k
] = 
sum
 / 
s
[0];

225 
i
 = 1; i <
l_quîy
; ++i) {

226 
sum
 = 0., *
fi
 = &
f
[
i
*
i_dim
], *
bi
 = &
b
[i*i_dim], 
max
 = 0.;

227 
beg
 = 1, 
íd
 = 
l_ªf
, 
x
, 
max_k
 = -1;

228 
x
 = 
i
 - 
bw
; 
beg
 = beg > x? beg : x;

229 
x
 = 
i
 + 
bw
; 
íd
 =Énd < x?Énd : x;

230 
M
 = 1./
s
[
i
];

231 
k
 = 
beg
; k <
íd
; ++k) {

232 
u
;

233 
z
;

234 
	`£t_u
(
u
, 
bw
, 
i
, 
k
);

235 
z
 = 
M
*
fi
[
u
+0] * 
bi
[u+0]; i‡(z > 
max
Ëmax = z, 
max_k
 = (
k
-1)<<2 | 0; 
sum
 += z;

236 
z
 = 
M
*
fi
[
u
+1] * 
bi
[u+1]; i‡(z > 
max
Ëmax = z, 
max_k
 = (
k
-1)<<2 | 1; 
sum
 += z;

238 
max
 /
sum
; sum *
s
[
i
];

239 i‡(
°©e
Ë°©e[
i
-1] = 
max_k
;

240 i‡(
q
Ë
k
 = ()(-4.343 * 
	`log
(1. - 
max
Ë+ .499), q[
i
-1] = k > 100? 99 : k;

241 #ifde‡
_MAIN


242 
k
 = 0;

243 
	`£t_u
(
k
, 
bw
, 0, 0);

244 
	`Ârötf
(
°dîr
, "(%.10lg,%.10lgË(%d,%d:%c,%c:%dË%lg\n", 
b
[0][
k
], 
sum
, 
i
-1, 
max_k
>>2,

245 "ACGT"[
quîy
[
i
]], "ACGT"[
ªf
[(
max_k
>>2)+1]], max_k&3, 
max
);

249 
	`‰ì
(
f
); fªe(
b
); fªe(
s
); fªe(
_quÆ
);

250  
Pr
;

251 
	}
}

253 #ifde‡
_MAIN


254 
	~<uni°d.h
>

255 
	$maö
(
¨gc
, *
¨gv
[])

257 
uöt8_t
 
c⁄v
[256], *
iquÆ
, *
ªf
, *
quîy
;

258 
¥obÆn_∑r_t
 
∑r
 = { 0.001, 0.1, 10 };

259 
c
, 
l_ªf
, 
l_quîy
, 
i
, 
q
 = 30, 
b
 = 10, 
P
;

260 (
c
 = 
	`gë›t
(
¨gc
, 
¨gv
, "b:q:")) >= 0) {

261 
c
) {

262 'b': 
b
 = 
	`©oi
(
›èrg
); ;

263 'q': 
q
 = 
	`©oi
(
›èrg
); ;

266 i‡(
›töd
 + 2 > 
¨gc
) {

267 
	`Ârötf
(
°dîr
, "Ußge: %†[-q %d] [-b %d] <ªf> <quîy>\n", 
¨gv
[0], 
q
, 
b
);

270 
	`mem£t
(
c⁄v
, 4, 256);

271 
c⁄v
['a'] = conv['A'] = 0; conv['c'] = conv['C'] = 1;

272 
c⁄v
['g'] = conv['G'] = 2; conv['t'] = conv['T'] = 3;

273 
ªf
 = (
uöt8_t
*)
¨gv
[
›töd
]; 
quîy
 = (uint8_t*)argv[optind+1];

274 
l_ªf
 = 
	`°æí
((*)
ªf
); 
l_quîy
 = såÀn((*)
quîy
);

275 
i
 = 0; i < 
l_ªf
; ++iË
ªf
[i] = 
c⁄v
[ref[i]];

276 
i
 = 0; i < 
l_quîy
; ++iË
quîy
[i] = 
c⁄v
[query[i]];

277 
iquÆ
 = 
	`mÆloc
(
l_quîy
);

278 
	`mem£t
(
iquÆ
, 
q
, 
l_quîy
);

279 
∑r
.
bw
 = 
b
;

280 
P
 = 
	`¥obÆn_gloˇl
(
ªf
, 
l_ªf
, 
quîy
, 
l_quîy
, 
iquÆ
, &
∑r
, 0, 0);

281 
	`Ârötf
(
°dîr
, "%d\n", 
P
);

282 
	`‰ì
(
iquÆ
);

284 
	}
}

	@htslib/realn.c

26 
	~<c⁄fig.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<m©h.h
>

31 
	~"ht¶ib/hts.h
"

32 
	~"ht¶ib/ßm.h
"

34 
	$ßm_ˇp_m≠q
(
bam1_t
 *
b
, c⁄° *
ªf
, 
ªf_Àn
, 
thªs
)

36 
uöt8_t
 *
£q
 = 
	`bam_gë_£q
(
b
), *
quÆ
 = 
	`bam_gë_quÆ
(b);

37 
uöt32_t
 *
cig¨
 = 
	`bam_gë_cig¨
(
b
);

38 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

39 
i
, 
x
, 
y
, 
mm
, 
q
, 
Àn
, 
˛ù_l
, 
˛ù_q
;

40 
t
;

41 i‡(
thªs
 < 0)Åhres = 40;

42 
mm
 = 
q
 = 
Àn
 = 
˛ù_l
 = 
˛ù_q
 = 0;

43 
i
 = 
y
 = 0, 
x
 = 
c
->
pos
; i < c->
n_cig¨
; ++i) {

44 
j
, 
l
 = 
cig¨
[
i
]>>4, 
›
 = cigar[i]&0xf;

45 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) {

46 
j
 = 0; j < 
l
; ++j) {

47 
c1
, 
c2
, 
z
 = 
y
 + 
j
;

48 i‡(
x
+
j
 >
ªf_Àn
 || 
ªf
[x+j] == '\0') ;

49 
c1
 = 
	`bam_£qi
(
£q
, 
z
), 
c2
 = 
£q_¡16_èbÀ
[()
ªf
[
x
+
j
]];

50 i‡(
c2
 !15 && 
c1
 !15 && 
quÆ
[
z
] >= 13) {

51 ++
Àn
;

52 i‡(
c1
 && c1 !
c2
 && 
quÆ
[
z
] >= 13) {

53 ++
mm
;

54 
q
 +
quÆ
[
z
] > 33? 33 : qual[z];

58 i‡(
j
 < 
l
) ;

59 
x
 +
l
; 
y
 +l; 
Àn
 +=Ü;

60 } i‡(
›
 =
BAM_CDEL
) {

61 
j
 = 0; j < 
l
; ++j)

62 i‡(
x
+
j
 >
ªf_Àn
 || 
ªf
[x+j] == '\0') ;

63 i‡(
j
 < 
l
) ;

64 
x
 +
l
;

65 } i‡(
›
 =
BAM_CSOFT_CLIP
) {

66 
j
 = 0; j < 
l
; ++jË
˛ù_q
 +
quÆ
[
y
+j];

67 
˛ù_l
 +
l
;

68 
y
 +
l
;

69 } i‡(
›
 =
BAM_CHARD_CLIP
) {

70 
˛ù_q
 +13 * 
l
;

71 
˛ù_l
 +
l
;

72 } i‡(
›
 =
BAM_CINS
Ë
y
 +
l
;

73 i‡(
›
 =
BAM_CREF_SKIP
Ë
x
 +
l
;

75 
i
 = 0, 
t
 = 1; i < 
mm
; ++i)

76 
t
 *()
Àn
 / (
i
+1);

77 
t
 = 
q
 - 4.343 * 
	`log
—Ë+ 
˛ù_q
 / 5.;

78 i‡(
t
 > 
thªs
)  -1;

79 i‡(
t
 < 0)Å = 0;

80 
t
 = 
	`sqπ
((
thªs
 -Å) /Åhres) *Åhres;

82  ()(
t
 + .499);

83 
	}
}

85 
	$ßm_¥ob_ªÆn
(
bam1_t
 *
b
, c⁄° *
ªf
, 
ªf_Àn
, 
Êag
)

87 
k
, 
i
, 
bw
, 
x
, 
y
, 
yb
, 
ye
, 
xb
, 
xe
, 
≠∂y_baq
 = 
Êag
&1, 
exãnd_baq
 = fœg>>1&1, 
ªdo_baq
 = flag&4;

88 
uöt32_t
 *
cig¨
 = 
	`bam_gë_cig¨
(
b
);

89 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

90 
¥obÆn_∑r_t
 
c⁄f
 = { 0.001, 0.1, 10 };

91 
uöt8_t
 *
bq
 = 0, *
zq
 = 0, *
quÆ
 = 
	`bam_gë_quÆ
(
b
);

92 i‡((
c
->
Êag
 & 
BAM_FUNMAP
Ë|| 
b
->
c‹e
.
l_q£q
 =0 || 
quÆ
[0] =(
uöt8_t
)-1)

96 i‡((
bq
 = 
	`bam_aux_gë
(
b
, "BQ")) != 0) ++bq;

97 i‡((
zq
 = 
	`bam_aux_gë
(
b
, "ZQ")) != 0 && *zq == 'Z') ++zq;

98 i‡(
bq
 && 
ªdo_baq
)

100 
	`bam_aux_dñ
(
b
, 
bq
-1);

101 
bq
 = 0;

103 i‡(
bq
 && 
zq
) {

104 
	`bam_aux_dñ
(
b
, 
zq
-1);

105 
zq
 = 0;

107 i‡(
bq
 || 
zq
) {

108 i‡((
≠∂y_baq
 && 
zq
Ë|| (!≠∂y_baq && 
bq
))  -3;

109 i‡(
bq
 && 
≠∂y_baq
) {

110 
i
 = 0; i < 
c
->
l_q£q
; ++i)

111 
quÆ
[
i
] = quÆ[i] + 64 < 
bq
[i]? 0 : qual[i] - (()bq[i] - 64);

112 *(
bq
 - 3) = 'Z';

113 } i‡(
zq
 && !
≠∂y_baq
) {

114 
i
 = 0; i < 
c
->
l_q£q
; ++i)

115 
quÆ
[
i
] +()
zq
[i] - 64;

116 *(
zq
 - 3) = 'B';

121 
x
 = 
c
->
pos
, 
y
 = 0, 
yb
 = 
ye
 = 
xb
 = 
xe
 = -1;

122 
k
 = 0; k < 
c
->
n_cig¨
; ++k) {

123 
›
, 
l
;

124 
›
 = 
cig¨
[
k
]&0xf; 
l
 = cigar[k]>>4;

125 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) {

126 i‡(
yb
 < 0Ëyb = 
y
;

127 i‡(
xb
 < 0Ëxb = 
x
;

128 
ye
 = 
y
 + 
l
; 
xe
 = 
x
 +Ü;

129 
x
 +
l
; 
y
 +=Ü;

130 } i‡(
›
 =
BAM_CSOFT_CLIP
 || o∞=
BAM_CINS
Ë
y
 +
l
;

131 i‡(
›
 =
BAM_CDEL
Ë
x
 +
l
;

132 i‡(
›
 =
BAM_CREF_SKIP
)  -1;

135 
bw
 = 7;

136 i‡(
	`abs
((
xe
 - 
xb
Ë- (
ye
 - 
yb
)Ë> 
bw
)

137 
bw
 = 
	`abs
((
xe
 - 
xb
Ë- (
ye
 - 
yb
)) + 3;

138 
c⁄f
.
bw
 = bw;

139 
xb
 -
yb
 + 
bw
/2; if (xb < 0) xb = 0;

140 
xe
 +
c
->
l_q£q
 - 
ye
 + 
bw
/2;

141 i‡(
xe
 - 
xb
 - 
c
->
l_q£q
 > 
bw
)

142 
xb
 +(
xe
 - xb - 
c
->
l_q£q
 - 
bw
) / 2, xe -= (xe - xb - c->l_qseq - bw) / 2;

144 
uöt8_t
 *
s
, *
r
, *
q
, *
£q
 = 
	`bam_gë_£q
(
b
), *
bq
;

145 *
°©e
;

146 
bq
 = 
	`ˇŒoc
(
c
->
l_q£q
 + 1, 1);

147 
	`mem˝y
(
bq
, 
quÆ
, 
c
->
l_q£q
);

148 
s
 = 
	`ˇŒoc
(
c
->
l_q£q
, 1);

149 
i
 = 0; i < 
c
->
l_q£q
; ++iË
s
[i] = 
£q_¡16_öt
[
	`bam_£qi
(
£q
, i)];

150 
r
 = 
	`ˇŒoc
(
xe
 - 
xb
, 1);

151 
i
 = 
xb
; i < 
xe
; ++i) {

152 i‡(
i
 >
ªf_Àn
 || 
ªf
[i] ='\0'Ë{ 
xe
 = i; ; }

153 
r
[
i
-
xb
] = 
£q_¡16_öt
[
£q_¡16_èbÀ
[()
ªf
[i]]];

155 
°©e
 = 
	`ˇŒoc
(
c
->
l_q£q
, ());

156 
q
 = 
	`ˇŒoc
(
c
->
l_q£q
, 1);

157 
	`¥obÆn_gloˇl
(
r
, 
xe
-
xb
, 
s
, 
c
->
l_q£q
, 
quÆ
, &
c⁄f
, 
°©e
, 
q
);

158 i‡(!
exãnd_baq
) {

159 
k
 = 0, 
x
 = 
c
->
pos
, 
y
 = 0; k < c->
n_cig¨
; ++k) {

160 
›
 = 
cig¨
[
k
]&0xf, 
l
 = cigar[k]>>4;

161 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) {

162 
i
 = 
y
; i < y + 
l
; ++i) {

163 i‡((
°©e
[
i
]&3Ë!0 || sèã[i]>>2 !
x
 - 
xb
 + (ò- 
y
)Ë
bq
[i] = 0;

164 
bq
[
i
] = bq[i] < 
q
[i]? bq[i] : q[i];

166 
x
 +
l
; 
y
 +=Ü;

167 } i‡(
›
 =
BAM_CSOFT_CLIP
 || o∞=
BAM_CINS
Ë
y
 +
l
;

168 i‡(
›
 =
BAM_CDEL
Ë
x
 +
l
;

170 
i
 = 0; i < 
c
->
l_q£q
; ++iË
bq
[i] = 
quÆ
[i] - bq[i] + 64;

172 
uöt8_t
 *
À·
, *
rght
;

173 
À·
 = 
	`ˇŒoc
(
c
->
l_q£q
, 1); 
rght
 = calloc(c->l_qseq, 1);

174 
k
 = 0, 
x
 = 
c
->
pos
, 
y
 = 0; k < c->
n_cig¨
; ++k) {

175 
›
 = 
cig¨
[
k
]&0xf, 
l
 = cigar[k]>>4;

176 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) {

177 
i
 = 
y
; i < y + 
l
; ++i)

178 
bq
[
i
] = ((
°©e
[i]&3Ë!0 || sèã[i]>>2 !
x
 - 
xb
 + (ò- 
y
))? 0 : 
q
[i];

179 
À·
[
y
] = 
bq
[y], 
i
 = y + 1; i < y + 
l
; ++i)

180 
À·
[
i
] = 
bq
[i] >Üeft[i-1]? bq[i] :Üeft[i-1];

181 
rght
[
y
+
l
-1] = 
bq
[y+l-1], 
i
 = y +Ü - 2; i >= y; --i)

182 
rght
[
i
] = 
bq
[i] >Ñght[i+1]? bq[i] :Ñght[i+1];

183 
i
 = 
y
; i < y + 
l
; ++i)

184 
bq
[
i
] = 
À·
[i] < 
rght
[i]?Üeft[i] :Ñght[i];

185 
x
 +
l
; 
y
 +=Ü;

186 } i‡(
›
 =
BAM_CSOFT_CLIP
 || o∞=
BAM_CINS
Ë
y
 +
l
;

187 i‡(
›
 =
BAM_CDEL
Ë
x
 +
l
;

189 
i
 = 0; i < 
c
->
l_q£q
; ++iË
bq
[i] = 64 + (
quÆ
[i] <= bq[i]? 0 : qual[i] - bq[i]);

190 
	`‰ì
(
À·
); fªe(
rght
);

192 i‡(
≠∂y_baq
) {

193 
i
 = 0; i < 
c
->
l_q£q
; ++iË
quÆ
[i] -
bq
[i] - 64;

194 
	`bam_aux_≠≥nd
(
b
, "ZQ", 'Z', 
c
->
l_q£q
 + 1, 
bq
);

195 } 
	`bam_aux_≠≥nd
(
b
, "BQ", 'Z', 
c
->
l_q£q
 + 1, 
bq
);

196 
	`‰ì
(
bq
); fªe(
s
); fªe(
r
); fªe(
q
); fªe(
°©e
);

199 
	}
}

	@htslib/regidx.c

25 
	~<c⁄fig.h
>

26 
	~<°rögs.h
>

28 
	~"ht¶ib/hts.h
"

29 
	~"ht¶ib/k°rög.h
"

30 
	~"ht¶ib/k£q.h
"

31 
	~"ht¶ib/khash_°r2öt.h
"

32 
	~"ht¶ib/ªgidx.h
"

33 
	~"hts_öã∫Æ.h
"

35 
	#LIDX_SHIFT
 13

36 

	)

40 *
	midx
, 
	mnidx
;

41 
	mƒegs
, 
	mmªgs
;

42 
ªg_t
 *
	mªgs
;

43 *
	m∑ylﬂd
;

45 
	tªgli°_t
;

48 
	s_ªgidx_t


50 
	mn£q
, 
	mm£q
;

51 
ªgli°_t
 *
	m£q
;

52 *
	m£q2ªgs
;

53 **
	m£q_«mes
;

54 
ªgidx_‰ì_f
 
	m‰ì
;

55 
ªgidx_∑r£_f
 
	m∑r£
;

56 *
	mu§
;

59 
k°rög_t
 
	m°r
;

60 
	mrid_¥ev
, 
	m°¨t_¥ev
, 
	míd_¥ev
;

61 
	m∑ylﬂd_size
;

62 *
	m∑ylﬂd
;

65 
	$ªgidx_£q_ƒegs
(
ªgidx_t
 *
idx
, c⁄° *
£q
)

67 
i£q
;

68 i‡–
	`khash_°r2öt_gë
(
idx
->
£q2ªgs
, 
£q
, &
i£q
)!=0 )  0;

69  
idx
->
£q
[
i£q
].
ƒegs
;

70 
	}
}

72 
	$ªgidx_ƒegs
(
ªgidx_t
 *
idx
)

74 
i
, 
ƒegs
 = 0;

75 
i
=0; i<
idx
->
n£q
; i++Ë
ƒegs
 +idx->
£q
[i].nregs;

76  
ƒegs
;

77 
	}
}

79 **
	$ªgidx_£q_«mes
(
ªgidx_t
 *
idx
, *
n
)

81 *
n
 = 
idx
->
n£q
;

82  
idx
->
£q_«mes
;

83 
	}
}

85 
	$_ªgidx_buûd_ödex
(
ªgidx_t
 *
idx
)

87 
i£q
;

88 
i£q
=0; i£q<
idx
->
n£q
; iseq++)

90 
ªgli°_t
 *
li°
 = &
idx
->
£q
[
i£q
];

91 
j
,
k
, 
imax
 = 0;

92 
j
=0; j<
li°
->
ƒegs
; j++)

94 
ibeg
 = 
li°
->
ªgs
[
j
].
°¨t
 >> 
LIDX_SHIFT
;

95 
õnd
 = 
li°
->
ªgs
[
j
].
íd
 >> 
LIDX_SHIFT
;

96 i‡–
imax
 < 
õnd
 + 1 )

98 
ﬁd_imax
 = 
imax
;

99 
imax
 = 
õnd
 + 1;

100 
	`kroundup32
(
imax
);

101 
li°
->
idx
 = (*Ë
	`ªÆloc
÷i°->idx, 
imax
*());

102 
k
=
ﬁd_imax
; k<
imax
; k++Ë
li°
->
idx
[k] = -1;

104 i‡–
ibeg
==
õnd
 )

106 i‡–
li°
->
idx
[
ibeg
]<0 )Üi°->idx[ibeg] = 
j
;

110 
k
=
ibeg
; k<=
õnd
; k++)

111 i‡–
li°
->
idx
[
k
]<0 )Üi°->idx[k] = 
j
;

113 
li°
->
nidx
 = 
õnd
 + 1;

117 
	}
}

119 
	$ªgidx_ö£π
(
ªgidx_t
 *
idx
, *
löe
)

121 i‡–!
löe
 )

122  
	`_ªgidx_buûd_ödex
(
idx
);

124 *
chr_‰om
, *
chr_to
;

125 
ªg_t
 
ªg
;

126 
ªt
 = 
idx
->
	`∑r£
(
löe
,&
chr_‰om
,&
chr_to
,&
ªg
,idx->
∑ylﬂd
,idx->
u§
);

127 i‡–
ªt
==-2 )  -1;

128 i‡–
ªt
==-1 )  0;

130 
rid
;

131 
idx
->
°r
.
l
 = 0;

132 
	`kput¢
(
chr_‰om
, 
chr_to
-chr_‰om+1, &
idx
->
°r
);

133 i‡–
	`khash_°r2öt_gë
(
idx
->
£q2ªgs
, idx->
°r
.
s
, &
rid
)!=0 )

135 
idx
->
n£q
++;

136 
m_¥ev
 = 
idx
->
m£q
;

137 
	`hts_ex∑nd0
(
ªgli°_t
,
idx
->
n£q
,idx->
m£q
,idx->
£q
);

138 
	`hts_ex∑nd0
(*,
idx
->
n£q
,
m_¥ev
,idx->
£q_«mes
);

139 
idx
->
£q_«mes
[idx->
n£q
-1] = 
	`°rdup
(idx->
°r
.
s
);

140 
rid
 = 
	`khash_°r2öt_öc
(
idx
->
£q2ªgs
, idx->
£q_«mes
[idx->
n£q
-1]);

143 
ªgli°_t
 *
li°
 = &
idx
->
£q
[
rid
];

144 
li°
->
ƒegs
++;

145 
m_¥ev
 = 
li°
->
mªgs
;

146 
	`hts_ex∑nd
(
ªg_t
,
li°
->
ƒegs
,li°->
mªgs
,li°->
ªgs
);

147 
li°
->
ªgs
[li°->
ƒegs
-1] = 
ªg
;

148 i‡–
idx
->
∑ylﬂd_size
 )

150 i‡–
m_¥ev
 < 
li°
->
mªgs
 )Üi°->
∑ylﬂd
 = 
	`ªÆloc
÷i°->∑ylﬂd,
idx
->
∑ylﬂd_size
*list->mregs);

151 
	`mem˝y
((*)
li°
->
∑ylﬂd
 + 
idx
->
∑ylﬂd_size
*÷i°->
ƒegs
-1), idx->payload, idx->payload_size);

154 i‡–
idx
->
rid_¥ev
==
rid
 )

156 i‡–
idx
->
°¨t_¥ev
 > 
ªg
.
°¨t
 || (idx->°¨t_¥ev=Ùeg.°¨à&& idx->
íd_¥ev
>ªg.
íd
) )

158 
	`Ârötf
(
°dîr
,"TheÑegionsáreÇot sorted: %s:%d-%d is before %s:%d-%d\n",

159 
idx
->
°r
.
s
,idx->
°¨t_¥ev
+1,idx->
íd_¥ev
+1,idx->°r.s,
ªg
.
°¨t
+1,ªg.
íd
+1);

163 
idx
->
rid_¥ev
 = 
rid
;

164 
idx
->
°¨t_¥ev
 = 
ªg
.
°¨t
;

165 
idx
->
íd_¥ev
 = 
ªg
.
íd
;

167 
	}
}

169 
ªgidx_t
 *
	$ªgidx_öô
(c⁄° *
‚ame
, 
ªgidx_∑r£_f
 
∑r£r
, 
ªgidx_‰ì_f
 
‰ì_f
, 
size_t
 
∑ylﬂd_size
, *
u§_d©
)

171 i‡–!
∑r£r
 )

173 i‡–!
‚ame
 ) 
∑r£r
 = 
ªgidx_∑r£_èb
;

176 
Àn
 = 
	`°æí
(
‚ame
);

177 i‡–
Àn
>=7 && !
	`°rˇ£cmp
(".bed.gz",
‚ame
+len-7) )

178 
∑r£r
 = 
ªgidx_∑r£_bed
;

179 i‡–
Àn
>=8 && !
	`°rˇ£cmp
(".bed.bgz",
‚ame
+len-8) )

180 
∑r£r
 = 
ªgidx_∑r£_bed
;

181 i‡–
Àn
>=4 && !
	`°rˇ£cmp
(".bed",
‚ame
+len-4) )

182 
∑r£r
 = 
ªgidx_∑r£_bed
;

184 
∑r£r
 = 
ªgidx_∑r£_èb
;

188 
ªgidx_t
 *
idx
 = (ªgidx_t*Ë
	`ˇŒoc
(1,(regidx_t));

189 
idx
->
‰ì
 = 
‰ì_f
;

190 
idx
->
∑r£
 = 
∑r£r
;

191 
idx
->
u§
 = 
u§_d©
;

192 
idx
->
£q2ªgs
 = 
	`khash_°r2öt_öô
();

193 
idx
->
rid_¥ev
 = -1;

194 
idx
->
°¨t_¥ev
 = -1;

195 
idx
->
íd_¥ev
 = -1;

196 
idx
->
∑ylﬂd_size
 =Öayload_size;

197 i‡–
∑ylﬂd_size
 ) 
idx
->
∑ylﬂd
 = 
	`mÆloc
(payload_size);

199 i‡–!
‚ame
 )  
idx
;

201 
k°rög_t
 
°r
 = {0,0,0};

203 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
,"r");

204 i‡–!
Â
 ) 
îr‹
;

206  
	`hts_gëlöe
(
Â
, 
KS_SEP_LINE
, &
°r
) > 0 )

208 i‡–
	`ªgidx_ö£π
(
idx
, 
°r
.
s
ËË
îr‹
;

210 
	`ªgidx_ö£π
(
idx
, 
NULL
);

212 
	`‰ì
(
°r
.
s
);

213 
	`hts_˛o£
(
Â
);

214  
idx
;

216 
îr‹
:

217 
	`‰ì
(
°r
.
s
);

218 i‡–
Â
 ) 
	`hts_˛o£
(fp);

219 
	`ªgidx_de°roy
(
idx
);

220  
NULL
;

221 
	}
}

223 
	$ªgidx_de°roy
(
ªgidx_t
 *
idx
)

225 
i
, 
j
;

226 
i
=0; i<
idx
->
n£q
; i++)

228 
ªgli°_t
 *
li°
 = &
idx
->
£q
[
i
];

229 i‡–
idx
->
‰ì
 )

231 
j
=0; j<
li°
->
ƒegs
; j++)

232 
idx
->
	`‰ì
((*)
li°
->
∑ylﬂd
 + idx->
∑ylﬂd_size
*
j
);

234 
	`‰ì
(
li°
->
∑ylﬂd
);

235 
	`‰ì
(
li°
->
ªgs
);

236 
	`‰ì
(
li°
->
idx
);

238 
	`‰ì
(
idx
->
£q_«mes
);

239 
	`‰ì
(
idx
->
£q
);

240 
	`‰ì
(
idx
->
°r
.
s
);

241 
	`‰ì
(
idx
->
∑ylﬂd
);

242 
	`khash_°r2öt_de°roy_‰ì
(
idx
->
£q2ªgs
);

243 
	`‰ì
(
idx
);

244 
	}
}

246 
	$ªgidx_ovîœp
(
ªgidx_t
 *
idx
, c⁄° *
chr
, 
uöt32_t
 
‰om
, uöt32_à
to
, 
ªgôr_t
 *
ôr
)

248 i‡–
ôr
 ) iå->
i
 = iå->
n
 = 0;

250 
i£q
;

251 i‡–
	`khash_°r2öt_gë
(
idx
->
£q2ªgs
, 
chr
, &
i£q
)!=0 )  0;

253 
ªgli°_t
 *
li°
 = &
idx
->
£q
[
i£q
];

254 i‡–!
li°
->
ƒegs
 )  0;

256 
i
, 
ibeg
 = 
‰om
>>
LIDX_SHIFT
;

257 
úeg
 = 
ibeg
 < 
li°
->
nidx
 ?Üi°->
idx
[ibeg] :Üist->idx[Üist->nidx - 1 ];

258 i‡–
úeg
 < 0 )

261 i‡–
ibeg
 > 
li°
->
nidx
 ) ibeg =Üist->nidx;

262 
i
=
ibeg
 - 1; i>=0; i--)

263 i‡–
li°
->
idx
[
i
] >=0 ) ;

264 
úeg
 = 
i
>=0 ? 
li°
->
idx
[i] : 0;

266 
i
=
úeg
; i<
li°
->
ƒegs
; i++)

268 i‡–
li°
->
ªgs
[
i
].
°¨t
 > 
to
 )  0;

269 i‡–
li°
->
ªgs
[
i
].
íd
 >
‰om
 &&Üi°->ªgs[i].
°¨t
 <
to
 ) ;

272 i‡–
i
>=
li°
->
ƒegs
 )  0;

274 i‡–!
ôr
 )  1;

276 
ôr
->
i
 = 0;

277 
ôr
->
n
 = 
li°
->
ƒegs
 - 
i
;

278 
ôr
->
ªg
 = &
idx
->
£q
[
i£q
].
ªgs
[
i
];

279 i‡–
idx
->
∑ylﬂd_size
 )

280 
ôr
->
∑ylﬂd
 = (*)
idx
->
£q
[
i£q
].∑ylﬂd + 
i
*idx->
∑ylﬂd_size
;

282 
ôr
->
∑ylﬂd
 = 
NULL
;

285 
	}
}

287 
	$ªgidx_∑r£_bed
(c⁄° *
löe
, **
chr_beg
, **
chr_íd
, 
ªg_t
 *
ªg
, *
∑ylﬂd
, *
u§
)

289 *
ss
 = (*Ë
löe
;

290  *
ss
 && 
	`is•a˚_c
(*ss) ) ss++;

291 i‡–!*
ss
 )  -1;

292 i‡–*
ss
=='#' )  -1;

294 *
£
 = 
ss
;

295  *
£
 && !
	`is•a˚_c
(*se) ) se++;

296 i‡–!*
£
 ) { 
	`Ârötf
(
°dîr
,"CouldÇŸÖ¨£ bedÜöe: %s\n", 
löe
);  -2; }

298 *
chr_beg
 = 
ss
;

299 *
chr_íd
 = 
£
-1;

301 
ss
 = 
£
+1;

302 
ªg
->
°¨t
 = 
	`hts_∑r£_decimÆ
(
ss
, &
£
, 0);

303 i‡–
ss
==
£
 ) { 
	`Ârötf
(
°dîr
,"CouldÇŸÖ¨£ bedÜöe: %s\n", 
löe
);  -2; }

305 
ss
 = 
£
+1;

306 
ªg
->
íd
 = 
	`hts_∑r£_decimÆ
(
ss
, &
£
, 0) - 1;

307 i‡–
ss
==
£
 ) { 
	`Ârötf
(
°dîr
,"CouldÇŸÖ¨£ bedÜöe: %s\n", 
löe
);  -2; }

310 
	}
}

312 
	$ªgidx_∑r£_èb
(c⁄° *
löe
, **
chr_beg
, **
chr_íd
, 
ªg_t
 *
ªg
, *
∑ylﬂd
, *
u§
)

314 *
ss
 = (*Ë
löe
;

315  *
ss
 && 
	`is•a˚_c
(*ss) ) ss++;

316 i‡–!*
ss
 )  -1;

317 i‡–*
ss
=='#' )  -1;

319 *
£
 = 
ss
;

320  *
£
 && !
	`is•a˚_c
(*se) ) se++;

321 i‡–!*
£
 ) { 
	`Ârötf
(
°dîr
,"CouldÇŸÖ¨£ bedÜöe: %s\n", 
löe
);  -2; }

323 *
chr_beg
 = 
ss
;

324 *
chr_íd
 = 
£
-1;

326 
ss
 = 
£
+1;

327 
ªg
->
°¨t
 = 
	`hts_∑r£_decimÆ
(
ss
, &
£
, 0) - 1;

328 i‡–
ss
==
£
 ) { 
	`Ârötf
(
°dîr
,"CouldÇŸÖ¨£ bedÜöe: %s\n", 
löe
);  -2; }

330 i‡–!
£
[0] || !se[1] )

331 
ªg
->
íd
 =Ñeg->
°¨t
;

334 
ss
 = 
£
+1;

335 
ªg
->
íd
 = 
	`hts_∑r£_decimÆ
(
ss
, &
£
, 0);

336 i‡–
ss
==
£
 ) 
ªg
->
íd
 =Ñeg->
°¨t
;

337 
ªg
->
íd
--;

341 
	}
}

	@htslib/sam.c

26 
	~<c⁄fig.h
>

28 
	~<°rögs.h
>

29 
	~<°dio.h
>

30 
	~<°dlib.h
>

31 
	~<°rög.h
>

32 
	~<î∫o.h
>

33 
	~<zlib.h
>

34 
	~<as£π.h
>

35 
	~"ht¶ib/ßm.h
"

36 
	~"ht¶ib/bgzf.h
"

37 
	~"¸am/¸am.h
"

38 
	~"hts_öã∫Æ.h
"

39 
	~"ht¶ib/hfûe.h
"

40 
	~"ht¶ib/hts_ídün.h
"

42 
	~"ht¶ib/khash.h
"

43 
	$KHASH_DECLARE
(
s2i
, 
kh_c°r_t
, 
öt64_t
)

45 
	$khash_t
(
	ts2i
Ë
	tsdi˘_t
;

47 #i‚de‡
EOVERFLOW


48 
	#EOVERFLOW
 
ERANGE


	)

55 
bam_hdr_t
 *
	$bam_hdr_öô
()

57  (
bam_hdr_t
*)
	`ˇŒoc
(1, (bam_hdr_t));

58 
	}
}

60 
	$bam_hdr_de°roy
(
bam_hdr_t
 *
h
)

62 
öt32_t
 
i
;

63 i‡(
h
 =
NULL
) ;

64 i‡(
h
->
èrgë_«me
) {

65 
i
 = 0; i < 
h
->
n_èrgës
; ++i)

66 
	`‰ì
(
h
->
èrgë_«me
[
i
]);

67 
	`‰ì
(
h
->
èrgë_«me
);

68 
	`‰ì
(
h
->
èrgë_Àn
);

70 
	`‰ì
(
h
->
ãxt
); fªe(h->
cig¨_èb
);

71 i‡(
h
->
sdi˘
Ë
	`kh_de°roy
(
s2i
, (
sdi˘_t
*)h->sdict);

72 
	`‰ì
(
h
);

73 
	}
}

75 
bam_hdr_t
 *
	$bam_hdr_dup
(c⁄° 
bam_hdr_t
 *
h0
)

77 i‡(
h0
 =
NULL
)  NULL;

78 
bam_hdr_t
 *
h
;

79 i‡((
h
 = 
	`bam_hdr_öô
()Ë=
NULL
)  NULL;

81 
h
->
n_èrgës
 = 
h0
->n_targets;

82 
h
->
ign‹e_ßm_îr
 = 
h0
->ignore_sam_err;

83 
h
->
l_ãxt
 = 
h0
->l_text;

85 
h
->
cig¨_èb
 = 
NULL
;

86 
h
->
sdi˘
 = 
NULL
;

88 
h
->
ãxt
 = (*)
	`ˇŒoc
(h->
l_ãxt
 + 1, 1);

89 
	`mem˝y
(
h
->
ãxt
, 
h0
->ãxt, h->
l_ãxt
);

90 
h
->
èrgë_Àn
 = (
uöt32_t
*)
	`ˇŒoc
(h->
n_èrgës
, (uint32_t));

91 
h
->
èrgë_«me
 = (**)
	`ˇŒoc
(h->
n_èrgës
, (*));

92 
i
;

93 
i
 = 0; i < 
h
->
n_èrgës
; ++i) {

94 
h
->
èrgë_Àn
[
i
] = 
h0
->target_len[i];

95 
h
->
èrgë_«me
[
i
] = 
	`°rdup
(
h0
->target_name[i]);

97  
h
;

98 
	}
}

101 
bam_hdr_t
 *
	$hdr_‰om_di˘
(
sdi˘_t
 *
d
)

103 
bam_hdr_t
 *
h
;

104 
khöt_t
 
k
;

105 
h
 = 
	`bam_hdr_öô
();

106 
h
->
sdi˘
 = 
d
;

107 
h
->
n_èrgës
 = 
	`kh_size
(
d
);

109 
h
->
èrgë_Àn
 = (
uöt32_t
*)
	`mÆloc
((uöt32_tË* h->
n_èrgës
);

110 
h
->
èrgë_«me
 = (**)
	`mÆloc
((*Ë* h->
n_èrgës
);

111 
k
 = 
	`kh_begö
(
d
); k !
	`kh_íd
(d); ++k) {

112 i‡(!
	`kh_exi°
(
d
, 
k
)) ;

113 
h
->
èrgë_«me
[
	`kh_vÆ
(
d
, 
k
)>>32] = (*)
	`kh_key
(d, k);

114 
h
->
èrgë_Àn
[
	`kh_vÆ
(
d
, 
k
)>>32] = kh_val(d, k) & 0xffffffffUL;

115 
	`kh_vÆ
(
d
, 
k
) >>= 32;

117  
h
;

118 
	}
}

120 
bam_hdr_t
 *
	$bam_hdr_ªad
(
BGZF
 *
Â
)

122 
bam_hdr_t
 *
h
;

123 
buf
[4];

124 
magic_Àn
, 
has_EOF
;

125 
öt32_t
 
i
, 
«me_Àn
, 
num_«mes
 = 0;

126 
size_t
 
bufsize
;

127 
ssize_t
 
byãs
;

129 
has_EOF
 = 
	`bgzf_check_EOF
(
Â
);

130 i‡(
has_EOF
 < 0) {

131 
	`≥º‹
("[W::bam_hdr_read] bgzf_check_EOF");

132 } i‡(
has_EOF
 =0 && 
hts_vîbo£
 >= 2)

133 
	`Ârötf
(
°dîr
, "[W::%s] EOF m¨kî i†ab£¡. Thêöpuài†¥obablyÅrunˇãd.\n", 
__func__
);

135 
magic_Àn
 = 
	`bgzf_ªad
(
Â
, 
buf
, 4);

136 i‡(
magic_Àn
 !4 || 
	`°∫cmp
(
buf
, "BAM\1", 4)) {

137 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] invÆid BAM bö¨y hódî\n", 
__func__
);

140 
h
 = 
	`bam_hdr_öô
();

141 i‡(!
h
Ë
nomem
;

144 
byãs
 = 
	`bgzf_ªad
(
Â
, &
h
->
l_ãxt
, 4);

145 i‡(
byãs
 !4Ë
ªad_îr
;

146 i‡(
Â
->
is_be
Ë
	`ed_sw≠_4p
(&
h
->
l_ãxt
);

148 
bufsize
 = ((
size_t
Ë
h
->
l_ãxt
) + 1;

149 i‡(
bufsize
 < 
h
->
l_ãxt
Ë
nomem
;

150 
h
->
ãxt
 = (*)
	`mÆloc
(
bufsize
);

151 i‡(!
h
->
ãxt
Ë
nomem
;

152 
h
->
ãxt
[h->
l_ãxt
] = 0;

153 
byãs
 = 
	`bgzf_ªad
(
Â
, 
h
->
ãxt
, h->
l_ãxt
);

154 i‡(
byãs
 !
h
->
l_ãxt
Ë
ªad_îr
;

156 
byãs
 = 
	`bgzf_ªad
(
Â
, &
h
->
n_èrgës
, 4);

157 i‡(
byãs
 !4Ë
ªad_îr
;

158 i‡(
Â
->
is_be
Ë
	`ed_sw≠_4p
(&
h
->
n_èrgës
);

160 i‡(
h
->
n_èrgës
 < 0Ë
övÆid
;

163 i‡(
h
->
n_èrgës
 > 0) {

164 
h
->
èrgë_«me
 = (**)
	`ˇŒoc
(h->
n_èrgës
, (*));

165 i‡(!
h
->
èrgë_«me
Ë
nomem
;

166 
h
->
èrgë_Àn
 = (
uöt32_t
*)
	`ˇŒoc
(h->
n_èrgës
, (uint32_t));

167 i‡(!
h
->
èrgë_Àn
Ë
nomem
;

170 
h
->
èrgë_«me
 = 
NULL
;

171 
h
->
èrgë_Àn
 = 
NULL
;

174 
i
 = 0; i !
h
->
n_èrgës
; ++i) {

175 
byãs
 = 
	`bgzf_ªad
(
Â
, &
«me_Àn
, 4);

176 i‡(
byãs
 !4Ë
ªad_îr
;

177 i‡(
Â
->
is_be
Ë
	`ed_sw≠_4p
(&
«me_Àn
);

178 i‡(
«me_Àn
 <0Ë
övÆid
;

180 
h
->
èrgë_«me
[
i
] = (*)
	`mÆloc
(
«me_Àn
);

181 i‡(!
h
->
èrgë_«me
[
i
]Ë
nomem
;

182 
num_«mes
++;

184 
byãs
 = 
	`bgzf_ªad
(
Â
, 
h
->
èrgë_«me
[
i
], 
«me_Àn
);

185 i‡(
byãs
 !
«me_Àn
Ë
ªad_îr
;

187 i‡(
h
->
èrgë_«me
[
i
][
«me_Àn
 - 1] != '\0') {

190 *
√w_«me
;

191 i‡(
«me_Àn
 =
INT32_MAX
Ë
övÆid
;

192 
√w_«me
 = 
	`ªÆloc
(
h
->
èrgë_«me
[
i
], 
«me_Àn
 + 1);

193 i‡(
√w_«me
 =
NULL
Ë
nomem
;

194 
h
->
èrgë_«me
[
i
] = 
√w_«me
;

195 
h
->
èrgë_«me
[
i
][
«me_Àn
] = '\0';

198 
byãs
 = 
	`bgzf_ªad
(
Â
, &
h
->
èrgë_Àn
[
i
], 4);

199 i‡(
byãs
 !4Ë
ªad_îr
;

200 i‡(
Â
->
is_be
Ë
	`ed_sw≠_4p
(&
h
->
èrgë_Àn
[
i
]);

202  
h
;

204 
nomem
:

205 i‡(
hts_vîbo£
 >1Ë
	`Ârötf
(
°dîr
, "[E::%s] ouào‡mem‹y\n", 
__func__
);

206 
˛ón
;

208 
ªad_îr
:

209 i‡(
hts_vîbo£
 >= 1) {

210 i‡(
byãs
 < 0) {

211 
	`Ârötf
(
°dîr
, "[E::%s]Éº‹Ñódög BGZF såóm\n", 
__func__
);

213 
	`Ârötf
(
°dîr
, "[E::%s]Årunˇãd bam hódî\n", 
__func__
);

216 
˛ón
;

218 
övÆid
:

219 i‡(
hts_vîbo£
 >= 1) {

220 
	`Ârötf
(
°dîr
, "[E::%s] invÆid BAM bö¨y hódî\n", 
__func__
);

223 
˛ón
:

224 i‡(
h
 !
NULL
) {

225 
h
->
n_èrgës
 = 
num_«mes
;

226 
	`bam_hdr_de°roy
(
h
);

228  
NULL
;

229 
	}
}

231 
	$bam_hdr_wrôe
(
BGZF
 *
Â
, c⁄° 
bam_hdr_t
 *
h
)

233 
buf
[4];

234 
öt32_t
 
i
, 
«me_Àn
, 
x
;

236 
	`°∫˝y
(
buf
, "BAM\1", 4);

237 i‡(
	`bgzf_wrôe
(
Â
, 
buf
, 4) < 0)  -1;

239 i‡(
Â
->
is_be
) {

240 
x
 = 
	`ed_sw≠_4
(
h
->
l_ãxt
);

241 i‡(
	`bgzf_wrôe
(
Â
, &
x
, 4) < 0)  -1;

242 i‡(
h
->
l_ãxt
) {

243 i‡(
	`bgzf_wrôe
(
Â
, 
h
->
ãxt
, h->
l_ãxt
) < 0)  -1;

245 
x
 = 
	`ed_sw≠_4
(
h
->
n_èrgës
);

246 i‡(
	`bgzf_wrôe
(
Â
, &
x
, 4) < 0)  -1;

248 i‡(
	`bgzf_wrôe
(
Â
, &
h
->
l_ãxt
, 4) < 0)  -1;

249 i‡(
h
->
l_ãxt
) {

250 i‡(
	`bgzf_wrôe
(
Â
, 
h
->
ãxt
, h->
l_ãxt
) < 0)  -1;

252 i‡(
	`bgzf_wrôe
(
Â
, &
h
->
n_èrgës
, 4) < 0)  -1;

255 
i
 = 0; i !
h
->
n_èrgës
; ++i) {

256 *
p
 = 
h
->
èrgë_«me
[
i
];

257 
«me_Àn
 = 
	`°æí
(
p
) + 1;

258 i‡(
Â
->
is_be
) {

259 
x
 = 
	`ed_sw≠_4
(
«me_Àn
);

260 i‡(
	`bgzf_wrôe
(
Â
, &
x
, 4) < 0)  -1;

262 i‡(
	`bgzf_wrôe
(
Â
, &
«me_Àn
, 4) < 0)  -1;

264 i‡(
	`bgzf_wrôe
(
Â
, 
p
, 
«me_Àn
) < 0)  -1;

265 i‡(
Â
->
is_be
) {

266 
x
 = 
	`ed_sw≠_4
(
h
->
èrgë_Àn
[
i
]);

267 i‡(
	`bgzf_wrôe
(
Â
, &
x
, 4) < 0)  -1;

269 i‡(
	`bgzf_wrôe
(
Â
, &
h
->
èrgë_Àn
[
i
], 4) < 0)  -1;

272 i‡(
	`bgzf_Êush
(
Â
) < 0)  -1;

274 
	}
}

276 
	$bam_«me2id
(
bam_hdr_t
 *
h
, c⁄° *
ªf
)

278 
sdi˘_t
 *
d
 = (sdi˘_t*)
h
->
sdi˘
;

279 
khöt_t
 
k
;

280 i‡(
h
->
sdi˘
 == 0) {

281 
i
, 
ab£¡
;

282 
d
 = 
	`kh_öô
(
s2i
);

283 
i
 = 0; i < 
h
->
n_èrgës
; ++i) {

284 
k
 = 
	`kh_put
(
s2i
, 
d
, 
h
->
èrgë_«me
[
i
], &
ab£¡
);

285 
	`kh_vÆ
(
d
, 
k
Ë
i
;

287 
h
->
sdi˘
 = 
d
;

289 
k
 = 
	`kh_gë
(
s2i
, 
d
, 
ªf
);

290  
k
 =
	`kh_íd
(
d
)? -1 : 
	`kh_vÆ
(d, k);

291 
	}
}

297 
bam1_t
 *
	$bam_öô1
()

299  (
bam1_t
*)
	`ˇŒoc
(1, (bam1_t));

300 
	}
}

302 
	$bam_de°roy1
(
bam1_t
 *
b
)

304 i‡(
b
 == 0) ;

305 
	`‰ì
(
b
->
d©a
); free(b);

306 
	}
}

308 
bam1_t
 *
	$bam_c›y1
(
bam1_t
 *
bd°
, c⁄° bam1_à*
b§c
)

310 
uöt8_t
 *
d©a
 = 
bd°
->data;

311 
m_d©a
 = 
bd°
->m_data;

312 i‡(
m_d©a
 < 
b§c
->
l_d©a
) {

313 
m_d©a
 = 
b§c
->
l_d©a
; 
	`kroundup32
(m_data);

314 
d©a
 = (
uöt8_t
*)
	`ªÆloc
(d©a, 
m_d©a
);

316 
	`mem˝y
(
d©a
, 
b§c
->d©a, b§c->
l_d©a
);

317 *
bd°
 = *
b§c
;

319 
bd°
->
m_d©a
 = m_data;

320 
bd°
->
d©a
 = data;

321  
bd°
;

322 
	}
}

324 
bam1_t
 *
	$bam_dup1
(c⁄° 
bam1_t
 *
b§c
)

326 i‡(
b§c
 =
NULL
)  NULL;

327 
bam1_t
 *
bd°
 = 
	`bam_öô1
();

328 i‡(
bd°
 =
NULL
)  NULL;

329  
	`bam_c›y1
(
bd°
, 
b§c
);

330 
	}
}

332 
	$bam_cig¨2qÀn
(
n_cig¨
, c⁄° 
uöt32_t
 *
cig¨
)

334 
k
, 
l
;

335 
k
 = 
l
 = 0; k < 
n_cig¨
; ++k)

336 i‡(
	`bam_cig¨_ty≥
(
	`bam_cig¨_›
(
cig¨
[
k
]))&1)

337 
l
 +
	`bam_cig¨_›Àn
(
cig¨
[
k
]);

338  
l
;

339 
	}
}

341 
	$bam_cig¨2æí
(
n_cig¨
, c⁄° 
uöt32_t
 *
cig¨
)

343 
k
, 
l
;

344 
k
 = 
l
 = 0; k < 
n_cig¨
; ++k)

345 i‡(
	`bam_cig¨_ty≥
(
	`bam_cig¨_›
(
cig¨
[
k
]))&2)

346 
l
 +
	`bam_cig¨_›Àn
(
cig¨
[
k
]);

347  
l
;

348 
	}
}

350 
öt32_t
 
	$bam_ídpos
(c⁄° 
bam1_t
 *
b
)

352 i‡(!(
b
->
c‹e
.
Êag
 & 
BAM_FUNMAP
Ë&& b->c‹e.
n_cig¨
 > 0)

353  
b
->
c‹e
.
pos
 + 
	`bam_cig¨2æí
(b->c‹e.
n_cig¨
, 
	`bam_gë_cig¨
(b));

355  
b
->
c‹e
.
pos
 + 1;

356 
	}
}

358 
ölöe
 
	$aux_ty≥2size
(
uöt8_t
 
ty≥
)

360 
ty≥
) {

370  
ty≥
;

374 
	}
}

376 
	$sw≠_d©a
(c⁄° 
bam1_c‹e_t
 *
c
, 
l_d©a
, 
uöt8_t
 *
d©a
, 
is_ho°
)

378 
uöt32_t
 *
cig¨
 = (uöt32_t*)(
d©a
 + 
c
->
l_q«me
);

379 
uöt32_t
 
i
;

380 
i
 = 0; i < 
c
->
n_cig¨
; ++iË
	`ed_sw≠_4p
(&
cig¨
[i]);

381 
	}
}

383 
	$bam_ªad1
(
BGZF
 *
Â
, 
bam1_t
 *
b
)

385 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

386 
öt32_t
 
block_Àn
, 
ªt
, 
i
;

387 
uöt32_t
 
x
[8];

388 i‡((
ªt
 = 
	`bgzf_ªad
(
Â
, &
block_Àn
, 4)) != 4) {

389 i‡(
ªt
 == 0)  -1;

392 i‡(
	`bgzf_ªad
(
Â
, 
x
, 32) != 32)  -3;

393 i‡(
Â
->
is_be
) {

394 
	`ed_sw≠_4p
(&
block_Àn
);

395 
i
 = 0; i < 8; ++iË
	`ed_sw≠_4p
(
x
 + i);

397 
c
->
tid
 = 
x
[0]; c->
pos
 = x[1];

398 
c
->
bö
 = 
x
[2]>>16; c->
quÆ
 = x[2]>>8&0xff; c->
l_q«me
 = x[2]&0xff;

399 
c
->
l_exå™ul
 = (c->
l_q«me
%4 != 0)? (4 - c->l_qname%4) : 0;

400 i‡((
uöt32_t
Ë
c
->
l_q«me
 + c->
l_exå™ul
 > 255)

402 
c
->
Êag
 = 
x
[3]>>16; c->
n_cig¨
 = x[3]&0xffff;

403 
c
->
l_q£q
 = 
x
[4];

404 
c
->
mtid
 = 
x
[5]; c->
mpos
 = x[6]; c->
isize
 = x[7];

405 
b
->
l_d©a
 = 
block_Àn
 - 32 + 
c
->
l_exå™ul
;

406 i‡(
b
->
l_d©a
 < 0 || 
c
->
l_q£q
 < 0 || c->
l_q«me
 < 1)  -4;

407 i‡((*)
	`bam_gë_aux
(
b
Ë- (*)b->
d©a
 > b->
l_d©a
)

409 i‡(
b
->
m_d©a
 < b->
l_d©a
) {

410 
b
->
m_d©a
 = b->
l_d©a
;

411 
	`kroundup32
(
b
->
m_d©a
);

412 
b
->
d©a
 = (
uöt8_t
*)
	`ªÆloc
(b->d©a, b->
m_d©a
);

413 i‡(!
b
->
d©a
)

416 i‡(
	`bgzf_ªad
(
Â
, 
b
->
d©a
, 
c
->
l_q«me
) != c->l_qname)  -4;

417 
i
 = 0; i < 
c
->
l_exå™ul
; ++iË
b
->
d©a
[c->
l_q«me
+i] = '\0';

418 
c
->
l_q«me
 +c->
l_exå™ul
;

419 i‡(
b
->
l_d©a
 < 
c
->
l_q«me
 ||

420 
	`bgzf_ªad
(
Â
, 
b
->
d©a
 + 
c
->
l_q«me
, b->
l_d©a
 - c->l_qname) != b->l_data - c->l_qname)

422 i‡(
Â
->
is_be
Ë
	`sw≠_d©a
(
c
, 
b
->
l_d©a
, b->
d©a
, 0);

423  4 + 
block_Àn
;

424 
	}
}

426 
	$bam_wrôe1
(
BGZF
 *
Â
, c⁄° 
bam1_t
 *
b
)

428 c⁄° 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

429 
uöt32_t
 
x
[8], 
block_Àn
 = 
b
->
l_d©a
 - 
c
->
l_exå™ul
 + 32, 
y
;

430 
i
, 
ok
;

431 i‡(
c
->
n_cig¨
 >= 65536) {

432 i‡(
hts_vîbo£
 >= 1)

433 
	`Ârötf
(
°dîr
, "[E::%s]Åoÿm™y CIGAR o≥øti⁄†(%d >64K f‹ QNAME \"%s\")\n", 
__func__
, 
c
->
n_cig¨
, 
	`bam_gë_q«me
(
b
));

434 
î∫o
 = 
EOVERFLOW
;

437 
x
[0] = 
c
->
tid
;

438 
x
[1] = 
c
->
pos
;

439 
x
[2] = (
uöt32_t
)
c
->
bö
<<16 | c->
quÆ
<<8 | (c->
l_q«me
 - c->
l_exå™ul
);

440 
x
[3] = (
uöt32_t
)
c
->
Êag
<<16 | c->
n_cig¨
;

441 
x
[4] = 
c
->
l_q£q
;

442 
x
[5] = 
c
->
mtid
;

443 
x
[6] = 
c
->
mpos
;

444 
x
[7] = 
c
->
isize
;

445 
ok
 = (
	`bgzf_Êush_åy
(
Â
, 4 + 
block_Àn
) >= 0);

446 i‡(
Â
->
is_be
) {

447 
i
 = 0; i < 8; ++iË
	`ed_sw≠_4p
(
x
 + i);

448 
y
 = 
block_Àn
;

449 i‡(
ok
Ëok = (
	`bgzf_wrôe
(
Â
, 
	`ed_sw≠_4p
(&
y
), 4) >= 0);

450 
	`sw≠_d©a
(
c
, 
b
->
l_d©a
, b->
d©a
, 1);

452 i‡(
ok
Ëok = (
	`bgzf_wrôe
(
Â
, &
block_Àn
, 4) >= 0);

454 i‡(
ok
Ëok = (
	`bgzf_wrôe
(
Â
, 
x
, 32) >= 0);

455 i‡(
ok
Ëok = (
	`bgzf_wrôe
(
Â
, 
b
->
d©a
, 
c
->
l_q«me
 - c->
l_exå™ul
) >= 0);

456 i‡(
ok
Ëok = (
	`bgzf_wrôe
(
Â
, 
b
->
d©a
 + 
c
->
l_q«me
, b->
l_d©a
 - c->l_qname) >= 0);

457 i‡(
Â
->
is_be
Ë
	`sw≠_d©a
(
c
, 
b
->
l_d©a
, b->
d©a
, 0);

458  
ok
? 4 + 
block_Àn
 : -1;

459 
	}
}

465 
hts_idx_t
 *
	$bam_ödex
(
BGZF
 *
Â
, 
mö_shi·
)

467 
n_lvls
, 
i
, 
fmt
, 
ªt
;

468 
bam1_t
 *
b
;

469 
hts_idx_t
 *
idx
;

470 
bam_hdr_t
 *
h
;

471 
h
 = 
	`bam_hdr_ªad
(
Â
);

472 i‡(
h
 =
NULL
)  NULL;

473 i‡(
mö_shi·
 > 0) {

474 
öt64_t
 
max_Àn
 = 0, 
s
;

475 
i
 = 0; i < 
h
->
n_èrgës
; ++i)

476 i‡(
max_Àn
 < 
h
->
èrgë_Àn
[
i
]) max_len = h->target_len[i];

477 
max_Àn
 += 256;

478 
n_lvls
 = 0, 
s
 = 1<<
mö_shi·
; 
max_Àn
 > s; ++n_lvls, s <<= 3);

479 
fmt
 = 
HTS_FMT_CSI
;

480 } 
mö_shi·
 = 14, 
n_lvls
 = 5, 
fmt
 = 
HTS_FMT_BAI
;

481 
idx
 = 
	`hts_idx_öô
(
h
->
n_èrgës
, 
fmt
, 
	`bgzf_ãŒ
(
Â
), 
mö_shi·
, 
n_lvls
);

482 
	`bam_hdr_de°roy
(
h
);

483 
b
 = 
	`bam_öô1
();

484 (
ªt
 = 
	`bam_ªad1
(
Â
, 
b
)) >= 0) {

485 
ªt
 = 
	`hts_idx_push
(
idx
, 
b
->
c‹e
.
tid
, b->c‹e.
pos
, 
	`bam_ídpos
(b), 
	`bgzf_ãŒ
(
Â
), !(b->c‹e.
Êag
&
BAM_FUNMAP
));

486 i‡(
ªt
 < 0Ë
îr
;

488 i‡(
ªt
 < -1Ë
îr
;

490 
	`hts_idx_föish
(
idx
, 
	`bgzf_ãŒ
(
Â
));

491 
	`bam_de°roy1
(
b
);

492  
idx
;

494 
îr
:

495 
	`bam_de°roy1
(
b
);

496 
	`hts_idx_de°roy
(
idx
);

497  
NULL
;

498 
	}
}

500 
	$ßm_ödex_buûd3
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, 
¡hªads
)

502 
hts_idx_t
 *
idx
;

503 
htsFûe
 *
Â
;

504 
ªt
 = 0;

506 i‡((
Â
 = 
	`hts_›í
(
‚
, "r")) == 0)  -2;

507 i‡(
¡hªads
)

508 
	`hts_£t_thªads
(
Â
, 
¡hªads
);

510 
Â
->
f‹m©
.format) {

511 
¸am
:

512 
ªt
 = 
	`¸am_ödex_buûd
(
Â
->Â.
¸am
, 
‚
, 
‚idx
);

515 
bam
:

516 
idx
 = 
	`bam_ödex
(
Â
->Â.
bgzf
, 
mö_shi·
);

517 i‡(
idx
) {

518 
ªt
 = 
	`hts_idx_ßve_as
(
idx
, 
‚
, 
‚idx
, (
mö_shi·
 > 0)? 
HTS_FMT_CSI
 : 
HTS_FMT_BAI
);

519 i‡(
ªt
 < 0)Ñet = -4;

520 
	`hts_idx_de°roy
(
idx
);

522 
ªt
 = -1;

526 
ªt
 = -3;

529 
	`hts_˛o£
(
Â
);

531  
ªt
;

532 
	}
}

534 
	$ßm_ödex_buûd2
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
)

536  
	`ßm_ödex_buûd3
(
‚
, 
‚idx
, 
mö_shi·
, 0);

537 
	}
}

539 
	$ßm_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
)

541  
	`ßm_ödex_buûd3
(
‚
, 
NULL
, 
mö_shi·
, 0);

542 
	}
}

545 #unde‡
bam_ödex_buûd


546 
	$bam_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
)

548  
	`ßm_ödex_buûd2
(
‚
, 
NULL
, 
mö_shi·
);

549 
	}
}

551 
	$bam_ªadªc
(
BGZF
 *
Â
, *
ign‹ed
, *
bv
, *
tid
, *
beg
, *
íd
)

553 
bam1_t
 *
b
 = 
bv
;

554 
ªt
;

555 i‡((
ªt
 = 
	`bam_ªad1
(
Â
, 
b
)) >= 0) {

556 *
tid
 = 
b
->
c‹e
.tid;

557 *
beg
 = 
b
->
c‹e
.
pos
;

558 *
íd
 = 
	`bam_ídpos
(
b
);

560  
ªt
;

561 
	}
}

564 
	$¸am_ªadªc
(
BGZF
 *
ign‹ed
, *
Âv
, *
bv
, *
tid
, *
beg
, *
íd
)

566 
htsFûe
 *
Â
 = 
Âv
;

567 
bam1_t
 *
b
 = 
bv
;

568  
	`¸am_gë_bam_£q
(
Â
->Â.
¸am
, &
b
);

569 
	}
}

572 
	$ßm_bam_¸am_ªadªc
(
BGZF
 *
bgzÂ
, *
Âv
, *
bv
, *
tid
, *
beg
, *
íd
)

574 
htsFûe
 *
Â
 = 
Âv
;

575 
bam1_t
 *
b
 = 
bv
;

576 
Â
->
f‹m©
.format) {

577 
bam
:  
	`bam_ªad1
(
bgzÂ
, 
b
);

578 
¸am
:  
	`¸am_gë_bam_£q
(
Â
->Â.¸am, &
b
);

581 
	`Ârötf
(
°dîr
, "[sam_bam_cram_readrec] Not implemented for SAM files -- Exiting\n");

582 
	`ab‹t
();

584 
	}
}

586 
hts_idx_t
 *
	$ßm_ödex_lﬂd2
(
htsFûe
 *
Â
, c⁄° *
‚
, c⁄° *
‚idx
)

588 
Â
->
f‹m©
.format) {

589 
bam
:

590  
‚idx
? 
	`hts_idx_lﬂd2
(
‚
, fnidxË: 
	`hts_idx_lﬂd
(‚, 
HTS_FMT_BAI
);

592 
¸am
: {

593 i‡(
	`¸am_ödex_lﬂd
(
Â
->Â.
¸am
, 
‚
, 
‚idx
Ë< 0Ë 
NULL
;

595 
hts_¸am_idx_t
 *
idx
 = 
	`mÆloc
( (hts_cram_idx_t));

596 i‡(
idx
 =
NULL
)  NULL;

597 
idx
->
fmt
 = 
HTS_FMT_CRAI
;

598 
idx
->
¸am
 = 
Â
->fp.cram;

599  (
hts_idx_t
 *Ë
idx
;

603  
NULL
;

605 
	}
}

607 
hts_idx_t
 *
	$ßm_ödex_lﬂd
(
htsFûe
 *
Â
, c⁄° *
‚
)

609  
	`ßm_ödex_lﬂd2
(
Â
, 
‚
, 
NULL
);

610 
	}
}

612 
hts_ôr_t
 *
	$¸am_ôr_quîy
(c⁄° 
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
, 
hts_ªadªc_func
 *
ªadªc
)

614 c⁄° 
hts_¸am_idx_t
 *
cidx
 = (c⁄° hts_¸am_idx_à*Ë
idx
;

615 
hts_ôr_t
 *
ôî
 = (hts_ôr_à*Ë
	`ˇŒoc
(1, (hts_itr_t));

616 i‡(
ôî
 =
NULL
)  NULL;

620 
ôî
->
is_¸am
 = 1;

621 
ôî
->
ªad_ª°
 = 1;

622 
ôî
->
off
 = 
NULL
;

623 
ôî
->
bös
.
a
 = 
NULL
;

624 
ôî
->
ªadªc
 =Ñeadrec;

626 i‡(
tid
 >0 ||Åid =
HTS_IDX_NOCOOR
) {

627 
¸am_ønge
 
r
 = { 
tid
 =
HTS_IDX_NOCOOR
 ? -1 :Åid, 
beg
+1, 
íd
 };

628 
ªt
 = 
	`¸am_£t_›ti⁄
(
cidx
->
¸am
, 
CRAM_OPT_RANGE
, &
r
);

630 
ôî
->
cuº_off
 = 0;

633 
ôî
->
tid
 =Åid;

634 
ôî
->
beg
 = beg;

635 
ôî
->
íd
 =Énd;

637 
ªt
) {

644 
ôî
->
föished
 = 1;

648 
	`‰ì
(
ôî
);

649  
NULL
;

652 
tid
) {

653 
HTS_IDX_REST
:

654 
ôî
->
cuº_off
 = 0;

656 
HTS_IDX_NONE
:

657 
ôî
->
cuº_off
 = 0;

658 
ôî
->
föished
 = 1;

661 
	`Ârötf
(
°dîr
, "[¸am_ôr_quîy]Åid=%dÇŸ im∂emíãd f‹ CRAM fûe†-- Exôög\n", 
tid
);

662 
	`ab‹t
();

666  
ôî
;

667 
	}
}

669 
hts_ôr_t
 *
	$ßm_ôr_quîyi
(c⁄° 
hts_idx_t
 *
idx
, 
tid
, 
beg
, 
íd
)

671 c⁄° 
hts_¸am_idx_t
 *
cidx
 = (c⁄° hts_¸am_idx_à*Ë
idx
;

672 i‡(
idx
 =
NULL
)

673  
	`hts_ôr_quîy
(
NULL
, 
tid
, 
beg
, 
íd
, 
ßm_bam_¸am_ªadªc
);

674 i‡(
cidx
->
fmt
 =
HTS_FMT_CRAI
)

675  
	`¸am_ôr_quîy
(
idx
, 
tid
, 
beg
, 
íd
, 
¸am_ªadªc
);

677  
	`hts_ôr_quîy
(
idx
, 
tid
, 
beg
, 
íd
, 
bam_ªadªc
);

678 
	}
}

680 
	$¸am_«me2id
(*
fdv
, c⁄° *
ªf
)

682 
¸am_fd
 *
fd
 = (¸am_fd *Ë
fdv
;

683  
	`ßm_hdr_«me2ªf
(
fd
->
hódî
, 
ªf
);

684 
	}
}

686 
hts_ôr_t
 *
	$ßm_ôr_quîys
(c⁄° 
hts_idx_t
 *
idx
, 
bam_hdr_t
 *
hdr
, c⁄° *
ªgi⁄
)

688 c⁄° 
hts_¸am_idx_t
 *
cidx
 = (c⁄° hts_¸am_idx_à*Ë
idx
;

689 i‡(
cidx
->
fmt
 =
HTS_FMT_CRAI
)

690  
	`hts_ôr_quîys
(
idx
, 
ªgi⁄
, 
¸am_«me2id
, 
cidx
->
¸am
, 
¸am_ôr_quîy
, 
¸am_ªadªc
);

692  
	`hts_ôr_quîys
(
idx
, 
ªgi⁄
, (
hts_«me2id_f
)(
bam_«me2id
), 
hdr
, 
hts_ôr_quîy
, 
bam_ªadªc
);

693 
	}
}

699 
	~"ht¶ib/k£q.h
"

700 
	~"ht¶ib/k°rög.h
"

702 
bam_hdr_t
 *
	$ßm_hdr_∑r£
(
l_ãxt
, c⁄° *
ãxt
)

704 c⁄° *
q
, *
r
, *
p
;

705 
	`khash_t
(
s2i
Ë*
d
;

706 
d
 = 
	`kh_öô
(
s2i
);

707 
p
 = 
ãxt
; *p; ++p) {

708 i‡(
	`°∫cmp
(
p
, "@SQ\t", 4) == 0) {

709 *
¢
 = 0;

710 
 
 = -1;

711 
q
 = 
p
 + 4;; ++q) {

712 i‡(
	`°∫cmp
(
q
, "SN:", 3) == 0) {

713 
q
 += 3;

714 
r
 = 
q
; *r != '\t' && *r != '\n' && *r != '\0'; ++r);

715 
¢
 = (*)
	`ˇŒoc
(
r
 - 
q
 + 1, 1);

716 
	`°∫˝y
(
¢
, 
q
, 
r
 - q);

717 
q
 = 
r
;

718 } i‡(
	`°∫cmp
(
q
, "LN:", 3) == 0)

719 
 
 = 
	`°πﬁ
(
q
 + 3, (**)&q, 10);

720 *
q
 != '\t' && *q != '\n' && *q != '\0') ++q;

721 i‡(*
q
 == '\0' || *q == '\n') ;

723 
p
 = 
q
;

724 i‡(
¢
 && 
 
 >= 0) {

725 
khöt_t
 
k
;

726 
ab£¡
;

727 
k
 = 
	`kh_put
(
s2i
, 
d
, 
¢
, &
ab£¡
);

728 i‡(!
ab£¡
) {

729 i‡(
hts_vîbo£
 >= 2)

730 
	`Ârötf
(
°dîr
, "[W::%s] du∂iˇãd sequí˚ '%s'\n", 
__func__
, 
¢
);

731 
	`‰ì
(
¢
);

732 } 
	`kh_vÆ
(
d
, 
k
Ë(
öt64_t
)(
	`kh_size
(dË- 1)<<32 | 
 
;

735 *
p
 != '\0' && *p != '\n') ++p;

737  
	`hdr_‰om_di˘
(
d
);

738 
	}
}

749 
bam_hdr_t
 *
	$ßm_hdr_ßnôi£
(
bam_hdr_t
 *
h
) {

750 i‡(!
h
)

751  
NULL
;

754 i‡(
h
->
l_ãxt
 == 0)

755  
h
;

757 
uöt32_t
 
i
, 
 um
 = 0;

758 *
˝
 = 
h
->
ãxt
, 
œ°
 = '\n';

759 
i
 = 0; i < 
h
->
l_ãxt
; i++) {

761 i‡(
˝
[
i
] == 0)

765 i‡(
œ°
 == '\n') {

766 
 um
++;

767 i‡(
˝
[
i
] != '@') {

768 i‡(
hts_vîbo£
 >= 1)

769 
	`Ârötf
(
°dîr
,

771 
__func__
, 
 um
);

772 
	`bam_hdr_de°roy
(
h
);

773  
NULL
;

777 
œ°
 = 
˝
[
i
];

780 i‡(
i
 < 
h
->
l_ãxt
) {

781 
uöt32_t
 
j
 = 
i
;

782 
j
 < 
h
->
l_ãxt
 && 
˝
[j] == '\0') j++;

783 i‡(
j
 < 
h
->
l_ãxt
 && 
hts_vîbo£
 >= 2)

784 
	`Ârötf
(
°dîr
, "[W::%s] Unexpected NUL character in header. "

785 "PossiblyÅrunˇãd.\n", 
__func__
);

789 i‡(
œ°
 != '\n') {

790 i‡(
hts_vîbo£
 >= 2)

791 
	`Ârötf
(
°dîr
, "[W::%s] MissingÅrailingÇewline on SAM header. "

792 "PossiblyÅrunˇãd.\n", 
__func__
);

794 i‡(
h
->
l_ãxt
 =
UINT32_MAX
) {

795 i‡(
hts_vîbo£
 >= 1)

796 
	`Ârötf
(
°dîr
, "[E::%s] NoÑoom forÉxtraÇewline.\n",

797 
__func__
);

798 
	`bam_hdr_de°roy
(
h
);

799  
NULL
;

802 i‡(
i
 >
h
->
l_ãxt
 - 1) {

803 
˝
 = 
	`ªÆloc
(
h
->
ãxt
, (
size_t
Ëh->
l_ãxt
+2);

804 i‡(!
˝
) {

805 
	`bam_hdr_de°roy
(
h
);

806  
NULL
;

808 
h
->
ãxt
 = 
˝
;

810 
˝
[
i
++] = '\n';

813 i‡(
h
->
l_ãxt
 < 
i
)

814 
h
->
l_ãxt
 = 
i
;

815 
˝
[
h
->
l_ãxt
] = '\0';

818  
h
;

819 
	}
}

821 
bam_hdr_t
 *
	$ßm_hdr_ªad
(
htsFûe
 *
Â
)

823 
Â
->
f‹m©
.format) {

824 
bam
:

825  
	`ßm_hdr_ßnôi£
(
	`bam_hdr_ªad
(
Â
->Â.
bgzf
));

827 
¸am
:

828  
	`ßm_hdr_ßnôi£
(
	`¸am_hódî_to_bam
(
Â
->Â.
¸am
->
hódî
));

830 
ßm
: {

831 
k°rög_t
 
°r
 = { 0, 0, 
NULL
 };

832 
bam_hdr_t
 *
h
 = 
NULL
;

833 
ªt
, 
has_SQ
 = 0;

834 (
ªt
 = 
	`hts_gëlöe
(
Â
, 
KS_SEP_LINE
, &Â->
löe
)) >= 0) {

835 i‡(
Â
->
löe
.
s
[0] != '@') ;

836 i‡(
Â
->
löe
.
l
 > 3 && 
	`°∫cmp
(Â->löe.
s
,"@SQ",3Ë=0Ë
has_SQ
 = 1;

837 
	`kput¢
(
Â
->
löe
.
s
, fp->löe.
l
, &
°r
);

838 
	`kputc
('\n', &
°r
);

840 i‡(
ªt
 < -1Ë
îr‹
;

841 i‡(! 
has_SQ
 && 
Â
->
‚_aux
) {

842 
k°rög_t
 
löe
 = { 0, 0, 
NULL
 };

843 
hFILE
 *
f
 = 
	`h›í
(
Â
->
‚_aux
, "r");

844 i‡(
f
 =
NULL
Ë
îr‹
;

845 
löe
.
l
 = 0, 
	`kgëlöe
(&löe, (
kgës_func
 *Ë
hgës
, 
f
) >= 0) {

846 *
èb
 = 
	`°rchr
(
löe
.
s
, '\t');

847 i‡(
èb
 =
NULL
) ;

848 
	`kputs
("@SQ\tSN:", &
°r
);

849 
	`kput¢
(
löe
.
s
, 
èb
 -Üöe.s, &
°r
);

850 
	`kputs
("\tLN:", &
°r
);

851 
	`kpué
(
	`©ﬁ
(
èb
), &
°r
);

852 
	`kputc
('\n', &
°r
);

854 
	`‰ì
(
löe
.
s
);

855 i‡(
	`h˛o£
(
f
) != 0) {

856 i‡(
hts_vîbo£
 >= 2)

857 
	`Ârötf
(
°dîr
, "[W::%s] closög \"%s\" faûed\n", 
__func__
, 
Â
->
‚_aux
);

860 i‡(
°r
.
l
 =0Ë
	`kput¢
("", 0, &str);

861 
h
 = 
	`ßm_hdr_∑r£
(
°r
.
l
, så.
s
);

862 
h
->
l_ãxt
 = 
°r
.
l
; h->
ãxt
 = så.
s
;

863  
	`ßm_hdr_ßnôi£
(
h
);

865 
îr‹
:

866 
	`bam_hdr_de°roy
(
h
);

867 
	`‰ì
(
°r
.
s
);

868  
NULL
;

872 
	`ab‹t
();

874 
	}
}

876 
	$ßm_hdr_wrôe
(
htsFûe
 *
Â
, c⁄° 
bam_hdr_t
 *
h
)

878 
Â
->
f‹m©
.format) {

879 
bö¨y_f‹m©
:

880 
Â
->
f‹m©
.
ˇãg‹y
 = 
£quí˚_d©a
;

881 
Â
->
f‹m©
.f‹m© = 
bam
;

883 
bam
:

884 i‡(
	`bam_hdr_wrôe
(
Â
->Â.
bgzf
, 
h
) < 0)  -1;

887 
¸am
: {

888 
¸am_fd
 *
fd
 = 
Â
->Â.
¸am
;

889 
SAM_hdr
 *
hdr
 = 
	`bam_hódî_to_¸am
((
bam_hdr_t
 *)
h
);

890 i‡(! 
hdr
)  -1;

891 i‡(
	`¸am_£t_hódî
(
fd
, 
hdr
) < 0)  -1;

892 i‡(
Â
->
‚_aux
)

893 
	`¸am_lﬂd_ª„ªn˚
(
fd
, 
Â
->
‚_aux
);

894 i‡(
	`¸am_wrôe_SAM_hdr
(
fd
, fd->
hódî
) < 0)  -1;

898 
ãxt_f‹m©
:

899 
Â
->
f‹m©
.
ˇãg‹y
 = 
£quí˚_d©a
;

900 
Â
->
f‹m©
.f‹m© = 
ßm
;

902 
ßm
: {

903 *
p
;

904 
	`hputs
(
h
->
ãxt
, 
Â
->Â.
hfûe
);

905 
p
 = 
	`°r°r
(
h
->
ãxt
, "@SQ\t");

906 i‡(
p
 == 0) {

907 
i
;

908 
i
 = 0; i < 
h
->
n_èrgës
; ++i) {

909 
Â
->
löe
.
l
 = 0;

910 
	`kput¢
("@SQ\tSN:", 7, &
Â
->
löe
); 
	`kputs
(
h
->
èrgë_«me
[
i
], &fp->line);

911 
	`kput¢
("\tLN:", 4, &
Â
->
löe
); 
	`kputw
(
h
->
èrgë_Àn
[
i
], &Â->löe); 
	`kputc
('\n', &fp->line);

912 i‡–
	`hwrôe
(
Â
->Â.
hfûe
, fp->
löe
.
s
, fp->löe.
l
) != fp->line.l )  -1;

915 i‡–
	`hÊush
(
Â
->Â.
hfûe
) != 0 )  -1;

920 
	`ab‹t
();

923 
	}
}

929 
	$ßm_∑r£1
(
k°rög_t
 *
s
, 
bam_hdr_t
 *
h
, 
bam1_t
 *
b
)

931 
	#_ªad_tokí
(
_p
Ë(_p); ; *(_pË&& *(_pË!'\t'; ++(_p)); i‡(*(_pË!'\t'Ë
îr_ªt
; *(_p)++ = 0

	)

932 
	#_ªad_tokí_aux
(
_p
) (_p); ; *(_p) && *(_p) != '\t'; ++(_p)); *(_p)++ = 0

933 
	#_gë_mem
(
ty≥_t
, 
_x
, 
_s
, 
_l
Ë
	`ks_ªsize
((_s), (_s)->
l
 + (_l)); *(_xË—y≥_t*)((_s)->
s
 + (_s)->l); (_s)->»+(_l)

	)

934 
	#_∑r£_îr
(
c⁄d
, 
msg
Ëdÿ{ i‡((c⁄dË&& 
hts_vîbo£
 >1Ë{ 
	`Ârötf
(
°dîr
, "[E::%s] " msg "\n", 
__func__
); 
îr_ªt
; } } 0)

	)

935 
	#_∑r£_îr_∑øm
(
c⁄d
, 
msg
, 
∑øm
Ëdÿ{ i‡((c⁄dË&& 
hts_vîbo£
 >1Ë{ 
	`Ârötf
(
°dîr
, "[E::%s] " msg "\n", 
__func__
,Ö¨am); 
îr_ªt
; } } 0)

	)

936 
	#_∑r£_w¨n
(
c⁄d
, 
msg
Ëi‡((c⁄dË&& 
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[W::%s] " msg "\n", 
__func__
)

	)

938 
uöt8_t
 *
t
;

939 *
p
 = 
s
->s, *
q
;

940 
i
;

941 
k°rög_t
 
°r
;

942 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

944 
°r
.
l
 = 
b
->
l_d©a
 = 0;

945 
°r
.
s
 = (*)
b
->
d©a
; så.
m
 = b->
m_d©a
;

946 
	`mem£t
(
c
, 0, 32);

947 i‡(
h
->
cig¨_èb
 == 0) {

948 
h
->
cig¨_èb
 = (
öt8_t
*Ë
	`mÆloc
(128);

949 
i
 = 0; i < 128; ++i)

950 
h
->
cig¨_èb
[
i
] = -1;

951 
i
 = 0; 
BAM_CIGAR_STR
[i]; ++i)

952 
h
->
cig¨_èb
[()
BAM_CIGAR_STR
[
i
]] = i;

955 
q
 = 
	`_ªad_tokí
(
p
);

956 
	`_∑r£_w¨n
(
p
 - 
q
 <= 1, "empty queryÇame");

957 
	`_∑r£_îr
(
p
 - 
q
 > 252, "queryÇameÅooÜong");

958 
	`kput¢_
(
q
, 
p
 - q, &
°r
);

959 
c
->
l_exå™ul
 = 0; 
°r
.
l
 % 4 != 0; c->l_extranul++)

960 
	`kputc_
('\0', &
°r
);

961 
c
->
l_q«me
 = 
p
 - 
q
 + c->
l_exå™ul
;

963 
c
->
Êag
 = 
	`°πﬁ
(
p
, &p, 0);

964 i‡(*
p
++ !'\t'Ë
îr_ªt
;

966 
q
 = 
	`_ªad_tokí
(
p
);

967 i‡(
	`°rcmp
(
q
, "*")) {

968 
	`_∑r£_îr
(
h
->
n_èrgës
 == 0, "missing SAM header");

969 
c
->
tid
 = 
	`bam_«me2id
(
h
, 
q
);

970 
	`_∑r£_w¨n
(
c
->
tid
 < 0, "urecognizedÑeferenceÇame;Åreatedás unmapped");

971 } 
c
->
tid
 = -1;

973 
c
->
pos
 = 
	`°πﬁ
(
p
, &p, 10) - 1;

974 i‡(*
p
++ !'\t'Ë
îr_ªt
;

975 i‡(
c
->
pos
 < 0 && c->
tid
 >= 0) {

976 
	`_∑r£_w¨n
(1, "mapped query cannot have zero coordinate;Åreatedás unmapped");

977 
c
->
tid
 = -1;

979 i‡(
c
->
tid
 < 0Ëc->
Êag
 |
BAM_FUNMAP
;

981 
c
->
quÆ
 = 
	`°πﬁ
(
p
, &p, 10);

982 i‡(*
p
++ !'\t'Ë
îr_ªt
;

984 i‡(*
p
 != '*') {

985 
uöt32_t
 *
cig¨
;

986 
size_t
 
n_cig¨
 = 0;

987 
q
 = 
p
; *p && *p != '\t'; ++p)

988 i‡(!
	`isdigô_c
(*
p
)Ë++
n_cig¨
;

989 i‡(*
p
++ !'\t'Ë
îr_ªt
;

990 
	`_∑r£_îr
(
n_cig¨
 == 0, "no CIGAR operations");

991 
	`_∑r£_îr
(
n_cig¨
 >= 2147483647, "too many CIGAR operations");

992 
c
->
n_cig¨
 =Ç_cigar;

993 
	`_gë_mem
(
uöt32_t
, &
cig¨
, &
°r
, 
c
->
n_cig¨
 * (uint32_t));

994 
i
 = 0; i < 
c
->
n_cig¨
; ++i, ++
q
) {

995 
›
;

996 
cig¨
[
i
] = 
	`°πﬁ
(
q
, &q, 10)<<
BAM_CIGAR_SHIFT
;

997 
›
 = (
uöt8_t
)*
q
 >128? -1 : 
h
->
cig¨_èb
[()*q];

998 
	`_∑r£_îr
(
›
 < 0, "unrecognized CIGAR operator");

999 
cig¨
[
i
] |
›
;

1002 
i
 = (!(
c
->
Êag
&
BAM_FUNMAP
))? 
	`bam_cig¨2æí
(c->
n_cig¨
, 
cig¨
) : 1;

1004 
	`_∑r£_w¨n
(!(
c
->
Êag
&
BAM_FUNMAP
), "mapped query must haveá CIGAR;Åreatedás unmapped");

1005 
c
->
Êag
 |
BAM_FUNMAP
;

1006 
q
 = 
	`_ªad_tokí
(
p
);

1007 
i
 = 1;

1009 
c
->
bö
 = 
	`hts_ªg2bö
(c->
pos
, c->po†+ 
i
, 14, 5);

1011 
q
 = 
	`_ªad_tokí
(
p
);

1012 i‡(
	`°rcmp
(
q
, "=") == 0) {

1013 
c
->
mtid
 = c->
tid
;

1014 } i‡(
	`°rcmp
(
q
, "*") == 0) {

1015 
c
->
mtid
 = -1;

1017 
c
->
mtid
 = 
	`bam_«me2id
(
h
, 
q
);

1018 
	`_∑r£_w¨n
(
c
->
mtid
 < 0, "urecognized mateÑeferenceÇame;Åreatedás unmapped");

1021 
c
->
mpos
 = 
	`°πﬁ
(
p
, &p, 10) - 1;

1022 i‡(*
p
++ !'\t'Ë
îr_ªt
;

1023 i‡(
c
->
mpos
 < 0 && c->
mtid
 >= 0) {

1024 
	`_∑r£_w¨n
(1, "mapped mate cannot have zero coordinate;Åreatedás unmapped");

1025 
c
->
mtid
 = -1;

1028 
c
->
isize
 = 
	`°πﬁ
(
p
, &p, 10);

1029 i‡(*
p
++ !'\t'Ë
îr_ªt
;

1031 
q
 = 
	`_ªad_tokí
(
p
);

1032 i‡(
	`°rcmp
(
q
, "*")) {

1033 
c
->
l_q£q
 = 
p
 - 
q
 - 1;

1034 
i
 = 
	`bam_cig¨2qÀn
(
c
->
n_cig¨
, (
uöt32_t
*)(
°r
.
s
 + c->
l_q«me
));

1035 
	`_∑r£_îr
(
c
->
n_cig¨
 && 
i
 !c->
l_q£q
, "CIGARánd query sequenceáre of differentÜength");

1036 
i
 = (
c
->
l_q£q
 + 1) >> 1;

1037 
	`_gë_mem
(
uöt8_t
, &
t
, &
°r
, 
i
);

1038 
	`mem£t
(
t
, 0, 
i
);

1039 
i
 = 0; i < 
c
->
l_q£q
; ++i)

1040 
t
[
i
>>1] |
£q_¡16_èbÀ
[()
q
[i]] << ((~i&1)<<2);

1041 } 
c
->
l_q£q
 = 0;

1043 
q
 = 
	`_ªad_tokí_aux
(
p
);

1044 
	`_gë_mem
(
uöt8_t
, &
t
, &
°r
, 
c
->
l_q£q
);

1045 i‡(
	`°rcmp
(
q
, "*")) {

1046 
	`_∑r£_îr
(
p
 - 
q
 - 1 !
c
->
l_q£q
, "SEQánd QUALáre of differentÜength");

1047 
i
 = 0; i < 
c
->
l_q£q
; ++iË
t
[i] = 
q
[i] - 33;

1048 } 
	`mem£t
(
t
, 0xff, 
c
->
l_q£q
);

1050 
p
 < 
s
->†+ s->
l
) {

1051 
uöt8_t
 
ty≥
;

1052 
q
 = 
	`_ªad_tokí_aux
(
p
);

1053 
	`_∑r£_îr
(
p
 - 
q
 - 1 < 5, "incompleteáux field");

1054 
	`kput¢_
(
q
, 2, &
°r
);

1055 
q
 +3; 
ty≥
 = *q++; ++q;

1056 i‡(
ty≥
 != 'Z' &&Åype != 'H')

1057 
	`_∑r£_îr
(
p
 - 
q
 - 1 < 1, "incompleteáux field");

1062 
	`_∑r£_îr
(
	`ks_ªsize
(&
°r
, så.
l
 + 16), "out of memory");

1064 i‡(
ty≥
 == 'A' ||Åype == 'a' ||Åype == 'c' ||Åype == 'C') {

1065 
	`kputc_
('A', &
°r
);

1066 
	`kputc_
(*
q
, &
°r
);

1067 } i‡(
ty≥
 == 'i' ||Åype == 'I') {

1068 i‡(*
q
 == '-') {

1069 
x
 = 
	`°πﬁ
(
q
, &q, 10);

1070 i‡(
x
 >
INT8_MIN
) {

1071 
	`kputc_
('c', &
°r
); kputc_(
x
, &str);

1072 } i‡(
x
 >
INT16_MIN
) {

1073 
°r
.
s
[°r.
l
++] = 's';

1074 
	`i16_to_À
(
x
, (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1075 
°r
.
l
 += 2;

1077 
°r
.
s
[°r.
l
++] = 'i';

1078 
	`i32_to_À
(
x
, (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1079 
°r
.
l
 += 4;

1082 
x
 = 
	`°πoul
(
q
, &q, 10);

1083 i‡(
x
 <
UINT8_MAX
) {

1084 
	`kputc_
('C', &
°r
); kputc_(
x
, &str);

1085 } i‡(
x
 <
UINT16_MAX
) {

1086 
°r
.
s
[°r.
l
++] = 'S';

1087 
	`u16_to_À
(
x
, (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1088 
°r
.
l
 += 2;

1090 
°r
.
s
[°r.
l
++] = 'I';

1091 
	`u32_to_À
(
x
, (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1092 
°r
.
l
 += 4;

1095 } i‡(
ty≥
 == 'f') {

1096 
°r
.
s
[°r.
l
++] = 'f';

1097 
	`Êﬂt_to_À
(
	`°πod
(
q
, &q), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1098 
°r
.
l
 += ();

1099 } i‡(
ty≥
 == 'd') {

1100 
°r
.
s
[°r.
l
++] = 'd';

1101 
	`doubÀ_to_À
(
	`°πod
(
q
, &q), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1102 
°r
.
l
 += ();

1103 } i‡(
ty≥
 == 'Z' ||Åype == 'H') {

1104 
	`_∑r£_îr
(
ty≥
 ='H' && !((
p
-
q
)&1),

1106 
	`kputc_
(
ty≥
, &
°r
);
	`kput¢_
(
q
, 
p
 - q, &str);

1107 } i‡(
ty≥
 == 'B') {

1108 
öt32_t
 
n
, 
size
;

1109 
size_t
 
byãs
;

1110 *
r
;

1111 
	`_∑r£_îr
(
p
 - 
q
 - 1 < 3, "incomplete B-typedáux field");

1112 
ty≥
 = *
q
++;

1114 
size
 = 
	`aux_ty≥2size
(
ty≥
);

1115 
	`_∑r£_îr_∑øm
(
size
 <= 0 || size > 4,

1116 "uƒecognizedÅy≥ B:%c", 
ty≥
);

1117 
	`_∑r£_îr
(*
q
 && *q != ',', "Báux fieldÅypeÇot followed by ','");

1119 
r
 = 
q
, 
n
 = 0; *r; ++r)

1120 i‡(*
r
 =','Ë++
n
;

1123 
byãs
 = (
size_t
Ë
n
 * (size_tË
size
;

1124 
	`_∑r£_îr
(
byãs
 / 
size
 !
n


1125 || 
	`ks_ªsize
(&
°r
, så.
l
 + 
byãs
 + 2 + (
uöt32_t
)),

1127 
°r
.
s
[°r.
l
++] = 'B';

1128 
°r
.
s
[°r.
l
++] = 
ty≥
;

1129 
	`i32_to_À
(
n
, (
uöt8_t
 *Ë
°r
.
s
 + så.
l
);

1130 
°r
.
l
 +(
uöt32_t
);

1135 
	#_skù_to_comma
(
q
, 
p
Ëdÿ{ (qË< (pË&& *(qË!','Ë(q)++; } 0)

	)

1137 i‡(
ty≥
 ='c'Ë
q
 + 1 < 
p
Ë{ 
öt8_t
 
x
 = 
	`°πﬁ
(q + 1, &q, 0); 
	`kputc_
(x, &
°r
); }

1138 i‡(
ty≥
 ='C'Ë
q
 + 1 < 
p
Ë{ 
uöt8_t
 
x
 = 
	`°πoul
(q + 1, &q, 0); 
	`kputc_
(x, &
°r
); }

1139 i‡(
ty≥
 ='s'Ë
q
 + 1 < 
p
Ë{ 
	`i16_to_À
(
	`°πﬁ
(q + 1, &q, 0), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
); så.»+2; 
	`_skù_to_comma
(q,Ö); }

1140 i‡(
ty≥
 ='S'Ë
q
 + 1 < 
p
Ë{ 
	`u16_to_À
(
	`°πoul
(q + 1, &q, 0), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
); så.»+2; 
	`_skù_to_comma
(q,Ö); }

1141 i‡(
ty≥
 ='i'Ë
q
 + 1 < 
p
Ë{ 
	`i32_to_À
(
	`°πﬁ
(q + 1, &q, 0), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
); så.»+4; 
	`_skù_to_comma
(q,Ö); }

1142 i‡(
ty≥
 ='I'Ë
q
 + 1 < 
p
Ë{ 
	`u32_to_À
(
	`°πoul
(q + 1, &q, 0), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
); så.»+4; 
	`_skù_to_comma
(q,Ö); }

1143 i‡(
ty≥
 ='f'Ë
q
 + 1 < 
p
Ë{ 
	`Êﬂt_to_À
(
	`°πod
(q + 1, &q), (
uöt8_t
 *Ë
°r
.
s
 + så.
l
); så.»+4; 
	`_skù_to_comma
(q,Ö); }

1144 
	`_∑r£_îr_∑øm
(1, "uƒecognizedÅy≥ B:%c", 
ty≥
);

1146 #unde‡
_skù_to_comma


1148 } 
	`_∑r£_îr_∑øm
(1, "uƒecognizedÅy≥ %c", 
ty≥
);

1150 
b
->
d©a
 = (
uöt8_t
*)
°r
.
s
; b->
l_d©a
 = så.
l
; b->
m_d©a
 = så.
m
;

1153 #unde‡
_∑r£_w¨n


1154 #unde‡
_∑r£_îr


1155 #unde‡
_∑r£_îr_∑øm


1156 #unde‡
_gë_mem


1157 #unde‡
_ªad_tokí_aux


1158 #unde‡
_ªad_tokí


1159 
îr_ªt
:

1160 
b
->
d©a
 = (
uöt8_t
*)
°r
.
s
; b->
l_d©a
 = så.
l
; b->
m_d©a
 = så.
m
;

1162 
	}
}

1164 
	$ßm_ªad1
(
htsFûe
 *
Â
, 
bam_hdr_t
 *
h
, 
bam1_t
 *
b
)

1166 
Â
->
f‹m©
.format) {

1167 
bam
: {

1168 
r
 = 
	`bam_ªad1
(
Â
->Â.
bgzf
, 
b
);

1169 i‡(
r
 >= 0) {

1170 i‡(
b
->
c‹e
.
tid
 >
h
->
n_èrgës
 || b->core.tid < -1 ||

1171 
b
->
c‹e
.
mtid
 >
h
->
n_èrgës
 || b->core.mtid < -1)

1174  
r
;

1177 
¸am
: {

1178 
ªt
 = 
	`¸am_gë_bam_£q
(
Â
->Â.
¸am
, &
b
);

1179  
ªt
 >= 0

1180 ? 
ªt


1181 : (
	`¸am_eof
(
Â
->Â.
¸am
) ? -1 : -2);

1184 
ßm
: {

1185 
ªt
;

1186 
îr_ªcovî
:

1187 i‡(
Â
->
löe
.
l
 == 0) {

1188 
ªt
 = 
	`hts_gëlöe
(
Â
, 
KS_SEP_LINE
, &Â->
löe
);

1189 i‡(
ªt
 < 0) Ñet;

1191 
ªt
 = 
	`ßm_∑r£1
(&
Â
->
löe
, 
h
, 
b
);

1192 
Â
->
löe
.
l
 = 0;

1193 i‡(
ªt
 < 0) {

1194 i‡(
hts_vîbo£
 >= 1)

1195 
	`Ârötf
(
°dîr
, "[W::%s]Ö¨£Éº‹áàlöê%Œd\n", 
__func__
, ()
Â
->
löío
);

1196 i‡(
h
->
ign‹e_ßm_îr
Ë
îr_ªcovî
;

1198  
ªt
;

1202 
	`ab‹t
();

1204 
	}
}

1206 
	$ßm_f‹m©1
(c⁄° 
bam_hdr_t
 *
h
, c⁄° 
bam1_t
 *
b
, 
k°rög_t
 *
°r
)

1208 
i
;

1209 
uöt8_t
 *
s
, *
íd
;

1210 c⁄° 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

1212 
°r
->
l
 = 0;

1213 
	`kput¢
(
	`bam_gë_q«me
(
b
), 
c
->
l_q«me
-1-c->
l_exå™ul
, 
°r
); 
	`kputc
('\t', str);

1214 
	`kputw
(
c
->
Êag
, 
°r
); 
	`kputc
('\t', str);

1215 i‡(
c
->
tid
 >= 0) {

1216 
	`kputs
(
h
->
èrgë_«me
[
c
->
tid
] , 
°r
);

1217 
	`kputc
('\t', 
°r
);

1218 } 
	`kput¢
("*\t", 2, 
°r
);

1219 
	`kputw
(
c
->
pos
 + 1, 
°r
); 
	`kputc
('\t', str);

1220 
	`kputw
(
c
->
quÆ
, 
°r
); 
	`kputc
('\t', str);

1221 i‡(
c
->
n_cig¨
) {

1222 
uöt32_t
 *
cig¨
 = 
	`bam_gë_cig¨
(
b
);

1223 
i
 = 0; i < 
c
->
n_cig¨
; ++i) {

1224 
	`kputw
(
	`bam_cig¨_›Àn
(
cig¨
[
i
]), 
°r
);

1225 
	`kputc
(
	`bam_cig¨_›chr
(
cig¨
[
i
]), 
°r
);

1227 } 
	`kputc
('*', 
°r
);

1228 
	`kputc
('\t', 
°r
);

1229 i‡(
c
->
mtid
 < 0Ë
	`kput¢
("*\t", 2, 
°r
);

1230 i‡(
c
->
mtid
 =c->
tid
Ë
	`kput¢
("=\t", 2, 
°r
);

1232 
	`kputs
(
h
->
èrgë_«me
[
c
->
mtid
], 
°r
);

1233 
	`kputc
('\t', 
°r
);

1235 
	`kputw
(
c
->
mpos
 + 1, 
°r
); 
	`kputc
('\t', str);

1236 
	`kputw
(
c
->
isize
, 
°r
); 
	`kputc
('\t', str);

1237 i‡(
c
->
l_q£q
) {

1238 
uöt8_t
 *
s
 = 
	`bam_gë_£q
(
b
);

1239 
i
 = 0; i < 
c
->
l_q£q
; ++iË
	`kputc
("=ACMGRSVTWYHKDBN"[
	`bam_£qi
(
s
, i)], 
°r
);

1240 
	`kputc
('\t', 
°r
);

1241 
s
 = 
	`bam_gë_quÆ
(
b
);

1242 i‡(
s
[0] =0xffË
	`kputc
('*', 
°r
);

1243 
i
 = 0; i < 
c
->
l_q£q
; ++iË
	`kputc
(
s
[i] + 33, 
°r
);

1244 } 
	`kput¢
("*\t*", 3, 
°r
);

1246 
s
 = 
	`bam_gë_aux
(
b
);

1247 
íd
 = 
b
->
d©a
 + b->
l_d©a
;

1248 
íd
 - 
s
 >= 4) {

1249 
uöt8_t
 
ty≥
, 
key
[2];

1250 
key
[0] = 
s
[0]; key[1] = s[1];

1251 
s
 +2; 
ty≥
 = *s++;

1252 
	`kputc
('\t', 
°r
); 
	`kput¢
((*)
key
, 2, str); kputc(':', str);

1253 i‡(
ty≥
 == 'A') {

1254 
	`kput¢
("A:", 2, 
°r
);

1255 
	`kputc
(*
s
, 
°r
);

1256 ++
s
;

1257 } i‡(
ty≥
 == 'C') {

1258 
	`kput¢
("i:", 2, 
°r
);

1259 
	`kputw
(*
s
, 
°r
);

1260 ++
s
;

1261 } i‡(
ty≥
 == 'c') {

1262 
	`kput¢
("i:", 2, 
°r
);

1263 
	`kputw
(*(
öt8_t
*)
s
, 
°r
);

1264 ++
s
;

1265 } i‡(
ty≥
 == 'S') {

1266 i‡(
íd
 - 
s
 >= 2) {

1267 
	`kput¢
("i:", 2, 
°r
);

1268 
	`kputuw
(
	`À_to_u16
(
s
), 
°r
);

1269 
s
 += 2;

1270 } 
bad_aux
;

1271 } i‡(
ty≥
 == 's') {

1272 i‡(
íd
 - 
s
 >= 2) {

1273 
	`kput¢
("i:", 2, 
°r
);

1274 
	`kputw
(
	`À_to_i16
(
s
), 
°r
);

1275 
s
 += 2;

1276 } 
bad_aux
;

1277 } i‡(
ty≥
 == 'I') {

1278 i‡(
íd
 - 
s
 >= 4) {

1279 
	`kput¢
("i:", 2, 
°r
);

1280 
	`kputuw
(
	`À_to_u32
(
s
), 
°r
);

1281 
s
 += 4;

1282 } 
bad_aux
;

1283 } i‡(
ty≥
 == 'i') {

1284 i‡(
íd
 - 
s
 >= 4) {

1285 
	`kput¢
("i:", 2, 
°r
);

1286 
	`kputw
(
	`À_to_i32
(
s
), 
°r
);

1287 
s
 += 4;

1288 } 
bad_aux
;

1289 } i‡(
ty≥
 == 'f') {

1290 i‡(
íd
 - 
s
 >= 4) {

1291 
	`k•rötf
(
°r
, "f:%g", 
	`À_to_Êﬂt
(
s
));

1292 
s
 += 4;

1293 } 
bad_aux
;

1295 } i‡(
ty≥
 == 'd') {

1296 i‡(
íd
 - 
s
 >= 8) {

1297 
	`k•rötf
(
°r
, "d:%g", 
	`À_to_doubÀ
(
s
));

1298 
s
 += 8;

1299 } 
bad_aux
;

1300 } i‡(
ty≥
 == 'Z' ||Åype == 'H') {

1301 
	`kputc
(
ty≥
, 
°r
); kputc(':', str);

1302 
s
 < 
íd
 && *sË
	`kputc
(*s++, 
°r
);

1303 i‡(
s
 >
íd
)

1304 
bad_aux
;

1305 ++
s
;

1306 } i‡(
ty≥
 == 'B') {

1307 
uöt8_t
 
sub_ty≥
 = *(
s
++);

1308 
sub_ty≥_size
 = 
	`aux_ty≥2size
(
sub_ty≥
);

1309 
uöt32_t
 
n
;

1310 i‡(
sub_ty≥_size
 =0 || 
íd
 - 
s
 < 4)

1311 
bad_aux
;

1312 
n
 = 
	`À_to_u32
(
s
);

1313 
s
 += 4;

1314 i‡((
íd
 - 
s
Ë/ 
sub_ty≥_size
 < 
n
)

1315 
bad_aux
;

1316 
	`kput¢
("B:", 2, 
°r
); 
	`kputc
(
sub_ty≥
, str);

1317 
i
 = 0; i < 
n
; ++i) {

1318 
	`kputc
(',', 
°r
);

1319 i‡('c' =
sub_ty≥
Ë{ 
	`kputw
(*(
öt8_t
*)
s
, 
°r
); ++s; }

1320 i‡('C' =
sub_ty≥
Ë{ 
	`kputw
(*(
uöt8_t
*)
s
, 
°r
); ++s; }

1321 i‡('s' =
sub_ty≥
Ë{ 
	`kputw
(
	`À_to_i16
(
s
), 
°r
); s += 2; }

1322 i‡('S' =
sub_ty≥
Ë{ 
	`kputw
(
	`À_to_u16
(
s
), 
°r
); s += 2; }

1323 i‡('i' =
sub_ty≥
Ë{ 
	`kputw
(
	`À_to_i32
(
s
), 
°r
); s += 4; }

1324 i‡('I' =
sub_ty≥
Ë{ 
	`kputuw
(
	`À_to_u32
(
s
), 
°r
); s += 4; }

1325 i‡('f' =
sub_ty≥
Ë{ 
	`kputd
(
	`À_to_Êﬂt
(
s
), 
°r
); s += 4; }

1326 
bad_aux
;

1329 
bad_aux
;

1332  
°r
->
l
;

1334 
bad_aux
:

1335 i‡(
hts_vîbo£
 >= 1) {

1336 
	`Ârötf
(
°dîr
, "[E::%s] Corruptedáux data forÑead %s\n",

1337 
__func__
, 
	`bam_gë_q«me
(
b
));

1339 
î∫o
 = 
EINVAL
;

1341 
	}
}

1343 
	$ßm_wrôe1
(
htsFûe
 *
Â
, c⁄° 
bam_hdr_t
 *
h
, c⁄° 
bam1_t
 *
b
)

1345 
Â
->
f‹m©
.format) {

1346 
bö¨y_f‹m©
:

1347 
Â
->
f‹m©
.
ˇãg‹y
 = 
£quí˚_d©a
;

1348 
Â
->
f‹m©
.f‹m© = 
bam
;

1350 
bam
:

1351  
	`bam_wrôe1
(
Â
->Â.
bgzf
, 
b
);

1353 
¸am
:

1354  
	`¸am_put_bam_£q
(
Â
->Â.
¸am
, (
bam1_t
 *)
b
);

1356 
ãxt_f‹m©
:

1357 
Â
->
f‹m©
.
ˇãg‹y
 = 
£quí˚_d©a
;

1358 
Â
->
f‹m©
.f‹m© = 
ßm
;

1360 
ßm
:

1361 i‡(
	`ßm_f‹m©1
(
h
, 
b
, &
Â
->
löe
) < 0)  -1;

1362 
	`kputc
('\n', &
Â
->
löe
);

1363 i‡–
	`hwrôe
(
Â
->Â.
hfûe
, fp->
löe
.
s
, fp->löe.
l
) != fp->line.l )  -1;

1364  
Â
->
löe
.
l
;

1367 
	`ab‹t
();

1369 
	}
}

1374 #i‚de‡
HTS_LITTLE_ENDIAN


1375 
	$aux_to_À
(
ty≥
, 
uöt8_t
 *
out
, c⁄° uöt8_à*
ö
, 
size_t
 
Àn
) {

1376 
tsz
 = 
	`aux_ty≥2size
(
ty≥
);

1378 i‡(
tsz
 >2 &&Åsz <8 && (
Àn
 & (tsz - 1)) != 0)  -1;

1380 
tsz
) {

1382 
	`mem˝y
(
out
, 
ö
, 
Àn
);

1385 
	#aux_vÆ_to_À
(
ty≥_t
, 
°‹e_À
) do { \

1386 
ty≥_t
 
v
; \

1387 
size_t
 
i
; \

1388 
i
 = 0; i < 
Àn
; i +(
ty≥_t
), 
out
 += (type_t)) { \

1389 
	`mem˝y
(&
v
, 
ö
 + 
i
, (
ty≥_t
)); \

1390 
	`°‹e_À
(
v
, 
out
); \

1392 } 0)

	)

1394 2: 
	`aux_vÆ_to_À
(
uöt16_t
, 
u16_to_À
); ;

1395 4: 
	`aux_vÆ_to_À
(
uöt32_t
, 
u32_to_À
); ;

1396 8: 
	`aux_vÆ_to_À
(
uöt64_t
, 
u64_to_À
); ;

1398 #unde‡
aux_vÆ_to_À


1401 
uöt32_t
 
n
;

1402 i‡(
Àn
 < 5)  -1;

1403 
	`mem˝y
(&
n
, 
ö
 + 1, 4);

1404 
out
[0] = 
ö
[0];

1405 
	`u32_to_À
(
n
, 
out
 + 1);

1406  
	`aux_to_À
(
ö
[0], 
out
 + 5, i¿+ 5, 
Àn
 - 5);

1416 
	}
}

1419 
	$bam_aux_≠≥nd
(
bam1_t
 *
b
, c⁄° 
èg
[2], 
ty≥
, 
Àn
, c⁄° 
uöt8_t
 *
d©a
)

1421 
uöt32_t
 
√w_Àn
;

1423 
	`as£π
(
b
->
l_d©a
 >= 0);

1424 
√w_Àn
 = 
b
->
l_d©a
 + 3 + 
Àn
;

1425 i‡(
√w_Àn
 > 
INT32_MAX
 ||Çew_À¿< 
b
->
l_d©a
Ë
nomem
;

1427 i‡(
b
->
m_d©a
 < 
√w_Àn
) {

1428 
uöt32_t
 
√w_size
 = 
√w_Àn
;

1429 
uöt8_t
 *
√w_d©a
;

1430 
	`kroundup32
(
√w_size
);

1431 
√w_d©a
 = 
	`ªÆloc
(
b
->
d©a
, 
√w_size
);

1432 i‡(
√w_d©a
 =
NULL
Ë
nomem
;

1433 
b
->
m_d©a
 = 
√w_size
;

1434 
b
->
d©a
 = 
√w_d©a
;

1437 
b
->
d©a
[b->
l_d©a
] = 
èg
[0];

1438 
b
->
d©a
[b->
l_d©a
 + 1] = 
èg
[1];

1439 
b
->
d©a
[b->
l_d©a
 + 2] = 
ty≥
;

1441 #ifde‡
HTS_LITTLE_ENDIAN


1442 
	`mem˝y
(
b
->
d©a
 + b->
l_d©a
 + 3, d©a, 
Àn
);

1444 i‡(
	`aux_to_À
(
ty≥
, 
b
->
d©a
 + b->
l_d©a
 + 3, d©a, 
Àn
) != 0) {

1445 
î∫o
 = 
EINVAL
;

1450 
b
->
l_d©a
 = 
√w_Àn
;

1454 
nomem
:

1455 
î∫o
 = 
ENOMEM
;

1457 
	}
}

1459 
ölöe
 
uöt8_t
 *
	$skù_aux
(
uöt8_t
 *
s
, uöt8_à*
íd
)

1461 
size
;

1462 
uöt32_t
 
n
;

1463 i‡(
s
 >
íd
) Énd;

1464 
size
 = 
	`aux_ty≥2size
(*
s
); ++s;

1465 
size
) {

1468 *
s
 && s < 
íd
) ++s;

1469  
s
 < 
íd
 ? s + 1 :Énd;

1471 i‡(
íd
 - 
s
 < 5Ë 
NULL
;

1472 
size
 = 
	`aux_ty≥2size
(*
s
); ++s;

1473 
n
 = 
	`À_to_u32
(
s
);

1474 
s
 += 4;

1475 i‡(
size
 =0 || 
íd
 - 
s
 < sizê* 
n
Ë 
NULL
;

1476  
s
 + 
size
 * 
n
;

1478  
NULL
;

1480 i‡(
íd
 - 
s
 < 
size
Ë 
NULL
;

1481  
s
 + 
size
;

1483 
	}
}

1485 
uöt8_t
 *
	$bam_aux_gë
(c⁄° 
bam1_t
 *
b
, c⁄° 
èg
[2])

1487 
uöt8_t
 *
s
, *
íd
, *
t
 = (uöt8_à*Ë
èg
;

1488 
uöt16_t
 
y
 = (uöt16_tË
t
[0]<<8 |Å[1];

1489 
s
 = 
	`bam_gë_aux
(
b
);

1490 
íd
 = 
b
->
d©a
 + b->
l_d©a
;

1491 
s
 !
NULL
 && 
íd
 - s >= 3) {

1492 
uöt16_t
 
x
 = (uöt16_tË
s
[0]<<8 | s[1];

1493 
s
 += 2;

1494 i‡(
x
 =
y
) {

1496 
uöt8_t
 *
e
 = 
	`skù_aux
(
s
, 
íd
);

1497 i‡((*
s
 ='Z' || *†='H'Ë&& *(
e
 - 1) != '\0') {

1498 
bad_aux
;

1500 i‡(
e
 !
NULL
) {

1501  
s
;

1503 
bad_aux
;

1506 
s
 = 
	`skù_aux
(s, 
íd
);

1508 i‡(
s
 =
NULL
Ë
bad_aux
;

1509 
î∫o
 = 
ENOENT
;

1510  
NULL
;

1512 
bad_aux
:

1513 i‡(
hts_vîbo£
 >= 1) {

1514 
	`Ârötf
(
°dîr
, "[E::%s] Corruptedáux data forÑead %s\n",

1515 
__func__
, 
	`bam_gë_q«me
(
b
));

1517 
î∫o
 = 
EINVAL
;

1518  
NULL
;

1519 
	}
}

1521 
	$bam_aux_dñ
(
bam1_t
 *
b
, 
uöt8_t
 *
s
)

1523 
uöt8_t
 *
p
, *
aux
;

1524 
l_aux
 = 
	`bam_gë_l_aux
(
b
);

1525 
aux
 = 
	`bam_gë_aux
(
b
);

1526 
p
 = 
s
 - 2;

1527 
s
 = 
	`skù_aux
(s, 
aux
 + 
l_aux
);

1528 i‡(
s
 =
NULL
Ë
bad_aux
;

1529 
	`memmove
(
p
, 
s
, 
l_aux
 - (†- 
aux
));

1530 
b
->
l_d©a
 -
s
 - 
p
;

1533 
bad_aux
:

1534 i‡(
hts_vîbo£
 >= 1) {

1535 
	`Ârötf
(
°dîr
, "[E::%s] Corruptedáux data forÑead %s\n",

1536 
__func__
, 
	`bam_gë_q«me
(
b
));

1538 
î∫o
 = 
EINVAL
;

1540 
	}
}

1542 
	$bam_aux_upd©e_°r
(
bam1_t
 *
b
, c⁄° 
èg
[2], 
Àn
, c⁄° *
d©a
)

1545 
uöt8_t
 *
s
 = 
	`bam_aux_gë
(
b
,
èg
);

1546 i‡(!
s
) {

1547 i‡(
î∫o
 =
ENOENT
) {

1548  
	`bam_aux_≠≥nd
(
b
, 
èg
, 'Z', 
Àn
, (c⁄° 
uöt8_t
 *Ë
d©a
);

1553 
ty≥
 = *
s
;

1554 i‡(
ty≥
 != 'Z') {

1555 i‡(
hts_vîbo£
 > 1) {

1556 
	`Ârötf
(
°dîr
,"bam_aux_upd©e_°r(ËˇŒed f‹Åy≥ '%c' in°ód o‡'Z'\n", 
ty≥
);

1558 
î∫o
 = 
EINVAL
;

1562 
	`bam_aux_dñ
(
b
,
s
);

1563 
s
 -= 2;

1564 
l_aux
 = 
	`bam_gë_l_aux
(
b
);

1566 
b
->
l_d©a
 +3 + 
Àn
;

1567 i‡(
b
->
m_d©a
 < b->
l_d©a
) {

1568 
±rdiff_t
 
s_off£t
 = 
s
 - 
b
->
d©a
;

1569 
b
->
m_d©a
 = b->
l_d©a
;

1570 
	`kroundup32
(
b
->
m_d©a
);

1571 
b
->
d©a
 = (
uöt8_t
*)
	`ªÆloc
(b->d©a, b->
m_d©a
);

1572 
s
 = 
b
->
d©a
 + 
s_off£t
;

1574 
	`memmove
(
s
+3+
Àn
, s, 
l_aux
 - (†- 
	`bam_gë_aux
(
b
)));

1575 
s
[0] = 
èg
[0];

1576 
s
[1] = 
èg
[1];

1577 
s
[2] = 
ty≥
;

1578 
	`memmove
(
s
+3,
d©a
,
Àn
);

1580 
	}
}

1582 
ölöe
 
öt64_t
 
	$gë_öt_aux_vÆ
(
uöt8_t
 
ty≥
, c⁄° uöt8_à*
s
,

1583 
uöt32_t
 
idx
)

1585 
ty≥
) {

1586 'c':  
	`À_to_i8
(
s
 + 
idx
);

1587 'C':  
s
[
idx
];

1588 's':  
	`À_to_i16
(
s
 + 2 * 
idx
);

1589 'S':  
	`À_to_u16
(
s
 + 2 * 
idx
);

1590 'i':  
	`À_to_i32
(
s
 + 4 * 
idx
);

1591 'I':  
	`À_to_u32
(
s
 + 4 * 
idx
);

1593 
î∫o
 = 
EINVAL
;

1596 
	}
}

1598 
öt64_t
 
	$bam_aux2i
(c⁄° 
uöt8_t
 *
s
)

1600 
ty≥
;

1601 
ty≥
 = *
s
++;

1602  
	`gë_öt_aux_vÆ
(
ty≥
, 
s
, 0);

1603 
	}
}

1605 
	$bam_aux2f
(c⁄° 
uöt8_t
 *
s
)

1607 
ty≥
;

1608 
ty≥
 = *
s
++;

1609 i‡(
ty≥
 ='d'Ë 
	`À_to_doubÀ
(
s
);

1610 i‡(
ty≥
 ='f'Ë 
	`À_to_Êﬂt
(
s
);

1611  
	`gë_öt_aux_vÆ
(
ty≥
, 
s
, 0);

1612 
	}
}

1614 
	$bam_aux2A
(c⁄° 
uöt8_t
 *
s
)

1616 
ty≥
;

1617 
ty≥
 = *
s
++;

1618 i‡(
ty≥
 ='A'Ë *(*)
s
;

1619 
î∫o
 = 
EINVAL
;

1621 
	}
}

1623 *
	$bam_aux2Z
(c⁄° 
uöt8_t
 *
s
)

1625 
ty≥
;

1626 
ty≥
 = *
s
++;

1627 i‡(
ty≥
 ='Z' ||Åy≥ ='H'Ë (*)
s
;

1628 
î∫o
 = 
EINVAL
;

1630 
	}
}

1632 
uöt32_t
 
	$bam_auxB_Àn
(c⁄° 
uöt8_t
 *
s
)

1634 i‡(
s
[0] != 'B') {

1635 
î∫o
 = 
EINVAL
;

1638  
	`À_to_u32
(
s
 + 2);

1639 
	}
}

1641 
öt64_t
 
	$bam_auxB2i
(c⁄° 
uöt8_t
 *
s
, 
uöt32_t
 
idx
)

1643 
uöt32_t
 
Àn
 = 
	`bam_auxB_Àn
(
s
);

1644 i‡(
idx
 >
Àn
) {

1645 
î∫o
 = 
ERANGE
;

1648  
	`gë_öt_aux_vÆ
(
s
[1], s + 6, 
idx
);

1649 
	}
}

1651 
	$bam_auxB2f
(c⁄° 
uöt8_t
 *
s
, 
uöt32_t
 
idx
)

1653 
uöt32_t
 
Àn
 = 
	`bam_auxB_Àn
(
s
);

1654 i‡(
idx
 >
Àn
) {

1655 
î∫o
 = 
ERANGE
;

1658 i‡(
s
[1] ='f'Ë 
	`À_to_Êﬂt
(†+ 6 + 4 * 
idx
);

1659  
	`gë_öt_aux_vÆ
(
s
[1], s + 6, 
idx
);

1660 
	}
}

1662 
	$ßm_›í_mode
(*
mode
, c⁄° *
‚
, c⁄° *
f‹m©
)

1665 i‡(
f‹m©
 =
NULL
) {

1667 c⁄° *
ext
 = 
‚
? 
	`°ºchr
(‚, '.'Ë: 
NULL
;

1668 i‡(
ext
 =
NULL
 || 
	`°rchr
(ext, '/'))  -1;

1669  
	`ßm_›í_mode
(
mode
, 
‚
, 
ext
+1);

1671 i‡(
	`°rcmp
(
f‹m©
, "bam"Ë=0Ë
	`°r˝y
(
mode
, "b");

1672 i‡(
	`°rcmp
(
f‹m©
, "¸am"Ë=0Ë
	`°r˝y
(
mode
, "c");

1673 i‡(
	`°rcmp
(
f‹m©
, "ßm"Ë=0Ë
	`°r˝y
(
mode
, "");

1677 
	}
}

1682 *
	$ßm_›í_mode_›ts
(c⁄° *
‚
,

1683 c⁄° *
mode
,

1684 c⁄° *
f‹m©
)

1686 *
mode_›ts
 = 
	`mÆloc
((
f‹m©
 ? 
	`°æí
(format) : 1) +

1687 (
mode
 ? 
	`°æí
(mode) : 1) + 12);

1688 *
›ts
, *
˝
;

1689 
f‹m©_Àn
;

1691 i‡(!
mode_›ts
)

1692  
NULL
;

1694 
	`°r˝y
(
mode_›ts
, 
mode
 ? mode : "r");

1695 
˝
 = 
mode_›ts
 + 
	`°æí
(mode_opts);

1697 i‡(
f‹m©
 =
NULL
) {

1699 c⁄° *
ext
 = 
‚
? 
	`°ºchr
(‚, '.'Ë: 
NULL
;

1700 i‡(
ext
 =
NULL
 || 
	`°rchr
(ext, '/')) {

1701 
	`‰ì
(
mode_›ts
);

1702  
NULL
;

1704  
	`ßm_›í_mode
(
˝
, 
‚
, 
ext
+1)

1705 ? (
	`‰ì
(
mode_›ts
), 
NULL
)

1706 : 
mode_›ts
;

1709 i‡((
›ts
 = 
	`°rchr
(
f‹m©
, ','))) {

1710 
f‹m©_Àn
 = 
›ts
-
f‹m©
;

1712 
›ts
="";

1713 
f‹m©_Àn
 = 
	`°æí
(
f‹m©
);

1716 i‡(
	`°∫cmp
(
f‹m©
, "bam", 
f‹m©_Àn
) == 0) {

1717 *
˝
++ = 'b';

1718 } i‡(
	`°∫cmp
(
f‹m©
, "¸am", 
f‹m©_Àn
) == 0) {

1719 *
˝
++ = 'c';

1720 } i‡(
	`°∫cmp
(
f‹m©
, "¸am2", 
f‹m©_Àn
) == 0) {

1721 *
˝
++ = 'c';

1722 
	`°r˝y
(
˝
, ",VERSION=2.1");

1723 
˝
 += 12;

1724 } i‡(
	`°∫cmp
(
f‹m©
, "¸am3", 
f‹m©_Àn
) == 0) {

1725 *
˝
++ = 'c';

1726 
	`°r˝y
(
˝
, ",VERSION=3.0");

1727 
˝
 += 12;

1728 } i‡(
	`°∫cmp
(
f‹m©
, "ßm", 
f‹m©_Àn
) == 0) {

1731 
	`‰ì
(
mode_›ts
);

1732  
NULL
;

1735 
	`°r˝y
(
˝
, 
›ts
);

1737  
mode_›ts
;

1738 
	}
}

1740 
	#STRNCMP
(
a
,
b
,
n
Ë(
	`°∫ˇ£cmp
(◊),(b),“)Ë|| 
	`°æí
◊)!=“))

	)

1741 
	$bam_°r2Êag
(c⁄° *
°r
)

1743 *
íd
, *
beg
 = (*Ë
°r
;

1744 
Êag
 = 
	`°πﬁ
(
°r
, &
íd
, 0);

1745 i‡–
íd
!=
°r
 )  
Êag
;

1746 
Êag
 = 0;

1747  *
°r
 )

1749 
íd
 = 
beg
;

1750  *
íd
 && *end!=',' )Énd++;

1751 i‡–!
	`STRNCMP
("PAIRED",
beg
,
íd
-begËË
Êag
 |
BAM_FPAIRED
;

1752 i‡–!
	`STRNCMP
("PROPER_PAIR",
beg
,
íd
-begËË
Êag
 |
BAM_FPROPER_PAIR
;

1753 i‡–!
	`STRNCMP
("UNMAP",
beg
,
íd
-begËË
Êag
 |
BAM_FUNMAP
;

1754 i‡–!
	`STRNCMP
("MUNMAP",
beg
,
íd
-begËË
Êag
 |
BAM_FMUNMAP
;

1755 i‡–!
	`STRNCMP
("REVERSE",
beg
,
íd
-begËË
Êag
 |
BAM_FREVERSE
;

1756 i‡–!
	`STRNCMP
("MREVERSE",
beg
,
íd
-begËË
Êag
 |
BAM_FMREVERSE
;

1757 i‡–!
	`STRNCMP
("READ1",
beg
,
íd
-begËË
Êag
 |
BAM_FREAD1
;

1758 i‡–!
	`STRNCMP
("READ2",
beg
,
íd
-begËË
Êag
 |
BAM_FREAD2
;

1759 i‡–!
	`STRNCMP
("SECONDARY",
beg
,
íd
-begËË
Êag
 |
BAM_FSECONDARY
;

1760 i‡–!
	`STRNCMP
("QCFAIL",
beg
,
íd
-begËË
Êag
 |
BAM_FQCFAIL
;

1761 i‡–!
	`STRNCMP
("DUP",
beg
,
íd
-begËË
Êag
 |
BAM_FDUP
;

1762 i‡–!
	`STRNCMP
("SUPPLEMENTARY",
beg
,
íd
-begËË
Êag
 |
BAM_FSUPPLEMENTARY
;

1764 i‡–!*
íd
 ) ;

1765 
beg
 = 
íd
 + 1;

1767  
Êag
;

1768 
	}
}

1770 *
	$bam_Êag2°r
(
Êag
)

1772 
k°rög_t
 
°r
 = {0,0,0};

1773 i‡–
Êag
&
BAM_FPAIRED
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","PAIRED");

1774 i‡–
Êag
&
BAM_FPROPER_PAIR
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","PROPER_PAIR");

1775 i‡–
Êag
&
BAM_FUNMAP
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","UNMAP");

1776 i‡–
Êag
&
BAM_FMUNMAP
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","MUNMAP");

1777 i‡–
Êag
&
BAM_FREVERSE
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","REVERSE");

1778 i‡–
Êag
&
BAM_FMREVERSE
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","MREVERSE");

1779 i‡–
Êag
&
BAM_FREAD1
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","READ1");

1780 i‡–
Êag
&
BAM_FREAD2
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","READ2");

1781 i‡–
Êag
&
BAM_FSECONDARY
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","SECONDARY");

1782 i‡–
Êag
&
BAM_FQCFAIL
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","QCFAIL");

1783 i‡–
Êag
&
BAM_FDUP
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","DUP");

1784 i‡–
Êag
&
BAM_FSUPPLEMENTARY
 ) 
	`k•rötf
(&
°r
,"%s%s", så.
l
?",":"","SUPPLEMENTARY");

1785 i‡–
°r
.
l
 =0 ) 
	`kput¢
("", 0, &str);

1786  
°r
.
s
;

1787 
	}
}

1794 #i‡!
deföed
(
BAM_NO_PILEUP
)

1796 
	~<as£π.h
>

1803 
	mk
, 
	mx
, 
	my
, 
	míd
;

1804 } 
	tc°©e_t
;

1806 
c°©e_t
 
	gg_c°©e_nuŒ
 = { -1, 0, 0, 0 };

1808 
	s__lökbuf_t
 {

1809 
bam1_t
 
	mb
;

1810 
öt32_t
 
	mbeg
, 
	míd
;

1811 
c°©e_t
 
	ms
;

1812 
__lökbuf_t
 *
	m√xt
;

1813 
bam_pûeup_cd
 
	mcd
;

1814 } 
	tlbnode_t
;

1817 
	m˙t
, 
	mn
, 
	mmax
;

1818 
lbnode_t
 **
	mbuf
;

1819 } 
	tmempoﬁ_t
;

1821 
mempoﬁ_t
 *
	$mp_öô
()

1823 
mempoﬁ_t
 *
mp
;

1824 
mp
 = (
mempoﬁ_t
*)
	`ˇŒoc
(1, (mempool_t));

1825  
mp
;

1826 
	}
}

1827 
	$mp_de°roy
(
mempoﬁ_t
 *
mp
)

1829 
k
;

1830 
k
 = 0; k < 
mp
->
n
; ++k) {

1831 
	`‰ì
(
mp
->
buf
[
k
]->
b
.
d©a
);

1832 
	`‰ì
(
mp
->
buf
[
k
]);

1834 
	`‰ì
(
mp
->
buf
);

1835 
	`‰ì
(
mp
);

1836 
	}
}

1837 
ölöe
 
lbnode_t
 *
	$mp_Æloc
(
mempoﬁ_t
 *
mp
)

1839 ++
mp
->
˙t
;

1840 i‡(
mp
->
n
 =0Ë (
lbnode_t
*)
	`ˇŒoc
(1, (lbnode_t));

1841  
mp
->
buf
[--mp->
n
];

1842 
	}
}

1843 
ölöe
 
	$mp_‰ì
(
mempoﬁ_t
 *
mp
, 
lbnode_t
 *
p
)

1845 --
mp
->
˙t
; 
p
->
√xt
 = 0;

1846 i‡(
mp
->
n
 =mp->
max
) {

1847 
mp
->
max
 = mp->max? mp->max<<1 : 256;

1848 
mp
->
buf
 = (
lbnode_t
**)
	`ªÆloc
(mp->buf, ÷bnode_t*Ë* mp->
max
);

1850 
mp
->
buf
[mp->
n
++] = 
p
;

1851 
	}
}

1861 
ölöe
 
	$ªsﬁve_cig¨2
(
bam_pûeup1_t
 *
p
, 
öt32_t
 
pos
, 
c°©e_t
 *
s
)

1863 
	#_c›
(
c
Ë((c)&
BAM_CIGAR_MASK
)

	)

1864 
	#_˛n
(
c
Ë((c)>>
BAM_CIGAR_SHIFT
)

	)

1866 
bam1_t
 *
b
 = 
p
->b;

1867 
bam1_c‹e_t
 *
c
 = &
b
->
c‹e
;

1868 
uöt32_t
 *
cig¨
 = 
	`bam_gë_cig¨
(
b
);

1869 
k
;

1872 i‡(
s
->
k
 == -1) {

1873 i‡(
c
->
n_cig¨
 == 1) {

1874 i‡(
	`_c›
(
cig¨
[0]Ë=
BAM_CMATCH
 || _c›(cig¨[0]Ë=
BAM_CEQUAL
 || _c›(cig¨[0]Ë=
BAM_CDIFF
Ë
s
->
k
 = 0, s->
x
 = 
c
->
pos
, s->
y
 = 0;

1876 
k
 = 0, 
s
->
x
 = 
c
->
pos
, s->
y
 = 0; k < c->
n_cig¨
; ++k) {

1877 
›
 = 
	`_c›
(
cig¨
[
k
]);

1878 
l
 = 
	`_˛n
(
cig¨
[
k
]);

1879 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CDEL
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) ;

1880 i‡(
›
 =
BAM_CREF_SKIP
Ë
s
->
x
 +
l
;

1881 i‡(
›
 =
BAM_CINS
 || o∞=
BAM_CSOFT_CLIP
Ë
s
->
y
 +
l
;

1883 
	`as£π
(
k
 < 
c
->
n_cig¨
);

1884 
s
->
k
 = k;

1887 
›
, 
l
 = 
	`_˛n
(
cig¨
[
s
->
k
]);

1888 i‡(
pos
 - 
s
->
x
 >
l
) {

1889 
	`as£π
(
s
->
k
 < 
c
->
n_cig¨
);

1890 
›
 = 
	`_c›
(
cig¨
[
s
->
k
+1]);

1891 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CDEL
 || o∞=
BAM_CREF_SKIP
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) {

1892 i‡(
	`_c›
(
cig¨
[
s
->
k
]Ë=
BAM_CMATCH
|| _c›(cig¨[s->k]Ë=
BAM_CEQUAL
 || _c›(cig¨[s->k]Ë=
BAM_CDIFF
Ës->
y
 +
l
;

1893 
s
->
x
 +
l
;

1894 ++
s
->
k
;

1896 i‡(
	`_c›
(
cig¨
[
s
->
k
]Ë=
BAM_CMATCH
|| _c›(cig¨[s->k]Ë=
BAM_CEQUAL
 || _c›(cig¨[s->k]Ë=
BAM_CDIFF
Ës->
y
 +
l
;

1897 
s
->
x
 +
l
;

1898 
k
 = 
s
->k + 1; k < 
c
->
n_cig¨
; ++k) {

1899 
›
 = 
	`_c›
(
cig¨
[
k
]), 
l
 = 
	`_˛n
(cigar[k]);

1900 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CDEL
 || o∞=
BAM_CREF_SKIP
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) ;

1901 i‡(
›
 =
BAM_CINS
 || o∞=
BAM_CSOFT_CLIP
Ë
s
->
y
 +
l
;

1903 
s
->
k
 = k;

1905 
	`as£π
(
s
->
k
 < 
c
->
n_cig¨
);

1909 
›
, 
l
;

1910 
›
 = 
	`_c›
(
cig¨
[
s
->
k
]); 
l
 = 
	`_˛n
(cigar[s->k]);

1911 
p
->
is_dñ
 =Ö->
ödñ
 =Ö->
is_ªfskù
 = 0;

1912 i‡(
s
->
x
 + 
l
 - 1 =
pos
 && s->
k
 + 1 < 
c
->
n_cig¨
) {

1913 
›2
 = 
	`_c›
(
cig¨
[
s
->
k
+1]);

1914 
l2
 = 
	`_˛n
(
cig¨
[
s
->
k
+1]);

1915 i‡(
›2
 =
BAM_CDEL
Ë
p
->
ödñ
 = -()
l2
;

1916 i‡(
›2
 =
BAM_CINS
Ë
p
->
ödñ
 = 
l2
;

1917 i‡(
›2
 =
BAM_CPAD
 && 
s
->
k
 + 2 < 
c
->
n_cig¨
) {

1918 
l3
 = 0;

1919 
k
 = 
s
->k + 2; k < 
c
->
n_cig¨
; ++k) {

1920 
›2
 = 
	`_c›
(
cig¨
[
k
]); 
l2
 = 
	`_˛n
(cigar[k]);

1921 i‡(
›2
 =
BAM_CINS
Ë
l3
 +
l2
;

1922 i‡(
›2
 =
BAM_CDEL
 || op2 =
BAM_CMATCH
 || op2 =
BAM_CREF_SKIP
 || op2 =
BAM_CEQUAL
 || op2 =
BAM_CDIFF
) ;

1924 i‡(
l3
 > 0Ë
p
->
ödñ
 =Ü3;

1927 i‡(
›
 =
BAM_CMATCH
 || o∞=
BAM_CEQUAL
 || o∞=
BAM_CDIFF
) {

1928 
p
->
qpos
 = 
s
->
y
 + (
pos
 - s->
x
);

1929 } i‡(
›
 =
BAM_CDEL
 || o∞=
BAM_CREF_SKIP
) {

1930 
p
->
is_dñ
 = 1;Ö->
qpos
 = 
s
->
y
;

1931 
p
->
is_ªfskù
 = (
›
 =
BAM_CREF_SKIP
);

1933 
p
->
is_hód
 = (
pos
 =
c
->pos);Ö->
is_èû
 = (po†=
s
->
íd
);

1936 
	}
}

1943 
	$KHASH_MAP_INIT_STR
(
ﬁ≠_hash
, 
lbnode_t
 *)

1944 
	$khash_t
(
	tﬁ≠_hash
Ë
	tﬁ≠_hash_t
;

1946 
	s__bam_∂p_t
 {

1947 
mempoﬁ_t
 *
mp
;

1948 
lbnode_t
 *
hód
, *
èû
;

1949 
öt32_t
 
tid
, 
pos
, 
max_tid
, 
max_pos
;

1950 
is_eof
, 
max_∂p
, 
îr‹
, 
max˙t
;

1951 
uöt64_t
 
id
;

1952 
bam_pûeup1_t
 *
∂p
;

1954 
bam1_t
 *
b
;

1955 
bam_∂p_auto_f
 
func
;

1956 *
d©a
;

1957 
ﬁ≠_hash_t
 *
ovîœps
;

1961 (*
∂p_c⁄°ru˘
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
);

1962 (*
∂p_de°ru˘
 )(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
);

1965 
bam_∂p_t
 
	$bam_∂p_öô
(
bam_∂p_auto_f
 
func
, *
d©a
)

1967 
bam_∂p_t
 
ôî
;

1968 
ôî
 = (
bam_∂p_t
)
	`ˇŒoc
(1, (
__bam_∂p_t
));

1969 
ôî
->
mp
 = 
	`mp_öô
();

1970 
ôî
->
hód
 = iãr->
èû
 = 
	`mp_Æloc
(ôî->
mp
);

1971 
ôî
->
max_tid
 = iãr->
max_pos
 = -1;

1972 
ôî
->
max˙t
 = 8000;

1973 i‡(
func
) {

1974 
ôî
->
func
 = func;

1975 
ôî
->
d©a
 = data;

1976 
ôî
->
b
 = 
	`bam_öô1
();

1978  
ôî
;

1979 
	}
}

1981 
	$bam_∂p_öô_ovîœps
(
bam_∂p_t
 
ôî
)

1983 
ôî
->
ovîœps
 = 
	`kh_öô
(
ﬁ≠_hash
);

1984 
	}
}

1986 
	$bam_∂p_de°roy
(
bam_∂p_t
 
ôî
)

1988 
lbnode_t
 *
p
, *
≤ext
;

1989 i‡–
ôî
->
ovîœps
 ) 
	`kh_de°roy
(
ﬁ≠_hash
, iter->overlaps);

1990 
p
 = 
ôî
->
hód
;Ö !
NULL
;Ö = 
≤ext
) {

1991 
≤ext
 = 
p
->
√xt
;

1992 
	`mp_‰ì
(
ôî
->
mp
, 
p
);

1994 
	`mp_de°roy
(
ôî
->
mp
);

1995 i‡(
ôî
->
b
Ë
	`bam_de°roy1
(iter->b);

1996 
	`‰ì
(
ôî
->
∂p
);

1997 
	`‰ì
(
ôî
);

1998 
	}
}

2000 
	$bam_∂p_c⁄°ru˘‹
(
bam_∂p_t
 
∂p
,

2001 (*
func
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
)) {

2002 
∂p
->
∂p_c⁄°ru˘
 = 
func
;

2003 
	}
}

2005 
	$bam_∂p_de°ru˘‹
(
bam_∂p_t
 
∂p
,

2006 (*
func
)(*
d©a
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
)) {

2007 
∂p
->
∂p_de°ru˘
 = 
func
;

2008 
	}
}

2025 
ölöe
 
	$cig¨_úef2i£q_£t
(
uöt32_t
 **
cig¨
, uöt32_à*
cig¨_max
, *
icig
, *
i£q
, *
úef
)

2027 
pos
 = *
úef
;

2028 i‡–
pos
 < 0 )  -1;

2029 *
icig
 = 0;

2030 *
i£q
 = 0;

2031 *
úef
 = 0;

2032  *
cig¨
<
cig¨_max
 )

2034 
cig
 = (**
cig¨
Ë& 
BAM_CIGAR_MASK
;

2035 
ncig
 = (**
cig¨
Ë>> 
BAM_CIGAR_SHIFT
;

2037 i‡–
cig
==
BAM_CSOFT_CLIP
 ) { (*
cig¨
)++; *
i£q
 +
ncig
; *
icig
 = 0; ; }

2038 i‡–
cig
==
BAM_CHARD_CLIP
 || cig==
BAM_CPAD
 ) { (*
cig¨
)++; *
icig
 = 0; ; }

2039 i‡–
cig
==
BAM_CMATCH
 || cig==
BAM_CEQUAL
 || cig==
BAM_CDIFF
 )

2041 
pos
 -
ncig
;

2042 i‡–
pos
 < 0 ) { *
icig
 = 
ncig
 +Öos; *
i£q
 +*icig; *
úef
 +*icig;  
BAM_CMATCH
; }

2043 (*
cig¨
)++; *
i£q
 +
ncig
; *
icig
 = 0; *
úef
 +=Çcig;

2046 i‡–
cig
==
BAM_CINS
 ) { (*
cig¨
)++; *
i£q
 +
ncig
; *
icig
 = 0; ; }

2047 i‡–
cig
==
BAM_CDEL
 || cig==
BAM_CREF_SKIP
 )

2049 
pos
 -
ncig
;

2050 i‡–
pos
<0 )Öos = 0;

2051 (*
cig¨
)++; *
icig
 = 0; *
úef
 +
ncig
;

2054 
	`Ârötf
(
°dîr
,"todo: cig¨ %d\n", 
cig
);

2055 
	`as£π
(0);

2057 *
i£q
 = -1;

2059 
	}
}

2060 
ölöe
 
	$cig¨_úef2i£q_√xt
(
uöt32_t
 **
cig¨
, uöt32_à*
cig¨_max
, *
icig
, *
i£q
, *
úef
)

2062  *
cig¨
 < 
cig¨_max
 )

2064 
cig
 = (**
cig¨
Ë& 
BAM_CIGAR_MASK
;

2065 
ncig
 = (**
cig¨
Ë>> 
BAM_CIGAR_SHIFT
;

2067 i‡–
cig
==
BAM_CMATCH
 || cig==
BAM_CEQUAL
 || cig==
BAM_CDIFF
 )

2069 i‡–*
icig
 >
ncig
 - 1 ) { *icig = 0; (*
cig¨
)++; ; }

2070 (*
i£q
)++; (*
icig
)++; (*
úef
)++;

2071  
BAM_CMATCH
;

2073 i‡–
cig
==
BAM_CDEL
 || cig==
BAM_CREF_SKIP
 ) { (*
cig¨
)++; (*
úef
Ë+
ncig
; *
icig
 = 0; ; }

2074 i‡–
cig
==
BAM_CINS
 ) { (*
cig¨
)++; *
i£q
 +
ncig
; *
icig
 = 0; ; }

2075 i‡–
cig
==
BAM_CSOFT_CLIP
 ) { (*
cig¨
)++; *
i£q
 +
ncig
; *
icig
 = 0; ; }

2076 i‡–
cig
==
BAM_CHARD_CLIP
 || cig==
BAM_CPAD
 ) { (*
cig¨
)++; *
icig
 = 0; ; }

2077 
	`Ârötf
(
°dîr
,"todo: cig¨ %d\n", 
cig
);

2078 
	`as£π
(0);

2080 *
i£q
 = -1;

2081 *
úef
 = -1;

2083 
	}
}

2085 
	$twók_ovîœp_quÆôy
(
bam1_t
 *
a
, bam1_à*
b
)

2087 
uöt32_t
 *
a_cig¨
 = 
	`bam_gë_cig¨
(
a
), *
a_cig¨_max
 =á_cig¨ +á->
c‹e
.
n_cig¨
;

2088 
uöt32_t
 *
b_cig¨
 = 
	`bam_gë_cig¨
(
b
), *
b_cig¨_max
 = b_cig¨ + b->
c‹e
.
n_cig¨
;

2089 
a_icig
 = 0, 
a_i£q
 = 0;

2090 
b_icig
 = 0, 
b_i£q
 = 0;

2091 
uöt8_t
 *
a_quÆ
 = 
	`bam_gë_quÆ
(
a
), *
b_quÆ
 = bam_gë_quÆ(
b
);

2092 
uöt8_t
 *
a_£q
 = 
	`bam_gë_£q
(
a
), *
b_£q
 = bam_gë_£q(
b
);

2094 
úef
 = 
b
->
c‹e
.
pos
;

2095 
a_úef
 = 
úef
 - 
a
->
c‹e
.
pos
;

2096 
b_úef
 = 
úef
 - 
b
->
c‹e
.
pos
;

2097 
a_ªt
 = 
	`cig¨_úef2i£q_£t
(&
a_cig¨
, 
a_cig¨_max
, &
a_icig
, &
a_i£q
, &
a_úef
);

2098 i‡–
a_ªt
<0 ) ;

2099 
b_ªt
 = 
	`cig¨_úef2i£q_£t
(&
b_cig¨
, 
b_cig¨_max
, &
b_icig
, &
b_i£q
, &
b_úef
);

2100 i‡–
b_ªt
<0 ) ;

2102 #i‡
DBG


2103 
	`Ârötf
(
°dîr
,"twók %†Ç_cig¨=%d %d .. %d-%d v†%d-%d\n", 
	`bam_gë_q«me
(
a
),á->
c‹e
.
n_cig¨
, 
b
->core.n_cigar,

2104 
a
->
c‹e
.
pos
+1,a->c‹e.pos+
	`bam_cig¨2æí
◊->c‹e.
n_cig¨
,
	`bam_gë_cig¨
◊)), 
b
->core.pos+1, b->core.pos+bam_cigar2rlen(b->core.n_cigar,bam_get_cigar(b)));

2110  
a_úef
>=0 &&á_úe‡< 
úef
 - 
a
->
c‹e
.
pos
 )

2111 
a_ªt
 = 
	`cig¨_úef2i£q_√xt
(&
a_cig¨
, 
a_cig¨_max
, &
a_icig
, &
a_i£q
, &
a_úef
);

2112 i‡–
a_ªt
<0 ) ;

2113 i‡–
úef
 < 
a_úef
 + 
a
->
c‹e
.
pos
 ) iref =á_iref +á->core.pos;

2115  
b_úef
>=0 && b_úe‡< 
úef
 - 
b
->
c‹e
.
pos
 )

2116 
b_ªt
 = 
	`cig¨_úef2i£q_√xt
(&
b_cig¨
, 
b_cig¨_max
, &
b_icig
, &
b_i£q
, &
b_úef
);

2117 i‡–
b_ªt
<0 ) ;

2118 i‡–
úef
 < 
b_úef
 + 
b
->
c‹e
.
pos
 ) iref = b_iref + b->core.pos;

2120 
úef
++;

2121 i‡–
a_úef
+
a
->
c‹e
.
pos
 !
b_úef
+
b
->core.pos ) ;

2123 i‡–
	`bam_£qi
(
a_£q
,
a_i£q
Ë=bam_£qi(
b_£q
,
b_i£q
) )

2125 #i‡
DBG


2126 
	`Ârötf
(
°dîr
,"%c",
£q_¡16_°r
[
	`bam_£qi
(
a_£q
,
a_i£q
)]);

2129 
quÆ
 = 
a_quÆ
[
a_i£q
] + 
b_quÆ
[
b_i£q
];

2130 
a_quÆ
[
a_i£q
] = 
quÆ
>200 ? 200 : qual;

2131 
b_quÆ
[
b_i£q
] = 0;

2135 i‡–
a_quÆ
[
a_i£q
] >
b_quÆ
[
b_i£q
] )

2137 #i‡
DBG


2138 
	`Ârötf
(
°dîr
,"[%c/%c]",
£q_¡16_°r
[
	`bam_£qi
(
a_£q
,
a_i£q
)],
	`tﬁowî_c
(£q_¡16_°r[bam_£qi(
b_£q
,
b_i£q
)]));

2140 
a_quÆ
[
a_i£q
] = 0.8 *á_qual[a_iseq];

2141 
b_quÆ
[
b_i£q
] = 0;

2145 #i‡
DBG


2146 
	`Ârötf
(
°dîr
,"[%c/%c]",
	`tﬁowî_c
(
£q_¡16_°r
[
	`bam_£qi
(
a_£q
,
a_i£q
)]),£q_¡16_°r[bam_£qi(
b_£q
,
b_i£q
)]);

2148 
b_quÆ
[
b_i£q
] = 0.8 * b_qual[b_iseq];

2149 
a_quÆ
[
a_i£q
] = 0;

2153 #i‡
DBG


2154 
	`Ârötf
(
°dîr
,"\n");

2156 
	}
}

2161 
	$ovîœp_push
(
bam_∂p_t
 
ôî
, 
lbnode_t
 *
node
)

2163 i‡–!
ôî
->
ovîœps
 ) ;

2166 i‡–
node
->
b
.
c‹e
.
Êag
&
BAM_FMUNMAP
 || !“ode->b.c‹e.Êag&
BAM_FPROPER_PAIR
) ) ;

2169 i‡–
	`abs
(
node
->
b
.
c‹e
.
isize
Ë>2*node->b.c‹e.
l_q£q
 ) ;

2171 
khôî_t
 
kôr
 = 
	`kh_gë
(
ﬁ≠_hash
, 
ôî
->
ovîœps
, 
	`bam_gë_q«me
(&
node
->
b
));

2172 i‡–
kôr
==
	`kh_íd
(
ôî
->
ovîœps
) )

2174 
ªt
;

2175 
kôr
 = 
	`kh_put
(
ﬁ≠_hash
, 
ôî
->
ovîœps
, 
	`bam_gë_q«me
(&
node
->
b
), &
ªt
);

2176 
	`kh_vÆue
(
ôî
->
ovîœps
, 
kôr
Ë
node
;

2180 
lbnode_t
 *
a
 = 
	`kh_vÆue
(
ôî
->
ovîœps
, 
kôr
);

2181 
	`twók_ovîœp_quÆôy
(&
a
->
b
, &
node
->b);

2182 
	`kh_dñ
(
ﬁ≠_hash
, 
ôî
->
ovîœps
, 
kôr
);

2183 
	`as£π
(
a
->
íd
-1 =a->
s
.end);

2184 
a
->
íd
 = 
	`bam_ídpos
(&a->
b
);

2185 
a
->
s
.
íd
 =á->end - 1;

2187 
	}
}

2189 
	$ovîœp_ªmove
(
bam_∂p_t
 
ôî
, c⁄° 
bam1_t
 *
b
)

2191 i‡–!
ôî
->
ovîœps
 ) ;

2193 
khôî_t
 
kôr
;

2194 i‡–
b
 )

2196 
kôr
 = 
	`kh_gë
(
ﬁ≠_hash
, 
ôî
->
ovîœps
, 
	`bam_gë_q«me
(
b
));

2197 i‡–
kôr
!=
	`kh_íd
(
ôî
->
ovîœps
) )

2198 
	`kh_dñ
(
ﬁ≠_hash
, 
ôî
->
ovîœps
, 
kôr
);

2203 
kôr
 = 
	`kh_begö
(
ôî
->
ovîœps
); kôr<
	`kh_íd
(iter->overlaps); kitr++)

2204 i‡–
	`kh_exi°
(
ôî
->
ovîœps
, 
kôr
ËË
	`kh_dñ
(
ﬁ≠_hash
, iter->overlaps, kitr);

2206 
	}
}

2213 c⁄° 
bam_pûeup1_t
 *
	$bam_∂p_√xt
(
bam_∂p_t
 
ôî
, *
_tid
, *
_pos
, *
_n_∂p
)

2215 i‡(
ôî
->
îr‹
Ë{ *
_n_∂p
 = -1;  
NULL
; }

2216 *
_n_∂p
 = 0;

2217 i‡(
ôî
->
is_eof
 && iãr->
hód
 =ôî->
èû
Ë 
NULL
;

2218 
ôî
->
is_eof
 || iãr->
max_tid
 > iãr->
tid
 || (ôî->max_tid =ôî->tid && iãr->
max_pos
 > iãr->
pos
)) {

2219 
n_∂p
 = 0;

2221 
lbnode_t
 **
µå
 = &
ôî
->
hód
;

2222 *
µå
 !
ôî
->
èû
) {

2223 
lbnode_t
 *
p
 = *
µå
;

2224 i‡(
p
->
b
.
c‹e
.
tid
 < 
ôî
->tid || (p->b.c‹e.tid =ôî->tid &&Ö->
íd
 <ôî->
pos
)) {

2225 
	`ovîœp_ªmove
(
ôî
, &
p
->
b
);

2226 i‡(
ôî
->
∂p_de°ru˘
)

2227 
ôî
->
	`∂p_de°ru˘
(ôî->
d©a
, &
p
->
b
, &p->
cd
);

2228 *
µå
 = 
p
->
√xt
; 
	`mp_‰ì
(
ôî
->
mp
,Ö);

2231 i‡(
p
->
b
.
c‹e
.
tid
 =
ôî
->tid &&Ö->
beg
 <ôî->
pos
) {

2232 i‡(
n_∂p
 =
ôî
->
max_∂p
) {

2233 
ôî
->
max_∂p
 = iter->max_plp? iter->max_plp<<1 : 256;

2234 
ôî
->
∂p
 = (
bam_pûeup1_t
*)
	`ªÆloc
(ôî->∂p, (bam_pûeup1_tË* iãr->
max_∂p
);

2236 
ôî
->
∂p
[
n_∂p
].
b
 = &
p
->b;

2237 
ôî
->
∂p
[
n_∂p
].
cd
 = 
p
->cd;

2238 i‡(
	`ªsﬁve_cig¨2
(
ôî
->
∂p
 + 
n_∂p
, iãr->
pos
, &
p
->
s
)) ++n_plp;

2240 
µå
 = &(*µå)->
√xt
;

2243 *
_n_∂p
 = 
n_∂p
; *
_tid
 = 
ôî
->
tid
; *
_pos
 = iãr->
pos
;

2245 i‡(
ôî
->
hód
 !ôî->
èû
) {

2246 i‡(
ôî
->
tid
 > iãr->
hód
->
b
.
c‹e
.tid) {

2247 
	`Ârötf
(
°dîr
, "[%s] uns‹ãd i≈ut. Pûeu∞ab‹ts.\n", 
__func__
);

2248 
ôî
->
îr‹
 = 1;

2249 *
_n_∂p
 = -1;

2250  
NULL
;

2253 i‡(
ôî
->
tid
 < iãr->
hód
->
b
.
c‹e
.tid) {

2254 
ôî
->
tid
 = iãr->
hód
->
b
.
c‹e
.tid; iãr->
pos
 = iãr->hód->
beg
;

2255 } i‡(
ôî
->
pos
 < iãr->
hód
->
beg
) {

2256 
ôî
->
pos
 = iãr->
hód
->
beg
;

2257 } ++
ôî
->
pos
;

2259 i‡(
n_∂p
Ë 
ôî
->
∂p
;

2260 i‡(
ôî
->
is_eof
 && iãr->
hód
 =ôî->
èû
) ;

2262  
NULL
;

2263 
	}
}

2265 
	$bam_∂p_push
(
bam_∂p_t
 
ôî
, c⁄° 
bam1_t
 *
b
)

2267 i‡(
ôî
->
îr‹
)  -1;

2268 i‡(
b
) {

2269 i‡(
b
->
c‹e
.
tid
 < 0Ë{ 
	`ovîœp_ªmove
(
ôî
, b);  0; }

2271 i‡(
b
->
c‹e
.
Êag
 & 
BAM_FUNMAP
Ë{ 
	`ovîœp_ªmove
(
ôî
, b);  0; }

2272 i‡(
ôî
->
tid
 =
b
->
c‹e
.tid && iãr->
pos
 =b->c‹e.po†&& iãr->
mp
->
˙t
 > iãr->
max˙t
)

2274 
	`ovîœp_ªmove
(
ôî
, 
b
);

2277 
	`bam_c›y1
(&
ôî
->
èû
->
b
, b);

2278 
	`ovîœp_push
(
ôî
, iãr->
èû
);

2279 #i‚de‡
BAM_NO_ID


2280 
ôî
->
èû
->
b
.
id
 = iter->id++;

2282 
ôî
->
èû
->
beg
 = 
b
->
c‹e
.
pos
;

2283 
ôî
->
èû
->
íd
 = 
	`bam_ídpos
(
b
);

2284 
ôî
->
èû
->
s
 = 
g_c°©e_nuŒ
; iãr->èû->s.
íd
 = iter->tail->end - 1;

2285 i‡(
b
->
c‹e
.
tid
 < 
ôî
->
max_tid
) {

2286 
	`Ârötf
(
°dîr
, "[bam_pileup_core]Åhe input isÇot sorted (chromosomes out of order)\n");

2287 
ôî
->
îr‹
 = 1;

2290 i‡((
b
->
c‹e
.
tid
 =
ôî
->
max_tid
Ë&& (ôî->
èû
->
beg
 < iãr->
max_pos
)) {

2291 
	`Ârötf
(
°dîr
, "[bam_pileup_core]Åhe input isÇot sorted (reads out of order)\n");

2292 
ôî
->
îr‹
 = 1;

2295 
ôî
->
max_tid
 = 
b
->
c‹e
.
tid
; iãr->
max_pos
 = iãr->
èû
->
beg
;

2296 i‡(
ôî
->
èû
->
íd
 > iãr->
pos
 || iãr->èû->
b
.
c‹e
.
tid
 > iter->tid) {

2297 i‡(
ôî
->
∂p_c⁄°ru˘
)

2298 
ôî
->
	`∂p_c⁄°ru˘
(ôî->
d©a
, 
b
, &ôî->
èû
->
cd
);

2299 
ôî
->
èû
->
√xt
 = 
	`mp_Æloc
(ôî->
mp
);

2300 
ôî
->
èû
 = iãr->èû->
√xt
;

2302 } 
ôî
->
is_eof
 = 1;

2304 
	}
}

2306 c⁄° 
bam_pûeup1_t
 *
	$bam_∂p_auto
(
bam_∂p_t
 
ôî
, *
_tid
, *
_pos
, *
_n_∂p
)

2308 c⁄° 
bam_pûeup1_t
 *
∂p
;

2309 i‡(
ôî
->
func
 =0 || iãr->
îr‹
Ë{ *
_n_∂p
 = -1;  0; }

2310 i‡((
∂p
 = 
	`bam_∂p_√xt
(
ôî
, 
_tid
, 
_pos
, 
_n_∂p
)) != 0) Ölp;

2312 *
_n_∂p
 = 0;

2313 i‡(
ôî
->
is_eof
)  0;

2314 
ªt
;

2315  (
ªt
=
ôî
->
	`func
(ôî->
d©a
, iãr->
b
)) >= 0) {

2316 i‡(
	`bam_∂p_push
(
ôî
, iãr->
b
) < 0) {

2317 *
_n_∂p
 = -1;

2320 i‡((
∂p
 = 
	`bam_∂p_√xt
(
ôî
, 
_tid
, 
_pos
, 
_n_∂p
)) != 0) Ölp;

2323 i‡–
ªt
 < -1 ) { 
ôî
->
îr‹
 =Ñë; *
_n_∂p
 = -1;  0; }

2324 
	`bam_∂p_push
(
ôî
, 0);

2325 i‡((
∂p
 = 
	`bam_∂p_√xt
(
ôî
, 
_tid
, 
_pos
, 
_n_∂p
)) != 0) Ölp;

2328 
	}
}

2330 
	$bam_∂p_ª£t
(
bam_∂p_t
 
ôî
)

2332 
	`ovîœp_ªmove
(
ôî
, 
NULL
);

2333 
ôî
->
max_tid
 = iãr->
max_pos
 = -1;

2334 
ôî
->
tid
 = iãr->
pos
 = 0;

2335 
ôî
->
is_eof
 = 0;

2336 
ôî
->
hód
 !ôî->
èû
) {

2337 
lbnode_t
 *
p
 = 
ôî
->
hód
;

2338 
ôî
->
hód
 = 
p
->
√xt
;

2339 
	`mp_‰ì
(
ôî
->
mp
, 
p
);

2341 
	}
}

2343 
	$bam_∂p_£t_max˙t
(
bam_∂p_t
 
ôî
, 
max˙t
)

2345 
ôî
->
max˙t
 = maxcnt;

2346 
	}
}

2352 
	s__bam_m∂p_t
 {

2353 
	mn
;

2354 
uöt64_t
 
	mmö
, *
	mpos
;

2355 
bam_∂p_t
 *
	môî
;

2356 *
	mn_∂p
;

2357 c⁄° 
bam_pûeup1_t
 **
	m∂p
;

2360 
bam_m∂p_t
 
	$bam_m∂p_öô
(
n
, 
bam_∂p_auto_f
 
func
, **
d©a
)

2362 
i
;

2363 
bam_m∂p_t
 
ôî
;

2364 
ôî
 = (
bam_m∂p_t
)
	`ˇŒoc
(1, (
__bam_m∂p_t
));

2365 
ôî
->
pos
 = (
uöt64_t
*)
	`ˇŒoc
(
n
, (uint64_t));

2366 
ôî
->
n_∂p
 = (*)
	`ˇŒoc
(
n
, ());

2367 
ôî
->
∂p
 = (c⁄° 
bam_pûeup1_t
**)
	`ˇŒoc
(
n
, (bam_pileup1_t*));

2368 
ôî
->ôî = (
bam_∂p_t
*)
	`ˇŒoc
(
n
, (bam_plp_t));

2369 
ôî
->
n
 =Ç;

2370 
ôî
->
mö
 = (
uöt64_t
)-1;

2371 
i
 = 0; i < 
n
; ++i) {

2372 
ôî
->ôî[
i
] = 
	`bam_∂p_öô
(
func
, 
d©a
[i]);

2373 
ôî
->
pos
[
i
] = iãr->
mö
;

2375  
ôî
;

2376 
	}
}

2378 
	$bam_m∂p_öô_ovîœps
(
bam_m∂p_t
 
ôî
)

2380 
i
;

2381 
i
 = 0; i < 
ôî
->
n
; ++i)

2382 
	`bam_∂p_öô_ovîœps
(
ôî
->ôî[
i
]);

2383 
	}
}

2385 
	$bam_m∂p_£t_max˙t
(
bam_m∂p_t
 
ôî
, 
max˙t
)

2387 
i
;

2388 
i
 = 0; i < 
ôî
->
n
; ++i)

2389 
ôî
->ôî[
i
]->
max˙t
 = maxcnt;

2390 
	}
}

2392 
	$bam_m∂p_de°roy
(
bam_m∂p_t
 
ôî
)

2394 
i
;

2395 
i
 = 0; i < 
ôî
->
n
; ++iË
	`bam_∂p_de°roy
(iter->iter[i]);

2396 
	`‰ì
(
ôî
->ôî); fªe(ôî->
pos
); fªe(ôî->
n_∂p
); fªe(ôî->
∂p
);

2397 
	`‰ì
(
ôî
);

2398 
	}
}

2400 
	$bam_m∂p_auto
(
bam_m∂p_t
 
ôî
, *
_tid
, *
_pos
, *
n_∂p
, c⁄° 
bam_pûeup1_t
 **
∂p
)

2402 
i
, 
ªt
 = 0;

2403 
uöt64_t
 
√w_mö
 = (uint64_t)-1;

2404 
i
 = 0; i < 
ôî
->
n
; ++i) {

2405 i‡(
ôî
->
pos
[
i
] =ôî->
mö
) {

2406 
tid
, 
pos
;

2407 
ôî
->
∂p
[
i
] = 
	`bam_∂p_auto
(ôî->ôî[i], &
tid
, &
pos
, &ôî->
n_∂p
[i]);

2408 i‡–
ôî
->ôî[
i
]->
îr‹
 )  -1;

2409 
ôî
->
pos
[
i
] = iãr->
∂p
[i] ? (
uöt64_t
)
tid
<<32 |Öos : 0;

2411 i‡(
ôî
->
∂p
[
i
] && iãr->
pos
[i] < 
√w_mö
)Çew_min = iter->pos[i];

2413 
ôî
->
mö
 = 
√w_mö
;

2414 i‡(
√w_mö
 =(
uöt64_t
)-1)  0;

2415 *
_tid
 = 
√w_mö
>>32; *
_pos
 = (
uöt32_t
)new_min;

2416 
i
 = 0; i < 
ôî
->
n
; ++i) {

2417 i‡(
ôî
->
pos
[
i
] =ôî->
mö
) {

2418 
n_∂p
[
i
] = 
ôî
->n_∂p[i], 
∂p
[i] = iter->plp[i];

2419 ++
ªt
;

2420 } 
n_∂p
[
i
] = 0, 
∂p
[i] = 0;

2422  
ªt
;

2423 
	}
}

2425 
	$bam_m∂p_ª£t
(
bam_m∂p_t
 
ôî
)

2427 
i
;

2428 
ôî
->
mö
 = (
uöt64_t
)-1;

2429 
i
 = 0; i < 
ôî
->
n
; ++i) {

2430 
	`bam_∂p_ª£t
(
ôî
->ôî[
i
]);

2431 
ôî
->
pos
[
i
] = (
uöt64_t
)-1;

2432 
ôî
->
n_∂p
[
i
] = 0;

2433 
ôî
->
∂p
[
i
] = 
NULL
;

2435 
	}
}

2437 
	$bam_m∂p_c⁄°ru˘‹
(
bam_m∂p_t
 
ôî
,

2438 (*
func
)(*
¨g
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
)) {

2439 
i
;

2440 
i
 = 0; i < 
ôî
->
n
; ++i)

2441 
	`bam_∂p_c⁄°ru˘‹
(
ôî
->ôî[
i
], 
func
);

2442 
	}
}

2444 
	$bam_m∂p_de°ru˘‹
(
bam_m∂p_t
 
ôî
,

2445 (*
func
)(*
¨g
, c⁄° 
bam1_t
 *
b
, 
bam_pûeup_cd
 *
cd
)) {

2446 
i
;

2447 
i
 = 0; i < 
ôî
->
n
; ++i)

2448 
	`bam_∂p_de°ru˘‹
(
ôî
->ôî[
i
], 
func
);

2449 
	}
}

	@htslib/synced_bcf_reader.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~<°rög.h
>

30 
	~<°rögs.h
>

31 
	~<limôs.h
>

32 
	~<î∫o.h
>

33 
	~<sys/°©.h
>

34 
	~"ht¶ib/syn˚d_bcf_ªadî.h
"

35 
	~"ht¶ib/k£q.h
"

36 
	~"ht¶ib/khash_°r2öt.h
"

37 
	~"ht¶ib/bgzf.h
"

38 
	~"ht¶ib/thªad_poﬁ.h
"

39 
	~"bcf_§_s‹t.h
"

41 
	#MAX_CSI_COOR
 0x7fffffff

42 

	)

45 
uöt32_t
 
	m°¨t
, 
	míd
;

47 
	tªgi⁄1_t
;

49 
	s_ªgi⁄_t


51 
ªgi⁄1_t
 *
	mªgs
;

52 
	mƒegs
, 
	mmªgs
, 
	m¸eg
;

54 
	tªgi⁄_t
;

56 
	#BCF_SR_AUX
(
x
Ë((
aux_t
*)((x)->
aux
))

	)

59 
§_s‹t_t
 
	ms‹t
;

61 
	taux_t
;

63 
_ªgi⁄s_add
(
bcf_§_ªgi⁄s_t
 *
ªg
, c⁄° *
chr
, 
°¨t
, 
íd
);

64 
bcf_§_ªgi⁄s_t
 *
_ªgi⁄s_öô_°rög
(c⁄° *
°r
);

65 
_ªgi⁄s_m©ch_ÆÀÀs
(
bcf_§_ªgi⁄s_t
 *
ªg
, 
Æs_idx
, 
bcf1_t
 *
ªc
);

67 *
	$bcf_§_°ªº‹
(
î∫um
)

69 
î∫um
)

71 
›í_Áûed
:

72  
	`°ªº‹
(
î∫o
); ;

73 
nŸ_bgzf
:

75 
idx_lﬂd_Áûed
:

77 
fûe_ty≥_îr‹
:

79 
≠i_ußge_îr‹
:

81 
hódî_îr‹
:

83 
no_eof
:

85 
no_mem‹y
:

87 
vcf_∑r£_îr‹
:

89 
bcf_ªad_îr‹
:

93 
	}
}

95 
	$bcf_§_£t_›t
(
bcf_§s_t
 *
ªadîs
, 
bcf_§_›t_t
 
›t
, ...)

97 
va_li°
 
¨gs
;

98 
›t
)

100 
BCF_SR_REQUIRE_IDX
:

101 
ªadîs
->
ªquúe_ödex
 = 1;

104 
BCF_SR_PAIR_LOGIC
:

105 
	`va_°¨t
(
¨gs
, 
›t
);

106 
	`BCF_SR_AUX
(
ªadîs
)->
s‹t
.
∑ú
 = 
	`va_¨g
(
¨gs
, );

113 
	}
}

115 *
	$öô_fûãrs
(
bcf_hdr_t
 *
hdr
, c⁄° *
fûãrs
, *
nfûãrs
)

117 
k°rög_t
 
°r
 = {0,0,0};

118 c⁄° *
tmp
 = 
fûãrs
, *
¥ev
 = filters;

119 
nout
 = 0, *
out
 = 
NULL
;

122 i‡–*
tmp
==',' || !*tmp )

124 
out
 = (*Ë
	`ªÆloc
(out, (
nout
+1)*());

125 i‡–
tmp
-
¥ev
==1 && *prev=='.' )

127 
out
[
nout
] = -1;

128 
nout
++;

132 
°r
.
l
 = 0;

133 
	`kput¢
(
¥ev
, 
tmp
-¥ev, &
°r
);

134 
out
[
nout
] = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
°r
.
s
);

135 i‡–
out
[
nout
]>=0 )Çout++;

137 i‡–!*
tmp
 ) ;

138 
¥ev
 = 
tmp
+1;

140 
tmp
++;

142 i‡–
°r
.
m
 ) 
	`‰ì
(°r.
s
);

143 *
nfûãrs
 = 
nout
;

144  
out
;

145 
	}
}

147 
	$bcf_§_£t_ªgi⁄s
(
bcf_§s_t
 *
ªadîs
, c⁄° *
ªgi⁄s
, 
is_fûe
)

149 
	`as£π
–!
ªadîs
->
ªgi⁄s
 );

150 i‡–
ªadîs
->
ƒódîs
 )

152 
	`Ârötf
(
°dîr
,"[%s:%d %s] Eº‹: bcf_§_£t_ªgi⁄s(Ëmu° bêˇŒed bef‹êbcf_§_add_ªadî()\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

155 
ªadîs
->
ªgi⁄s
 = 
	`bcf_§_ªgi⁄s_öô
‘egi⁄s,
is_fûe
,0,1,-2);

156 i‡–!
ªadîs
->
ªgi⁄s
 )  -1;

157 
ªadîs
->
ex∂icô_ªgs
 = 1;

158 
ªadîs
->
ªquúe_ödex
 = 1;

160 
	}
}

161 
	$bcf_§_£t_èrgës
(
bcf_§s_t
 *
ªadîs
, c⁄° *
èrgës
, 
is_fûe
, 
ÆÀÀs
)

163 
	`as£π
–!
ªadîs
->
èrgës
 );

164 i‡–
èrgës
[0]=='^' )

166 
ªadîs
->
èrgës_ex˛ude
 = 1;

167 
èrgës
++;

169 
ªadîs
->
èrgës
 = 
	`bcf_§_ªgi⁄s_öô
—¨gës,
is_fûe
,0,1,-2);

170 i‡–!
ªadîs
->
èrgës
 )  -1;

171 
ªadîs
->
èrgës_Æs
 = 
ÆÀÀs
;

173 
	}
}

175 
	$bcf_§_£t_thªads
(
bcf_§s_t
 *
fûes
, 
n_thªads
)

177 i‡(!(
fûes
->
n_thªads
 =Ç_threads))

180 
fûes
->
p
 = 
	`ˇŒoc
(1, (*files->p));

181 i‡(!
fûes
->
p
) {

182 
fûes
->
î∫um
 = 
no_mem‹y
;

185 i‡(!(
fûes
->
p
->
poﬁ
 = 
	`hts_çoﬁ_öô
(
n_thªads
)))

189 
	}
}

191 
	$bcf_§_de°roy_thªads
(
bcf_§s_t
 *
fûes
) {

192 i‡(!
fûes
->
p
)

195 i‡(
fûes
->
p
->
poﬁ
)

196 
	`hts_çoﬁ_de°roy
(
fûes
->
p
->
poﬁ
);

197 
	`‰ì
(
fûes
->
p
);

198 
	}
}

200 
	$bcf_§_add_ªadî
(
bcf_§s_t
 *
fûes
, c⁄° *
‚ame
)

202 
htsFûe
* 
fûe_±r
 = 
	`hts_›í
(
‚ame
, "r");

203 i‡–! 
fûe_±r
 ) {

204 
fûes
->
î∫um
 = 
›í_Áûed
;

208 
fûes
->
has_löe
 = (*Ë
	`ªÆloc
(fûes->has_löe, ()*(fûes->
ƒódîs
+1));

209 
fûes
->
has_löe
[fûes->
ƒódîs
] = 0;

210 
fûes
->
ªadîs
 = (
bcf_§_t
*Ë
	`ªÆloc
(fûes->ªadîs, (bcf_§_t)*(fûes->
ƒódîs
+1));

211 
bcf_§_t
 *
ªadî
 = &
fûes
->
ªadîs
[fûes->
ƒódîs
++];

212 
	`mem£t
(
ªadî
,0,(
bcf_§_t
));

214 
ªadî
->
fûe
 = 
fûe_±r
;

216 
fûes
->
î∫um
 = 0;

218 i‡–
ªadî
->
fûe
->
f‹m©
.
com¥essi⁄
==
bgzf
 )

220 
BGZF
 *
bgzf
 = 
	`hts_gë_bgzÂ
(
ªadî
->
fûe
);

221 i‡–
bgzf
 && 
	`bgzf_check_EOF
(bgzf) == 0 ) {

222 
fûes
->
î∫um
 = 
no_eof
;

223 
	`Ârötf
(
°dîr
,"[%s] W¨nög:ÇÿBGZF EOF m¨kî; fûêmay bêåunˇãd.\n", 
‚ame
);

225 i‡(
fûes
->
p
)

226 
	`bgzf_thªad_poﬁ
(
bgzf
, 
fûes
->
p
->
poﬁ
, fûes->p->
qsize
);

229 i‡–
fûes
->
ªquúe_ödex
 )

231 i‡–
ªadî
->
fûe
->
f‹m©
.f‹m©==
vcf
 )

233 i‡–
ªadî
->
fûe
->
f‹m©
.
com¥essi⁄
!=
bgzf
 )

235 
fûes
->
î∫um
 = 
nŸ_bgzf
;

239 
ªadî
->
tbx_idx
 = 
	`tbx_ödex_lﬂd
(
‚ame
);

240 i‡–!
ªadî
->
tbx_idx
 )

242 
fûes
->
î∫um
 = 
idx_lﬂd_Áûed
;

246 
ªadî
->
hódî
 = 
	`bcf_hdr_ªad
‘ódî->
fûe
);

248 i‡–
ªadî
->
fûe
->
f‹m©
.f‹m©==
bcf
 )

250 i‡–
ªadî
->
fûe
->
f‹m©
.
com¥essi⁄
!=
bgzf
 )

252 
fûes
->
î∫um
 = 
nŸ_bgzf
;

256 
ªadî
->
hódî
 = 
	`bcf_hdr_ªad
‘ódî->
fûe
);

258 
ªadî
->
bcf_idx
 = 
	`bcf_ödex_lﬂd
(
‚ame
);

259 i‡–!
ªadî
->
bcf_idx
 )

261 
fûes
->
î∫um
 = 
idx_lﬂd_Áûed
;

267 
fûes
->
î∫um
 = 
fûe_ty≥_îr‹
;

273 i‡–
ªadî
->
fûe
->
f‹m©
.f‹m©==
bcf
 ||Ñódî->fûe->f‹m©.f‹m©==
vcf
 )

275 
ªadî
->
hódî
 = 
	`bcf_hdr_ªad
‘ódî->
fûe
);

279 
fûes
->
î∫um
 = 
fûe_ty≥_îr‹
;

282 
fûes
->
°ªamög
 = 1;

284 i‡–
fûes
->
°ªamög
 && fûes->
ƒódîs
>1 )

286 
fûes
->
î∫um
 = 
≠i_ußge_îr‹
;

287 
	`Ârötf
(
°dîr
,"[%s:%d %s] Eº‹: %dÑódîs, yëÑequúe_ödexÇŸ së\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
fûes
->
ƒódîs
);

290 i‡–
fûes
->
°ªamög
 && fûes->
ªgi⁄s
 )

292 
fûes
->
î∫um
 = 
≠i_ußge_îr‹
;

293 
	`Ârötf
(
°dîr
,"[%s:%d %s] Eº‹: c™nŸÅabix-jum∞ö såómög mode\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

296 i‡–!
ªadî
->
hódî
 )

298 
fûes
->
î∫um
 = 
hódî_îr‹
;

302 
ªadî
->
‚ame
 = 
	`°rdup
(fname);

303 i‡–
fûes
->
≠∂y_fûãrs
 )

304 
ªadî
->
fûãr_ids
 = 
	`öô_fûãrs
‘ódî->
hódî
, 
fûes
->
≠∂y_fûãrs
, &ªadî->
nfûãr_ids
);

307 i‡–!
fûes
->
ex∂icô_ªgs
 && !fûes->
°ªamög
 )

309 
n
,
i
;

310 c⁄° **
«mes
 = 
ªadî
->
tbx_idx
 ? 
	`tbx_£q«mes
‘ódî->tbx_idx, &
n
Ë: 
	`bcf_hdr_£q«mes
‘ódî->
hódî
, &n);

311 
i
=0; i<
n
; i++)

313 i‡–!
fûes
->
ªgi⁄s
 )

314 
fûes
->
ªgi⁄s
 = 
	`_ªgi⁄s_öô_°rög
(
«mes
[
i
]);

316 
	`_ªgi⁄s_add
(
fûes
->
ªgi⁄s
, 
«mes
[
i
], -1, -1);

318 
	`‰ì
(
«mes
);

322 
	}
}

324 
bcf_§s_t
 *
	$bcf_§_öô
()

326 
bcf_§s_t
 *
fûes
 = (bcf_§s_t*Ë
	`ˇŒoc
(1,(bcf_srs_t));

327 
fûes
->
aux
 = (
aux_t
*Ë
	`ˇŒoc
(1,(aux_t));

328 
	`bcf_§_s‹t_öô
(&
	`BCF_SR_AUX
(
fûes
)->
s‹t
);

329  
fûes
;

330 
	}
}

332 
	$bcf_§_de°roy1
(
bcf_§_t
 *
ªadî
)

334 
	`‰ì
(
ªadî
->
‚ame
);

335 i‡–
ªadî
->
tbx_idx
 ) 
	`tbx_de°roy
(reader->tbx_idx);

336 i‡–
ªadî
->
bcf_idx
 ) 
	`hts_idx_de°roy
(reader->bcf_idx);

337 
	`bcf_hdr_de°roy
(
ªadî
->
hódî
);

338 
	`hts_˛o£
(
ªadî
->
fûe
);

339 i‡–
ªadî
->
ôr
 ) 
	`tbx_ôr_de°roy
(reader->itr);

340 
j
;

341 
j
=0; j<
ªadî
->
mbuf„r
; j++)

342 
	`bcf_de°roy1
(
ªadî
->
buf„r
[
j
]);

343 
	`‰ì
(
ªadî
->
buf„r
);

344 
	`‰ì
(
ªadî
->
ßm∂es
);

345 
	`‰ì
(
ªadî
->
fûãr_ids
);

346 
	}
}

348 
	$bcf_§_de°roy
(
bcf_§s_t
 *
fûes
)

350 
i
;

351 
i
=0; i<
fûes
->
ƒódîs
; i++)

352 
	`bcf_§_de°roy1
(&
fûes
->
ªadîs
[
i
]);

353 
	`‰ì
(
fûes
->
has_löe
);

354 
	`‰ì
(
fûes
->
ªadîs
);

355 
i
=0; i<
fûes
->
n_sm∂
; i++Ë
	`‰ì
(fûes->
ßm∂es
[i]);

356 
	`‰ì
(
fûes
->
ßm∂es
);

357 i‡(
fûes
->
èrgës
Ë
	`bcf_§_ªgi⁄s_de°roy
(files->targets);

358 i‡(
fûes
->
ªgi⁄s
Ë
	`bcf_§_ªgi⁄s_de°roy
(files->regions);

359 i‡(
fûes
->
tmps
.
m
Ë
	`‰ì
(fûes->tmps.
s
);

360 i‡(
fûes
->
n_thªads
Ë
	`bcf_§_de°roy_thªads
(files);

361 
	`bcf_§_s‹t_de°roy
(&
	`BCF_SR_AUX
(
fûes
)->
s‹t
);

362 
	`‰ì
(
fûes
->
aux
);

363 
	`‰ì
(
fûes
);

364 
	}
}

366 
	$bcf_§_ªmove_ªadî
(
bcf_§s_t
 *
fûes
, 
i
)

368 
	`as£π
–!
fûes
->
ßm∂es
 );

369 
	`bcf_§_s‹t_ªmove_ªadî
(
fûes
, &
	`BCF_SR_AUX
(fûes)->
s‹t
, 
i
);

370 
	`bcf_§_de°roy1
(&
fûes
->
ªadîs
[
i
]);

371 i‡–
i
+1 < 
fûes
->
ƒódîs
 )

373 
	`memmove
(&
fûes
->
ªadîs
[
i
], &fûes->ªadîs[i+1], (fûes->
ƒódîs
-i-1)*(
bcf_§_t
));

374 
	`memmove
(&
fûes
->
has_löe
[
i
], &fûes->has_löe[i+1], (fûes->
ƒódîs
-i-1)*());

376 
fûes
->
ƒódîs
--;

377 
	}
}

380 
	$debug_buf„r
(
FILE
 *
Â
, 
bcf_§_t
 *
ªadî
)

382 
j
;

383 
j
=0; j<=
ªadî
->
nbuf„r
; j++)

385 
bcf1_t
 *
löe
 = 
ªadî
->
buf„r
[
j
];

386 
	`Ârötf
(
Â
,"\t%p\t%s%s\t%s:%d\t%†", (*)
löe
,
ªadî
->
‚ame
,
j
==0?"*":" ",ªadî->
hódî
->
id
[
BCF_DT_CTG
][löe->
rid
].
key
,löe->
pos
+1,löe->
n_ÆÀÀ
?löe->
d
.
ÆÀÀ
[0]:"");

387 
k
;

388 
k
=1; k<
löe
->
n_ÆÀÀ
; k++Ë
	`Ârötf
(
Â
," %s",Üöe->
d
.
ÆÀÀ
[k]);

389 
	`Ârötf
(
Â
,"\n");

391 
	}
}

393 
	$debug_buf„rs
(
FILE
 *
Â
, 
bcf_§s_t
 *
fûes
)

395 
i
;

396 
i
=0; i<
fûes
->
ƒódîs
; i++)

398 
	`Ârötf
(
Â
, "has_löe: %d\t%s\n", 
	`bcf_§_has_löe
(
fûes
,
i
),fûes->
ªadîs
[i].
‚ame
);

399 
	`debug_buf„r
(
Â
, &
fûes
->
ªadîs
[
i
]);

401 
	`Ârötf
(
Â
,"\n");

402 
	}
}

404 
ölöe
 
	$has_fûãr
(
bcf_§_t
 *
ªadî
, 
bcf1_t
 *
löe
)

406 
i
, 
j
;

407 i‡–!
löe
->
d
.
n_Êt
 )

409 
j
=0; j<
ªadî
->
nfûãr_ids
; j++)

410 i‡–
ªadî
->
fûãr_ids
[
j
]<0 )  1;

413 
i
=0; i<
löe
->
d
.
n_Êt
; i++)

415 
j
=0; j<
ªadî
->
nfûãr_ids
; j++)

416 i‡–
löe
->
d
.
Êt
[
i
]==
ªadî
->
fûãr_ids
[
j
] )  1;

419 
	}
}

421 
	$_ªadî_£ek
(
bcf_§_t
 *
ªadî
, c⁄° *
£q
, 
°¨t
, 
íd
)

423 i‡–
íd
>=
MAX_CSI_COOR
 )

425 
	`Ârötf
(
°dîr
,"Thêco‹dö©êi†ouào‡csòödexÜimô: %d\n", 
íd
+1);

426 
	`exô
(1);

428 i‡–
ªadî
->
ôr
 )

430 
	`hts_ôr_de°roy
(
ªadî
->
ôr
);

431 
ªadî
->
ôr
 = 
NULL
;

433 
ªadî
->
nbuf„r
 = 0;

434 i‡–
ªadî
->
tbx_idx
 )

436 
tid
 = 
	`tbx_«me2id
(
ªadî
->
tbx_idx
, 
£q
);

437 i‡–
tid
==-1 )  -1;

438 
ªadî
->
ôr
 = 
	`tbx_ôr_quîyi
‘ódî->
tbx_idx
,
tid
,
°¨t
,
íd
+1);

442 
tid
 = 
	`bcf_hdr_«me2id
(
ªadî
->
hódî
, 
£q
);

443 i‡–
tid
==-1 )  -1;

444 
ªadî
->
ôr
 = 
	`bcf_ôr_quîyi
‘ódî->
bcf_idx
,
tid
,
°¨t
,
íd
+1);

446 i‡–!
ªadî
->
ôr
 ) 
	`Ârötf
(
°dîr
,"CouldÇŸ sìk: %s:%d-%d\n",
£q
,
°¨t
+1,
íd
+1);

447 
	`as£π
(
ªadî
->
ôr
);

449 
	}
}

455 
	$_ªadîs_√xt_ªgi⁄
(
bcf_§s_t
 *
fûes
)

458 
i
, 
eos
 = 0;

459 
i
=0; i<
fûes
->
ƒódîs
; i++)

460 i‡–!
fûes
->
ªadîs
[
i
].
ôr
 && !fûes->ªadîs[i].
nbuf„r
 ) 
eos
++;

462 i‡–
eos
!=
fûes
->
ƒódîs
 )

469 i‡–
	`bcf_§_ªgi⁄s_√xt
(
fûes
->
ªgi⁄s
)<0 )  -1;

471 
i
=0; i<
fûes
->
ƒódîs
; i++)

472 
	`_ªadî_£ek
(&
fûes
->
ªadîs
[
i
],fûes->
ªgi⁄s
->
£q_«mes
[fûes->ªgi⁄s->
i£q
],fûes->ªgi⁄s->
°¨t
,fûes->ªgi⁄s->
íd
);

475 
	}
}

480 
	$_ªadî_fûl_buf„r
(
bcf_§s_t
 *
fûes
, 
bcf_§_t
 *
ªadî
)

483 i‡–
ªadî
->
nbuf„r
 &&Ñódî->
buf„r
[ªadî->nbuf„r]->
pos
 !=Ñeader->buffer[1]->pos ) ;

486 i‡–!
ªadî
->
ôr
 && !
fûes
->
°ªamög
 ) ;

489 
i
, 
ªt
 = 0;

492 i‡–
ªadî
->
nbuf„r
+1 >ªadî->
mbuf„r
 )

495 
ªadî
->
mbuf„r
 += 8;

496 
ªadî
->
buf„r
 = (
bcf1_t
**Ë
	`ªÆloc
‘ódî->buf„r, (bcf1_t*)*ªadî->
mbuf„r
);

497 
i
=8; i>0; i--)

499 
ªadî
->
buf„r
[ªadî->
mbuf„r
-
i
] = 
	`bcf_öô1
();

500 
ªadî
->
buf„r
[ªadî->
mbuf„r
-
i
]->
max_u≈ack
 = 
fûes
->max_unpack;

501 
ªadî
->
buf„r
[ªadî->
mbuf„r
-
i
]->
pos
 = -1;

504 i‡–
fûes
->
°ªamög
 )

506 i‡–
ªadî
->
fûe
->
f‹m©
.f‹m©==
vcf
 )

508 i‡–(
ªt
=
	`hts_gëlöe
(
ªadî
->
fûe
, 
KS_SEP_LINE
, &
fûes
->
tmps
)) < 0 ) ;

509 
ªt
 = 
	`vcf_∑r£1
(&
fûes
->
tmps
, 
ªadî
->
hódî
,Ñódî->
buf„r
[ªadî->
nbuf„r
+1]);

510 i‡–
ªt
<0 ) { 
fûes
->
î∫um
 = 
vcf_∑r£_îr‹
; ; }

512 i‡–
ªadî
->
fûe
->
f‹m©
.f‹m©==
bcf
 )

514 
ªt
 = 
	`bcf_ªad1
(
ªadî
->
fûe
,Ñódî->
hódî
,Ñódî->
buf„r
[ªadî->
nbuf„r
+1]);

515 i‡–
ªt
 < -1 ) 
fûes
->
î∫um
 = 
bcf_ªad_îr‹
;

516 i‡–
ªt
 < 0 ) ;

520 
	`Ârötf
(
°dîr
,"[%s:%d %s] fixme:ÇŸÑódy f‹Åhis\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

521 
	`exô
(1);

524 i‡–
ªadî
->
tbx_idx
 )

526 i‡–(
ªt
=
	`tbx_ôr_√xt
(
ªadî
->
fûe
,Ñódî->
tbx_idx
,Ñódî->
ôr
, &
fûes
->
tmps
)) < 0 ) ;

527 
ªt
 = 
	`vcf_∑r£1
(&
fûes
->
tmps
, 
ªadî
->
hódî
,Ñódî->
buf„r
[ªadî->
nbuf„r
+1]);

528 i‡–
ªt
<0 ) { 
fûes
->
î∫um
 = 
vcf_∑r£_îr‹
; ; }

532 
ªt
 = 
	`bcf_ôr_√xt
(
ªadî
->
fûe
,Ñódî->
ôr
,Ñódî->
buf„r
[ªadî->
nbuf„r
+1]);

533 i‡–
ªt
 < -1 ) 
fûes
->
î∫um
 = 
bcf_ªad_îr‹
;

534 i‡–
ªt
 < 0 ) ;

535 
	`bcf_sub£t_f‹m©
(
ªadî
->
hódî
,ªadî->
buf„r
[ªadî->
nbuf„r
+1]);

539 i‡–!
ªadî
->
nfûãr_ids
 )

540 
	`bcf_u≈ack
(
ªadî
->
buf„r
[ªadî->
nbuf„r
+1], 
BCF_UN_STR
);

543 
	`bcf_u≈ack
(
ªadî
->
buf„r
[ªadî->
nbuf„r
+1], 
BCF_UN_STR
|
BCF_UN_FLT
);

544 i‡–!
	`has_fûãr
(
ªadî
,Ñódî->
buf„r
[ªadî->
nbuf„r
+1]) ) ;

546 
ªadî
->
nbuf„r
++;

548 i‡–
ªadî
->
buf„r
[ªadî->
nbuf„r
]->
pos
 !=Ñeader->buffer[1]->pos ) ;

550 i‡–
ªt
<0 )

553 
	`tbx_ôr_de°roy
(
ªadî
->
ôr
);

554 
ªadî
->
ôr
 = 
NULL
;

556 
	}
}

561 
	$_ªadî_shi·_buf„r
(
bcf_§_t
 *
ªadî
)

563 
i
;

564 
i
=2; i<=
ªadî
->
nbuf„r
; i++)

565 i‡–
ªadî
->
buf„r
[
i
]->
pos
!=reader->buffer[1]->pos ) ;

566 i‡–
i
<=
ªadî
->
nbuf„r
 )

570 
bcf1_t
 *
tmp
 = 
ªadî
->
buf„r
[1];Ñódî->buf„r[1] =Ñódî->buf„r[
i
];Ñeader->buffer[i] =Åmp;

571 
ªadî
->
nbuf„r
 = 1;

574 
ªadî
->
nbuf„r
 = 0;

575 
	}
}

577 
	$_ªadî_√xt_löe
(
bcf_§s_t
 *
fûes
)

579 
i
, 
mö_pos
 = 
INT_MAX
;

580 c⁄° *
chr
 = 
NULL
;

586 i‡–
fûes
->
ªgi⁄s
 && 
	`_ªadîs_√xt_ªgi⁄
(files)<0 ) ;

589 
i
=0; i<
fûes
->
ƒódîs
; i++)

591 
	`_ªadî_fûl_buf„r
(
fûes
, &fûes->
ªadîs
[
i
]);

594 i‡–!
fûes
->
ªadîs
[
i
].
nbuf„r
 ) ;

595 i‡–
mö_pos
 > 
fûes
->
ªadîs
[
i
].
buf„r
[1]->
pos
 )

597 
mö_pos
 = 
fûes
->
ªadîs
[
i
].
buf„r
[1]->
pos
;

598 
chr
 = 
	`bcf_£q«me
(
fûes
->
ªadîs
[
i
].
hódî
, fûes->ªadîs[i].
buf„r
[1]);

601 i‡–
mö_pos
==
INT_MAX
 )

603 i‡–!
fûes
->
ªgi⁄s
 ) ;

608 i‡–
fûes
->
èrgës
 )

610 
ªt
 = 
	`bcf_§_ªgi⁄s_ovîœp
(
fûes
->
èrgës
, 
chr
, 
mö_pos
, min_pos);

611 i‡–(!
fûes
->
èrgës_ex˛ude
 && 
ªt
<0) || (files->targets_exclude && !ret) )

614 
i
=0; i<
fûes
->
ƒódîs
; i++)

615 i‡–
fûes
->
ªadîs
[
i
].
nbuf„r
 && fûes->ªadîs[i].
buf„r
[1]->
pos
==
mö_pos
 )

616 
	`_ªadî_shi·_buf„r
(&
fûes
->
ªadîs
[
i
]);

617 
mö_pos
 = 
INT_MAX
;

618 
chr
 = 
NULL
;

625 i‡–!
chr
 )  0;

627  
	`bcf_§_s‹t_√xt
(
fûes
, &
	`BCF_SR_AUX
(fûes)->
s‹t
, 
chr
, 
mö_pos
);

628 
	}
}

630 
	$bcf_§_√xt_löe
(
bcf_§s_t
 *
fûes
)

632 i‡–!
fûes
->
èrgës_Æs
 )

633  
	`_ªadî_√xt_löe
(
fûes
);

637 
i
, 
ªt
 = 
	`_ªadî_√xt_löe
(
fûes
);

638 i‡–!
ªt
 ) Ñet;

640 
i
=0; i<
fûes
->
ƒódîs
; i++)

641 i‡–
fûes
->
has_löe
[
i
] ) ;

643 i‡–
	`_ªgi⁄s_m©ch_ÆÀÀs
(
fûes
->
èrgës
, fûes->
èrgës_Æs
-1, fûes->
ªadîs
[
i
].
buf„r
[0]ËË 
ªt
;

647 
i
=0; i<
fûes
->
ƒódîs
; i++)

649 i‡–!
fûes
->
has_löe
[
i
] ) ;

650 i‡–
fûes
->
ªadîs
[
i
].
nbuf„r
==0 || fûes->ªadîs[i].
buf„r
[1]->
pos
!=files->readers[i].buffer[0]->pos ) ;

653 i‡–
i
==
fûes
->
ƒódîs
 )  
ªt
;

655 
	}
}

657 
	$bcf_§_£ek_°¨t
(
bcf_§s_t
 *
ªadîs
)

659 
bcf_§_ªgi⁄s_t
 *
ªg
 = 
ªadîs
->
ªgi⁄s
;

660 
i
;

661 
i
=0; i<
ªg
->
n£qs
; i++)

662 
ªg
->
ªgs
[
i
].
¸eg
 = -1;

663 
ªg
->
i£q
 = 0;

664 
	}
}

667 
	$bcf_§_£ek
(
bcf_§s_t
 *
ªadîs
, c⁄° *
£q
, 
pos
)

669 i‡–!
ªadîs
->
ªgi⁄s
 )  0;

670 i‡–!
£q
 && !
pos
 )

673 
	`bcf_§_£ek_°¨t
(
ªadîs
);

676 
	`bcf_§_ªgi⁄s_ovîœp
(
ªadîs
->
ªgi⁄s
, 
£q
, 
pos
,Öos);

677 
i
, 
ƒë
 = 0;

678 
i
=0; i<
ªadîs
->
ƒódîs
; i++)

680 
ƒë
 +
	`_ªadî_£ek
(&
ªadîs
->ªadîs[
i
],
£q
,
pos
,
MAX_CSI_COOR
-1);

682  
ƒë
;

683 
	}
}

685 
	$bcf_§_£t_ßm∂es
(
bcf_§s_t
 *
fûes
, c⁄° *
‚ame
, 
is_fûe
)

687 
i
, 
j
, 
nsm∂
, 
‰ì_sm∂
 = 0;

688 **
sm∂
 = 
NULL
;

690 *
ex˛ude
 = (
‚ame
[0]=='^'Ë? 
	`khash_°r2öt_öô
(Ë: 
NULL
;

691 i‡–
ex˛ude
 || 
	`°rcmp
("-",
‚ame
) )

693 
sm∂
 = 
	`hts_ªadli°
(
‚ame
, 
is_fûe
, &
nsm∂
);

694 i‡–!
sm∂
 )

696 
	`Ârötf
(
°dîr
,"CouldÇŸÑódÅhêfûe: \"%s\"\n", 
‚ame
);

699 i‡–
ex˛ude
 )

701 
i
=0; i<
nsm∂
; i++)

702 
	`khash_°r2öt_öc
(
ex˛ude
, 
sm∂
[
i
]);

704 
‰ì_sm∂
 = 1;

706 i‡–!
sm∂
 )

708 
sm∂
 = 
fûes
->
ªadîs
[0].
hódî
->
ßm∂es
;

709 
nsm∂
 = 
	`bcf_hdr_nßm∂es
(
fûes
->
ªadîs
[0].
hódî
);

712 
fûes
->
ßm∂es
 = 
NULL
;

713 
fûes
->
n_sm∂
 = 0;

714 
i
=0; i<
nsm∂
; i++)

716 i‡–
ex˛ude
 && 
	`khash_°r2öt_has_key
”x˛ude,
sm∂
[
i
]) ) ;

718 
n_i£c
 = 0;

719 
j
=0; j<
fûes
->
ƒódîs
; j++)

721 i‡–
	`bcf_hdr_id2öt
(
fûes
->
ªadîs
[
j
].
hódî
, 
BCF_DT_SAMPLE
, 
sm∂
[
i
])<0 ) ;

722 
n_i£c
++;

724 i‡–
n_i£c
!=
fûes
->
ƒódîs
 )

726 
	`Ârötf
(
°dîr
,"W¨nög: Thêßm∂ê\"%s\" wa†nŸ found i¿%s, skùpög\n", 
sm∂
[
i
], 
fûes
->
ªadîs
[
n_i£c
].
‚ame
);

730 
fûes
->
ßm∂es
 = (**Ë
	`ªÆloc
(fûes->ßm∂es, (fûes->
n_sm∂
+1)*(const *));

731 
fûes
->
ßm∂es
[fûes->
n_sm∂
++] = 
	`°rdup
(
sm∂
[
i
]);

734 i‡–
ex˛ude
 ) 
	`khash_°r2öt_de°roy
(exclude);

735 i‡–
‰ì_sm∂
 )

737 
i
=0; i<
nsm∂
; i++Ë
	`‰ì
(
sm∂
[i]);

738 
	`‰ì
(
sm∂
);

741 i‡–!
fûes
->
n_sm∂
 )

743 i‡–
fûes
->
ƒódîs
>1 )

744 
	`Ârötf
(
°dîr
,"No samples in common.\n");

747 
i
=0; i<
fûes
->
ƒódîs
; i++)

749 
bcf_§_t
 *
ªadî
 = &
fûes
->
ªadîs
[
i
];

750 
ªadî
->
ßm∂es
 = (*Ë
	`mÆloc
(()*
fûes
->
n_sm∂
);

751 
ªadî
->
n_sm∂
 = 
fûes
->n_smpl;

752 
j
=0; j<
fûes
->
n_sm∂
; j++)

753 
ªadî
->
ßm∂es
[
j
] = 
	`bcf_hdr_id2öt
‘ódî->
hódî
, 
BCF_DT_SAMPLE
, 
fûes
->samples[j]);

756 
	}
}

760 
	$_ªgi⁄s_add
(
bcf_§_ªgi⁄s_t
 *
ªg
, c⁄° *
chr
, 
°¨t
, 
íd
)

762 i‡–
°¨t
==-1 && 
íd
==-1 )

764 
°¨t
 = 0; 
íd
 = 
MAX_CSI_COOR
-1;

768 
°¨t
--; 
íd
--;

771 i‡–!
ªg
->
£q_hash
 )

772 
ªg
->
£q_hash
 = 
	`khash_°r2öt_öô
();

774 
i£q
;

775 i‡–
	`khash_°r2öt_gë
(
ªg
->
£q_hash
, 
chr
, &
i£q
)<0 )

778 
i£q
 = 
ªg
->
n£qs
++;

779 
ªg
->
£q_«mes
 = (**Ë
	`ªÆloc
‘eg->£q_«mes,(*)*ªg->
n£qs
);

780 
ªg
->
ªgs
 = (
ªgi⁄_t
*Ë
	`ªÆloc
‘eg->ªgs,‘egi⁄_t)*ªg->
n£qs
);

781 
	`mem£t
(&
ªg
->
ªgs
[ªg->
n£qs
-1],0,(
ªgi⁄_t
));

782 
ªg
->
£q_«mes
[
i£q
] = 
	`°rdup
(
chr
);

783 
ªg
->
ªgs
[
i£q
].
¸eg
 = -1;

784 
	`khash_°r2öt_£t
(
ªg
->
£q_hash
,ªg->
£q_«mes
[
i£q
],iseq);

787 
ªgi⁄_t
 *
¸eg
 = &
ªg
->
ªgs
[
i£q
];

790 
i
, 
mö
 = 0, 
max
 = 
¸eg
->
ƒegs
 - 1;

791  
mö
<=
max
 )

793 
i
 = (
max
+
mö
)/2;

794 i‡–
°¨t
 < 
¸eg
->
ªgs
[
i
].°¨àË
max
 = i - 1;

795 i‡–
°¨t
 > 
¸eg
->
ªgs
[
i
].°¨àË
mö
 = i + 1;

798 i‡–
mö
>
max
 || 
¸eg
->
ªgs
[
i
].
°¨t
!=°¨à|| cªg->ªgs[i].
íd
!=end )

801 
	`hts_ex∑nd
(
ªgi⁄1_t
,
¸eg
->
ƒegs
+1,¸eg->
mªgs
,¸eg->
ªgs
);

802 i‡–++
max
 < 
¸eg
->
ƒegs
 )

803 
	`memmove
(&
¸eg
->
ªgs
[
max
+1],&¸eg->ªgs[max],(¸eg->
ƒegs
 - max)*(
ªgi⁄1_t
));

804 
¸eg
->
ªgs
[
max
].
°¨t
 = start;

805 
¸eg
->
ªgs
[
max
].
íd
 =Énd;

806 
¸eg
->
ƒegs
++;

808 
	}
}

811 
bcf_§_ªgi⁄s_t
 *
	$_ªgi⁄s_öô_°rög
(c⁄° *
°r
)

813 
bcf_§_ªgi⁄s_t
 *
ªg
 = (bcf_§_ªgi⁄s_à*Ë
	`ˇŒoc
(1, (bcf_sr_regions_t));

814 
ªg
->
°¨t
 =Ñeg->
íd
 = -1;

815 
ªg
->
¥ev_°¨t
 =Ñeg->
¥ev_£q
 = -1;

817 
k°rög_t
 
tmp
 = {0,0,0};

818 c⁄° *
•
 = 
°r
, *
ï
 = str;

819 
‰om
, 
to
;

822  *
ï
 && *ep!=',' && *ep!=':' )Ép++;

823 
tmp
.
l
 = 0;

824 
	`kput¢
(
•
,
ï
-•,&
tmp
);

825 i‡–*
ï
==':' )

827 
•
 = 
ï
+1;

828 
‰om
 = 
	`hts_∑r£_decimÆ
(
•
,(**)&
ï
,0);

829 i‡–
•
==
ï
 )

831 
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸÖ¨£Åhêªgi⁄(s): %s\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
°r
);

832 
	`‰ì
(
ªg
); fªe(
tmp
.
s
);  
NULL
;

834 i‡–!*
ï
 || *ep==',' )

836 
	`_ªgi⁄s_add
(
ªg
, 
tmp
.
s
, 
‰om
, from);

837 
•
 = 
ï
;

840 i‡–*
ï
!='-' )

842 
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸÖ¨£Åhêªgi⁄(s): %s\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
°r
);

843 
	`‰ì
(
ªg
); fªe(
tmp
.
s
);  
NULL
;

845 
ï
++;

846 
•
 = 
ï
;

847 
to
 = 
	`hts_∑r£_decimÆ
(
•
,(**)&
ï
,0);

848 i‡–*
ï
 && *ep!=',' )

850 
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸÖ¨£Åhêªgi⁄(s): %s\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
°r
);

851 
	`‰ì
(
ªg
); fªe(
tmp
.
s
);  
NULL
;

853 i‡–
•
==
ï
 ) 
to
 = 
MAX_CSI_COOR
-1;

854 
	`_ªgi⁄s_add
(
ªg
, 
tmp
.
s
, 
‰om
, 
to
);

855 i‡–!*
ï
 ) ;

856 
•
 = 
ï
;

860 i‡–
tmp
.
l
 ) 
	`_ªgi⁄s_add
(
ªg
,Åmp.
s
, -1, -1);

861 i‡–!*
ï
 ) ;

862 
•
 = ++
ï
;

865 
	`‰ì
(
tmp
.
s
);

866  
ªg
;

867 
	}
}

871 
	$_ªgi⁄s_∑r£_löe
(*
löe
, 
ichr
,
i‰om
,
ôo
, **
chr
,**
chr_íd
,*
‰om
,*
to
)

873 *
chr_íd
 = 
NULL
;

875 i‡–
löe
[0]=='#' )  0;

877 
k
,
l
;

878 i‡–
i‰om
 <
ôo
 )

879 
k
 = 
i‰om
, 
l
 = 
ôo
;

881 
l
 = 
i‰om
, 
k
 = 
ôo
;

883 
i
;

884 *
£
 = 
löe
, *
ss
 = 
NULL
;

885 *
tmp
;

886 
i
=0; i<=
k
 && *
£
; i++)

888 
ss
 = 
i
==0 ? 
£
++ : ++se;

889 *
£
 && *se!='\t') se++;

891 i‡–
i
<=
k
 )  -1;

892 i‡–
k
==
l
 )

894 *
‰om
 = *
to
 = 
	`hts_∑r£_decimÆ
(
ss
, &
tmp
, 0);

895 i‡–
tmp
==
ss
 )  -1;

899 i‡–
k
==
i‰om
 )

900 *
‰om
 = 
	`hts_∑r£_decimÆ
(
ss
, &
tmp
, 0);

902 *
to
 = 
	`hts_∑r£_decimÆ
(
ss
, &
tmp
, 0);

903 i‡–
ss
==
tmp
 )  -1;

905 
i
=
k
; i<
l
 && *
£
; i++)

907 
ss
 = ++
£
;

908 *
£
 && *se!='\t') se++;

910 i‡–
i
<
l
 )  -1;

911 i‡–
k
==
i‰om
 )

912 *
to
 = 
	`hts_∑r£_decimÆ
(
ss
, &
tmp
, 0);

914 *
‰om
 = 
	`hts_∑r£_decimÆ
(
ss
, &
tmp
, 0);

915 i‡–
ss
==
tmp
 )  -1;

918 
ss
 = 
£
 = 
löe
;

919 
i
=0; i<=
ichr
 && *
£
; i++)

921 i‡–
i
>0 ) 
ss
 = ++
£
;

922 *
£
 && *se!='\t') se++;

924 i‡–
i
<=
ichr
 )  -1;

925 *
chr_íd
 = 
£
;

926 *
chr
 = 
ss
;

928 
	}
}

930 
bcf_§_ªgi⁄s_t
 *
	$bcf_§_ªgi⁄s_öô
(c⁄° *
ªgi⁄s
, 
is_fûe
, 
ichr
, 
i‰om
, 
ôo
)

932 
bcf_§_ªgi⁄s_t
 *
ªg
;

933 i‡–!
is_fûe
 )  
	`_ªgi⁄s_öô_°rög
(
ªgi⁄s
);

935 
ªg
 = (
bcf_§_ªgi⁄s_t
 *Ë
	`ˇŒoc
(1, (bcf_sr_regions_t));

936 
ªg
->
°¨t
 =Ñeg->
íd
 = -1;

937 
ªg
->
¥ev_°¨t
 =Ñeg->
¥ev_£q
 = -1;

939 
ªg
->
fûe
 = 
	`hts_›í
(
ªgi⁄s
, "rb");

940 i‡–!
ªg
->
fûe
 )

942 
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ o≥¿fûe: %s\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
ªgi⁄s
);

943 
	`‰ì
(
ªg
);

944  
NULL
;

947 
ªg
->
tbx
 = 
	`tbx_ödex_lﬂd
(
ªgi⁄s
);

948 i‡–!
ªg
->
tbx
 )

950 
Àn
 = 
	`°æí
(
ªgi⁄s
);

951 
is_bed
 = 
	`°rˇ£cmp
(".bed",
ªgi⁄s
+
Àn
-4) ? 0 : 1;

952 i‡–!
is_bed
 && !
	`°rˇ£cmp
(".bed.gz",
ªgi⁄s
+
Àn
-7) ) is_bed = 1;

954 i‡–
ªg
->
fûe
->
f‹m©
.f‹m©==
vcf
 ) 
ôo
 = 1;

957  
	`hts_gëlöe
(
ªg
->
fûe
, 
KS_SEP_LINE
, &ªg->
löe
) > 0 )

959 *
chr
, *
chr_íd
;

960 
‰om
, 
to
, 
ªt
;

961 
ªt
 = 
	`_ªgi⁄s_∑r£_löe
(
ªg
->
löe
.
s
, 
ichr
,
i‰om
,
	`abs
(
ôo
), &
chr
,&
chr_íd
,&
‰om
,&
to
);

962 i‡–
ªt
 < 0 )

964 i‡–
ôo
<0 )

965 
ªt
 = 
	`_ªgi⁄s_∑r£_löe
(
ªg
->
löe
.
s
, 
ichr
,
i‰om
,i‰om, &
chr
,&
chr_íd
,&
‰om
,&
to
);

966 i‡–
ªt
<0 )

968 
	`Ârötf
(
°dîr
,"[%s:%d] CouldÇŸÖ¨£Åhêfûê%s, usögÅhêcﬁumn†%d,%d[,%d]\n", 
__FILE__
,
__LINE__
,
ªgi⁄s
,
ichr
+1,
i‰om
+1,
ôo
+1);

969 
	`hts_˛o£
(
ªg
->
fûe
);Ñeg->fûê
NULL
; 
	`‰ì
(reg);

970  
NULL
;

973 i‡–!
ªt
 ) ;

974 i‡–
is_bed
 ) 
‰om
++;

975 *
chr_íd
 = 0;

976 
	`_ªgi⁄s_add
(
ªg
, 
chr
, 
‰om
, 
to
);

977 *
chr_íd
 = '\t';

979 
	`hts_˛o£
(
ªg
->
fûe
);Ñeg->fûê
NULL
;

980 i‡–!
ªg
->
n£qs
 ) { 
	`‰ì
‘eg);  
NULL
; }

981  
ªg
;

984 
ªg
->
£q_«mes
 = (**Ë
	`tbx_£q«mes
‘eg->
tbx
, &ªg->
n£qs
);

985 i‡–!
ªg
->
£q_hash
 )

986 
ªg
->
£q_hash
 = 
	`khash_°r2öt_öô
();

987 
i
;

988 
i
=0; i<
ªg
->
n£qs
; i++)

990 
	`khash_°r2öt_£t
(
ªg
->
£q_hash
,ªg->
£q_«mes
[
i
],i);

992 
ªg
->
‚ame
 = 
	`°rdup
(
ªgi⁄s
);

993 
ªg
->
is_bö
 = 1;

994  
ªg
;

995 
	}
}

997 
	$bcf_§_ªgi⁄s_de°roy
(
bcf_§_ªgi⁄s_t
 *
ªg
)

999 
i
;

1000 
	`‰ì
(
ªg
->
‚ame
);

1001 i‡–
ªg
->
ôr
 ) 
	`tbx_ôr_de°roy
(reg->itr);

1002 i‡–
ªg
->
tbx
 ) 
	`tbx_de°roy
(reg->tbx);

1003 i‡–
ªg
->
fûe
 ) 
	`hts_˛o£
(reg->file);

1004 i‡–
ªg
->
Æs
 ) 
	`‰ì
(reg->als);

1005 i‡–
ªg
->
Æs_°r
.
s
 ) 
	`‰ì
(reg->als_str.s);

1006 
	`‰ì
(
ªg
->
löe
.
s
);

1007 i‡–
ªg
->
ªgs
 )

1010 
i
=0; i<
ªg
->
n£qs
; i++)

1012 
	`‰ì
(
ªg
->
£q_«mes
[
i
]);

1013 
	`‰ì
(
ªg
->
ªgs
[
i
].regs);

1016 
	`‰ì
(
ªg
->
ªgs
);

1017 
	`‰ì
(
ªg
->
£q_«mes
);

1018 
	`khash_°r2öt_de°roy
(
ªg
->
£q_hash
);

1019 
	`‰ì
(
ªg
);

1020 
	}
}

1022 
	$bcf_§_ªgi⁄s_£ek
(
bcf_§_ªgi⁄s_t
 *
ªg
, c⁄° *
£q
)

1024 
ªg
->
i£q
 =Ñeg->
°¨t
 =Ñeg->
íd
 = -1;

1025 i‡–
	`khash_°r2öt_gë
(
ªg
->
£q_hash
, 
£q
, &ªg->
i£q
) < 0 )  -1;

1028 i‡–
ªg
->
ªgs
 )

1030 
ªg
->
ªgs
[ªg->
i£q
].
¸eg
 = -1;

1035 i‡–
ªg
->
ôr
 ) 
	`tbx_ôr_de°roy
(reg->itr);

1036 
ªg
->
ôr
 = 
	`tbx_ôr_quîys
‘eg->
tbx
, 
£q
);

1037 i‡–
ªg
->
ôr
 )  0;

1040 
	}
}

1042 
	$bcf_§_ªgi⁄s_√xt
(
bcf_§_ªgi⁄s_t
 *
ªg
)

1044 i‡–
ªg
->
i£q
<0 )  -1;

1045 
ªg
->
°¨t
 =Ñeg->
íd
 = -1;

1046 
ªg
->
«ls
 = 0;

1049 i‡–
ªg
->
ªgs
 )

1051  
ªg
->
i£q
 <Ñeg->
n£qs
 )

1053 
ªg
->
ªgs
[ªg->
i£q
].
¸eg
++;

1054 i‡–
ªg
->
ªgs
[ªg->
i£q
].
¸eg
 <Ñeg->ªgs[ªg->i£q].
ƒegs
 ) ;

1055 
ªg
->
i£q
++;

1057 i‡–
ªg
->
i£q
 >ªg->
n£qs
 ) {Ñeg->iseq = -1;  -1; }

1058 
ªgi⁄1_t
 *
¸eg
 = &
ªg
->
ªgs
[ªg->
i£q
].regs[reg->regs[reg->iseq].creg];

1059 
ªg
->
°¨t
 = 
¸eg
->start;

1060 
ªg
->
íd
 = 
¸eg
->end;

1065 *
chr
, *
chr_íd
;

1066 
ichr
 = 0, 
i‰om
 = 1, 
ôo
 = 2, 
is_bed
 = 0, 
‰om
, 
to
;

1067 i‡–
ªg
->
tbx
 )

1069 
ichr
 = 
ªg
->
tbx
->
c⁄f
.
sc
-1;

1070 
i‰om
 = 
ªg
->
tbx
->
c⁄f
.
bc
-1;

1071 
ôo
 = 
ªg
->
tbx
->
c⁄f
.
ec
-1;

1072 i‡–
ôo
<0 ) itÿ
i‰om
;

1073 
is_bed
 = 
ªg
->
tbx
->
c⁄f
.
¥e£t
==
TBX_UCSC
 ? 1 : 0;

1076 
ªt
 = 0;

1077  !
ªt
 )

1079 i‡–
ªg
->
ôr
 )

1082 
ªt
 = 
	`tbx_ôr_√xt
(
ªg
->
fûe
,Ñeg->
tbx
,Ñeg->
ôr
, &ªg->
löe
);

1083 i‡–
ªt
<0 ) { 
ªg
->
i£q
 = -1;  -1; }

1087 i‡–
ªg
->
is_bö
 )

1091 
	`hts_˛o£
(
ªg
->
fûe
);

1092 
ªg
->
fûe
 = 
	`hts_›í
‘eg->
‚ame
, "r");

1093 i‡–!
ªg
->
fûe
 )

1095 
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ o≥¿fûe: %s\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
ªg
->
‚ame
);

1096 
ªg
->
fûe
 = 
NULL
;

1097 
	`bcf_§_ªgi⁄s_de°roy
(
ªg
);

1100 
ªg
->
is_bö
 = 0;

1104 
ªt
 = 
	`hts_gëlöe
(
ªg
->
fûe
, 
KS_SEP_LINE
, &ªg->
löe
);

1105 i‡–
ªt
<0 ) { 
ªg
->
i£q
 = -1;  -1; }

1107 
ªt
 = 
	`_ªgi⁄s_∑r£_löe
(
ªg
->
löe
.
s
, 
ichr
,
i‰om
,
ôo
, &
chr
,&
chr_íd
,&
‰om
,&
to
);

1108 i‡–
ªt
<0 )

1110 
	`Ârötf
(
°dîr
,"[%s:%d] CouldÇŸÖ¨£Åhêfûê%s, usögÅhêcﬁumn†%d,%d,%d\n", 
__FILE__
,
__LINE__
,
ªg
->
‚ame
,
ichr
+1,
i‰om
+1,
ôo
+1);

1114 i‡–
is_bed
 ) 
‰om
++;

1116 *
chr_íd
 = 0;

1117 i‡–
	`khash_°r2öt_gë
(
ªg
->
£q_hash
, 
chr
, &ªg->
i£q
)<0 )

1119 
	`Ârötf
(
°dîr
,"BrokíÅabix index? Thê£quí˚ \"%s\"ÇŸ i¿di˘i⁄¨y [%s]\n", 
chr
,
ªg
->
löe
.
s
);

1120 
	`exô
(1);

1122 *
chr_íd
 = '\t';

1124 
ªg
->
°¨t
 = 
‰om
 - 1;

1125 
ªg
->
íd
 = 
to
 - 1;

1127 
	}
}

1129 
	$_ªgi⁄s_m©ch_ÆÀÀs
(
bcf_§_ªgi⁄s_t
 *
ªg
, 
Æs_idx
, 
bcf1_t
 *
ªc
)

1131 i‡–
ªg
->
ªgs
 )

1134 
	`Ârötf
(
°dîr
,"Error: Compressedánd indexedÅargets file isÑequired\n");

1135 
	`exô
(1);

1138 
i
 = 0, 
max_Àn
 = 0;

1139 i‡–!
ªg
->
«ls
 )

1141 *
ss
 = 
ªg
->
löe
.
s
;

1142  
i
<
Æs_idx
 && *
ss
 )

1144 i‡–*
ss
=='\t' ) 
i
++;

1145 
ss
++;

1147 *
£
 = 
ss
;

1148 
ªg
->
«ls
 = 1;

1149  *
£
 && *se!='\t' )

1151 i‡–*
£
==',' ) 
ªg
->
«ls
++;

1152 
£
++;

1154 
	`ks_ªsize
(&
ªg
->
Æs_°r
, 
£
-
ss
+1+ªg->
«ls
);

1155 
ªg
->
Æs_°r
.
l
 = 0;

1156 
	`hts_ex∑nd
(*,
ªg
->
«ls
,ªg->
mÆs
,ªg->
Æs
);

1157 
ªg
->
«ls
 = 0;

1159 
£
 = 
ss
;

1160  *(++
£
) )

1162 i‡–*
£
=='\t' ) ;

1163 i‡–*
£
!=',' ) ;

1164 
ªg
->
Æs
[ªg->
«ls
] = &ªg->
Æs_°r
.
s
[ªg->Æs_°r.
l
];

1165 
	`kput¢
(
ss
,
£
-ss,&
ªg
->
Æs_°r
);

1166 i‡–&
ªg
->
Æs_°r
.
s
[ªg->Æs_°r.
l
] -Ñeg->
Æs
[ªg->
«ls
] > 
max_Àn
 ) max_len = &reg->als_str.s[reg->als_str.l] -Ñeg->als[reg->nals];

1167 
ªg
->
Æs_°r
.
l
++;

1168 
ªg
->
«ls
++;

1169 
ss
 = ++
£
;

1171 
ªg
->
Æs
[ªg->
«ls
] = &ªg->
Æs_°r
.
s
[ªg->Æs_°r.
l
];

1172 
	`kput¢
(
ss
,
£
-ss,&
ªg
->
Æs_°r
);

1173 i‡–&
ªg
->
Æs_°r
.
s
[ªg->Æs_°r.
l
] -Ñeg->
Æs
[ªg->
«ls
] > 
max_Àn
 ) max_len = &reg->als_str.s[reg->als_str.l] -Ñeg->als[reg->nals];

1174 
ªg
->
«ls
++;

1175 
ªg
->
Æs_ty≥
 = 
max_Àn
 > 1 ? 
VCF_INDEL
 : 
VCF_SNP
;

1177 
ty≥
 = 
	`bcf_gë_v¨ü¡_ty≥s
(
ªc
);

1178 i‡–
ªg
->
Æs_ty≥
 & 
VCF_INDEL
 )

1179  
ty≥
 & 
VCF_INDEL
 ? 1 : 0;

1180  !(
ty≥
 & 
VCF_INDEL
) ? 1 : 0;

1181 
	}
}

1183 
	$bcf_§_ªgi⁄s_ovîœp
(
bcf_§_ªgi⁄s_t
 *
ªg
, c⁄° *
£q
, 
°¨t
, 
íd
)

1185 
i£q
;

1186 i‡–
	`khash_°r2öt_gë
(
ªg
->
£q_hash
, 
£q
, &
i£q
)<0 )  -1;

1188 i‡–
ªg
->
¥ev_£q
==-1 || 
i£q
!Ùeg->¥ev_£q ||Ñeg->
¥ev_°¨t
 > 
°¨t
 )

1191 i‡–
ªg
->
mis£d_ªg_h™dÀr
 &&Ñeg->
¥ev_£q
!=-1 &&Ñeg->
i£q
!=-1 )

1192 
	`bcf_§_ªgi⁄s_Êush
(
ªg
);

1194 
	`bcf_§_ªgi⁄s_£ek
(
ªg
, 
£q
);

1195 
ªg
->
°¨t
 =Ñeg->
íd
 = -1;

1197 i‡–
ªg
->
¥ev_£q
==
i£q
 &&Ñeg->iseq!=iseq )  -2;

1198 
ªg
->
¥ev_£q
 =Ñeg->
i£q
;

1199 
ªg
->
¥ev_°¨t
 = 
°¨t
;

1201  
i£q
==
ªg
->i£q &&Ñeg->
íd
 < 
°¨t
 )

1203 i‡–
	`bcf_§_ªgi⁄s_√xt
(
ªg
) < 0 )  -2;

1204 i‡–
ªg
->
i£q
 != iseq )  -1;

1205 i‡–
ªg
->
mis£d_ªg_h™dÀr
 &&Ñeg->
íd
 < 
°¨t
 )Ñeg->
	`mis£d_ªg_h™dÀr
‘eg,Ñeg->
mis£d_ªg_d©a
);

1207 i‡–
ªg
->
°¨t
 <
íd
 )  0;

1209 
	}
}

1211 
	$bcf_§_ªgi⁄s_Êush
(
bcf_§_ªgi⁄s_t
 *
ªg
)

1213 i‡–!
ªg
->
mis£d_ªg_h™dÀr
 ||Ñeg->
¥ev_£q
==-1 ) ;

1214  !
	`bcf_§_ªgi⁄s_√xt
(
ªg
ËËªg->
	`mis£d_ªg_h™dÀr
‘eg,Ñeg->
mis£d_ªg_d©a
);

1216 
	}
}

	@htslib/tabix.c

26 
	~<c⁄fig.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<uni°d.h
>

31 
	~<°rög.h
>

32 
	~<gë›t.h
>

33 
	~<sys/ty≥s.h
>

34 
	~<sys/°©.h
>

35 
	~<î∫o.h
>

36 
	~"ht¶ib/tbx.h
"

37 
	~"ht¶ib/ßm.h
"

38 
	~"ht¶ib/vcf.h
"

39 
	~"ht¶ib/k£q.h
"

40 
	~"ht¶ib/bgzf.h
"

41 
	~"ht¶ib/hts.h
"

42 
	~"ht¶ib/ªgidx.h
"

46 *
	mªgi⁄s_‚ame
, *
	mèrgës_‚ame
;

47 
	m¥öt_hódî
, 
	mhódî_⁄ly
;

49 
	t¨gs_t
;

51 
	$îr‹
(c⁄° *
f‹m©
, ...)

53 
va_li°
 
≠
;

54 
	`va_°¨t
(
≠
, 
f‹m©
);

55 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
≠
);

56 
	`va_íd
(
≠
);

57 
	`exô
(
EXIT_FAILURE
);

58 
	}
}

60 
	#IS_GFF
 (1<<0)

	)

61 
	#IS_BED
 (1<<1)

	)

62 
	#IS_SAM
 (1<<2)

	)

63 
	#IS_VCF
 (1<<3)

	)

64 
	#IS_BCF
 (1<<4)

	)

65 
	#IS_BAM
 (1<<5)

	)

66 
	#IS_CRAM
 (1<<6)

	)

67 
	#IS_TXT
 (
IS_GFF
|
IS_BED
|
IS_SAM
|
IS_VCF
)

	)

69 
	$fûe_ty≥
(c⁄° *
‚ame
)

71 
l
 = 
	`°æí
(
‚ame
);

72 
	`°rˇ£cmp
(c⁄° *
s1
, c⁄° *
s2
);

73 i‡(
l
>=7 && 
	`°rˇ£cmp
(
‚ame
+l-7, ".gff.gz"Ë=0Ë 
IS_GFF
;

74 i‡(
l
>=7 && 
	`°rˇ£cmp
(
‚ame
+l-7, ".bed.gz"Ë=0Ë 
IS_BED
;

75 i‡(
l
>=7 && 
	`°rˇ£cmp
(
‚ame
+l-7, ".ßm.gz"Ë=0Ë 
IS_SAM
;

76 i‡(
l
>=7 && 
	`°rˇ£cmp
(
‚ame
+l-7, ".vcf.gz"Ë=0Ë 
IS_VCF
;

77 i‡(
l
>=4 && 
	`°rˇ£cmp
(
‚ame
+l-4, ".bcf"Ë=0Ë 
IS_BCF
;

78 i‡(
l
>=4 && 
	`°rˇ£cmp
(
‚ame
+l-4, ".bam"Ë=0Ë 
IS_BAM
;

79 i‡(
l
>=4 && 
	`°rˇ£cmp
(
‚ame
+l-5, ".¸am"Ë=0Ë 
IS_CRAM
;

81 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
,"r");

82 
htsExa˘F‹m©
 
f‹m©
 = 
Â
->format.format;

83 
	`hts_˛o£
(
Â
);

84 i‡–
f‹m©
 =
bcf
 )  
IS_BCF
;

85 i‡–
f‹m©
 =
bam
 )  
IS_BAM
;

86 i‡–
f‹m©
 =
¸am
 )  
IS_CRAM
;

87 i‡–
f‹m©
 =
vcf
 )  
IS_VCF
;

90 
	}
}

92 **
	$∑r£_ªgi⁄s
(*
ªgi⁄s_‚ame
, **
¨gv
, 
¨gc
, *
ƒegs
)

94 
k°rög_t
 
°r
 = {0,0,0};

95 
i£q
 = 0, 
úeg
 = 0;

96 **
ªgs
 = 
NULL
;

97 *
ƒegs
 = 
¨gc
;

99 i‡–
ªgi⁄s_‚ame
 )

103 
ªgidx_t
 *
idx
 = 
	`ªgidx_öô
(
ªgi⁄s_‚ame
, 
NULL
, NULL, 0, NULL);

104 i‡–!
idx
 ) 
	`îr‹
("CouldÇŸÑód %s\n", 
ªgi⁄s_‚ame
);

106 (*
ƒegs
Ë+
	`ªgidx_ƒegs
(
idx
);

107 
ªgs
 = (**Ë
	`mÆloc
((*)*(*
ƒegs
));

109 
n£q
;

110 **
£qs
 = 
	`ªgidx_£q_«mes
(
idx
, &
n£q
);

111 
i£q
=0; i£q<
n£q
; iseq++)

113 
ªgôr_t
 
ôr
;

114 
	`ªgidx_ovîœp
(
idx
, 
£qs
[
i£q
], 0, 
UINT32_MAX
, &
ôr
);

115  
ôr
.
i
 < iå.
n
 )

117 
°r
.
l
 = 0;

118 
	`k•rötf
(&
°r
, "%s:%d-%d", 
£qs
[
i£q
], 
	`REGITR_START
(
ôr
)+1, 
	`REGITR_END
(itr)+1);

119 
ªgs
[
úeg
++] = 
	`°rdup
(
°r
.
s
);

120 
ôr
.
i
++;

123 
	`ªgidx_de°roy
(
idx
);

125 
	`‰ì
(
°r
.
s
);

127 i‡–!
úeg
 )

129 i‡–
¨gc
 )

130 
ªgs
 = (**Ë
	`mÆloc
((*)*
¨gc
);

133 
ªgs
 = (**Ë
	`mÆloc
((*));

134 
ªgs
[0] = 
	`°rdup
(".");

135 *
ƒegs
 = 1;

139 
i£q
=0; i£q<
¨gc
; i£q++Ë
ªgs
[
úeg
++] = 
	`°rdup
(
¨gv
[iseq]);

140  
ªgs
;

141 
	}
}

142 
	$quîy_ªgi⁄s
(
¨gs_t
 *
¨gs
, *
‚ame
, **
ªgs
, 
ƒegs
)

144 
i
;

145 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
,"r");

146 i‡–!
Â
 ) 
	`îr‹
("CouldÇŸÑód %s\n", 
‚ame
);

147 
htsExa˘F‹m©
 
f‹m©
 = 
	`hts_gë_f‹m©
(
Â
)->format;

149 
ªgidx_t
 *
ªg_idx
 = 
NULL
;

150 i‡–
¨gs
->
èrgës_‚ame
 )

152 
ªg_idx
 = 
	`ªgidx_öô
(
¨gs
->
èrgës_‚ame
, 
NULL
, NULL, 0, NULL);

153 i‡–!
ªg_idx
 ) 
	`îr‹
("CouldÇŸÑód %s\n", 
¨gs
->
èrgës_‚ame
);

156 i‡–
f‹m©
 =
bcf
 )

158 
htsFûe
 *
out
 = 
	`hts_›í
("-","w");

159 i‡–!
out
 ) 
	`îr‹
("CouldÇŸ o≥¿°dout\n", 
‚ame
);

160 
hts_idx_t
 *
idx
 = 
	`bcf_ödex_lﬂd
(
‚ame
);

161 i‡–!
idx
 ) 
	`îr‹
("CouldÇŸÜﬂd .csòödex o‡%s\n", 
‚ame
);

162 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_ªad
(
Â
);

163 i‡–!
hdr
 ) 
	`îr‹
("CouldÇŸÑódÅhêhódî: %s\n", 
‚ame
);

164 i‡–
¨gs
->
¥öt_hódî
 )

165 
	`bcf_hdr_wrôe
(
out
,
hdr
);

166 i‡–!
¨gs
->
hódî_⁄ly
 )

168 
bcf1_t
 *
ªc
 = 
	`bcf_öô
();

169 
i
=0; i<
ƒegs
; i++)

171 
hts_ôr_t
 *
ôr
 = 
	`bcf_ôr_quîys
(
idx
,
hdr
,
ªgs
[
i
]);

172  
	`bcf_ôr_√xt
(
Â
, 
ôr
, 
ªc
) >=0 )

174 i‡–
ªg_idx
 && !
	`ªgidx_ovîœp
‘eg_idx, 
	`bcf_£q«me
(
hdr
,
ªc
),ªc->
pos
,ªc->pos+ªc->
æí
-1, 
NULL
) ) ;

175 
	`bcf_wrôe
(
out
,
hdr
,
ªc
);

177 
	`tbx_ôr_de°roy
(
ôr
);

179 
	`bcf_de°roy
(
ªc
);

181 i‡–
	`hts_˛o£
(
out
ËË
	`îr‹
("hts_closeÑeturnedÇon-zero status for stdout\n");

182 
	`bcf_hdr_de°roy
(
hdr
);

183 
	`hts_idx_de°roy
(
idx
);

185 i‡–
f‹m©
==
vcf
 || f‹m©==
ßm
 || f‹m©==
unknown_f‹m©
 )

187 
tbx_t
 *
tbx
 = 
	`tbx_ödex_lﬂd
(
‚ame
);

188 i‡–!
tbx
 ) 
	`îr‹
("CouldÇŸÜﬂd .tbi/.csòödex o‡%s\n", 
‚ame
);

189 
k°rög_t
 
°r
 = {0,0,0};

190 i‡–
¨gs
->
¥öt_hódî
 )

192  
	`hts_gëlöe
(
Â
, 
KS_SEP_LINE
, &
°r
) >= 0 )

194 i‡–!
°r
.
l
 || så.
s
[0]!=
tbx
->
c⁄f
.
mëa_ch¨
 ) ;

195 
	`puts
(
°r
.
s
);

198 i‡–!
¨gs
->
hódî_⁄ly
 )

200 
n£q
;

201 c⁄° **
£q
 = 
NULL
;

202 i‡–
ªg_idx
 ) 
£q
 = 
	`tbx_£q«mes
(
tbx
, &
n£q
);

203 
i
=0; i<
ƒegs
; i++)

205 
hts_ôr_t
 *
ôr
 = 
	`tbx_ôr_quîys
(
tbx
, 
ªgs
[
i
]);

206 i‡–!
ôr
 ) ;

207 
	`tbx_ôr_√xt
(
Â
, 
tbx
, 
ôr
, &
°r
) >= 0)

209 i‡–
ªg_idx
 && !
	`ªgidx_ovîœp
‘eg_idx,
£q
[
ôr
->
cuº_tid
],ôr->
cuº_beg
,ôr->
cuº_íd
, 
NULL
) ) ;

210 
	`puts
(
°r
.
s
);

212 
	`tbx_ôr_de°roy
(
ôr
);

214 
	`‰ì
(
£q
);

216 
	`‰ì
(
°r
.
s
);

217 
	`tbx_de°roy
(
tbx
);

219 i‡–
f‹m©
==
bam
 )

220 
	`îr‹
("Please use \"samtools view\" for querying BAM files.\n");

222 i‡–
ªg_idx
 ) 
	`ªgidx_de°roy
(reg_idx);

223 i‡–
	`hts_˛o£
(
Â
ËË
	`îr‹
("hts_˛o£Ñëu∫edÇ⁄-zîÿ°©us: %s\n", 
‚ame
);

225 
i
=0; i<
ƒegs
; i++Ë
	`‰ì
(
ªgs
[i]);

226 
	`‰ì
(
ªgs
);

228 
	}
}

229 
	$quîy_chroms
(*
‚ame
)

231 c⁄° **
£q
;

232 
i
, 
n£q
, 
·y≥
 = 
	`fûe_ty≥
(
‚ame
);

233 i‡–
·y≥
 & 
IS_TXT
 || !ftype )

235 
tbx_t
 *
tbx
 = 
	`tbx_ödex_lﬂd
(
‚ame
);

236 i‡–!
tbx
 ) 
	`îr‹
("CouldÇŸÜﬂd .tbòödex o‡%s\n", 
‚ame
);

237 
£q
 = 
	`tbx_£q«mes
(
tbx
, &
n£q
);

238 
i
=0; i<
n£q
; i++)

239 
	`¥ötf
("%s\n", 
£q
[
i
]);

240 
	`‰ì
(
£q
);

241 
	`tbx_de°roy
(
tbx
);

243 i‡–
·y≥
==
IS_BCF
 )

245 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
,"r");

246 i‡–!
Â
 ) 
	`îr‹
("CouldÇŸÑód %s\n", 
‚ame
);

247 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_ªad
(
Â
);

248 i‡–!
hdr
 ) 
	`îr‹
("CouldÇŸÑódÅhêhódî: %s\n", 
‚ame
);

249 
	`hts_˛o£
(
Â
);

250 
hts_idx_t
 *
idx
 = 
	`bcf_ödex_lﬂd
(
‚ame
);

251 i‡–!
idx
 ) 
	`îr‹
("CouldÇŸÜﬂd .csòödex o‡%s\n", 
‚ame
);

252 
£q
 = 
	`bcf_ödex_£q«mes
(
idx
, 
hdr
, &
n£q
);

253 
i
=0; i<
n£q
; i++)

254 
	`¥ötf
("%s\n", 
£q
[
i
]);

255 
	`‰ì
(
£q
);

256 
	`bcf_hdr_de°roy
(
hdr
);

257 
	`hts_idx_de°roy
(
idx
);

259 i‡–
·y≥
==
IS_BAM
 )

260 
	`îr‹
("BAM:Åodo\n");

262 
	}
}

264 
	$ªhódî_fûe
(c⁄° *
‚ame
, c⁄° *
hódî
, 
·y≥
, 
tbx_c⁄f_t
 *
c⁄f
)

266 i‡–
·y≥
 & 
IS_TXT
 || !ftype )

268 
BGZF
 *
Â
 = 
	`bgzf_›í
(
‚ame
,"r");

269 i‡–!
Â
 || 
	`bgzf_ªad_block
(ÂË!0 || !Â->
block_Àngth
 )  -1;

271 *
buf„r
 = 
Â
->
uncom¥es£d_block
;

272 
skù_u¡û
 = 0;

275 i‡–
buf„r
[0]==
c⁄f
->
mëa_ch¨
 )

277 
skù_u¡û
 = 1;

280 i‡–
buf„r
[
skù_u¡û
]=='\n' )

282 
skù_u¡û
++;

283 i‡–
skù_u¡û
>=
Â
->
block_Àngth
 )

285 i‡–
	`bgzf_ªad_block
(
Â
Ë!0 || !Â->
block_Àngth
 ) 
	`îr‹
("FIXME: Nÿbody i¿thêfûe: %s\n", 
‚ame
);

286 
skù_u¡û
 = 0;

289 i‡–
buf„r
[
skù_u¡û
]!=
c⁄f
->
mëa_ch¨
 ) ;

291 
skù_u¡û
++;

292 i‡–
skù_u¡û
>=
Â
->
block_Àngth
 )

294 i‡(
	`bgzf_ªad_block
(
Â
Ë!0 || !Â->
block_Àngth
Ë
	`îr‹
("FIXME: Nÿbody i¿thêfûe: %s\n", 
‚ame
);

295 
skù_u¡û
 = 0;

301 
FILE
 *
hdr
 = 
	`f›í
(
hódî
,"r");

302 i‡–!
hdr
 ) 
	`îr‹
("%s: %s", 
hódî
,
	`°ªº‹
(
î∫o
));

303 c⁄° 
size_t
 
∑ge_size
 = 32768;

304 *
buf
 = 
	`mÆloc
(
∑ge_size
);

305 
BGZF
 *
bgzf_out
 = 
	`bgzf_›í
("-", "w");

306 
ssize_t
 
ƒód
;

307  (
ƒód
=
	`‰ód
(
buf
,1,
∑ge_size
-1,
hdr
))>0 )

309 i‡–
ƒód
<
∑ge_size
-1 && 
buf
[nread-1]!='\n' ) buf[nread++] = '\n';

310 i‡(
	`bgzf_wrôe
(
bgzf_out
, 
buf
, 
ƒód
Ë< 0Ë
	`îr‹
("Eº‹: %d\n",bgzf_out->
îrcode
);

312 i‡–
	`f˛o£
(
hdr
ËË
	`îr‹
("˛o£ faûed: %s\n", 
hódî
);

315 i‡–
Â
->
block_Àngth
 - 
skù_u¡û
 > 0 )

317 i‡(
	`bgzf_wrôe
(
bgzf_out
, 
buf„r
+
skù_u¡û
, 
Â
->
block_Àngth
-skù_u¡ûË< 0Ë
	`îr‹
("Eº‹: %d\n",Â->
îrcode
);

319 i‡(
	`bgzf_Êush
(
bgzf_out
Ë< 0Ë
	`îr‹
("Eº‹: %d\n",bgzf_out->
îrcode
);

323 
ƒód
 = 
	`bgzf_øw_ªad
(
Â
, 
buf
, 
∑ge_size
);

324 i‡–
ƒód
<=0 ) ;

326 
cou¡
 = 
	`bgzf_øw_wrôe
(
bgzf_out
, 
buf
, 
ƒód
);

327 i‡(
cou¡
 !
ƒód
Ë
	`îr‹
("Write failed, wrote %d instead of %d bytes.\n", count,()nread);

329 i‡(
	`bgzf_˛o£
(
bgzf_out
Ë< 0Ë
	`îr‹
("Eº‹: %d\n",bgzf_out->
îrcode
);

330 i‡(
	`bgzf_˛o£
(
Â
Ë< 0Ë
	`îr‹
("Eº‹: %d\n",Â->
îrcode
);

331 
	`‰ì
(
buf
);

334 
	`îr‹
("todo:Ñeheader BCF, BAM\n");

336 
	}
}

338 
	$ußge
()

340 
	`Ârötf
(
°dîr
, "\n");

341 
	`Ârötf
(
°dîr
, "Vîsi⁄: %s\n", 
	`hts_vîsi⁄
());

342 
	`Ârötf
(
°dîr
, "Usage:Åabix [OPTIONS] [FILE] [REGION [...]]\n");

343 
	`Ârötf
(
°dîr
, "\n");

344 
	`Ârötf
(
°dîr
, "Indexing Options:\n");

345 
	`Ârötf
(
°dîr
, " -0, --zero-based coordinatesáre zero-based\n");

346 
	`Ârötf
(
°dîr
, " -b, --begin INT columnÇumber forÑegion start [4]\n");

347 
	`Ârötf
(
°dîr
, " -c, --comment CHAR skip commentÜines starting with CHAR [null]\n");

348 
	`Ârötf
(
°dîr
, " -C, --csi generate CSI index for VCF (default is TBI)\n");

349 
	`Ârötf
(
°dîr
, " -e, --end INT columnÇumber forÑegionÉnd (ifÇoÉnd, set INTÅo -b) [5]\n");

350 
	`Ârötf
(
°dîr
, " -f, --force overwriteÉxisting index withoutásking\n");

351 
	`Ârötf
(
°dîr
, " -m, --min-shift INT set minimal interval size for CSI indicesÅo 2^INT [14]\n");

352 
	`Ârötf
(
°dîr
, " -p, --preset STR gff, bed, sam, vcf\n");

353 
	`Ârötf
(
°dîr
, " -s, --sequence INT columnÇumber for sequenceÇames (suppressed by -p) [1]\n");

354 
	`Ârötf
(
°dîr
, " -S, --skip-lines INT skip first INTÜines [0]\n");

355 
	`Ârötf
(
°dîr
, "\n");

356 
	`Ârötf
(
°dîr
, "Queryingánd other options:\n");

357 
	`Ârötf
(
°dîr
, " -h, --print-headerÖrintálsoÅhe headerÜines\n");

358 
	`Ârötf
(
°dîr
, " -H, --only-headerÖrint onlyÅhe headerÜines\n");

359 
	`Ârötf
(
°dîr
, " -l, --list-chromsÜist chromosomeÇames\n");

360 
	`Ârötf
(
°dîr
, " -r, --reheader FILEÑeplaceÅhe header withÅhe content of FILE\n");

361 
	`Ârötf
(
°dîr
, " -R, --regions FILEÑestrictÅoÑegionsÜisted inÅhe file\n");

362 
	`Ârötf
(
°dîr
, " -T, --targets FILE similarÅo -R but streamsÑatherÅhan index-jumps\n");

363 
	`Ârötf
(
°dîr
, "\n");

365 
	}
}

367 
	$maö
(
¨gc
, *
¨gv
[])

369 
c
, 
dëe˘
 = 1, 
mö_shi·
 = 0, 
is_f‹˚
 = 0, 
li°_chroms
 = 0, 
do_csi
 = 0;

370 
tbx_c⁄f_t
 
c⁄f
 = 
tbx_c⁄f_gff
;

371 *
ªhódî
 = 
NULL
;

372 
¨gs_t
 
¨gs
;

373 
	`mem£t
(&
¨gs
,0,(
¨gs_t
));

375 c⁄° 
›ti⁄
 
l›ti⁄s
[] =

377 {"hñp", 
no_¨gumít
, 
NULL
, 2},

378 {"ªgi⁄s", 
ªquúed_¨gumít
, 
NULL
, 'R'},

379 {"èrgës", 
ªquúed_¨gumít
, 
NULL
, 'T'},

380 {"csi", 
no_¨gumít
, 
NULL
, 'C'},

381 {"zîo-ba£d", 
no_¨gumít
, 
NULL
, '0'},

382 {"¥öt-hódî", 
no_¨gumít
, 
NULL
, 'h'},

383 {"⁄ly-hódî", 
no_¨gumít
, 
NULL
, 'H'},

384 {"begö", 
ªquúed_¨gumít
, 
NULL
, 'b'},

385 {"commít", 
ªquúed_¨gumít
, 
NULL
, 'c'},

386 {"íd", 
ªquúed_¨gumít
, 
NULL
, 'e'},

387 {"f‹˚", 
no_¨gumít
, 
NULL
, 'f'},

388 {"¥e£t", 
ªquúed_¨gumít
, 
NULL
, 'p'},

389 {"£quí˚", 
ªquúed_¨gumít
, 
NULL
, 's'},

390 {"skù-löes", 
ªquúed_¨gumít
, 
NULL
, 'S'},

391 {"li°-chroms", 
no_¨gumít
, 
NULL
, 'l'},

392 {"ªhódî", 
ªquúed_¨gumít
, 
NULL
, 'r'},

393 {"vîsi⁄", 
no_¨gumít
, 
NULL
, 1},

394 {
NULL
, 0, NULL, 0}

397 *
tmp
;

398 (
c
 = 
	`gë›t_l⁄g
(
¨gc
, 
¨gv
, "hH?0b:c:e:fm:p:s:S:Ã:CR:T:", 
l›ti⁄s
,
NULL
)) >= 0)

400 
c
)

402 'R': 
¨gs
.
ªgi⁄s_‚ame
 = 
›èrg
; ;

403 'T': 
¨gs
.
èrgës_‚ame
 = 
›èrg
; ;

404 'C': 
do_csi
 = 1; ;

405 'r': 
ªhódî
 = 
›èrg
; ;

406 'h': 
¨gs
.
¥öt_hódî
 = 1; ;

407 'H': 
¨gs
.
¥öt_hódî
 = 1;árgs.
hódî_⁄ly
 = 1; ;

408 'l': 
li°_chroms
 = 1; ;

409 '0': 
c⁄f
.
¥e£t
 |
TBX_UCSC
; 
dëe˘
 = 0; ;

411 
c⁄f
.
bc
 = 
	`°πﬁ
(
›èrg
,&
tmp
,10);

412 i‡–*
tmp
 ) 
	`îr‹
("CouldÇŸÖ¨£árgumít: -b %s\n", 
›èrg
);

413 
dëe˘
 = 0;

416 
c⁄f
.
ec
 = 
	`°πﬁ
(
›èrg
,&
tmp
,10);

417 i‡–*
tmp
 ) 
	`îr‹
("CouldÇŸÖ¨£árgumít: -ê%s\n", 
›èrg
);

418 
dëe˘
 = 0;

420 'c': 
c⁄f
.
mëa_ch¨
 = *
›èrg
; 
dëe˘
 = 0; ;

421 'f': 
is_f‹˚
 = 1; ;

423 
mö_shi·
 = 
	`°πﬁ
(
›èrg
,&
tmp
,10);

424 i‡–*
tmp
 ) 
	`îr‹
("CouldÇŸÖ¨£árgumít: -m %s\n", 
›èrg
);

427 
dëe˘
 = 0;

428 i‡(
	`°rcmp
(
›èrg
, "gff"Ë=0Ë
c⁄f
 = 
tbx_c⁄f_gff
;

429 i‡(
	`°rcmp
(
›èrg
, "bed"Ë=0Ë
c⁄f
 = 
tbx_c⁄f_bed
;

430 i‡(
	`°rcmp
(
›èrg
, "ßm"Ë=0Ë
c⁄f
 = 
tbx_c⁄f_ßm
;

431 i‡(
	`°rcmp
(
›èrg
, "vcf"Ë=0Ë
c⁄f
 = 
tbx_c⁄f_vcf
;

432 i‡(
	`°rcmp
(
›èrg
, "bcf"Ë=0Ë
dëe˘
 = 1;

433 i‡(
	`°rcmp
(
›èrg
, "bam"Ë=0Ë
dëe˘
 = 1;

434 
	`îr‹
("Thê¥e£à°rögÇŸÑecogni£d: '%s'\n", 
›èrg
);

437 
c⁄f
.
sc
 = 
	`°πﬁ
(
›èrg
,&
tmp
,10);

438 i‡–*
tmp
 ) 
	`îr‹
("CouldÇŸÖ¨£árgumít: -†%s\n", 
›èrg
);

439 
dëe˘
 = 0;

442 
c⁄f
.
löe_skù
 = 
	`°πﬁ
(
›èrg
,&
tmp
,10);

443 i‡–*
tmp
 ) 
	`îr‹
("CouldÇŸÖ¨£árgumít: -S %s\n", 
›èrg
);

444 
dëe˘
 = 0;

447 
	`¥ötf
(

449 "C›yrighà(CË2017 GíomêRe£¨ch Ltd.\n", 
	`hts_vîsi⁄
());

450  
EXIT_SUCCESS
;

451 :  
	`ußge
();

455 i‡–
›töd
==
¨gc
 )  
	`ußge
();

457 i‡–
li°_chroms
 )

458  
	`quîy_chroms
(
¨gv
[
›töd
]);

460 i‡–
¨gc
 > 
›töd
+1 || 
¨gs
.
hódî_⁄ly
 ||árgs.
ªgi⁄s_‚ame
 ||árgs.
èrgës_‚ame
 )

462 
ƒegs
 = 0;

463 **
ªgs
 = 
NULL
;

464 i‡–!
¨gs
.
hódî_⁄ly
 )

465 
ªgs
 = 
	`∑r£_ªgi⁄s
(
¨gs
.
ªgi⁄s_‚ame
, 
¨gv
+
›töd
+1, 
¨gc
-›töd-1, &
ƒegs
);

466  
	`quîy_ªgi⁄s
(&
¨gs
, 
¨gv
[
›töd
], 
ªgs
, 
ƒegs
);

469 *
‚ame
 = 
¨gv
[
›töd
];

470 
·y≥
 = 
	`fûe_ty≥
(
‚ame
);

471 i‡–
dëe˘
 )

473 i‡–
·y≥
==
IS_GFF
 ) 
c⁄f
 = 
tbx_c⁄f_gff
;

474 i‡–
·y≥
==
IS_BED
 ) 
c⁄f
 = 
tbx_c⁄f_bed
;

475 i‡–
·y≥
==
IS_SAM
 ) 
c⁄f
 = 
tbx_c⁄f_ßm
;

476 i‡–
·y≥
==
IS_VCF
 )

478 
c⁄f
 = 
tbx_c⁄f_vcf
;

479 i‡–!
mö_shi·
 && 
do_csi
 ) min_shift = 14;

481 i‡–
·y≥
==
IS_BCF
 )

483 i‡–!
mö_shi·
 ) min_shift = 14;

485 i‡–
·y≥
==
IS_BAM
 )

487 i‡–!
mö_shi·
 ) min_shift = 14;

490 i‡–
do_csi
 )

492 i‡–!
mö_shi·
 ) min_shift = 14;

493 
mö_shi·
 *
do_csi
;

495 i‡–
mö_shi·
!=0 && !
do_csi
 ) do_csi = 1;

497 i‡–
ªhódî
 )

498  
	`ªhódî_fûe
(
‚ame
, 
ªhódî
, 
·y≥
, &
c⁄f
);

500 *
suffix
 = ".tbi";

501 i‡–
do_csi
 ) 
suffix
 = ".csi";

502 i‡–
·y≥
==
IS_BAM
 ) 
suffix
 = ".bai";

503 i‡–
·y≥
==
IS_CRAM
 ) 
suffix
 = ".crai";

505 *
idx_‚ame
 = 
	`ˇŒoc
(
	`°æí
(
‚ame
) + 5, 1);

506 
	`°rˇt
(
	`°r˝y
(
idx_‚ame
, 
‚ame
), 
suffix
);

508 
°©
 
°©_tbi
, 
°©_fûe
;

509 i‡–!
is_f‹˚
 && 
	`°©
(
idx_‚ame
, &
°©_tbi
)==0 )

514 
	`°©
(
‚ame
, &
°©_fûe
);

515 i‡–
°©_fûe
.
°_mtime
 <
°©_tbi
.st_mtime )

516 
	`îr‹
("[tabix]Åhe index fileÉxists. Please use '-f'Åo overwrite.\n");

518 
	`‰ì
(
idx_‚ame
);

520 i‡–
·y≥
==
IS_CRAM
 )

522 i‡–
	`bam_ödex_buûd
(
‚ame
, 
mö_shi·
)!=0 ) 
	`îr‹
("bam_index_build failed: %s\n", fname);

525 i‡–
do_csi
 )

527 i‡–
·y≥
==
IS_BCF
 )

529 i‡–
	`bcf_ödex_buûd
(
‚ame
, 
mö_shi·
)!=0 ) 
	`îr‹
("bcf_index_build failed: %s\n", fname);

532 i‡–
·y≥
==
IS_BAM
 )

534 i‡–
	`bam_ödex_buûd
(
‚ame
, 
mö_shi·
)!=0 ) 
	`îr‹
("bam_index_build failed: %s\n", fname);

537 i‡–
	`tbx_ödex_buûd
(
‚ame
, 
mö_shi·
, &
c⁄f
)!=0 ) 
	`îr‹
("tbx_index_build failed: %s\n", fname);

542 i‡–
	`tbx_ödex_buûd
(
‚ame
, 
mö_shi·
, &
c⁄f
ËË
	`îr‹
("tbx_index_build failed: %s\n", fname);

546 
	}
}

	@htslib/tbx.c

26 
	~<c⁄fig.h
>

28 
	~<°dlib.h
>

29 
	~<°rög.h
>

30 
	~<°dio.h
>

31 
	~<as£π.h
>

32 
	~<î∫o.h
>

33 
	~"ht¶ib/tbx.h
"

34 
	~"ht¶ib/bgzf.h
"

35 
	~"ht¶ib/hts_ídün.h
"

36 
	~"hts_öã∫Æ.h
"

38 
	~"ht¶ib/khash.h
"

39 
	$KHASH_DECLARE
(
s2i
, 
kh_c°r_t
, 
öt64_t
)

41 c⁄° 
tbx_c⁄f_t
 
tbx_c⁄f_gff
 = { 0, 1, 4, 5, '#', 0 
	}
};

42 c⁄° 
tbx_c⁄f_t
 
	gtbx_c⁄f_bed
 = { 
TBX_UCSC
, 1, 2, 3, '#', 0 };

43 c⁄° 
tbx_c⁄f_t
 
	gtbx_c⁄f_p¶tbl
 = { 
TBX_UCSC
, 15, 17, 18, '#', 0 };

44 c⁄° 
tbx_c⁄f_t
 
	gtbx_c⁄f_ßm
 = { 
TBX_SAM
, 3, 4, 0, '@', 0 };

45 c⁄° 
tbx_c⁄f_t
 
	gtbx_c⁄f_vcf
 = { 
TBX_VCF
, 1, 2, 0, '#', 0 };

48 
öt64_t
 
	mbeg
, 
	míd
;

49 *
	mss
, *
	m£
;

50 
	mtid
;

51 } 
	ttbx_ötv_t
;

53 
ölöe
 
	$gë_tid
(
tbx_t
 *
tbx
, c⁄° *
ss
, 
is_add
)

55 
khöt_t
 
k
;

56 
	`khash_t
(
s2i
Ë*
d
;

57 i‡(
tbx
->
di˘
 =0Ëtbx->di˘ = 
	`kh_öô
(
s2i
);

58 
d
 = (
	`khash_t
(
s2i
)*)
tbx
->
di˘
;

59 i‡(
is_add
) {

60 
ab£¡
;

61 
k
 = 
	`kh_put
(
s2i
, 
d
, 
ss
, &
ab£¡
);

62 i‡(
ab£¡
 < 0) {

64 } i‡(
ab£¡
) {

65 *
ss_dup
 = 
	`°rdup
(
ss
);

66 i‡(
ss_dup
) {

67 
	`kh_key
(
d
, 
k
Ë
ss_dup
;

68 
	`kh_vÆ
(
d
, 
k
Ë
	`kh_size
(d) - 1;

70 
	`kh_dñ
(
s2i
, 
d
, 
k
);

74 } 
k
 = 
	`kh_gë
(
s2i
, 
d
, 
ss
);

75  
k
 =
	`kh_íd
(
d
)? -1 : 
	`kh_vÆ
(d, k);

76 
	}
}

78 
	$tbx_«me2id
(
tbx_t
 *
tbx
, c⁄° *
ss
)

80  
	`gë_tid
(
tbx
, 
ss
, 0);

81 
	}
}

83 
	$tbx_∑r£1
(c⁄° 
tbx_c⁄f_t
 *
c⁄f
, 
Àn
, *
löe
, 
tbx_ötv_t
 *
ötv
)

85 
i
, 
b
 = 0, 
id
 = 1, 
ncﬁs
 = 0;

86 *
s
;

87 
ötv
->
ss
 = i¡v->
£
 = 0; i¡v->
beg
 = i¡v->
íd
 = -1;

88 
i
 = 0; i <
Àn
; ++i) {

89 i‡(
löe
[
i
] == '\t' ||Üine[i] == 0) {

90 ++
ncﬁs
;

91 i‡(
id
 =
c⁄f
->
sc
) {

92 
ötv
->
ss
 = 
löe
 + 
b
; i¡v->
£
 =Üöê+ 
i
;

93 } i‡(
id
 =
c⁄f
->
bc
) {

95 
ötv
->
beg
 = i¡v->
íd
 = 
	`°πﬁ
(
löe
 + 
b
, &
s
, 0);

96 i‡–
s
==
löe
+
b
 )  -1;

97 i‡(!(
c⁄f
->
¥e£t
&
TBX_UCSC
)Ë--
ötv
->
beg
;

98 ++
ötv
->
íd
;

99 i‡(
ötv
->
beg
 < 0) intv->beg = 0;

100 i‡(
ötv
->
íd
 < 1) intv->end = 1;

102 i‡((
c⁄f
->
¥e£t
&0xffffË=
TBX_GENERIC
) {

103 i‡(
id
 =
c⁄f
->
ec
)

105 
ötv
->
íd
 = 
	`°πﬁ
(
löe
 + 
b
, &
s
, 0);

106 i‡–
s
==
löe
+
b
 )  -1;

108 } i‡((
c⁄f
->
¥e£t
&0xffffË=
TBX_SAM
) {

109 i‡(
id
 == 6) {

110 
l
 = 0;

111 *
t
;

112 
s
 = 
löe
 + 
b
; s <Üöê+ 
i
;) {

113 
x
 = 
	`°πﬁ
(
s
, &
t
, 10);

114 
›
 = 
	`touµî_c
(*
t
);

115 i‡(
›
 ='M' || o∞='D' || o∞='N'Ë
l
 +
x
;

116 
s
 = 
t
 + 1;

118 i‡(
l
 == 0)Ü = 1;

119 
ötv
->
íd
 = i¡v->
beg
 + 
l
;

121 } i‡((
c⁄f
->
¥e£t
&0xffffË=
TBX_VCF
) {

122 i‡(
id
 == 4) {

123 i‡(
b
 < 
i
Ë
ötv
->
íd
 = i¡v->
beg
 + (i - b);

124 } i‡(
id
 == 8) {

125 
c
 = 
löe
[
i
];

126 
löe
[
i
] = 0;

127 
s
 = 
	`°r°r
(
löe
 + 
b
, "END=");

128 i‡(
s
 =
löe
 + 
b
) s += 4;

129 i‡(
s
) {

130 
s
 = 
	`°r°r
(
löe
 + 
b
, ";END=");

131 i‡(
s
) s += 5;

133 i‡(
s
Ë
ötv
->
íd
 = 
	`°πﬁ
(s, &s, 0);

134 
löe
[
i
] = 
c
;

138 
b
 = 
i
 + 1;

139 ++
id
;

142 i‡(
ötv
->
ss
 =0 || i¡v->
£
 =0 || i¡v->
beg
 < 0 || i¡v->
íd
 < 0)  -1;

144 
	}
}

146 
ölöe
 
	$gë_ötv
(
tbx_t
 *
tbx
, 
k°rög_t
 *
°r
, 
tbx_ötv_t
 *
ötv
, 
is_add
)

148 i‡(
	`tbx_∑r£1
(&
tbx
->
c⁄f
, 
°r
->
l
, så->
s
, 
ötv
) == 0) {

149 
c
 = *
ötv
->
£
;

150 *
ötv
->
£
 = '\0'; i¡v->
tid
 = 
	`gë_tid
(
tbx
, i¡v->
ss
, 
is_add
); *ötv->£ = 
c
;

151  (
ötv
->
tid
 >0 && i¡v->
beg
 >0 && i¡v->
íd
 >= 0)? 0 : -1;

153 *
ty≥
 = 
NULL
;

154 
tbx
->
c⁄f
.
¥e£t
&0xffff)

156 
TBX_SAM
: 
ty≥
 = "TBX_SAM"; ;

157 
TBX_VCF
: 
ty≥
 = "TBX_VCF"; ;

158 
TBX_UCSC
: 
ty≥
 = "TBX_UCSC"; ;

159 : 
ty≥
 = "TBX_GENERIC"; ;

161 
	`Ârötf
(
°dîr
, "[E::%s] faûedÅÿ∑r£ %s, wa†wr⁄g -∞[ty≥] u£d?\nThêof„ndögÜöêwas: \"%s\"\n", 
__func__
, 
ty≥
, 
°r
->
s
);

164 
	}
}

166 
	$tbx_ªadªc
(
BGZF
 *
Â
, *
tbxv
, *
sv
, *
tid
, *
beg
, *
íd
)

168 
tbx_t
 *
tbx
 = (tbx_à*Ë
tbxv
;

169 
k°rög_t
 *
s
 = (k°rög_à*Ë
sv
;

170 
ªt
;

171 i‡((
ªt
 = 
	`bgzf_gëlöe
(
Â
, '\n', 
s
)) >= 0) {

172 
tbx_ötv_t
 
ötv
;

173 
	`gë_ötv
(
tbx
, 
s
, &
ötv
, 0);

174 *
tid
 = 
ötv
.tid; *
beg
 = i¡v.beg; *
íd
 = intv.end;

176  
ªt
;

177 
	}
}

179 
	$tbx_£t_mëa
(
tbx_t
 *
tbx
)

181 
i
, 
l
 = 0, 
l_nm
;

182 
uöt32_t
 
x
[7];

183 **
«me
;

184 
uöt8_t
 *
mëa
;

185 
khöt_t
 
k
;

186 
	`khash_t
(
s2i
Ë*
d
 = (khash_t(s2i)*)
tbx
->
di˘
;

188 
	`mem˝y
(
x
, &
tbx
->
c⁄f
, 24);

189 
«me
 = (**)
	`mÆloc
((*Ë* 
	`kh_size
(
d
));

190 
k
 = 
	`kh_begö
(
d
), 
l
 = 0; k !
	`kh_íd
(d); ++k) {

191 i‡(!
	`kh_exi°
(
d
, 
k
)) ;

192 
«me
[
	`kh_vÆ
(
d
, 
k
)] = (*)
	`kh_key
(d, k);

193 
l
 +
	`°æí
(
	`kh_key
(
d
, 
k
)) + 1;

195 
l_nm
 = 
x
[6] = 
l
;

196 
mëa
 = (
uöt8_t
*)
	`mÆloc
(
l_nm
 + 28);

197 i‡(
	`ed_is_big
())

198 
i
 = 0; i < 7; ++i)

199 
x
[
i
] = 
	`ed_sw≠_4
(x[i]);

200 
	`mem˝y
(
mëa
, 
x
, 28);

201 
l
 = 28, 
i
 = 0; i < ()
	`kh_size
(
d
); ++i) {

202 
x
 = 
	`°æí
(
«me
[
i
]) + 1;

203 
	`mem˝y
(
mëa
 + 
l
, 
«me
[
i
], 
x
);

204 
l
 +
x
;

206 
	`‰ì
(
«me
);

207 
	`hts_idx_£t_mëa
(
tbx
->
idx
, 
l
, 
mëa
, 0);

208 
	}
}

210 
tbx_t
 *
	$tbx_ödex
(
BGZF
 *
Â
, 
mö_shi·
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
)

212 
tbx_t
 *
tbx
;

213 
k°rög_t
 
°r
;

214 
ªt
, 
fú°
 = 0, 
n_lvls
, 
fmt
;

215 
öt64_t
 
löío
 = 0;

216 
uöt64_t
 
œ°_off
 = 0;

217 
tbx_ötv_t
 
ötv
;

219 
°r
.
s
 = 0; så.
l
 = så.
m
 = 0;

220 
tbx
 = (
tbx_t
*)
	`ˇŒoc
(1, (tbx_t));

221 
tbx
->
c⁄f
 = *conf;

222 i‡(
mö_shi·
 > 0Ë
n_lvls
 = (
TBX_MAX_SHIFT
 - mö_shi· + 2Ë/ 3, 
fmt
 = 
HTS_FMT_CSI
;

223 
mö_shi·
 = 14, 
n_lvls
 = 5, 
fmt
 = 
HTS_FMT_TBI
;

224 (
ªt
 = 
	`bgzf_gëlöe
(
Â
, '\n', &
°r
)) >= 0) {

225 ++
löío
;

226 i‡(
löío
 <
tbx
->
c⁄f
.
löe_skù
 || 
°r
.
s
[0] =tbx->c⁄f.
mëa_ch¨
) {

227 
œ°_off
 = 
	`bgzf_ãŒ
(
Â
);

230 i‡(
fú°
 == 0) {

231 
tbx
->
idx
 = 
	`hts_idx_öô
(0, 
fmt
, 
œ°_off
, 
mö_shi·
, 
n_lvls
);

232 
fú°
 = 1;

234 
	`gë_ötv
(
tbx
, &
°r
, &
ötv
, 1);

235 
ªt
 = 
	`hts_idx_push
(
tbx
->
idx
, 
ötv
.
tid
, i¡v.
beg
, i¡v.
íd
, 
	`bgzf_ãŒ
(
Â
), 1);

236 i‡(
ªt
 < 0)

238 
	`‰ì
(
°r
.
s
);

239 
	`tbx_de°roy
(
tbx
);

240  
NULL
;

243 i‡–!
tbx
->
idx
 )Åbx->idx = 
	`hts_idx_öô
(0, 
fmt
, 
œ°_off
, 
mö_shi·
, 
n_lvls
);

244 i‡–!
tbx
->
di˘
 )Åbx->di˘ = 
	`kh_öô
(
s2i
);

245 
	`hts_idx_föish
(
tbx
->
idx
, 
	`bgzf_ãŒ
(
Â
));

246 
	`tbx_£t_mëa
(
tbx
);

247 
	`‰ì
(
°r
.
s
);

248  
tbx
;

249 
	}
}

251 
	$tbx_de°roy
(
tbx_t
 *
tbx
)

253 
	`khash_t
(
s2i
Ë*
d
 = (khash_t(s2i)*)
tbx
->
di˘
;

254 i‡(
d
 !
NULL
)

256 
khöt_t
 
k
;

257 
k
 = 
	`kh_begö
(
d
); k !
	`kh_íd
(d); ++k)

258 i‡(
	`kh_exi°
(
d
, 
k
)Ë
	`‰ì
((*)
	`kh_key
(d, k));

260 
	`hts_idx_de°roy
(
tbx
->
idx
);

261 
	`kh_de°roy
(
s2i
, 
d
);

262 
	`‰ì
(
tbx
);

263 
	}
}

265 
	$tbx_ödex_buûd3
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, 
n_thªads
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
)

267 
tbx_t
 *
tbx
;

268 
BGZF
 *
Â
;

269 
ªt
;

270 i‡((
Â
 = 
	`bgzf_›í
(
‚
, "r")) == 0)  -1;

271 i‡–
n_thªads
 ) 
	`bgzf_mt
(
Â
,Ç_threads, 256);

272 i‡–
	`bgzf_com¥essi⁄
(
Â
Ë!
bgzf
 ) { 
	`bgzf_˛o£
(fp);  -1; }

273 
tbx
 = 
	`tbx_ödex
(
Â
, 
mö_shi·
, 
c⁄f
);

274 
	`bgzf_˛o£
(
Â
);

275 i‡–!
tbx
 )  -1;

276 
ªt
 = 
	`hts_idx_ßve_as
(
tbx
->
idx
, 
‚
, 
‚idx
, 
mö_shi·
 > 0? 
HTS_FMT_CSI
 : 
HTS_FMT_TBI
);

277 
	`tbx_de°roy
(
tbx
);

278  
ªt
;

279 
	}
}

281 
	$tbx_ödex_buûd2
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
)

283  
	`tbx_ödex_buûd3
(
‚
, 
‚idx
, 
mö_shi·
, 0, 
c⁄f
);

284 
	}
}

286 
	$tbx_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
, c⁄° 
tbx_c⁄f_t
 *
c⁄f
)

288  
	`tbx_ödex_buûd3
(
‚
, 
NULL
, 
mö_shi·
, 0, 
c⁄f
);

289 
	}
}

291 
tbx_t
 *
	$tbx_ödex_lﬂd2
(c⁄° *
‚
, c⁄° *
‚idx
)

293 
tbx_t
 *
tbx
;

294 
uöt8_t
 *
mëa
;

295 *
nm
, *
p
;

296 
uöt32_t
 
l_mëa
, 
l_nm
;

297 
tbx
 = (
tbx_t
*)
	`ˇŒoc
(1, (tbx_t));

298 
tbx
->
idx
 = 
‚idx
? 
	`hts_idx_lﬂd2
(
‚
, fnidxË: 
	`hts_idx_lﬂd
(‚, 
HTS_FMT_TBI
);

299 i‡–!
tbx
->
idx
 )

301 
	`‰ì
(
tbx
);

302  
NULL
;

304 
mëa
 = 
	`hts_idx_gë_mëa
(
tbx
->
idx
, &
l_mëa
);

305 i‡–!
mëa
 || 
l_mëa
 < 28Ë
övÆid
;

307 
tbx
->
c⁄f
.
¥e£t
 = 
	`À_to_i32
(&
mëa
[0]);

308 
tbx
->
c⁄f
.
sc
 = 
	`À_to_i32
(&
mëa
[4]);

309 
tbx
->
c⁄f
.
bc
 = 
	`À_to_i32
(&
mëa
[8]);

310 
tbx
->
c⁄f
.
ec
 = 
	`À_to_i32
(&
mëa
[12]);

311 
tbx
->
c⁄f
.
mëa_ch¨
 = 
	`À_to_i32
(&
mëa
[16]);

312 
tbx
->
c⁄f
.
löe_skù
 = 
	`À_to_i32
(&
mëa
[20]);

313 
l_nm
 = 
	`À_to_u32
(&
mëa
[24]);

314 i‡(
l_nm
 > 
l_mëa
 - 28Ë
övÆid
;

316 
p
 = 
nm
 = (*)
mëa
 + 28;

320 ; 
p
 - 
nm
 < 
l_nm
;Ö +
	`°æí
(p) + 1) {

321 i‡(
	`gë_tid
(
tbx
, 
p
, 1) < 0) {

322 
	`Ârötf
(
°dîr
, "[E::%s] %s\n", 
__func__
, 
	`°ªº‹
(
î∫o
));

323 
Áû
;

326  
tbx
;

328 
övÆid
:

329 i‡(
hts_vîbo£
 >= 1) {

330 
	`Ârötf
(
°dîr
, "[E::%s] Invalid index header for %s\n",

331 
__func__
, 
‚idx
 ? fnidx : 
‚
);

333 
Áû
:

334 
	`tbx_de°roy
(
tbx
);

335  
NULL
;

336 
	}
}

338 
tbx_t
 *
	$tbx_ödex_lﬂd
(c⁄° *
‚
)

340  
	`tbx_ödex_lﬂd2
(
‚
, 
NULL
);

341 
	}
}

343 c⁄° **
	$tbx_£q«mes
(
tbx_t
 *
tbx
, *
n
)

345 
	`khash_t
(
s2i
Ë*
d
 = (khash_t(s2i)*)
tbx
->
di˘
;

346 i‡(
d
 =
NULL
)

348 *
n
 = 0;

349  
NULL
;

351 
tid
, 
m
 = 
	`kh_size
(
d
);

352 c⁄° **
«mes
 = (c⁄° **Ë
	`ˇŒoc
(
m
,(const *));

353 
khöt_t
 
k
;

354 
k
=
	`kh_begö
(
d
); k<
	`kh_íd
(d); k++)

356 i‡–!
	`kh_exi°
(
d
,
k
) ) ;

357 
tid
 = 
	`kh_vÆ
(
d
,
k
);

358 
	`as£π
–
tid
<
m
 );

359 
«mes
[
tid
] = 
	`kh_key
(
d
,
k
);

362 
tid
=0;Åid<
m
;Åid++)

363 
	`as£π
(
«mes
[
tid
]);

364 *
n
 = 
m
;

365  
«mes
;

366 
	}
}

	@htslib/test/fieldarith.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

29 
	~"ht¶ib/ßm.h
"

31 
	g¡e°s
 = 0;

32 
	gnÁûuªs
 = 0;

34 
	$check
(c⁄° 
bam1_t
 *
Æn
, c⁄° *
ã°«me
, c⁄° *
èg
, 
vÆue
)

36 
öt32_t
 
ªfvÆue
;

37 
uöt8_t
 *
aux
 = 
	`bam_aux_gë
(
Æn
, 
èg
);

38 i‡(!
aux
) ;

39 
¡e°s
++;

40 
ªfvÆue
 = 
	`bam_aux2i
(
aux
);

41 i‡(
vÆue
 !
ªfvÆue
) {

42 
	`Ârötf
(
°dîr
, "%s FAIL for %s: computed %d != %dÉxpected\n",

43 
ã°«me
, 
	`bam_gë_q«me
(
Æn
), 
vÆue
, 
ªfvÆue
);

44 
nÁûuªs
++;

46 
	}
}

48 
	$maö
(
¨gc
, **
¨gv
)

50 
bam_hdr_t
 *
hódî
;

51 
bam1_t
 *
Æn
 = 
	`bam_öô1
();

52 
i
;

54 
i
 = 1; i < 
¨gc
; i++) {

55 
ßmFûe
 *
ö
 = 
	`ßm_›í
(
¨gv
[
i
], "r");

56 i‡(
ö
 =
NULL
Ë{ 
	`≥º‹
(
¨gv
[1]);  1; }

58 
hódî
 = 
	`ßm_hdr_ªad
(
ö
);

59 
	`ßm_ªad1
(
ö
, 
hódî
, 
Æn
) >= 0) {

60 
	`check
(
Æn
, "cigar2qlen", "XQ",

61 
	`bam_cig¨2qÀn
(
Æn
->
c‹e
.
n_cig¨
, 
	`bam_gë_cig¨
(aln)));

62 
	`check
(
Æn
, "cigar2rlen", "XR",

63 
	`bam_cig¨2æí
(
Æn
->
c‹e
.
n_cig¨
, 
	`bam_gë_cig¨
(aln)));

64 
	`check
(
Æn
, "ídpos", "XE", 
	`bam_ídpos
(aln));

67 
	`bam_hdr_de°roy
(
hódî
);

68 
	`ßm_˛o£
(
ö
);

71 
	`bam_de°roy1
(
Æn
);

73  (
nÁûuªs
 > 0);

74 
	}
}

	@htslib/test/hfile.c

25 
	~<c⁄fig.h
>

27 
	~<°d¨g.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<î∫o.h
>

32 
	~<sys/°©.h
>

34 
	~"ht¶ib/hfûe.h
"

35 
	~"ht¶ib/hts_defs.h
"

37 
HTS_NORETURN
 
	$Áû
(c⁄° *
f‹m©
, ...)

39 
îr
 = 
î∫o
;

40 
va_li°
 
¨gs
;

41 
	`va_°¨t
(
¨gs
, 
f‹m©
);

42 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨gs
);

43 
	`va_íd
(
¨gs
);

44 i‡(
îr
 !0Ë
	`Ârötf
(
°dîr
, ": %s", 
	`°ªº‹
(err));

45 
	`Ârötf
(
°dîr
, "\n");

46 
	`exô
(
EXIT_FAILURE
);

47 
	}
}

49 
	$check_off£t
(
hFILE
 *
f
, 
off_t
 
off
, c⁄° *
mesßge
)

51 
off_t
 
ªt
 = 
	`hãŒ
(
f
);

52 i‡(
ªt
 < 0Ë
	`Áû
("hãŒ(%s)", 
mesßge
);

53 i‡(
ªt
 =
off
) ;

55 
	`Ârötf
(
°dîr
, "%s offset incorrect:Éxpected %ld but got %ld\n",

56 
mesßge
, ()
off
, ()
ªt
);

57 
	`exô
(
EXIT_FAILURE
);

58 
	}
}

60 *
	$¶uΩ
(c⁄° *
fûíame
)

62 *
ãxt
;

63 
°©
 
sbuf
;

64 
size_t
 
fûesize
;

65 
FILE
 *
f
 = 
	`f›í
(
fûíame
, "r");

66 i‡(
f
 =
NULL
Ë
	`Áû
("f›í(\"%s\", \"r\")", 
fûíame
);

67 i‡(
	`f°©
(
	`fûío
(
f
), &
sbuf
Ë!0Ë
	`Áû
("f°©(\"%s\")", 
fûíame
);

68 
fûesize
 = 
sbuf
.
°_size
;

70 
ãxt
 = (*Ë
	`mÆloc
(
fûesize
 + 1);

71 i‡(
ãxt
 =
NULL
Ë
	`Áû
("malloc(text)");

73 i‡(
	`‰ód
(
ãxt
, 1, 
fûesize
, 
f
Ë!fûesizeË
	`Áû
("fread");

74 
	`f˛o£
(
f
);

76 
ãxt
[
fûesize
] = '\0';

77  
ãxt
;

78 
	}
}

80 
hFILE
 *
	gfö
 = 
NULL
;

81 
hFILE
 *
	gfout
 = 
NULL
;

83 
	$ª›í
(c⁄° *
ö‚ame
, c⁄° *
out‚ame
)

85 i‡(
fö
Ë{ i‡(
	`h˛o£
(föË!0Ë
	`Áû
("hclose(input)"); }

86 i‡(
fout
Ë{ i‡(
	`h˛o£
(foutË!0Ë
	`Áû
("hclose(output)"); }

88 
fö
 = 
	`h›í
(
ö‚ame
, "r");

89 i‡(
fö
 =
NULL
Ë
	`Áû
("h›í(\"%s\")", 
ö‚ame
);

91 
fout
 = 
	`h›í
(
out‚ame
, "w");

92 i‡(
fout
 =
NULL
Ë
	`Áû
("h›í(\"%s\")", 
out‚ame
);

93 
	}
}

95 
	$maö
()

97 c⁄° 
size
[] = { 1, 13, 403, 999, 30000 };

99 
buf„r
[40000];

100 *
‹igöÆ
;

101 
c
, 
i
;

102 
ssize_t
 
n
;

103 
off_t
 
off
;

105 
	`ª›í
("vcf.c", "test/hfile1.tmp");

106 (
c
 = 
	`hgëc
(
fö
)Ë!
EOF
) {

107 i‡(
	`hputc
(
c
, 
fout
Ë=
EOF
Ë
	`Áû
("hputc");

109 i‡(
	`hî∫o
(
fö
)Ë{ 
î∫o
 = hî∫o(fö); 
	`Áû
("hgetc"); }

111 
	`ª›í
("test/hfile1.tmp", "test/hfile2.tmp");

112 i‡(
	`h≥ek
(
fö
, 
buf„r
, 50Ë< 0Ë
	`Áû
("hpeek");

113 (
n
 = 
	`hªad
(
fö
, 
buf„r
, 17)) > 0) {

114 i‡(
	`hwrôe
(
fout
, 
buf„r
, 
n
Ë!nË
	`Áû
("hwrite");

116 i‡(
n
 < 0Ë
	`Áû
("hread");

118 
	`ª›í
("test/hfile2.tmp", "test/hfile3.tmp");

119 (
n
 = 
	`hªad
(
fö
, 
buf„r
,  buffer)) > 0) {

120 i‡(
	`hwrôe
(
fout
, 
buf„r
, 
n
Ë!nË
	`Áû
("hwrite");

121 i‡(
	`h≥ek
(
fö
, 
buf„r
, 700Ë< 0Ë
	`Áû
("hpeek");

123 i‡(
n
 < 0Ë
	`Áû
("hread");

125 
	`ª›í
("test/hfile3.tmp", "test/hfile4.tmp");

126 
i
 = 0;

127 
off
 = 0;

128 (
n
 = 
	`hªad
(
fö
, 
buf„r
, 
size
[
i
++ % 5])) > 0) {

129 
off
 +
n
;

130 
buf„r
[
n
] = '\0';

131 
	`check_off£t
(
fö
, 
off
, "pre-peek");

132 i‡(
	`hputs
(
buf„r
, 
fout
Ë=
EOF
Ë
	`Áû
("hputs");

133 i‡((
n
 = 
	`h≥ek
(
fö
, 
buf„r
, 
size
[(
i
+3Ë% 5])Ë< 0Ë
	`Áû
("hpeek");

134 
	`check_off£t
(
fö
, 
off
, "post-peek");

136 i‡(
n
 < 0Ë
	`Áû
("hread");

138 
	`ª›í
("test/hfile4.tmp", "test/hfile5.tmp");

139 
	`hgës
(
buf„r
, 80, 
fö
Ë!
NULL
) {

140 
size_t
 
l
 = 
	`°æí
(
buf„r
);

141 i‡(
l
 > 79Ë
	`Áû
("hgetsÑead %zu bytes, should be < 80",Ü);

142 i‡(
	`hwrôe
(
fout
, 
buf„r
, 
l
Ë!lË
	`Áû
("hwrite");

144 i‡(
	`hî∫o
(
fö
)Ë
	`Áû
("hgets");

146 
	`ª›í
("test/hfile5.tmp", "test/hfile6.tmp");

147 
n
 = 
	`hªad
(
fö
, 
buf„r
, 200);

148 i‡(
n
 < 0Ë
	`Áû
("hread");

149 i‡(
n
 !200Ë
	`Áû
("hread only got %d", ()n);

150 i‡(
	`hwrôe
(
fout
, 
buf„r
, 1000Ë!1000Ë
	`Áû
("hwrite");

151 
	`check_off£t
(
fö
, 200, "input/first200");

152 
	`check_off£t
(
fout
, 1000, "output/first200");

154 i‡(
	`h£ek
(
fö
, 800, 
SEEK_CUR
Ë< 0Ë
	`Áû
("hseek/cur");

155 
	`check_off£t
(
fö
, 1000, "input/seek");

156 
off
 = 1000; (
n
 = 
	`hªad
(
fö
, 
buf„r
,  buffer)) > 0; off +=Ç)

157 i‡(
	`hwrôe
(
fout
, 
buf„r
, 
n
Ë!nË
	`Áû
("hwrite");

158 i‡(
n
 < 0Ë
	`Áû
("hread");

159 
	`check_off£t
(
fö
, 
off
, "input/eof");

160 
	`check_off£t
(
fout
, 
off
, "output/eof");

162 i‡(
	`h£ek
(
fö
, 200, 
SEEK_SET
Ë< 0Ë
	`Áû
("hseek/set");

163 i‡(
	`h£ek
(
fout
, 200, 
SEEK_SET
Ë< 0Ë
	`Áû
("hseek(output)");

164 
	`check_off£t
(
fö
, 200, "input/backto200");

165 
	`check_off£t
(
fout
, 200, "output/backto200");

166 
n
 = 
	`hªad
(
fö
, 
buf„r
, 800);

167 i‡(
n
 < 0Ë
	`Áû
("hread");

168 i‡(
n
 !800Ë
	`Áû
("hread only got %d", ()n);

169 i‡(
	`hwrôe
(
fout
, 
buf„r
, 800Ë!800Ë
	`Áû
("hwrite");

170 
	`check_off£t
(
fö
, 1000, "input/wrote800");

171 
	`check_off£t
(
fout
, 1000, "output/wrote800");

173 i‡(
	`hÊush
(
fout
Ë=
EOF
Ë
	`Áû
("hflush");

175 
‹igöÆ
 = 
	`¶uΩ
("vcf.c");

176 
i
 = 1; i <= 6; i++) {

177 *
ãxt
;

178 
	`•rötf
(
buf„r
, "ã°/hfûe%d.tmp", 
i
);

179 
ãxt
 = 
	`¶uΩ
(
buf„r
);

180 i‡(
	`°rcmp
(
‹igöÆ
, 
ãxt
) != 0) {

181 
	`Ârötf
(
°dîr
, "%†dif„r†‰om vcf.c\n", 
buf„r
);

182  
EXIT_FAILURE
;

184 
	`‰ì
(
ãxt
);

186 
	`‰ì
(
‹igöÆ
);

188 i‡(
	`h˛o£
(
fö
Ë!0Ë
	`Áû
("hclose(input)");

189 i‡(
	`h˛o£
(
fout
Ë!0Ë
	`Áû
("hclose(output)");

191 
fout
 = 
	`h›í
("test/hfile_chars.tmp", "w");

192 i‡(
fout
 =
NULL
Ë
	`Áû
("hopen(\"test/hfile_chars.tmp\")");

193 
i
 = 0; i < 256; i++)

194 i‡(
	`hputc
(
i
, 
fout
Ë!iË
	`Áû
("chars: hputc (%d)", i);

195 i‡(
	`h˛o£
(
fout
Ë!0Ë
	`Áû
("hclose(test/hfile_chars.tmp)");

197 
fö
 = 
	`h›í
("test/hfile_chars.tmp", "r");

198 i‡(
fö
 =
NULL
Ë
	`Áû
("hopen(\"test/hfile_chars.tmp\") forÑeading");

199 
i
 = 0; i < 256; i++)

200 i‡((
c
 = 
	`hgëc
(
fö
)Ë!
i
)

201 
	`Áû
("ch¨s: hgë¯(%d = 0x%xËªtu∫ed %d = 0x%x", 
i
, i, 
c
, c);

202 i‡((
c
 = 
	`hgëc
(
fö
)Ë!
EOF
Ë
	`Áû
("chars: hgetc (EOF)Ñeturned %d", c);

203 i‡(
	`h˛o£
(
fö
Ë!0Ë
	`Áû
("hclose(test/hfile_chars.tmp) forÑeading");

205 
fö
 = 
	`h›í
("data:,hello, world!%0A", "r");

206 i‡(
fö
 =
NULL
Ë
	`Áû
("hopen(\"data:...\")");

207 
n
 = 
	`hªad
(
fö
, 
buf„r
, 300);

208 i‡(
n
 < 0Ë
	`Áû
("hread");

209 
buf„r
[
n
] = '\0';

210 i‡(
	`°rcmp
(
buf„r
, "hñlo, w‹ld!\x0A"Ë!0Ë
	`Áû
("hreadÑesult");

211 i‡(
	`h˛o£
(
fö
Ë!0Ë
	`Áû
("hclose(\"data:...\")");

213 
fö
 = 
	`h›í
("test/xx#blank.sam", "r");

214 i‡(
fö
 =
NULL
Ë
	`Áû
("hopen(\"test/xx#blank.sam\") forÑeading");

215 i‡(
	`hªad
(
fö
, 
buf„r
, 100Ë!0Ë
	`Áû
("test/xx#blank.sam isÇon-empty");

216 i‡(
	`h˛o£
(
fö
Ë!0Ë
	`Áû
("hclose(\"test/xx#blank.sam\") forÑeading");

218 
fö
 = 
	`h›í
("data:,", "r");

219 i‡(
fö
 =
NULL
Ë
	`Áû
("hopen(\"data:\") forÑeading");

220 i‡(
	`hªad
(
fö
, 
buf„r
, 100Ë!0Ë
	`Áû
("empty data: URL isÇon-empty");

221 i‡(
	`h˛o£
(
fö
Ë!0Ë
	`Áû
("hclose(\"data:\") forÑeading");

223 
fö
 = 
	`h›í
("data:;base64,"

230 i‡(
fö
 =
NULL
Ë
	`Áû
("hopen(\"data:;base64,...\")");

231 
n
 = 
	`hªad
(
fö
, 
buf„r
, 300);

232 i‡(
n
 < 0Ë
	`Áû
("hread for base64");

233 
buf„r
[
n
] = '\0';

234 i‡(
	`°rcmp
(
buf„r
, "Man is distinguished,Çot only by hisÑeason, but by "

238 
	`Áû
("hreadÑesult for base64");

239 i‡(
	`h˛o£
(
fö
Ë!0Ë
	`Áû
("hclose(\"data:;base64,...\")");

241  
EXIT_SUCCESS
;

242 
	}
}

	@htslib/test/hts_endian.c

24 
	~<°dio.h
>

25 
	~<°dlib.h
>

26 
	~<°rög.h
>

27 
	~<°döt.h
>

28 
	~<öây≥s.h
>

29 
	~"ht¶ib/hts_ídün.h
"

32 
uöt8_t
 
	mu8
[2];

33 
uöt8_t
 
	mu8_u«lig√d
[3];

34 
öt16_t
 
	mi16
;

35 
uöt16_t
 
	mu16
;

36 } 
	tTe°16
;

39 
uöt8_t
 
	mu8
[4];

40 
uöt8_t
 
	mu8_u«lig√d
[5];

41 
öt32_t
 
	mi32
;

42 
uöt32_t
 
	mu32
;

43 } 
	tTe°32
;

46 
uöt8_t
 
	mu8
[8];

47 
uöt8_t
 
	mu8_u«lig√d
[9];

48 
öt64_t
 
	mi64
;

49 
uöt64_t
 
	mu64
;

50 } 
	tTe°64
;

53 
uöt8_t
 
	mu8
[4];

54 
uöt8_t
 
	mu8_u«lig√d
[5];

55 
	mf
;

56 } 
	tTe°_Êﬂt
;

59 
uöt8_t
 
	mu8
[8];

60 
uöt8_t
 
	mu8_u«lig√d
[9];

61 
	md
;

62 } 
	tTe°_doubÀ
;

64 
	#T16
(
b0
, 
b1
, 
sgn
, 
unsgn
Ë{ { b0, b1 }, { 0x00, b0, b1 }, sgn, unsg¿}

	)

66 
Te°16
 
	gã°s_16_bô
[] = {

67 
T16
(0x00, 0x00, 0, 0),

68 
T16
(0x01, 0x00, 1, 1),

69 
T16
(0x00, 0x01, 256, 256),

70 
T16
(0xff, 0x7f, 32767, 32767),

71 
T16
(0x00, 0x80, -32768, 32768),

72 
T16
(0xff, 0xff, -1, 65535),

75 
	#T32
(
b0
, 
b1
, 
b2
, 
b3
, 
sgn
, 
unsgn
) { \

76 { 
b0
, 
b1
, 
b2
, 
b3
 }, \

77 { 0x00, 
b0
, 
b1
, 
b2
, 
b3
 }, \

78 
sgn
, 
unsgn
 \

79 }

	)

81 
Te°32
 
	gã°s_32_bô
[] = {

82 
T32
(0x00, 0x00, 0x00, 0x00, 0, 0),

83 
T32
(0x01, 0x00, 0x00, 0x00, 1, 1),

84 
T32
(0x00, 0x01, 0x00, 0x00, 256, 256),

85 
T32
(0x00, 0x00, 0x01, 0x00, 65536, 65536),

86 
T32
(0xff, 0xff, 0xff, 0x7f, 2147483647, 2147483647),

89 
T32
(0x00, 0x00, 0x00, 0x80, -2147483647 - 1, 2147483648U),

90 
T32
(0xff, 0xff, 0xff, 0xff, -1, 4294967295U),

93 
	#T64
(
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
, 
sgn
, 
unsgn
) { \

94 { 
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
 }, \

95 { 0x00, 
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
 }, \

96 
sgn
, 
unsgn
 \

97 }

	)

100 
Te°64
 
	gã°s_64_bô
[] = {

101 
T64
(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0, 0),

102 
T64
(0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 1, 1),

103 
T64
(0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 256, 256),

104 
T64
(0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 65536, 65536),

105 
T64
(0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 4294967296, 4294967296),

106 
T64
(0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f,

110 
T64
(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,

112 
T64
(0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,

116 
	#TF
(
b0
, 
b1
, 
b2
, 
b3
, 
f
Ë{ { b0, b1, b2, b3 }, { 0x00, b0, b1, b2, b3}, f }

	)

118 
Te°_Êﬂt
 
	gã°s_Êﬂt
[] = {

119 
TF
(0x00, 0x00, 0x00, 0x00, 0.0f),

120 
TF
(0x00, 0x00, 0x80, 0x3f, 1.0f),

121 
TF
(0x00, 0x00, 0x80, 0xbf, -1.0f),

122 
TF
(0x00, 0x00, 0x20, 0x41, 10.0f),

123 
TF
(0xd0, 0x0f, 0x49, 0x40, 3.14159f),

124 
TF
(0xa8, 0x0a, 0xff, 0x66, 6.022e23f),

125 
TF
(0xcd, 0x84, 0x03, 0x13, 1.66e-27f),

128 
	#TD
(
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
, 
d
) { \

129 { 
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
 }, \

130 { 0x00, 
b0
, 
b1
, 
b2
, 
b3
, 
b4
, 
b5
, 
b6
, 
b7
 }, \

131 
d
 \

132 }

	)

134 
Te°_doubÀ
 
	gã°s_doubÀ
[] = {

135 
TD
(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0.0),

136 
TD
(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f, 1.0),

137 
TD
(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xbf, -1.0),

138 
TD
(0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 10.0),

139 
TD
(0x18, 0x2d, 0x44, 0x54, 0xfb, 0x21, 0x09, 0x40, 3.141592653589793),

140 
TD
(0x2b, 0x08, 0x0c, 0xd3, 0x85, 0xe1, 0xdf, 0x44, 6.022140858e23),

141 
TD
(0x55, 0xfa, 0x81, 0x74, 0xf7, 0x71, 0x60, 0x3a, 1.66053904e-27),

144 
	#NELE
(
x
Ë((x)/(x[0]))

	)

146 * 
	$to_hex
(
uöt8_t
 *
buf
, 
Àn
) {

147 
°r
[64];

148 
i
, 
o
;

150 
i
 = 0, 
o
 = 0; i < 
Àn
; i++, o += 3) {

151 
	`¢¥ötf
(
°r
 + 
o
, (°rË- o, "%02x ", 
buf
[
i
]);

153  
°r
;

154 
	}
}

156 
	$t16_bô
(
vîbo£
) {

157 
uöt8_t
 
buf
[9];

158 
size_t
 
i
;

159 
îr‹s
 = 0;

161 
i
 = 0; i < 
	`NELE
(
ã°s_16_bô
); i++) {

162 
uöt16_t
 
u16
;

163 
öt16_t
 
i16
;

165 i‡(
vîbo£
) {

166 
	`Ârötf
(
°dîr
, "%†%6"
PRId16
" %6"PRId16"\n",

167 
	`to_hex
(
ã°s_16_bô
[
i
].
u8
, 2),

168 
ã°s_16_bô
[
i
].
i16
,Åe°s_16_bô[i].
u16
);

171 
u16
 = 
	`À_to_u16
(
ã°s_16_bô
[
i
].
u8
);

172 i‡(
u16
 !
ã°s_16_bô
[
i
].u16) {

173 
	`Ârötf
(
°dîr
, "Faûed %†=> %"
PRIu16
";Éxpected %"PRIu16"\n",

174 
	`to_hex
(
ã°s_16_bô
[
i
].
u8
, 2), 
u16
,Åests_16_bit[i].u16);

175 
îr‹s
++;

178 
i16
 = 
	`À_to_i16
(
ã°s_16_bô
[
i
].
u8
);

179 i‡(
i16
 !
ã°s_16_bô
[
i
].i16) {

180 
	`Ârötf
(
°dîr
, "Faûed %†=> %"
PRId16
";Éxpected %"PRId16"\n",

181 
	`to_hex
(
ã°s_16_bô
[
i
].
u8
, 2), 
i16
,Åests_16_bit[i].i16);

182 
îr‹s
++;

185 
u16
 = 
	`À_to_u16
(
ã°s_16_bô
[
i
].
u8_u«lig√d
 + 1);

186 i‡(
u16
 !
ã°s_16_bô
[
i
].u16) {

187 
	`Ârötf
(
°dîr
,

188 "Faûed u«lig√d %†=> %"
PRIu16
";Éxpected %"PRIu16"\n",

189 
	`to_hex
(
ã°s_16_bô
[
i
].
u8_u«lig√d
 + 1, 2),

190 
u16
, 
ã°s_16_bô
[
i
].u16);

191 
îr‹s
++;

194 
i16
 = 
	`À_to_i16
(
ã°s_16_bô
[
i
].
u8_u«lig√d
 + 1);

195 i‡(
i16
 !
ã°s_16_bô
[
i
].i16) {

196 
	`Ârötf
(
°dîr
,

197 "Faûed u«lig√d %†=> %"
PRId16
";Éxpected %"PRId16"\n",

198 
	`to_hex
(
ã°s_16_bô
[
i
].
u8_u«lig√d
 + 1, 2),

199 
i16
, 
ã°s_16_bô
[
i
].i16);

200 
îr‹s
++;

203 
	`u16_to_À
(
ã°s_16_bô
[
i
].
u16
, 
buf
);

204 i‡(
	`memcmp
(
buf
, 
ã°s_16_bô
[
i
].
u8
, 2) != 0) {

205 
	`Ârötf
(
°dîr
, "Faûed %"
PRIu16
" => %s;Éxpected %s\n",

206 
ã°s_16_bô
[
i
].
u16
,

207 
	`to_hex
(
buf
, 2),Åo_hex(
ã°s_16_bô
[
i
].
u8
, 2));

208 
îr‹s
++;

211 
	`i16_to_À
(
ã°s_16_bô
[
i
].
i16
, 
buf
);

212 i‡(
	`memcmp
(
buf
, 
ã°s_16_bô
[
i
].
u8
, 2) != 0) {

213 
	`Ârötf
(
°dîr
, "Faûed %"
PRId16
" => %s;Éxpected %s\n",

214 
ã°s_16_bô
[
i
].
i16
,

215 
	`to_hex
(
buf
, 2),Åo_hex(
ã°s_16_bô
[
i
].
u8
, 2));

216 
îr‹s
++;

219 
	`u16_to_À
(
ã°s_16_bô
[
i
].
u16
, 
buf
 + 1);

220 i‡(
	`memcmp
(
buf
 + 1, 
ã°s_16_bô
[
i
].
u8
, 2) != 0) {

221 
	`Ârötf
(
°dîr
, "Faûed u«lig√d %"
PRIu16
" => %s;Éxpected %s\n",

222 
ã°s_16_bô
[
i
].
u16
,

223 
	`to_hex
(
buf
 + 1, 2),Åo_hex(
ã°s_16_bô
[
i
].
u8
, 2));

224 
îr‹s
++;

227 
	`i16_to_À
(
ã°s_16_bô
[
i
].
i16
, 
buf
 + 1);

228 i‡(
	`memcmp
(
buf
 + 1, 
ã°s_16_bô
[
i
].
u8
, 2) != 0) {

229 
	`Ârötf
(
°dîr
, "Faûed u«lig√d %"
PRId16
" => %s;Éxpected %s\n",

230 
ã°s_16_bô
[
i
].
i16
,

231 
	`to_hex
(
buf
 + 1, 2),Åo_hex(
ã°s_16_bô
[
i
].
u8
, 2));

232 
îr‹s
++;

236  
îr‹s
;

237 
	}
}

239 
	$t32_bô
(
vîbo£
) {

240 
uöt8_t
 
buf
[9];

241 
size_t
 
i
;

242 
îr‹s
 = 0;

244 
i
 = 0; i < 
	`NELE
(
ã°s_32_bô
); i++) {

245 
uöt32_t
 
u32
;

246 
öt32_t
 
i32
;

248 i‡(
vîbo£
) {

249 
	`Ârötf
(
°dîr
, "%†%11"
PRId32
" %11"
PRIu32
"\n",

250 
	`to_hex
(
ã°s_32_bô
[
i
].
u8
, 4),

251 
ã°s_32_bô
[
i
].
i32
,Åe°s_32_bô[i].
u32
);

254 
u32
 = 
	`À_to_u32
(
ã°s_32_bô
[
i
].
u8
);

255 i‡(
u32
 !
ã°s_32_bô
[
i
].u32) {

256 
	`Ârötf
(
°dîr
, "Faûed %†=> %"
PRIu32
";Éxpected %"PRIu32"\n",

257 
	`to_hex
(
ã°s_32_bô
[
i
].
u8
, 4), 
u32
,Åests_32_bit[i].u32);

258 
îr‹s
++;

260 
i32
 = 
	`À_to_i32
(
ã°s_32_bô
[
i
].
u8
);

261 i‡(
i32
 !
ã°s_32_bô
[
i
].i32) {

262 
	`Ârötf
(
°dîr
, "Faûed %†=> %"
PRId32
";Éxpected %"PRId32"\n",

263 
	`to_hex
(
ã°s_32_bô
[
i
].
u8
, 4), 
i32
,Åests_32_bit[i].i32);

264 
îr‹s
++;

267 
u32
 = 
	`À_to_u32
(
ã°s_32_bô
[
i
].
u8_u«lig√d
 + 1);

268 i‡(
u32
 !
ã°s_32_bô
[
i
].u32) {

269 
	`Ârötf
(
°dîr
,

270 "Faûed u«lig√d %†=> %"
PRIu32
";Éxpected %"PRIu32"\n",

271 
	`to_hex
(
ã°s_32_bô
[
i
].
u8_u«lig√d
 + 1, 4),

272 
u32
, 
ã°s_32_bô
[
i
].u32);

273 
îr‹s
++;

275 
i32
 = 
	`À_to_i32
(
ã°s_32_bô
[
i
].
u8_u«lig√d
 + 1);

276 i‡(
i32
 !
ã°s_32_bô
[
i
].i32) {

277 
	`Ârötf
(
°dîr
,

278 "Faûed u«lig√d %†=> %"
PRId32
";Éxpected %"PRId32"\n",

279 
	`to_hex
(
ã°s_32_bô
[
i
].
u8_u«lig√d
 + 1, 4),

280 
i32
, 
ã°s_32_bô
[
i
].i32);

281 
îr‹s
++;

284 
	`u32_to_À
(
ã°s_32_bô
[
i
].
u32
, 
buf
);

285 i‡(
	`memcmp
(
buf
, 
ã°s_32_bô
[
i
].
u8
, 4) != 0) {

286 
	`Ârötf
(
°dîr
, "Faûed %"
PRIu32
" => %s;Éxpected %s\n",

287 
ã°s_32_bô
[
i
].
u32
,

288 
	`to_hex
(
buf
, 4),Åo_hex(
ã°s_32_bô
[
i
].
u8
, 4));

289 
îr‹s
++;

292 
	`i32_to_À
(
ã°s_32_bô
[
i
].
i32
, 
buf
);

293 i‡(
	`memcmp
(
buf
, 
ã°s_32_bô
[
i
].
u8
, 4) != 0) {

294 
	`Ârötf
(
°dîr
, "Faûed %"
PRId32
" => %s;Éxpected %s\n",

295 
ã°s_32_bô
[
i
].
i32
,

296 
	`to_hex
(
buf
, 4),Åo_hex(
ã°s_32_bô
[
i
].
u8
, 4));

297 
îr‹s
++;

300 
	`u32_to_À
(
ã°s_32_bô
[
i
].
u32
, 
buf
 + 1);

301 i‡(
	`memcmp
(
buf
 + 1, 
ã°s_32_bô
[
i
].
u8
, 4) != 0) {

302 
	`Ârötf
(
°dîr
, "Faûed u«lig√d %"
PRIu32
" => %s;Éxpected %s\n",

303 
ã°s_32_bô
[
i
].
u32
,

304 
	`to_hex
(
buf
 + 1, 4),Åo_hex(
ã°s_32_bô
[
i
].
u8
, 4));

305 
îr‹s
++;

308 
	`i32_to_À
(
ã°s_32_bô
[
i
].
i32
, 
buf
 + 1);

309 i‡(
	`memcmp
(
buf
 + 1, 
ã°s_32_bô
[
i
].
u8
, 4) != 0) {

310 
	`Ârötf
(
°dîr
, "Faûed u«lig√d %"
PRId32
" => %s;Éxpected %s\n",

311 
ã°s_32_bô
[
i
].
i32
,

312 
	`to_hex
(
buf
 + 1, 4),Åo_hex(
ã°s_32_bô
[
i
].
u8
, 4));

313 
îr‹s
++;

317  
îr‹s
;

318 
	}
}

320 
	$t64_bô
(
vîbo£
) {

321 
uöt8_t
 
buf
[9];

322 
size_t
 
i
;

323 
îr‹s
 = 0;

325 
i
 = 0; i < 
	`NELE
(
ã°s_64_bô
); i++) {

326 
uöt64_t
 
u64
;

327 
öt64_t
 
i64
;

329 i‡(
vîbo£
) {

330 
	`Ârötf
(
°dîr
, "%†%20"
PRId64
" %20"
PRIu64
"\n",

331 
	`to_hex
(
ã°s_64_bô
[
i
].
u8
, 8),

332 
ã°s_64_bô
[
i
].
i64
,Åe°s_64_bô[i].
u64
);

335 
u64
 = 
	`À_to_u64
(
ã°s_64_bô
[
i
].
u8
);

336 i‡(
u64
 !
ã°s_64_bô
[
i
].u64) {

337 
	`Ârötf
(
°dîr
, "Faûed %†=> %"
PRIu64
";Éxpected %"PRIu64"\n",

338 
	`to_hex
(
ã°s_64_bô
[
i
].
u8
, 8), 
u64
,Åests_64_bit[i].u64);

339 
îr‹s
++;

342 
i64
 = 
	`À_to_i64
(
ã°s_64_bô
[
i
].
u8
);

343 i‡(
i64
 !
ã°s_64_bô
[
i
].i64) {

344 
	`Ârötf
(
°dîr
, "Faûed %†=> %"
PRId64
";Éxpected %"PRId64"\n",

345 
	`to_hex
(
ã°s_64_bô
[
i
].
u8
, 8), 
i64
,Åests_64_bit[i].i64);

346 
îr‹s
++;

349 
u64
 = 
	`À_to_u64
(
ã°s_64_bô
[
i
].
u8_u«lig√d
 + 1);

350 i‡(
u64
 !
ã°s_64_bô
[
i
].u64) {

351 
	`Ârötf
(
°dîr
,

352 "Faûed u«lig√d %†=> %"
PRIu64
";Éxpected %"PRIu64"\n",

353 
	`to_hex
(
ã°s_64_bô
[
i
].
u8_u«lig√d
 + 1, 8),

354 
u64
, 
ã°s_64_bô
[
i
].u64);

355 
îr‹s
++;

358 
i64
 = 
	`À_to_i64
(
ã°s_64_bô
[
i
].
u8_u«lig√d
 + 1);

359 i‡(
i64
 !
ã°s_64_bô
[
i
].i64) {

360 
	`Ârötf
(
°dîr
,

361 "Faûed u«lig√d %†=> %"
PRId64
";Éxpected %"PRId64"\n",

362 
	`to_hex
(
ã°s_64_bô
[
i
].
u8_u«lig√d
 + 1, 8),

363 
i64
, 
ã°s_64_bô
[
i
].i64);

364 
îr‹s
++;

367 
	`u64_to_À
(
ã°s_64_bô
[
i
].
u64
, 
buf
);

368 i‡(
	`memcmp
(
buf
, 
ã°s_64_bô
[
i
].
u8
, 8) != 0) {

369 
	`Ârötf
(
°dîr
, "Faûed %"
PRIu64
" => %s;Éxpected %s\n",

370 
ã°s_64_bô
[
i
].
u64
,

371 
	`to_hex
(
buf
, 8),Åo_hex(
ã°s_64_bô
[
i
].
u8
, 8));

372 
îr‹s
++;

375 
	`i64_to_À
(
ã°s_64_bô
[
i
].
i64
, 
buf
);

376 i‡(
	`memcmp
(
buf
, 
ã°s_64_bô
[
i
].
u8
, 8) != 0) {

377 
	`Ârötf
(
°dîr
, "Faûed %"
PRId64
" => %s;Éxpected %s\n",

378 
ã°s_64_bô
[
i
].
i64
,

379 
	`to_hex
(
buf
, 8),Åo_hex(
ã°s_64_bô
[
i
].
u8
, 8));

380 
îr‹s
++;

383 
	`u64_to_À
(
ã°s_64_bô
[
i
].
u64
, 
buf
 + 1);

384 i‡(
	`memcmp
(
buf
 + 1, 
ã°s_64_bô
[
i
].
u8
, 8) != 0) {

385 
	`Ârötf
(
°dîr
, "Faûed u«lig√d %"
PRIu64
" => %s;Éxpected %s\n",

386 
ã°s_64_bô
[
i
].
u64
,

387 
	`to_hex
(
buf
 + 1, 8),Åo_hex(
ã°s_64_bô
[
i
].
u8
, 8));

388 
îr‹s
++;

391 
	`i64_to_À
(
ã°s_64_bô
[
i
].
i64
, 
buf
 + 1);

392 i‡(
	`memcmp
(
buf
 + 1, 
ã°s_64_bô
[
i
].
u8
, 8) != 0) {

393 
	`Ârötf
(
°dîr
, "Faûed u«lig√d %"
PRId64
" => %s;Éxpected %s\n",

394 
ã°s_64_bô
[
i
].
i64
,

395 
	`to_hex
(
buf
 + 1, 8),Åo_hex(
ã°s_64_bô
[
i
].
u8
, 8));

396 
îr‹s
++;

400  
îr‹s
;

401 
	}
}

403 
	$t_Êﬂt
(
vîbo£
) {

404 
uöt8_t
 
buf
[9];

405 
size_t
 
i
;

406 
îr‹s
 = 0;

408 
i
 = 0; i < 
	`NELE
(
ã°s_Êﬂt
); i++) {

409 
f
;

411 i‡(
vîbo£
) {

412 
	`Ârötf
(
°dîr
, "%s %g\n",

413 
	`to_hex
(
ã°s_Êﬂt
[
i
].
u8
, 4),Åe°s_Êﬂt[i].
f
);

416 
f
 = 
	`À_to_Êﬂt
(
ã°s_Êﬂt
[
i
].
u8
);

417 i‡(
f
 !
ã°s_Êﬂt
[
i
].f) {

418 
	`Ârötf
(
°dîr
, "Failed %s => %g;Éxpected %g\n",

419 
	`to_hex
(
ã°s_Êﬂt
[
i
].
u8
, 4), 
f
,Åests_float[i].f);

420 
îr‹s
++;

423 
f
 = 
	`À_to_Êﬂt
(
ã°s_Êﬂt
[
i
].
u8_u«lig√d
 + 1);

424 i‡(
f
 !
ã°s_Êﬂt
[
i
].f) {

425 
	`Ârötf
(
°dîr
, "Failed unaligned %s => %g;Éxpected %g\n",

426 
	`to_hex
(
ã°s_Êﬂt
[
i
].
u8_u«lig√d
 + 1, 4),

427 
f
, 
ã°s_Êﬂt
[
i
].f);

428 
îr‹s
++;

431 
	`Êﬂt_to_À
(
ã°s_Êﬂt
[
i
].
f
, 
buf
);

432 i‡(
	`memcmp
(
ã°s_Êﬂt
[
i
].
u8
, 
buf
, 4) != 0) {

433 
	`Ârötf
(
°dîr
, "Failed %g => %s;Éxpected %s\n",

434 
ã°s_Êﬂt
[
i
].
f
,

435 
	`to_hex
(
buf
, 4),Åo_hex(
ã°s_Êﬂt
[
i
].
u8
, 4));

438 
	`Êﬂt_to_À
(
ã°s_Êﬂt
[
i
].
f
, 
buf
 + 1);

439 i‡(
	`memcmp
(
ã°s_Êﬂt
[
i
].
u8
, 
buf
 + 1, 4) != 0) {

440 
	`Ârötf
(
°dîr
, "Failed unaligned %g => %s;Éxpected %s\n",

441 
ã°s_Êﬂt
[
i
].
f
,

442 
	`to_hex
(
buf
 + 1, 4),Åo_hex(
ã°s_Êﬂt
[
i
].
u8
, 4));

445  
îr‹s
;

446 
	}
}

448 
	$t_doubÀ
(
vîbo£
) {

449 
uöt8_t
 
buf
[9];

450 
size_t
 
i
;

451 
îr‹s
 = 0;

453 
i
 = 0; i < 
	`NELE
(
ã°s_doubÀ
); i++) {

454 
f
;

456 i‡(
vîbo£
) {

457 
	`Ârötf
(
°dîr
, "%s %.15g\n",

458 
	`to_hex
(
ã°s_doubÀ
[
i
].
u8
, 8),Åe°s_doubÀ[i].
d
);

461 
f
 = 
	`À_to_doubÀ
(
ã°s_doubÀ
[
i
].
u8
);

462 i‡(
f
 !
ã°s_doubÀ
[
i
].
d
) {

463 
	`Ârötf
(
°dîr
, "Failed %s => %.15g;Éxpected %.15g\n",

464 
	`to_hex
(
ã°s_doubÀ
[
i
].
u8
, 8), 
f
,Åe°s_doubÀ[i].
d
);

465 
îr‹s
++;

468 
f
 = 
	`À_to_doubÀ
(
ã°s_doubÀ
[
i
].
u8_u«lig√d
 + 1);

469 i‡(
f
 !
ã°s_doubÀ
[
i
].
d
) {

470 
	`Ârötf
(
°dîr
, "Failed unaligned %s => %.15g;Éxpected %.15g\n",

471 
	`to_hex
(
ã°s_doubÀ
[
i
].
u8_u«lig√d
 + 1, 8),

472 
f
, 
ã°s_doubÀ
[
i
].
d
);

473 
îr‹s
++;

476 
	`doubÀ_to_À
(
ã°s_doubÀ
[
i
].
d
, 
buf
);

477 i‡(
	`memcmp
(
ã°s_doubÀ
[
i
].
u8
, 
buf
, 8) != 0) {

478 
	`Ârötf
(
°dîr
, "Failed %.15g => %s;Éxpected %s\n",

479 
ã°s_doubÀ
[
i
].
d
,

480 
	`to_hex
(
buf
, 8),Åo_hex(
ã°s_doubÀ
[
i
].
u8
, 8));

483 
	`doubÀ_to_À
(
ã°s_doubÀ
[
i
].
d
, 
buf
 + 1);

484 i‡(
	`memcmp
(
ã°s_doubÀ
[
i
].
u8
, 
buf
 + 1, 8) != 0) {

485 
	`Ârötf
(
°dîr
, "Failed unaligned %.15g => %s;Éxpected %s\n",

486 
ã°s_doubÀ
[
i
].
d
,

487 
	`to_hex
(
buf
 + 1, 8),Åo_hex(
ã°s_doubÀ
[
i
].
u8
, 8));

490  
îr‹s
;

491 
	}
}

493 
	$maö
(
¨gc
, **
¨gv
) {

494 
vîbo£
 = 0;

495 
îr‹s
 = 0;

497 i‡(
¨gc
 > 1 && 
	`°rcmp
(
¨gv
[1], "-v"Ë=0Ë
vîbo£
 = 1;

499 
îr‹s
 +
	`t16_bô
(
vîbo£
);

500 
îr‹s
 +
	`t32_bô
(
vîbo£
);

501 
îr‹s
 +
	`t64_bô
(
vîbo£
);

502 
îr‹s
 +
	`t_Êﬂt
(
vîbo£
);

503 
îr‹s
 +
	`t_doubÀ
(
vîbo£
);

504 i‡(
îr‹s
) {

505 
	`Ârötf
(
°dîr
, "%dÉº‹s\n", 
îr‹s
);

506  
EXIT_FAILURE
;

509  
EXIT_SUCCESS
;

510 
	}
}

	@htslib/test/sam.c

25 
	~<c⁄fig.h
>

27 
	~<°d¨g.h
>

28 
	~<°dio.h
>

29 
	~<°dlib.h
>

30 
	~<°rög.h
>

31 
	~<°döt.h
>

32 
	~<öây≥s.h
>

33 
	~<m©h.h
>

36 
	~"ht¶ib/hts_defs.h
"

37 #unde‡
HTS_DEPRECATED


38 
	#HTS_DEPRECATED
(
mesßge
)

	)

40 
	~"ht¶ib/ßm.h
"

41 
	~"ht¶ib/Áidx.h
"

42 
	~"ht¶ib/k°rög.h
"

44 
	g°©us
;

46 
	$HTS_FORMAT
(
¥ötf
, 1, 2Ë
	$Áû
(c⁄° *
fmt
, ...)

48 
va_li°
 
¨gs
;

50 
	`Ârötf
(
°dîr
, "Failed: ");

51 
	`va_°¨t
(
¨gs
, 
fmt
);

52 
	`vÂrötf
(
°dîr
, 
fmt
, 
¨gs
);

53 
	`va_íd
(
¨gs
);

54 
	`Ârötf
(
°dîr
, "\n");

56 
°©us
 = 
EXIT_FAILURE
;

57 
	}
}

59 
uöt8_t
 *
	$check_bam_aux_gë
(c⁄° 
bam1_t
 *
Æn
, c⁄° *
èg
, 
ty≥
)

61 
uöt8_t
 *
p
 = 
	`bam_aux_gë
(
Æn
, 
èg
);

62 i‡(
p
) {

63 i‡(*
p
 =
ty≥
) Ö;

64 
	`Áû
("%†fõld o‡ty≥ '%c',Éx≥˘ed '%c'\n", 
èg
, *
p
, 
ty≥
);

66 
	`Áû
("ˇn'àföd %†fõld\n", 
èg
);

68  
NULL
;

69 
	}
}

71 
	$check_öt_B_¨øy
(
bam1_t
 *
Æn
, *
èg
,

72 
uöt32_t
 
nvÆs
, 
öt64_t
 *
vÆs
) {

73 
uöt8_t
 *
p
;

74 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, 
èg
, 'B')Ë!
NULL
) {

75 
uöt32_t
 
i
;

77 i‡(
	`bam_auxB_Àn
(
p
Ë!
nvÆs
)

78 
	`Áû
("WrongÜengthÑeported for %s field, got %u,Éxpected %u\n",

79 
èg
, 
	`bam_auxB_Àn
(
p
), 
nvÆs
);

81 
i
 = 0; i < 
nvÆs
; i++) {

82 i‡(
	`bam_auxB2i
(
p
, 
i
Ë!
vÆs
[i]) {

83 
	`Áû
("Wrong value from bam_auxB2i for %s field index %u, "

84 "gŸ %"
PRId64
"Éxpected %"PRId64"\n",

85 
èg
, 
i
, 
	`bam_auxB2i
(
p
, i), 
vÆs
[i]);

87 i‡(
	`bam_auxB2f
(
p
, 
i
Ë!(Ë
vÆs
[i]) {

88 
	`Áû
("Wrong value from bam_auxB2f for %s field index %u, "

90 
èg
, 
i
, 
	`bam_auxB2f
(
p
, i), (Ë
vÆs
[i]);

94 
	}
}

96 
	#PI
 3.141592653589793

	)

97 
	#E
 2.718281828459045

	)

98 
	#HELLO
 "Hñlo, w‹ld!"

	)

99 
	#NEW_HELLO
 "Yo, dude"

	)

100 
	#BEEF
 "DEADBEEF"

	)

102 
	#°r
(
x
Ë#x

	)

103 
	#x°r
(
x
Ë
	`°r
(x)

	)

105 
	$aux_fõlds1
()

107 c⁄° 
ßm
[] = "data:,"

110 "r1\t0\t⁄e\t500\t20\t8M\t*\t0\t0\tATGCATGC\tqqqqqqqq\tXA:A:k\tXi:i:37\tXf:f:" 
	`x°r
(
PI
Ë"\tXd:d:" x°r(
E
Ë"\tXZ:Z:" 
HELLO
 "\tXH:H:" 
BEEF
 "\tXB:B:c,-2,0,+2\tB0:B:i,-2147483648,-1,0,1,2147483647\tB1:B:I,0,1,2147483648,4294967295\tB2:B:s,-32768,-1,0,1,32767\tB3:B:S,0,1,32768,65535\tB4:B:c,-128,-1,0,1,127\tB5:B:C,0,1,127,255\tBf:B:f,-3.14159,2.71828\tZZ:i:1000000\tY1:i:-2147483648\tY2:i:-2147483647\tY3:i:-1\tY4:i:0\tY5:i:1\tY6:i:2147483647\tY7:i:2147483648\tY8:i:4294967295\n";

113 c⁄° 
r1
[] = "r1\t0\t⁄e\t500\t20\t8M\t*\t0\t0\tATGCATGC\tqqqqqqqq\tXi:i:37\tXf:f:3.14159\tXd:d:2.71828\tXZ:Z:" 
NEW_HELLO
 "\tXH:H:" 
BEEF
 "\tXB:B:c,-2,0,2\tB0:B:i,-2147483648,-1,0,1,2147483647\tB1:B:I,0,1,2147483648,4294967295\tB2:B:s,-32768,-1,0,1,32767\tB3:B:S,0,1,32768,65535\tB4:B:c,-128,-1,0,1,127\tB5:B:C,0,1,127,255\tBf:B:f,-3.14159,2.71828\tZZ:i:1000000\tY1:i:-2147483648\tY2:i:-2147483647\tY3:i:-1\tY4:i:0\tY5:i:1\tY6:i:2147483647\tY7:i:2147483648\tY8:i:4294967295\tN0:i:-1234\tN1:i:1234";

115 
ßmFûe
 *
ö
 = 
	`ßm_›í
(
ßm
, "r");

116 
bam_hdr_t
 *
hódî
 = 
	`ßm_hdr_ªad
(
ö
);

117 
bam1_t
 *
Æn
 = 
	`bam_öô1
();

118 
uöt8_t
 *
p
;

119 
k°rög_t
 
ks
 = { 0, 0, 
NULL
 };

120 
öt64_t
 
b0vÆs
[5] = { -2147483648LL,-1,0,1,2147483647LL };

121 
öt64_t
 
b1vÆs
[4] = { 0,1,2147483648LL,4294967295LL };

122 
öt64_t
 
b2vÆs
[5] = { -32768,-1,0,1,32767 };

123 
öt64_t
 
b3vÆs
[4] = { 0,1,32768,65535 };

124 
öt64_t
 
b4vÆs
[5] = { -128,-1,0,1,127 };

125 
öt64_t
 
b5vÆs
[4] = { 0,1,127,255 };

128 
bfvÆs
[2] = { -3.14159f, 2.71828f };

130 
öt32_t
 
ivÆ
 = -1234;

131 
uöt32_t
 
uvÆ
 = 1234;

133 
size_t
 
nvÆs
, 
i
;

135 i‡(
	`ßm_ªad1
(
ö
, 
hódî
, 
Æn
) >= 0) {

136 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "XA", 'A')Ë&& 
	`bam_aux2A
(p) != 'k')

137 
	`Áû
("XA fõld i†'%c',Éx≥˘ed 'k'", 
	`bam_aux2A
(
p
));

139 
	`bam_aux_dñ
(
Æn
,
p
);

140 i‡(
	`bam_aux_gë
(
Æn
,"XA"))

141 
	`Áû
("XA field wasÇot deleted");

143 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "Xi", 'C')Ë&& 
	`bam_aux2i
(p) != 37)

144 
	`Áû
("Xòfõld i†%"
PRId64
",Éx≥˘ed 37", 
	`bam_aux2i
(
p
));

146 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "Xf", 'f')Ë&& 
	`Ábs
(
	`bam_aux2f
’Ë- 
PI
) > 1E-6)

147 
	`Áû
("X‡fõld i†%.12f,Éx≥˘edÖi", 
	`bam_aux2f
(
p
));

149 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "Xd", 'd')Ë&& 
	`Ábs
(
	`bam_aux2f
’Ë- 
E
) > 1E-6)

150 
	`Áû
("X‡fõld i†%.12f,Éx≥˘edÉ", 
	`bam_aux2f
(
p
));

152 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "XZ", 'Z')Ë&& 
	`°rcmp
(
	`bam_aux2Z
’), 
HELLO
) != 0)

153 
	`Áû
("XZ fõld i†\"%s\",Éx≥˘ed \"%s\"", 
	`bam_aux2Z
(
p
), 
HELLO
);

155 
	`bam_aux_upd©e_°r
(
Æn
,"XZ",
	`°æí
(
NEW_HELLO
)+1,NEW_HELLO);

156 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "XZ", 'Z')Ë&& 
	`°rcmp
(
	`bam_aux2Z
’), 
NEW_HELLO
) != 0)

157 
	`Áû
("XZ fõld i†\"%s\",Éx≥˘ed \"%s\"", 
	`bam_aux2Z
(
p
), 
NEW_HELLO
);

160 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "XH", 'H')Ë&& 
	`°rcmp
(
	`bam_aux2Z
’), 
BEEF
) != 0)

161 
	`Áû
("XH fõld i†\"%s\",Éx≥˘ed \"%s\"", 
	`bam_aux2Z
(
p
), 
BEEF
);

163 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "XB", 'B'))

164 && ! (
	`memcmp
(
p
, "Bc", 2) == 0

165 && 
	`memcmp
(
p
 + 2, "\x03\x00\x00\x00\xfe\x00\x02", 7) == 0))

166 
	`Áû
("XB fõld i†%c,...,Éx≥˘ed c,-2,0,+2", 
p
[1]);

168 
	`check_öt_B_¨øy
(
Æn
, "B0",

169 (
b0vÆs
) / (b0vals[0]), b0vals);

170 
	`check_öt_B_¨øy
(
Æn
, "B1",

171 (
b1vÆs
) / (b1vals[0]), b1vals);

172 
	`check_öt_B_¨øy
(
Æn
, "B2",

173 (
b2vÆs
) / (b2vals[0]), b2vals);

174 
	`check_öt_B_¨øy
(
Æn
, "B3",

175 (
b3vÆs
) / (b3vals[0]), b3vals);

176 
	`check_öt_B_¨øy
(
Æn
, "B4",

177 (
b4vÆs
) / (b4vals[0]), b4vals);

178 
	`check_öt_B_¨øy
(
Æn
, "B5",

179 (
b5vÆs
) / (b5vals[0]), b5vals);

181 
nvÆs
 = (
bfvÆs
) / (bfvals[0]);

182 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "Bf", 'B')Ë!
NULL
) {

183 i‡(
	`bam_auxB_Àn
(
p
Ë!
nvÆs
)

184 
	`Áû
("WrongÜengthÑeported for Bf field, got %d,Éxpected %zd\n",

185 
	`bam_auxB_Àn
(
p
), 
nvÆs
);

187 
i
 = 0; i < 
nvÆs
; i++) {

188 i‡(
	`bam_auxB2f
(
p
, 
i
Ë!
bfvÆs
[i]) {

189 
	`Áû
("Wrong value from bam_auxB2f for Bf field index %zd, "

191 
i
, 
	`bam_auxB2f
(
p
, i), 
bfvÆs
[i]);

196 i‡((
p
 = 
	`check_bam_aux_gë
(
Æn
, "ZZ", 'I')Ë&& 
	`bam_aux2i
(p) != 1000000)

197 
	`Áû
("ZZ fõld i†%"
PRId64
",Éx≥˘ed 1000000", 
	`bam_aux2i
(
p
));

199 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y1")Ë&& 
	`bam_aux2i
(p) != -2147483647-1)

200 
	`Áû
("Y1 fõld i†%"
PRId64
",Éx≥˘ed -2^31", 
	`bam_aux2i
(
p
));

202 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y2")Ë&& 
	`bam_aux2i
(p) != -2147483647)

203 
	`Áû
("Y2 fõld i†%"
PRId64
",Éx≥˘ed -2^31+1", 
	`bam_aux2i
(
p
));

205 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y3")Ë&& 
	`bam_aux2i
(p) != -1)

206 
	`Áû
("Y3 fõld i†%"
PRId64
",Éx≥˘ed -1", 
	`bam_aux2i
(
p
));

208 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y4")Ë&& 
	`bam_aux2i
(p) != 0)

209 
	`Áû
("Y4 fõld i†%"
PRId64
",Éx≥˘ed 0", 
	`bam_aux2i
(
p
));

211 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y5")Ë&& 
	`bam_aux2i
(p) != 1)

212 
	`Áû
("Y5 fõld i†%"
PRId64
",Éx≥˘ed 1", 
	`bam_aux2i
(
p
));

214 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y6")Ë&& 
	`bam_aux2i
(p) != 2147483647)

215 
	`Áû
("Y6 fõld i†%"
PRId64
",Éx≥˘ed 2^31-1", 
	`bam_aux2i
(
p
));

217 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y7")Ë&& 
	`bam_aux2i
(p) != 2147483648LL)

218 
	`Áû
("Y7 fõld i†%"
PRId64
",Éx≥˘ed 2^31", 
	`bam_aux2i
(
p
));

220 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "Y8")Ë&& 
	`bam_aux2i
(p) != 4294967295LL)

221 
	`Áû
("Y8 fõld i†%"
PRId64
",Éx≥˘ed 2^32-1", 
	`bam_aux2i
(
p
));

224 i‡(
	`bam_aux_≠≥nd
(
Æn
, "N0", 'i', (
ivÆ
), (
uöt8_t
 *) &ival) != 0)

225 
	`Áû
("FailedÅoáppend N0:iÅag");

227 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "N0")Ë&& 
	`bam_aux2i
’Ë!
ivÆ
)

228 
	`Áû
("N0 fõld i†%"
PRId64
",Éx≥˘ed %d", 
	`bam_aux2i
(
p
), 
ivÆ
);

230 i‡(
	`bam_aux_≠≥nd
(
Æn
, "N1", 'I', (
uvÆ
), (
uöt8_t
 *) &uval) != 0)

231 
	`Áû
("failedÅoáppend N1:IÅag");

233 i‡((
p
 = 
	`bam_aux_gë
(
Æn
, "N1")Ë&& 
	`bam_aux2i
’Ë!
uvÆ
)

234 
	`Áû
("N1 fõld i†%"
PRId64
",Éx≥˘ed %u", 
	`bam_aux2i
(
p
), 
uvÆ
);

236 i‡(
	`ßm_f‹m©1
(
hódî
, 
Æn
, &
ks
) < 0)

237 
	`Áû
("can't formatÑecord");

239 i‡(
	`°rcmp
(
ks
.
s
, 
r1
) != 0)

240 
	`Áû
("ªc‹d f‹m©ãd inc‹ª˘ly: \"%s\"", 
ks
.
s
);

242 
	`‰ì
(
ks
.
s
);

244 
	`Áû
("can'tÑeadÑecord");

246 
	`bam_de°roy1
(
Æn
);

247 
	`bam_hdr_de°roy
(
hódî
);

248 
	`ßm_˛o£
(
ö
);

251 
	}
}

253 
	$ôî©‹s1
()

255 
	`hts_ôr_de°roy
(
	`ßm_ôr_quîyi
(
NULL
, 
HTS_IDX_REST
, 0, 0));

256 
	`hts_ôr_de°roy
(
	`ßm_ôr_quîyi
(
NULL
, 
HTS_IDX_NONE
, 0, 0));

257 
	}
}

259 
	$c›y_check_Æignmít
(c⁄° *
ö‚ame
, c⁄° *
öf‹m©
,

260 c⁄° *
out‚ame
, c⁄° *
outmode
, c⁄° *
ouåef
)

262 
ßmFûe
 *
ö
 = 
	`ßm_›í
(
ö‚ame
, "r");

263 
ßmFûe
 *
out
 = 
	`ßm_›í
(
out‚ame
, 
outmode
);

264 
bam1_t
 *
Æn
 = 
	`bam_öô1
();

265 
bam_hdr_t
 *
hódî
;

267 i‡(
ouåef
) {

268 i‡(
	`hts_£t_›t
(
out
, 
CRAM_OPT_REFERENCE
, 
ouåef
) < 0)

269 
	`Áû
("£âögÑe„ªn˚ %†f‹ %s", 
ouåef
, 
out‚ame
);

272 
hódî
 = 
	`ßm_hdr_ªad
(
ö
);

273 i‡(
	`ßm_hdr_wrôe
(
out
, 
hódî
Ë< 0Ë
	`Áû
("wrôög hódî†tÿ%s", 
out‚ame
);

275 
	`ßm_ªad1
(
ö
, 
hódî
, 
Æn
) >= 0) {

276 
mod4
 = ((
öçå_t
Ë
	`bam_gë_cig¨
(
Æn
)) % 4;

277 i‡(
mod4
 != 0)

278 
	`Áû
("%s CIGARÇot 4-byteáligned; offset is 4k+%d for \"%s\"",

279 
öf‹m©
, 
mod4
, 
	`bam_gë_q«me
(
Æn
));

281 i‡(
	`ßm_wrôe1
(
out
, 
hódî
, 
Æn
Ë< 0Ë
	`Áû
("wrôögÅÿ%s", 
out‚ame
);

284 
	`bam_de°roy1
(
Æn
);

285 
	`bam_hdr_de°roy
(
hódî
);

286 
	`ßm_˛o£
(
ö
);

287 
	`ßm_˛o£
(
out
);

288 
	}
}

290 
	$ßmªc‹d_œyout
()

292 c⁄° 
q«mes
[] = "data:,"

300 
size_t
 
bam1_t_size
, 
bam1_t_size2
;

302 
bam1_t_size
 = 36 +  () + 4 +  (*);

303 #i‚de‡
BAM_NO_ID


304 
bam1_t_size
 += 8;

306 
bam1_t_size2
 = 
bam1_t_size
 + 4;

308 i‡( (
bam1_c‹e_t
) != 36)

309 
	`Áû
("sizeo‡bam1_c‹e_ài†%zu,Éx≥˘ed 36",  (
bam1_c‹e_t
));

311 i‡( (
bam1_t
Ë!
bam1_t_size
 &&  (bam1_tË!
bam1_t_size2
)

312 
	`Áû
("sizeof bam1_t is %zu,ÉxpectedÉither %zu or %zu",

313 (
bam1_t
), 
bam1_t_size
, 
bam1_t_size2
);

315 
	`c›y_check_Æignmít
(
q«mes
, "SAM",

316 "ã°/ßm_Æignmít.tmp.bam", "wb", 
NULL
);

317 
	`c›y_check_Æignmít
("test/sam_alignment.tmp.bam", "BAM",

319 
	`c›y_check_Æignmít
("test/sam_alignment.tmp.cram", "CRAM",

320 "ã°/ßm_Æignmít.tmp.ßm_", "w", 
NULL
);

321 
	}
}

323 
	$Áidx1
(c⁄° *
fûíame
)

325 
n
, 
n_exp
 = 0;

326 
tmpfûíame
[
FILENAME_MAX
], 
löe
[500];

327 
FILE
 *
fö
, *
fout
;

328 
Áidx_t
 *
Ái
;

330 
fö
 = 
	`f›í
(
fûíame
, "r");

331 i‡(
fö
 =
NULL
Ë
	`Áû
("ˇn'à›í %s\n", 
fûíame
);

332 
	`•rötf
(
tmpfûíame
, "%s.tmp", 
fûíame
);

333 
fout
 = 
	`f›í
(
tmpfûíame
, "w");

334 i‡(
fout
 =
NULL
Ë
	`Áû
("ˇn'à¸óãÅemp‹¨y %s\n", 
tmpfûíame
);

335 
	`fgës
(
löe
, Üöe, 
fö
)) {

336 i‡(
löe
[0] ='>'Ë
n_exp
++;

337 
	`Âuts
(
löe
, 
fout
);

339 
	`f˛o£
(
fö
);

340 
	`f˛o£
(
fout
);

342 i‡(
	`Ái_buûd
(
tmpfûíame
Ë< 0Ë
	`Áû
("can't index %s",Åmpfilename);

343 
Ái
 = 
	`Ái_lﬂd
(
tmpfûíame
);

344 i‡(
Ái
 =
NULL
Ë
	`Áû
("ˇn'àlﬂd faidx fûê%s", 
tmpfûíame
);

346 
n
 = 
	`Áidx_„tch_n£q
(
Ái
);

347 i‡(
n
 !
n_exp
)

348 
	`Áû
("%s: faidx_„tch_n£qÑëu∫ed %d,Éx≥˘ed %d", 
fûíame
, 
n
, 
n_exp
);

350 
n
 = 
	`Áidx_n£q
(
Ái
);

351 i‡(
n
 !
n_exp
)

352 
	`Áû
("%s: faidx_n£qÑëu∫ed %d,Éx≥˘ed %d", 
fûíame
, 
n
, 
n_exp
);

354 
	`Ái_de°roy
(
Ái
);

355 
	}
}

357 
	$check_íum1
()

360 i‡(
no_com¥essi⁄
 !0Ë
	`Áû
("no_compression is %d",Ço_compression);

361 i‡(
gzù
 !1Ë
	`Áû
("gzip is %d", gzip);

362 i‡(
bgzf
 !2Ë
	`Áû
("bgzf is %d", bgzf);

363 
	}
}

365 
	$maö
(
¨gc
, **
¨gv
)

367 
i
;

369 
°©us
 = 
EXIT_SUCCESS
;

371 
	`aux_fõlds1
();

372 
	`ôî©‹s1
();

373 
	`ßmªc‹d_œyout
();

374 
	`check_íum1
();

375 
i
 = 1; i < 
¨gc
; i++Ë
	`Áidx1
(
¨gv
[i]);

377  
°©us
;

378 
	}
}

	@htslib/test/test-bcf-sr.c

29 
	~<c⁄fig.h
>

31 
	~<gë›t.h
>

32 
	~<°dio.h
>

33 
	~<°d¨g.h
>

34 
	~<ht¶ib/syn˚d_bcf_ªadî.h
>

36 
	$îr‹
(c⁄° *
f‹m©
, ...)

38 
va_li°
 
≠
;

39 
	`va_°¨t
(
≠
, 
f‹m©
);

40 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
≠
);

41 
	`va_íd
(
≠
);

42 
	`exô
(-1);

43 
	}
}

45 
	$ußge
()

47 
	`Ârötf
(
°dîr
, "Usage:Åest-bcf-sr [OPTIONS] vcf-list.txt\n");

48 
	`Ârötf
(
°dîr
, "Options:\n");

49 
	`Ârötf
(
°dîr
, " -p, --pair <logic[+ref]>Üogic: snps,indels,both,snps+ref,indels+ref,both+ref,exact,some,all\n");

50 
	`Ârötf
(
°dîr
, "\n");

51 
	`exô
(-1);

52 
	}
}

54 
	$maö
(
¨gc
, *
¨gv
[])

56 
›ti⁄
 
l›ti⁄s
[] =

58 {"hñp",
no_¨gumít
,
NULL
,'h'},

59 {"∑ú",
ªquúed_¨gumít
,
NULL
,'p'},

60 {
NULL
,0,NULL,0}

63 
c
, 
∑ú
 = 0;

64 (
c
 = 
	`gë›t_l⁄g
(
¨gc
, 
¨gv
, "p:h", 
l›ti⁄s
, 
NULL
)) >= 0)

66 
c
)

69 i‡–!
	`°rcmp
(
›èrg
,"¢ps"ËË
∑ú
 |
BCF_SR_PAIR_SNPS
;

70 i‡–!
	`°rcmp
(
›èrg
,"¢p+ªf"ËË
∑ú
 |
BCF_SR_PAIR_SNPS
|
BCF_SR_PAIR_SNP_REF
;

71 i‡–!
	`°rcmp
(
›èrg
,"¢ps+ªf"ËË
∑ú
 |
BCF_SR_PAIR_SNPS
|
BCF_SR_PAIR_SNP_REF
;

72 i‡–!
	`°rcmp
(
›èrg
,"ödñs"ËË
∑ú
 |
BCF_SR_PAIR_INDELS
;

73 i‡–!
	`°rcmp
(
›èrg
,"ödñ+ªf"ËË
∑ú
 |
BCF_SR_PAIR_INDELS
|
BCF_SR_PAIR_INDEL_REF
;

74 i‡–!
	`°rcmp
(
›èrg
,"ödñs+ªf"ËË
∑ú
 |
BCF_SR_PAIR_INDELS
|
BCF_SR_PAIR_INDEL_REF
;

75 i‡–!
	`°rcmp
(
›èrg
,"bŸh"ËË
∑ú
 |
BCF_SR_PAIR_BOTH
;

76 i‡–!
	`°rcmp
(
›èrg
,"bŸh+ªf"ËË
∑ú
 |
BCF_SR_PAIR_BOTH_REF
;

77 i‡–!
	`°rcmp
(
›èrg
,"™y"ËË
∑ú
 |
BCF_SR_PAIR_ANY
;

78 i‡–!
	`°rcmp
(
›èrg
,"Æl"ËË
∑ú
 |
BCF_SR_PAIR_ANY
;

79 i‡–!
	`°rcmp
(
›èrg
,"some"ËË
∑ú
 |
BCF_SR_PAIR_SOME
;

80 i‡–!
	`°rcmp
(
›èrg
,"exa˘"ËË
∑ú
 = 
BCF_SR_PAIR_EXACT
;

81 
	`îr‹
("Thê--∑úÜogi¯\"%s\"ÇŸÑecogni£d.\n", 
›èrg
);

83 : 
	`ußge
();

86 i‡–!
∑ú
 )Öaú = 
BCF_SR_PAIR_EXACT
;

87 i‡–
›töd
 =
¨gc
 ) 
	`ußge
();

89 
i
, 
j
, 
n
, 
nvcf
;

90 **
vcf
 = 
	`hts_ªadli°
(
¨gv
[
›töd
], 1, &
nvcf
);

91 i‡–!
vcf
 ) 
	`îr‹
("CouldÇŸÖ¨£ %s\n", 
¨gv
[
›töd
]);

93 
bcf_§s_t
 *
§
 = 
	`bcf_§_öô
();

94 
	`bcf_§_£t_›t
(
§
, 
BCF_SR_PAIR_LOGIC
, 
∑ú
);

95 
	`bcf_§_£t_›t
(
§
, 
BCF_SR_REQUIRE_IDX
);

96 
i
=0; i<
nvcf
; i++)

97 i‡–!
	`bcf_§_add_ªadî
(
§
,
vcf
[
i
]ËË
	`îr‹
("FaûedÅÿ›í %s: %s\n", vcf[i],
	`bcf_§_°ªº‹
(§->
î∫um
));

99 
k°rög_t
 
°r
 = {0,0,0};

100  (
n
=
	`bcf_§_√xt_löe
(
§
)) )

102 
i
=0; i<
§
->
ƒódîs
; i++)

104 i‡–!
	`bcf_§_has_löe
(
§
,
i
) ) ;

105 
bcf1_t
 *
ªc
 = 
	`bcf_§_gë_löe
(
§
, 
i
);

106 
	`¥ötf
("%s:%d", 
	`bcf_£q«me
(
	`bcf_§_gë_hódî
(
§
,
i
),
ªc
),ªc->
pos
+1);

110 
i
=0; i<
§
->
ƒódîs
; i++)

112 
	`¥ötf
("\t");

114 i‡–!
	`bcf_§_has_löe
(
§
,
i
) )

116 
	`¥ötf
("%s","-");

120 
°r
.
l
 = 0;

121 
bcf1_t
 *
ªc
 = 
	`bcf_§_gë_löe
(
§
, 
i
);

122 
	`kputs
(
ªc
->
n_ÆÀÀ
 > 1 ?Ñec->
d
.
ÆÀÀ
[1] : ".", &
°r
);

123 
j
=2; j<
ªc
->
n_ÆÀÀ
; j++)

125 
	`kputc
(',', &
°r
);

126 
	`kputs
(
ªc
->
d
.
ÆÀÀ
[
j
], &
°r
);

128 
	`¥ötf
("%s",
°r
.
s
);

130 
	`¥ötf
("\n");

133 
	`‰ì
(
°r
.
s
);

134 
	`bcf_§_de°roy
(
§
);

135 
i
=0; i<
nvcf
; i++)

136 
	`‰ì
(
vcf
[
i
]);

137 
	`‰ì
(
vcf
);

140 
	}
}

	@htslib/test/test-regidx.c

26 
	~<c⁄fig.h
>

28 
	~<°d¨g.h
>

29 
	~<°dlib.h
>

30 
	~<°dio.h
>

31 
	~<°rög.h
>

32 
	~<ht¶ib/ªgidx.h
>

33 
	~"hts_öã∫Æ.h
"

35 
	$îr‹
(c⁄° *
f‹m©
, ...)

37 
va_li°
 
≠
;

38 
	`va_°¨t
(
≠
, 
f‹m©
);

39 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
≠
);

40 
	`va_íd
(
≠
);

41 
	`exô
(-1);

42 
	}
}

44 
	$cu°om_∑r£
(c⁄° *
löe
, **
chr_beg
, **
chr_íd
, 
ªg_t
 *
ªg
, *
∑ylﬂd
, *
u§
)

47 
i
, 
ªt
 = 
	`ªgidx_∑r£_èb
(
löe
,
chr_beg
,
chr_íd
,
ªg
,
NULL
,NULL);

48 i‡–
ªt
!=0 ) Ñet;

51 *
ss
 = (*Ë
löe
;

52  *
ss
 && 
	`is•a˚_c
(*ss) ) ss++;

53 
i
=0; i<3; i++)

55  *
ss
 && !
	`is•a˚_c
(*ss) ) ss++;

56 i‡–!*
ss
 )  -2;

57  *
ss
 && 
	`is•a˚_c
(*ss) ) ss++;

59 i‡–!*
ss
 )  -2;

62 *
£
 = 
ss
;

63  *
£
 && !
	`is•a˚_c
(*se) ) se++;

64 **
d©
 = (**Ë
∑ylﬂd
;

65 *
d©
 = (*Ë
	`mÆloc
(
£
-
ss
+1);

66 
	`mem˝y
(*
d©
,
ss
,
£
-ss+1);

67 (*
d©
)[
£
-
ss
] = 0;

69 
	}
}

70 
	$cu°om_‰ì
(*
∑ylﬂd
)

72 **
d©
 = (**)
∑ylﬂd
;

73 
	`‰ì
(*
d©
);

74 
	}
}

76 
	$maö
(
¨gc
, **
¨gv
)

79 
ªgidx_t
 *
idx
 = 
	`ªgidx_öô
(
NULL
,
cu°om_∑r£
,
cu°om_‰ì
,(*),NULL);

80 i‡–!
idx
 ) 
	`îr‹
("init failed\n");

83 *
löe
;

84 
löe
 = "1 10000000 10000000 1:10000000-10000000"; i‡–
	`ªgidx_ö£π
(
idx
,löe)!=0 ) 
	`îr‹
("insert failed: %s\n",Üine);

85 
löe
 = "1 20000000 20000001 1:20000000-20000001"; i‡–
	`ªgidx_ö£π
(
idx
,löe)!=0 ) 
	`îr‹
("insert failed: %s\n",Üine);

86 
löe
 = "1 20000002 20000002 1:20000002-20000002"; i‡–
	`ªgidx_ö£π
(
idx
,löe)!=0 ) 
	`îr‹
("insert failed: %s\n",Üine);

87 
löe
 = "1 30000000 30000000 1:30000000-30000000"; i‡–
	`ªgidx_ö£π
(
idx
,löe)!=0 ) 
	`îr‹
("insert failed: %s\n",Üine);

90 
	`ªgidx_ö£π
(
idx
,
NULL
);

93 
ªgôr_t
 
ôr
;

94 
‰om
, 
to
;

96 
‰om
 = 
to
 = 10000000;

97 i‡–!
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-1,
to
-1,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from,to);

98 i‡–
	`°rcmp
("1:10000000-10000000",
	`REGITR_PAYLOAD
(
ôr
,*)ËË
	`îr‹
("quîy faûed: 1:%d-%d v†%s\n", 
‰om
,
to
,REGITR_PAYLOAD(itr,*));

99 i‡–!
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-2,
to
-1,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from-1,to);

100 i‡–!
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-2,
to
+3,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from-1,to+2);

101 i‡–
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-2,
to
-2,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from-1,to-1);

103 
‰om
 = 
to
 = 20000000;

104 i‡–!
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-1,
to
-1,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from,to);

106 
‰om
 = 
to
 = 20000002;

107 i‡–!
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-1,
to
-1,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from,to);

109 
‰om
 = 
to
 = 30000000;

110 i‡–!
	`ªgidx_ovîœp
(
idx
,"1",
‰om
-1,
to
-1,&
ôr
ËË
	`îr‹
("query failed: 1:%d-%d\n",from,to);

113 
	`ªgidx_de°roy
(
idx
);

116 
	}
}

	@htslib/test/test-vcf-api.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<ht¶ib/hts.h
>

29 
	~<ht¶ib/vcf.h
>

30 
	~<ht¶ib/k°rög.h
>

31 
	~<ht¶ib/k£q.h
>

33 
	$wrôe_bcf
(*
‚ame
)

36 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
,"wb");

37 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_öô
("w");

38 
bcf1_t
 *
ªc
 = 
	`bcf_öô1
();

41 
k°rög_t
 
°r
 = {0,0,0};

42 
	`bcf_hdr_≠≥nd
(
hdr
, "##fileDate=20090805");

43 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=UF,Number=1,Type=Integer,Description=\"Unused FORMAT\">");

44 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=UI,Number=1,Type=Integer,Description=\"Unused INFO\">");

45 
	`bcf_hdr_≠≥nd
(
hdr
, "##FILTER=<ID=Flt,Description=\"Unused FILTER\">");

46 
	`bcf_hdr_≠≥nd
(
hdr
, "##unused=<XX=AA,Description=\"Unused generic\">");

47 
	`bcf_hdr_≠≥nd
(
hdr
, "##unused=unformattedÅext 1");

48 
	`bcf_hdr_≠≥nd
(
hdr
, "##unused=unformattedÅext 2");

49 
	`bcf_hdr_≠≥nd
(
hdr
, "##contig=<ID=Unused,length=62435964>");

50 
	`bcf_hdr_≠≥nd
(
hdr
, "##source=myImputationProgramV3.1");

51 
	`bcf_hdr_≠≥nd
(
hdr
, "##reference=file:///seq/references/1000GenomesPilot-NCBI36.fasta");

52 
	`bcf_hdr_≠≥nd
(
hdr
, "##contig=<ID=20,length=62435964,assembly=B36,md5=f126cdf8a6e0c7f379d618ff66beb2da,species=\"Homo sapiens\",taxonomy=x>");

53 
	`bcf_hdr_≠≥nd
(
hdr
, "##phasing=partial");

54 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=NS,Number=1,Type=Integer,Description=\"Number of Samples With Data\">");

55 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=DP,Number=1,Type=Integer,Description=\"Total Depth\">");

56 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=AF,Number=A,Type=Float,Description=\"Allele Frequency\">");

57 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=AA,Number=1,Type=String,Description=\"Ancestral Allele\">");

58 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=DB,Number=0,Type=Flag,Description=\"dbSNP membership, build 129\">");

59 
	`bcf_hdr_≠≥nd
(
hdr
, "##INFO=<ID=H2,Number=0,Type=Flag,Description=\"HapMap2 membership\">");

60 
	`bcf_hdr_≠≥nd
(
hdr
, "##FILTER=<ID=q10,Description=\"Quality below 10\">");

61 
	`bcf_hdr_≠≥nd
(
hdr
, "##FILTER=<ID=s50,Description=\"LessÅhan 50% of samples have data\">");

62 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=GT,Number=1,Type=String,Description=\"Genotype\">");

63 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=GQ,Number=1,Type=Integer,Description=\"Genotype Quality\">");

64 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=DP,Number=1,Type=Integer,Description=\"Read Depth\">");

65 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=HQ,Number=2,Type=Integer,Description=\"Haplotype Quality\">");

66 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=TS,Number=1,Type=String,Description=\"Test String\">");

68 
	`bcf_hdr_add_ßm∂e
(
hdr
, "NA00001");

69 
	`bcf_hdr_add_ßm∂e
(
hdr
, "NA00002");

70 
	`bcf_hdr_add_ßm∂e
(
hdr
, "NA00003");

71 
	`bcf_hdr_add_ßm∂e
(
hdr
, 
NULL
);

72 
	`bcf_hdr_wrôe
(
Â
, 
hdr
);

78 
ªc
->
rid
 = 
	`bcf_hdr_«me2id
(
hdr
, "20");

80 
ªc
->
pos
 = 14369;

82 
	`bcf_upd©e_id
(
hdr
, 
ªc
, "rs6054257");

84 
	`bcf_upd©e_ÆÀÀs_°r
(
hdr
, 
ªc
, "G,A");

86 
ªc
->
quÆ
 = 29;

88 
öt32_t
 
tmpi
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, "PASS");

89 
	`bcf_upd©e_fûãr
(
hdr
, 
ªc
, &
tmpi
, 1);

91 
tmpi
 = 3;

92 
	`bcf_upd©e_öfo_öt32
(
hdr
, 
ªc
, "NS", &
tmpi
, 1);

93 
tmpi
 = 14;

94 
	`bcf_upd©e_öfo_öt32
(
hdr
, 
ªc
, "DP", &
tmpi
, 1);

95 
tmpf
 = 0.5;

96 
	`bcf_upd©e_öfo_Êﬂt
(
hdr
, 
ªc
, "AF", &
tmpf
, 1);

97 
	`bcf_upd©e_öfo_Êag
(
hdr
, 
ªc
, "DB", 
NULL
, 1);

98 
	`bcf_upd©e_öfo_Êag
(
hdr
, 
ªc
, "H2", 
NULL
, 1);

100 
öt32_t
 *
tmpü
 = (*)
	`mÆloc
(
	`bcf_hdr_nßm∂es
(
hdr
)*2*());

101 
tmpü
[0] = 
	`bcf_gt_pha£d
(0);

102 
tmpü
[1] = 
	`bcf_gt_pha£d
(0);

103 
tmpü
[2] = 
	`bcf_gt_pha£d
(1);

104 
tmpü
[3] = 
	`bcf_gt_pha£d
(0);

105 
tmpü
[4] = 
	`bcf_gt_u≈ha£d
(1);

106 
tmpü
[5] = 
	`bcf_gt_u≈ha£d
(1);

107 
	`bcf_upd©e_gíŸy≥s
(
hdr
, 
ªc
, 
tmpü
, 
	`bcf_hdr_nßm∂es
(hdr)*2);

108 
tmpü
[0] = 48;

109 
tmpü
[1] = 48;

110 
tmpü
[2] = 43;

111 
	`bcf_upd©e_f‹m©_öt32
(
hdr
, 
ªc
, "GQ", 
tmpü
, 
	`bcf_hdr_nßm∂es
(hdr));

112 
tmpü
[0] = 1;

113 
tmpü
[1] = 8;

114 
tmpü
[2] = 5;

115 
	`bcf_upd©e_f‹m©_öt32
(
hdr
, 
ªc
, "DP", 
tmpü
, 
	`bcf_hdr_nßm∂es
(hdr));

116 
tmpü
[0] = 51;

117 
tmpü
[1] = 51;

118 
tmpü
[2] = 51;

119 
tmpü
[3] = 51;

120 
tmpü
[4] = 
bcf_öt32_missög
;

121 
tmpü
[5] = 
bcf_öt32_missög
;

122 
	`bcf_upd©e_f‹m©_öt32
(
hdr
, 
ªc
, "HQ", 
tmpü
, 
	`bcf_hdr_nßm∂es
(hdr)*2);

123 *
tmp_°r
[] = {"String1","SomeOtherString2","YetAnotherString3"};

124 
	`bcf_upd©e_f‹m©_°rög
(
hdr
, 
ªc
, "TS", (c⁄° **)
tmp_°r
, 3);

125 
	`bcf_wrôe1
(
Â
, 
hdr
, 
ªc
);

128 
	`bcf_˛ór1
(
ªc
);

129 
ªc
->
rid
 = 
	`bcf_hdr_«me2id
(
hdr
, "20");

130 
ªc
->
pos
 = 1110695;

131 
	`bcf_upd©e_ÆÀÀs_°r
(
hdr
, 
ªc
, "A,G,T");

132 
ªc
->
quÆ
 = 67;

133 
tmpi
 = 2;

134 
	`bcf_upd©e_öfo_öt32
(
hdr
, 
ªc
, "NS", &
tmpi
, 1);

135 
tmpi
 = 10;

136 
	`bcf_upd©e_öfo_öt32
(
hdr
, 
ªc
, "DP", &
tmpi
, 1);

137 *
tmpÁ
 = (*)
	`mÆloc
(2*());

138 
tmpÁ
[0] = 0.333;

139 
	`bcf_Êﬂt_£t_missög
(
tmpÁ
[1]);

140 
	`bcf_upd©e_öfo_Êﬂt
(
hdr
, 
ªc
, "AF", 
tmpÁ
, 2);

141 
	`bcf_upd©e_öfo_°rög
(
hdr
, 
ªc
, "AA", "T");

142 
	`bcf_upd©e_öfo_Êag
(
hdr
, 
ªc
, "DB", 
NULL
, 1);

143 
tmpü
[0] = 
	`bcf_gt_pha£d
(2);

144 
tmpü
[1] = 
bcf_öt32_ve˘‹_íd
;

145 
tmpü
[2] = 
	`bcf_gt_pha£d
(1);

146 
tmpü
[3] = 
bcf_öt32_ve˘‹_íd
;

147 
tmpü
[4] = 
bcf_gt_missög
;

148 
tmpü
[5] = 
bcf_gt_missög
;

149 
	`bcf_upd©e_gíŸy≥s
(
hdr
, 
ªc
, 
tmpü
, 
	`bcf_hdr_nßm∂es
(hdr)*2);

150 
	`bcf_wrôe1
(
Â
, 
hdr
, 
ªc
);

152 
	`‰ì
(
tmpü
);

153 
	`‰ì
(
tmpÁ
);

156 
	`‰ì
(
°r
.
s
);

157 
	`bcf_de°roy1
(
ªc
);

158 
	`bcf_hdr_de°roy
(
hdr
);

159 
ªt
;

160 i‡–(
ªt
=
	`hts_˛o£
(
Â
)) )

162 
	`Ârötf
(
°dîr
,"hts_˛o£(%s):Ç⁄-zîÿ°©u†%d\n",
‚ame
,
ªt
);

163 
	`exô
(
ªt
);

165 
	}
}

167 
	$bcf_to_vcf
(*
‚ame
)

169 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
,"rb");

170 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_ªad
(
Â
);

171 
bcf1_t
 *
ªc
 = 
	`bcf_öô1
();

173 *
gz_‚ame
 = (*Ë
	`mÆloc
(
	`°æí
(
‚ame
)+4);

174 
	`¢¥ötf
(
gz_‚ame
,
	`°æí
(
‚ame
)+4,"%s.gz",fname);

175 
htsFûe
 *
out
 = 
	`hts_›í
(
gz_‚ame
,"wg");

177 
bcf_hdr_t
 *
hdr_out
 = 
	`bcf_hdr_dup
(
hdr
);

178 
	`bcf_hdr_ªmove
(
hdr_out
,
BCF_HL_STR
,"unused");

179 
	`bcf_hdr_ªmove
(
hdr_out
,
BCF_HL_GEN
,"unused");

180 
	`bcf_hdr_ªmove
(
hdr_out
,
BCF_HL_FLT
,"Flt");

181 
	`bcf_hdr_ªmove
(
hdr_out
,
BCF_HL_INFO
,"UI");

182 
	`bcf_hdr_ªmove
(
hdr_out
,
BCF_HL_FMT
,"UF");

183 
	`bcf_hdr_ªmove
(
hdr_out
,
BCF_HL_CTG
,"Unused");

184 
	`bcf_hdr_wrôe
(
out
, 
hdr_out
);

186  
	`bcf_ªad1
(
Â
, 
hdr
, 
ªc
)>=0 )

188 
	`bcf_wrôe1
(
out
, 
hdr_out
, 
ªc
);

193 
	`bcf_u≈ack
(
ªc
, 
BCF_UN_STR
);

194 
	`bcf_upd©e_id
(
hdr
, 
ªc
, 0);

195 
	`bcf_upd©e_f‹m©_öt32
(
hdr
, 
ªc
, "GQ", 
NULL
, 0);

197 
bcf1_t
 *
dup
 = 
	`bcf_dup
(
ªc
);

198 
	`bcf_wrôe1
(
out
, 
hdr_out
, 
dup
);

199 
	`bcf_de°roy1
(
dup
);

201 
	`bcf_upd©e_ÆÀÀs_°r
(
hdr_out
, 
ªc
, "G,A");

202 
öt32_t
 
tmpi
 = 99;

203 
	`bcf_upd©e_öfo_öt32
(
hdr_out
, 
ªc
, "DP", &
tmpi
, 1);

204 
öt32_t
 
tmpü
[] = {9,9,9};

205 
	`bcf_upd©e_f‹m©_öt32
(
hdr_out
, 
ªc
, "DP", 
tmpü
, 3);

207 
	`bcf_wrôe1
(
out
, 
hdr_out
, 
ªc
);

210 
	`bcf_de°roy1
(
ªc
);

211 
	`bcf_hdr_de°roy
(
hdr
);

212 
	`bcf_hdr_de°roy
(
hdr_out
);

213 
ªt
;

214 i‡–(
ªt
=
	`hts_˛o£
(
Â
)) )

216 
	`Ârötf
(
°dîr
,"hts_˛o£(%s):Ç⁄-zîÿ°©u†%d\n",
‚ame
,
ªt
);

217 
	`exô
(
ªt
);

219 i‡–(
ªt
=
	`hts_˛o£
(
out
)) )

221 
	`Ârötf
(
°dîr
,"hts_˛o£(%s):Ç⁄-zîÿ°©u†%d\n",
gz_‚ame
,
ªt
);

222 
	`exô
(
ªt
);

227 
htsFûe
 *
gz_ö
 = 
	`hts_›í
(
gz_‚ame
, "r");

228 i‡–!
gz_ö
 )

230 
	`Ârötf
(
°dîr
,"CouldÇŸÑód: %s\n", 
gz_‚ame
);

231 
	`exô
(1);

234 
k°rög_t
 
löe
 = {0,0,0};

235  
	`hts_gëlöe
(
gz_ö
, 
KS_SEP_LINE
, &
löe
)>0 )

237 
	`kputc
('\n',&
löe
);

238 
	`fwrôe
(
löe
.
s
,1,löe.
l
,
°dout
);

241 i‡–(
ªt
=
	`hts_˛o£
(
gz_ö
)) )

243 
	`Ârötf
(
°dîr
,"hts_˛o£(%s):Ç⁄-zîÿ°©u†%d\n",
gz_‚ame
,
ªt
);

244 
	`exô
(
ªt
);

246 
	`‰ì
(
löe
.
s
);

247 
	`‰ì
(
gz_‚ame
);

248 
	}
}

250 
	$ôî©‹
(c⁄° *
‚ame
)

252 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
, "r");

253 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_ªad
(
Â
);

254 
hts_idx_t
 *
idx
;

255 
hts_ôr_t
 *
ôî
;

257 
	`bcf_ödex_buûd
(
‚ame
, 0);

258 
idx
 = 
	`bcf_ödex_lﬂd
(
‚ame
);

260 
ôî
 = 
	`bcf_ôr_quîyi
(
idx
, 
	`bcf_hdr_«me2id
(
hdr
, "20"), 1110600, 1110800);

261 
	`bcf_ôr_de°roy
(
ôî
);

263 
ôî
 = 
	`bcf_ôr_quîys
(
idx
, 
hdr
, "20:1110600-1110800");

264 
	`bcf_ôr_de°roy
(
ôî
);

266 
	`hts_idx_de°roy
(
idx
);

267 
	`bcf_hdr_de°roy
(
hdr
);

268 
ªt
;

269 i‡–(
ªt
=
	`hts_˛o£
(
Â
)) )

271 
	`Ârötf
(
°dîr
,"hts_˛o£(%s):Ç⁄-zîÿ°©u†%d\n",
‚ame
,
ªt
);

272 
	`exô
(
ªt
);

274 
	}
}

276 
	$ã°_gë_öfo_vÆues
(c⁄° *
‚ame
)

278 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
, "r");

279 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_ªad
(
Â
);

280 
bcf1_t
 *
löe
 = 
	`bcf_öô
();

282 
	`bcf_ªad
(
Â
, 
hdr
, 
löe
) == 0)

284 *
afs
 = 0;

285 
cou¡
 = 0;

286 
ªt
 = 
	`bcf_gë_öfo_Êﬂt
(
hdr
, 
löe
, "AF", &
afs
, &
cou¡
);

288 i‡(
löe
->
pos
 == 14369)

290 i‡(
ªt
 !1 || 
afs
[0] != 0.5f)

292 
	`Ârötf
(
°dîr
, "AF onÖosition 14370 should be 0.5\n");

293 
	`exô
(-1);

298 i‡(
ªt
 !2 || 
afs
[0] !0.333‡|| !
	`bcf_Êﬂt_is_missög
(afs[1]))

300 
	`Ârötf
(
°dîr
, "AF onÖosition 1110696 should be 0.333, missing\n");

301 
	`exô
(-1);

305 
	`‰ì
(
afs
);

308 
	`bcf_de°roy
(
löe
);

309 
	`bcf_hdr_de°roy
(
hdr
);

310 
	`hts_˛o£
(
Â
);

311 
	}
}

313 
	$wrôe_f‹m©_vÆues
(c⁄° *
‚ame
)

316 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
, "wb");

317 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_öô
("w");

318 
bcf1_t
 *
ªc
 = 
	`bcf_öô1
();

321 
	`bcf_hdr_≠≥nd
(
hdr
, "##contig=<ID=1>");

322 
	`bcf_hdr_≠≥nd
(
hdr
, "##FORMAT=<ID=TF,Number=1,Type=Float,Description=\"Test Float\">");

323 
	`bcf_hdr_add_ßm∂e
(
hdr
, "S");

324 
	`bcf_hdr_add_ßm∂e
(
hdr
, 
NULL
);

325 
	`bcf_hdr_wrôe
(
Â
, 
hdr
);

329 
ã°
[4];

330 
	`bcf_Êﬂt_£t_missög
(
ã°
[0]);

331 
ã°
[1] = 47.11f;

332 
	`bcf_Êﬂt_£t_ve˘‹_íd
(
ã°
[2]);

333 
	`bcf_upd©e_f‹m©_Êﬂt
(
hdr
, 
ªc
, "TF", 
ã°
, 4);

334 
	`bcf_wrôe1
(
Â
, 
hdr
, 
ªc
);

336 
	`bcf_de°roy1
(
ªc
);

337 
	`bcf_hdr_de°roy
(
hdr
);

338 
ªt
;

339 i‡((
ªt
 = 
	`hts_˛o£
(
Â
)))

341 
	`Ârötf
(
°dîr
, "hts_˛o£(%s):Ç⁄-zîÿ°©u†%d\n", 
‚ame
, 
ªt
);

342 
	`exô
(
ªt
);

344 
	}
}

346 
	$check_f‹m©_vÆues
(c⁄° *
‚ame
)

348 
htsFûe
 *
Â
 = 
	`hts_›í
(
‚ame
, "r");

349 
bcf_hdr_t
 *
hdr
 = 
	`bcf_hdr_ªad
(
Â
);

350 
bcf1_t
 *
löe
 = 
	`bcf_öô
();

352 
	`bcf_ªad
(
Â
, 
hdr
, 
löe
) == 0)

354 *
vÆues
 = 0;

355 
cou¡
 = 0;

356 
ªt
 = 
	`bcf_gë_f‹m©_Êﬂt
(
hdr
, 
löe
, "TF", &
vÆues
, &
cou¡
);

360 i‡(
ªt
 != 4 ||

361 
cou¡
 < 
ªt
 ||

362 !
	`bcf_Êﬂt_is_missög
(
vÆues
[0]) ||

363 
vÆues
[1] != 47.11f ||

364 !
	`bcf_Êﬂt_is_ve˘‹_íd
(
vÆues
[2]) ||

365 !
	`bcf_Êﬂt_is_ve˘‹_íd
(
vÆues
[3]))

367 
	`Ârötf
(
°dîr
, "bcf_get_format_float didn'tÖroduceÅheÉxpected output.\n");

368 
	`exô
(-1);

371 
	`‰ì
(
vÆues
);

374 
	`bcf_de°roy
(
löe
);

375 
	`bcf_hdr_de°roy
(
hdr
);

376 
	`hts_˛o£
(
Â
);

377 
	}
}

379 
	$ã°_gë_f‹m©_vÆues
(c⁄° *
‚ame
)

381 
	`wrôe_f‹m©_vÆues
(
‚ame
);

382 
	`check_f‹m©_vÆues
(
‚ame
);

383 
	}
}

385 
	$maö
(
¨gc
, **
¨gv
)

387 *
‚ame
 = 
¨gc
>1 ? 
¨gv
[1] : "rmme.bcf";

390 
	`ã°_gë_f‹m©_vÆues
(
‚ame
);

393 
	`wrôe_bcf
(
‚ame
);

394 
	`bcf_to_vcf
(
‚ame
);

395 
	`ôî©‹
(
‚ame
);

398 
	`ã°_gë_öfo_vÆues
(
‚ame
);

401 
	}
}

	@htslib/test/test-vcf-sweep.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<ht¶ib/vcf_swìp.h
>

30 
	$maö
(
¨gc
, **
¨gv
)

32 i‡–
¨gc
!=2 )

34 
	`Ârötf
(
°dîr
,"Usage:Åest-vcf-sweep <file.bcf|file.vcf>\n");

41 
bcf_swìp_t
 *
sw
 = 
	`bcf_swìp_öô
(
¨gv
[1]);

42 
bcf_hdr_t
 *
hdr
 = 
	`bcf_swìp_hdr
(
sw
);

43 
chksum
 = 0;

48 
bcf1_t
 *
ªc
;

49  (
ªc
 = 
	`bcf_swìp_fwd
(
sw
)ËË
chksum
 +ªc->
pos
+1;

50 
	`¥ötf
("fwdÖosôi⁄ chksum: %d\n", 
chksum
);

53 
chksum
 = 0;

54  (
ªc
 = 
	`bcf_swìp_bwd
(
sw
)ËË
chksum
 +ªc->
pos
+1;

55 
	`¥ötf
("bwdÖosôi⁄ chksum: %d\n", 
chksum
);

58 
i
,
j
, 
mPLs
 = 0, 
nPLs
;

59 
öt32_t
 *
PLs
 = 
NULL
;

60 
chksum
 = 0;

61  (
ªc
 = 
	`bcf_swìp_fwd
(
sw
)) )

64 
nPLs
 = 
	`bcf_gë_f‹m©_öt32
(
hdr
, 
ªc
, "PL", &
PLs
, &
mPLs
);

65 i‡–!
nPLs
 ) ;

68 
nvÆs
 = 
nPLs
 / 
	`bcf_hdr_nßm∂es
(
hdr
);

70 
öt32_t
 *
±r
 = 
PLs
;

71 
i
=0; i<
	`bcf_hdr_nßm∂es
(
hdr
); i++)

73 
j
=0; j<
nvÆs
; j++)

76 i‡–
±r
[
j
]==
bcf_öt32_ve˘‹_íd
 ) ;

79 i‡–
±r
[
j
]==
bcf_öt32_missög
 ) ;

81 
chksum
 +
±r
[
j
];

83 
±r
 +
nvÆs
;

86 
	`¥ötf
("fwd PL chksum: %d\n", 
chksum
);

89 
chksum
 = 0;

90  (
ªc
 = 
	`bcf_swìp_bwd
(
sw
)) )

92 
nPLs
 = 
	`bcf_gë_f‹m©_öt32
(
hdr
, 
ªc
, "PL", &
PLs
, &
mPLs
);

93 i‡–!
nPLs
 ) ;

94 
nvÆs
 = 
nPLs
 / 
	`bcf_hdr_nßm∂es
(
hdr
);

95 
öt32_t
 *
±r
 = 
PLs
;

96 
i
=0; i<
	`bcf_hdr_nßm∂es
(
hdr
); i++)

98 
j
=0; j<
nvÆs
; j++)

100 i‡–
±r
[
j
]==
bcf_öt32_ve˘‹_íd
 ) ;

101 i‡–
±r
[
j
]==
bcf_öt32_missög
 ) ;

102 
chksum
 +
±r
[
j
];

104 
±r
 +
nvÆs
;

107 
	`¥ötf
("bwd PL chksum: %d\n", 
chksum
);

110 
	`bcf_swìp_de°roy
(
sw
);

112 
	}
}

	@htslib/test/test_bgzf.c

26 
	~<°dlib.h
>

27 
	~<°dio.h
>

28 
	~<°rög.h
>

29 
	~<î∫o.h
>

30 
	~<sys/ty≥s.h
>

31 
	~<sys/°©.h
>

32 
	~<f˙é.h
>

33 
	~"ht¶ib/bgzf.h
"

34 
	~"ht¶ib/hfûe.h
"

36 c⁄° *
	gbgzf_suffix
 = ".gz";

37 c⁄° *
	gidx_suffix
 = ".gzi";

38 c⁄° *
	gtmp_suffix
 = ".tmp";

40 
	#BUFSZ
 32768

	)

43 *
	m§c_∂aö
;

44 *
	m§c_bgzf
;

45 *
	m§c_idx
;

46 *
	mtmp_bgzf
;

47 *
	mtmp_idx
;

48 
FILE
 *
	mf_∂aö
;

49 
FILE
 *
	mf_bgzf
;

50 
FILE
 *
	mf_idx
;

51 c⁄° *
	mãxt
;

52 
size_t
 
	m…ext
;

53 } 
	tFûes
;

56 
	mUSE_BGZF_OPEN
,

57 
	mUSE_BGZF_DOPEN
,

58 
	mUSE_BGZF_HOPEN


59 } 
	tO≥n_mëhod
;

61 
FILE
 * 
	$åy_f›í
(c⁄° *
«me
, c⁄° *
mode
) {

62 
FILE
 *
f
 = 
	`f›í
(
«me
, 
mode
);

63 i‡(!
f
) {

64 
	`Ârötf
(
°dîr
, "Couldn'à›í %†: %s\n", 
«me
, 
	`°ªº‹
(
î∫o
));

65  
NULL
;

67  
f
;

68 
	}
}

70 
	$åy_f˛o£
(
FILE
 **
fûe
, c⁄° *
«me
, c⁄° *
func
) {

71 
FILE
 *
to_˛o£
 = *
fûe
;

72 *
fûe
 = 
NULL
;

73 i‡(
	`f˛o£
(
to_˛o£
) != 0) {

74 
	`Ârötf
(
°dîr
, "%s : Error on closing %s : %s\n",

75 
func
, 
«me
, 
	`°ªº‹
(
î∫o
));

80 
	}
}

82 
ssize_t
 
	$åy_‰ód
(
FILE
 *
ö
, *
buf
, 
size_t
 
Àn
,

83 c⁄° *
func
, c⁄° *
‚ame
) {

84 
size_t
 
gŸ
 = 
	`‰ód
(
buf
, 1, 
Àn
, 
ö
);

85 i‡(
gŸ
 =0 && 
	`„º‹
(
ö
)) {

86 
	`Ârötf
(
°dîr
, "%s : ErrorÑeading from %s : %s\n",

87 
func
, 
‚ame
, 
	`°ªº‹
(
î∫o
));

90  
gŸ
;

91 
	}
}

93 
	$åy_f£ek_°¨t
(
FILE
 *
f
, c⁄° *
«me
, c⁄° *
func
) {

94 i‡(0 !
	`f£ek
(
f
, 0, 
SEEK_SET
)) {

95 
	`Ârötf
(
°dîr
, "%s : Couldn't seek on %s : %s\n",

96 
func
, 
«me
, 
	`°ªº‹
(
î∫o
));

100 
	}
}

102 
BGZF
 * 
	$åy_bgzf_›í
(c⁄° *
«me
, c⁄° *
mode
,

103 c⁄° *
func
) {

104 
BGZF
 * 
bgz
 = 
	`bgzf_›í
(
«me
, 
mode
);

105 i‡(!
bgz
) {

106 
	`Ârötf
(
°dîr
, "%s : Couldn't bgzf_open %s with mode %s : %s\n",

107 
func
, 
«me
, 
mode
, 
	`°ªº‹
(
î∫o
));

108  
NULL
;

110  
bgz
;

111 
	}
}

113 
BGZF
 * 
	$åy_bgzf_d›í
(c⁄° *
«me
, c⁄° *
mode
,

114 c⁄° *
func
) {

115 
BGZF
 *
bgz
 = 
NULL
;

116 
fd
 = -1;

117 i‡(
	`°rchr
(
mode
, 'r')) {

118 
fd
 = 
	`›í
(
«me
, 
O_RDONLY
);

119 } i‡(
	`°rchr
(
mode
, 'w')) {

120 
fd
 = 
	`›í
(
«me
, 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0666);

121 } i‡(
	`°rchr
(
mode
, 'a')) {

122 
fd
 = 
	`›í
(
«me
, 
O_WRONLY
 | 
O_CREAT
 | 
O_APPEND
, 0666);

124 
î∫o
 = 
EINVAL
;

127 i‡(
fd
 < 0) {

128 
	`Ârötf
(
°dîr
, "%s : FailedÅo open %s with mode %s : %s\n",

129 
func
, 
«me
, 
mode
, 
	`°ªº‹
(
î∫o
));

130  
NULL
;

133 
bgz
 = 
	`bgzf_d›í
(
fd
, 
mode
);

134 i‡(!
bgz
) {

135 
	`Ârötf
(
°dîr
, "%s : bgzf_dopen failed on %s mode %s : %s\n",

136 
func
, 
«me
, 
mode
, 
	`°ªº‹
(
î∫o
));

137 
	`˛o£
(
fd
);

138  
NULL
;

141  
bgz
;

142 
	}
}

144 
BGZF
 * 
	$åy_bgzf_h›í
(c⁄° *
«me
, c⁄° *
mode
,

145 c⁄° *
func
) {

146 
hFILE
 *
hÂ
 = 
	`h›í
(
«me
, 
mode
);

147 
BGZF
 *
bgz
 = 
NULL
;

149 i‡(!
hÂ
) {

150 
	`Ârötf
(
°dîr
, "%s : hopen failed on %s mode %s : %s\n",

151 
func
, 
«me
, 
mode
, 
	`°ªº‹
(
î∫o
));

152  
NULL
;

155 
bgz
 = 
	`bgzf_h›í
(
hÂ
, 
mode
);

156 i‡(!
bgz
) {

157 
	`Ârötf
(
°dîr
, "%s : bgzf_hopen failed on %s mode %s : %s\n",

158 
func
, 
«me
, 
mode
, 
	`°ªº‹
(
î∫o
));

159 
	`h˛o£_abru±ly
(
hÂ
);

160  
NULL
;

163  
bgz
;

164 
	}
}

166 
	$åy_bgzf_˛o£
(
BGZF
 **
bgz
, c⁄° *
«me
, c⁄° *
func
) {

167 
BGZF
 *
to_˛o£
 = *
bgz
;

168 *
bgz
 = 
NULL
;

169 i‡(
	`bgzf_˛o£
(
to_˛o£
) != 0) {

170 
	`Ârötf
(
°dîr
, "%s : bgzf_close failed on %s : %s\n",

171 
func
, 
«me
, 
	`°ªº‹
(
î∫o
));

175 
	}
}

177 
ssize_t
 
	$åy_bgzf_ªad
(
BGZF
 *
Â
, *
d©a
, 
size_t
 
Àngth
,

178 c⁄° *
«me
, c⁄° *
func
) {

179 
ssize_t
 
gŸ
 = 
	`bgzf_ªad
(
Â
, 
d©a
, 
Àngth
);

180 i‡(
gŸ
 < 0) {

181 
	`Ârötf
(
°dîr
, "%s : Error from bgzf_read %s : %s\n",

182 
func
, 
«me
, 
	`°ªº‹
(
î∫o
));

184  
gŸ
;

185 
	}
}

187 
ssize_t
 
	$åy_bgzf_wrôe
(
BGZF
 *
Â
, c⁄° *
d©a
, 
size_t
 
Àngth
,

188 c⁄° *
«me
, c⁄° *
func
) {

189 
ssize_t
 
put
 = 
	`bgzf_wrôe
(
Â
, 
d©a
, 
Àngth
);

190 i‡(
put
 < (
ssize_t
Ë
Àngth
) {

191 
	`Ârötf
(
°dîr
, "%s : %s %s : %s\n",

192 
func
, 
put
 < 0 ? "Error writingÅo" : "Short write on",

193 
«me
, 
	`°ªº‹
(
î∫o
));

197  
put
;

198 
	}
}

200 
	$åy_bgzf_com¥essi⁄
(
BGZF
 *
Â
, 
ex≥˘
,

201 c⁄° *
«me
, c⁄° *
func
) {

202 
ªs
 = 
	`bgzf_com¥essi⁄
(
Â
);

203 i‡(
ªs
 !
ex≥˘
) {

204 
	`Ârötf
(
°dîr
,

207 
func
, 
ªs
, 
«me
, 
ex≥˘
);

211 
	}
}

213 
	$åy_bgzf_mt
(
BGZF
 *
bgz
, 
¡hªads
, c⁄° *
func
) {

214 i‡(
	`bgzf_mt
(
bgz
, 
¡hªads
, 64) != 0) {

215 
	`Ârötf
(
°dîr
, "%s : Error from bgzf_mt : %s\n",

216 
func
, 
	`°ªº‹
(
î∫o
));

220 
	}
}

222 
	$åy_bgzf_ödex_buûd_öô
(
BGZF
 *
bgz
,

223 c⁄° *
«me
, c⁄° *
func
) {

224 i‡(
	`bgzf_ödex_buûd_öô
(
bgz
) != 0) {

225 
	`Ârötf
(
°dîr
, "%s : Error from bgzf_index_build_init on %s : %s\n",

226 
func
, 
«me
, 
	`°ªº‹
(
î∫o
));

230 
	}
}

232 
	$åy_bgzf_ödex_lﬂd
(
BGZF
 *
Â
, c⁄° *
b«me
, c⁄° *
suffix
,

233 c⁄° *
func
) {

234 i‡(
	`bgzf_ödex_lﬂd
(
Â
, 
b«me
, 
suffix
) != 0) {

235 
	`Ârötf
(
°dîr
, "%s : Couldn't bgzf_index_load %s%s : %s\n",

236 
func
, 
b«me
, 
suffix
 ? suffix : "", 
	`°ªº‹
(
î∫o
));

240 
	}
}

242 
	$åy_bgzf_ödex_dump
(
BGZF
 *
Â
, c⁄° *
b«me
, c⁄° *
suffix
,

243 c⁄° *
func
) {

244 i‡(
	`bgzf_ödex_dump
(
Â
, 
b«me
, 
suffix
) != 0) {

245 
	`Ârötf
(
°dîr
, "%s : Couldn't bgzf_index_dump %s%s : %s\n",

246 
func
, 
b«me
, 
suffix
 ? suffix : "", 
	`°ªº‹
(
î∫o
));

250 
	}
}

252 
	$åy_bgzf_u£ek
(
BGZF
 *
Â
, 
uoff£t
, 
whîe
,

253 c⁄° *
«me
, c⁄° *
func
) {

254 i‡(
	`bgzf_u£ek
(
Â
, 
uoff£t
, 
whîe
) < 0) {

255 
	`Ârötf
(
°dîr
, "%s : Error from bgzf_useek(%s, %ld, %d) : %s\n",

256 
func
, 
«me
, 
uoff£t
, 
whîe
, 
	`°ªº‹
(
î∫o
));

260 
	}
}

262 
	$åy_bgzf_gëc
(
BGZF
 *
Â
, 
size_t
 
pos
, 
ex≥˘ed
,

263 c⁄° *
«me
, c⁄° *
func
) {

264 
c
 = 
	`bgzf_gëc
(
Â
);

265 i‡(
c
 !
ex≥˘ed
) {

266 
	`Ârötf
(
°dîr
,

269 
func
, 
c
, 
«me
, 
pos
, 
ex≥˘ed
);

272  
c
;

273 
	}
}

275 
	$com∑ª_buf„rs
(c⁄° *
b1
, c⁄° *
b2
,

276 
size_t
 
l1
, size_à
l2
,

277 c⁄° *
«me1
, c⁄° *
«me2
,

278 c⁄° *
func
) {

279 i‡(
l1
 !
l2
) {

280 
	`Ârötf
(
°dîr
, "%†: EOF o¿%s\n", 
func
, 
l1
 < 
l2
 ? 
«me1
 : 
«me2
);

283 i‡(
	`memcmp
(
b1
, 
b2
, 
l1
) != 0) {

284 
	`Ârötf
(
°dîr
, "%s : difference between %sánd %s\n",

285 
func
, 
«me1
, 
«me2
);

290 
	}
}

292 
	$˛ónup
(
Fûes
 *
f
, 
ªtvÆ
) {

294 i‡(
ªtvÆ
 =
EXIT_SUCCESS
) {

295 
	`u∆ök
(
f
->
tmp_bgzf
);

296 
	`u∆ök
(
f
->
tmp_idx
);

298 i‡(
f
->
f_∂aö
Ë
	`f˛o£
(f->f_plain);

299 i‡(
f
->
f_bgzf
Ë
	`f˛o£
(f->f_bgzf);

300 i‡(
f
->
f_idx
Ë
	`f˛o£
(f->f_idx);

301 
	`‰ì
(
f
->
§c_∂aö
);

302 
	`‰ì
((*Ë
f
->
ãxt
);

303 
	}
}

305 
	$£tup
(c⁄° *
§c
, 
Fûes
 *
f
) {

306 
size_t
 
Àn
 = (
	`°æí
(
§c
Ë+ såÀn(
bgzf_suffix
Ë+ såÀn(
idx_suffix
)

307 + 
	`°æí
(
tmp_suffix
) + 8);

308 *
mem
, *
ãxt
;

309 c⁄° 
max
 = 50000;

310 
i
;

311 
size_t
 
ãxt_sz
 = 
max
 * 8 + 1;

313 
mem
 = 
	`ˇŒoc
(5, 
Àn
);

314 i‡(
mem
 =
NULL
) {

315 
	`≥º‹
(
__func__
);

319 
	`¢¥ötf
(
mem
, 
Àn
, "%s", 
§c
);

320 
	`¢¥ötf
(
mem
 + 
Àn
 * 1,Üí, "%s%s", 
§c
, 
bgzf_suffix
);

321 
	`¢¥ötf
(
mem
 + 
Àn
 * 2,Üí, "%s%s%s", 
§c
, 
bgzf_suffix
, 
idx_suffix
);

322 
	`¢¥ötf
(
mem
 + 
Àn
 * 3,Üí, "%s%s%s", 
§c
, 
tmp_suffix
, 
bgzf_suffix
);

323 
	`¢¥ötf
(
mem
 + 
Àn
 * 4,Üen, "%s%s%s%s",

324 
§c
, 
tmp_suffix
, 
bgzf_suffix
, 
idx_suffix
);

326 
f
->
§c_∂aö
 = 
mem
;

327 
f
->
§c_bgzf
 = 
mem
 + 
Àn
 * 1;

328 
f
->
§c_idx
 = 
mem
 + 
Àn
 * 2;

329 
f
->
tmp_bgzf
 = 
mem
 + 
Àn
 * 3;

330 
f
->
tmp_idx
 = 
mem
 + 
Àn
 * 4;

332 
ãxt
 = 
	`mÆloc
(
ãxt_sz
);

333 i‡(!
ãxt
) {

334 
	`≥º‹
(
__func__
);

335 
Áû
;

337 
i
 = 0; i < 
max
; i++Ë
	`¢¥ötf
(
ãxt
 + i*8, 
ãxt_sz
 - i*8, "%07d\n", i);

338 
f
->
ãxt
 = (*)Åext;

339 
f
->
…ext
 = 
ãxt_sz
 - 1;

341 i‡((
f
->
f_∂aö
 = 
	`åy_f›í
(f->
§c_∂aö
, "rb")Ë=
NULL
Ë
Áû
;

342 i‡((
f
->
f_bgzf
 = 
	`åy_f›í
(f->
§c_bgzf
, "rb")Ë=
NULL
Ë
Áû
;

343 i‡((
f
->
f_idx
 = 
	`åy_f›í
(f->
§c_idx
, "rb")Ë=
NULL
Ë
Áû
;

347 
Áû
:

349 
	}
}

351 
	$ã°_ªad
(
Fûes
 *
f
) {

352 
BGZF
* 
bgz
;

353 
ssize_t
 
bg_gŸ
, 
f_gŸ
;

354 
bg_buf
[
BUFSZ
], 
f_buf
[BUFSZ];

356 
bgz
 = 
	`åy_bgzf_›í
(
f
->
§c_bgzf
, "r", 
__func__
);

357 i‡(!
bgz
)  -1;

360 
bg_gŸ
 = 
	`åy_bgzf_ªad
(
bgz
, 
bg_buf
, 
BUFSZ
, 
f
->
§c_bgzf
, 
__func__
);

361 i‡(
bg_gŸ
 < 0Ë
Áû
;

363 
f_gŸ
 = 
	`åy_‰ód
(
f
->
f_∂aö
, 
f_buf
, 
BUFSZ
, 
__func__
, f->
§c_∂aö
);

364 i‡(
f_gŸ
 < 0Ë
Áû
;

366 i‡(
	`com∑ª_buf„rs
(
f_buf
, 
bg_buf
, 
f_gŸ
, 
bg_gŸ
,

367 
f
->
§c_∂aö
, f->
§c_bgzf
, 
__func__
) != 0) {

368 
Áû
;

370 } 
bg_gŸ
 > 0 && 
f_gŸ
 > 0);

372 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
§c_bgzf
, 
__func__
) != 0)  -1;

373 i‡(
	`åy_f£ek_°¨t
(
f
->
f_∂aö
, f->
§c_∂aö
, 
__func__
) != 0)  -1;

377 
Áû
:

378 i‡(
bgz
Ë
	`bgzf_˛o£
(bgz);

380 
	}
}

382 
	$ã°_wrôe_ªad
(
Fûes
 *
f
, c⁄° *
mode
, 
O≥n_mëhod
 
mëhod
,

383 
¡hªads
, 
ex≥˘ed_com¥essi⁄
) {

384 
BGZF
* 
bgz
 = 
NULL
;

385 
ssize_t
 
bg_put
, 
bg_gŸ
;

386 
size_t
 
pos
 = 0;

387 
bg_buf
[
BUFSZ
];

389 
mëhod
) {

390 
USE_BGZF_DOPEN
:

391 
bgz
 = 
	`åy_bgzf_d›í
(
f
->
tmp_bgzf
, 
mode
, 
__func__
);

393 
USE_BGZF_HOPEN
:

394 
bgz
 = 
	`åy_bgzf_h›í
(
f
->
tmp_bgzf
, 
mode
, 
__func__
);

397 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, 
mode
, 
__func__
);

400 i‡(!
bgz
Ë
Áû
;

402 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

404 
bg_put
 = 
	`åy_bgzf_wrôe
(
bgz
, 
f
->
ãxt
, f->
…ext
, f->
tmp_bgzf
, 
__func__
);

405 i‡(
bg_put
 < 0Ë
Áû
;

407 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

409 
mëhod
) {

410 
USE_BGZF_DOPEN
:

411 
bgz
 = 
	`åy_bgzf_d›í
(
f
->
tmp_bgzf
, "r", 
__func__
);

413 
USE_BGZF_HOPEN
:

414 
bgz
 = 
	`åy_bgzf_h›í
(
f
->
tmp_bgzf
, "r", 
__func__
);

417 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, "r", 
__func__
);

420 i‡(!
bgz
Ë
Áû
;

422 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

424 i‡(
	`åy_bgzf_com¥essi⁄
(
bgz
, 
ex≥˘ed_com¥essi⁄
,

425 
f
->
tmp_bgzf
, 
__func__
) != 0) {

426 
Áû
;

430 
bg_gŸ
 = 
	`åy_bgzf_ªad
(
bgz
, 
bg_buf
, 
BUFSZ
, 
f
->
tmp_bgzf
, 
__func__
);

431 i‡(
bg_gŸ
 < 0Ë
Áû
;

433 i‡(
pos
 < 
f
->
…ext
 &&

434 
	`memcmp
(
f
->
ãxt
 + 
pos
, 
bg_buf
,

435 
pos
 + 
bg_gŸ
 < 
f
->
…ext
 ? bg_got : f->ltext -Öos) != 0) {

436 
	`Ârötf
(
°dîr
, "%s : Got wrong data from %s,Öos %zu\n",

437 
__func__
, 
f
->
tmp_bgzf
, 
pos
);

438 
Áû
;

440 
pos
 +
bg_gŸ
;

441 } 
bg_gŸ
 > 0);

443 i‡(
pos
 !
bg_put
) {

444 
	`Ârötf
(
°dîr
, "%s : bgzf_read got %zd bytes;Éxpected %zd\n",

445 
__func__
, 
pos
, 
bg_put
);

446 
Áû
;

449 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

453 
Áû
:

454 i‡(
bgz
Ë
	`bgzf_˛o£
(bgz);

456 
	}
}

458 
	$ã°_embed_eof
(
Fûes
 *
f
, c⁄° *
mode
, 
¡hªads
) {

459 
BGZF
* 
bgz
 = 
NULL
;

460 
ssize_t
 
bg_put
, 
bg_gŸ
;

461 
size_t
 
pos
 = 0, 
hÆf
 = 
BUFSZ
 < 
f
->
…ext
 ? BUFSZ : f->ltext / 2;

462 
≠≥nd_mode
[16];

463 
bg_buf
[
BUFSZ
];

465 
pos
 = 0;Öo†< (
≠≥nd_mode
Ë- 1 && 
mode
[pos] != 0;Öos++) {

466 
≠≥nd_mode
[
pos
] = 
mode
[pos] == 'w' ? 'a' : mode[pos];

468 
≠≥nd_mode
[
pos
] ='\0';

471 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, 
mode
, 
__func__
);

472 i‡(!
bgz
Ë
Áû
;

474 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

476 
bg_put
 = 
	`åy_bgzf_wrôe
(
bgz
, 
f
->
ãxt
, 
hÆf
, f->
tmp_bgzf
, 
__func__
);

477 i‡(
bg_put
 < 0Ë
Áû
;

479 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

484 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, 
≠≥nd_mode
, 
__func__
);

485 i‡(!
bgz
Ë
Áû
;

487 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

489 
bg_put
 = 
	`åy_bgzf_wrôe
(
bgz
, 
f
->
ãxt
 + 
hÆf
, f->
…ext
 - hÆf, f->
tmp_bgzf
,

490 
__func__
);

491 i‡(
bg_put
 < 0Ë
Áû
;

493 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

496 
pos
 = 0;

497 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, "r", 
__func__
);

498 i‡(!
bgz
Ë
Áû
;

500 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

503 
bg_gŸ
 = 
	`åy_bgzf_ªad
(
bgz
, 
bg_buf
, 
BUFSZ
, 
f
->
tmp_bgzf
, 
__func__
);

504 i‡(
bg_gŸ
 < 0Ë
Áû
;

506 i‡(
pos
 < 
f
->
…ext
 &&

507 
	`memcmp
(
f
->
ãxt
 + 
pos
, 
bg_buf
,

508 
pos
 + 
bg_gŸ
 < 
f
->
…ext
 ? bg_got : f->ltext -Öos) != 0) {

509 
	`Ârötf
(
°dîr
, "%s : Got wrong data from %s,Öos %zu\n",

510 
__func__
, 
f
->
tmp_bgzf
, 
pos
);

511 
Áû
;

513 
pos
 +
bg_gŸ
;

514 } 
bg_gŸ
 > 0);

516 i‡(
pos
 !
f
->
…ext
) {

517 
	`Ârötf
(
°dîr
, "%s : bgzf_read got %zd bytes;Éxpected %zd\n",

518 
__func__
, 
pos
, 
f
->
…ext
);

519 
Áû
;

522 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

526 
Áû
:

527 i‡(
bgz
Ë
	`bgzf_˛o£
(bgz);

529 
	}
}

531 
	$ã°_ödex_lﬂd_dump
(
Fûes
 *
f
) {

532 
BGZF
* 
bgz
 = 
NULL
;

533 
FILE
 *
fde°
 = 
NULL
;

534 
buf_§c
[
BUFSZ
], 
buf_de°
[BUFSZ];

535 
ssize_t
 
gŸ_§c
, 
gŸ_de°
;

537 
bgz
 = 
	`åy_bgzf_›í
(
f
->
§c_bgzf
, "r", 
__func__
);

538 i‡(!
bgz
)  -1;

540 i‡(
	`åy_bgzf_ödex_lﬂd
(
bgz
, 
f
->
§c_bgzf
, 
idx_suffix
, 
__func__
) != 0) {

541 
Áû
;

544 i‡(
	`åy_bgzf_ödex_dump
(
bgz
, 
f
->
tmp_bgzf
, 
idx_suffix
, 
__func__
) != 0) {

545 
Áû
;

548 
fde°
 = 
	`åy_f›í
(
f
->
tmp_idx
, "r");

550 
gŸ_§c
 = 
	`åy_‰ód
(
f
->
f_idx
, 
buf_§c
, 
BUFSZ
, 
__func__
, f->
§c_idx
);

551 i‡(
gŸ_§c
 < 0Ë
Áû
;

552 
gŸ_de°
 = 
	`åy_‰ód
(
fde°
, 
buf_de°
, 
BUFSZ
, 
__func__
, 
f
->
tmp_idx
);

553 i‡(
gŸ_de°
 < 0Ë
Áû
;

554 i‡(
	`com∑ª_buf„rs
(
buf_§c
, 
buf_de°
, 
gŸ_§c
, 
gŸ_de°
,

555 
f
->
§c_idx
, f->
tmp_idx
, 
__func__
Ë!0Ë
Áû
;

556 } 
gŸ_§c
 > 0 && 
gŸ_de°
 > 0);

557 i‡(
	`åy_f˛o£
(&
fde°
, 
f
->
tmp_idx
, 
__func__
Ë!0Ë
Áû
;

559 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
§c_bgzf
, 
__func__
Ë!0Ë
Áû
;

563 
Áû
:

564 i‡(
fde°
Ë
	`f˛o£
(fdest);

565 i‡(
bgz
Ë
	`bgzf_˛o£
(bgz);

567 
	}
}

569 
	$ã°_check_EOF
(*
«me
, 
ex≥˘ed
) {

570 
BGZF
 *
bgz
 = 
	`åy_bgzf_›í
(
«me
, "r", 
__func__
);

571 
eof
;

572 i‡(!
bgz
)  -1;

573 
eof
 = 
	`bgzf_check_EOF
(
bgz
);

574 i‡(
eof
 !
ex≥˘ed
) {

575 
	`Ârötf
(
°dîr
, "%s : UnexpectedÑesult %d from bgzf_check_EOF on %s; "

577 
__func__
, 
eof
, 
«me
, 
ex≥˘ed
);

578 
	`bgzf_˛o£
(
bgz
);

582  
	`åy_bgzf_˛o£
(&
bgz
, 
«me
, 
__func__
);

583 
	}
}

585 
	$ã°_ödex_£ek_gëc
(
Fûes
 *
f
, c⁄° *
mode
,

586 
ˇche_size
, 
¡hªads
) {

587 
BGZF
* 
bgz
 = 
NULL
;

588 
ssize_t
 
bg_put
;

589 
size_t
 
i
, 
j
, 
iskù
 = 
f
->
…ext
 / 10;

590 
is_uncom¥es£d
 = 
	`°rchr
(
mode
, 'u'Ë!
NULL
;

592 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, 
mode
, 
__func__
);

593 i‡(!
bgz
Ë
Áû
;

595 i‡(
	`åy_bgzf_ödex_buûd_öô
(
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

597 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

599 
bg_put
 = 
	`åy_bgzf_wrôe
(
bgz
, 
f
->
ãxt
, f->
…ext
, f->
tmp_bgzf
, 
__func__
);

600 i‡(
bg_put
 < 0Ë
Áû
;

602 i‡(!
is_uncom¥es£d
) {

603 i‡(
	`åy_bgzf_ödex_dump
(
bgz
, 
f
->
tmp_idx
, 
NULL
, 
__func__
) != 0) {

604 
Áû
;

608 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

610 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, "r", 
__func__
);

611 i‡(!
bgz
Ë
Áû
;

613 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

615 i‡(!
is_uncom¥es£d
) {

616 i‡(
	`åy_bgzf_ödex_lﬂd
(
bgz
, 
f
->
tmp_bgzf
, 
idx_suffix
, 
__func__
) != 0) {

617 
Áû
;

621 
i
 = 0; i < 
f
->
…ext
; i +
iskù
) {

622 i‡(
	`åy_bgzf_u£ek
(
bgz
, 
i
, 
SEEK_SET
, 
f
->
tmp_bgzf
, 
__func__
) != 0) {

623 
Áû
;

626 
j
 = 0; j < 16 && 
i
 + j < 
f
->
…ext
; j++) {

627 i‡(
	`åy_bgzf_gëc
(
bgz
, 
i
 + 
j
, 
f
->
ãxt
[i + j],

628 
f
->
tmp_bgzf
, 
__func__
Ë< 0Ë
Áû
;

632 i‡(
	`åy_bgzf_u£ek
(
bgz
, 0, 
SEEK_SET
, 
f
->
tmp_bgzf
, 
__func__
) != 0) {

633 
Áû
;

635 
j
 = 0; j < 70000 && j < 
f
->
…ext
; j++) {

636 i‡(
	`åy_bgzf_gëc
(
bgz
, 
j
, 
f
->
ãxt
[j],

637 
f
->
tmp_bgzf
, 
__func__
Ë< 0Ë
Áû
;

640 i‡(
ˇche_size
 > 0) {

641 
size_t
 
mid
 = 
f
->
…ext
 / 2;

642 
	`bgzf_£t_ˇche_size
(
bgz
, 
ˇche_size
);

644 
i
 = 0; i < 10; i++) {

645 i‡(
	`åy_bgzf_u£ek
(
bgz
, 0, 
SEEK_SET
, 
f
->
tmp_bgzf
, 
__func__
) != 0) {

646 
Áû
;

648 
j
 = 0; j < 64 && j < 
f
->
…ext
; j++) {

649 i‡(
	`åy_bgzf_gëc
(
bgz
, 
j
, 
f
->
ãxt
[j],

650 
f
->
tmp_bgzf
, 
__func__
Ë< 0Ë
Áû
;

653 i‡(
	`åy_bgzf_u£ek
(
bgz
, 
mid
, 
SEEK_SET
,

654 
f
->
tmp_bgzf
, 
__func__
) != 0) {

655 
Áû
;

657 
j
 = 0; j < 64 && j + 
mid
 < 
f
->
…ext
; j++) {

658 i‡(
	`åy_bgzf_gëc
(
bgz
, 
j
 + 
mid
, 
f
->
ãxt
[j + mid],

659 
f
->
tmp_bgzf
, 
__func__
Ë< 0Ë
Áû
;

664 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

668 
Áû
:

669 i‡(
bgz
Ë
	`bgzf_˛o£
(bgz);

671 
	}
}

673 
	$ã°_bgzf_gëlöe
(
Fûes
 *
f
, c⁄° *
mode
, 
¡hªads
) {

674 
BGZF
* 
bgz
 = 
NULL
;

675 
ssize_t
 
bg_put
;

676 
size_t
 
pos
;

677 
k°rög_t
 
°r
 = { 0, 0, 
NULL
 };

678 c⁄° *
ãxt
 = (c⁄° *Ë
f
->text;

680 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, 
mode
, 
__func__
);

681 i‡(!
bgz
Ë
Áû
;

683 i‡(
¡hªads
 > 0 && 
	`åy_bgzf_mt
(
bgz
,Çthªads, 
__func__
Ë!0Ë
Áû
;

685 
bg_put
 = 
	`åy_bgzf_wrôe
(
bgz
, 
f
->
ãxt
, f->
…ext
, f->
tmp_bgzf
, 
__func__
);

686 i‡(
bg_put
 < 0Ë
Áû
;

688 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

690 
bgz
 = 
	`åy_bgzf_›í
(
f
->
tmp_bgzf
, "r", 
__func__
);

691 i‡(!
bgz
Ë
Áû
;

693 
pos
 = 0;Öo†< 
f
->
…ext
; ) {

694 c⁄° *
íd
 = 
	`°rchr
(
ãxt
 + 
pos
, '\n');

695 
size_t
 
l
 = 
íd
 ?Énd - (
ãxt
 + 
pos
Ë: 
f
->
…ext
 -Öos;

696 
ªs
;

698 i‡((
ªs
 = 
	`bgzf_gëlöe
(
bgz
, '\n', &
°r
)) < 0) {

699 
	`Ârötf
(
°dîr
, "%s : %s from bgzf_getline on %s : %s\n",

700 
__func__
, 
ªs
 < -1 ? "Error" : "Unexpected EOF",

701 
f
->
tmp_bgzf
, 
ªs
 < -1 ? 
	`°ªº‹
(
î∫o
) : "EOF");

702 
Áû
;

705 i‡(
°r
.
l
 !»|| 
	`memcmp
(
ãxt
 + 
pos
, så.
s
,Ü) != 0) {

706 
	`Ârötf
(
°dîr
,

710 
__func__
, 
f
->
tmp_bgzf
, (Ë
l
, (*Ëf->
ãxt
 + 
pos
,

711 (Ë
°r
.
l
, så.
s
);

714 
pos
 +
l
 + 1;

717 i‡(
	`åy_bgzf_˛o£
(&
bgz
, 
f
->
tmp_bgzf
, 
__func__
Ë!0Ë
Áû
;

720 
Áû
:

721 i‡(
bgz
Ë
	`bgzf_˛o£
(bgz);

723 
	}
}

725 
	$maö
(
¨gc
, **
¨gv
) {

726 
Fûes
 
f
 = { 
NULL
, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, 0 };

727 
ªtvÆ
 = 
EXIT_FAILURE
;

729 i‡(
¨gc
 != 2) {

730 
	`Ârötf
(
°dîr
, "Ußge: %†<sour˚ fûe>\n", 
¨gv
[0]);

731  
EXIT_FAILURE
;

734 i‡(
	`£tup
(
¨gv
[1], &
f
Ë!0Ë
out
;

737 i‡(
	`ã°_check_EOF
(
f
.
§c_bgzf
, 1Ë!0Ë
out
;

738 i‡(
	`ã°_ªad
(&
f
Ë!0Ë
out
;

741 i‡(
	`ã°_wrôe_ªad
(&
f
, "wu", 
USE_BGZF_OPEN
, 0, 0Ë!0Ë
out
;

742 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 0Ë!0Ë
out
;

743 i‡(
	`ã°_wrôe_ªad
(&
f
, "w", 
USE_BGZF_OPEN
, 0, 2Ë!0Ë
out
;

744 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 1Ë!0Ë
out
;

745 i‡(
	`ã°_wrôe_ªad
(&
f
, "w0", 
USE_BGZF_OPEN
, 0, 2Ë!0Ë
out
;

746 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 1Ë!0Ë
out
;

747 i‡(
	`ã°_wrôe_ªad
(&
f
, "w1", 
USE_BGZF_DOPEN
, 0, 2Ë!0Ë
out
;

748 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 1Ë!0Ë
out
;

749 i‡(
	`ã°_wrôe_ªad
(&
f
, "w9", 
USE_BGZF_HOPEN
, 0, 2Ë!0Ë
out
;

750 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 1Ë!0Ë
out
;

751 i‡(
	`ã°_wrôe_ªad
(&
f
, "wg", 
USE_BGZF_OPEN
, 0, 1Ë!0Ë
out
;

752 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 0Ë!0Ë
out
;

755 i‡(
	`ã°_wrôe_ªad
(&
f
, "w", 
USE_BGZF_OPEN
, 1, 2Ë!0Ë
out
;

756 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 1Ë!0Ë
out
;

757 i‡(
	`ã°_wrôe_ªad
(&
f
, "w", 
USE_BGZF_OPEN
, 2, 2Ë!0Ë
out
;

758 i‡(
	`ã°_check_EOF
(
f
.
tmp_bgzf
, 1Ë!0Ë
out
;

761 i‡(
	`ã°_embed_eof
(&
f
, "w", 0Ë!0Ë
out
;

762 i‡(
	`ã°_embed_eof
(&
f
, "w", 1Ë!0Ë
out
;

763 i‡(
	`ã°_embed_eof
(&
f
, "w", 2Ë!0Ë
out
;

766 i‡(
	`ã°_ödex_lﬂd_dump
(&
f
Ë!0Ë
out
;

769 i‡(
	`ã°_ödex_£ek_gëc
(&
f
, "w", 1000000, 0Ë!0Ë
out
;

777 i‡(
	`ã°_ödex_£ek_gëc
(&
f
, "wu", 0, 0Ë!0Ë
out
;

780 i‡(
	`ã°_bgzf_gëlöe
(&
f
, "w", 0Ë!0Ë
out
;

781 i‡(
	`ã°_bgzf_gëlöe
(&
f
, "w", 1Ë!0Ë
out
;

782 i‡(
	`ã°_bgzf_gëlöe
(&
f
, "w", 2Ë!0Ë
out
;

784 
ªtvÆ
 = 
EXIT_SUCCESS
;

786 
out
:

787 
	`˛ónup
(&
f
, 
ªtvÆ
);

788  
ªtvÆ
;

789 
	}
}

	@htslib/test/test_view.c

26 
	~<c⁄fig.h
>

28 
	~<°dio.h
>

29 
	~<uni°d.h
>

30 
	~<°dlib.h
>

31 
	~<°rög.h
>

32 
	~<gë›t.h
>

34 
	~"¸am/¸am.h
"

36 
	~"ht¶ib/ßm.h
"

38 
	$maö
(
¨gc
, *
¨gv
[])

40 
ßmFûe
 *
ö
;

41 *
‚_ªf
 = 0;

42 
Êag
 = 0, 
c
, 
˛evñ
 = -1, 
ign‹e_ßm_îr
 = 0;

43 
modî
[8];

44 
bam_hdr_t
 *
h
;

45 
bam1_t
 *
b
;

46 
htsFûe
 *
out
;

47 
modew
[800];

48 
r
 = 0, 
exô_code
 = 0;

49 
hts_›t
 *
ö_›ts
 = 
NULL
, *
out_›ts
 = NULL;

50 
ƒóds
 = 0;

51 
exåa_hdr_nuls
 = 0;

52 
bíchm¨k
 = 0;

53 
¡hªads
 = 0;

55 (
c
 = 
	`gë›t
(
¨gc
, 
¨gv
, "IbDCSl:t:i:o:N:BZ:@:")) >= 0) {

56 
c
) {

57 'S': 
Êag
 |= 1; ;

58 'b': 
Êag
 |= 2; ;

59 'D': 
Êag
 |= 4; ;

60 'C': 
Êag
 |= 8; ;

61 'B': 
bíchm¨k
 = 1; ;

62 'l': 
˛evñ
 = 
	`©oi
(
›èrg
); 
Êag
 |= 2; ;

63 't': 
‚_ªf
 = 
›èrg
; ;

64 'I': 
ign‹e_ßm_îr
 = 1; ;

65 'i': i‡(
	`hts_›t_add
(&
ö_›ts
, 
›èrg
))  1; ;

66 'o': i‡(
	`hts_›t_add
(&
out_›ts
, 
›èrg
))  1; ;

67 'N': 
ƒóds
 = 
	`©oi
(
›èrg
); ;

68 'Z': 
exåa_hdr_nuls
 = 
	`©oi
(
›èrg
); ;

69 '@': 
¡hªads
 = 
	`©oi
(
›èrg
); ;

72 i‡(
¨gc
 =
›töd
) {

73 
	`Ârötf
(
°dîr
, "Usage: samview [-bSCSIB] [-NÇum_reads] [-lÜevel] [-o option=value] [-Z hdr_nuls] <in.bam>|<in.sam>|<in.cram> [region]\n");

76 
	`°r˝y
(
modî
, "r");

77 i‡(
Êag
&4Ë
	`°rˇt
(
modî
, "c");

78 i‡((
Êag
&1Ë=0Ë
	`°rˇt
(
modî
, "b");

80 
ö
 = 
	`ßm_›í
(
¨gv
[
›töd
], 
modî
);

81 i‡(
ö
 =
NULL
) {

82 
	`Ârötf
(
°dîr
, "Eº‹ o≥nög \"%s\"\n", 
¨gv
[
›töd
]);

83  
EXIT_FAILURE
;

85 
h
 = 
	`ßm_hdr_ªad
(
ö
);

86 i‡(
h
 =
NULL
) {

87 
	`Ârötf
(
°dîr
, "Couldn'àªad hódî f‹ \"%s\"\n", 
¨gv
[
›töd
]);

88  
EXIT_FAILURE
;

90 
h
->
ign‹e_ßm_îr
 = ignore_sam_err;

91 i‡(
exåa_hdr_nuls
) {

92 *
√w_ãxt
 = 
	`ªÆloc
(
h
->
ãxt
, h->
l_ãxt
 + 
exåa_hdr_nuls
);

93 i‡(
√w_ãxt
 =
NULL
) {

94 
	`Ârötf
(
°dîr
, "ErrorÑeallocing headerÅext\n");

95  
EXIT_FAILURE
;

97 
h
->
ãxt
 = 
√w_ãxt
;

98 
	`mem£t
(&
h
->
ãxt
[h->
l_ãxt
], 0, 
exåa_hdr_nuls
);

99 
h
->
l_ãxt
 +
exåa_hdr_nuls
;

102 
b
 = 
	`bam_öô1
();

104 
	`°r˝y
(
modew
, "w");

105 i‡(
˛evñ
 >0 && cÀvñ <9Ë
	`•rötf
(
modew
 + 1, "%d", clevel);

106 i‡(
Êag
&8Ë
	`°rˇt
(
modew
, "c");

107 i‡(
Êag
&2Ë
	`°rˇt
(
modew
, "b");

108 
out
 = 
	`hts_›í
("-", 
modew
);

109 i‡(
out
 =
NULL
) {

110 
	`Ârötf
(
°dîr
, "Error opening standard output\n");

111  
EXIT_FAILURE
;

115 i‡(
Êag
 & 8) {

116 
ªt
;

119 
out
->
Â
.
¸am
->
hódî
 = 
	`ßm_hdr_∑r£_
(
h
->
ãxt
, h->
l_ãxt
);

122 i‡(
‚_ªf
)

123 
ªt
 = 
	`¸am_£t_›ti⁄
(
out
->
Â
.
¸am
, 
CRAM_OPT_REFERENCE
, 
‚_ªf
);

126 
ªt
 = 
	`¸am_£t_›ti⁄
(
out
->
Â
.
¸am
, 
CRAM_OPT_REFERENCE
, 
NULL
);

128 i‡(
ªt
 != 0)

129  
EXIT_FAILURE
;

133 i‡(
	`hts_›t_≠∂y
(
ö
, 
ö_›ts
))

134  
EXIT_FAILURE
;

135 
	`hts_›t_‰ì
(
ö_›ts
);

137 i‡(
	`hts_›t_≠∂y
(
out
, 
out_›ts
))

138  
EXIT_FAILURE
;

139 
	`hts_›t_‰ì
(
out_›ts
);

142 
htsThªadPoﬁ
 
p
 = {
NULL
, 0};

143 i‡(
¡hªads
 > 0) {

144 
p
.
poﬁ
 = 
	`hts_çoﬁ_öô
(
¡hªads
);

145 i‡(!
p
.
poﬁ
) {

146 
	`Ârötf
(
°dîr
, "Error creatingÅhreadÖool\n");

147 
exô_code
 = 1;

149 
	`hts_£t_›t
(
ö
, 
HTS_OPT_THREAD_POOL
, &
p
);

150 
	`hts_£t_›t
(
out
, 
HTS_OPT_THREAD_POOL
, &
p
);

154 i‡(!
bíchm¨k
 && 
	`ßm_hdr_wrôe
(
out
, 
h
) < 0) {

155 
	`Ârötf
(
°dîr
, "Error writing output header.\n");

156 
exô_code
 = 1;

158 i‡(
›töd
 + 1 < 
¨gc
 && !(
Êag
&1)) {

159 
i
;

160 
hts_idx_t
 *
idx
;

161 i‡((
idx
 = 
	`ßm_ödex_lﬂd
(
ö
, 
¨gv
[
›töd
])) == 0) {

162 
	`Ârötf
(
°dîr
, "[E::%s] faûÅÿlﬂdÅhêBAM index\n", 
__func__
);

165 
i
 = 
›töd
 + 1; i < 
¨gc
; ++i) {

166 
hts_ôr_t
 *
ôî
;

167 i‡((
ôî
 = 
	`ßm_ôr_quîys
(
idx
, 
h
, 
¨gv
[
i
])) == 0) {

168 
	`Ârötf
(
°dîr
, "[E::%s] faûÅÿ∑r£Ñegi⁄ '%s'\n", 
__func__
, 
¨gv
[
i
]);

171 (
r
 = 
	`ßm_ôr_√xt
(
ö
, 
ôî
, 
b
)) >= 0) {

172 i‡(!
bíchm¨k
 && 
	`ßm_wrôe1
(
out
, 
h
, 
b
) < 0) {

173 
	`Ârötf
(
°dîr
, "Error writing output.\n");

174 
exô_code
 = 1;

177 i‡(
ƒóds
 && --nreads == 0)

180 
	`hts_ôr_de°roy
(
ôî
);

182 
	`hts_idx_de°roy
(
idx
);

183 } (
r
 = 
	`ßm_ªad1
(
ö
, 
h
, 
b
)) >= 0) {

184 i‡(!
bíchm¨k
 && 
	`ßm_wrôe1
(
out
, 
h
, 
b
) < 0) {

185 
	`Ârötf
(
°dîr
, "Error writing output.\n");

186 
exô_code
 = 1;

189 i‡(
ƒóds
 && --nreads == 0)

193 i‡(
r
 < -1) {

194 
	`Ârötf
(
°dîr
, "ErrorÖarsing input.\n");

195 
exô_code
 = 1;

198 
r
 = 
	`ßm_˛o£
(
out
);

199 i‡(
r
 < 0) {

200 
	`Ârötf
(
°dîr
, "Error closing output.\n");

201 
exô_code
 = 1;

204 
	`bam_de°roy1
(
b
);

205 
	`bam_hdr_de°roy
(
h
);

207 
r
 = 
	`ßm_˛o£
(
ö
);

208 i‡(
r
 < 0) {

209 
	`Ârötf
(
°dîr
, "Error closing input.\n");

210 
exô_code
 = 1;

213 i‡(
p
.
poﬁ
)

214 
	`hts_çoﬁ_de°roy
(
p
.
poﬁ
);

216  
exô_code
;

217 
	}
}

	@htslib/test/thrash_threads1.c

26 
	~<c⁄fig.h
>

28 
	~<°dio.h
>

29 
	~<uni°d.h
>

30 
	~<°dlib.h
>

31 
	~"ht¶ib/bgzf.h
"

33 
	$maö
(
¨gc
, *
¨gv
[]) {

34 i‡(
¨gc
 <= 1) {

35 
	`Ârötf
(
°dîr
, "Usage:Åhrash_threads1 input.bam\n");

36 
	`exô
(1);

39 
i
;

40 
i
 = 0; i < 10000; i++) {

41 
	`¥ötf
("i=%d\n", 
i
);

42 
BGZF
 *
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

43 
	`bgzf_mt
(
Âö
, 2, 256);

44 i‡(
	`bgzf_˛o£
(
Âö
Ë< 0Ë
	`ab‹t
();

47 
	}
}

	@htslib/test/thrash_threads2.c

26 
	~<c⁄fig.h
>

28 
	~<°dio.h
>

29 
	~<uni°d.h
>

30 
	~<°dlib.h
>

31 
	~"ht¶ib/bgzf.h
"

32 
	~"ht¶ib/thªad_poﬁ.h
"

34 
	$maö
(
¨gc
, *
¨gv
[]) {

35 
i
;

36 
i
 = 0; i < 1000; i++) {

37 
	`¥ötf
("i=%d\n", 
i
);

38 
BGZF
 *
Â
 = 
	`bgzf_›í
("/dev/null", "w");

39 
	`bgzf_mt
(
Â
, 8, 256);

40 i‡(
	`bgzf_˛o£
(
Â
))

41 
	`ab‹t
();

45 
	}
}

	@htslib/test/thrash_threads3.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~<°dlib.h
>

30 
	~"ht¶ib/bgzf.h
"

32 
	$maö
(
¨gc
, *
¨gv
[]) {

33 
buf
[1000000];

34 
i
;

36 i‡(
¨gc
 <= 1) {

37 
	`Ârötf
(
°dîr
, "Usage:Åhrash_threads3 input.bam\n");

38 
	`exô
(1);

41 
i
 = 0; i < 10000; i++) {

42 
	`¥ötf
("i=%d\n", 
i
);

43 
BGZF
 *
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

44 i‡(
	`bgzf_ªad
(
Âö
, 
buf
, 
i
*10Ë< 0Ë
	`ab‹t
();

45 
	`bgzf_mt
(
Âö
, 8, 256);

46 i‡(
	`bgzf_ªad
(
Âö
, 
buf
, 
i
*10Ë< 0Ë
	`ab‹t
();

47 i‡(
	`bgzf_˛o£
(
Âö
Ë< 0Ë
	`ab‹t
();

50 
	}
}

	@htslib/test/thrash_threads4.c

24 
	~<c⁄fig.h
>

26 
	~<°dlib.h
>

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~"ht¶ib/bgzf.h
"

30 
	~"ht¶ib/thªad_poﬁ.h
"

32 
	$maö
(
¨gc
, *
¨gv
[]) {

33 i‡(
¨gc
 <= 1) {

34 
	`Ârötf
(
°dîr
, "Usage:Åhrash_threads4 input.bam\n");

35 
	`exô
(1);

39 
i
;

40 
BGZF
 *
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

41 
buf
[65536];

42 
i
 = 0; i < 1000; i++)

43 i‡(
	`bgzf_ªad
(
Âö
, 
buf
, 65536) < 0)

44 
	`ab‹t
();

45 
öt64_t
 
pos
 = 
	`bgzf_ãŒ
(
Âö
);

46 
	`bgzf_˛o£
(
Âö
);

48 
	#N
 1000

	)

51 
i
 = 0; i < 1000; i++) {

52 
	`¥ötf
("i=%d\n", 
i
);

53 
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

54 
	`bgzf_mt
(
Âö
, 8, 256);

55 i‡(
	`bgzf_£ek
(
Âö
, 
pos
, 
SEEK_SET
Ë< 0Ë
	`puts
("!");

56 
	`u¶ìp
(
N
);

59 i‡(
	`bgzf_£ek
(
Âö
, 0LL, 
SEEK_SET
Ë< 0Ë
	`puts
("!");

60 
	`u¶ìp
(
N
);

63 i‡(
	`bgzf_˛o£
(
Âö
))

64 
	`ab‹t
();

68 
	}
}

	@htslib/test/thrash_threads5.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<°dlib.h
>

29 
	~<uni°d.h
>

30 
	~"ht¶ib/bgzf.h
"

31 
	~"ht¶ib/thªad_poﬁ.h
"

33 
	#N
 1000

	)

34 
	$maö
(
¨gc
, *
¨gv
[]) {

35 
buf
[
N
];

36 
ssize_t
 
l
, 
t
 = 0;

38 i‡(
¨gc
 < 2 || 
	`ißây
(
STDOUT_FILENO
)) {

39 
	`Ârötf
(
°dîr
,

41 
	`exô
(1);

44 
BGZF
 *
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

45 
hts_çoﬁ
 *
p
 = 
NULL
;

46 i‡(
¨gc
 > 2) {

47 
p
 = 
	`hts_çoﬁ_öô
(
	`©oi
(
¨gv
[2]));

48 
	`bgzf_thªad_poﬁ
(
Âö
, 
p
, 0);

50 
n
 = 
	`ønd
()%(
N
-1)+1;

51 (
l
 = 
	`bgzf_ªad
(
Âö
, 
buf
, 
n
)) > 0) {

52 i‡(
l
 !
	`wrôe
(
STDOUT_FILENO
, 
buf
,Ü)Ë
	`ab‹t
();

53 
t
 +
l
;

54 i‡(
l
 !
n
) {

55 
	`Ârötf
(
°dîr
, "ex≥˘ed %d byãs, gŸ %d\n", 
n
, ()
l
);

58 
n
 = 
	`ønd
()%(
N
-1)+1;

60 
	`Ârötf
(
°dîr
, "˛o£=%d\n", ()
	`bgzf_˛o£
(
Âö
));

61 i‡(
p
Ë
	`hts_çoﬁ_de°roy
(p);

63 
	`Ârötf
(
°dîr
, "wrŸê%d byãs\n", ()
t
);

66 
	}
}

	@htslib/test/thrash_threads6.c

24 
	~<c⁄fig.h
>

26 
	~<°dlib.h
>

27 
	~<°dio.h
>

28 
	~<uni°d.h
>

29 
	~"ht¶ib/bgzf.h
"

30 
	~"ht¶ib/thªad_poﬁ.h
"

32 
	$maö
(
¨gc
, *
¨gv
[]) {

33 i‡(
¨gc
 <= 1) {

34 
	`Ârötf
(
°dîr
, "Usage:Åhrash_threads4 input.bam\n");

35 
	`exô
(1);

39 
i
;

40 
ssize_t
 
gŸ
;

41 
BGZF
 *
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

42 
uöt64_t
 
upos
 = 0, 
uíd
 = 0;

43 
buf
[100000];

44 
i
 = 0; i < 100; i++) {

45 i‡((
gŸ
 = 
	`bgzf_ªad
(
Âö
, 
buf
, 65536)) < 0)

46 
	`ab‹t
();

47 
upos
 +
gŸ
;

49 
öt64_t
 
pos
 = 
	`bgzf_ãŒ
(
Âö
);

50 (
gŸ
 = 
	`bgzf_ªad
(
Âö
, 
buf
, 65536)) > 0) {

51 
uíd
 +
gŸ
;

53 i‡(
gŸ
 < 0Ë
	`ab‹t
();

54 
öt64_t
 
íd
 = 
	`bgzf_ãŒ
(
Âö
);

55 
	`bgzf_˛o£
(
Âö
);

59 i‡(
uíd
 < 
upos
 + 10000000) {

60 
	`Ârötf
(
°dîr
, "Please supplyá bigger input file\n");

61 
	`exô
(1);

64 
	#N
 1000

	)

67 
i
 = 0; i < 1000; i++) {

68 
	`¥ötf
("i=%d\t", 
i
);

69 
Âö
 = 
	`bgzf_›í
(
¨gv
[1], "r");

70 
j
, 
eof
 = 0, 
mt
 = 0;

71 
j
 = 0; j < 80; j++) {

72 
n
 = 
	`ønd
() % 7;

73 
	`putch¨
('0'+
n
); 
	`fÊush
(
°dout
);

74 
n
) {

76 i‡(
	`bgzf_£ek
(
Âö
, 0LL, 
SEEK_SET
Ë< 0Ë
	`puts
("!");

77 
eof
 = 0;

80 i‡(
	`bgzf_£ek
(
Âö
, 
pos
, 
SEEK_SET
Ë< 0Ë
	`puts
("!");

81 
eof
 = 0;

84 i‡(
	`bgzf_£ek
(
Âö
, 
íd
, 
SEEK_SET
Ë< 0Ë
	`puts
("!");

85 
eof
 = 1;

88 
l
 = 
	`ønd
()%(
n
==3?100000:100);

89 i‡(
	`bgzf_ªad
(
Âö
, 
buf
, 
l
Ë!l*(1-
eof
)Ë
	`ab‹t
();

93 
	`u¶ìp
(
N
);

96 i‡(!
mt
)

97 
	`bgzf_mt
(
Âö
, 8, 256);

98 
mt
 = 1;

102 
	`¥ötf
("\n");

103 i‡(
	`bgzf_˛o£
(
Âö
))

104 
	`ab‹t
();

108 
	}
}

	@htslib/textutils.c

25 
	~<c⁄fig.h
>

27 
	~<°dio.h
>

28 
	~<°rög.h
>

30 
	~"ht¶ib/hfûe.h
"

31 
	~"ht¶ib/k°rög.h
"

33 
	~"hts_öã∫Æ.h
"

35 
	$dehex
(
c
)

37 i‡(
c
 >= 'a' && c <= 'f')  c - 'a' + 10;

38 i‡(
c
 >= 'A' && c <= 'F')  c - 'A' + 10;

39 i‡(
c
 >= '0' && c <= '9')  c - '0';

41 
	}
}

43 
	$hts_decode_≥r˚¡
(*
de°
, 
size_t
 *
de°Àn
, c⁄° *
s
)

45 *
d
 = 
de°
;

46 
hi
, 
lo
;

48 *
s
) {

49 i‡(*
s
 ='%' && (
hi
 = 
	`dehex
(s[1])Ë>0 && (
lo
 = dehex(s[2])) >= 0) {

50 *
d
++ = (
hi
 << 4Ë| 
lo
;

51 
s
 += 3;

53 *
d
++ = *
s
++;

56 *
d
 = '\0';

57 *
de°Àn
 = 
d
 - 
de°
;

59 
	}
}

61 
	$deba£64
(
c
)

63 i‡(
c
 >= 'a' && c <= 'z')  c - 'a' + 26;

64 i‡(
c
 >= 'A' && c <= 'Z')  c - 'A';

65 i‡(
c
 >= '0' && c <= '9')  c - '0' + 52;

66 i‡(
c
 == '/')  63;

67 i‡(
c
 == '+')  62;

69 
	}
}

71 
size_t
 
	$hts_ba£64_decoded_Àngth
(
size_t
 
Àn
)

73 
size_t
 
nqu¨ãts
 = (
Àn
 + 2) / 4;

74  3 * 
nqu¨ãts
;

75 
	}
}

77 
	$hts_decode_ba£64
(*
de°
, 
size_t
 *
de°Àn
, c⁄° *
s
)

79 *
d
 = 
de°
;

80 
x0
, 
x1
, 
x2
, 
x3
;

83 
x0
 = 
	`deba£64
(*
s
++);

84 
x1
 = (
x0
 >0)? 
	`deba£64
(*
s
++) : -1;

85 
x2
 = (
x1
 >0)? 
	`deba£64
(*
s
++) : -1;

86 
x3
 = (
x2
 >0)? 
	`deba£64
(*
s
++) : -1;

87 i‡(
x3
 < 0) ;

89 *
d
++ = (
x0
 << 2Ë| (
x1
 >> 4);

90 *
d
++ = (
x1
 << 4Ë| (
x2
 >> 2);

91 *
d
++ = (
x2
 << 6Ë| 
x3
;

94 i‡(
x1
 >0Ë*
d
++ = (
x0
 << 2) | (x1 >> 4);

95 i‡(
x2
 >0Ë*
d
++ = (
x1
 << 4) | (x2 >> 2);

97 *
de°Àn
 = 
d
 - 
de°
;

99 
	}
}

101 *
	$ícode_utf8
(*
s
, 
x
)

103 i‡(
x
 >= 0x10000) {

104 *
s
++ = 0xF0 | (
x
 >> 18);

105 *
s
++ = 0x80 | ((
x
 >> 12) & 0x3F);

106 *
s
++ = 0x80 | ((
x
 >> 6) & 0x3F);

107 *
s
++ = 0x80 | (
x
 & 0x3F);

109 i‡(
x
 >= 0x800) {

110 *
s
++ = 0xE0 | (
x
 >> 12);

111 *
s
++ = 0x80 | ((
x
 >> 6) & 0x3F);

112 *
s
++ = 0x80 | (
x
 & 0x3F);

114 i‡(
x
 >= 0x80) {

115 *
s
++ = 0xC0 | (
x
 >> 6);

116 *
s
++ = 0x80 | (
x
 & 0x3F);

118 *
s
++ = 
x
;

120  
s
;

121 
	}
}

123 *
	$ssˇn_°rög
(*
s
)

125 *
d
 = 
s
;

126 
d1
, 
d2
, 
d3
, 
d4
;

128 ;;Ë*
s
) {

130 
s
[1]) {

131 '\0': *
d
 = '\0';  
s
+1;

132 'b': *
d
++ = '\b'; 
s
 += 2; ;

133 'f': *
d
++ = '\f'; 
s
 += 2; ;

134 'n': *
d
++ = '\n'; 
s
 += 2; ;

135 'r': *
d
++ = '\r'; 
s
 += 2; ;

136 't': *
d
++ = '\t'; 
s
 += 2; ;

137 : *
d
++ = 
s
[1]; s += 2; ;

139 i‡((
d1
 = 
	`dehex
(
s
[2])Ë>0 && (
d2
 = dehex(s[3])) >= 0 &&

140 (
d3
 = 
	`dehex
(
s
[4])Ë>0 && (
d4
 = dehex(s[5])) >= 0) {

141 
d
 = 
	`ícode_utf8
(d, 
d1
 << 12 | 
d2
 << 8 | 
d3
 << 4 | 
d4
);

142 
s
 += 6;

149 *
d
 = '\0';

150  
s
+1;

153 *
d
 = '\0';

154  
s
;

157 *
d
++ = *
s
++;

160 
	}
}

162 
	$fsˇn_°rög
(
hFILE
 *
Â
, 
k°rög_t
 *
d
)

164 
c
, 
d1
, 
d2
, 
d3
, 
d4
;

166 (
c
 = 
	`hgëc
(
Â
)Ë!
EOF
) c) {

168 i‡((
c
 = 
	`hgëc
(
Â
)Ë=
EOF
) ;

169 
c
) {

170 'b': 
	`kputc
('\b', 
d
); ;

171 'f': 
	`kputc
('\f', 
d
); ;

172 'n': 
	`kputc
('\n', 
d
); ;

173 'r': 
	`kputc
('\r', 
d
); ;

174 't': 
	`kputc
('\t', 
d
); ;

175 : 
	`kputc
(
c
, 
d
); ;

177 i‡((
c
 = 
	`hgëc
(
Â
)Ë!
EOF
 && (
d1
 = 
	`dehex
(c)) >= 0 &&

178 (
c
 = 
	`hgëc
(
Â
)Ë!
EOF
 && (
d2
 = 
	`dehex
(c)) >= 0 &&

179 (
c
 = 
	`hgëc
(
Â
)Ë!
EOF
 && (
d3
 = 
	`dehex
(c)) >= 0 &&

180 (
c
 = 
	`hgëc
(
Â
)Ë!
EOF
 && (
d4
 = 
	`dehex
(c)) >= 0) {

181 
buf
[8];

182 *
lim
 = 
	`ícode_utf8
(
buf
, 
d1
 << 12 | 
d2
 << 8 | 
d3
 << 4 | 
d4
);

183 
	`kput¢
(
buf
, 
lim
 - buf, 
d
);

193 
	`kputc
(
c
, 
d
);

196 
	}
}

198 
	$tokí_ty≥
(
hts_js⁄_tokí
 *
tokí
)

200 c⁄° *
s
 = 
tokí
->
°r
;

202 *
s
) {

204  (
	`°rcmp
(
s
, "false") == 0)? 'b' : '?';

206  (
	`°rcmp
(
s
, "null") == 0)? '.' : '?';

208  (
	`°rcmp
(
s
, "true") == 0)? 'b' : '?';

216 
	}
}

218 
	$hts_js⁄_¢ext
(*
°r
, 
size_t
 *
°©e
, 
hts_js⁄_tokí
 *
tokí
)

220 *
s
 = &
°r
[*
°©e
 >> 2];

221 
hiddí
 = *
°©e
 & 3;

223 i‡(
hiddí
) {

224 *
°©e
 &= ~3;

225  
tokí
->
ty≥
 = "?}]?"[
hiddí
];

228 
	#STATE
(
s
,
h
Ë(((sË- 
°r
Ë<< 2 | (h))

	)

230 ;;Ë*
s
) {

237 
s
++;

241  
tokí
->
ty≥
 = '\0';

247 *
°©e
 = 
	`STATE
(
s
+1, 0);

248  
tokí
->
ty≥
 = *
s
;

251 
tokí
->
°r
 = 
s
+1;

252 *
°©e
 = 
	`STATE
(
	`ssˇn_°rög
(
s
+1), 0);

253  
tokí
->
ty≥
 = 's';

256 
tokí
->
°r
 = 
s
;

257 
s
 +
	`°rc•n
(s, " \t\r\n,]}");

258 
hiddí
 = (*
s
 == '}')? 1 : (*s == ']')? 2 : 0;

259 i‡(*
s
 != '\0') *s++ = '\0';

260 *
°©e
 = 
	`STATE
(
s
, 
hiddí
);

261  
tokí
->
ty≥
 = 
	`tokí_ty≥
(token);

264 #unde‡
STATE


265 
	}
}

267 
	$hts_js⁄_‚ext
(
hFILE
 *
Â
, 
hts_js⁄_tokí
 *
tokí
, 
k°rög_t
 *
k°r
)

269 
≥ek
;

270 
c
;

272 ;;Ë
c
 = 
	`hgëc
(
Â
)) {

281 
EOF
:

282  
tokí
->
ty≥
 = '\0';

288  
tokí
->
ty≥
 = 
c
;

291 
k°r
->
l
 = 0;

292 
	`fsˇn_°rög
(
Â
, 
k°r
);

293 i‡(
k°r
->
l
 =0Ë
	`kput¢
("", 0, kstr);

294 
tokí
->
°r
 = 
k°r
->
s
;

295  
tokí
->
ty≥
 = 's';

298 
k°r
->
l
 = 0;

299 
	`kputc
(
c
, 
k°r
);

300 
	`h≥ek
(
Â
, &
≥ek
, 1Ë=1 && !
	`°rchr
(" \t\r\n,]}",Öeek)) {

301 i‡((
c
 = 
	`hgëc
(
Â
)Ë=
EOF
) ;

302 
	`kputc
(
c
, 
k°r
);

304 
tokí
->
°r
 = 
k°r
->
s
;

305  
tokí
->
ty≥
 = 
	`tokí_ty≥
(token);

307 
	}
}

310 
	thts_js⁄_√xt‚
(*
	t¨g1
, *
	t¨g2
, 
	thts_js⁄_tokí
 *
	ttokí
);

312 
	$skù_vÆue
(
ty≥
, 
hts_js⁄_√xt‚
 *
√xt
, *
¨g1
, *
¨g2
)

314 
hts_js⁄_tokí
 
tokí
;

315 
Àvñ
;

317 
ty≥
?Åy≥ : 
	`√xt
(
¨g1
, 
¨g2
, &
tokí
)) {

328 
Àvñ
 = 1;

335 
Àvñ
 > 0)

336 
	`√xt
(
¨g1
, 
¨g2
, &
tokí
)) {

345 
Àvñ
++;

350 --
Àvñ
;

358 
	}
}

360 
	$¢ext
(*
¨g1
, *
¨g2
, 
hts_js⁄_tokí
 *
tokí
)

362  
	`hts_js⁄_¢ext
(
¨g1
, 
¨g2
, 
tokí
);

363 
	}
}

364 
	$hts_js⁄_sskù_vÆue
(*
°r
, 
size_t
 *
°©e
, 
ty≥
)

366  
	`skù_vÆue
(
ty≥
, 
¢ext
, 
°r
, 
°©e
);

367 
	}
}

369 
	$‚ext
(*
¨g1
, *
¨g2
, 
hts_js⁄_tokí
 *
tokí
)

371  
	`hts_js⁄_‚ext
(
¨g1
, 
tokí
, 
¨g2
);

372 
	}
}

373 
	$hts_js⁄_fskù_vÆue
(
hFILE
 *
Â
, 
ty≥
)

375 
k°rög_t
 
°r
 = { 0, 0, 
NULL
 };

376 
ªt
 = 
	`skù_vÆue
(
ty≥
, 
‚ext
, 
Â
, &
°r
);

377 
	`‰ì
(
°r
.
s
);

378  
ªt
;

379 
	}
}

	@htslib/thread_pool.c

25 #i‚de‡
TEST_MAIN


26 
	~<c⁄fig.h
>

29 
	~<°dlib.h
>

30 
	~<öây≥s.h
>

31 
	~<sig«l.h
>

32 
	~<î∫o.h
>

33 
	~<°dio.h
>

34 
	~<°rög.h
>

35 
	~<sys/time.h
>

36 
	~<as£π.h
>

37 
	~<°d¨g.h
>

38 
	~<uni°d.h
>

39 
	~<limôs.h
>

41 
	~"thªad_poﬁ_öã∫Æ.h
"

45 #ifde‡
DEBUG


46 
	$w‹kî_id
(
hts_çoﬁ
 *
p
) {

47 
i
;

48 
±hªad_t
 
s
 = 
	`±hªad_£lf
();

49 
i
 = 0; i < 
p
->
tsize
; i++) {

50 i‡(
	`±hªad_equÆ
(
s
, 
p
->
t
[
i
].
tid
))

51  
i
;

54 
	}
}

56 
	$DBG_OUT
(
FILE
 *
Â
, *
fmt
, ...) {

57 
va_li°
 
¨gs
;

58 
	`va_°¨t
(
¨gs
, 
fmt
);

59  
	`vÂrötf
(
Â
, 
fmt
, 
¨gs
);

60 
	}
}

62 
	#DBG_OUT
(...Ëdo{}0)

	)

81 
	$hts_çoﬁ_add_ªsu…
(
hts_çoﬁ_job
 *
j
, *
d©a
) {

82 
hts_çoﬁ_¥o˚ss
 *
q
 = 
j
->q;

83 
hts_çoﬁ_ªsu…
 *
r
;

85 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

87 
	`DBG_OUT
(
°dîr
, "%d: AddögÑesu…Åÿqueuê%p, sîü»%"
PRId64
", %d of %d\n",

88 
	`w‹kî_id
(
j
->
p
), 
q
, j->
£rül
, q->
n_ouçut
+1, q->
qsize
);

90 i‡(--
q
->
n_¥o˚ssög
 == 0)

91 
	`±hªad_c⁄d_sig«l
(&
q
->
n⁄e_¥o˚ssög_c
);

94 i‡(
q
->
ö_⁄ly
) {

95 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

99 i‡(!(
r
 = 
	`mÆloc
((*r))))

102 
r
->
√xt
 = 
NULL
;

103 
r
->
d©a
 = data;

104 
r
->
£rül
 = 
j
->serial;

106 
q
->
n_ouçut
++;

107 i‡(
q
->
ouçut_èû
) {

108 
q
->
ouçut_èû
->
√xt
 = 
r
;

109 
q
->
ouçut_èû
 = 
r
;

111 
q
->
ouçut_hód
 = q->
ouçut_èû
 = 
r
;

114 
	`DBG_OUT
(
°dîr
, "%d: Brﬂdˇ°ögÑesu…_avaû (id %"
PRId64
")\n",

115 
	`w‹kî_id
(
j
->
p
), 
r
->
£rül
);

116 
	`±hªad_c⁄d_brﬂdˇ°
(&
q
->
ouçut_avaû_c
);

117 
	`DBG_OUT
(
°dîr
, "%d: Brﬂdˇ° com∂ëe\n", 
	`w‹kî_id
(
j
->
p
));

119 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

122 
	}
}

124 
wake_√xt_w‹kî
(
hts_çoﬁ_¥o˚ss
 *
q
, 
locked
);

127 
hts_çoﬁ_ªsu…
 *
	$hts_çoﬁ_√xt_ªsu…_locked
(
hts_çoﬁ_¥o˚ss
 *
q
) {

128 
hts_çoﬁ_ªsu…
 *
r
, *
œ°
;

130 i‡(
q
->
shutdown
)

131  
NULL
;

133 
œ°
 = 
NULL
, 
r
 = 
q
->
ouçut_hód
;Ñ;Üa° =Ñ,Ñ =Ñ->
√xt
) {

134 i‡(
r
->
£rül
 =
q
->
√xt_£rül
)

138 i‡(
r
) {

140 i‡(
q
->
ouçut_hód
 =
r
)

141 
q
->
ouçut_hód
 = 
r
->
√xt
;

143 
œ°
->
√xt
 = 
r
->next;

145 i‡(
q
->
ouçut_èû
 =
r
)

146 
q
->
ouçut_èû
 = 
œ°
;

148 i‡(!
q
->
ouçut_hód
)

149 
q
->
ouçut_èû
 = 
NULL
;

151 
q
->
√xt_£rül
++;

152 
q
->
n_ouçut
--;

154 i‡(
q
->
qsize
 && q->
n_ouçut
 < q->qsize) {

158 
	`±hªad_c⁄d_sig«l
(&
q
->
öput_nŸ_fuŒ_c
);

159 i‡(!
q
->
shutdown
)

160 
	`wake_√xt_w‹kî
(
q
, 1);

164  
r
;

165 
	}
}

177 
hts_çoﬁ_ªsu…
 *
	$hts_çoﬁ_√xt_ªsu…
(
hts_çoﬁ_¥o˚ss
 *
q
) {

178 
hts_çoﬁ_ªsu…
 *
r
;

180 
	`DBG_OUT
(
°dîr
, "Reque°ögÇexàªsu… o¿queuê%p\n", 
q
);

182 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

183 
r
 = 
	`hts_çoﬁ_√xt_ªsu…_locked
(
q
);

184 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

186 
	`DBG_OUT
(
°dîr
, "(q=%pËFound %p\n", 
q
, 
r
);

188  
r
;

189 
	}
}

201 
hts_çoﬁ_ªsu…
 *
	$hts_çoﬁ_√xt_ªsu…_waô
(
hts_çoﬁ_¥o˚ss
 *
q
) {

202 
hts_çoﬁ_ªsu…
 *
r
;

204 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

205 !(
r
 = 
	`hts_çoﬁ_√xt_ªsu…_locked
(
q
))) {

207 
timevÆ
 
now
;

208 
time•ec
 
timeout
;

210 
	`gëtimeofday
(&
now
, 
NULL
);

211 
timeout
.
tv_£c
 = 
now
.tv_sec + 10;

212 
timeout
.
tv_n£c
 = 
now
.
tv_u£c
 * 1000;

214 
q
->
ªf_cou¡
++;

215 i‡(
q
->
shutdown
) {

216 
rc
 = --
q
->
ªf_cou¡
;

217 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

218 i‡(
rc
 == 0)

219 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q
);

220  
NULL
;

222 
	`±hªad_c⁄d_timedwaô
(&
q
->
ouçut_avaû_c
, &q->
p
->
poﬁ_m
, &
timeout
);

224 
q
->
ªf_cou¡
--;

226 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

228  
r
;

229 
	}
}

235 
	$hts_çoﬁ_¥o˚ss_em±y
(
hts_çoﬁ_¥o˚ss
 *
q
) {

236 
em±y
;

238 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

239 
em±y
 = 
q
->
n_öput
 =0 && q->
n_¥o˚ssög
 =0 && q->
n_ouçut
 == 0;

240 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

242  
em±y
;

243 
	}
}

245 
	$hts_çoﬁ_¥o˚ss_ªf_ö¸
(
hts_çoﬁ_¥o˚ss
 *
q
) {

246 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

247 
q
->
ªf_cou¡
++;

248 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

249 
	}
}

251 
	$hts_çoﬁ_¥o˚ss_ªf_de¸
(
hts_çoﬁ_¥o˚ss
 *
q
) {

252 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

253 i‡(--
q
->
ªf_cou¡
 <= 0) {

254 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

255 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q
);

260 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

261 
	}
}

266 
	$hts_çoﬁ_¥o˚ss_Àn
(
hts_çoﬁ_¥o˚ss
 *
q
) {

267 
Àn
;

269 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

270 
Àn
 = 
q
->
n_ouçut
;

271 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

273  
Àn
;

274 
	}
}

280 
	$hts_çoﬁ_¥o˚ss_sz
(
hts_çoﬁ_¥o˚ss
 *
q
) {

281 
Àn
;

283 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

284 
Àn
 = 
q
->
n_ouçut
 + q->
n_öput
 + q->
n_¥o˚ssög
;

285 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

287  
Àn
;

288 
	}
}

296 
	$hts_çoﬁ_¥o˚ss_shutdown
(
hts_çoﬁ_¥o˚ss
 *
q
) {

297 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

298 
q
->
shutdown
 = 1;

299 
	`±hªad_c⁄d_brﬂdˇ°
(&
q
->
ouçut_avaû_c
);

300 
	`±hªad_c⁄d_brﬂdˇ°
(&
q
->
öput_nŸ_fuŒ_c
);

301 
	`±hªad_c⁄d_brﬂdˇ°
(&
q
->
öput_em±y_c
);

302 
	`±hªad_c⁄d_brﬂdˇ°
(&
q
->
n⁄e_¥o˚ssög_c
);

303 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

304 
	}
}

310 
	$hts_çoﬁ_dñëe_ªsu…
(
hts_çoﬁ_ªsu…
 *
r
, 
‰ì_d©a
) {

311 i‡(!
r
)

314 i‡(
‰ì_d©a
 && 
r
->
d©a
)

315 
	`‰ì
(
r
->
d©a
);

317 
	`‰ì
(
r
);

318 
	}
}

324 *
	$hts_çoﬁ_ªsu…_d©a
(
hts_çoﬁ_ªsu…
 *
r
) {

325  
r
->
d©a
;

326 
	}
}

338 
hts_çoﬁ_¥o˚ss
 *
	$hts_çoﬁ_¥o˚ss_öô
(
hts_çoﬁ
 *
p
, 
qsize
, 
ö_⁄ly
) {

339 
hts_çoﬁ_¥o˚ss
 *
q
 = 
	`mÆloc
((*q));

341 
	`±hªad_c⁄d_öô
(&
q
->
ouçut_avaû_c
, 
NULL
);

342 
	`±hªad_c⁄d_öô
(&
q
->
öput_nŸ_fuŒ_c
, 
NULL
);

343 
	`±hªad_c⁄d_öô
(&
q
->
öput_em±y_c
, 
NULL
);

344 
	`±hªad_c⁄d_öô
(&
q
->
n⁄e_¥o˚ssög_c
,
NULL
);

346 
q
->
p
 =Ö;

347 
q
->
öput_hód
 = 
NULL
;

348 
q
->
öput_èû
 = 
NULL
;

349 
q
->
ouçut_hód
 = 
NULL
;

350 
q
->
ouçut_èû
 = 
NULL
;

351 
q
->
√xt_£rül
 = 0;

352 
q
->
cuº_£rül
 = 0;

353 
q
->
n_öput
 = 0;

354 
q
->
n_ouçut
 = 0;

355 
q
->
n_¥o˚ssög
= 0;

356 
q
->
qsize
 = qsize;

357 
q
->
ö_⁄ly
 = in_only;

358 
q
->
shutdown
 = 0;

359 
q
->
wake_di•©ch
 = 0;

360 
q
->
ªf_cou¡
 = 1;

362 
q
->
√xt
 = 
NULL
;

363 
q
->
¥ev
 = 
NULL
;

365 
	`hts_çoﬁ_¥o˚ss_©èch
(
p
, 
q
);

367  
q
;

368 
	}
}

373 
	$hts_çoﬁ_¥o˚ss_de°roy
(
hts_çoﬁ_¥o˚ss
 *
q
) {

374 
	`DBG_OUT
(
°dîr
, "De°royögÑesu…†queuê%p\n", 
q
);

376 i‡(!
q
)

380 
	`hts_çoﬁ_¥o˚ss_ª£t
(
q
, 0);

381 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

382 
	`hts_çoﬁ_¥o˚ss_dëach
(
q
->
p
, q);

383 
	`hts_çoﬁ_¥o˚ss_shutdown
(
q
);

386 i‡(--
q
->
ªf_cou¡
 > 0) {

387 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

391 
	`±hªad_c⁄d_de°roy
(&
q
->
ouçut_avaû_c
);

392 
	`±hªad_c⁄d_de°roy
(&
q
->
öput_nŸ_fuŒ_c
);

393 
	`±hªad_c⁄d_de°roy
(&
q
->
öput_em±y_c
);

394 
	`±hªad_c⁄d_de°roy
(&
q
->
n⁄e_¥o˚ssög_c
);

395 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

397 
	`‰ì
(
q
);

399 
	`DBG_OUT
(
°dîr
, "De°royedÑesu…†queuê%p\n", 
q
);

400 
	}
}

411 
	$hts_çoﬁ_¥o˚ss_©èch
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
) {

412 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

413 i‡(
p
->
q_hód
) {

414 
q
->
√xt
 = 
p
->
q_hód
;

415 
q
->
¥ev
 = 
p
->
q_hód
->prev;

416 
p
->
q_hód
->
¥ev
->
√xt
 = 
q
;

417 
p
->
q_hód
->
¥ev
 = 
q
;

419 
q
->
√xt
 = q;

420 
q
->
¥ev
 = q;

422 
p
->
q_hód
 = 
q
;

423 
	`as£π
(
p
->
q_hód
 &&Ö->q_hód->
¥ev
 &&Ö->q_hód->
√xt
);

424 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

425 
	}
}

427 
	$hts_çoﬁ_¥o˚ss_dëach
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
) {

428 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

429 i‡(!
p
->
q_hód
 || !
q
->
¥ev
 || !q->
√xt
)

430 
d⁄e
;

432 
hts_çoﬁ_¥o˚ss
 *
cuº
 = 
p
->
q_hód
, *
fú°
 = curr;

434 i‡(
cuº
 =
q
) {

435 
q
->
√xt
->
¥ev
 = q->prev;

436 
q
->
¥ev
->
√xt
 = q->next;

437 
p
->
q_hód
 = 
q
->
√xt
;

438 
q
->
√xt
 = q->
¥ev
 = 
NULL
;

441 i‡(
p
->
q_hód
 =
q
)

442 
p
->
q_hód
 = 
NULL
;

446 
cuº
 = cuº->
√xt
;

447 } 
cuº
 !
fú°
);

449 
d⁄e
:

450 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

451 
	}
}

458 
	#TDIFF
(
t2
,
t1
Ë(—2.
tv_£c
-t1.tv_£c)*1000000 +Å2.
tv_u£c
-t1.tv_u£c)

	)

470 *
	$çoﬁ_w‹kî
(*
¨g
) {

471 
hts_çoﬁ_w‹kî
 *
w
 = (hts_çoﬁ_w‹kî *)
¨g
;

472 
hts_çoﬁ
 *
p
 = 
w
->p;

473 
hts_çoﬁ_job
 *
j
;

477 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

479 
	`as£π
(
p
->
q_hód
 =0 || (p->q_hód->
¥ev
 &&Ö->q_hód->
√xt
));

481 
w‹k_to_do
 = 0;

482 
hts_çoﬁ_¥o˚ss
 *
fú°
 = 
p
->
q_hód
, *
q
 = first;

484 i‡(
p
->
shutdown
)

490 i‡(
q
 && q->
öput_hód
 && q->
qsize
 - q->
n_ouçut
 > 
p
->
tsize
 -Ö->
nwaôög
) {

492 
w‹k_to_do
 = 1;

496 i‡(
q
Ëq = q->
√xt
;

497 } 
q
 && q !
fú°
);

499 i‡(
p
->
shutdown
) {

500 
shutdown
:

501 #ifde‡
DEBUG


502 
	`Ârötf
(
°dîr
, "%d: Shuâög down\n", 
	`w‹kî_id
(
p
));

504 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

505 
	`±hªad_exô
(
NULL
);

508 i‡(!
w‹k_to_do
) {

510 
p
->
nwaôög
++;

513 i‡(
p
->
t_°ack_t›
 =-1 ||Ö->t_°ack_t› > 
w
->
idx
)

514 
p
->
t_°ack_t›
 = 
w
->
idx
;

516 
p
->
t_°ack
[
w
->
idx
] = 1;

520 
	`±hªad_c⁄d_waô
(&
w
->
≥ndög_c
, &
p
->
poﬁ_m
);

521 
p
->
t_°ack
[
w
->
idx
] = 0;

524 
i
;

525 
p
->
t_°ack_t›
 = -1;

526 
i
 = 0; i < 
p
->
tsize
; i++) {

527 i‡(
p
->
t_°ack
[
i
]) {

528 
p
->
t_°ack_t›
 = 
i
;

533 
p
->
nwaôög
--;

534 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

541 
q
->
ªf_cou¡
++;

542 
q
->
öput_hód
 && q->
qsize
 - q->
n_ouçut
 > q->
n_¥o˚ssög
) {

543 i‡(
p
->
shutdown
)

544 
shutdown
;

546 
j
 = 
q
->
öput_hód
;

547 
	`as£π
(
j
->
p
 ==Ö);

549 i‡(!(
q
->
öput_hód
 = 
j
->
√xt
))

550 
q
->
öput_èû
 = 
NULL
;

558 
q
->
n_¥o˚ssög
++;

559 i‡(
q
->
n_öput
-- >q->
qsize
)

560 
	`±hªad_c⁄d_brﬂdˇ°
(&
q
->
öput_nŸ_fuŒ_c
);

562 i‡(
q
->
n_öput
 == 0)

563 
	`±hªad_c⁄d_sig«l
(&
q
->
öput_em±y_c
);

565 
p
->
njobs
--;

567 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

569 
	`DBG_OUT
(
°dîr
, "%d: Pro˚ssög queuê%p, sîü»%"
PRId64
"\n",

570 
	`w‹kî_id
(
j
->
p
), 
q
, j->
£rül
);

572 
	`hts_çoﬁ_add_ªsu…
(
j
, j->
	`func
(j->
¨g
));

574 
	`‰ì
(
j
);

576 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

578 i‡(--
q
->
ªf_cou¡
 == 0)

579 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q
);

583 
p
->
q_hód
 = 
q
->
√xt
;

585 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

588  
NULL
;

589 
	}
}

591 
	$wake_√xt_w‹kî
(
hts_çoﬁ_¥o˚ss
 *
q
, 
locked
) {

592 
hts_çoﬁ
 *
p
 = 
q
->p;

593 i‡(!
locked
)

594 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

598 
	`as£π
(
q
->
¥ev
 && q->
√xt
);

599 
p
->
q_hód
 = 
q
;

612 
	`as£π
(
p
->
njobs
 >
q
->
n_öput
);

614 
ru¬ög
 = 
p
->
tsize
 -Ö->
nwaôög
;

615 
sig
 = 
p
->
t_°ack_t›
 >0 &&Ö->
njobs
 >Ö->
tsize
 -Ö->
nwaôög


616 && (!
q
 || q->
n_¥o˚ssög
 < q->
qsize
 - q->
n_ouçut
);

619 #ifde‡
AVG_USAGE


629 i‡(++
p
->
n_cou¡
 == 256) {

630 
p
->
n_cou¡
 >>= 1;

631 
p
->
n_ru¬ög
 >>= 1;

633 
p
->
n_ru¬ög
 +
ru¬ög
;

635 i‡(
sig
 && 
p
->
n_cou¡
 >128 && 
ru¬ög
*p->n_cou¡ >Ö->
n_ru¬ög
+1) sig=0;

639 
	`¥ötf
("%d waôög, %dÑu¬ög, %d ouçut, %d,áru¿%d => %d\t", 
p
->
njobs
,

640 
ru¬ög
, 
q
->
n_ouçut
, q->
qsize
 - q->n_output,

641 
p
->
n_ru¬ög
/p->
n_cou¡
, 
sig
);

642 
i
;

643 
i
 = 0; i < 
p
->
tsize
; i++)

644 
	`putch¨
("x "[
p
->
t_°ack
[
i
]]);

645 
	`putch¨
('\n');

648 i‡(
sig
)

649 
	`±hªad_c⁄d_sig«l
(&
p
->
t
[p->
t_°ack_t›
].
≥ndög_c
);

651 i‡(!
locked
)

652 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

653 
	}
}

661 
hts_çoﬁ
 *
	$hts_çoﬁ_öô
(
n
) {

662 
i
;

663 
hts_çoﬁ
 *
p
 = 
	`mÆloc
((*p));

664 
p
->
tsize
 = 
n
;

665 
p
->
njobs
 = 0;

666 
p
->
nwaôög
 = 0;

667 
p
->
shutdown
 = 0;

668 
p
->
q_hód
 = 
NULL
;

669 
p
->
t_°ack
 = 
NULL
;

670 
p
->
n_cou¡
 = 0;

671 
p
->
n_ru¬ög
 = 0;

672 
p
->
t
 = 
	`mÆloc
(
n
 * (p->t[0]));

674 
±hªad_muãx©å_t
 
©å
;

675 
	`±hªad_muãx©å_öô
(&
©å
);

676 
	`±hªad_muãx©å_£ây≥
(&
©å
, 
PTHREAD_MUTEX_RECURSIVE
);

677 
	`±hªad_muãx_öô
(&
p
->
poﬁ_m
, &
©å
);

678 
	`±hªad_muãx©å_de°roy
(&
©å
);

680 i‡(!(
p
->
t_°ack
 = 
	`mÆloc
(
n
 * (*p->t_stack))))

681  
NULL
;

682 
p
->
t_°ack_t›
 = -1;

684 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

686 
i
 = 0; i < 
n
; i++) {

687 
hts_çoﬁ_w‹kî
 *
w
 = &
p
->
t
[
i
];

688 
p
->
t_°ack
[
i
] = 0;

689 
w
->
p
 =Ö;

690 
w
->
idx
 = 
i
;

691 
	`±hªad_c⁄d_öô
(&
w
->
≥ndög_c
, 
NULL
);

692 i‡(0 !
	`±hªad_¸óã
(&
w
->
tid
, 
NULL
, 
çoﬁ_w‹kî
, w)) {

693 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

694  
NULL
;

698 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

700  
p
;

701 
	}
}

706 
	$hts_çoﬁ_size
(
hts_çoﬁ
 *
p
) {

707  
p
->
tsize
;

708 
	}
}

716 
	$hts_çoﬁ_di•©ch
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
,

717 *(*
func
)(*
¨g
), *arg) {

718  
	`hts_çoﬁ_di•©ch2
(
p
, 
q
, 
func
, 
¨g
, 0);

719 
	}
}

728 
	$hts_çoﬁ_di•©ch2
(
hts_çoﬁ
 *
p
, 
hts_çoﬁ_¥o˚ss
 *
q
,

729 *(*
func
)(*
¨g
), *¨g, 
n⁄block
) {

730 
hts_çoﬁ_job
 *
j
;

732 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

734 
	`DBG_OUT
(
°dîr
, "Di•©chög job f‹ queuê%p, sîü»%"
PRId64
"\n",

735 
q
, q->
cuº_£rül
);

737 i‡(
q
->
n_öput
 >q->
qsize
 && 
n⁄block
 == 1) {

738 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

739 
î∫o
 = 
EAGAIN
;

743 i‡(!(
j
 = 
	`mÆloc
((*j)))) {

744 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

747 
j
->
func
 = func;

748 
j
->
¨g
 =árg;

749 
j
->
√xt
 = 
NULL
;

750 
j
->
p
 =Ö;

751 
j
->
q
 = q;

752 
j
->
£rül
 = 
q
->
cuº_£rül
++;

754 i‡(
n⁄block
 == 0) {

755 
q
->
n_öput
 >q->
qsize
 && !q->
shutdown
 && !q->
wake_di•©ch
)

756 
	`±hªad_c⁄d_waô
(&
q
->
öput_nŸ_fuŒ_c
, &q->
p
->
poﬁ_m
);

757 i‡(
q
->
shutdown
) {

758 
	`‰ì
(
j
);

759 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

762 i‡(
q
->
wake_di•©ch
) {

764 
q
->
wake_di•©ch
 = 0;

768 
p
->
njobs
++;

769 
q
->
n_öput
++;

771 i‡(
q
->
öput_èû
) {

772 
q
->
öput_èû
->
√xt
 = 
j
;

773 
q
->
öput_èû
 = 
j
;

775 
q
->
öput_hód
 = q->
öput_èû
 = 
j
;

778 
	`DBG_OUT
(
°dîr
, "Di•©ched (£rü»%"
PRId64
")\n", 
j
->
£rül
);

786 i‡(!
q
->
shutdown
)

787 
	`wake_√xt_w‹kî
(
q
, 1);

789 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

792 
	}
}

798 
	$hts_çoﬁ_wake_di•©ch
(
hts_çoﬁ_¥o˚ss
 *
q
) {

799 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

800 
q
->
wake_di•©ch
 = 1;

801 
	`±hªad_c⁄d_sig«l
(&
q
->
öput_nŸ_fuŒ_c
);

802 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

803 
	}
}

816 
	$hts_çoﬁ_¥o˚ss_Êush
(
hts_çoﬁ_¥o˚ss
 *
q
) {

817 
i
;

818 
hts_çoﬁ
 *
p
 = 
q
->p;

820 
	`DBG_OUT
(
°dîr
, "FlushögÖoﬁ %p\n", 
p
);

823 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

826 
i
 = 0; i < 
p
->
tsize
; i++)

827 i‡(
p
->
t_°ack
[
i
])

828 
	`±hªad_c⁄d_sig«l
(&
p
->
t
[
i
].
≥ndög_c
);

832 i‡(
q
->
qsize
 < q->
n_ouçut
 + q->
n_öput
 + q->
n_¥o˚ssög
)

833 
q
->
qsize
 = q->
n_ouçut
 + q->
n_öput
 + q->
n_¥o˚ssög
;

836 
q
->
n_öput
 || q->
n_¥o˚ssög
) {

837 
q
->
n_öput
)

838 
	`±hªad_c⁄d_waô
(&
q
->
öput_em±y_c
, &
p
->
poﬁ_m
);

839 i‡(
q
->
shutdown
) ;

840 
q
->
n_¥o˚ssög
)

841 
	`±hªad_c⁄d_waô
(&
q
->
n⁄e_¥o˚ssög_c
, &
p
->
poﬁ_m
);

842 i‡(
q
->
shutdown
) ;

845 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

847 
	`DBG_OUT
(
°dîr
, "Flushed com∂ëêf‹Öoﬁ %p, queuê%p\n", 
p
, 
q
);

850 
	}
}

864 
	$hts_çoﬁ_¥o˚ss_ª£t
(
hts_çoﬁ_¥o˚ss
 *
q
, 
‰ì_ªsu…s
) {

865 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

867 
q
->
√xt_£rül
 = 
INT_MAX
;

870 
hts_çoﬁ_job
 *
j
, *
jn
;

871 
j
 = 
q
->
öput_hód
; j; j = 
jn
) {

873 
jn
 = 
j
->
√xt
;

874 
	`‰ì
(
j
);

876 
q
->
öput_hód
 = q->
öput_èû
 = 
NULL
;

877 
q
->
n_öput
 = 0;

880 
hts_çoﬁ_ªsu…
 *
r
, *
∫
;

881 
r
 = 
q
->
ouçut_hód
;Ñ;Ñ = 
∫
) {

883 
∫
 = 
r
->
√xt
;

884 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 
‰ì_ªsu…s
);

886 
q
->
ouçut_hód
 = q->
ouçut_èû
 = 
NULL
;

887 
q
->
n_ouçut
 = 0;

888 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

893 i‡(
	`hts_çoﬁ_¥o˚ss_Êush
(
q
) != 0)

897 
	`±hªad_muãx_lock
(&
q
->
p
->
poﬁ_m
);

898 
r
 = 
q
->
ouçut_hód
;Ñ;Ñ = 
∫
) {

900 
∫
 = 
r
->
√xt
;

901 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 
‰ì_ªsu…s
);

903 
q
->
ouçut_hód
 = q->
ouçut_èû
 = 
NULL
;

904 
q
->
n_ouçut
 = 0;

907 
q
->
√xt_£rül
 = q->
cuº_£rül
 = 0;

908 
	`±hªad_c⁄d_sig«l
(&
q
->
öput_nŸ_fuŒ_c
);

909 
	`±hªad_muãx_u∆ock
(&
q
->
p
->
poﬁ_m
);

912 
	}
}

915 
	$hts_çoﬁ_¥o˚ss_qsize
(
hts_çoﬁ_¥o˚ss
 *
q
) {

916  
q
->
qsize
;

917 
	}
}

923 
	$hts_çoﬁ_de°roy
(
hts_çoﬁ
 *
p
) {

924 
i
;

926 
	`DBG_OUT
(
°dîr
, "De°royögÖoﬁ %p\n", 
p
);

929 
	`±hªad_muãx_lock
(&
p
->
poﬁ_m
);

930 
p
->
shutdown
 = 1;

932 
	`DBG_OUT
(
°dîr
, "Sending shutdownÑequest\n");

934 
i
 = 0; i < 
p
->
tsize
; i++)

935 
	`±hªad_c⁄d_sig«l
(&
p
->
t
[
i
].
≥ndög_c
);

937 
	`±hªad_muãx_u∆ock
(&
p
->
poﬁ_m
);

939 
	`DBG_OUT
(
°dîr
, "Shutdown complete\n");

941 
i
 = 0; i < 
p
->
tsize
; i++)

942 
	`±hªad_joö
(
p
->
t
[
i
].
tid
, 
NULL
);

944 
	`±hªad_muãx_de°roy
(&
p
->
poﬁ_m
);

945 
i
 = 0; i < 
p
->
tsize
; i++)

946 
	`±hªad_c⁄d_de°roy
(&
p
->
t
[
i
].
≥ndög_c
);

948 i‡(
p
->
t_°ack
)

949 
	`‰ì
(
p
->
t_°ack
);

951 
	`‰ì
(
p
->
t
);

952 
	`‰ì
(
p
);

954 
	`DBG_OUT
(
°dîr
, "De°royedÖoﬁ %p\n", 
p
);

955 
	}
}

962 
	$hts_çoﬁ_kûl
(
hts_çoﬁ
 *
p
) {

963 
i
;

965 
	`DBG_OUT
(
°dîr
, "De°royögÖoﬁ %p, kûl=%d\n", 
p
, 
kûl
);

967 
i
 = 0; i < 
p
->
tsize
; i++)

968 
	`±hªad_kûl
(
p
->
t
[
i
].
tid
, 
SIGINT
);

970 
	`±hªad_muãx_de°roy
(&
p
->
poﬁ_m
);

971 
i
 = 0; i < 
p
->
tsize
; i++)

972 
	`±hªad_c⁄d_de°roy
(&
p
->
t
[
i
].
≥ndög_c
);

974 i‡(
p
->
t_°ack
)

975 
	`‰ì
(
p
->
t_°ack
);

977 
	`‰ì
(
p
->
t
);

978 
	`‰ì
(
p
);

980 
	`DBG_OUT
(
°dîr
, "De°royedÖoﬁ %p\n", 
p
);

981 
	}
}

992 #ifde‡
TEST_MAIN


994 
	~<°dio.h
>

996 #i‚de‡
TASK_SIZE


997 
	#TASK_SIZE
 1000

	)

1004 *
	$doô_squ¨e_u
(*
¨g
) {

1005 
job
 = *(*)
¨g
;

1007 
	`u¶ìp
(
	`øndom
() % 100000);

1009 
	`¥ötf
("RESULT: %d\n", 
job
*job);

1011 
	`‰ì
(
¨g
);

1012  
NULL
;

1013 
	}
}

1015 
	$ã°_squ¨e_u
(
n
) {

1016 
hts_çoﬁ
 *
p
 = 
	`hts_çoﬁ_öô
(
n
);

1017 
hts_çoﬁ_¥o˚ss
 *
q
 = 
	`hts_çoﬁ_¥o˚ss_öô
(
p
, 
n
*2, 1);

1018 
i
;

1021 
i
 = 0; i < 
TASK_SIZE
; i++) {

1022 *
ù
 = 
	`mÆloc
((*ip));

1023 *
ù
 = 
i
;

1024 
	`hts_çoﬁ_di•©ch
(
p
, 
q
, 
doô_squ¨e_u
, 
ù
);

1027 
	`hts_çoﬁ_¥o˚ss_Êush
(
q
);

1028 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q
);

1029 
	`hts_çoﬁ_de°roy
(
p
);

1032 
	}
}

1042 *
	$doô_squ¨e
(*
¨g
) {

1043 
job
 = *(*)
¨g
;

1044 *
ªs
;

1048 
	`u¶ìp
(500000 * ((
job
&31)==31Ë+ 
	`øndom
() % 10000);

1050 
ªs
 = 
	`mÆloc
((*res));

1051 *
ªs
 = (
job
<0) ? -job*job : job*job;

1053 
	`‰ì
(
¨g
);

1054  
ªs
;

1055 
	}
}

1057 
	$ã°_squ¨e
(
n
) {

1058 
hts_çoﬁ
 *
p
 = 
	`hts_çoﬁ_öô
(
n
);

1059 
hts_çoﬁ_¥o˚ss
 *
q
 = 
	`hts_çoﬁ_¥o˚ss_öô
(
p
, 
n
*2, 0);

1060 
i
;

1061 
hts_çoﬁ_ªsu…
 *
r
;

1064 
i
 = 0; i < 
TASK_SIZE
; i++) {

1065 *
ù
 = 
	`mÆloc
((*ip));

1066 *
ù
 = 
i
;

1067 
blk
;

1083 
blk
 = 
	`hts_çoﬁ_di•©ch2
(
p
, 
q
, 
doô_squ¨e
, 
ù
, 1);

1086 i‡((
r
 = 
	`hts_çoﬁ_√xt_ªsu…
(
q
))) {

1087 
	`¥ötf
("RESULT: %d\n", *(*)
r
->
d©a
);

1088 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 1);

1090 i‡(
blk
 == -1) {

1093 
	`putch¨
('.'); 
	`fÊush
(
°dout
);

1094 
	`u¶ìp
(10000);

1096 } 
blk
 == -1);

1100 
	`hts_çoﬁ_¥o˚ss_Êush
(
q
);

1102 (
r
 = 
	`hts_çoﬁ_√xt_ªsu…
(
q
))) {

1103 
	`¥ötf
("RESULT: %d\n", *(*)
r
->
d©a
);

1104 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 1);

1107 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q
);

1108 
	`hts_çoﬁ_de°roy
(
p
);

1111 
	}
}

1121 
	ssqu¨eB_›t
 {

1122 
hts_çoﬁ
 *
	mp
;

1123 
hts_çoﬁ_¥o˚ss
 *
	mq
;

1124 
	mn
;

1126 *
	$ã°_squ¨eB_di•©chî
(*
¨g
) {

1127 
squ¨eB_›t
 *
o
 = (squ¨eB_›à*)
¨g
;

1128 
i
, *
ù
;

1130 
i
 = 0; i < 
o
->
n
; i++) {

1131 
ù
 = 
	`mÆloc
((*ip));

1132 *
ù
 = 
i
;

1134 
	`hts_çoﬁ_di•©ch
(
o
->
p
, o->
q
, 
doô_squ¨e
, 
ù
);

1138 *(
ù
 = 
	`mÆloc
((*ip))) = -1;

1139 
	`hts_çoﬁ_di•©ch
(
o
->
p
, o->
q
, 
doô_squ¨e
, 
ù
);

1140 
	`±hªad_exô
(
NULL
);

1141 
	}
}

1143 
	$ã°_squ¨eB
(
n
) {

1144 
hts_çoﬁ
 *
p
 = 
	`hts_çoﬁ_öô
(
n
);

1145 
hts_çoﬁ_¥o˚ss
 *
q
 = 
	`hts_çoﬁ_¥o˚ss_öô
(
p
, 
n
*2, 0);

1146 
squ¨eB_›t
 
o
 = {
p
, 
q
, 
TASK_SIZE
};

1147 
±hªad_t
 
tid
;

1150 
	`±hªad_¸óã
(&
tid
, 
NULL
, 
ã°_squ¨eB_di•©chî
, &
o
);

1154 
hts_çoﬁ_ªsu…
 *
r
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
q
);

1155 
x
 = *(*)
r
->
d©a
;

1156 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 1);

1157 i‡(
x
 == -1)

1159 
	`¥ötf
("RESULT: %d\n", 
x
);

1165 
	`hts_çoﬁ_¥o˚ss_Êush
(
q
);

1166 
	`as£π
(
	`hts_çoﬁ_√xt_ªsu…
(
q
Ë=
NULL
);

1168 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q
);

1169 
	`hts_çoﬁ_de°roy
(
p
);

1170 
	`±hªad_joö
(
tid
, 
NULL
);

1173 
	}
}

1200 *
pùe_öput_thªad
(*
¨g
);

1201 *
pùe_°age1
(*
¨g
);

1202 *
pùe_°age2
(*
¨g
);

1203 *
pùe_°age3
(*
¨g
);

1204 *
pùe_ouçut_thªad
(*
¨g
);

1207 
hts_çoﬁ
 *
	mp
;

1208 
hts_çoﬁ_¥o˚ss
 *
	mq1
;

1209 
hts_çoﬁ_¥o˚ss
 *
	mq2
;

1210 
hts_çoﬁ_¥o˚ss
 *
	mq3
;

1211 
	mn
;

1212 } 
	tpùe_›t
;

1215 
pùe_›t
 *
	mo
;

1216 
	mx
;

1217 
	meof
;

1218 } 
	tpùe_job
;

1220 *
	$pùe_öput_thªad
(*
¨g
) {

1221 
pùe_›t
 *
o
 = (pùe_›à*)
¨g
;

1223 
i
;

1224 
i
 = 1; i <
o
->
n
; i++) {

1225 
pùe_job
 *
j
 = 
	`mÆloc
((*j));

1226 
j
->
o
 = o;

1227 
j
->
x
 = 
i
;

1228 
j
->
eof
 = (
i
 =
o
->
n
);

1230 
	`¥ötf
("I %08x\n", 
j
->
x
);

1232 i‡(
	`hts_çoﬁ_di•©ch
(
o
->
p
, o->
q1
, 
pùe_°age1
, 
j
) != 0) {

1233 
	`‰ì
(
j
);

1234 
	`±hªad_exô
((*)1);

1238 
	`±hªad_exô
(
NULL
);

1239 
	}
}

1241 *
	$pùe_°age1
(*
¨g
) {

1242 
pùe_job
 *
j
 = (pùe_job *)
¨g
;

1244 
j
->
x
 <<= 8;

1245 
	`u¶ìp
(
	`øndom
() % 10000);

1246 
	`¥ötf
("1 %08x\n", 
j
->
x
);

1248  
j
;

1249 
	}
}

1251 *
	$pùe_°age1to2
(*
¨g
) {

1252 
pùe_›t
 *
o
 = (pùe_›à*)
¨g
;

1253 
hts_çoﬁ_ªsu…
 *
r
;

1255 (
r
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
o
->
q1
))) {

1256 
pùe_job
 *
j
 = (pùe_job *)
r
->
d©a
;

1257 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

1258 i‡(
	`hts_çoﬁ_di•©ch
(
j
->
o
->
p
, j->o->
q2
, 
pùe_°age2
, j) != 0)

1259 
	`±hªad_exô
((*)1);

1260 i‡(
j
->
eof
)

1264 
	`±hªad_exô
(
NULL
);

1265 
	}
}

1267 *
	$pùe_°age2
(*
¨g
) {

1268 
pùe_job
 *
j
 = (pùe_job *)
¨g
;

1270 
j
->
x
 <<= 8;

1271 
	`u¶ìp
(
	`øndom
() % 100000);

1272 
	`¥ötf
("2 %08x\n", 
j
->
x
);

1274  
j
;

1275 
	}
}

1277 *
	$pùe_°age2to3
(*
¨g
) {

1278 
pùe_›t
 *
o
 = (pùe_›à*)
¨g
;

1279 
hts_çoﬁ_ªsu…
 *
r
;

1281 (
r
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
o
->
q2
))) {

1282 
pùe_job
 *
j
 = (pùe_job *)
r
->
d©a
;

1283 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 0);

1284 i‡(
	`hts_çoﬁ_di•©ch
(
j
->
o
->
p
, j->o->
q3
, 
pùe_°age3
, j) != 0)

1285 
	`±hªad_exô
((*)1);

1286 i‡(
j
->
eof
)

1290 
	`±hªad_exô
(
NULL
);

1291 
	}
}

1293 *
	$pùe_°age3
(*
¨g
) {

1294 
pùe_job
 *
j
 = (pùe_job *)
¨g
;

1296 
	`u¶ìp
(
	`øndom
() % 10000);

1297 
j
->
x
 <<= 8;

1298  
j
;

1299 
	}
}

1301 *
	$pùe_ouçut_thªad
(*
¨g
) {

1302 
pùe_›t
 *
o
 = (pùe_›à*)
¨g
;

1303 
hts_çoﬁ_ªsu…
 *
r
;

1305 (
r
 = 
	`hts_çoﬁ_√xt_ªsu…_waô
(
o
->
q3
))) {

1306 
pùe_job
 *
j
 = (pùe_job *)
r
->
d©a
;

1307 
eof
 = 
j
->eof;

1308 
	`¥ötf
("O %08x\n", 
j
->
x
);

1309 
	`hts_çoﬁ_dñëe_ªsu…
(
r
, 1);

1310 i‡(
eof
)

1314 
	`±hªad_exô
(
NULL
);

1315 
	}
}

1317 
	$ã°_pùe
(
n
) {

1318 
hts_çoﬁ
 *
p
 = 
	`hts_çoﬁ_öô
(
n
);

1319 
hts_çoﬁ_¥o˚ss
 *
q1
 = 
	`hts_çoﬁ_¥o˚ss_öô
(
p
, 
n
*2, 0);

1320 
hts_çoﬁ_¥o˚ss
 *
q2
 = 
	`hts_çoﬁ_¥o˚ss_öô
(
p
, 
n
*2, 0);

1321 
hts_çoﬁ_¥o˚ss
 *
q3
 = 
	`hts_çoﬁ_¥o˚ss_öô
(
p
, 
n
*2, 0);

1322 
pùe_›t
 
o
 = {
p
, 
q1
, 
q2
, 
q3
, 
TASK_SIZE
};

1323 
±hªad_t
 
tidIto1
, 
tid1to2
, 
tid2to3
, 
tid3toO
;

1324 *
ªtv
;

1325 
ªt
;

1328 
	`±hªad_¸óã
(&
tidIto1
, 
NULL
, 
pùe_öput_thªad
, &
o
);

1329 
	`±hªad_¸óã
(&
tid1to2
, 
NULL
, 
pùe_°age1to2
, &
o
);

1330 
	`±hªad_¸óã
(&
tid2to3
, 
NULL
, 
pùe_°age2to3
, &
o
);

1331 
	`±hªad_¸óã
(&
tid3toO
, 
NULL
, 
pùe_ouçut_thªad
, &
o
);

1334 
ªt
 = 0;

1335 
	`±hªad_joö
(
tidIto1
, &
ªtv
); 
ªt
 |‘ëv !
NULL
);

1336 
	`±hªad_joö
(
tid1to2
, &
ªtv
); 
ªt
 |‘ëv !
NULL
);

1337 
	`±hªad_joö
(
tid2to3
, &
ªtv
); 
ªt
 |‘ëv !
NULL
);

1338 
	`±hªad_joö
(
tid3toO
, &
ªtv
); 
ªt
 |‘ëv !
NULL
);

1339 
	`¥ötf
("Rëu∫ vÆuê%d\n", 
ªt
);

1341 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q1
);

1342 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q2
);

1343 
	`hts_çoﬁ_¥o˚ss_de°roy
(
q3
);

1344 
	`hts_çoﬁ_de°roy
(
p
);

1347 
	}
}

1350 
	$maö
(
¨gc
, **
¨gv
) {

1351 
n
;

1352 
	`§™dom
(0);

1354 i‡(
¨gc
 < 3) {

1355 
	`Ârötf
(
°dîr
, "Ußge: %†comm™dÇ_thªads\n", 
¨gv
[0]);

1356 
	`Ârötf
(
°dîr
, "Where commandsáre:\n\n");

1357 
	`Ârötf
(
°dîr
, "unordered # Unordered output\n");

1358 
	`Ârötf
(
°dîr
, "ordered1 # MainÅhread withÇon-block API\n");

1359 
	`Ârötf
(
°dîr
, "ordered2 # DispatchÅhread, blocking API\n");

1360 
	`Ârötf
(
°dîr
, "pipe # Multi-stageÖipeline, several queues\n");

1361 
	`exô
(1);

1364 
n
 = 
	`©oi
(
¨gv
[2]);

1365 i‡(
	`°rcmp
(
¨gv
[1], "un‹dîed"Ë=0Ë 
	`ã°_squ¨e_u
(
n
);

1366 i‡(
	`°rcmp
(
¨gv
[1], "‹dîed1"Ë=0Ë 
	`ã°_squ¨e
(
n
);

1367 i‡(
	`°rcmp
(
¨gv
[1], "‹dîed2"Ë=0Ë 
	`ã°_squ¨eB
(
n
);

1368 i‡(
	`°rcmp
(
¨gv
[1], "pùe"Ë=0Ë 
	`ã°_pùe
(
n
);

1370 
	`Ârötf
(
°dîr
, "Unknown sub-command\n");

1371 
	`exô
(1);

1372 
	}
}

	@htslib/thread_pool_internal.h

42 #i‚de‡
THREAD_POOL_INTERNAL_H


43 
	#THREAD_POOL_INTERNAL_H


	)

45 
	~<±hªad.h
>

46 
	~<°döt.h
>

47 
	~"ht¶ib/thªad_poﬁ.h
"

49 #ifde‡
__˝lu•lus


56 
	shts_çoﬁ_job
 {

57 *(*
func
)(*
¨g
);

58 *
¨g
;

59 
hts_çoﬁ_job
 *
√xt
;

61 
hts_çoﬁ
 *
p
;

62 
hts_çoﬁ_¥o˚ss
 *
q
;

63 
uöt64_t
 
£rül
;

64 } 
	thts_çoﬁ_job
;

69 
	shts_çoﬁ_ªsu…
 {

70 
hts_çoﬁ_ªsu…
 *
√xt
;

71 
uöt64_t
 
£rül
;

72 *
d©a
;

79 
hts_çoﬁ
 *
p
;

80 
idx
;

81 
±hªad_t
 
tid
;

82 
±hªad_c⁄d_t
 
≥ndög_c
;

83 } 
	thts_çoﬁ_w‹kî
;

97 
	shts_çoﬁ_¥o˚ss
 {

98 
hts_çoﬁ
 *
p
;

99 
hts_çoﬁ_job
 *
öput_hód
;

100 
hts_çoﬁ_job
 *
öput_èû
;

101 
hts_çoﬁ_ªsu…
 *
ouçut_hód
;

102 
hts_çoﬁ_ªsu…
 *
ouçut_èû
;

103 
qsize
;

104 
uöt64_t
 
√xt_£rül
;

105 
uöt64_t
 
cuº_£rül
;

107 
n_öput
;

108 
n_ouçut
;

109 
n_¥o˚ssög
;

111 
shutdown
;

112 
ö_⁄ly
;

113 
wake_di•©ch
;

115 
ªf_cou¡
;

117 
±hªad_c⁄d_t
 
ouçut_avaû_c
;

118 
±hªad_c⁄d_t
 
öput_nŸ_fuŒ_c
;

119 
±hªad_c⁄d_t
 
öput_em±y_c
;

120 
±hªad_c⁄d_t
 
n⁄e_¥o˚ssög_c
;

122 
hts_çoﬁ_¥o˚ss
 *
√xt
, *
¥ev
;

132 
	shts_çoﬁ
 {

133 
nwaôög
;

134 
njobs
;

135 
shutdown
;

140 
hts_çoﬁ_¥o˚ss
 *
q_hód
;

143 
tsize
;

144 
hts_çoﬁ_w‹kî
 *
t
;

146 *
t_°ack
, 
t_°ack_t›
;

149 
±hªad_muãx_t
 
poﬁ_m
;

154 
n_cou¡
, 
n_ru¬ög
;

158 
tŸÆ_time
, 
waô_time
;

161 #ifde‡
__˝lu•lus


	@htslib/vcf.c

27 
	~<c⁄fig.h
>

29 
	~<°dio.h
>

30 
	~<as£π.h
>

31 
	~<°rög.h
>

32 
	~<°rögs.h
>

33 
	~<°dlib.h
>

34 
	~<limôs.h
>

35 
	~<°döt.h
>

36 
	~<î∫o.h
>

38 
	~"ht¶ib/vcf.h
"

39 
	~"ht¶ib/bgzf.h
"

40 
	~"ht¶ib/tbx.h
"

41 
	~"ht¶ib/hfûe.h
"

42 
	~"hts_öã∫Æ.h
"

43 
	~"ht¶ib/hts_ídün.h
"

44 
	~"ht¶ib/khash_°r2öt.h
"

45 
	~"ht¶ib/k°rög.h
"

47 
	~"ht¶ib/khash.h
"

48 
	$KHASH_MAP_INIT_STR
(
vdi˘
, 
bcf_idöfo_t
)

49 
	$khash_t
(
	tvdi˘
Ë
	tvdi˘_t
;

51 
	~"ht¶ib/k£q.h
"

53 
uöt32_t
 
bcf_Êﬂt_missög
 = 0x7F800001;

54 
uöt32_t
 
bcf_Êﬂt_ve˘‹_íd
 = 0x7F800002;

55 
uöt8_t
 
bcf_ty≥_shi·
[] = { 0, 0, 1, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 
	}
};

56 
bcf_idöfo_t
 
	gbcf_idöfo_def
 = { .
öfo
 = { 15, 15, 15 }, .
	ghªc
 = { 
NULL
, NULL, NULL}, .
	gid
 = -1 };

58 c⁄° *
	$dump_ch¨
(*
buf„r
, 
c
)

60 
c
) {

61 '\n': 
	`°r˝y
(
buf„r
, "\\n"); ;

62 '\r': 
	`°r˝y
(
buf„r
, "\\r"); ;

63 '\t': 
	`°r˝y
(
buf„r
, "\\t"); ;

67 
	`•rötf
(
buf„r
, "\\%c", 
c
);

70 i‡(
	`i•röt_c
(
c
)Ë
	`•rötf
(
buf„r
, "%c", c);

71 
	`•rötf
(
buf„r
, "\\x%02X", (Ë
c
);

74  
buf„r
;

75 
	}
}

77 *
	$föd_chrom_hódî_löe
(*
s
)

79 *
∆
;

80 i‡(
	`°∫cmp
(
s
, "#CHROM\t", 7) == 0)  s;

81 i‡((
∆
 = 
	`°r°r
(
s
, "\n#CHROM\t")Ë!
NULL
) Çl+1;

82  
NULL
;

83 
	}
}

89 
	$bcf_hdr_add_ßm∂e
(
bcf_hdr_t
 *
h
, c⁄° *
s
)

91 i‡–!
s
 )  0;

93 c⁄° *
ss
 = 
s
;

94  !*
ss
 && 
	`is•a˚_c
(*ss) ) ss++;

95 i‡–!*
ss
 )

97 
	`Ârötf
(
°dîr
,"[E::%s] Em±y sam∂ê«me:Åøûög s∑˚s/èb†öÅhêhódîÜöe?\n", 
__func__
);

98 
	`ab‹t
();

101 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
BCF_DT_SAMPLE
];

102 
ªt
;

103 *
sdup
 = 
	`°rdup
(
s
);

104 
k
 = 
	`kh_put
(
vdi˘
, 
d
, 
sdup
, &
ªt
);

105 i‡(
ªt
) {

106 
	`kh_vÆ
(
d
, 
k
Ë
bcf_idöfo_def
;

107 
	`kh_vÆ
(
d
, 
k
).
id
 = 
	`kh_size
(d) - 1;

109 i‡(
hts_vîbo£
 >= 2)

111 
	`Ârötf
(
°dîr
, "[E::%s] Du∂iˇãd sam∂ê«mê'%s'\n", 
__func__
, 
s
);

112 
	`ab‹t
();

114 
	`‰ì
(
sdup
);

117 
n
 = 
	`kh_size
(
d
);

118 
h
->
ßm∂es
 = (**Ë
	`ªÆloc
(h->ßm∂es,(*)*
n
);

119 
h
->
ßm∂es
[
n
-1] = 
sdup
;

120 
h
->
dúty
 = 1;

122 
	}
}

124 
	$bcf_hdr_∑r£_ßm∂e_löe
(
bcf_hdr_t
 *
h
, c⁄° *
°r
)

126 
ªt
 = 0;

127 
i
 = 0;

128 c⁄° *
p
, *
q
;

130 
p
 = 
q
 = 
°r
;; ++q) {

131 i‡(*
q
 != '\t' && *q != 0 && *q != '\n') ;

132 i‡(++
i
 > 9) {

133 *
s
 = (*)
	`mÆloc
(
q
 - 
p
 + 1);

134 
	`°∫˝y
(
s
, 
p
, 
q
 -Ö);

135 
s
[
q
 - 
p
] = 0;

136 i‡–
	`bcf_hdr_add_ßm∂e
(
h
,
s
Ë< 0 ) 
ªt
 = -1;

137 
	`‰ì
(
s
);

139 i‡(*
q
 == 0 || *q == '\n') ;

140 
p
 = 
q
 + 1;

142 
	`bcf_hdr_add_ßm∂e
(
h
,
NULL
);

143  
ªt
;

144 
	}
}

146 
	$bcf_hdr_sync
(
bcf_hdr_t
 *
h
)

148 
i
;

149 
i
 = 0; i < 3; i++)

151 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
i
];

152 
khöt_t
 
k
;

153 i‡–
h
->
n
[
i
] < 
	`kh_size
(
d
) )

156 
h
->
n
[
i
] = 
	`kh_size
(
d
);

157 
h
->
id
[
i
] = (
bcf_id∑ú_t
*Ë
	`ªÆloc
(h->id[i], 
	`kh_size
(
d
)*(bcf_idpair_t));

159 
k
=
	`kh_begö
(
d
); k<
	`kh_íd
(d); k++)

161 i‡(!
	`kh_exi°
(
d
,
k
)) ;

162 
h
->
id
[
i
][
	`kh_vÆ
(
d
,
k
).id].
key
 = 
	`kh_key
(d,k);

163 
h
->
id
[
i
][
	`kh_vÆ
(
d
,
k
).id].
vÆ
 = &kh_val(d,k);

166 
h
->
dúty
 = 0;

168 
	}
}

170 
	$bcf_hªc_de°roy
(
bcf_hªc_t
 *
hªc
)

172 
	`‰ì
(
hªc
->
key
);

173 i‡–
hªc
->
vÆue
 ) 
	`‰ì
(hrec->value);

174 
i
;

175 
i
=0; i<
hªc
->
nkeys
; i++)

177 
	`‰ì
(
hªc
->
keys
[
i
]);

178 
	`‰ì
(
hªc
->
vÆs
[
i
]);

180 
	`‰ì
(
hªc
->
keys
);

181 
	`‰ì
(
hªc
->
vÆs
);

182 
	`‰ì
(
hªc
);

183 
	}
}

186 
bcf_hªc_t
 *
	$bcf_hªc_dup
(
bcf_hªc_t
 *
hªc
)

188 
bcf_hªc_t
 *
out
 = (bcf_hªc_t*Ë
	`ˇŒoc
(1,(bcf_hrec_t));

189 
out
->
ty≥
 = 
hªc
->type;

190 i‡–
hªc
->
key
 ) 
out
->key = 
	`°rdup
(hrec->key);

191 i‡–
hªc
->
vÆue
 ) 
out
->vÆuê
	`°rdup
(hrec->value);

192 
out
->
nkeys
 = 
hªc
->nkeys;

193 
out
->
keys
 = (**Ë
	`mÆloc
((*)*
hªc
->
nkeys
);

194 
out
->
vÆs
 = (**Ë
	`mÆloc
((*)*
hªc
->
nkeys
);

195 
i
, 
j
 = 0;

196 
i
=0; i<
hªc
->
nkeys
; i++)

198 i‡–
hªc
->
keys
[
i
] && !
	`°rcmp
("IDX",hrec->keys[i]) ) ;

199 i‡–
hªc
->
keys
[
i
] ) 
out
->keys[
j
] = 
	`°rdup
(hrec->keys[i]);

200 i‡–
hªc
->
vÆs
[
i
] ) 
out
->vÆs[
j
] = 
	`°rdup
(hrec->vals[i]);

201 
j
++;

203 i‡–
i
!=
j
 ) 
out
->
nkeys
 -= i-j;

204  
out
;

205 
	}
}

207 
	$bcf_hªc_debug
(
FILE
 *
Â
, 
bcf_hªc_t
 *
hªc
)

209 
	`Ârötf
(
Â
, "key=[%s] vÆue=[%s]", 
hªc
->
key
, hªc->
vÆue
?hrec->value:"");

210 
i
;

211 
i
=0; i<
hªc
->
nkeys
; i++)

212 
	`Ârötf
(
Â
, "\t[%s]=[%s]", 
hªc
->
keys
[
i
],hªc->
vÆs
[i]);

213 
	`Ârötf
(
Â
, "\n");

214 
	}
}

216 
	$bcf_hódî_debug
(
bcf_hdr_t
 *
hdr
)

218 
i
, 
j
;

219 
i
=0; i<
hdr
->
nhªc
; i++)

221 i‡–!
hdr
->
hªc
[
i
]->
vÆue
 )

223 
	`Ârötf
(
°dîr
, "##%s=<", 
hdr
->
hªc
[
i
]->
key
);

224 
	`Ârötf
(
°dîr
,"%s=%s", 
hdr
->
hªc
[
i
]->
keys
[0], hdr->hªc[i]->
vÆs
[0]);

225 
j
=1; j<
hdr
->
hªc
[
i
]->
nkeys
; j++)

226 
	`Ârötf
(
°dîr
,",%s=%s", 
hdr
->
hªc
[
i
]->
keys
[
j
], hdr->hªc[i]->
vÆs
[j]);

227 
	`Ârötf
(
°dîr
,">\n");

230 
	`Ârötf
(
°dîr
,"##%s=%s\n", 
hdr
->
hªc
[
i
]->
key
,hdr->hªc[i]->
vÆue
);

232 
	}
}

234 
	$bcf_hªc_add_key
(
bcf_hªc_t
 *
hªc
, c⁄° *
°r
, 
Àn
)

236 
n
 = ++
hªc
->
nkeys
;

237 
hªc
->
keys
 = (**Ë
	`ªÆloc
(hªc->keys, (*)*
n
);

238 
hªc
->
vÆs
 = (**Ë
	`ªÆloc
(hªc->vÆs, (*)*
n
);

239 
	`as£π
–
Àn
 );

240 
hªc
->
keys
[
n
-1] = (*Ë
	`mÆloc
((
Àn
+1)*());

241 
	`mem˝y
(
hªc
->
keys
[
n
-1],
°r
,
Àn
);

242 
hªc
->
keys
[
n
-1][
Àn
] = 0;

243 
hªc
->
vÆs
[
n
-1] = 
NULL
;

244 
	}
}

246 
	$bcf_hªc_£t_vÆ
(
bcf_hªc_t
 *
hªc
, 
i
, c⁄° *
°r
, 
Àn
, 
is_quŸed
)

248 i‡–!
°r
 ) { 
hªc
->
vÆs
[
i
] = 
NULL
; ; }

249 i‡–
hªc
->
vÆs
[
i
] ) 
	`‰ì
(hrec->vals[i]);

250 i‡–
is_quŸed
 )

252 
hªc
->
vÆs
[
i
] = (*Ë
	`mÆloc
((
Àn
+3)*());

253 
hªc
->
vÆs
[
i
][0] = '"';

254 
	`mem˝y
(&
hªc
->
vÆs
[
i
][1],
°r
,
Àn
);

255 
hªc
->
vÆs
[
i
][
Àn
+1] = '"';

256 
hªc
->
vÆs
[
i
][
Àn
+2] = 0;

260 
hªc
->
vÆs
[
i
] = (*Ë
	`mÆloc
((
Àn
+1)*());

261 
	`mem˝y
(
hªc
->
vÆs
[
i
],
°r
,
Àn
);

262 
hªc
->
vÆs
[
i
][
Àn
] = 0;

264 
	}
}

266 
	$hªc_add_idx
(
bcf_hªc_t
 *
hªc
, 
idx
)

268 
n
 = ++
hªc
->
nkeys
;

269 
hªc
->
keys
 = (**Ë
	`ªÆloc
(hªc->keys, (*)*
n
);

270 
hªc
->
vÆs
 = (**Ë
	`ªÆloc
(hªc->vÆs, (*)*
n
);

271 
hªc
->
keys
[
n
-1] = 
	`°rdup
("IDX");

272 
k°rög_t
 
°r
 = {0,0,0};

273 
	`kputw
(
idx
, &
°r
);

274 
hªc
->
vÆs
[
n
-1] = 
°r
.
s
;

275 
	}
}

277 
	$bcf_hªc_föd_key
(
bcf_hªc_t
 *
hªc
, c⁄° *
key
)

279 
i
;

280 
i
=0; i<
hªc
->
nkeys
; i++)

281 i‡–!
	`°rˇ£cmp
(
key
,
hªc
->
keys
[
i
]) )  i;

283 
	}
}

285 
ölöe
 
	$is_esˇ≥d
(c⁄° *
mö
, c⁄° *
°r
)

287 
n
 = 0;

288  --
°r
>=
mö
 && *°r=='\\' ) 
n
++;

289  
n
%2;

290 
	}
}

292 
bcf_hªc_t
 *
	$bcf_hdr_∑r£_löe
(c⁄° 
bcf_hdr_t
 *
h
, c⁄° *
löe
, *
Àn
)

294 c⁄° *
p
 = 
löe
;

295 i‡(
p
[0] !'#' ||Ö[1] !'#'Ë{ *
Àn
 = 0;  
NULL
; }

296 
p
 += 2;

298 c⁄° *
q
 = 
p
;

299  *
q
 && *q!='=' && *q != '\n' ) q++;

300 
n
 = 
q
-
p
;

301 i‡–*
q
!='=' || !
n
 ) { *
Àn
 = q-
löe
+1;  
NULL
; }

303 
bcf_hªc_t
 *
hªc
 = (bcf_hªc_t*Ë
	`ˇŒoc
(1,(bcf_hrec_t));

304 
hªc
->
key
 = (*Ë
	`mÆloc
(()*(
n
+1));

305 
	`mem˝y
(
hªc
->
key
,
p
,
n
);

306 
hªc
->
key
[
n
] = 0;

308 
p
 = ++
q
;

309 i‡–*
p
!='<' )

311  *
q
 && *q!='\n' ) q++;

312 
hªc
->
vÆue
 = (*Ë
	`mÆloc
((
q
-
p
+1)*());

313 
	`mem˝y
(
hªc
->
vÆue
, 
p
, 
q
-p);

314 
hªc
->
vÆue
[
q
-
p
] = 0;

315 *
Àn
 = 
q
 - 
löe
 + (*q ? 1 : 0);

316  
hªc
;

322 
n›í
 = 1;

323  *
q
 && *q!='\n' && 
n›í
>0 )

325 
p
 = ++
q
;

326  *
q
 && *q==' ' ) { 
p
++; q++; }

328 i‡(
p
==
q
 && *q && (
	`ißÕha_c
(*q) || *q=='_'))

330 
q
++;

331  *
q
 && (
	`iß um_c
(*q) || *q=='_' || *q=='.') ) q++;

333 
n
 = 
q
-
p
;

334 
m
 = 0;

335  *
q
 && *q==' ' ) { q++; 
m
++; }

336 i‡–*
q
!='=' || !
n
 )

339  *
q
 && *q!='\n' ) q++;

340 
	`Ârötf
(
°dîr
,"CouldÇotÖarseÅhe headerÜine: \"%.*s\"\n",

341 (Ë(
q
 - 
löe
),Üine);

342 *
Àn
 = 
q
 - 
löe
 + (*q ? 1 : 0);

343 
	`bcf_hªc_de°roy
(
hªc
);

344  
NULL
;

346 
	`bcf_hªc_add_key
(
hªc
, 
p
, 
q
-p-
m
);

347 
p
 = ++
q
;

348  *
q
 && *q==' ' ) { 
p
++; q++; }

349 
quŸed
 = *
p
=='"' ? 1 : 0;

350 i‡–
quŸed
 ) 
p
++, 
q
++;

351  *
q
 && *q != '\n' )

353 i‡–
quŸed
 ) { i‡–*
q
=='"' && !
	`is_esˇ≥d
(
p
,q) ) ; }

356 i‡–*
q
=='<' ) 
n›í
++;

357 i‡–*
q
=='>' ) 
n›í
--;

358 i‡–!
n›í
 ) ;

359 i‡–*
q
==',' && 
n›í
==1 ) ;

361 
q
++;

363 c⁄° *
r
 = 
q
;

364  
r
 > 
p
 &&Ñ[-1] == ' ' )Ñ--;

365 
	`bcf_hªc_£t_vÆ
(
hªc
, hªc->
nkeys
-1, 
p
, 
r
-p, 
quŸed
);

366 i‡–
quŸed
 && *
q
=='"' ) q++;

367 i‡–*
q
=='>' ) { 
n›í
--; q++; }

371 
n⁄•a˚
 = 0;

372 
p
 = 
q
;

373  *
q
 && *q!='\n' ) { 
n⁄•a˚
 |!
	`is•a˚
(*q); q++; }

374 i‡(
n⁄•a˚
 && 
hts_vîbo£
 > 2) {

375 
	`Ârötf
(
°dîr
,

377 
__func__
, (Ë(
q
 - 
löe
),Üine);

380 *
Àn
 = 
q
 - 
löe
 + (*q ? 1 : 0);

381  
hªc
;

382 
	}
}

384 
	$bcf_hdr_£t_idx
(
bcf_hdr_t
 *
hdr
, 
di˘_ty≥
, c⁄° *
èg
, 
bcf_idöfo_t
 *
idöfo
)

387 i‡–
idöfo
->
id
==-1 )

388 
idöfo
->
id
 = 
hdr
->
n
[
di˘_ty≥
]++;

389 i‡–
idöfo
->
id
 < 
hdr
->
n
[
di˘_ty≥
] && hdr->id[di˘_ty≥][idöfo->id].
key
 )

391 
	`Ârötf
(
°dîr
,"[%s:%d %s] C⁄Êi˘ög IDX=%dÜöe†öÅhêhódî di˘i⁄¨y,Åhê√wÅag i†%s\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
, 
idöfo
->
id
, 
èg
);

392 
	`exô
(1);

395 i‡–
idöfo
->
id
 >
hdr
->
n
[
di˘_ty≥
] ) hdr->n[dict_type] = idinfo->id+1;

396 
	`hts_ex∑nd0
(
bcf_id∑ú_t
,
hdr
->
n
[
di˘_ty≥
],hdr->
m
[di˘_ty≥],hdr->
id
[dict_type]);

400 
hdr
->
id
[
di˘_ty≥
][
idöfo
->id].
key
 = 
èg
;

403 
	}
}

406 
	$bcf_hdr_ªgi°î_hªc
(
bcf_hdr_t
 *
hdr
, 
bcf_hªc_t
 *
hªc
)

409 
i
,
j
, 
ªt
;

410 
khöt_t
 
k
;

411 *
°r
;

412 i‡–!
	`°rcmp
(
hªc
->
key
, "contig") )

414 
hªc
->
ty≥
 = 
BCF_HL_CTG
;

417 
i
 = 
	`bcf_hªc_föd_key
(
hªc
,"length");

418 i‡–
i
<0 ) 
j
 = 0;

419 i‡–
	`ssˇnf
(
hªc
->
vÆs
[
i
],"%d",&
j
)!=1 )  0;

421 
i
 = 
	`bcf_hªc_föd_key
(
hªc
,"ID");

422 i‡–
i
<0 )  0;

423 
°r
 = 
	`°rdup
(
hªc
->
vÆs
[
i
]);

426 
vdi˘_t
 *
d
 = (vdi˘_t*)
hdr
->
di˘
[
BCF_DT_CTG
];

427 
khöt_t
 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
°r
);

428 i‡–
k
 !
	`kh_íd
(
d
ËË{ 
	`‰ì
(
°r
);  0; }

429 
k
 = 
	`kh_put
(
vdi˘
, 
d
, 
°r
, &
ªt
);

431 
idx
 = 
	`bcf_hªc_föd_key
(
hªc
,"IDX");

432 i‡–
idx
!=-1 )

434 *
tmp
 = 
hªc
->
vÆs
[
idx
];

435 
idx
 = 
	`°πﬁ
(
hªc
->
vÆs
[idx], &
tmp
, 10);

436 i‡–*
tmp
 || 
idx
 < 0 || idx >
INT_MAX
 - 1)

438 
	`Ârötf
(
°dîr
,"[%s:%d %s] Eº‹Ö¨sögÅhêIDXÅag, skùpög.\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

443 
	`kh_vÆ
(
d
, 
k
Ë
bcf_idöfo_def
;

444 
	`kh_vÆ
(
d
, 
k
).
id
 = 
idx
;

445 
	`kh_vÆ
(
d
, 
k
).
öfo
[0] = 
j
;

446 
	`kh_vÆ
(
d
, 
k
).
hªc
[0] = hrec;

447 
	`bcf_hdr_£t_idx
(
hdr
, 
BCF_DT_CTG
, 
	`kh_key
(
d
,
k
), &
	`kh_vÆ
(d,k));

448 i‡–
idx
==-1 ) 
	`hªc_add_idx
(
hªc
, 
	`kh_vÆ
(
d
,
k
).
id
);

453 i‡–!
	`°rcmp
(
hªc
->
key
, "INFO"ËËhªc->
ty≥
 = 
BCF_HL_INFO
;

454 i‡–!
	`°rcmp
(
hªc
->
key
, "FILTER"ËËhªc->
ty≥
 = 
BCF_HL_FLT
;

455 i‡–!
	`°rcmp
(
hªc
->
key
, "FORMAT"ËËhªc->
ty≥
 = 
BCF_HL_FMT
;

456 i‡–
hªc
->
nkeys
>0 ) { hªc->
ty≥
 = 
BCF_HL_STR
;  1; }

460 *
id
 = 
NULL
;

461 
uöt32_t
 
ty≥
 = -1, 
v¨
 = -1;

462 
num
 = -1, 
idx
 = -1;

463 
i
=0; i<
hªc
->
nkeys
; i++)

465 i‡–!
	`°rcmp
(
hªc
->
keys
[
i
], "ID"ËË
id
 = hªc->
vÆs
[i];

466 i‡–!
	`°rcmp
(
hªc
->
keys
[
i
], "IDX") )

468 *
tmp
 = 
hªc
->
vÆs
[
i
];

469 
idx
 = 
	`°πﬁ
(
hªc
->
vÆs
[
i
], &
tmp
, 10);

470 i‡–*
tmp
 || 
idx
 < 0 || idx >
INT_MAX
 - 1)

472 
	`Ârötf
(
°dîr
,"[%s:%d %s] Eº‹Ö¨sögÅhêIDXÅag, skùpög.\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

476 i‡–!
	`°rcmp
(
hªc
->
keys
[
i
], "Type") )

478 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
], "I¡egî"ËË
ty≥
 = 
BCF_HT_INT
;

479 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
], "Flﬂt"ËË
ty≥
 = 
BCF_HT_REAL
;

480 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
], "Såög"ËË
ty≥
 = 
BCF_HT_STR
;

481 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
], "Ch¨a˘î"ËË
ty≥
 = 
BCF_HT_STR
;

482 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
], "Fœg"ËË
ty≥
 = 
BCF_HT_FLAG
;

485 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[E::%s] Thêty≥ \"%s\" i†nŸ suµ‹ãd,ássumög \"Såög\"\n", 
__func__
, 
hªc
->
vÆs
[
i
]);

486 
ty≥
 = 
BCF_HT_STR
;

489 i‡–!
	`°rcmp
(
hªc
->
keys
[
i
], "Number") )

491 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
],"A"ËË
v¨
 = 
BCF_VL_A
;

492 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
],"R"ËË
v¨
 = 
BCF_VL_R
;

493 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
],"G"ËË
v¨
 = 
BCF_VL_G
;

494 i‡–!
	`°rcmp
(
hªc
->
vÆs
[
i
],"."ËË
v¨
 = 
BCF_VL_VAR
;

497 
	`ssˇnf
(
hªc
->
vÆs
[
i
],"%d",&
num
);

498 
v¨
 = 
BCF_VL_FIXED
;

500 i‡(
v¨
 !
BCF_VL_FIXED
Ë
num
 = 0xfffff;

503 
uöt32_t
 
öfo
 = ((((uöt32_t)
num
) & 0xfffff)<<12 |

504 (
v¨
 & 0xf) << 8 |

505 (
ty≥
 & 0xf) << 4 |

506 (((
uöt32_t
Ë
hªc
->
ty≥
) & 0xf));

508 i‡–!
id
 )  0;

509 
°r
 = 
	`°rdup
(
id
);

511 
vdi˘_t
 *
d
 = (vdi˘_t*)
hdr
->
di˘
[
BCF_DT_ID
];

512 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
°r
);

513 i‡–
k
 !
	`kh_íd
(
d
) )

516 
	`‰ì
(
°r
);

517 i‡–
	`kh_vÆ
(
d
, 
k
).
hªc
[
öfo
&0xf] )  0;

518 
	`kh_vÆ
(
d
, 
k
).
öfo
[info&0xf] = info;

519 
	`kh_vÆ
(
d
, 
k
).
hªc
[
öfo
&0xf] = hrec;

520 i‡–
idx
==-1 ) 
	`hªc_add_idx
(
hªc
, 
	`kh_vÆ
(
d
, 
k
).
id
);

523 
k
 = 
	`kh_put
(
vdi˘
, 
d
, 
°r
, &
ªt
);

524 
	`kh_vÆ
(
d
, 
k
Ë
bcf_idöfo_def
;

525 
	`kh_vÆ
(
d
, 
k
).
öfo
[info&0xf] = info;

526 
	`kh_vÆ
(
d
, 
k
).
hªc
[
öfo
&0xf] = hrec;

527 
	`kh_vÆ
(
d
, 
k
).
id
 = 
idx
;

528 
	`bcf_hdr_£t_idx
(
hdr
, 
BCF_DT_ID
, 
	`kh_key
(
d
,
k
), &
	`kh_vÆ
(d,k));

529 i‡–
idx
==-1 ) 
	`hªc_add_idx
(
hªc
, 
	`kh_vÆ
(
d
,
k
).
id
);

532 
	}
}

534 
	$bcf_hdr_add_hªc
(
bcf_hdr_t
 *
hdr
, 
bcf_hªc_t
 *
hªc
)

536 i‡–!
hªc
 )  0;

538 
hªc
->
ty≥
 = 
BCF_HL_GEN
;

539 i‡–!
	`bcf_hdr_ªgi°î_hªc
(
hdr
,
hªc
) )

542 i‡–
hªc
->
ty≥
 !
BCF_HL_GEN
 )

544 
	`bcf_hªc_de°roy
(
hªc
);

549 
i
;

550 
i
=0; i<
hdr
->
nhªc
; i++)

552 i‡–
hdr
->
hªc
[
i
]->
ty≥
!=
BCF_HL_GEN
 ) ;

553 i‡–!
	`°rcmp
(
hdr
->
hªc
[
i
]->
key
,hrec->key) && !strcmp(hrec->key,"fileformat") ) ;

554 i‡–!
	`°rcmp
(
hdr
->
hªc
[
i
]->
key
,hªc->keyË&& !°rcmp(hdr->hªc[i]->
vÆue
,hrec->value) ) ;

556 i‡–
i
<
hdr
->
nhªc
 )

558 
	`bcf_hªc_de°roy
(
hªc
);

564 
n
 = ++
hdr
->
nhªc
;

565 
hdr
->
hªc
 = (
bcf_hªc_t
**Ë
	`ªÆloc
(hdr->hªc, 
n
*(bcf_hrec_t*));

566 
hdr
->
hªc
[
n
-1] = hrec;

567 
hdr
->
dúty
 = 1;

569  
hªc
->
ty≥
==
BCF_HL_GEN
 ? 0 : 1;

570 
	}
}

578 
bcf_hªc_t
 *
	$bcf_hdr_gë_hªc
(c⁄° 
bcf_hdr_t
 *
hdr
, 
ty≥
, c⁄° *
key
, c⁄° *
vÆue
, c⁄° *
°r_˛ass
)

580 
i
;

581 i‡–
ty≥
==
BCF_HL_GEN
 )

583 
i
=0; i<
hdr
->
nhªc
; i++)

585 i‡–
hdr
->
hªc
[
i
]->
ty≥
!=type ) ;

586 i‡–
	`°rcmp
(
hdr
->
hªc
[
i
]->
key
,key) ) ;

587 i‡–!
vÆue
 || !
	`°rcmp
(
hdr
->
hªc
[
i
]->value,value) )  hdr->hrec[i];

589  
NULL
;

591 i‡–
ty≥
==
BCF_HL_STR
 )

593 
i
=0; i<
hdr
->
nhªc
; i++)

595 i‡–
hdr
->
hªc
[
i
]->
ty≥
!=type ) ;

596 i‡–
	`°rcmp
(
hdr
->
hªc
[
i
]->
key
,
°r_˛ass
) ) ;

597 
j
 = 
	`bcf_hªc_föd_key
(
hdr
->
hªc
[
i
],
key
);

598 i‡–
j
>=0 && !
	`°rcmp
(
hdr
->
hªc
[
i
]->
vÆs
[j],
vÆue
) )  hdr->hrec[i];

600  
NULL
;

602 
vdi˘_t
 *
d
 = 
ty≥
==
BCF_HL_CTG
 ? (vdi˘_t*)
hdr
->
di˘
[
BCF_DT_CTG
] : (vdi˘_t*)hdr->di˘[
BCF_DT_ID
];

603 
khöt_t
 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
vÆue
);

604 i‡–
k
 =
	`kh_íd
(
d
ËË 
NULL
;

605  
	`kh_vÆ
(
d
, 
k
).
hªc
[
ty≥
==
BCF_HL_CTG
?0:type];

606 
	}
}

608 
	$bcf_hdr_check_ßnôy
(
bcf_hdr_t
 *
hdr
)

610 
PL_w¨√d
 = 0, 
GL_w¨√d
 = 0;

612 i‡–!
PL_w¨√d
 )

614 
id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, "PL");

615 i‡–
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FMT
,
id
Ë&& 
	`bcf_hdr_id2Àngth
(hdr,BCF_HL_FMT,id)!=
BCF_VL_G
 )

617 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
,"[W::%s] PL should bêde˛¨edá†Numbî=G\n", 
__func__
);

618 
PL_w¨√d
 = 1;

621 i‡–!
GL_w¨√d
 )

623 
id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, "GL");

624 i‡–
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FMT
,
id
Ë&& 
	`bcf_hdr_id2Àngth
(hdr,BCF_HL_FMT,id)!=
BCF_VL_G
 )

626 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
,"[W::%s] GL should bêde˛¨edá†Numbî=G\n", 
__func__
);

627 
GL_w¨√d
 = 1;

630 
	}
}

632 
	$bcf_hdr_∑r£
(
bcf_hdr_t
 *
hdr
, *
htxt
)

634 
Àn
, 
√eds_sync
 = 0, 
d⁄e
 = 0;

635 *
p
 = 
htxt
;

638 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
hdr
,
p
,&
Àn
);

639 i‡–!
hªc
 || !hªc->
key
 || 
	`°rˇ£cmp
(hrec->key,"fileformat") )

640 
	`Ârötf
(
°dîr
, "[W::%s] Thêfú°Üöêshould bê##fûef‹m©; i†thêVCF/BCF hódî brokí?\n", 
__func__
);

641 
√eds_sync
 +
	`bcf_hdr_add_hªc
(
hdr
, 
hªc
);

644 
hªc
 = 
	`bcf_hdr_∑r£_löe
(
hdr
,"##FILTER=<ID=PASS,Des¸ùti⁄=\"AŒ fûãr†∑s£d\">",&
Àn
);

645 
√eds_sync
 +
	`bcf_hdr_add_hªc
(
hdr
, 
hªc
);

649 
NULL
 !(
hªc
 = 
	`bcf_hdr_∑r£_löe
(
hdr
, 
p
, &
Àn
))) {

650 
√eds_sync
 +
	`bcf_hdr_add_hªc
(
hdr
, 
hªc
);

651 
p
 +
Àn
;

659 i‡–
	`°∫cmp
("#CHROM\tPOS",
p
,10) != 0 ) {

660 *
eﬁ
 = 
	`°rchr
(
p
, '\n');

661 i‡(
hts_vîbo£
 >2 && *
p
 != '\0')

662 
	`Ârötf
(
°dîr
,

664 
__func__
, 
eﬁ
 ? (Ë”ﬁ - 
p
Ë: 
INT_MAX
,Ö);

665 i‡(
eﬁ
) {

666 
p
 = 
eﬁ
 + 1;

668 
d⁄e
 = -1;

671 
d⁄e
 = 1;

673 } !
d⁄e
);

675 i‡(
d⁄e
 < 0) {

677 i‡(
hts_vîbo£
 >= 1)

678 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇotÖarseÅhe header, "

679 "ßm∂êlöênŸ found\n", 
__func__
);

683 
ªt
 = 
	`bcf_hdr_∑r£_ßm∂e_löe
(
hdr
,
p
);

684 
	`bcf_hdr_sync
(
hdr
);

685 
	`bcf_hdr_check_ßnôy
(
hdr
);

686  
ªt
;

687 
	}
}

689 
	$bcf_hdr_≠≥nd
(
bcf_hdr_t
 *
hdr
, c⁄° *
löe
)

691 
Àn
;

692 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
hdr
, (*Ë
löe
, &
Àn
);

693 i‡–!
hªc
 )  -1;

694 
	`bcf_hdr_add_hªc
(
hdr
, 
hªc
);

696 
	}
}

698 
	$bcf_hdr_ªmove
(
bcf_hdr_t
 *
hdr
, 
ty≥
, c⁄° *
key
)

700 
i
 = 0;

701 
bcf_hªc_t
 *
hªc
;

702 i‡–!
key
 )

704  
i
<
hdr
->
nhªc
 )

706 i‡–
hdr
->
hªc
[
i
]->
ty≥
!=type ) { i++; ; }

707 
hªc
 = 
hdr
->hªc[
i
];

709 i‡–
ty≥
==
BCF_HL_FLT
 ||Åy≥==
BCF_HL_INFO
 ||Åy≥==
BCF_HL_FMT
 ||Åy≥=
BCF_HL_CTG
 )

711 
j
 = 
	`bcf_hªc_föd_key
(
hdr
->
hªc
[
i
], "ID");

712 i‡–
j
>=0 )

714 
vdi˘_t
 *
d
 = 
ty≥
==
BCF_HL_CTG
 ? (vdi˘_t*)
hdr
->
di˘
[
BCF_DT_CTG
] : (vdi˘_t*)hdr->di˘[
BCF_DT_ID
];

715 
khöt_t
 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
hdr
->
hªc
[
i
]->
vÆs
[
j
]);

716 
	`kh_vÆ
(
d
, 
k
).
hªc
[
ty≥
==
BCF_HL_CTG
?0:ty≥] = 
NULL
;

720 
hdr
->
dúty
 = 1;

721 
hdr
->
nhªc
--;

722 i‡–
i
 < 
hdr
->
nhªc
 )

723 
	`memmove
(&
hdr
->
hªc
[
i
],&hdr->hªc[i+1],(hdr->
nhªc
-i)*(
bcf_hªc_t
*));

724 
	`bcf_hªc_de°roy
(
hªc
);

730 i‡–
ty≥
==
BCF_HL_FLT
 ||Åy≥==
BCF_HL_INFO
 ||Åy≥==
BCF_HL_FMT
 ||Åy≥=
BCF_HL_CTG
 )

732 
hªc
 = 
	`bcf_hdr_gë_hªc
(
hdr
, 
ty≥
, "ID", 
key
, 
NULL
);

733 i‡–!
hªc
 ) ;

735 
i
=0; i<
hdr
->
nhªc
; i++)

736 i‡–
hdr
->
hªc
[
i
]==hrec ) ;

737 
	`as£π
–
i
<
hdr
->
nhªc
 );

739 
vdi˘_t
 *
d
 = 
ty≥
==
BCF_HL_CTG
 ? (vdi˘_t*)
hdr
->
di˘
[
BCF_DT_CTG
] : (vdi˘_t*)hdr->di˘[
BCF_DT_ID
];

740 
khöt_t
 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
key
);

741 
	`kh_vÆ
(
d
, 
k
).
hªc
[
ty≥
==
BCF_HL_CTG
?0:ty≥] = 
NULL
;

745 
i
=0; i<
hdr
->
nhªc
; i++)

747 i‡–
hdr
->
hªc
[
i
]->
ty≥
!=type ) ;

748 i‡–
ty≥
==
BCF_HL_GEN
 )

750 i‡–!
	`°rcmp
(
hdr
->
hªc
[
i
]->
key
,key) ) ;

755 
j
 = 
	`bcf_hªc_föd_key
(
hdr
->
hªc
[
i
], "ID");

756 i‡–
j
>=0 && !
	`°rcmp
(
hdr
->
hªc
[
i
]->
vÆs
[j],
key
) ) ;

759 i‡–
i
==
hdr
->
nhªc
 ) ;

760 
hªc
 = 
hdr
->hªc[
i
];

763 
hdr
->
nhªc
--;

764 i‡–
i
 < 
hdr
->
nhªc
 )

765 
	`memmove
(&
hdr
->
hªc
[
i
],&hdr->hªc[i+1],(hdr->
nhªc
-i)*(
bcf_hªc_t
*));

766 
	`bcf_hªc_de°roy
(
hªc
);

767 
hdr
->
dúty
 = 1;

769 
	}
}

771 
	$bcf_hdr_¥ötf
(
bcf_hdr_t
 *
hdr
, c⁄° *
fmt
, ...)

773 
va_li°
 
≠
;

774 
	`va_°¨t
(
≠
, 
fmt
);

775 
n
 = 
	`v¢¥ötf
(
NULL
, 0, 
fmt
, 
≠
) + 2;

776 
	`va_íd
(
≠
);

778 *
löe
 = (*)
	`mÆloc
(
n
);

779 
	`va_°¨t
(
≠
, 
fmt
);

780 
	`v¢¥ötf
(
löe
, 
n
, 
fmt
, 
≠
);

781 
	`va_íd
(
≠
);

783 
ªt
 = 
	`bcf_hdr_≠≥nd
(
hdr
, 
löe
);

785 
	`‰ì
(
löe
);

786  
ªt
;

787 
	}
}

794 c⁄° *
	$bcf_hdr_gë_vîsi⁄
(c⁄° 
bcf_hdr_t
 *
hdr
)

796 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_gë_hªc
(
hdr
, 
BCF_HL_GEN
, "fûef‹m©", 
NULL
, NULL);

797 i‡–!
hªc
 )

799 
	`Ârötf
(
°dîr
,"No version string found,ássuming VCFv4.2\n");

802  
hªc
->
vÆue
;

803 
	}
}

805 
	$bcf_hdr_£t_vîsi⁄
(
bcf_hdr_t
 *
hdr
, c⁄° *
vîsi⁄
)

807 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_gë_hªc
(
hdr
, 
BCF_HL_GEN
, "fûef‹m©", 
NULL
, NULL);

808 i‡–!
hªc
 )

810 
Àn
;

811 
k°rög_t
 
°r
 = {0,0,0};

812 
	`k•rötf
(&
°r
,"##fûef‹m©=%s", 
vîsi⁄
);

813 
hªc
 = 
	`bcf_hdr_∑r£_löe
(
hdr
, 
°r
.
s
, &
Àn
);

814 
	`‰ì
(
°r
.
s
);

818 
	`‰ì
(
hªc
->
vÆue
);

819 
hªc
->
vÆue
 = 
	`°rdup
(
vîsi⁄
);

821 
hdr
->
dúty
 = 1;

822 
	}
}

824 
bcf_hdr_t
 *
	$bcf_hdr_öô
(c⁄° *
mode
)

826 
i
;

827 
bcf_hdr_t
 *
h
;

828 
h
 = (
bcf_hdr_t
*)
	`ˇŒoc
(1, (bcf_hdr_t));

829 i‡(!
h
Ë 
NULL
;

830 
i
 = 0; i < 3; ++i)

831 i‡((
h
->
di˘
[
i
] = 
	`kh_öô
(
vdi˘
)Ë=
NULL
Ë
Áû
;

832 i‡–
	`°rchr
(
mode
,'w') )

834 
	`bcf_hdr_≠≥nd
(
h
, "##fileformat=VCFv4.2");

836 
	`bcf_hdr_≠≥nd
(
h
, "##FILTER=<ID=PASS,Description=\"All filtersÖassed\">");

838  
h
;

840 
Áû
:

841 
i
 = 0; i < 3; ++i)

842 
	`kh_de°roy
(
vdi˘
, 
h
->
di˘
[
i
]);

843 
	`‰ì
(
h
);

844  
NULL
;

845 
	}
}

847 
	$bcf_hdr_de°roy
(
bcf_hdr_t
 *
h
)

849 
i
;

850 
khöt_t
 
k
;

851 i‡(!
h
) ;

852 
i
 = 0; i < 3; ++i) {

853 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
i
];

854 i‡(
d
 == 0) ;

855 
k
 = 
	`kh_begö
(
d
); k !
	`kh_íd
(d); ++k)

856 i‡(
	`kh_exi°
(
d
, 
k
)Ë
	`‰ì
((*)
	`kh_key
(d, k));

857 
	`kh_de°roy
(
vdi˘
, 
d
);

858 
	`‰ì
(
h
->
id
[
i
]);

860 
i
=0; i<
h
->
nhªc
; i++)

861 
	`bcf_hªc_de°roy
(
h
->
hªc
[
i
]);

862 i‡(
h
->
nhªc
Ë
	`‰ì
(h->
hªc
);

863 i‡(
h
->
ßm∂es
Ë
	`‰ì
(h->samples);

864 
	`‰ì
(
h
->
kìp_ßm∂es
);

865 
	`‰ì
(
h
->
å™¶
[0]); free(h->transl[1]);

866 
	`‰ì
(
h
->
mem
.
s
);

867 
	`‰ì
(
h
);

868 
	}
}

870 
bcf_hdr_t
 *
	$bcf_hdr_ªad
(
htsFûe
 *
hÂ
)

872 i‡(
hÂ
->
f‹m©
.f‹m© =
vcf
)

873  
	`vcf_hdr_ªad
(
hÂ
);

874 i‡(
hÂ
->
f‹m©
.f‹m© !
bcf
) {

875 
	`Ârötf
(
°dîr
, "[E::%s] Input isÇot detectedás bcf or vcf format\n",

876 
__func__
);

877  
NULL
;

880 
	`as£π
(
hÂ
->
is_bgzf
);

882 
BGZF
 *
Â
 = 
hÂ
->Â.
bgzf
;

883 
uöt8_t
 
magic
[5];

884 
bcf_hdr_t
 *
h
;

885 
h
 = 
	`bcf_hdr_öô
("r");

886 i‡(!
h
) {

887 
	`Ârötf
(
°dîr
, "[E::%s] faûedÅÿÆloˇã bc‡hódî\n", 
__func__
);

888  
NULL
;

890 i‡(
	`bgzf_ªad
(
Â
, 
magic
, 5) != 5)

892 
	`Ârötf
(
°dîr
,"[%s:%d %s] FaûedÅÿªadÅhêhódî (ªadög BCF i¿ãxàmode?)\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

893 
	`bcf_hdr_de°roy
(
h
);

894  
NULL
;

896 i‡(
	`°∫cmp
((*)
magic
, "BCF\2\2", 5) != 0)

898 i‡(!
	`°∫cmp
((*)
magic
, "BCF", 3))

899 
	`Ârötf
(
°dîr
,"[%s:%d %s] invÆid BCF2 magi¯°rög: o∆y BCFv2.2 i†suµ‹ãd.\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

900 i‡(
hts_vîbo£
 >= 2)

901 
	`Ârötf
(
°dîr
, "[E::%s] invÆid BCF2 magi¯°rög\n", 
__func__
);

902 
	`bcf_hdr_de°roy
(
h
);

903  
NULL
;

905 
uöt8_t
 
buf
[4];

906 
size_t
 
hÀn
;

907 *
htxt
 = 
NULL
;

908 i‡(
	`bgzf_ªad
(
Â
, 
buf
, 4Ë!4Ë
Áû
;

909 
hÀn
 = 
buf
[0] | (buf[1] << 8) | (buf[2] << 16) | (buf[3] << 24);

910 i‡(
hÀn
 >
SIZE_MAX
Ë{ 
î∫o
 = 
ENOMEM
; 
Áû
; }

911 
htxt
 = (*)
	`mÆloc
(
hÀn
 + 1);

912 i‡(!
htxt
Ë
Áû
;

913 i‡(
	`bgzf_ªad
(
Â
, 
htxt
, 
hÀn
Ë!hÀnË
Áû
;

914 
htxt
[
hÀn
] = '\0';

915 i‡–
	`bcf_hdr_∑r£
(
h
, 
htxt
Ë< 0 ) 
Áû
;

916 
	`‰ì
(
htxt
);

917  
h
;

918 
Áû
:

919 i‡(
hts_vîbo£
 >= 2) {

920 
	`Ârötf
(
°dîr
, "[E::%s] faûedÅÿªad BCF hódî\n", 
__func__
);

922 
	`‰ì
(
htxt
);

923 
	`bcf_hdr_de°roy
(
h
);

924  
NULL
;

925 
	}
}

927 
	$bcf_hdr_wrôe
(
htsFûe
 *
hÂ
, 
bcf_hdr_t
 *
h
)

929 i‡–
h
->
dúty
 ) 
	`bcf_hdr_sync
(h);

930 i‡(
hÂ
->
f‹m©
.f‹m© =
vcf
 || hÂ->f‹m©.f‹m© =
ãxt_f‹m©
)

931  
	`vcf_hdr_wrôe
(
hÂ
, 
h
);

933 
k°rög_t
 
htxt
 = {0,0,0};

934 
	`bcf_hdr_f‹m©
(
h
, 1, &
htxt
);

935 
	`kputc
('\0', &
htxt
);

937 
BGZF
 *
Â
 = 
hÂ
->Â.
bgzf
;

938 i‡–
	`bgzf_wrôe
(
Â
, "BCF\2\2", 5) !=5 )  -1;

939 
uöt8_t
 
hÀn
[4];

940 
	`u32_to_À
(
htxt
.
l
, 
hÀn
);

941 i‡–
	`bgzf_wrôe
(
Â
, 
hÀn
, 4) !=4 )  -1;

942 i‡–
	`bgzf_wrôe
(
Â
, 
htxt
.
s
, htxt.
l
) != htxt.l )  -1;

944 
	`‰ì
(
htxt
.
s
);

946 
	}
}

952 
bcf1_t
 *
	$bcf_öô
()

954 
bcf1_t
 *
v
;

955 
v
 = (
bcf1_t
*)
	`ˇŒoc
(1, (bcf1_t));

956  
v
;

957 
	}
}

959 
	$bcf_˛ór
(
bcf1_t
 *
v
)

961 
i
;

962 
i
=0; i<
v
->
d
.
m_öfo
; i++)

964 i‡–
v
->
d
.
öfo
[
i
].
v±r_‰ì
 )

966 
	`‰ì
(
v
->
d
.
öfo
[
i
].
v±r
 - v->d.öfo[i].
v±r_off
);

967 
v
->
d
.
öfo
[
i
].
v±r_‰ì
 = 0;

970 
i
=0; i<
v
->
d
.
m_fmt
; i++)

972 i‡–
v
->
d
.
fmt
[
i
].
p_‰ì
 )

974 
	`‰ì
(
v
->
d
.
fmt
[
i
].
p
 - v->d.fmt[i].
p_off
);

975 
v
->
d
.
fmt
[
i
].
p_‰ì
 = 0;

978 
v
->
rid
 = v->
pos
 = v->
æí
 = v->
u≈acked
 = 0;

979 
	`bcf_Êﬂt_£t_missög
(
v
->
quÆ
);

980 
v
->
n_öfo
 = v->
n_ÆÀÀ
 = v->
n_fmt
 = v->
n_ßm∂e
 = 0;

981 
v
->
sh¨ed
.
l
 = v->
ödiv
.l = 0;

982 
v
->
d
.
v¨_ty≥
 = -1;

983 
v
->
d
.
sh¨ed_dúty
 = 0;

984 
v
->
d
.
ödiv_dúty
 = 0;

985 
v
->
d
.
n_Êt
 = 0;

986 
v
->
îrcode
 = 0;

987 i‡(
v
->
d
.
m_Æs
Ëv->d.
Æs
[0] = 0;

988 i‡(
v
->
d
.
m_id
Ëv->d.
id
[0] = 0;

989 
	}
}

991 
	$bcf_em±y
(
bcf1_t
 *
v
)

993 
	`bcf_˛ór1
(
v
);

994 
	`‰ì
(
v
->
d
.
id
);

995 
	`‰ì
(
v
->
d
.
Æs
);

996 
	`‰ì
(
v
->
d
.
ÆÀÀ
); fªe(v->d.
Êt
); fªe(v->d.
öfo
); fªe(v->d.
fmt
);

997 i‡(
v
->
d
.
v¨
 ) 
	`‰ì
(v->d.var);

998 
	`‰ì
(
v
->
sh¨ed
.
s
); fªe(v->
ödiv
.s);

999 
	}
}

1001 
	$bcf_de°roy
(
bcf1_t
 *
v
)

1003 i‡(!
v
) ;

1004 
	`bcf_em±y1
(
v
);

1005 
	`‰ì
(
v
);

1006 
	}
}

1008 
ölöe
 
	$bcf_ªad1_c‹e
(
BGZF
 *
Â
, 
bcf1_t
 *
v
)

1010 
uöt32_t
 
x
[8];

1011 
ssize_t
 
ªt
;

1012 i‡((
ªt
 = 
	`bgzf_ªad
(
Â
, 
x
, 32)) != 32) {

1013 i‡(
ªt
 == 0)  -1;

1016 
	`bcf_˛ór1
(
v
);

1017 
x
[0] -= 24;

1018 i‡(
	`ks_ªsize
(&
v
->
sh¨ed
, 
x
[0]) != 0)  -2;

1019 i‡(
	`ks_ªsize
(&
v
->
ödiv
, 
x
[1]) != 0)  -2;

1020 
	`mem˝y
(
v
, 
x
 + 2, 16);

1021 
v
->
n_ÆÀÀ
 = 
x
[6]>>16; v->
n_öfo
 = x[6]&0xffff;

1022 
v
->
n_fmt
 = 
x
[7]>>24; v->
n_ßm∂e
 = x[7]&0xffffff;

1023 
v
->
sh¨ed
.
l
 = 
x
[0], v->
ödiv
.l = x[1];

1025 i‡–(!
v
->
ödiv
.
l
 || !v->
n_ßm∂e
Ë&& v->
n_fmt
 ) v->n_fmt = 0;

1027 i‡(
	`bgzf_ªad
(
Â
, 
v
->
sh¨ed
.
s
, v->sh¨ed.
l
) != v->shared.l)  -2;

1028 i‡(
	`bgzf_ªad
(
Â
, 
v
->
ödiv
.
s
, v->ödiv.
l
) != v->indiv.l)  -2;

1030 
	}
}

1032 
	#bô_¨øy_size
(
n
Ë(“)/8+1)

	)

1033 
	#bô_¨øy_£t
(
a
,
i
Ë(◊)[(i)/8] |1 << ((i)%8))

	)

1034 
	#bô_¨øy_˛ór
(
a
,
i
Ë(◊)[(i)/8] &~(1 << ((i)%8)))

	)

1035 
	#bô_¨øy_ã°
(
a
,
i
Ë(◊)[(i)/8] & (1 << ((i)%8)))

	)

1037 
	$bcf_dec_ty≥d_öt1_ß„
(
uöt8_t
 *
p
, uöt8_à*
íd
, uöt8_à**
q
,

1038 
öt32_t
 *
vÆ
) {

1039 
uöt32_t
 
v
;

1040 
uöt32_t
 
t
;

1041 i‡(
íd
 - 
p
 < 2)  -1;

1042 
t
 = *
p
++ & 0xf;

1045 i‡(
t
 =
BCF_BT_INT8
) {

1046 *
q
 = 
p
 + 1;

1047 *
vÆ
 = *(
öt8_t
 *Ë
p
;

1048 } i‡(
t
 =
BCF_BT_INT16
) {

1049 i‡(
íd
 - 
p
 < 2)  -1;

1050 *
q
 = 
p
 + 2;

1051 
v
 = 
p
[0] | (p[1] << 8);

1052 *
vÆ
 = 
v
 < 0x8000 ? v : -((
öt32_t
) (0xffff - v)) - 1;

1053 } i‡(
t
 =
BCF_BT_INT32
) {

1054 i‡(
íd
 - 
p
 < 4)  -1;

1055 *
q
 = 
p
 + 4;

1056 
v
 = 
p
[0] | (p[1] << 8) | (p[2] << 16) | (p[3] << 24);

1057 *
vÆ
 = 
v
 < 0x80000000UL ? v : -((
öt32_t
) (0xffffffffUL - v)) - 1;

1062 
	}
}

1064 
	$bcf_dec_size_ß„
(
uöt8_t
 *
p
, uöt8_à*
íd
, uöt8_à**
q
,

1065 *
num
, *
ty≥
) {

1066 
r
;

1067 i‡(
p
 >
íd
)  -1;

1068 *
ty≥
 = *
p
 & 0xf;

1069 i‡(*
p
>>4 != 15) {

1070 *
q
 = 
p
 + 1;

1071 *
num
 = *
p
 >> 4;

1074 
r
 = 
	`bcf_dec_ty≥d_öt1_ß„
(
p
 + 1, 
íd
, 
q
, 
num
);

1075 i‡(
r
) Ñ;

1076  *
num
 >= 0 ? 0 : -1;

1077 
	}
}

1079 
	$ªp‹t_bad_id
(c⁄° *
func
, c⁄° *
ª˘y≥
, 
badvÆ
) {

1080 i‡(
hts_vîbo£
 > 1) {

1081 
	`Ârötf
(
°dîr
, "[W::%s] Bad BCFÑecord: Invalid %s id %d\n",

1082 
func
, 
ª˘y≥
, 
badvÆ
);

1084 
	}
}

1086 
	$ªp‹t_bad_ty≥
(c⁄° *
func
, c⁄° *
ª˘y≥
, 
ty≥
) {

1087 c⁄° *
ty≥s
[9] = {

1091 
t
 = (
ty≥
 >= 0 &&Åype < 8) ?Åype : 8;

1092 i‡(
hts_vîbo£
 > 1) {

1093 
	`Ârötf
(
°dîr
, "[W::%s] Bad BCFÑecord: Invalid %sÅype %d (%s)\n",

1094 
func
, 
ª˘y≥
, 
ty≥
, 
ty≥s
[
t
]);

1096 
	}
}

1098 
	$bcf_ªc‹d_check
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
ªc
) {

1099 
uöt8_t
 *
±r
, *
íd
;

1100 
size_t
 
byãs
;

1101 
uöt32_t
 
îr
 = 0;

1102 
ty≥
 = 0;

1103 
num
 = 0;

1104 
uöt32_t
 
i
, 
ªp‹ts
;

1105 c⁄° 
uöt32_t
 
is_öãgî
 = ((1 << 
BCF_BT_INT8
) |

1106 (1 << 
BCF_BT_INT16
) |

1107 (1 << 
BCF_BT_INT32
));

1108 c⁄° 
uöt32_t
 
is_vÆid_ty≥
 = (
is_öãgî
 |

1109 (1 << 
BCF_BT_NULL
) |

1110 (1 << 
BCF_BT_FLOAT
) |

1111 (1 << 
BCF_BT_CHAR
));

1115 i‡(
ªc
->
rid
 < 0 ||Ñec->rid >
hdr
->
n
[
BCF_DT_CTG
]) {

1116 
	`ªp‹t_bad_id
(
__func__
, "CONTIG", 
ªc
->
rid
);

1117 
îr
 |
BCF_ERR_CTG_INVALID
;

1121 
±r
 = (
uöt8_t
 *Ë
ªc
->
sh¨ed
.
s
;

1122 
íd
 = 
±r
 + 
ªc
->
sh¨ed
.
l
;

1123 i‡(
	`bcf_dec_size_ß„
(
±r
, 
íd
, &±r, &
num
, &
ty≥
Ë!0Ë
bad_sh¨ed
;

1124 i‡(
ty≥
 !
BCF_BT_CHAR
) {

1125 
	`ªp‹t_bad_ty≥
(
__func__
, "ID", 
ty≥
);

1126 
îr
 |
BCF_ERR_TAG_INVALID
;

1128 
byãs
 = (
size_t
Ë
num
 << 
bcf_ty≥_shi·
[
ty≥
];

1129 i‡(
íd
 - 
±r
 < 
byãs
Ë
bad_sh¨ed
;

1130 
±r
 +
byãs
;

1133 
ªp‹ts
 = 0;

1134 
i
 = 0; i < 
ªc
->
n_ÆÀÀ
; i++) {

1135 i‡(
	`bcf_dec_size_ß„
(
±r
, 
íd
, &±r, &
num
, &
ty≥
Ë!0Ë
bad_sh¨ed
;

1136 i‡(
ty≥
 !
BCF_BT_CHAR
) {

1137 i‡(!
ªp‹ts
++ || 
hts_vîbo£
 > 5)

1138 
	`ªp‹t_bad_ty≥
(
__func__
, "REF/ALT", 
ty≥
);

1139 
îr
 |
BCF_ERR_CHAR
;

1141 
byãs
 = (
size_t
Ë
num
 << 
bcf_ty≥_shi·
[
ty≥
];

1142 i‡(
íd
 - 
±r
 < 
byãs
Ë
bad_sh¨ed
;

1143 
±r
 +
byãs
;

1147 i‡(
	`bcf_dec_size_ß„
(
±r
, 
íd
, &±r, &
num
, &
ty≥
Ë!0Ë
bad_sh¨ed
;

1148 i‡(
num
 > 0) {

1149 i‡(((1 << 
ty≥
Ë& 
is_öãgî
) == 0) {

1150 
	`ªp‹t_bad_ty≥
(
__func__
, "FILTER", 
ty≥
);

1151 
îr
 |
BCF_ERR_TAG_INVALID
;

1153 
byãs
 = (
size_t
Ë
num
 << 
bcf_ty≥_shi·
[
ty≥
];

1154 i‡(
íd
 - 
±r
 < 
byãs
Ë
bad_sh¨ed
;

1155 
ªp‹ts
 = 0;

1156 
i
 = 0; i < 
num
; i++) {

1157 
öt32_t
 
key
 = 
	`bcf_dec_öt1
(
±r
, 
ty≥
, &ptr);

1158 i‡(
key
 < 0 || key >
hdr
->
n
[
BCF_DT_ID
]) {

1159 i‡(!
ªp‹ts
++ || 
hts_vîbo£
 > 5)

1160 
	`ªp‹t_bad_id
(
__func__
, "FILTER", 
key
);

1161 
îr
 |
BCF_ERR_TAG_UNDEF
;

1167 
ªp‹ts
 = 0;

1168 
i
 = 0; i < 
ªc
->
n_öfo
; i++) {

1169 
öt32_t
 
key
 = -1;

1170 i‡(
	`bcf_dec_ty≥d_öt1_ß„
(
±r
, 
íd
, &±r, &
key
Ë!0Ë
bad_sh¨ed
;

1171 i‡(
key
 < 0 || key >
hdr
->
n
[
BCF_DT_ID
]) {

1172 i‡(!
ªp‹ts
++ || 
hts_vîbo£
 > 5)

1173 
	`ªp‹t_bad_id
(
__func__
, "INFO", 
key
);

1174 
îr
 |
BCF_ERR_TAG_UNDEF
;

1176 i‡(
	`bcf_dec_size_ß„
(
±r
, 
íd
, &±r, &
num
, &
ty≥
Ë!0Ë
bad_sh¨ed
;

1177 i‡(((1 << 
ty≥
Ë& 
is_vÆid_ty≥
) == 0) {

1178 i‡(!
ªp‹ts
++ || 
hts_vîbo£
 > 5)

1179 
	`ªp‹t_bad_ty≥
(
__func__
, "INFO", 
ty≥
);

1180 
îr
 |
BCF_ERR_TAG_INVALID
;

1182 
byãs
 = (
size_t
Ë
num
 << 
bcf_ty≥_shi·
[
ty≥
];

1183 i‡(
íd
 - 
±r
 < 
byãs
Ë
bad_sh¨ed
;

1184 
±r
 +
byãs
;

1188 
±r
 = (
uöt8_t
 *Ë
ªc
->
ödiv
.
s
;

1189 
íd
 = 
±r
 + 
ªc
->
ödiv
.
l
;

1190 
ªp‹ts
 = 0;

1191 
i
 = 0; i < 
ªc
->
n_fmt
; i++) {

1192 
öt32_t
 
key
 = -1;

1193 i‡(
	`bcf_dec_ty≥d_öt1_ß„
(
±r
, 
íd
, &±r, &
key
Ë!0Ë
bad_ödiv
;

1194 i‡(
key
 < 0 || key >
hdr
->
n
[
BCF_DT_ID
]) {

1195 i‡(!
ªp‹ts
++ || 
hts_vîbo£
 > 5)

1196 
	`ªp‹t_bad_id
(
__func__
, "FORMAT", 
key
);

1197 
îr
 |
BCF_ERR_TAG_UNDEF
;

1199 i‡(
	`bcf_dec_size_ß„
(
±r
, 
íd
, &±r, &
num
, &
ty≥
Ë!0Ë
bad_ödiv
;

1200 i‡(((1 << 
ty≥
Ë& 
is_vÆid_ty≥
) == 0) {

1201 i‡(!
ªp‹ts
++ || 
hts_vîbo£
 > 5)

1202 
	`ªp‹t_bad_ty≥
(
__func__
, "FORMAT", 
ty≥
);

1203 
îr
 |
BCF_ERR_TAG_INVALID
;

1205 
byãs
 = ((
size_t
Ë
num
 << 
bcf_ty≥_shi·
[
ty≥
]Ë* 
ªc
->
n_ßm∂e
;

1206 i‡(
íd
 - 
±r
 < 
byãs
Ë
bad_ödiv
;

1207 
±r
 +
byãs
;

1210 
ªc
->
îrcode
 |
îr
;

1212  
îr
 ? -1 : 0;

1214 
bad_sh¨ed
:

1215 i‡(
hts_vîbo£
 > 1) {

1216 
	`Ârötf
(
°dîr
, "[E::%s] Bad BCFÑecord - shared section malformed orÅoo short\n",

1217 
__func__
);

1221 
bad_ödiv
:

1222 i‡(
hts_vîbo£
 > 1) {

1223 
	`Ârötf
(
°dîr
, "[E::%s] Bad BCFÑecord - individuals section malformed orÅoo short\n",

1224 
__func__
);

1227 
	}
}

1229 
ölöe
 
uöt8_t
 *
bcf_u≈ack_fmt_c‹e1
(uöt8_à*
±r
, 
n_ßm∂e
, 
bcf_fmt_t
 *
fmt
);

1230 
	$bcf_sub£t_f‹m©
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
ªc
)

1232 i‡–!
hdr
->
kìp_ßm∂es
 )  0;

1233 i‡–!
	`bcf_hdr_nßm∂es
(
hdr
) )

1235 
ªc
->
ödiv
.
l
 =Ñec->
n_ßm∂e
 = 0;

1239 
i
, 
j
;

1240 
uöt8_t
 *
±r
 = (uöt8_t*)
ªc
->
ödiv
.
s
, *
d°
 = 
NULL
, *
§c
;

1241 
bcf_dec_t
 *
dec
 = &
ªc
->
d
;

1242 
	`hts_ex∑nd
(
bcf_fmt_t
, 
ªc
->
n_fmt
, 
dec
->
m_fmt
, dec->
fmt
);

1243 
i
=0; i<
dec
->
m_fmt
; ++iËdec->
fmt
[i].
p_‰ì
 = 0;

1245 
i
=0; i<
ªc
->
n_fmt
; i++)

1247 
±r
 = 
	`bcf_u≈ack_fmt_c‹e1
’å, 
ªc
->
n_ßm∂e
, &
dec
->
fmt
[
i
]);

1248 
§c
 = 
dec
->
fmt
[
i
].
p
 - dec->fmt[i].
size
;

1249 i‡–
d°
 )

1251 
	`memmove
(
dec
->
fmt
[
i
-1].
p
 + dec->fmt[i-1].
p_Àn
, dec->fmt[i].∞- dec->fmt[i].
p_off
, dec->fmt[i].p_off);

1252 
dec
->
fmt
[
i
].
p
 = dec->fmt[i-1].∞+ dec->fmt[i-1].
p_Àn
 + dec->fmt[i].
p_off
;

1254 
d°
 = 
dec
->
fmt
[
i
].
p
;

1255 
j
=0; j<
hdr
->
nßm∂es_‹i
; j++)

1257 
§c
 +
dec
->
fmt
[
i
].
size
;

1258 i‡–!
	`bô_¨øy_ã°
(
hdr
->
kìp_ßm∂es
,
j
) ) ;

1259 
	`memmove
(
d°
, 
§c
, 
dec
->
fmt
[
i
].
size
);

1260 
d°
 +
dec
->
fmt
[
i
].
size
;

1262 
ªc
->
ödiv
.
l
 -
dec
->
fmt
[
i
].
p_Àn
 - (
d°
 - dec->fmt[i].
p
);

1263 
dec
->
fmt
[
i
].
p_Àn
 = 
d°
 - dec->fmt[i].
p
;

1265 
ªc
->
u≈acked
 |
BCF_UN_FMT
;

1267 
ªc
->
n_ßm∂e
 = 
	`bcf_hdr_nßm∂es
(
hdr
);

1269 
	}
}

1271 
	$bcf_ªad
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
)

1273 i‡(
Â
->
f‹m©
.f‹m© =
vcf
Ë 
	`vcf_ªad
(Â,
h
,
v
);

1274 
ªt
 = 
	`bcf_ªad1_c‹e
(
Â
->Â.
bgzf
, 
v
);

1275 i‡(
ªt
 =0Ëªà
	`bcf_ªc‹d_check
(
h
, 
v
);

1276 i‡–
ªt
!=0 || !
h
->
kìp_ßm∂es
 ) Ñet;

1277  
	`bcf_sub£t_f‹m©
(
h
,
v
);

1278 
	}
}

1280 
	$bcf_ªadªc
(
BGZF
 *
Â
, *
nuŒ
, *
vv
, *
tid
, *
beg
, *
íd
)

1282 
bcf1_t
 *
v
 = (bcf1_à*Ë
vv
;

1283 
ªt
;

1284 i‡((
ªt
 = 
	`bcf_ªad1_c‹e
(
Â
, 
v
)) >= 0)

1285 *
tid
 = 
v
->
rid
, *
beg
 = v->
pos
, *
íd
 = v->po†+ v->
æí
;

1286  
ªt
;

1287 
	}
}

1289 
ölöe
 
	$bcf1_sync_id
(
bcf1_t
 *
löe
, 
k°rög_t
 *
°r
)

1292 i‡–
löe
->
d
.
id
 && 
	`°rcmp
÷öe->d.id, "."ËË
	`bcf_íc_vch¨
(
°r
, 
	`°æí
(line->d.id),Üine->d.id);

1293 
	`bcf_íc_size
(
°r
, 0, 
BCF_BT_CHAR
);

1294 
	}
}

1295 
ölöe
 
	$bcf1_sync_ÆÀÀs
(
bcf1_t
 *
löe
, 
k°rög_t
 *
°r
)

1298 
i
;

1299 
i
=0; i<
löe
->
n_ÆÀÀ
; i++)

1300 
	`bcf_íc_vch¨
(
°r
, 
	`°æí
(
löe
->
d
.
ÆÀÀ
[
i
]),Üine->d.allele[i]);

1301 i‡–!
löe
->
æí
 &&Üöe->
n_ÆÀÀ
 )Üöe->æí = 
	`°æí
÷öe->
d
.
ÆÀÀ
[0]);

1302 
	}
}

1303 
ölöe
 
	$bcf1_sync_fûãr
(
bcf1_t
 *
löe
, 
k°rög_t
 *
°r
)

1306 i‡–
löe
->
d
.
n_Êt
 ) 
	`bcf_íc_vöt
(
°r
,Üöe->d.n_Êt,Üöe->d.
Êt
, -1);

1307 
	`bcf_íc_vöt
(
°r
, 0, 0, -1);

1308 
	}
}

1310 
ölöe
 
	$bcf1_sync_öfo
(
bcf1_t
 *
löe
, 
k°rög_t
 *
°r
)

1313 
i
, 
úm
 = -1;

1314 
i
=0; i<
löe
->
n_öfo
; i++)

1316 
bcf_öfo_t
 *
öfo
 = &
löe
->
d
.öfo[
i
];

1317 i‡–!
öfo
->
v±r
 )

1320 i‡–
úm
 < 0 ) irm = 
i
;

1323 
	`kput¢_
(
öfo
->
v±r
 - info->
v±r_off
, info->
v±r_Àn
 + info->v±r_off, 
°r
);

1324 i‡–
úm
 >=0 )

1326 
bcf_öfo_t
 
tmp
 = 
löe
->
d
.
öfo
[
úm
];Üöe->d.öfo[úm] =Üöe->d.öfo[
i
];Üine->d.info[i] =Åmp;

1327  
úm
<=
i
 && 
löe
->
d
.
öfo
[úm].
v±r
 ) irm++;

1330 i‡–
úm
>=0 ) 
löe
->
n_öfo
 = irm;

1331 
	}
}

1333 
	$bcf1_sync
(
bcf1_t
 *
löe
)

1335 *
sh¨ed_‹i
 = 
löe
->
sh¨ed
.
s
;

1336 
size_t
 
¥ev_Àn
;

1338 
k°rög_t
 
tmp
 = {0,0,0};

1339 i‡–!
löe
->
sh¨ed
.
l
 )

1342 
tmp
 = 
löe
->
sh¨ed
;

1343 
	`bcf1_sync_id
(
löe
, &
tmp
);

1344 
löe
->
u≈ack_size
[0] = 
tmp
.
l
; 
¥ev_Àn
 =Åmp.l;

1346 
	`bcf1_sync_ÆÀÀs
(
löe
, &
tmp
);

1347 
löe
->
u≈ack_size
[1] = 
tmp
.
l
 - 
¥ev_Àn
;Örev_len =Åmp.l;

1349 
	`bcf1_sync_fûãr
(
löe
, &
tmp
);

1350 
löe
->
u≈ack_size
[2] = 
tmp
.
l
 - 
¥ev_Àn
;

1352 
	`bcf1_sync_öfo
(
löe
, &
tmp
);

1353 
löe
->
sh¨ed
 = 
tmp
;

1355 i‡–
löe
->
d
.
sh¨ed_dúty
 )

1359 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_STR
ËË
	`bcf_u≈ack
(line,BCF_UN_STR);

1362 
uöt8_t
 *
±r_‹i
 = (uöt8_à*Ë
löe
->
sh¨ed
.
s
;

1365 i‡–
löe
->
d
.
sh¨ed_dúty
 & 
BCF1_DIRTY_ID
 )

1366 
	`bcf1_sync_id
(
löe
, &
tmp
);

1368 
	`kput¢_
(
±r_‹i
, 
löe
->
u≈ack_size
[0], &
tmp
);

1369 
±r_‹i
 +
löe
->
u≈ack_size
[0];

1370 
löe
->
u≈ack_size
[0] = 
tmp
.
l
; 
¥ev_Àn
 =Åmp.l;

1373 i‡–
löe
->
d
.
sh¨ed_dúty
 & 
BCF1_DIRTY_ALS
 )

1374 
	`bcf1_sync_ÆÀÀs
(
löe
, &
tmp
);

1377 
	`kput¢_
(
±r_‹i
, 
löe
->
u≈ack_size
[1], &
tmp
);

1378 i‡–!
löe
->
æí
 &&Üöe->
n_ÆÀÀ
 )Üöe->æí = 
	`°æí
÷öe->
d
.
ÆÀÀ
[0]);

1380 
±r_‹i
 +
löe
->
u≈ack_size
[1];

1381 
löe
->
u≈ack_size
[1] = 
tmp
.
l
 - 
¥ev_Àn
;Örev_len =Åmp.l;

1383 i‡–
löe
->
u≈acked
 & 
BCF_UN_FLT
 )

1386 i‡–
löe
->
d
.
sh¨ed_dúty
 & 
BCF1_DIRTY_FLT
 )

1387 
	`bcf1_sync_fûãr
(
löe
, &
tmp
);

1388 i‡–
löe
->
d
.
n_Êt
 )

1389 
	`kput¢_
(
±r_‹i
, 
löe
->
u≈ack_size
[2], &
tmp
);

1391 
	`bcf_íc_vöt
(&
tmp
, 0, 0, -1);

1392 
±r_‹i
 +
löe
->
u≈ack_size
[2];

1393 
löe
->
u≈ack_size
[2] = 
tmp
.
l
 - 
¥ev_Àn
;

1395 i‡–
löe
->
u≈acked
 & 
BCF_UN_INFO
 )

1398 i‡–
löe
->
d
.
sh¨ed_dúty
 & 
BCF1_DIRTY_INF
 )

1400 
	`bcf1_sync_öfo
(
löe
, &
tmp
);

1401 
±r_‹i
 = (
uöt8_t
*)
löe
->
sh¨ed
.
s
 +Üöe->sh¨ed.
l
;

1406 
size
 = 
löe
->
sh¨ed
.
l
 - (
size_t
)
±r_‹i
 + (size_tÓöe->sh¨ed.
s
;

1407 i‡–
size
 ) 
	`kput¢_
(
±r_‹i
, size, &
tmp
);

1409 
	`‰ì
(
löe
->
sh¨ed
.
s
);

1410 
löe
->
sh¨ed
 = 
tmp
;

1412 i‡–
löe
->
sh¨ed
.
s
 !
sh¨ed_‹i
 &&Üöe->
u≈acked
 & 
BCF_UN_INFO
 )

1415 
size_t
 
off_√w
 = 
löe
->
u≈ack_size
[0] +Üine->unpack_size[1] +Üine->unpack_size[2];

1416 
i
;

1417 
i
=0; i<
löe
->
n_öfo
; i++)

1419 
uöt8_t
 *
v±r_‰ì
 = 
löe
->
d
.
öfo
[
i
].v±r_‰ì ?Üöe->d.öfo[i].
v±r
 -Üöe->d.öfo[i].
v±r_off
 : 
NULL
;

1420 
löe
->
d
.
öfo
[
i
].
v±r
 = (
uöt8_t
*Ëlöe->
sh¨ed
.
s
 + 
off_√w
 +Üöe->d.öfo[i].
v±r_off
;

1421 
off_√w
 +
löe
->
d
.
öfo
[
i
].
v±r_Àn
 +Üöe->d.öfo[i].
v±r_off
;

1422 i‡–
v±r_‰ì
 )

1424 
	`‰ì
(
v±r_‰ì
);

1425 
löe
->
d
.
öfo
[
i
].
v±r_‰ì
 = 0;

1430 i‡–
löe
->
n_ßm∂e
 &&Üöe->
n_fmt
 && (!löe->
ödiv
.
l
 ||Üöe->
d
.
ödiv_dúty
) )

1433 
tmp
.
l
 =Åmp.
m
 = 0;Åmp.
s
 = 
NULL
;

1434 
i
, 
úm
 = -1;

1435 
i
=0; i<
löe
->
n_fmt
; i++)

1437 
bcf_fmt_t
 *
fmt
 = &
löe
->
d
.fmt[
i
];

1438 i‡–!
fmt
->
p
 )

1441 i‡–
úm
 < 0 ) irm = 
i
;

1444 
	`kput¢_
(
fmt
->
p
 - fmt->
p_off
, fmt->
p_Àn
 + fmt->p_off, &
tmp
);

1445 i‡–
úm
 >=0 )

1447 
bcf_fmt_t
 
tfmt
 = 
löe
->
d
.
fmt
[
úm
];Üöe->d.fmt[úm] =Üöe->d.fmt[
i
];Üine->d.fmt[i] =Åfmt;

1448  
úm
<=
i
 && 
löe
->
d
.
fmt
[úm].
p
 ) irm++;

1452 i‡–
úm
>=0 ) 
löe
->
n_fmt
 = irm;

1453 
	`‰ì
(
löe
->
ödiv
.
s
);

1454 
löe
->
ödiv
 = 
tmp
;

1457 
size_t
 
off_√w
 = 0;

1458 
i
=0; i<
löe
->
n_fmt
; i++)

1460 
uöt8_t
 *
p_‰ì
 = 
löe
->
d
.
fmt
[
i
].p_‰ì ?Üöe->d.fmt[i].
p
 -Üöe->d.fmt[i].
p_off
 : 
NULL
;

1461 
löe
->
d
.
fmt
[
i
].
p
 = (
uöt8_t
*Ëlöe->
ödiv
.
s
 + 
off_√w
 +Üöe->d.fmt[i].
p_off
;

1462 
off_√w
 +
löe
->
d
.
fmt
[
i
].
p_Àn
 +Üöe->d.fmt[i].
p_off
;

1463 i‡–
p_‰ì
 )

1465 
	`‰ì
(
p_‰ì
);

1466 
löe
->
d
.
fmt
[
i
].
p_‰ì
 = 0;

1470 i‡–!
löe
->
n_ßm∂e
 )Üöe->
n_fmt
 = 0;

1471 
löe
->
d
.
sh¨ed_dúty
 =Üöe->d.
ödiv_dúty
 = 0;

1473 
	}
}

1475 
bcf1_t
 *
	$bcf_c›y
(
bcf1_t
 *
d°
, bcf1_à*
§c
)

1477 
	`bcf1_sync
(
§c
);

1479 
	`bcf_˛ór
(
d°
);

1480 
d°
->
rid
 = 
§c
->rid;

1481 
d°
->
pos
 = 
§c
->pos;

1482 
d°
->
æí
 = 
§c
->rlen;

1483 
d°
->
quÆ
 = 
§c
->qual;

1484 
d°
->
n_öfo
 = 
§c
->n_öfo; d°->
n_ÆÀÀ
 = src->n_allele;

1485 
d°
->
n_fmt
 = 
§c
->n_fmt; d°->
n_ßm∂e
 = src->n_sample;

1487 
d°
->
sh¨ed
.
m
 = d°->sh¨ed.
l
 = 
§c
->shared.l;

1488 
d°
->
sh¨ed
.
s
 = (*Ë
	`mÆloc
(d°->sh¨ed.
l
);

1489 
	`mem˝y
(
d°
->
sh¨ed
.
s
,
§c
->sh¨ed.s,d°->sh¨ed.
l
);

1491 
d°
->
ödiv
.
m
 = d°->ödiv.
l
 = 
§c
->indiv.l;

1492 
d°
->
ödiv
.
s
 = (*Ë
	`mÆloc
(d°->ödiv.
l
);

1493 
	`mem˝y
(
d°
->
ödiv
.
s
,
§c
->ödiv.s,d°->ödiv.
l
);

1495  
d°
;

1496 
	}
}

1497 
bcf1_t
 *
	$bcf_dup
(
bcf1_t
 *
§c
)

1499 
bcf1_t
 *
out
 = 
	`bcf_öô1
();

1500  
	`bcf_c›y
(
out
, 
§c
);

1501 
	}
}

1503 
	$bcf_wrôe
(
htsFûe
 *
hÂ
, 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
)

1505 i‡–
h
->
dúty
 ) 
	`bcf_hdr_sync
(h);

1506 i‡–
	`bcf_hdr_nßm∂es
(
h
)!=
v
->
n_ßm∂e
 )

1508 
	`Ârötf
(
°dîr
,"[%s:%d %s] Broken VCFÑecord,ÅheÇumber of columnsát %s:%d doesÇot matchÅheÇumber of samples (%d vs %d).\n",

1509 
__FILE__
,
__LINE__
,
__FUNCTION__
,
	`bcf_£q«me
(
h
,
v
),v->
pos
+1, v->
n_ßm∂e
,
	`bcf_hdr_nßm∂es
(h));

1513 i‡–
hÂ
->
f‹m©
.f‹m© =
vcf
 || hÂ->f‹m©.f‹m© =
ãxt_f‹m©
 )

1514  
	`vcf_wrôe
(
hÂ
,
h
,
v
);

1516 i‡–
v
->
îrcode
 )

1522 
	`Ârötf
(
°dîr
,"[%s:%d %s] UncheckedÉº‹ (%d),Éxôög.\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
v
->
îrcode
);

1523 
	`exô
(1);

1525 
	`bcf1_sync
(
v
);

1527 
BGZF
 *
Â
 = 
hÂ
->Â.
bgzf
;

1528 
uöt32_t
 
x
[8];

1529 
x
[0] = 
v
->
sh¨ed
.
l
 + 24;

1530 
x
[1] = 
v
->
ödiv
.
l
;

1531 
	`mem˝y
(
x
 + 2, 
v
, 16);

1532 
x
[6] = (
uöt32_t
)
v
->
n_ÆÀÀ
<<16 | v->
n_öfo
;

1533 
x
[7] = (
uöt32_t
)
v
->
n_fmt
<<24 | v->
n_ßm∂e
;

1534 i‡–
	`bgzf_wrôe
(
Â
, 
x
, 32) != 32 )  -1;

1535 i‡–
	`bgzf_wrôe
(
Â
, 
v
->
sh¨ed
.
s
, v->sh¨ed.
l
) != v->shared.l )  -1;

1536 i‡–
	`bgzf_wrôe
(
Â
, 
v
->
ödiv
.
s
, v->ödiv.
l
) != v->indiv.l )  -1;

1538 
	}
}

1544 
bcf_hdr_t
 *
	$vcf_hdr_ªad
(
htsFûe
 *
Â
)

1546 
k°rög_t
 
txt
, *
s
 = &
Â
->
löe
;

1547 
ªt
;

1548 
bcf_hdr_t
 *
h
;

1549 
h
 = 
	`bcf_hdr_öô
("r");

1550 i‡(!
h
) {

1551 
	`Ârötf
(
°dîr
, "[E::%s] faûedÅÿÆloˇã bc‡hódî\n", 
__func__
);

1552  
NULL
;

1554 
txt
.
l
 =Åxt.
m
 = 0;Åxt.
s
 = 0;

1555 (
ªt
 = 
	`hts_gëlöe
(
Â
, 
KS_SEP_LINE
, 
s
)) >= 0) {

1556 i‡(
s
->
l
 == 0) ;

1557 i‡(
s
->s[0] != '#') {

1558 i‡(
hts_vîbo£
 >= 2)

1559 
	`Ârötf
(
°dîr
, "[E::%s]Çÿßm∂êlöe\n", 
__func__
);

1560 
îr‹
;

1562 i‡(
s
->s[1] !'#' && 
Â
->
‚_aux
) {

1563 
k°rög_t
 
tmp
 = { 0, 0, 
NULL
 };

1564 
hFILE
 *
f
 = 
	`h›í
(
Â
->
‚_aux
, "r");

1565 i‡(
f
 =
NULL
) {

1566 
	`Ârötf
(
°dîr
, "[E::%s] couldn'à›í \"%s\"\n", 
__func__
, 
Â
->
‚_aux
);

1567 
îr‹
;

1569 
tmp
.
l
 = 0, 
	`kgëlöe
(&tmp, (
kgës_func
 *Ë
hgës
, 
f
) >= 0) {

1570 *
èb
 = 
	`°rchr
(
tmp
.
s
, '\t');

1571 i‡(
èb
 =
NULL
) ;

1572 
	`kputs
("##c⁄tig=<ID=", &
txt
); 
	`kput¢
(
tmp
.
s
, 
èb
 -Åmp.s, &txt);

1573 
	`kputs
(",Àngth=", &
txt
); 
	`kpué
(
	`©ﬁ
(
èb
), &txt);

1574 
	`kput¢
(">\n", 2, &
txt
);

1576 
	`‰ì
(
tmp
.
s
);

1577 i‡(
	`h˛o£
(
f
) != 0) {

1578 i‡(
hts_vîbo£
 >= 2)

1579 
	`Ârötf
(
°dîr
, "[W::%s] closög \"%s\" faûed\n", 
__func__
, 
Â
->
‚_aux
);

1582 
	`kput¢
(
s
->s, s->
l
, &
txt
);

1583 
	`kputc
('\n', &
txt
);

1584 i‡(
s
->s[1] != '#') ;

1586 i‡–
ªt
 < -1 ) 
îr‹
;

1587 i‡–!
txt
.
s
 )

1589 
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸÑódÅhêhódî\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
);

1590 
îr‹
;

1592 i‡–
	`bcf_hdr_∑r£
(
h
, 
txt
.
s
Ë< 0 ) 
îr‹
;

1595 
tbx_t
 *
idx
 = 
	`tbx_ödex_lﬂd
(
Â
->
‚
);

1596 i‡–
idx
 )

1598 
i
, 
n
, 
√ed_sync
 = 0;

1599 c⁄° **
«mes
 = 
	`tbx_£q«mes
(
idx
, &
n
);

1600 
i
=0; i<
n
; i++)

1602 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_gë_hªc
(
h
, 
BCF_HL_CTG
, "ID", (*Ë
«mes
[
i
], 
NULL
);

1603 i‡–
hªc
 ) ;

1604 
hªc
 = (
bcf_hªc_t
*Ë
	`ˇŒoc
(1,(bcf_hrec_t));

1605 
hªc
->
key
 = 
	`°rdup
("contig");

1606 
	`bcf_hªc_add_key
(
hªc
, "ID", 
	`°æí
("ID"));

1607 
	`bcf_hªc_£t_vÆ
(
hªc
, hªc->
nkeys
-1, (*Ë
«mes
[
i
], 
	`°æí
(names[i]), 0);

1608 
	`bcf_hdr_add_hªc
(
h
, 
hªc
);

1609 
√ed_sync
 = 1;

1611 
	`‰ì
(
«mes
);

1612 
	`tbx_de°roy
(
idx
);

1613 i‡–
√ed_sync
 )

1614 
	`bcf_hdr_sync
(
h
);

1616 
	`‰ì
(
txt
.
s
);

1617  
h
;

1619 
îr‹
:

1620 
	`‰ì
(
txt
.
s
);

1621 i‡(
h
Ë
	`bcf_hdr_de°roy
(h);

1622  
NULL
;

1623 
	}
}

1625 
	$bcf_hdr_£t
(
bcf_hdr_t
 *
hdr
, c⁄° *
‚ame
)

1627 
i
, 
n
;

1628 **
löes
 = 
	`hts_ªadlöes
(
‚ame
, &
n
);

1629 i‡–!
löes
 )  1;

1630 
i
=0; i<
n
-1; i++)

1632 
k
;

1633 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
hdr
,
löes
[
i
],&
k
);

1634 i‡–
hªc
 ) 
	`bcf_hdr_add_hªc
(
hdr
, hrec);

1635 
	`‰ì
(
löes
[
i
]);

1637 
	`bcf_hdr_∑r£_ßm∂e_löe
(
hdr
,
löes
[
n
-1]);

1638 
	`‰ì
(
löes
[
n
-1]);

1639 
	`‰ì
(
löes
);

1640 
	`bcf_hdr_sync
(
hdr
);

1642 
	}
}

1644 
	$_bcf_hªc_f‹m©
(c⁄° 
bcf_hªc_t
 *
hªc
, 
is_bcf
, 
k°rög_t
 *
°r
)

1646 i‡–!
hªc
->
vÆue
 )

1648 
j
, 
nout
 = 0;

1649 
	`k•rötf
(
°r
, "##%s=<", 
hªc
->
key
);

1650 
j
=0; j<
hªc
->
nkeys
; j++)

1653 i‡–!
is_bcf
 && !
	`°rcmp
("IDX",
hªc
->
keys
[
j
]) ) ;

1654 i‡–
nout
 ) 
	`kputc
(',',
°r
);

1655 
	`k•rötf
(
°r
,"%s=%s", 
hªc
->
keys
[
j
], hªc->
vÆs
[j]);

1656 
nout
++;

1658 
	`k•rötf
(
°r
,">\n");

1661 
	`k•rötf
(
°r
,"##%s=%s\n", 
hªc
->
key
,hªc->
vÆue
);

1662 
	}
}

1664 
	$bcf_hªc_f‹m©
(c⁄° 
bcf_hªc_t
 *
hªc
, 
k°rög_t
 *
°r
)

1666 
	`_bcf_hªc_f‹m©
(
hªc
,0,
°r
);

1667 
	}
}

1669 
	$bcf_hdr_f‹m©
(c⁄° 
bcf_hdr_t
 *
hdr
, 
is_bcf
, 
k°rög_t
 *
°r
)

1671 
i
;

1672 
i
=0; i<
hdr
->
nhªc
; i++)

1673 
	`_bcf_hªc_f‹m©
(
hdr
->
hªc
[
i
], 
is_bcf
, 
°r
);

1675 
	`k•rötf
(
°r
, "#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO");

1676 i‡–
	`bcf_hdr_nßm∂es
(
hdr
) )

1678 
	`k•rötf
(
°r
, "\tFORMAT");

1679 
i
=0; i<
	`bcf_hdr_nßm∂es
(
hdr
); i++)

1680 
	`k•rötf
(
°r
, "\t%s", 
hdr
->
ßm∂es
[
i
]);

1682 
	`k•rötf
(
°r
, "\n");

1685 
	}
}

1687 *
	$bcf_hdr_fmt_ãxt
(c⁄° 
bcf_hdr_t
 *
hdr
, 
is_bcf
, *
Àn
)

1689 
k°rög_t
 
txt
 = {0,0,0};

1690 
	`bcf_hdr_f‹m©
(
hdr
, 
is_bcf
, &
txt
);

1691 i‡–
Àn
 ) *À¿
txt
.
l
;

1692  
txt
.
s
;

1693 
	}
}

1695 c⁄° **
	$bcf_hdr_£q«mes
(c⁄° 
bcf_hdr_t
 *
h
, *
n
)

1697 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
BCF_DT_CTG
];

1698 
tid
, 
m
 = 
	`kh_size
(
d
);

1699 c⁄° **
«mes
 = (c⁄° **Ë
	`ˇŒoc
(
m
,(const *));

1700 
khöt_t
 
k
;

1701 
k
=
	`kh_begö
(
d
); k<
	`kh_íd
(d); k++)

1703 i‡–!
	`kh_exi°
(
d
,
k
) ) ;

1704 
tid
 = 
	`kh_vÆ
(
d
,
k
).
id
;

1705 
	`as£π
–
tid
<
m
 );

1706 
«mes
[
tid
] = 
	`kh_key
(
d
,
k
);

1709 
tid
=0;Åid<
m
;Åid++)

1710 
	`as£π
(
«mes
[
tid
]);

1711 *
n
 = 
m
;

1712  
«mes
;

1713 
	}
}

1715 
	$vcf_hdr_wrôe
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
)

1717 
k°rög_t
 
htxt
 = {0,0,0};

1718 
	`bcf_hdr_f‹m©
(
h
, 0, &
htxt
);

1719 
htxt
.
l
 && htxt.
s
[htxt.l-1] == '\0') --htxt.l;

1720 
ªt
;

1721 i‡–
Â
->
f‹m©
.
com¥essi⁄
!=
no_com¥essi⁄
 )

1722 
ªt
 = 
	`bgzf_wrôe
(
Â
->Â.
bgzf
, 
htxt
.
s
, htxt.
l
);

1724 
ªt
 = 
	`hwrôe
(
Â
->Â.
hfûe
, 
htxt
.
s
, htxt.
l
);

1725 
	`‰ì
(
htxt
.
s
);

1726  
ªt
<0 ? -1 : 0;

1727 
	}
}

1733 
	$bcf_íc_vöt
(
k°rög_t
 *
s
, 
n
, 
öt32_t
 *
a
, 
wsize
)

1735 
öt32_t
 
max
 = 
INT32_MIN
 + 1, 
mö
 = 
INT32_MAX
;

1736 
i
;

1737 i‡(
n
 <0Ë
	`bcf_íc_size
(
s
, 0, 
BCF_BT_NULL
);

1738 i‡(
n
 =1Ë
	`bcf_íc_öt1
(
s
, 
a
[0]);

1740 i‡(
wsize
 <0Ëwsizê
n
;

1741 
i
 = 0; i < 
n
; ++i) {

1742 i‡(
a
[
i
] =
bcf_öt32_missög
 ||á[i] =
bcf_öt32_ve˘‹_íd
 ) ;

1743 i‡(
max
 < 
a
[
i
]) max =á[i];

1744 i‡(
mö
 > 
a
[
i
]) min =á[i];

1746 i‡(
max
 <
INT8_MAX
 && 
mö
 > 
bcf_öt8_ve˘‹_íd
) {

1747 
	`bcf_íc_size
(
s
, 
wsize
, 
BCF_BT_INT8
);

1748 
i
 = 0; i < 
n
; ++i)

1749 i‡–
a
[
i
]==
bcf_öt32_ve˘‹_íd
 ) 
	`kputc
(
bcf_öt8_ve˘‹_íd
, 
s
);

1750 i‡–
a
[
i
]==
bcf_öt32_missög
 ) 
	`kputc
(
bcf_öt8_missög
, 
s
);

1751 
	`kputc
(
a
[
i
], 
s
);

1752 } i‡(
max
 <
INT16_MAX
 && 
mö
 > 
bcf_öt16_ve˘‹_íd
) {

1753 
uöt8_t
 *
p
;

1754 
	`bcf_íc_size
(
s
, 
wsize
, 
BCF_BT_INT16
);

1755 
	`ks_ªsize
(
s
, s->
l
 + 
n
 * (
öt16_t
));

1756 
p
 = (
uöt8_t
 *Ë
s
->†+ s->
l
;

1757 
i
 = 0; i < 
n
; ++i)

1759 
öt16_t
 
x
;

1760 i‡–
a
[
i
]==
bcf_öt32_ve˘‹_íd
 ) 
x
 = 
bcf_öt16_ve˘‹_íd
;

1761 i‡–
a
[
i
]==
bcf_öt32_missög
 ) 
x
 = 
bcf_öt16_missög
;

1762 
x
 = 
a
[
i
];

1763 
	`i16_to_À
(
x
, 
p
);

1764 
p
 +(
öt16_t
);

1766 
s
->
l
 +
n
 * (
öt16_t
);

1768 
uöt8_t
 *
p
;

1769 
	`bcf_íc_size
(
s
, 
wsize
, 
BCF_BT_INT32
);

1770 
	`ks_ªsize
(
s
, s->
l
 + 
n
 * (
öt32_t
));

1771 
p
 = (
uöt8_t
 *Ë
s
->†+ s->
l
;

1772 
i
 = 0; i < 
n
; ++i) {

1773 
	`i32_to_À
(
a
[
i
], 
p
);

1774 
p
 +(
öt32_t
);

1776 
s
->
l
 +
n
 * (
öt32_t
);

1779 
	}
}

1781 
ölöe
 
	$£rülize_Êﬂt_¨øy
(
k°rög_t
 *
s
, 
size_t
 
n
, c⁄° *
a
) {

1782 
uöt8_t
 *
p
;

1783 
size_t
 
i
;

1784 
size_t
 
byãs
 = 
n
 * ();

1786 i‡(
byãs
 / (Ë!
n
)  -1;

1787 i‡(
	`ks_ªsize
(
s
, s->
l
 + 
byãs
) < 0)  -1;

1789 
p
 = (
uöt8_t
 *Ë
s
->†+ s->
l
;

1790 
i
 = 0; i < 
n
; i++) {

1791 
	`Êﬂt_to_À
(
a
[
i
], 
p
);

1792 
p
 += ();

1794 
s
->
l
 +
byãs
;

1797 
	}
}

1799 
	$bcf_íc_vÊﬂt
(
k°rög_t
 *
s
, 
n
, *
a
)

1801 
	`as£π
(
n
 >= 0);

1802 
	`bcf_íc_size
(
s
, 
n
, 
BCF_BT_FLOAT
);

1803 
	`£rülize_Êﬂt_¨øy
(
s
, 
n
, 
a
);

1804 
	}
}

1806 
	$bcf_íc_vch¨
(
k°rög_t
 *
s
, 
l
, c⁄° *
a
)

1808 
	`bcf_íc_size
(
s
, 
l
, 
BCF_BT_CHAR
);

1809 
	`kput¢
(
a
, 
l
, 
s
);

1810 
	}
}

1812 
	$bcf_fmt_¨øy
(
k°rög_t
 *
s
, 
n
, 
ty≥
, *
d©a
)

1814 
j
 = 0;

1815 i‡(
n
 == 0) {

1816 
	`kputc
('.', 
s
);

1819 i‡(
ty≥
 =
BCF_BT_CHAR
)

1821 *
p
 = (*)
d©a
;

1822 
j
 = 0; j < 
n
 && *
p
; ++j, ++p)

1824 i‡–*
p
==
bcf_°r_missög
 ) 
	`kputc
('.', 
s
);

1825 
	`kputc
(*
p
, 
s
);

1830 
	#BRANCH
(
ty≥_t
, 
c⁄vît
, 
is_missög
, 
is_ve˘‹_íd
, 
k¥öt
) { \

1831 
uöt8_t
 *
p
 = (uöt8_à*Ë
d©a
; \

1832 
j
=0; j<
n
; j++, 
p
 +(
ty≥_t
)) \

1834 
ty≥_t
 
v
 = 
	`c⁄vît
(
p
); \

1835 i‡–
is_ve˘‹_íd
 ) ; \

1836 i‡–
j
 ) 
	`kputc
(',', 
s
); \

1837 i‡–
is_missög
 ) 
	`kputc
('.', 
s
); \

1838 
k¥öt
; \

1840 }

	)

1841 
ty≥
) {

1842 
BCF_BT_INT8
: 
	`BRANCH
(
öt8_t
, 
À_to_i8
, 
v
==
bcf_öt8_missög
, v==
bcf_öt8_ve˘‹_íd
, 
	`kputw
(v, 
s
)); ;

1843 
BCF_BT_INT16
: 
	`BRANCH
(
öt16_t
, 
À_to_i16
, 
v
==
bcf_öt16_missög
, v==
bcf_öt16_ve˘‹_íd
, 
	`kputw
(v, 
s
)); ;

1844 
BCF_BT_INT32
: 
	`BRANCH
(
öt32_t
, 
À_to_i32
, 
v
==
bcf_öt32_missög
, v==
bcf_öt32_ve˘‹_íd
, 
	`kputw
(v, 
s
)); ;

1845 
BCF_BT_FLOAT
: 
	`BRANCH
(
uöt32_t
, 
À_to_u32
, 
v
==
bcf_Êﬂt_missög
, v==
bcf_Êﬂt_ve˘‹_íd
, 
	`kputd
(
	`À_to_Êﬂt
(
p
), 
s
)); ;

1846 : 
	`Ârötf
(
°dîr
,"todo:Åy≥ %d\n", 
ty≥
); 
	`exô
(1); ;

1848 #unde‡
BRANCH


1850 
	}
}

1852 
uöt8_t
 *
	$bcf_fmt_sized_¨øy
(
k°rög_t
 *
s
, 
uöt8_t
 *
±r
)

1854 
x
, 
ty≥
;

1855 
x
 = 
	`bcf_dec_size
(
±r
, &±r, &
ty≥
);

1856 
	`bcf_fmt_¨øy
(
s
, 
x
, 
ty≥
, 
±r
);

1857  
±r
 + (
x
 << 
bcf_ty≥_shi·
[
ty≥
]);

1858 
	}
}

1865 
	mkey
, 
	mmax_m
, 
	msize
, 
	moff£t
;

1866 
uöt64_t
 
	mis_gt
:1, 
	mmax_g
:31, 
	mmax_l
:32;

1867 
uöt32_t
 
	my
;

1868 
uöt8_t
 *
	mbuf
;

1869 } 
	tfmt_aux_t
;

1871 
ölöe
 
	$Æign_mem
(
k°rög_t
 *
s
)

1873 i‡(
s
->
l
&7) {

1874 
uöt64_t
 
zîo
 = 0;

1875 
l
 = ((
s
->l + 7)>>3<<3) - s->l;

1876 
	`kput¢
((*)&
zîo
, 
l
, 
s
);

1878 
	}
}

1881 
	#MAX_N_FMT
 255

	)

1882 
	$vcf_∑r£_f‹m©
(
k°rög_t
 *
s
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
, *
p
, *
q
)

1884 i‡–!
	`bcf_hdr_nßm∂es
(
h
) )  0;

1886 *
r
, *
t
;

1887 
j
, 
l
, 
m
, 
g
;

1888 
khöt_t
 
k
;

1889 
ks_tokaux_t
 
aux1
;

1890 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
BCF_DT_ID
];

1891 
k°rög_t
 *
mem
 = (k°rög_t*)&
h
->mem;

1892 
fmt_aux_t
 
fmt
[
MAX_N_FMT
];

1893 
mem
->
l
 = 0;

1895 *
íd
 = 
s
->†+ s->
l
;

1896 i‡–
q
>=
íd
 )

1898 
	`Ârötf
(
°dîr
,"[%s:%d %s] Eº‹: FORMAT cﬁum¿wôhÇÿßm∂êcﬁumn†°¨tögáà%s:%d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
s
->s,
v
->
pos
+1);

1902 
v
->
n_fmt
 = 0;

1903 i‡–
p
[0]=='.' &&Ö[1]==0 )

1905 
v
->
n_ßm∂e
 = 
	`bcf_hdr_nßm∂es
(
h
);

1910 
j
 = 0, 
t
 = 
	`k°πok
(
p
, ":", &
aux1
);Å;Å = kstrtok(0, 0, &aux1), ++j) {

1911 i‡(
j
 >
MAX_N_FMT
) {

1912 
v
->
îrcode
 |
BCF_ERR_LIMITS
;

1913 
	`Ârötf
(
°dîr
,"[E::%s] Eº‹: FORMAT cﬁum¿© %s:%dÜi°†m‹êidítifõr†th™ ht¶ib c™ h™dÀ.\n", 
__func__
, 
	`bcf_£q«me
(
h
,
v
), v->
pos
+1);

1917 *(*)
aux1
.
p
 = 0;

1918 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
t
);

1919 i‡(
k
 =
	`kh_íd
(
d
Ë|| 
	`kh_vÆ
(d, k).
öfo
[
BCF_HL_FMT
] == 15) {

1920 i‡–
t
[0]=='.' &&Å[1]==0 )

1922 
	`Ârötf
(
°dîr
, "[E::%s] InvÆid FORMATÅagÇamê'.'\n", 
__func__
);

1923 
v
->
îrcode
 |
BCF_ERR_TAG_INVALID
;

1926 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[W::%s] FORMAT '%s' i†nŸ deföed i¿thêhódî,ássumög Ty≥=Såög\n", 
__func__
, 
t
);

1927 
k°rög_t
 
tmp
 = {0,0,0};

1928 
l
;

1929 
	`k•rötf
(&
tmp
, "##FORMAT=<ID=%s,Numbî=1,Ty≥=Såög,Des¸ùti⁄=\"Dummy\">", 
t
);

1930 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
h
,
tmp
.
s
,&
l
);

1931 
	`‰ì
(
tmp
.
s
);

1932 i‡–
	`bcf_hdr_add_hªc
((
bcf_hdr_t
*)
h
, 
hªc
ËË
	`bcf_hdr_sync
((bcf_hdr_t*)h);

1933 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
t
);

1934 
v
->
îrcode
 = 
BCF_ERR_TAG_UNDEF
;

1935 i‡(
k
 =
	`kh_íd
(
d
)) {

1936 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇŸádd dummy hódî f‹ FORMAT '%s'\n", 
__func__
, 
t
);

1937 
v
->
îrcode
 |
BCF_ERR_TAG_INVALID
;

1941 
fmt
[
j
].
max_l
 = fmt[j].
max_m
 = fmt[j].
max_g
 = 0;

1942 
fmt
[
j
].
key
 = 
	`kh_vÆ
(
d
, 
k
).
id
;

1943 
fmt
[
j
].
is_gt
 = !
	`°rcmp
(
t
, "GT");

1944 
fmt
[
j
].
y
 = 
h
->
id
[0][fmt[j].
key
].
vÆ
->
öfo
[
BCF_HL_FMT
];

1945 
v
->
n_fmt
++;

1948 
n_ßm∂e_‹i
 = -1;

1949 
r
 = 
q
 + 1;

1950 
l
 = 0, 
m
 = 
g
 = 1, 
v
->
n_ßm∂e
 = 0;

1951  
r
<
íd
 )

1954 i‡–
h
->
kìp_ßm∂es
 )

1956 
n_ßm∂e_‹i
++;

1957 i‡–!
	`bô_¨øy_ã°
(
h
->
kìp_ßm∂es
,
n_ßm∂e_‹i
) )

1959  *
r
!='\t' &&Ñ<
íd
 )Ñ++;

1960 i‡–*
r
=='\t' ) { *r = 0;Ñ++; }

1966 
j
 = 0;

1969 i‡–*
r
 == '\t' ) *r = 0;

1970 i‡–*
r
 == ':' || !*r )

1972 i‡(
fmt
[
j
].
max_m
 < 
m
) fmt[j].max_m = m;

1973 i‡(
fmt
[
j
].
max_l
 < 
l
) fmt[j].max_l =Ü;

1974 i‡(
fmt
[
j
].
is_gt
 && fmt[j].
max_g
 < 
g
) fmt[j].max_g = g;

1975 
l
 = 0, 
m
 = 
g
 = 1;

1976 i‡–*
r
==':' )

1978 
j
++;

1979 i‡–
j
>=
v
->
n_fmt
 )

1981 
	`Ârötf
(
°dîr
,"Inc‹ª˘Çumbî o‡FORMAT fõld†© %s:%d\n", 
h
->
id
[
BCF_DT_CTG
][
v
->
rid
].
key
,v->
pos
+1);

1982 
	`exô
(1);

1987 i‡–*
r
=',' ) 
m
++;

1988 i‡–
fmt
[
j
].
is_gt
 && (*
r
 ='|' || *∏='/'ËË
g
++;

1989 i‡–
r
>=
íd
 ) ;

1990 
r
++; 
l
++;

1992 
v
->
n_ßm∂e
++;

1993 i‡–
v
->
n_ßm∂e
 =
	`bcf_hdr_nßm∂es
(
h
) ) ;

1994 
r
++;

1998 
j
 = 0; j < 
v
->
n_fmt
; ++j) {

1999 
fmt_aux_t
 *
f
 = &
fmt
[
j
];

2000 i‡–!
f
->
max_m
 ) f->max_m = 1;

2001 i‡((
f
->
y
>>4&0xfË=
BCF_HT_STR
) {

2002 
f
->
size
 = f->
is_gt
? f->
max_g
 << 2 : f->
max_l
;

2003 } i‡((
f
->
y
>>4&0xfË=
BCF_HT_REAL
 || (f->y>>4&0xfË=
BCF_HT_INT
) {

2004 
f
->
size
 = f->
max_m
 << 2;

2007 
	`Ârötf
(
°dîr
, "[E::%s]Åhêf‹m©Åy≥ %d cuºíéyÇŸ suµ‹ãd\n", 
__func__
, 
f
->
y
>>4&0xf);

2008 
	`ab‹t
();

2010 
	`Æign_mem
(
mem
);

2011 
f
->
off£t
 = 
mem
->
l
;

2012 
	`ks_ªsize
(
mem
, mem->
l
 + 
v
->
n_ßm∂e
 * 
f
->
size
);

2013 
mem
->
l
 +
v
->
n_ßm∂e
 * 
f
->
size
;

2015 
j
 = 0; j < 
v
->
n_fmt
; ++j)

2016 
fmt
[
j
].
buf
 = (
uöt8_t
*)
mem
->
s
 + fmt[j].
off£t
;

2018 
n_ßm∂e_‹i
 = -1;

2019 
t
 = 
q
 + 1; 
m
 = 0;

2020  
t
<
íd
 )

2023 i‡–
h
->
kìp_ßm∂es
 )

2025 
n_ßm∂e_‹i
++;

2026 i‡–!
	`bô_¨øy_ã°
(
h
->
kìp_ßm∂es
,
n_ßm∂e_‹i
) )

2028  *
t
 &&Å<
íd
 )Å++;

2029 
t
++;

2033 i‡–
m
 =
	`bcf_hdr_nßm∂es
(
h
) ) ;

2035 
j
 = 0;

2036  
t
 < 
íd
 )

2038 
fmt_aux_t
 *
z
 = &
fmt
[
j
++];

2039 i‡((
z
->
y
>>4&0xfË=
BCF_HT_STR
) {

2040 i‡(
z
->
is_gt
) {

2041 
öt32_t
 
is_pha£d
 = 0, *
x
 = (öt32_t*)(
z
->
buf
 + z->
size
 * 
m
);

2042 
l
 = 0;; ++
t
) {

2043 i‡(*
t
 ='.'Ë++t, 
x
[
l
++] = 
is_pha£d
;

2044 
x
[
l
++] = (
	`°πﬁ
(
t
, &t, 10Ë+ 1Ë<< 1 | 
is_pha£d
;

2045 #i‡
THOROUGH_SANITY_CHECKS


2046 
	`as£π
( 0 );

2048 
is_pha£d
 = (*
t
 == '|');

2049 i‡(*
t
 != '|' && *t != '/') ;

2051 i‡–!
l
 ) 
x
[l++] = 0;

2052 ; 
l
 < 
z
->
size
>>2; ++lË
x
[l] = 
bcf_öt32_ve˘‹_íd
;

2054 *
x
 = (*)
z
->
buf
 + z->
size
 * 
m
;

2055 
r
 = 
t
, 
l
 = 0; *à!':' && *t; ++tË
x
[l++] = *t;

2056 ; 
l
 < 
z
->
size
; ++lË
x
[l] = 0;

2058 } i‡((
z
->
y
>>4&0xfË=
BCF_HT_INT
) {

2059 
öt32_t
 *
x
 = (öt32_t*)(
z
->
buf
 + z->
size
 * 
m
);

2060 
l
 = 0;; ++
t
) {

2061 i‡(*
t
 ='.'Ë
x
[
l
++] = 
bcf_öt32_missög
, ++t;

2062 
x
[
l
++] = 
	`°πﬁ
(
t
, &t, 10);

2063 i‡(*
t
 != ',') ;

2065 i‡–!
l
 ) 
x
[l++] = 
bcf_öt32_missög
;

2066 ; 
l
 < 
z
->
size
>>2; ++lË
x
[l] = 
bcf_öt32_ve˘‹_íd
;

2067 } i‡((
z
->
y
>>4&0xfË=
BCF_HT_REAL
) {

2068 *
x
 = (*)(
z
->
buf
 + z->
size
 * 
m
);

2069 
l
 = 0;; ++
t
) {

2070 i‡(*
t
 ='.' && !
	`isdigô_c
—[1])Ë
	`bcf_Êﬂt_£t_missög
(
x
[
l
++]), ++t;

2071 
x
[
l
++] = 
	`°πod
(
t
, &t);

2072 i‡(*
t
 != ',') ;

2074 i‡–!
l
 ) 
	`bcf_Êﬂt_£t_missög
(
x
[l++]);

2075 ; 
l
 < 
z
->
size
>>2; ++lË
	`bcf_Êﬂt_£t_ve˘‹_íd
(
x
[l]);

2076 } 
	`ab‹t
();

2078 i‡(*
t
 == '\0') {

2081 i‡(*
t
 == ':') {

2082 
t
++;

2085 
buf„r
[8];

2086 
	`Ârötf
(
°dîr
,"[E::%s] InvÆid ch¨a˘î '%s' i¿'%s' FORMAT fõldáà%s:%d\n", 
__FUNCTION__
, 
	`dump_ch¨
(
buf„r
, *
t
), 
h
->
id
[
BCF_DT_ID
][
z
->
key
].key, 
	`bcf_£q«me
(h,
v
), v->
pos
+1);

2087 
v
->
îrcode
 |
BCF_ERR_CHAR
;

2092 ; 
j
 < 
v
->
n_fmt
; ++j) {

2093 
fmt_aux_t
 *
z
 = &
fmt
[
j
];

2094 i‡((
z
->
y
>>4&0xfË=
BCF_HT_STR
) {

2095 i‡(
z
->
is_gt
) {

2096 
öt32_t
 *
x
 = (öt32_t*)(
z
->
buf
 + z->
size
 * 
m
);

2097 i‡(
z
->
size
Ë
x
[0] = 
bcf_öt32_missög
;

2098 
l
 = 1;Ü < 
z
->
size
>>2; ++lË
x
[l] = 
bcf_öt32_ve˘‹_íd
;

2100 *
x
 = (*)
z
->
buf
 + z->
size
 * 
m
;

2101 i‡–
z
->
size
 ) 
x
[0] = '.';

2102 
l
 = 1;Ü < 
z
->
size
; ++lË
x
[l] = 0;

2104 } i‡((
z
->
y
>>4&0xfË=
BCF_HT_INT
) {

2105 
öt32_t
 *
x
 = (öt32_t*)(
z
->
buf
 + z->
size
 * 
m
);

2106 
x
[0] = 
bcf_öt32_missög
;

2107 
l
 = 1;Ü < 
z
->
size
>>2; ++lË
x
[l] = 
bcf_öt32_ve˘‹_íd
;

2108 } i‡((
z
->
y
>>4&0xfË=
BCF_HT_REAL
) {

2109 *
x
 = (*)(
z
->
buf
 + z->
size
 * 
m
);

2110 
	`bcf_Êﬂt_£t_missög
(
x
[0]);

2111 
l
 = 1;Ü < 
z
->
size
>>2; ++lË
	`bcf_Êﬂt_£t_ve˘‹_íd
(
x
[l]);

2115 
m
++; 
t
++;

2119 
k°rög_t
 *
°r
 = &
v
->
ödiv
;

2120 
i
;

2121 i‡(
v
->
n_ßm∂e
 > 0) {

2122 
i
 = 0; i < 
v
->
n_fmt
; ++i) {

2123 
fmt_aux_t
 *
z
 = &
fmt
[
i
];

2124 
	`bcf_íc_öt1
(
°r
, 
z
->
key
);

2125 i‡((
z
->
y
>>4&0xfË=
BCF_HT_STR
 && !z->
is_gt
) {

2126 
	`bcf_íc_size
(
°r
, 
z
->
size
, 
BCF_BT_CHAR
);

2127 
	`kput¢
((*)
z
->
buf
, z->
size
 * 
v
->
n_ßm∂e
, 
°r
);

2128 } i‡((
z
->
y
>>4&0xfË=
BCF_HT_INT
 || z->
is_gt
) {

2129 
	`bcf_íc_vöt
(
°r
, (
z
->
size
>>2Ë* 
v
->
n_ßm∂e
, (
öt32_t
*)z->
buf
, z->size>>2);

2131 
	`bcf_íc_size
(
°r
, 
z
->
size
>>2, 
BCF_BT_FLOAT
);

2132 i‡(
	`£rülize_Êﬂt_¨øy
(
°r
, (
z
->
size
>>2Ë* 
v
->
n_ßm∂e
,

2133 (*Ë
z
->
buf
) != 0) {

2134 
v
->
îrcode
 |
BCF_ERR_LIMITS
;

2135 i‡(
hts_vîbo£
 > 1) {

2136 
	`Ârötf
(
°dîr
,"[%s:%d %s] Out of memory\n",

2137 
__FILE__
,
__LINE__
,
__FUNCTION__
);

2145 i‡–
v
->
n_ßm∂e
!=
	`bcf_hdr_nßm∂es
(
h
) )

2147 
	`Ârötf
(
°dîr
,"[%s:%d %s] Number of columnsát %s:%d doesÇot matchÅheÇumber of samples (%d vs %d).\n",

2148 
__FILE__
,
__LINE__
,
__FUNCTION__
,
	`bcf_£q«me
(
h
,
v
),v->
pos
+1, v->
n_ßm∂e
,
	`bcf_hdr_nßm∂es
(h));

2149 
v
->
îrcode
 |
BCF_ERR_NCOLS
;

2152 i‡–
v
->
ödiv
.
l
 > 0xffffffff )

2154 
	`Ârötf
(
°dîr
,"[%s:%d %s] The FORMATát %s:%d isÅooÜong...\n",

2155 
__FILE__
,
__LINE__
,
__FUNCTION__
,
	`bcf_£q«me
(
h
,
v
),v->
pos
+1);

2156 
v
->
îrcode
 |
BCF_ERR_LIMITS
;

2159 
v
->
n_fmt
 = 0;

2164 
	}
}

2166 
	$vcf_∑r£
(
k°rög_t
 *
s
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
)

2168 
i
 = 0;

2169 *
p
, *
q
, *
r
, *
t
;

2170 
k°rög_t
 *
°r
;

2171 
khöt_t
 
k
;

2172 
ks_tokaux_t
 
aux
;

2173 
max_n_Êt
 = 0, 
max_n_vÆ
 = 0;

2174 
öt32_t
 *
Êt_a
 = 
NULL
, *
vÆ_a
 = NULL;

2175 
ªt
 = -1;

2178 
	`as£π
((Ë=(
öt32_t
));

2180 
	`bcf_˛ór1
(
v
);

2181 
°r
 = &
v
->
sh¨ed
;

2182 
	`mem£t
(&
aux
, 0, (
ks_tokaux_t
));

2183 
p
 = 
	`k°πok
(
s
->s, "\t", &
aux
), 
i
 = 0;Ö;Ö = kstrtok(0, 0, &aux), ++i) {

2184 
q
 = (*)
aux
.
p
;

2185 *
q
 = 0;

2186 i‡(
i
 == 0) {

2187 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
BCF_DT_CTG
];

2188 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
p
);

2189 i‡(
k
 =
	`kh_íd
(
d
))

2193 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[W::%s] c⁄tig '%s' i†nŸ deföed i¿thêhódî. (Quick w‹k¨ound: indexÅhêfûêwôhÅabix.)\n", 
__func__
, 
p
);

2194 
k°rög_t
 
tmp
 = {0,0,0};

2195 
l
;

2196 
	`k•rötf
(&
tmp
, "##c⁄tig=<ID=%s>", 
p
);

2197 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
h
,
tmp
.
s
,&
l
);

2198 
	`‰ì
(
tmp
.
s
);

2199 i‡–
	`bcf_hdr_add_hªc
((
bcf_hdr_t
*)
h
, 
hªc
ËË
	`bcf_hdr_sync
((bcf_hdr_t*)h);

2200 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
p
);

2201 
v
->
îrcode
 = 
BCF_ERR_CTG_UNDEF
;

2202 i‡(
k
 =
	`kh_íd
(
d
)) {

2203 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇŸádd dummy hódî f‹ c⁄tig '%s'\n", 
__func__
, 
p
);

2204 
v
->
îrcode
 |
BCF_ERR_CTG_INVALID
;

2205 
îr
;

2208 
v
->
rid
 = 
	`kh_vÆ
(
d
, 
k
).
id
;

2209 } i‡(
i
 == 1) {

2210 
v
->
pos
 = 
	`©oi
(
p
) - 1;

2211 } i‡(
i
 == 2) {

2212 i‡(
	`°rcmp
(
p
, ".")Ë
	`bcf_íc_vch¨
(
°r
, 
q
 -Ö,Ö);

2213 
	`bcf_íc_size
(
°r
, 0, 
BCF_BT_CHAR
);

2214 } i‡(
i
 == 3) {

2215 
	`bcf_íc_vch¨
(
°r
, 
q
 - 
p
,Ö);

2216 
v
->
n_ÆÀÀ
 = 1, v->
æí
 = 
q
 - 
p
;

2217 } i‡(
i
 == 4) {

2218 i‡(
	`°rcmp
(
p
, ".")) {

2219 
r
 = 
t
 = 
p
;; ++r) {

2220 i‡(*
r
 == ',' || *r == 0) {

2221 
	`bcf_íc_vch¨
(
°r
, 
r
 - 
t
,Å);

2222 
t
 = 
r
 + 1;

2223 ++
v
->
n_ÆÀÀ
;

2225 i‡(
r
 =
q
) ;

2228 } i‡(
i
 == 5) {

2229 i‡(
	`°rcmp
(
p
, ".")Ë
v
->
quÆ
 = 
	`©of
(p);

2230 
	`bcf_Êﬂt_£t_missög
(
v
->
quÆ
);

2231 i‡–
v
->
max_u≈ack
 && !(v->max_u≈ack>>1ËË
íd
;

2232 } i‡(
i
 == 6) {

2233 i‡(
	`°rcmp
(
p
, ".")) {

2234 
n_Êt
 = 1, 
i
;

2235 
ks_tokaux_t
 
aux1
;

2236 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
BCF_DT_ID
];

2238 i‡(*(
q
-1) == ';') *(q-1) = 0;

2239 
r
 = 
p
; *r; ++r)

2240 i‡(*
r
 =';'Ë++
n_Êt
;

2241 i‡(
n_Êt
 > 
max_n_Êt
) {

2242 
öt32_t
 *
a
 = 
	`ªÆloc
(
Êt_a
, 
n_Êt
 * (int32_t));

2243 i‡(!
a
) {

2244 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇŸáŒoˇã mem‹y\n", 
__func__
);

2245 
v
->
îrcode
 |
BCF_ERR_LIMITS
;

2246 
îr
;

2248 
max_n_Êt
 = 
n_Êt
;

2249 
Êt_a
 = 
a
;

2252 
t
 = 
	`k°πok
(
p
, ";", &
aux1
), 
i
 = 0;Å;Å = kstrtok(0, 0, &aux1)) {

2253 *(*)
aux1
.
p
 = 0;

2254 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
t
);

2255 i‡(
k
 =
	`kh_íd
(
d
))

2259 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[W::%s] FILTER '%s' i†nŸ deföed i¿thêhódî\n", 
__func__
, 
t
);

2260 
k°rög_t
 
tmp
 = {0,0,0};

2261 
l
;

2262 
	`k•rötf
(&
tmp
, "##FILTER=<ID=%s,Des¸ùti⁄=\"Dummy\">", 
t
);

2263 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
h
,
tmp
.
s
,&
l
);

2264 
	`‰ì
(
tmp
.
s
);

2265 i‡–
	`bcf_hdr_add_hªc
((
bcf_hdr_t
*)
h
, 
hªc
ËË
	`bcf_hdr_sync
((bcf_hdr_t*)h);

2266 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
t
);

2267 
v
->
îrcode
 = 
BCF_ERR_TAG_UNDEF
;

2268 i‡(
k
 =
	`kh_íd
(
d
)) {

2269 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇŸádd dummy hódî f‹ FILTER '%s'\n", 
__func__
, 
t
);

2270 
v
->
îrcode
 |
BCF_ERR_TAG_INVALID
;

2271 
îr
;

2274 
Êt_a
[
i
++] = 
	`kh_vÆ
(
d
, 
k
).
id
;

2276 
n_Êt
 = 
i
;

2277 
	`bcf_íc_vöt
(
°r
, 
n_Êt
, 
Êt_a
, -1);

2278 } 
	`bcf_íc_vöt
(
°r
, 0, 0, -1);

2279 i‡–
v
->
max_u≈ack
 && !(v->max_u≈ack>>2ËË
íd
;

2280 } i‡(
i
 == 7) {

2281 *
key
;

2282 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
BCF_DT_ID
];

2283 
v
->
n_öfo
 = 0;

2284 i‡(
	`°rcmp
(
p
, ".")) {

2285 i‡(*(
q
-1) == ';') *(q-1) = 0;

2286 
r
 = 
key
 = 
p
;; ++r) {

2287 
c
;

2288 *
vÆ
, *
íd
;

2289 i‡(*
r
 != ';' && *r != '=' && *r != 0) ;

2290 
vÆ
 = 
íd
 = 0;

2291 
c
 = *
r
; *r = 0;

2292 i‡(
c
 == '=') {

2293 
vÆ
 = 
r
 + 1;

2294 
íd
 = 
vÆ
; *end != ';' && *end != 0; ++end);

2295 
c
 = *
íd
; *end = 0;

2296 } 
íd
 = 
r
;

2297 i‡–!*
key
 ) { i‡(
c
==0Ë; 
r
 = 
íd
; key =Ñ + 1; ; }

2298 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
key
);

2299 i‡(
k
 =
	`kh_íd
(
d
Ë|| 
	`kh_vÆ
(d, k).
öfo
[
BCF_HL_INFO
] == 15)

2301 i‡(
hts_vîbo£
 >2Ë
	`Ârötf
(
°dîr
, "[W::%s] INFO '%s' i†nŸ deföed i¿thêhódî,ássumög Ty≥=Såög\n", 
__func__
, 
key
);

2302 
k°rög_t
 
tmp
 = {0,0,0};

2303 
l
;

2304 
	`k•rötf
(&
tmp
, "##INFO=<ID=%s,Numbî=1,Ty≥=Såög,Des¸ùti⁄=\"Dummy\">", 
key
);

2305 
bcf_hªc_t
 *
hªc
 = 
	`bcf_hdr_∑r£_löe
(
h
,
tmp
.
s
,&
l
);

2306 
	`‰ì
(
tmp
.
s
);

2307 i‡–
	`bcf_hdr_add_hªc
((
bcf_hdr_t
*)
h
, 
hªc
ËË
	`bcf_hdr_sync
((bcf_hdr_t*)h);

2308 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
key
);

2309 
v
->
îrcode
 = 
BCF_ERR_TAG_UNDEF
;

2310 i‡(
k
 =
	`kh_íd
(
d
)) {

2311 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇŸádd dummy hódî f‹ INFO '%s'\n", 
__func__
, 
key
);

2312 
v
->
îrcode
 |
BCF_ERR_TAG_INVALID
;

2313 
îr
;

2316 
uöt32_t
 
y
 = 
	`kh_vÆ
(
d
, 
k
).
öfo
[
BCF_HL_INFO
];

2317 ++
v
->
n_öfo
;

2318 
	`bcf_íc_öt1
(
°r
, 
	`kh_vÆ
(
d
, 
k
).
id
);

2319 i‡(
vÆ
 == 0) {

2320 
	`bcf_íc_size
(
°r
, 0, 
BCF_BT_NULL
);

2321 } i‡((
y
>>4&0xfË=
BCF_HT_FLAG
 || (y>>4&0xfË=
BCF_HT_STR
) {

2322 
	`bcf_íc_vch¨
(
°r
, 
íd
 - 
vÆ
, val);

2324 
i
, 
n_vÆ
;

2325 *
t
, *
ã
;

2326 
t
 = 
vÆ
, 
n_vÆ
 = 1; *t; ++t)

2327 i‡(*
t
 =','Ë++
n_vÆ
;

2329 i‡(
n_vÆ
 > 
max_n_vÆ
) {

2330 
öt32_t
 *
z
;

2331 
z
 = (
öt32_t
 *)
	`ªÆloc
((*)
vÆ_a
, 
n_vÆ
 * (*z));

2332 i‡(!
z
) {

2333 
	`Ârötf
(
°dîr
, "[E::%s] CouldÇŸáŒoˇã mem‹y\n", 
__func__
);

2334 
v
->
îrcode
 |
BCF_ERR_LIMITS
;

2335 
îr
;

2337 
max_n_vÆ
 = 
n_vÆ
;

2338 
vÆ_a
 = 
z
;

2340 i‡((
y
>>4&0xfË=
BCF_HT_INT
) {

2341 
i
 = 0, 
t
 = 
vÆ
; i < 
n_vÆ
; ++i, ++t)

2343 
vÆ_a
[
i
] = 
	`°πﬁ
(
t
, &
ã
, 10);

2344 i‡–
ã
==
t
 )

2346 
vÆ_a
[
i
] = 
bcf_öt32_missög
;

2347  *
ã
 && *te!=',' )Åe++;

2349 
t
 = 
ã
;

2351 
	`bcf_íc_vöt
(
°r
, 
n_vÆ
, 
vÆ_a
, -1);

2352 i‡(
	`°rcmp
(
key
, "END"Ë=0Ë
v
->
æí
 = 
vÆ_a
[0] - v->
pos
;

2353 } i‡((
y
>>4&0xfË=
BCF_HT_REAL
) {

2354 *
vÆ_f
 = (*)
vÆ_a
;

2355 
i
 = 0, 
t
 = 
vÆ
; i < 
n_vÆ
; ++i, ++t)

2357 
vÆ_f
[
i
] = 
	`°πod
(
t
, &
ã
);

2358 i‡–
ã
==
t
 )

2360 
	`bcf_Êﬂt_£t_missög
(
vÆ_f
[
i
]);

2361  *
ã
 && *te!=',' )Åe++;

2363 
t
 = 
ã
;

2365 
	`bcf_íc_vÊﬂt
(
°r
, 
n_vÆ
, 
vÆ_f
);

2368 i‡(
c
 == 0) ;

2369 
r
 = 
íd
;

2370 
key
 = 
r
 + 1;

2373 i‡–
v
->
max_u≈ack
 && !(v->max_u≈ack>>3ËË
íd
;

2374 } i‡(
i
 == 8) {

2375 
	`‰ì
(
Êt_a
);

2376 
	`‰ì
(
vÆ_a
);

2377  
	`vcf_∑r£_f‹m©
(
s
, 
h
, 
v
, 
p
, 
q
);

2381 
íd
:

2382 
ªt
 = 0;

2384 
îr
:

2385 
	`‰ì
(
Êt_a
);

2386 
	`‰ì
(
vÆ_a
);

2387  
ªt
;

2388 
	}
}

2390 
	$vcf_ªad
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
)

2392 
ªt
;

2393 
ªt
 = 
	`hts_gëlöe
(
Â
, 
KS_SEP_LINE
, &Â->
löe
);

2394 i‡(
ªt
 < 0) Ñet;

2395  
	`vcf_∑r£1
(&
Â
->
löe
, 
h
, 
v
);

2396 
	}
}

2398 
ölöe
 
uöt8_t
 *
	$bcf_u≈ack_fmt_c‹e1
(
uöt8_t
 *
±r
, 
n_ßm∂e
, 
bcf_fmt_t
 *
fmt
)

2400 
uöt8_t
 *
±r_°¨t
 = 
±r
;

2401 
fmt
->
id
 = 
	`bcf_dec_ty≥d_öt1
(
±r
, &ptr);

2402 
fmt
->
n
 = 
	`bcf_dec_size
(
±r
, &±r, &fmt->
ty≥
);

2403 
fmt
->
size
 = fmt->
n
 << 
bcf_ty≥_shi·
[fmt->
ty≥
];

2404 
fmt
->
p
 = 
±r
;

2405 
fmt
->
p_off
 = 
±r
 - 
±r_°¨t
;

2406 
fmt
->
p_‰ì
 = 0;

2407 
±r
 +
n_ßm∂e
 * 
fmt
->
size
;

2408 
fmt
->
p_Àn
 = 
±r
 - fmt->
p
;

2409  
±r
;

2410 
	}
}

2412 
ölöe
 
uöt8_t
 *
	$bcf_u≈ack_öfo_c‹e1
(
uöt8_t
 *
±r
, 
bcf_öfo_t
 *
öfo
)

2414 
uöt8_t
 *
±r_°¨t
 = 
±r
;

2415 
öfo
->
key
 = 
	`bcf_dec_ty≥d_öt1
(
±r
, &ptr);

2416 
öfo
->
Àn
 = 
	`bcf_dec_size
(
±r
, &±r, &öfo->
ty≥
);

2417 
öfo
->
v±r
 = 
±r
;

2418 
öfo
->
v±r_off
 = 
±r
 - 
±r_°¨t
;

2419 
öfo
->
v±r_‰ì
 = 0;

2420 
öfo
->
v1
.
i
 = 0;

2421 i‡(
öfo
->
Àn
 == 1) {

2422 i‡(
öfo
->
ty≥
 =
BCF_BT_INT8
 || info->ty≥ =
BCF_BT_CHAR
Ëöfo->
v1
.
i
 = *(
öt8_t
*)
±r
;

2423 i‡(
öfo
->
ty≥
 =
BCF_BT_INT32
Ëöfo->
v1
.
i
 = 
	`À_to_i32
(
±r
);

2424 i‡(
öfo
->
ty≥
 =
BCF_BT_FLOAT
Ëöfo->
v1
.
f
 = 
	`À_to_Êﬂt
(
±r
);

2425 i‡(
öfo
->
ty≥
 =
BCF_BT_INT16
Ëöfo->
v1
.
i
 = 
	`À_to_i16
(
±r
);

2427 
±r
 +
öfo
->
Àn
 << 
bcf_ty≥_shi·
[öfo->
ty≥
];

2428 
öfo
->
v±r_Àn
 = 
±r
 - info->
v±r
;

2429  
±r
;

2430 
	}
}

2432 
	$bcf_u≈ack
(
bcf1_t
 *
b
, 
which
)

2434 i‡–!
b
->
sh¨ed
.
l
 )  0;

2435 
uöt8_t
 *
±r
 = (uöt8_t*)
b
->
sh¨ed
.
s
, *
±r_‹i
;

2436 
i
;

2437 
bcf_dec_t
 *
d
 = &
b
->d;

2438 i‡(
which
 & 
BCF_UN_FLT
Ëwhich |
BCF_UN_STR
;

2439 i‡(
which
 & 
BCF_UN_INFO
Ëwhich |
BCF_UN_SHR
;

2440 i‡((
which
&
BCF_UN_STR
Ë&& !(
b
->
u≈acked
&BCF_UN_STR))

2442 
k°rög_t
 
tmp
;

2445 
tmp
.
l
 = 0;Åmp.
s
 = 
d
->
id
;Åmp.
m
 = d->
m_id
;

2446 
±r_‹i
 = 
±r
;

2447 
±r
 = 
	`bcf_fmt_sized_¨øy
(&
tmp
,Ötr);

2448 
b
->
u≈ack_size
[0] = 
±r
 - 
±r_‹i
;

2449 
	`kputc
('\0', &
tmp
);

2450 
d
->
id
 = 
tmp
.
s
; d->
m_id
 =Åmp.
m
;

2453 
	`hts_ex∑nd
(*, 
b
->
n_ÆÀÀ
, 
d
->
m_ÆÀÀ
, d->
ÆÀÀ
);

2454 
tmp
.
l
 = 0;Åmp.
s
 = 
d
->
Æs
;Åmp.
m
 = d->
m_Æs
;

2455 
±r_‹i
 = 
±r
;

2456 *
o
 = "";

2457 
i
 = 0; i < 
b
->
n_ÆÀÀ
; ++i) {

2458 
d
->
ÆÀÀ
[
i
] = 
o
 + 
tmp
.
l
;

2459 
±r
 = 
	`bcf_fmt_sized_¨øy
(&
tmp
,Ötr);

2460 
	`kputc
('\0', &
tmp
);

2462 
b
->
u≈ack_size
[1] = 
±r
 - 
±r_‹i
;

2463 
d
->
Æs
 = 
tmp
.
s
; d->
m_Æs
 =Åmp.
m
;

2465 
i
 = 0; i < 
b
->
n_ÆÀÀ
; ++i)

2466 
d
->
ÆÀÀ
[
i
] = d->
Æs
 + (d->ÆÀÀ[i]-
o
);

2467 
b
->
u≈acked
 |
BCF_UN_STR
;

2469 i‡((
which
&
BCF_UN_FLT
Ë&& !(
b
->
u≈acked
&BCF_UN_FLT)) {

2470 
±r
 = (
uöt8_t
*)
b
->
sh¨ed
.
s
 + b->
u≈ack_size
[0] + b->unpack_size[1];

2471 
±r_‹i
 = 
±r
;

2472 i‡(*
±r
>>4) {

2473 
ty≥
;

2474 
d
->
n_Êt
 = 
	`bcf_dec_size
(
±r
, &±r, &
ty≥
);

2475 
	`hts_ex∑nd
(, 
d
->
n_Êt
, d->
m_Êt
, d->
Êt
);

2476 
i
 = 0; i < 
d
->
n_Êt
; ++i)

2477 
d
->
Êt
[
i
] = 
	`bcf_dec_öt1
(
±r
, 
ty≥
, &ptr);

2478 } ++
±r
, 
d
->
n_Êt
 = 0;

2479 
b
->
u≈ack_size
[2] = 
±r
 - 
±r_‹i
;

2480 
b
->
u≈acked
 |
BCF_UN_FLT
;

2482 i‡((
which
&
BCF_UN_INFO
Ë&& !(
b
->
u≈acked
&BCF_UN_INFO)) {

2483 
±r
 = (
uöt8_t
*)
b
->
sh¨ed
.
s
 + b->
u≈ack_size
[0] + b->unpack_size[1] + b->unpack_size[2];

2484 
	`hts_ex∑nd
(
bcf_öfo_t
, 
b
->
n_öfo
, 
d
->
m_öfo
, d->
öfo
);

2485 
i
 = 0; i < 
d
->
m_öfo
; ++iËd->
öfo
[i].
v±r_‰ì
 = 0;

2486 
i
 = 0; i < 
b
->
n_öfo
; ++i)

2487 
±r
 = 
	`bcf_u≈ack_öfo_c‹e1
’å, &
d
->
öfo
[
i
]);

2488 
b
->
u≈acked
 |
BCF_UN_INFO
;

2490 i‡((
which
&
BCF_UN_FMT
Ë&& 
b
->
n_ßm∂e
 && !(b->
u≈acked
&BCF_UN_FMT)) {

2491 
±r
 = (
uöt8_t
*)
b
->
ödiv
.
s
;

2492 
	`hts_ex∑nd
(
bcf_fmt_t
, 
b
->
n_fmt
, 
d
->
m_fmt
, d->
fmt
);

2493 
i
 = 0; i < 
d
->
m_fmt
; ++iËd->
fmt
[i].
p_‰ì
 = 0;

2494 
i
 = 0; i < 
b
->
n_fmt
; ++i)

2495 
±r
 = 
	`bcf_u≈ack_fmt_c‹e1
’å, 
b
->
n_ßm∂e
, &
d
->
fmt
[
i
]);

2496 
b
->
u≈acked
 |
BCF_UN_FMT
;

2499 
	}
}

2501 
	$vcf_f‹m©
(c⁄° 
bcf_hdr_t
 *
h
, c⁄° 
bcf1_t
 *
v
, 
k°rög_t
 *
s
)

2503 
i
;

2504 
	`bcf_u≈ack
((
bcf1_t
*)
v
, 
BCF_UN_ALL
);

2505 
	`kputs
(
h
->
id
[
BCF_DT_CTG
][
v
->
rid
].
key
, 
s
);

2506 
	`kputc
('\t', 
s
); 
	`kputw
(
v
->
pos
 + 1, s);

2507 
	`kputc
('\t', 
s
); 
	`kputs
(
v
->
d
.
id
 ? v->d.id : ".", s);

2508 
	`kputc
('\t', 
s
);

2509 i‡(
v
->
n_ÆÀÀ
 > 0Ë
	`kputs
(v->
d
.
ÆÀÀ
[0], 
s
);

2510 
	`kputc
('.', 
s
);

2511 
	`kputc
('\t', 
s
);

2512 i‡(
v
->
n_ÆÀÀ
 > 1) {

2513 
i
 = 1; i < 
v
->
n_ÆÀÀ
; ++i) {

2514 i‡(
i
 > 1Ë
	`kputc
(',', 
s
);

2515 
	`kputs
(
v
->
d
.
ÆÀÀ
[
i
], 
s
);

2517 } 
	`kputc
('.', 
s
);

2518 
	`kputc
('\t', 
s
);

2519 i‡–
	`bcf_Êﬂt_is_missög
(
v
->
quÆ
ËË
	`kputc
('.', 
s
);

2520 
	`kputd
(
v
->
quÆ
, 
s
);

2521 
	`kputc
('\t', 
s
);

2522 i‡(
v
->
d
.
n_Êt
) {

2523 
i
 = 0; i < 
v
->
d
.
n_Êt
; ++i) {

2524 i‡(
i
Ë
	`kputc
(';', 
s
);

2525 
	`kputs
(
h
->
id
[
BCF_DT_ID
][
v
->
d
.
Êt
[
i
]].
key
, 
s
);

2527 } 
	`kputc
('.', 
s
);

2528 
	`kputc
('\t', 
s
);

2529 i‡(
v
->
n_öfo
) {

2530 
fú°
 = 1;

2531 
i
 = 0; i < 
v
->
n_öfo
; ++i) {

2532 
bcf_öfo_t
 *
z
 = &
v
->
d
.
öfo
[
i
];

2533 i‡–!
z
->
v±r
 ) ;

2534 i‡–!
fú°
 ) 
	`kputc
(';', 
s
);

2535 
fú°
 = 0;

2536 
	`kputs
(
h
->
id
[
BCF_DT_ID
][
z
->
key
].key, 
s
);

2537 i‡(
z
->
Àn
 <= 0) ;

2538 
	`kputc
('=', 
s
);

2539 i‡(
z
->
Àn
 == 1)

2541 
z
->
ty≥
)

2543 
BCF_BT_INT8
: i‡–
z
->
v1
.
i
==
bcf_öt8_missög
 ) 
	`kputc
('.', 
s
); 
	`kputw
(z->v1.i, s); ;

2544 
BCF_BT_INT16
: i‡–
z
->
v1
.
i
==
bcf_öt16_missög
 ) 
	`kputc
('.', 
s
); 
	`kputw
(z->v1.i, s); ;

2545 
BCF_BT_INT32
: i‡–
z
->
v1
.
i
==
bcf_öt32_missög
 ) 
	`kputc
('.', 
s
); 
	`kputw
(z->v1.i, s); ;

2546 
BCF_BT_FLOAT
: i‡–
	`bcf_Êﬂt_is_missög
(
z
->
v1
.
f
ËË
	`kputc
('.', 
s
); 
	`kputd
(z->v1.f, s); ;

2547 
BCF_BT_CHAR
: 
	`kputc
(
z
->
v1
.
i
, 
s
); ;

2548 : 
	`Ârötf
(
°dîr
,"todo:Åy≥ %d\n", 
z
->
ty≥
); 
	`exô
(1); ;

2551 
	`bcf_fmt_¨øy
(
s
, 
z
->
Àn
, z->
ty≥
, z->
v±r
);

2553 i‡–
fú°
 ) 
	`kputc
('.', 
s
);

2554 } 
	`kputc
('.', 
s
);

2556 i‡(
v
->
n_ßm∂e
)

2558 
i
,
j
;

2559 i‡–
v
->
n_fmt
)

2561 
gt_i
 = -1;

2562 
bcf_fmt_t
 *
fmt
 = 
v
->
d
.fmt;

2563 
fú°
 = 1;

2564 
i
 = 0; i < ()
v
->
n_fmt
; ++i) {

2565 i‡–!
fmt
[
i
].
p
 ) ;

2566 
	`kputc
(!
fú°
 ? ':' : '\t', 
s
); first = 0;

2567 i‡–
fmt
[
i
].
id
<0 )

2569 
	`Ârötf
(
°dîr
, "[E::%s] invÆid BCF,ÅhêFORMATÅag id=%dÇŸÖª£¡ i¿thêhódî.\n", 
__func__
, 
fmt
[
i
].
id
);

2570 
	`ab‹t
();

2572 
	`kputs
(
h
->
id
[
BCF_DT_ID
][
fmt
[
i
].id].
key
, 
s
);

2573 i‡(
	`°rcmp
(
h
->
id
[
BCF_DT_ID
][
fmt
[
i
].id].
key
, "GT"Ë=0Ë
gt_i
 = i;

2575 i‡–
fú°
 ) 
	`kputs
("\t.", 
s
);

2576 
j
 = 0; j < 
v
->
n_ßm∂e
; ++j) {

2577 
	`kputc
('\t', 
s
);

2578 
fú°
 = 1;

2579 
i
 = 0; i < ()
v
->
n_fmt
; ++i) {

2580 
bcf_fmt_t
 *
f
 = &
fmt
[
i
];

2581 i‡–!
f
->
p
 ) ;

2582 i‡(!
fú°
Ë
	`kputc
(':', 
s
);

2583 
fú°
 = 0;

2584 i‡(
gt_i
 =
i
)

2585 
	`bcf_f‹m©_gt
(
f
,
j
,
s
);

2587 
	`bcf_fmt_¨øy
(
s
, 
f
->
n
, f->
ty≥
, f->
p
 + 
j
 * f->
size
);

2589 i‡–
fú°
 ) 
	`kputc
('.', 
s
);

2593 
j
=0; j<=
v
->
n_ßm∂e
; j++)

2594 
	`kputs
("\t.", 
s
);

2596 
	`kputc
('\n', 
s
);

2598 
	}
}

2600 
	$vcf_wrôe_löe
(
htsFûe
 *
Â
, 
k°rög_t
 *
löe
)

2602 
ªt
;

2603 i‡–
löe
->
s
[löe->
l
-1]!='\n' ) 
	`kputc
('\n',line);

2604 i‡–
Â
->
f‹m©
.
com¥essi⁄
!=
no_com¥essi⁄
 )

2605 
ªt
 = 
	`bgzf_wrôe
(
Â
->Â.
bgzf
, 
löe
->
s
,Üöe->
l
);

2607 
ªt
 = 
	`hwrôe
(
Â
->Â.
hfûe
, 
löe
->
s
,Üöe->
l
);

2608  
ªt
==
löe
->
l
 ? 0 : -1;

2609 
	}
}

2611 
	$vcf_wrôe
(
htsFûe
 *
Â
, c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
)

2613 
ªt
;

2614 
Â
->
löe
.
l
 = 0;

2615 
	`vcf_f‹m©1
(
h
, 
v
, &
Â
->
löe
);

2616 i‡–
Â
->
f‹m©
.
com¥essi⁄
!=
no_com¥essi⁄
 )

2617 
ªt
 = 
	`bgzf_wrôe
(
Â
->Â.
bgzf
, fp->
löe
.
s
, fp->löe.
l
);

2619 
ªt
 = 
	`hwrôe
(
Â
->Â.
hfûe
, fp->
löe
.
s
, fp->löe.
l
);

2620  
ªt
==
Â
->
löe
.
l
 ? 0 : -1;

2621 
	}
}

2627 
	$bcf_hdr_id2öt
(c⁄° 
bcf_hdr_t
 *
h
, 
which
, c⁄° *
id
)

2629 
khöt_t
 
k
;

2630 
vdi˘_t
 *
d
 = (vdi˘_t*)
h
->
di˘
[
which
];

2631 
k
 = 
	`kh_gë
(
vdi˘
, 
d
, 
id
);

2632  
k
 =
	`kh_íd
(
d
)? -1 : 
	`kh_vÆ
(d, k).
id
;

2633 
	}
}

2640 
hts_idx_t
 *
	$bcf_ödex
(
htsFûe
 *
Â
, 
mö_shi·
)

2642 
n_lvls
, 
i
;

2643 
bcf1_t
 *
b
 = 
NULL
;

2644 
hts_idx_t
 *
idx
 = 
NULL
;

2645 
bcf_hdr_t
 *
h
;

2646 
öt64_t
 
max_Àn
 = 0, 
s
;

2647 
r
;

2648 
h
 = 
	`bcf_hdr_ªad
(
Â
);

2649 i‡–!
h
 )  
NULL
;

2650 
nids
 = 0;

2651 
i
 = 0; i < 
h
->
n
[
BCF_DT_CTG
]; ++i)

2653 i‡–!
h
->
id
[
BCF_DT_CTG
][
i
].
vÆ
 ) ;

2654 i‡–
max_Àn
 < 
h
->
id
[
BCF_DT_CTG
][
i
].
vÆ
->
öfo
[0] ) max_len = h->id[BCF_DT_CTG][i].val->info[0];

2655 
nids
++;

2657 i‡–!
max_Àn
 ) max_À¿((
öt64_t
)1<<31) - 1;

2658 
max_Àn
 += 256;

2659 
n_lvls
 = 0, 
s
 = 1<<
mö_shi·
; 
max_Àn
 > s; ++n_lvls, s <<= 3);

2660 
idx
 = 
	`hts_idx_öô
(
nids
, 
HTS_FMT_CSI
, 
	`bgzf_ãŒ
(
Â
->Â.
bgzf
), 
mö_shi·
, 
n_lvls
);

2661 i‡(!
idx
Ë
Áû
;

2662 
b
 = 
	`bcf_öô1
();

2663 i‡(!
b
Ë
Áû
;

2664 (
r
 = 
	`bcf_ªad1
(
Â
,
h
, 
b
)) >= 0) {

2665 
ªt
;

2666 
ªt
 = 
	`hts_idx_push
(
idx
, 
b
->
rid
, b->
pos
, b->po†+ b->
æí
, 
	`bgzf_ãŒ
(
Â
->Â.
bgzf
), 1);

2667 i‡(
ªt
 < 0Ë
Áû
;

2669 i‡(
r
 < -1Ë
Áû
;

2670 
	`hts_idx_föish
(
idx
, 
	`bgzf_ãŒ
(
Â
->Â.
bgzf
));

2671 
	`bcf_de°roy1
(
b
);

2672 
	`bcf_hdr_de°roy
(
h
);

2673  
idx
;

2675 
Áû
:

2676 
	`hts_idx_de°roy
(
idx
);

2677 
	`bcf_de°roy1
(
b
);

2678 
	`bcf_hdr_de°roy
(
h
);

2679  
NULL
;

2680 
	}
}

2682 
hts_idx_t
 *
	$bcf_ödex_lﬂd2
(c⁄° *
‚
, c⁄° *
‚idx
)

2684  
‚idx
? 
	`hts_idx_lﬂd2
(
‚
, fnidxË: 
	`bcf_ödex_lﬂd
(fn);

2685 
	}
}

2687 
	$bcf_ödex_buûd3
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
, 
n_thªads
)

2689 
htsFûe
 *
Â
;

2690 
hts_idx_t
 *
idx
;

2691 
tbx_t
 *
tbx
;

2692 
ªt
;

2693 i‡((
Â
 = 
	`hts_›í
(
‚
, "rb")) == 0)  -2;

2694 i‡(
n_thªads
)

2695 
	`hts_£t_thªads
(
Â
, 
n_thªads
);

2696 i‡–
Â
->
f‹m©
.
com¥essi⁄
!=
bgzf
 ) { 
	`hts_˛o£
(fp);  -3; }

2697 
Â
->
f‹m©
.format) {

2698 
bcf
:

2699 
idx
 = 
	`bcf_ödex
(
Â
, 
mö_shi·
);

2700 i‡(
idx
) {

2701 
ªt
 = 
	`hts_idx_ßve_as
(
idx
, 
‚
, 
‚idx
, 
HTS_FMT_CSI
);

2702 i‡(
ªt
 < 0)Ñet = -4;

2703 
	`hts_idx_de°roy
(
idx
);

2705 
ªt
 = -1;

2708 
vcf
:

2709 
tbx
 = 
	`tbx_ödex
(
	`hts_gë_bgzÂ
(
Â
), 
mö_shi·
, &
tbx_c⁄f_vcf
);

2710 i‡(
tbx
) {

2711 
ªt
 = 
	`hts_idx_ßve_as
(
tbx
->
idx
, 
‚
, 
‚idx
, 
mö_shi·
 > 0 ? 
HTS_FMT_CSI
 : 
HTS_FMT_TBI
);

2712 i‡(
ªt
 < 0)Ñet = -4;

2713 
	`tbx_de°roy
(
tbx
);

2715 
ªt
 = -1;

2719 
ªt
 = -3;

2722 
	`hts_˛o£
(
Â
);

2723  
ªt
;

2724 
	}
}

2726 
	$bcf_ödex_buûd2
(c⁄° *
‚
, c⁄° *
‚idx
, 
mö_shi·
)

2728  
	`bcf_ödex_buûd3
(
‚
, 
‚idx
, 
mö_shi·
, 0);

2729 
	}
}

2731 
	$bcf_ödex_buûd
(c⁄° *
‚
, 
mö_shi·
)

2733  
	`bcf_ödex_buûd3
(
‚
, 
NULL
, 
mö_shi·
, 0);

2734 
	}
}

2740 
	$bcf_hdr_comböe
(
bcf_hdr_t
 *
d°
, c⁄° bcf_hdr_à*
§c
)

2742 
i
, 
nd°_‹i
 = 
d°
->
nhªc
, 
√ed_sync
 = 0, 
ªt
 = 0;

2743 
i
=0; i<
§c
->
nhªc
; i++)

2745 i‡–
§c
->
hªc
[
i
]->
ty≥
==
BCF_HL_GEN
 && src->hªc[i]->
vÆue
 )

2747 
j
;

2748 
j
=0; j<
nd°_‹i
; j++)

2750 i‡–
d°
->
hªc
[
j
]->
ty≥
!=
BCF_HL_GEN
 ) ;

2755 i‡–!
	`°rcmp
(
§c
->
hªc
[
i
]->
key
,
d°
->hªc[
j
]->key) ) ;

2757 i‡–
j
>=
nd°_‹i
 )

2758 
√ed_sync
 +
	`bcf_hdr_add_hªc
(
d°
, 
	`bcf_hªc_dup
(
§c
->
hªc
[
i
]));

2760 i‡–
§c
->
hªc
[
i
]->
ty≥
==
BCF_HL_STR
 )

2763 
j
 = 
	`bcf_hªc_föd_key
(
§c
->
hªc
[
i
],"ID");

2764 i‡–
j
>=0 )

2766 
bcf_hªc_t
 *
ªc
 = 
	`bcf_hdr_gë_hªc
(
d°
, 
§c
->
hªc
[
i
]->
ty≥
, "ID", src->hªc[i]->
vÆs
[
j
], src->hªc[i]->
key
);

2767 i‡–!
ªc
 )

2768 
√ed_sync
 +
	`bcf_hdr_add_hªc
(
d°
, 
	`bcf_hªc_dup
(
§c
->
hªc
[
i
]));

2773 
j
 = 
	`bcf_hªc_föd_key
(
§c
->
hªc
[
i
],"ID");

2774 
	`as£π
–
j
>=0 );

2776 
bcf_hªc_t
 *
ªc
 = 
	`bcf_hdr_gë_hªc
(
d°
, 
§c
->
hªc
[
i
]->
ty≥
, "ID", src->hªc[i]->
vÆs
[
j
], 
NULL
);

2777 i‡–!
ªc
 )

2778 
√ed_sync
 +
	`bcf_hdr_add_hªc
(
d°
, 
	`bcf_hªc_dup
(
§c
->
hªc
[
i
]));

2779 i‡–
§c
->
hªc
[
i
]->
ty≥
==
BCF_HL_INFO
 || src->hªc[i]->ty≥==
BCF_HL_FMT
 )

2783 
vdi˘_t
 *
d_§c
 = (vdi˘_t*)
§c
->
di˘
[
BCF_DT_ID
];

2784 
vdi˘_t
 *
d_d°
 = (vdi˘_t*)
d°
->
di˘
[
BCF_DT_ID
];

2785 
khöt_t
 
k_§c
 = 
	`kh_gë
(
vdi˘
, 
d_§c
, 
§c
->
hªc
[
i
]->
vÆs
[0]);

2786 
khöt_t
 
k_d°
 = 
	`kh_gë
(
vdi˘
, 
d_d°
, 
§c
->
hªc
[
i
]->
vÆs
[0]);

2787 i‡–(
	`kh_vÆ
(
d_§c
,
k_§c
).
öfo
[
ªc
->
ty≥
]>>8 & 0xfË!(kh_vÆ(
d_d°
,
k_d°
).info[rec->type]>>8 & 0xf) )

2789 
	`Ârötf
(
°dîr
,"W¨nög:ÅryögÅÿcomböê\"%s\"Åag deföôi⁄†o‡dif„ª¡Üígths\n", 
§c
->
hªc
[
i
]->
vÆs
[0]);

2790 
ªt
 |= 1;

2792 i‡–(
	`kh_vÆ
(
d_§c
,
k_§c
).
öfo
[
ªc
->
ty≥
]>>4 & 0xfË!(kh_vÆ(
d_d°
,
k_d°
).info[rec->type]>>4 & 0xf) )

2794 
	`Ârötf
(
°dîr
,"W¨nög:ÅryögÅÿcomböê\"%s\"Åag deföôi⁄†o‡dif„ª¡Åy≥s\n", 
§c
->
hªc
[
i
]->
vÆs
[0]);

2795 
ªt
 |= 1;

2800 i‡–
√ed_sync
 ) 
	`bcf_hdr_sync
(
d°
);

2801  
ªt
;

2802 
	}
}

2804 
bcf_hdr_t
 *
	$bcf_hdr_mîge
(
bcf_hdr_t
 *
d°
, c⁄° bcf_hdr_à*
§c
)

2806 i‡–!
d°
 )

2809 
d°
 = 
	`bcf_hdr_öô
("r");

2810 
k°rög_t
 
htxt
 = {0,0,0};

2811 
	`bcf_hdr_f‹m©
(
§c
, 0, &
htxt
);

2812 i‡–
	`bcf_hdr_∑r£
(
d°
, 
htxt
.
s
) < 0 ) {

2813 
	`bcf_hdr_de°roy
(
d°
);

2814 
d°
 = 
NULL
;

2816 
	`‰ì
(
htxt
.
s
);

2817  
d°
;

2820 
i
, 
nd°_‹i
 = 
d°
->
nhªc
, 
√ed_sync
 = 0, 
ªt
 = 0;

2821 
i
=0; i<
§c
->
nhªc
; i++)

2823 i‡–
§c
->
hªc
[
i
]->
ty≥
==
BCF_HL_GEN
 && src->hªc[i]->
vÆue
 )

2825 
j
;

2826 
j
=0; j<
nd°_‹i
; j++)

2828 i‡–
d°
->
hªc
[
j
]->
ty≥
!=
BCF_HL_GEN
 ) ;

2833 i‡–!
	`°rcmp
(
§c
->
hªc
[
i
]->
key
,
d°
->hªc[
j
]->key) ) ;

2835 i‡–
j
>=
nd°_‹i
 )

2836 
√ed_sync
 +
	`bcf_hdr_add_hªc
(
d°
, 
	`bcf_hªc_dup
(
§c
->
hªc
[
i
]));

2838 i‡–
§c
->
hªc
[
i
]->
ty≥
==
BCF_HL_STR
 )

2841 
j
 = 
	`bcf_hªc_föd_key
(
§c
->
hªc
[
i
],"ID");

2842 i‡–
j
>=0 )

2844 
bcf_hªc_t
 *
ªc
 = 
	`bcf_hdr_gë_hªc
(
d°
, 
§c
->
hªc
[
i
]->
ty≥
, "ID", src->hªc[i]->
vÆs
[
j
], src->hªc[i]->
key
);

2845 i‡–!
ªc
 )

2846 
√ed_sync
 +
	`bcf_hdr_add_hªc
(
d°
, 
	`bcf_hªc_dup
(
§c
->
hªc
[
i
]));

2851 
j
 = 
	`bcf_hªc_föd_key
(
§c
->
hªc
[
i
],"ID");

2852 
	`as£π
–
j
>=0 );

2854 
bcf_hªc_t
 *
ªc
 = 
	`bcf_hdr_gë_hªc
(
d°
, 
§c
->
hªc
[
i
]->
ty≥
, "ID", src->hªc[i]->
vÆs
[
j
], 
NULL
);

2855 i‡–!
ªc
 )

2856 
√ed_sync
 +
	`bcf_hdr_add_hªc
(
d°
, 
	`bcf_hªc_dup
(
§c
->
hªc
[
i
]));

2857 i‡–
§c
->
hªc
[
i
]->
ty≥
==
BCF_HL_INFO
 || src->hªc[i]->ty≥==
BCF_HL_FMT
 )

2861 
vdi˘_t
 *
d_§c
 = (vdi˘_t*)
§c
->
di˘
[
BCF_DT_ID
];

2862 
vdi˘_t
 *
d_d°
 = (vdi˘_t*)
d°
->
di˘
[
BCF_DT_ID
];

2863 
khöt_t
 
k_§c
 = 
	`kh_gë
(
vdi˘
, 
d_§c
, 
§c
->
hªc
[
i
]->
vÆs
[0]);

2864 
khöt_t
 
k_d°
 = 
	`kh_gë
(
vdi˘
, 
d_d°
, 
§c
->
hªc
[
i
]->
vÆs
[0]);

2865 i‡–(
	`kh_vÆ
(
d_§c
,
k_§c
).
öfo
[
ªc
->
ty≥
]>>8 & 0xfË!(kh_vÆ(
d_d°
,
k_d°
).info[rec->type]>>8 & 0xf) )

2867 
	`Ârötf
(
°dîr
,"W¨nög:ÅryögÅÿcomböê\"%s\"Åag deföôi⁄†o‡dif„ª¡Üígths\n", 
§c
->
hªc
[
i
]->
vÆs
[0]);

2868 
ªt
 |= 1;

2870 i‡–(
	`kh_vÆ
(
d_§c
,
k_§c
).
öfo
[
ªc
->
ty≥
]>>4 & 0xfË!(kh_vÆ(
d_d°
,
k_d°
).info[rec->type]>>4 & 0xf) )

2872 
	`Ârötf
(
°dîr
,"W¨nög:ÅryögÅÿcomböê\"%s\"Åag deföôi⁄†o‡dif„ª¡Åy≥s\n", 
§c
->
hªc
[
i
]->
vÆs
[0]);

2873 
ªt
 |= 1;

2878 i‡–
√ed_sync
 ) 
	`bcf_hdr_sync
(
d°
);

2879  
d°
;

2880 
	}
}

2881 
	$bcf_å™¶©e
(c⁄° 
bcf_hdr_t
 *
d°_hdr
, bcf_hdr_à*
§c_hdr
, 
bcf1_t
 *
löe
)

2883 
i
;

2884 i‡–
löe
->
îrcode
 )

2886 
	`Ârötf
(
°dîr
,"[%s:%d %s] UncheckedÉº‹ (%d),Éxôög.\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,
löe
->
îrcode
);

2887 
	`exô
(1);

2889 i‡–
§c_hdr
->
¡øn¶
==-1 )  0;

2890 i‡–!
§c_hdr
->
¡øn¶
 )

2892 
di˘
;

2893 
di˘
=0; dict<2; dict++)

2895 
§c_hdr
->
å™¶
[
di˘
] = (*Ë
	`mÆloc
(§c_hdr->
n
[dict]*());

2896 
i
=0; i<
§c_hdr
->
n
[
di˘
]; i++)

2898 i‡–!
§c_hdr
->
id
[
di˘
][
i
].
key
 )

2900 
§c_hdr
->
å™¶
[
di˘
][
i
] = -1;

2903 
§c_hdr
->
å™¶
[
di˘
][
i
] = 
	`bcf_hdr_id2öt
(
d°_hdr
,di˘,§c_hdr->
id
[di˘][i].
key
);

2904 i‡–
§c_hdr
->
å™¶
[
di˘
][
i
]!=-1 && i!=§c_hdr->å™¶[di˘][i] ) src_hdr->
¡øn¶
++;

2907 i‡–!
§c_hdr
->
¡øn¶
 )

2909 
	`‰ì
(
§c_hdr
->
å™¶
[0]); src_hdr->å™¶[0] = 
NULL
;

2910 
	`‰ì
(
§c_hdr
->
å™¶
[1]); src_hdr->å™¶[1] = 
NULL
;

2911 
§c_hdr
->
¡øn¶
 = -1;

2913 i‡–
§c_hdr
->
¡øn¶
==-1 )  0;

2915 
	`bcf_u≈ack
(
löe
,
BCF_UN_ALL
);

2918 i‡–
§c_hdr
->
å™¶
[
BCF_DT_CTG
][
löe
->
rid
] >=0 )Üine->rid = src_hdr->transl[BCF_DT_CTG][line->rid];

2921 
i
=0; i<
löe
->
d
.
n_Êt
; i++)

2923 
§c_id
 = 
löe
->
d
.
Êt
[
i
];

2924 i‡–
§c_hdr
->
å™¶
[
BCF_DT_ID
][
§c_id
] >=0 )

2925 
löe
->
d
.
Êt
[
i
] = 
§c_hdr
->
å™¶
[
BCF_DT_ID
][
§c_id
];

2926 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_FLT
;

2930 
i
=0; i<
löe
->
n_öfo
; i++)

2932 
§c_id
 = 
löe
->
d
.
öfo
[
i
].
key
;

2933 
d°_id
 = 
§c_hdr
->
å™¶
[
BCF_DT_ID
][
§c_id
];

2934 i‡–
d°_id
<0 ) ;

2935 
§c_size
 = 
§c_id
>>7 ? ( src_id>>15 ? 
BCF_BT_INT32
 : 
BCF_BT_INT16
Ë: 
BCF_BT_INT8
;

2936 
d°_size
 = 
d°_id
>>7 ? ( d°_id>>15 ? 
BCF_BT_INT32
 : 
BCF_BT_INT16
Ë: 
BCF_BT_INT8
;

2937 i‡–
§c_size
==
d°_size
 )

2939 
löe
->
d
.
öfo
[
i
].
key
 = 
d°_id
;

2940 
uöt8_t
 *
v±r
 = 
löe
->
d
.
öfo
[
i
].v±∏-Üöe->d.öfo[i].
v±r_off
;

2941 i‡–
d°_size
==
BCF_BT_INT8
 ) { 
v±r
[1] = (
uöt8_t
)
d°_id
; }

2942 i‡–
d°_size
==
BCF_BT_INT16
 ) { *(
uöt16_t
*)
v±r
 = (uöt16_t)
d°_id
; }

2943 { *(
uöt32_t
*)
v±r
 = (uöt32_t)
d°_id
; }

2947 
bcf_öfo_t
 *
öfo
 = &
löe
->
d
.öfo[
i
];

2948 
	`as£π
–!
öfo
->
v±r_‰ì
 );

2949 
k°rög_t
 
°r
 = {0,0,0};

2950 
	`bcf_íc_öt1
(&
°r
, 
d°_id
);

2951 
	`bcf_íc_size
(&
°r
, 
öfo
->
Àn
,öfo->
ty≥
);

2952 
öfo
->
v±r_off
 = 
°r
.
l
;

2953 
	`kput¢
((*)
öfo
->
v±r
, info->
v±r_Àn
, &
°r
);

2954 
öfo
->
v±r
 = (
uöt8_t
*)
°r
.
s
 + info->
v±r_off
;

2955 
öfo
->
v±r_‰ì
 = 1;

2956 
öfo
->
key
 = 
d°_id
;

2957 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_INF
;

2962 
i
=0; i<
löe
->
n_fmt
; i++)

2964 
§c_id
 = 
löe
->
d
.
fmt
[
i
].
id
;

2965 
d°_id
 = 
§c_hdr
->
å™¶
[
BCF_DT_ID
][
§c_id
];

2966 i‡–
d°_id
<0 ) ;

2967 
§c_size
 = 
§c_id
>>7 ? ( src_id>>15 ? 
BCF_BT_INT32
 : 
BCF_BT_INT16
Ë: 
BCF_BT_INT8
;

2968 
d°_size
 = 
d°_id
>>7 ? ( d°_id>>15 ? 
BCF_BT_INT32
 : 
BCF_BT_INT16
Ë: 
BCF_BT_INT8
;

2969 i‡–
§c_size
==
d°_size
 )

2971 
löe
->
d
.
fmt
[
i
].
id
 = 
d°_id
;

2972 
uöt8_t
 *
p
 = 
löe
->
d
.
fmt
[
i
].∞-Üöe->d.fmt[i].
p_off
;

2973 i‡–
d°_size
==
BCF_BT_INT8
 ) { 
p
[1] = 
d°_id
; }

2974 i‡–
d°_size
==
BCF_BT_INT16
 ) { 
uöt8_t
 *
x
 = (uöt8_t*Ë&
d°_id
; 
p
[1] = x[0];Ö[2] = x[1]; }

2975 { 
uöt8_t
 *
x
 = (uöt8_t*Ë&
d°_id
; 
p
[1] = x[0];Ö[2] = x[1];Ö[3] = x[2];Ö[4] = x[3]; }

2979 
bcf_fmt_t
 *
fmt
 = &
löe
->
d
.fmt[
i
];

2980 
	`as£π
–!
fmt
->
p_‰ì
 );

2981 
k°rög_t
 
°r
 = {0,0,0};

2982 
	`bcf_íc_öt1
(&
°r
, 
d°_id
);

2983 
	`bcf_íc_size
(&
°r
, 
fmt
->
n
, fmt->
ty≥
);

2984 
fmt
->
p_off
 = 
°r
.
l
;

2985 
	`kput¢
((*)
fmt
->
p
, fmt->
p_Àn
, &
°r
);

2986 
fmt
->
p
 = (
uöt8_t
*)
°r
.
s
 + fmt->
p_off
;

2987 
fmt
->
p_‰ì
 = 1;

2988 
fmt
->
id
 = 
d°_id
;

2989 
löe
->
d
.
ödiv_dúty
 = 1;

2993 
	}
}

2995 
bcf_hdr_t
 *
	$bcf_hdr_dup
(c⁄° 
bcf_hdr_t
 *
hdr
)

2997 
bcf_hdr_t
 *
hout
 = 
	`bcf_hdr_öô
("r");

2998 i‡(!
hout
) {

2999 
	`Ârötf
(
°dîr
, "[E::%s] faûedÅÿÆloˇã bc‡hódî\n", 
__func__
);

3000  
NULL
;

3002 
k°rög_t
 
htxt
 = {0,0,0};

3003 
	`bcf_hdr_f‹m©
(
hdr
, 1, &
htxt
);

3004 i‡–
	`bcf_hdr_∑r£
(
hout
, 
htxt
.
s
) < 0 ) {

3005 
	`bcf_hdr_de°roy
(
hout
);

3006 
hout
 = 
NULL
;

3008 
	`‰ì
(
htxt
.
s
);

3009  
hout
;

3010 
	}
}

3012 
bcf_hdr_t
 *
	$bcf_hdr_sub£t
(c⁄° 
bcf_hdr_t
 *
h0
, 
n
, *c⁄°* 
ßm∂es
, *
im≠
)

3014 *
«mes_hash
 = 
	`khash_°r2öt_öô
();

3015 
k°rög_t
 
htxt
 = {0,0,0};

3016 
k°rög_t
 
°r
 = {0,0,0};

3017 
bcf_hdr_t
 *
h
 = 
	`bcf_hdr_öô
("w");

3018 i‡(!
h
) {

3019 
	`Ârötf
(
°dîr
, "[E::%s] faûedÅÿÆloˇã bc‡hódî\n", 
__func__
);

3020  
NULL
;

3022 
	`bcf_hdr_f‹m©
(
h0
, 1, &
htxt
);

3023 
	`bcf_hdr_£t_vîsi⁄
(
h
,
	`bcf_hdr_gë_vîsi⁄
(
h0
));

3024 
j
;

3025 
j
=0; j<
n
; j++Ë
im≠
[j] = -1;

3026 i‡–
	`bcf_hdr_nßm∂es
(
h0
) > 0) {

3027 *
p
 = 
	`föd_chrom_hódî_löe
(
htxt
.
s
);

3028 
i
 = 0, 
íd
 = 
n
? 8 : 7;

3029 (
p
 = 
	`°rchr
’, '\t')Ë!0 && 
i
 < 
íd
) ++i, ++p;

3030 i‡(
i
 !
íd
) {

3031 
	`‰ì
(
h
); fªe(
°r
.
s
);

3034 
	`kput¢
(
htxt
.
s
, 
p
 - htxt.s, &
°r
);

3035 
i
 = 0; i < 
n
; ++i) {

3036 i‡–
	`khash_°r2öt_has_key
(
«mes_hash
,
ßm∂es
[
i
]) )

3038 
	`Ârötf
(
°dîr
,"[E::bcf_hdr_sub£t] Du∂iˇã sam∂ê«mê\"%s\".\n", 
ßm∂es
[
i
]);

3039 
	`‰ì
(
°r
.
s
);

3040 
	`‰ì
(
htxt
.
s
);

3041 
	`khash_°r2öt_de°roy
(
«mes_hash
);

3042 
	`bcf_hdr_de°roy
(
h
);

3043  
NULL
;

3045 
im≠
[
i
] = 
	`bcf_hdr_id2öt
(
h0
, 
BCF_DT_SAMPLE
, 
ßm∂es
[i]);

3046 i‡(
im≠
[
i
] < 0) ;

3047 
	`kputc
('\t', &
°r
);

3048 
	`kputs
(
ßm∂es
[
i
], &
°r
);

3049 
	`khash_°r2öt_öc
(
«mes_hash
,
ßm∂es
[
i
]);

3051 } 
	`kput¢
(
htxt
.
s
, htxt.
l
, &
°r
);

3052 
°r
.
l
 && (!°r.
s
[str.l-1] || str.s[str.l-1]=='\n') ) str.l--;

3053 
	`kputc
('\n',&
°r
);

3054 i‡–
	`bcf_hdr_∑r£
(
h
, 
°r
.
s
) < 0 ) {

3055 
	`bcf_hdr_de°roy
(
h
);

3056 
h
 = 
NULL
;

3058 
	`‰ì
(
°r
.
s
);

3059 
	`‰ì
(
htxt
.
s
);

3060 
	`khash_°r2öt_de°roy
(
«mes_hash
);

3061  
h
;

3062 
	}
}

3064 
	$bcf_hdr_£t_ßm∂es
(
bcf_hdr_t
 *
hdr
, c⁄° *
ßm∂es
, 
is_fûe
)

3066 i‡–
ßm∂es
 && !
	`°rcmp
("-",samples) )  0;

3068 
hdr
->
nßm∂es_‹i
 = 
	`bcf_hdr_nßm∂es
(hdr);

3069 i‡–!
ßm∂es
 ) { 
	`bcf_hdr_nßm∂es
(
hdr
) = 0;  0; }

3071 
i
, 
«º
 = 
	`bô_¨øy_size
(
	`bcf_hdr_nßm∂es
(
hdr
));

3072 
hdr
->
kìp_ßm∂es
 = (
uöt8_t
*Ë
	`ˇŒoc
(
«º
,1);

3073 i‡–
ßm∂es
[0]=='^' )

3074 
i
=0; i<
	`bcf_hdr_nßm∂es
(
hdr
); i++Ë
	`bô_¨øy_£t
(hdr->
kìp_ßm∂es
,i);

3076 
idx
, 
n
, 
ªt
 = 0;

3077 **
sm∂s
 = 
	`hts_ªadli°
(
ßm∂es
[0]=='^'?ßm∂es+1:ßm∂es, 
is_fûe
, &
n
);

3078 i‡–!
sm∂s
 )  -1;

3079 
i
=0; i<
n
; i++)

3081 
idx
 = 
	`bcf_hdr_id2öt
(
hdr
,
BCF_DT_SAMPLE
,
sm∂s
[
i
]);

3082 i‡–
idx
<0 )

3084 i‡–!
ªt
 )Ñë = 
i
+1;

3087 
	`as£π
–
idx
<
	`bcf_hdr_nßm∂es
(
hdr
) );

3088 i‡–
ßm∂es
[0]=='^' )

3089 
	`bô_¨øy_˛ór
(
hdr
->
kìp_ßm∂es
, 
idx
);

3091 
	`bô_¨øy_£t
(
hdr
->
kìp_ßm∂es
, 
idx
);

3093 
i
=0; i<
n
; i++Ë
	`‰ì
(
sm∂s
[i]);

3094 
	`‰ì
(
sm∂s
);

3096 
	`bcf_hdr_nßm∂es
(
hdr
) = 0;

3097 
i
=0; i<
hdr
->
nßm∂es_‹i
; i++)

3098 i‡–
	`bô_¨øy_ã°
(
hdr
->
kìp_ßm∂es
,
i
ËË
	`bcf_hdr_nßm∂es
(hdr)++;

3099 i‡–!
	`bcf_hdr_nßm∂es
(
hdr
ËË{ 
	`‰ì
(hdr->
kìp_ßm∂es
); hdr->kìp_ßm∂es=
NULL
; }

3102 **
ßm∂es
 = (**Ë
	`mÆloc
((*)*
	`bcf_hdr_nßm∂es
(
hdr
));

3103 
idx
 = 0;

3104 
i
=0; i<
hdr
->
nßm∂es_‹i
; i++)

3105 i‡–
	`bô_¨øy_ã°
(
hdr
->
kìp_ßm∂es
,
i
ËË
ßm∂es
[
idx
++] = 
	`°rdup
(hdr->samples[i]);

3106 
	`‰ì
(
hdr
->
ßm∂es
);

3107 
hdr
->
ßm∂es
 = samples;

3110 
vdi˘_t
 *
d
 = (vdi˘_t*)
hdr
->
di˘
[
BCF_DT_SAMPLE
];

3111 
k
;

3112 
k
 = 
	`kh_begö
(
d
); k !
	`kh_íd
(d); ++k)

3113 i‡(
	`kh_exi°
(
d
, 
k
)Ë
	`‰ì
((*)
	`kh_key
(d, k));

3114 
	`kh_de°roy
(
vdi˘
, 
d
);

3117 
hdr
->
di˘
[
BCF_DT_SAMPLE
] = 
d
 = 
	`kh_öô
(
vdi˘
);

3118 
i
=0; i<
	`bcf_hdr_nßm∂es
(
hdr
); i++)

3120 
ign‹e
, 
k
 = 
	`kh_put
(
vdi˘
, 
d
, 
hdr
->
ßm∂es
[
i
], &ignore);

3121 
	`kh_vÆ
(
d
, 
k
Ë
bcf_idöfo_def
;

3122 
	`kh_vÆ
(
d
, 
k
).
id
 = 
	`kh_size
(d) - 1;

3124 
	`bcf_hdr_sync
(
hdr
);

3127  
ªt
;

3128 
	}
}

3130 
	$bcf_sub£t
(c⁄° 
bcf_hdr_t
 *
h
, 
bcf1_t
 *
v
, 
n
, *
im≠
)

3132 
k°rög_t
 
öd
;

3133 
öd
.
s
 = 0; ind.
l
 = ind.
m
 = 0;

3134 i‡(
n
) {

3135 
bcf_fmt_t
 
fmt
[
MAX_N_FMT
];

3136 
i
, 
j
;

3137 
uöt8_t
 *
±r
 = (uöt8_t*)
v
->
ödiv
.
s
;

3138 
i
 = 0; i < 
v
->
n_fmt
; ++i)

3139 
±r
 = 
	`bcf_u≈ack_fmt_c‹e1
’å, 
v
->
n_ßm∂e
, &
fmt
[
i
]);

3140 
i
 = 0; i < ()
v
->
n_fmt
; ++i) {

3141 
bcf_fmt_t
 *
f
 = &
fmt
[
i
];

3142 
	`bcf_íc_öt1
(&
öd
, 
f
->
id
);

3143 
	`bcf_íc_size
(&
öd
, 
f
->
n
, f->
ty≥
);

3144 
j
 = 0; j < 
n
; ++j)

3145 i‡(
im≠
[
j
] >0Ë
	`kput¢
((*)(
f
->
p
 + im≠[j] * f->
size
), f->size, &
öd
);

3147 
i
 = 
j
 = 0; j < 
n
; ++jËi‡(
im≠
[j] >= 0) ++i;

3148 
v
->
n_ßm∂e
 = 
i
;

3149 } 
v
->
n_ßm∂e
 = 0;

3150 i‡–!
v
->
n_ßm∂e
 ) v->
n_fmt
 = 0;

3151 
	`‰ì
(
v
->
ödiv
.
s
);

3152 
v
->
ödiv
 = 
öd
;

3153 
v
->
u≈acked
 &~
BCF_UN_FMT
;

3155 
	}
}

3157 
	$bcf_is_¢p
(
bcf1_t
 *
v
)

3159 
i
;

3160 
	`bcf_u≈ack
(
v
, 
BCF_UN_STR
);

3161 
i
 = 0; i < 
v
->
n_ÆÀÀ
; ++i)

3163 i‡–
v
->
d
.
ÆÀÀ
[
i
][1]==0 ) ;

3167 i‡–
v
->
d
.
ÆÀÀ
[
i
][0]=='<' && v->d.allele[i][1]=='X' && v->d.allele[i][2]=='>' ) ;

3168 i‡–
v
->
d
.
ÆÀÀ
[
i
][0]=='<' && v->d.allele[i][1]=='*' && v->d.allele[i][2]=='>' ) ;

3172  
i
 =
v
->
n_ÆÀÀ
;

3173 
	}
}

3175 
	$bcf_£t_v¨ü¡_ty≥
(c⁄° *
ªf
, c⁄° *
Æt
, 
v¨ü¡_t
 *
v¨
)

3178 i‡–!
ªf
[1] && !
Æt
[1] )

3180 i‡–*
Æt
 ='.' || *
ªf
==*ÆàË{ 
v¨
->
n
 = 0; v¨->
ty≥
 = 
VCF_REF
; ; }

3181 i‡–*
Æt
 ='X' ) { 
v¨
->
n
 = 0; v¨->
ty≥
 = 
VCF_REF
; ; }

3182 i‡–*
Æt
 ='*' ) { 
v¨
->
n
 = 0; v¨->
ty≥
 = 
VCF_REF
; ; }

3183 
v¨
->
n
 = 1; v¨->
ty≥
 = 
VCF_SNP
; ;

3185 i‡–
Æt
[0]=='<' )

3187 i‡–
Æt
[1]=='X' &&á…[2]=='>' ) { 
v¨
->
n
 = 0; v¨->
ty≥
 = 
VCF_REF
; ; }

3188 i‡–
Æt
[1]=='*' &&á…[2]=='>' ) { 
v¨
->
n
 = 0; v¨->
ty≥
 = 
VCF_REF
; ; }

3189 
v¨
->
ty≥
 = 
VCF_OTHER
;

3193 c⁄° *
r
 = 
ªf
, *
a
 = 
Æt
;

3194 *
r
 && *
a
 && 
	`touµî_c
(*r)==toupper_c(*a) ) {Ñ++;á++; }

3196 i‡–*
a
 && !*
r
 )

3198 i‡–*
a
==']' || *a=='[' ) { 
v¨
->
ty≥
 = 
VCF_BND
; ; }

3199  *
a
 )á++;

3200 
v¨
->
n
 = (
a
-
Æt
)-(
r
-
ªf
); v¨->
ty≥
 = 
VCF_INDEL
; ;

3202 i‡–*
r
 && !*
a
 )

3204  *
r
 )Ñ++;

3205 
v¨
->
n
 = (
a
-
Æt
)-(
r
-
ªf
); v¨->
ty≥
 = 
VCF_INDEL
; ;

3207 i‡–!*
r
 && !*
a
 )

3209 
v¨
->
n
 = 0; v¨->
ty≥
 = 
VCF_REF
; ;

3212 c⁄° *
ª
 = 
r
, *
´
 = 
a
;

3213  
ª
[1] )Ñe++;

3214  
´
[1] )áe++;

3215  
ª
>
r
 && 
´
>
a
 && 
	`touµî_c
(*re)==toupper_c(*ae) ) {Ñe--;áe--; }

3216 i‡–
´
==
a
 )

3218 i‡–
ª
==
r
 ) { 
v¨
->
n
 = 1; v¨->
ty≥
 = 
VCF_SNP
; ; }

3219 
v¨
->
n
 = -(
ª
-
r
);

3220 i‡–
	`touµî_c
(*
ª
)=Òouµî_c(*
´
ËË{ 
v¨
->
ty≥
 = 
VCF_INDEL
; ; }

3221 
v¨
->
ty≥
 = 
VCF_OTHER
; ;

3223 i‡–
ª
==
r
 )

3225 
v¨
->
n
 = 
´
-
a
;

3226 i‡–
	`touµî_c
(*
ª
)=Òouµî_c(*
´
ËË{ 
v¨
->
ty≥
 = 
VCF_INDEL
; ; }

3227 
v¨
->
ty≥
 = 
VCF_OTHER
; ;

3230 
v¨
->
ty≥
 = ( 
ª
-
r
 =
´
-
a
 ) ? 
VCF_MNP
 : 
VCF_OTHER
;

3231 
v¨
->
n
 = ( 
ª
-
r
 > 
´
-
a
 ) ? -(re-r+1) :áe-a+1;

3234 
	}
}

3236 
	$bcf_£t_v¨ü¡_ty≥s
(
bcf1_t
 *
b
)

3238 i‡–!(
b
->
u≈acked
 & 
BCF_UN_STR
ËË
	`bcf_u≈ack
(b, BCF_UN_STR);

3239 
bcf_dec_t
 *
d
 = &
b
->d;

3240 i‡–
d
->
n_v¨
 < 
b
->
n_ÆÀÀ
 )

3242 
d
->
v¨
 = (
v¨ü¡_t
 *Ë
	`ªÆloc
(d->v¨, (v¨ü¡_t)*
b
->
n_ÆÀÀ
);

3243 
d
->
n_v¨
 = 
b
->
n_ÆÀÀ
;

3245 
i
;

3246 
b
->
d
.
v¨_ty≥
 = 0;

3247 
i
=1; i<
b
->
n_ÆÀÀ
; i++)

3249 
	`bcf_£t_v¨ü¡_ty≥
(
d
->
ÆÀÀ
[0],d->ÆÀÀ[
i
], &d->
v¨
[i]);

3250 
b
->
d
.
v¨_ty≥
 |d->
v¨
[
i
].
ty≥
;

3253 
	}
}

3255 
	$bcf_gë_v¨ü¡_ty≥s
(
bcf1_t
 *
ªc
)

3257 i‡–
ªc
->
d
.
v¨_ty≥
==-1 ) 
	`bcf_£t_v¨ü¡_ty≥s
(rec);

3258  
ªc
->
d
.
v¨_ty≥
;

3259 
	}
}

3260 
	$bcf_gë_v¨ü¡_ty≥
(
bcf1_t
 *
ªc
, 
ôh_ÆÀÀ
)

3262 i‡–
ªc
->
d
.
v¨_ty≥
==-1 ) 
	`bcf_£t_v¨ü¡_ty≥s
(rec);

3263  
ªc
->
d
.
v¨
[
ôh_ÆÀÀ
].
ty≥
;

3264 
	}
}

3266 
	$bcf_upd©e_öfo
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
, c⁄° *
vÆues
, 
n
, 
ty≥
)

3269 
i
, 
öf_id
 = 
	`bcf_hdr_id2öt
(
hdr
,
BCF_DT_ID
,
key
);

3270 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_INFO
,
öf_id
) )  -1;

3271 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_INFO
ËË
	`bcf_u≈ack
(line, BCF_UN_INFO);

3273 
i
=0; i<
löe
->
n_öfo
; i++)

3274 i‡–
öf_id
==
löe
->
d
.
öfo
[
i
].
key
 ) ;

3275 
bcf_öfo_t
 *
öf
 = 
i
==
löe
->
n_öfo
 ? 
NULL
 : &löe->
d
.
öfo
[i];

3277 i‡–!
n
 || (
ty≥
==
BCF_HT_STR
 && !
vÆues
) )

3279 i‡–
n
==0 && !
	`°rcmp
("END",
key
) )

3280 
löe
->
æí
 =Üöe->
n_ÆÀÀ
 ? 
	`°æí
÷öe->
d
.
ÆÀÀ
[0]) : 0;

3281 i‡–
öf
 )

3284 i‡–
öf
->
v±r_‰ì
 )

3286 
	`‰ì
(
öf
->
v±r
 - inf->
v±r_off
);

3287 
öf
->
v±r_‰ì
 = 0;

3289 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_INF
;

3290 
öf
->
v±r
 = 
NULL
;

3291 
öf
->
v±r_off
 = inf->
v±r_Àn
 = 0;

3297 
k°rög_t
 
°r
 = {0,0,0};

3298 
	`bcf_íc_öt1
(&
°r
, 
öf_id
);

3299 i‡–
ty≥
==
BCF_HT_INT
 )

3300 
	`bcf_íc_vöt
(&
°r
, 
n
, (
öt32_t
*)
vÆues
, -1);

3301 i‡–
ty≥
==
BCF_HT_REAL
 )

3302 
	`bcf_íc_vÊﬂt
(&
°r
, 
n
, (*)
vÆues
);

3303 i‡–
ty≥
==
BCF_HT_FLAG
 ||Åy≥==
BCF_HT_STR
 )

3305 i‡–
vÆues
==
NULL
 )

3306 
	`bcf_íc_size
(&
°r
, 0, 
BCF_BT_NULL
);

3308 
	`bcf_íc_vch¨
(&
°r
, 
	`°æí
((*)
vÆues
), (*)values);

3312 
	`Ârötf
(
°dîr
, "[E::%s]Åhêty≥ %dÇŸ im∂emíãd yë\n", 
__func__
, 
ty≥
);

3313 
	`ab‹t
();

3317 i‡–
öf
 )

3320 i‡–
°r
.
l
 <
öf
->
v±r_Àn
 + inf->
v±r_off
 )

3322 i‡–
°r
.
l
 !
öf
->
v±r_Àn
 + inf->
v±r_off
 ) 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_INF
;

3323 
uöt8_t
 *
±r
 = 
öf
->
v±r
 - inf->
v±r_off
;

3324 
	`mem˝y
(
±r
, 
°r
.
s
, så.
l
);

3325 
	`‰ì
(
°r
.
s
);

3326 
v±r_‰ì
 = 
öf
->vptr_free;

3327 
	`bcf_u≈ack_öfo_c‹e1
(
±r
, 
öf
);

3328 
öf
->
v±r_‰ì
 = vptr_free;

3332 
	`as£π
–!
öf
->
v±r_‰ì
 );

3333 
	`bcf_u≈ack_öfo_c‹e1
((
uöt8_t
*)
°r
.
s
, 
öf
);

3334 
öf
->
v±r_‰ì
 = 1;

3335 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_INF
;

3341 
löe
->
n_öfo
++;

3342 
	`hts_ex∑nd0
(
bcf_öfo_t
, 
löe
->
n_öfo
,Üöe->
d
.
m_öfo
 ,Üöe->d.
öfo
);

3343 
öf
 = &
löe
->
d
.
öfo
[löe->
n_öfo
-1];

3344 
	`bcf_u≈ack_öfo_c‹e1
((
uöt8_t
*)
°r
.
s
, 
öf
);

3345 
öf
->
v±r_‰ì
 = 1;

3346 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_INF
;

3348 
löe
->
u≈acked
 |
BCF_UN_INFO
;

3350 i‡–
n
==1 && !
	`°rcmp
("END",
key
ËË
löe
->
æí
 = ((
öt32_t
*)
vÆues
)[0] -Üöe->
pos
;

3352 
	}
}

3354 
	$bcf_upd©e_f‹m©_°rög
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
, c⁄° **
vÆues
, 
n
)

3356 i‡–!
n
 )

3357  
	`bcf_upd©e_f‹m©
(
hdr
,
löe
,
key
,
NULL
,0,
BCF_HT_STR
);

3359 
i
, 
max_Àn
 = 0;

3360 
i
=0; i<
n
; i++)

3362 
Àn
 = 
	`°æí
(
vÆues
[
i
]);

3363 i‡–
Àn
 > 
max_Àn
 ) max_len =Üen;

3365 *
out
 = (*Ë
	`mÆloc
(
max_Àn
*
n
);

3366 i‡–!
out
 )  -2;

3367 
i
=0; i<
n
; i++)

3369 *
d°
 = 
out
+
i
*
max_Àn
;

3370 c⁄° *
§c
 = 
vÆues
[
i
];

3371 
j
 = 0;

3372  
§c
[
j
] ) { 
d°
[j] = src[j]; j++; }

3373 ; 
j
<
max_Àn
; j++Ë
d°
[j] = 0;

3375 
ªt
 = 
	`bcf_upd©e_f‹m©
(
hdr
,
löe
,
key
,
out
,
max_Àn
*
n
,
BCF_HT_STR
);

3376 
	`‰ì
(
out
);

3377  
ªt
;

3378 
	}
}

3380 
	$bcf_upd©e_f‹m©
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
, c⁄° *
vÆues
, 
n
, 
ty≥
)

3383 
i
, 
fmt_id
 = 
	`bcf_hdr_id2öt
(
hdr
,
BCF_DT_ID
,
key
);

3384 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FMT
,
fmt_id
) )

3386 i‡–!
n
 )  0;

3390 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FMT
ËË
	`bcf_u≈ack
(line, BCF_UN_FMT);

3392 
i
=0; i<
löe
->
n_fmt
; i++)

3393 i‡–
löe
->
d
.
fmt
[
i
].
id
==
fmt_id
 ) ;

3394 
bcf_fmt_t
 *
fmt
 = 
i
==
löe
->
n_fmt
 ? 
NULL
 : &löe->
d
.fmt[i];

3396 i‡–!
n
 )

3398 i‡–
fmt
 )

3401 i‡–
fmt
->
p_‰ì
 )

3403 
	`‰ì
(
fmt
->
p
 - fmt->
p_off
);

3404 
fmt
->
p_‰ì
 = 0;

3406 
löe
->
d
.
ödiv_dúty
 = 1;

3407 
fmt
->
p
 = 
NULL
;

3412 
löe
->
n_ßm∂e
 = 
	`bcf_hdr_nßm∂es
(
hdr
);

3413 
≈s
 = 
n
 / 
löe
->
n_ßm∂e
;

3414 
	`as£π
–
≈s
 &&Çps*
löe
->
n_ßm∂e
==
n
 );

3417 
k°rög_t
 
°r
 = {0,0,0};

3418 
	`bcf_íc_öt1
(&
°r
, 
fmt_id
);

3419 i‡–
ty≥
==
BCF_HT_INT
 )

3420 
	`bcf_íc_vöt
(&
°r
, 
n
, (
öt32_t
*)
vÆues
, 
≈s
);

3421 i‡–
ty≥
==
BCF_HT_REAL
 )

3423 
	`bcf_íc_size
(&
°r
, 
≈s
, 
BCF_BT_FLOAT
);

3424 
	`£rülize_Êﬂt_¨øy
(&
°r
, 
≈s
*
löe
->
n_ßm∂e
, (*Ë
vÆues
);

3426 i‡–
ty≥
==
BCF_HT_STR
 )

3428 
	`bcf_íc_size
(&
°r
, 
≈s
, 
BCF_BT_CHAR
);

3429 
	`kput¢
((*)
vÆues
, 
≈s
*
löe
->
n_ßm∂e
, &
°r
);

3433 
	`Ârötf
(
°dîr
, "[E::%s]Åhêty≥ %dÇŸ im∂emíãd yë\n", 
__func__
, 
ty≥
);

3434 
	`ab‹t
();

3437 i‡–!
fmt
 )

3440 
löe
->
n_fmt
++;

3441 
	`hts_ex∑nd0
(
bcf_fmt_t
, 
löe
->
n_fmt
,Üöe->
d
.
m_fmt
,Üöe->d.
fmt
);

3444 i‡–
löe
->
n_fmt
 > 1 && 
key
[0]=='G' && key[1]=='T' && !key[2] )

3446 
i
=
löe
->
n_fmt
-1; i>0; i--)

3447 
löe
->
d
.
fmt
[
i
] =Üine->d.fmt[i-1];

3448 
fmt
 = &
löe
->
d
.fmt[0];

3451 
fmt
 = &
löe
->
d
.fmt[löe->
n_fmt
-1];

3452 
	`bcf_u≈ack_fmt_c‹e1
((
uöt8_t
*)
°r
.
s
, 
löe
->
n_ßm∂e
, 
fmt
);

3453 
löe
->
d
.
ödiv_dúty
 = 1;

3454 
fmt
->
p_‰ì
 = 1;

3459 i‡–
°r
.
l
 <
fmt
->
p_Àn
 + fmt->
p_off
 )

3462 i‡–
°r
.
l
 !
fmt
->
p_Àn
 + fmt->
p_off
 ) 
löe
->
d
.
ödiv_dúty
 = 1;

3463 
uöt8_t
 *
±r
 = 
fmt
->
p
 - fmt->
p_off
;

3464 
	`mem˝y
(
±r
, 
°r
.
s
, så.
l
);

3465 
	`‰ì
(
°r
.
s
);

3466 
p_‰ì
 = 
fmt
->p_free;

3467 
	`bcf_u≈ack_fmt_c‹e1
(
±r
, 
löe
->
n_ßm∂e
, 
fmt
);

3468 
fmt
->
p_‰ì
 =Ö_free;

3472 
	`as£π
–!
fmt
->
p_‰ì
 );

3473 
	`bcf_u≈ack_fmt_c‹e1
((
uöt8_t
*)
°r
.
s
, 
löe
->
n_ßm∂e
, 
fmt
);

3474 
fmt
->
p_‰ì
 = 1;

3475 
löe
->
d
.
ödiv_dúty
 = 1;

3478 
löe
->
u≈acked
 |
BCF_UN_FMT
;

3480 
	}
}

3483 
	$bcf_upd©e_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, *
Êt_ids
, 
n
)

3485 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FLT
ËË
	`bcf_u≈ack
(line, BCF_UN_FLT);

3486 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_FLT
;

3487 
löe
->
d
.
n_Êt
 = 
n
;

3488 i‡–!
n
 )  0;

3489 
	`hts_ex∑nd
(, 
löe
->
d
.
n_Êt
,Üöe->d.
m_Êt
,Üöe->d.
Êt
);

3490 
i
;

3491 
i
=0; i<
n
; i++)

3492 
löe
->
d
.
Êt
[
i
] = 
Êt_ids
[i];

3494 
	}
}

3496 
	$bcf_add_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, 
Êt_id
)

3498 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FLT
ËË
	`bcf_u≈ack
(line, BCF_UN_FLT);

3499 
i
;

3500 
i
=0; i<
löe
->
d
.
n_Êt
; i++)

3501 i‡–
Êt_id
==
löe
->
d
.
Êt
[
i
] ) ;

3502 i‡–
i
<
löe
->
d
.
n_Êt
 )  0;

3503 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_FLT
;

3504 i‡–
Êt_id
==0 )

3505 
löe
->
d
.
n_Êt
 = 1;

3506 i‡–
löe
->
d
.
n_Êt
==1 &&Üöe->d.
Êt
[0]==0 )

3507 
löe
->
d
.
n_Êt
 = 1;

3509 
löe
->
d
.
n_Êt
++;

3510 
	`hts_ex∑nd
(, 
löe
->
d
.
n_Êt
,Üöe->d.
m_Êt
,Üöe->d.
Êt
);

3511 
löe
->
d
.
Êt
[löe->d.
n_Êt
-1] = 
Êt_id
;

3513 
	}
}

3514 
	$bcf_ªmove_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, 
Êt_id
, 
∑ss
)

3516 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FLT
ËË
	`bcf_u≈ack
(line, BCF_UN_FLT);

3517 
i
;

3518 
i
=0; i<
löe
->
d
.
n_Êt
; i++)

3519 i‡–
Êt_id
==
löe
->
d
.
Êt
[
i
] ) ;

3520 i‡–
i
==
löe
->
d
.
n_Êt
 )  0;

3521 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_FLT
;

3522 i‡–
i
!=
löe
->
d
.
n_Êt
-1 ) 
	`memmove
÷öe->d.
Êt
+i,line->d.flt+i+1,(line->d.n_flt-i-1)*(*line->d.flt));

3523 
löe
->
d
.
n_Êt
--;

3524 i‡–!
löe
->
d
.
n_Êt
 && 
∑ss
 ) 
	`bcf_add_fûãr
(
hdr
,line,0);

3526 
	}
}

3528 
	$bcf_has_fûãr
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, *
fûãr
)

3530 i‡–
fûãr
[0]=='.' && !filter[1] ) filter = "PASS";

3531 
id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
fûãr
);

3532 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FLT
,
id
) )  -1;

3534 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FLT
ËË
	`bcf_u≈ack
(line, BCF_UN_FLT);

3535 i‡–
id
==0 && !
löe
->
d
.
n_Êt
)  1;

3537 
i
;

3538 
i
=0; i<
löe
->
d
.
n_Êt
; i++)

3539 i‡–
löe
->
d
.
Êt
[
i
]==
id
 )  1;

3541 
	}
}

3543 
ölöe
 
	$_bcf1_sync_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, 
«ls
)

3545 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_ALS
;

3547 
löe
->
n_ÆÀÀ
 = 
«ls
;

3548 
	`hts_ex∑nd
(*, 
löe
->
n_ÆÀÀ
,Üöe->
d
.
m_ÆÀÀ
,Üöe->d.
ÆÀÀ
);

3550 *
Æs
 = 
löe
->
d
.als;

3551 
n
 = 0;

3552 
n
<
«ls
)

3554 
löe
->
d
.
ÆÀÀ
[
n
] = 
Æs
;

3555  *
Æs
 )áls++;

3556 
Æs
++;

3557 
n
++;

3561 
bcf_öfo_t
 *
íd_öfo
 = 
	`bcf_gë_öfo
(
hdr
,
löe
,"END");

3562 
löe
->
æí
 = 
íd_öfo
 ?Énd_öfo->
v1
.
i
 : 
	`°æí
÷öe->
d
.
ÆÀÀ
[0]);

3565 
	}
}

3566 
	$bcf_upd©e_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° **
ÆÀÀs
, 
«ls
)

3568 
k°rög_t
 
tmp
 = {0,0,0};

3569 *
‰ì_ﬁd
 = 
NULL
;

3572 
i
;

3573 
i
=0; i<
«ls
; i++)

3574 i‡–
ÆÀÀs
[
i
]>=
löe
->
d
.
Æs
 &&áŒñes[i]<löe->d.Æs+löe->d.
m_Æs
 ) ;

3575 i‡–
i
==
«ls
 )

3578 
tmp
.
l
 = 0;Åmp.
s
 = 
löe
->
d
.
Æs
;Åmp.
m
 =Üöe->d.
m_Æs
;

3581 
‰ì_ﬁd
 = 
löe
->
d
.
Æs
;

3583 
i
=0; i<
«ls
; i++)

3585 
	`kputs
(
ÆÀÀs
[
i
], &
tmp
);

3586 
	`kputc
(0, &
tmp
);

3588 
löe
->
d
.
Æs
 = 
tmp
.
s
;Üöe->d.
m_Æs
 =Åmp.
m
;

3589 
	`‰ì
(
‰ì_ﬁd
);

3590  
	`_bcf1_sync_ÆÀÀs
(
hdr
,
löe
,
«ls
);

3591 
	}
}

3593 
	$bcf_upd©e_ÆÀÀs_°r
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
ÆÀÀs_°rög
)

3595 
k°rög_t
 
tmp
;

3596 
tmp
.
l
 = 0;Åmp.
s
 = 
löe
->
d
.
Æs
;Åmp.
m
 =Üöe->d.
m_Æs
;

3597 
	`kputs
(
ÆÀÀs_°rög
, &
tmp
);

3598 
löe
->
d
.
Æs
 = 
tmp
.
s
;Üöe->d.
m_Æs
 =Åmp.
m
;

3600 
«ls
 = 1;

3601 *
t
 = 
löe
->
d
.
Æs
;

3602 *
t
)

3604 i‡–*
t
==',' ) { *à0; 
«ls
++; }

3605 
t
++;

3607  
	`_bcf1_sync_ÆÀÀs
(
hdr
, 
löe
, 
«ls
);

3608 
	}
}

3610 
	$bcf_upd©e_id
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
id
)

3612 
k°rög_t
 
tmp
;

3613 
tmp
.
l
 = 0;Åmp.
s
 = 
löe
->
d
.
id
;Åmp.
m
 =Üöe->d.
m_id
;

3614 i‡–
id
 )

3615 
	`kputs
(
id
, &
tmp
);

3617 
	`kputs
(".", &
tmp
);

3618 
löe
->
d
.
id
 = 
tmp
.
s
;Üöe->d.
m_id
 =Åmp.
m
;

3619 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_ID
;

3621 
	}
}

3623 
	$bcf_add_id
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
id
)

3625 i‡–!
id
 )  0;

3627 
k°rög_t
 
tmp
;

3628 
tmp
.
l
 = 0;Åmp.
s
 = 
löe
->
d
.
id
;Åmp.
m
 =Üöe->d.
m_id
;

3630 
Àn
 = 
	`°æí
(
id
);

3631 *
d°
 = 
löe
->
d
.
id
;

3632  *
d°
 && (d°=
	`°r°r
(d°,
id
)) )

3634 i‡–
d°
[
Àn
]!=0 && dst[len]!=';' ) dst++;

3635 i‡–
d°
==
löe
->
d
.
id
 || dst[-1]==';' )  0;

3636 
d°
++;

3638 i‡–
löe
->
d
.
id
 && (line->d.id[0]!='.' ||Üine->d.id[1]) )

3640 
tmp
.
l
 = 
	`°æí
(
löe
->
d
.
id
);

3641 
	`kputc
(';',&
tmp
);

3643 
	`kputs
(
id
,&
tmp
);

3645 
löe
->
d
.
id
 = 
tmp
.
s
;Üöe->d.
m_id
 =Åmp.
m
;

3646 
löe
->
d
.
sh¨ed_dúty
 |
BCF1_DIRTY_ID
;

3649 
	}
}

3651 
bcf_fmt_t
 *
	$bcf_gë_fmt
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
)

3653 
id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
key
);

3654 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FMT
,
id
ËË 
NULL
;

3655  
	`bcf_gë_fmt_id
(
löe
, 
id
);

3656 
	}
}

3658 
bcf_öfo_t
 *
	$bcf_gë_öfo
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
key
)

3660 
id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
key
);

3661 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_INFO
,
id
ËË 
NULL
;

3662  
	`bcf_gë_öfo_id
(
löe
, 
id
);

3663 
	}
}

3665 
bcf_fmt_t
 *
	$bcf_gë_fmt_id
(
bcf1_t
 *
löe
, c⁄° 
id
)

3667 
i
;

3668 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FMT
ËË
	`bcf_u≈ack
(line, BCF_UN_FMT);

3669 
i
=0; i<
löe
->
n_fmt
; i++)

3671 i‡–
löe
->
d
.
fmt
[
i
].
id
==id )  &line->d.fmt[i];

3673  
NULL
;

3674 
	}
}

3676 
bcf_öfo_t
 *
	$bcf_gë_öfo_id
(
bcf1_t
 *
löe
, c⁄° 
id
)

3678 
i
;

3679 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_INFO
ËË
	`bcf_u≈ack
(line, BCF_UN_INFO);

3680 
i
=0; i<
löe
->
n_öfo
; i++)

3682 i‡–
löe
->
d
.
öfo
[
i
].
key
==
id
 )  &line->d.info[i];

3684  
NULL
;

3685 
	}
}

3688 
	$bcf_gë_öfo_vÆues
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
èg
, **
d°
, *
nd°
, 
ty≥
)

3690 
i
,
j
, 
èg_id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
èg
);

3691 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_INFO
,
èg_id
) )  -1;

3692 i‡–
	`bcf_hdr_id2ty≥
(
hdr
,
BCF_HL_INFO
,
èg_id
)!=
ty≥
 )  -2;

3694 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_INFO
ËË
	`bcf_u≈ack
(line, BCF_UN_INFO);

3696 
i
=0; i<
löe
->
n_öfo
; i++)

3697 i‡–
löe
->
d
.
öfo
[
i
].
key
==
èg_id
 ) ;

3698 i‡–
i
==
löe
->
n_öfo
 )  ( 
ty≥
==
BCF_HT_FLAG
 ) ? 0 : -3;

3699 i‡–
ty≥
==
BCF_HT_FLAG
 )  1;

3701 
bcf_öfo_t
 *
öfo
 = &
löe
->
d
.öfo[
i
];

3702 i‡–!
öfo
->
v±r
 )  -3;

3703 i‡–
ty≥
==
BCF_HT_STR
 )

3705 i‡–*
nd°
 < 
öfo
->
Àn
+1 )

3707 *
nd°
 = 
öfo
->
Àn
 + 1;

3708 *
d°
 = 
	`ªÆloc
(*d°, *
nd°
);

3710 
	`mem˝y
(*
d°
,
öfo
->
v±r
,öfo->
Àn
);

3711 ((
uöt8_t
*)*
d°
)[
öfo
->
Àn
] = 0;

3712  
öfo
->
Àn
;

3716 
size1
 = 
ty≥
==
BCF_HT_INT
 ? (
öt32_t
) : ();

3717 i‡–*
nd°
 < 
öfo
->
Àn
 )

3719 *
nd°
 = 
öfo
->
Àn
;

3720 *
d°
 = 
	`ªÆloc
(*d°, *
nd°
 * 
size1
);

3723 
	#BRANCH
(
ty≥_t
, 
c⁄vît
, 
is_missög
, 
is_ve˘‹_íd
, 
£t_missög
, 
£t_ªguœr
, 
out_ty≥_t
) { \

3724 
out_ty≥_t
 *
tmp
 = (out_ty≥_à*Ë*
d°
; \

3725 
j
=0; j<
öfo
->
Àn
; j++) \

3727 
ty≥_t
 
p
 = 
	`c⁄vît
(
öfo
->
v±r
 + 
j
 * (type_t)); \

3728 i‡–
is_ve˘‹_íd
 )  
j
; \

3729 i‡–
is_missög
 ) 
£t_missög
; \

3730 
£t_ªguœr
; \

3731 
tmp
++; \

3733  
j
; \

3734 }

	)

3735 
öfo
->
ty≥
) {

3736 
BCF_BT_INT8
: 
	`BRANCH
(
öt8_t
, 
À_to_i8
, 
p
==
bcf_öt8_missög
,Ö==
bcf_öt8_ve˘‹_íd
, *
tmp
=
bcf_öt32_missög
, *tmpı, 
öt32_t
); ;

3737 
BCF_BT_INT16
: 
	`BRANCH
(
öt16_t
, 
À_to_i16
, 
p
==
bcf_öt16_missög
,Ö==
bcf_öt16_ve˘‹_íd
, *
tmp
=
bcf_öt32_missög
, *tmpı, 
öt32_t
); ;

3738 
BCF_BT_INT32
: 
	`BRANCH
(
öt32_t
, 
À_to_i32
, 
p
==
bcf_öt32_missög
,Ö==
bcf_öt32_ve˘‹_íd
, *
tmp
=bcf_int32_missing, *tmp=p, int32_t); ;

3739 
BCF_BT_FLOAT
: 
	`BRANCH
(
uöt32_t
, 
À_to_u32
, 
p
==
bcf_Êﬂt_missög
,Ö==
bcf_Êﬂt_ve˘‹_íd
, 
	`bcf_Êﬂt_£t_missög
(*
tmp
), 
	`bcf_Êﬂt_£t
(tmp,Ö), ); ;

3740 : 
	`Ârötf
(
°dîr
,"TODO: %s:%d .. info->ty≥=%d\n", 
__FILE__
,
__LINE__
, 
öfo
->
ty≥
); 
	`exô
(1);

3742 #unde‡
BRANCH


3744 
	}
}

3746 
	$bcf_gë_f‹m©_°rög
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
èg
, ***
d°
, *
nd°
)

3748 
i
,
èg_id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
èg
);

3749 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FMT
,
èg_id
) )  -1;

3750 i‡–
	`bcf_hdr_id2ty≥
(
hdr
,
BCF_HL_FMT
,
èg_id
)!=
BCF_HT_STR
 )  -2;

3752 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FMT
ËË
	`bcf_u≈ack
(line, BCF_UN_FMT);

3754 
i
=0; i<
löe
->
n_fmt
; i++)

3755 i‡–
löe
->
d
.
fmt
[
i
].
id
==
èg_id
 ) ;

3756 i‡–
i
==
löe
->
n_fmt
 )  -3;

3757 
bcf_fmt_t
 *
fmt
 = &
löe
->
d
.fmt[
i
];

3758 i‡–!
fmt
->
p
 )  -3;

3760 
nsm∂
 = 
	`bcf_hdr_nßm∂es
(
hdr
);

3761 i‡–!*
d°
 )

3763 *
d°
 = (**Ë
	`mÆloc
((*)*
nsm∂
);

3764 i‡–!*
d°
 )  -4;

3765 (*
d°
)[0] = 
NULL
;

3767 
n
 = (
fmt
->n+1)*
nsm∂
;

3768 i‡–*
nd°
 < 
n
 )

3770 (*
d°
)[0] = 
	`ªÆloc
((*d°)[0], 
n
);

3771 i‡–!(*
d°
)[0] )  -4;

3772 *
nd°
 = 
n
;

3774 
i
=0; i<
nsm∂
; i++)

3776 
uöt8_t
 *
§c
 = 
fmt
->
p
 + 
i
*fmt->
n
;

3777 
uöt8_t
 *
tmp
 = (uöt8_t*)(*
d°
)[0] + 
i
*(
fmt
->
n
+1);

3778 
	`mem˝y
(
tmp
,
§c
,
fmt
->
n
);

3779 
tmp
[
fmt
->
n
] = 0;

3780 (*
d°
)[
i
] = (*Ë
tmp
;

3782  
n
;

3783 
	}
}

3785 
	$bcf_gë_f‹m©_vÆues
(c⁄° 
bcf_hdr_t
 *
hdr
, 
bcf1_t
 *
löe
, c⁄° *
èg
, **
d°
, *
nd°
, 
ty≥
)

3787 
i
,
j
, 
èg_id
 = 
	`bcf_hdr_id2öt
(
hdr
, 
BCF_DT_ID
, 
èg
);

3788 i‡–!
	`bcf_hdr_idöfo_exi°s
(
hdr
,
BCF_HL_FMT
,
èg_id
) )  -1;

3789 i‡–
èg
[0]=='G' &&Åag[1]=='T' &&Åag[2]==0 )

3792 i‡–
	`bcf_hdr_id2ty≥
(
hdr
,
BCF_HL_FMT
,
èg_id
)!=
BCF_HT_STR
 )  -2;

3794 i‡–
	`bcf_hdr_id2ty≥
(
hdr
,
BCF_HL_FMT
,
èg_id
)!=
ty≥
 )  -2;

3796 i‡–!(
löe
->
u≈acked
 & 
BCF_UN_FMT
ËË
	`bcf_u≈ack
(line, BCF_UN_FMT);

3798 
i
=0; i<
löe
->
n_fmt
; i++)

3799 i‡–
löe
->
d
.
fmt
[
i
].
id
==
èg_id
 ) ;

3800 i‡–
i
==
löe
->
n_fmt
 )  -3;

3801 
bcf_fmt_t
 *
fmt
 = &
löe
->
d
.fmt[
i
];

3802 i‡–!
fmt
->
p
 )  -3;

3804 i‡–
ty≥
==
BCF_HT_STR
 )

3806 
n
 = 
fmt
->n*
	`bcf_hdr_nßm∂es
(
hdr
);

3807 i‡–*
nd°
 < 
n
 )

3809 *
d°
 = 
	`ªÆloc
(*d°, 
n
);

3810 i‡–!*
d°
 )  -4;

3811 *
nd°
 = 
n
;

3813 
	`mem˝y
(*
d°
,
fmt
->
p
,
n
);

3814  
n
;

3818 
nsm∂
 = 
	`bcf_hdr_nßm∂es
(
hdr
);

3819 
size1
 = 
ty≥
==
BCF_HT_INT
 ? (
öt32_t
) : ();

3820 i‡–*
nd°
 < 
fmt
->
n
*
nsm∂
 )

3822 *
nd°
 = 
fmt
->
n
*
nsm∂
;

3823 *
d°
 = 
	`ªÆloc
(*d°, *
nd°
*
size1
);

3824 i‡–!
d°
 )  -4;

3827 
	#BRANCH
(
ty≥_t
, 
c⁄vît
, 
is_missög
, 
is_ve˘‹_íd
, 
£t_missög
, 
£t_ve˘‹_íd
, 
£t_ªguœr
, 
out_ty≥_t
) { \

3828 
out_ty≥_t
 *
tmp
 = (out_ty≥_à*Ë*
d°
; \

3829 
uöt8_t
 *
fmt_p
 = 
fmt
->
p
; \

3830 
i
=0; i<
nsm∂
; i++) \

3832 
j
=0; j<
fmt
->
n
; j++) \

3834 
ty≥_t
 
p
 = 
	`c⁄vît
(
fmt_p
 + 
j
 * (type_t)); \

3835 i‡–
is_missög
 ) 
£t_missög
; \

3836 i‡–
is_ve˘‹_íd
 ) { 
£t_ve˘‹_íd
; ; } \

3837 
£t_ªguœr
; \

3838 
tmp
++; \

3840 ; 
j
<
fmt
->
n
; j++Ë{ 
£t_ve˘‹_íd
; 
tmp
++; } \

3841 
fmt_p
 +
fmt
->
size
; \

3843 }

	)

3844 
fmt
->
ty≥
) {

3845 
BCF_BT_INT8
: 
	`BRANCH
(
öt8_t
, 
À_to_i8
, 
p
==
bcf_öt8_missög
,Ö==
bcf_öt8_ve˘‹_íd
, *
tmp
=
bcf_öt32_missög
, *tmp=
bcf_öt32_ve˘‹_íd
, *tmpı, 
öt32_t
); ;

3846 
BCF_BT_INT16
: 
	`BRANCH
(
öt16_t
, 
À_to_i16
, 
p
==
bcf_öt16_missög
,Ö==
bcf_öt16_ve˘‹_íd
, *
tmp
=
bcf_öt32_missög
, *tmp=
bcf_öt32_ve˘‹_íd
, *tmpı, 
öt32_t
); ;

3847 
BCF_BT_INT32
: 
	`BRANCH
(
öt32_t
, 
À_to_i32
, 
p
==
bcf_öt32_missög
,Ö==
bcf_öt32_ve˘‹_íd
, *
tmp
=bcf_int32_missing, *tmp=bcf_int32_vector_end, *tmp=p, int32_t); ;

3848 
BCF_BT_FLOAT
: 
	`BRANCH
(
uöt32_t
, 
À_to_u32
, 
p
==
bcf_Êﬂt_missög
,Ö==
bcf_Êﬂt_ve˘‹_íd
, 
	`bcf_Êﬂt_£t_missög
(*
tmp
), 
	`bcf_Êﬂt_£t_ve˘‹_íd
(*tmp), 
	`bcf_Êﬂt_£t
(tmp,Ö), ); ;

3849 : 
	`Ârötf
(
°dîr
,"TODO: %s:%d .. fmt->ty≥=%d\n", 
__FILE__
,
__LINE__
, 
fmt
->
ty≥
); 
	`exô
(1);

3851 #unde‡
BRANCH


3852  
nsm∂
*
fmt
->
n
;

3853 
	}
}

	@htslib/vcf_sweep.c

25 
	~<c⁄fig.h
>

27 
	~"ht¶ib/vcf_swìp.h
"

28 
	~"ht¶ib/bgzf.h
"

30 
	#SW_FWD
 0

	)

31 
	#SW_BWD
 1

	)

33 
	s_bcf_swìp_t


35 
htsFûe
 *
	mfûe
;

36 
bcf_hdr_t
 *
	mhdr
;

37 
BGZF
 *
	mÂ
;

39 
	mdúe˘i⁄
;

40 
	mblock_size
;

41 
bcf1_t
 *
	mªc
;

42 
	mƒec
, 
	mmªc
;

43 
	mÃid
, 
	mÕos
, 
	m Æs
, 
	mœls_Àn
, 
	mmœls
;

44 *
	mœls
;

46 
uöt64_t
 *
	midx
;

47 
	miidx
, 
	mnidx
, 
	mmidx
;

48 
	midx_d⁄e
;

51 
BGZF
 *
hts_gë_bgzÂ
(
htsFûe
 *
Â
);

52 
hts_u£ek
(
htsFûe
 *
fûe
, 
uoff£t
, 
whîe
);

53 
hts_uãŒ
(
htsFûe
 *
fûe
);

55 
ölöe
 
	$sw_ªc_equÆ
(
bcf_swìp_t
 *
sw
, 
bcf1_t
 *
ªc
)

57 i‡–
sw
->
Ãid
!=
ªc
->
rid
 )  0;

58 i‡–
sw
->
Õos
!=
ªc
->
pos
 )  0;

59 i‡–
sw
->
 Æs
!=
ªc
->
n_ÆÀÀ
 )  0;

61 *
t
 = 
ªc
->
d
.
ÆÀÀ
[
sw
->
 Æs
-1];

62 
Àn
 = 
t
 - 
ªc
->
d
.
ÆÀÀ
[0] + 1;

63  *
t
 ) {Å++; 
Àn
++; }

64 i‡–
sw
->
œls_Àn
!=
Àn
 )  0;

65 i‡–
	`memcmp
(
sw
->
œls
,
ªc
->
d
.
ÆÀÀ
[0],
Àn
) )  0;

67 
	}
}

69 
	$sw_ªc_ßve
(
bcf_swìp_t
 *
sw
, 
bcf1_t
 *
ªc
)

71 
sw
->
Ãid
 = 
ªc
->
rid
;

72 
sw
->
Õos
 = 
ªc
->
pos
;

73 
sw
->
 Æs
 = 
ªc
->
n_ÆÀÀ
;

75 *
t
 = 
ªc
->
d
.
ÆÀÀ
[
sw
->
 Æs
-1];

76 
Àn
 = 
t
 - 
ªc
->
d
.
ÆÀÀ
[0] + 1;

77  *
t
 ) {Å++; 
Àn
++; }

78 
sw
->
œls_Àn
 = 
Àn
;

79 
	`hts_ex∑nd
(, 
Àn
, 
sw
->
mœls
, sw->
œls
);

80 
	`mem˝y
(
sw
->
œls
, 
ªc
->
d
.
ÆÀÀ
[0], 
Àn
);

81 
	}
}

83 
	$sw_fûl_buf„r
(
bcf_swìp_t
 *
sw
)

85 i‡–!
sw
->
iidx
 ) ;

86 
sw
->
iidx
--;

88 
ªt
 = 
	`hts_u£ek
(
sw
->
fûe
, sw->
idx
[sw->
iidx
], 0);

89 
	`as£π
–
ªt
==0 );

91 
sw
->
ƒec
 = 0;

92 
bcf1_t
 *
ªc
 = &
sw
->ªc[sw->
ƒec
];

93  (
ªt
=
	`bcf_ªad1
(
sw
->
fûe
, sw->
hdr
, 
ªc
))==0 )

95 
	`bcf_u≈ack
(
ªc
, 
BCF_UN_STR
);

98 i‡–
sw
->
iidx
+1 < sw->
nidx
 && 
	`sw_ªc_equÆ
(sw,
ªc
) ) ;

100 
sw
->
ƒec
++;

101 
	`hts_ex∑nd0
(
bcf1_t
, 
sw
->
ƒec
+1, sw->
mªc
, sw->
ªc
);

102 
ªc
 = &
sw
->ªc[sw->
ƒec
];

104 
	`sw_ªc_ßve
(
sw
, &sw->
ªc
[0]);

105 
	}
}

107 
bcf_swìp_t
 *
	$bcf_swìp_öô
(c⁄° *
‚ame
)

109 
bcf_swìp_t
 *
sw
 = (bcf_swìp_t*Ë
	`ˇŒoc
(1,(bcf_sweep_t));

110 
sw
->
fûe
 = 
	`hts_›í
(
‚ame
, "r");

111 
sw
->
Â
 = 
	`hts_gë_bgzÂ
(sw->
fûe
);

112 i‡(
sw
->
Â
Ë
	`bgzf_ödex_buûd_öô
(sw->fp);

113 
sw
->
hdr
 = 
	`bcf_hdr_ªad
(sw->
fûe
);

114 
sw
->
mªc
 = 1;

115 
sw
->
ªc
 = (
bcf1_t
*Ë
	`ˇŒoc
(sw->
mªc
,((bcf1_t)));

116 
sw
->
block_size
 = 1024*1024*3;

117 
sw
->
dúe˘i⁄
 = 
SW_FWD
;

118  
sw
;

119 
	}
}

121 
	$bcf_swìp_de°roy
(
bcf_swìp_t
 *
sw
)

123 
i
;

124 
i
=0; i<
sw
->
mªc
; i++Ë
	`bcf_em±y1
(&sw->
ªc
[i]);

125 
	`‰ì
(
sw
->
idx
);

126 
	`‰ì
(
sw
->
ªc
);

127 
	`‰ì
(
sw
->
œls
);

128 
	`bcf_hdr_de°roy
(
sw
->
hdr
);

129 
	`hts_˛o£
(
sw
->
fûe
);

130 
	`‰ì
(
sw
);

131 
	}
}

133 
	$sw_£ek
(
bcf_swìp_t
 *
sw
, 
dúe˘i⁄
)

135 
sw
->
dúe˘i⁄
 = direction;

136 i‡–
dúe˘i⁄
==
SW_FWD
 )

137 
	`hts_u£ek
(
sw
->
fûe
, sw->
idx
[0], 0);

140 
sw
->
iidx
 = sw->
nidx
;

141 
sw
->
ƒec
 = 0;

143 
	}
}

145 
bcf1_t
 *
	$bcf_swìp_fwd
(
bcf_swìp_t
 *
sw
)

147 i‡–
sw
->
dúe˘i⁄
==
SW_BWD
 ) 
	`sw_£ek
(sw, 
SW_FWD
);

149 
pos
 = 
	`hts_uãŒ
(
sw
->
fûe
);

151 
bcf1_t
 *
ªc
 = &
sw
->rec[0];

152 
ªt
 = 
	`bcf_ªad1
(
sw
->
fûe
, sw->
hdr
, 
ªc
);

154 i‡–
ªt
!=0 )

156 
sw
->
idx_d⁄e
 = 1;

157 i‡(
sw
->
Â
Ësw->Â->
idx_buûd_Ÿf
 = 0;

158 
	`sw_£ek
(
sw
, 
SW_BWD
);

159  
NULL
;

162 i‡–!
sw
->
idx_d⁄e
 )

164 i‡–!
sw
->
nidx
 || 
pos
 - sw->
idx
[sw->nidx-1] > sw->
block_size
 )

166 
sw
->
nidx
++;

167 
	`hts_ex∑nd
(
uöt64_t
, 
sw
->
nidx
, sw->
midx
, sw->
idx
);

168 
sw
->
idx
[sw->
nidx
-1] = 
pos
;

171  
ªc
;

172 
	}
}

174 
bcf1_t
 *
	$bcf_swìp_bwd
(
bcf_swìp_t
 *
sw
)

176 i‡–
sw
->
dúe˘i⁄
==
SW_FWD
 ) 
	`sw_£ek
(sw, 
SW_BWD
);

177 i‡–!
sw
->
ƒec
 ) 
	`sw_fûl_buf„r
(sw);

178 i‡–!
sw
->
ƒec
 )  
NULL
;

179  &
sw
->
ªc
[ --sw->
ƒec
 ];

180 
	}
}

182 
bcf_hdr_t
 *
	$bcf_swìp_hdr
(
bcf_swìp_t
 *
sw
Ë{  sw->
hdr
; 
	}
}

	@htslib/vcfutils.c

25 
	~<c⁄fig.h
>

27 
	~"ht¶ib/vcfutûs.h
"

28 
	~"ht¶ib/kbô£t.h
"

30 
	$bcf_ˇlc_ac
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
, *
ac
, 
which
)

32 
i
;

33 
i
=0; i<
löe
->
n_ÆÀÀ
; i++Ë
ac
[i]=0;

36 i‡–
which
&
BCF_UN_INFO
 )

38 
	`bcf_u≈ack
(
löe
, 
BCF_UN_INFO
);

39 
™_id
 = 
	`bcf_hdr_id2öt
(
hódî
, 
BCF_DT_ID
, "AN");

40 
ac_id
 = 
	`bcf_hdr_id2öt
(
hódî
, 
BCF_DT_ID
, "AC");

41 
i
, 
™
=-1, 
ac_Àn
=0, 
ac_ty≥
=0;

42 
uöt8_t
 *
ac_±r
=
NULL
;

43 i‡–
™_id
>=0 && 
ac_id
>=0 )

45 
i
=0; i<
löe
->
n_öfo
; i++)

47 
bcf_öfo_t
 *
z
 = &
löe
->
d
.
öfo
[
i
];

48 i‡–
z
->
key
 =
™_id
 ) 
™
 = z->
v1
.
i
;

49 i‡–
z
->
key
 =
ac_id
 ) { 
ac_±r
 = z->
v±r
; 
ac_Àn
 = z->
Àn
; 
ac_ty≥
 = z->
ty≥
; }

52 i‡–
™
>=0 && 
ac_±r
 )

54 
«c
 = 0;

55 
	#BRANCH_INT
(
ty≥_t
) { \

56 
ty≥_t
 *
p
 = (ty≥_à*Ë
ac_±r
; \

57 
i
=0; i<
ac_Àn
; i++) \

59 
ac
[
i
+1] = 
p
[i]; \

60 
«c
 +
p
[
i
]; \

62 }

	)

63 
ac_ty≥
) {

64 
BCF_BT_INT8
: 
	`BRANCH_INT
(
öt8_t
); ;

65 
BCF_BT_INT16
: 
	`BRANCH_INT
(
öt16_t
); ;

66 
BCF_BT_INT32
: 
	`BRANCH_INT
(
öt32_t
); ;

67 : 
	`Ârötf
(
°dîr
, "[E::%s]Åodo: %dáà%s:%d\n", 
__func__
, 
ac_ty≥
, 
hódî
->
id
[
BCF_DT_CTG
][
löe
->
rid
].
key
,Üöe->
pos
+1); 
	`exô
(1); ;

69 #unde‡
BRANCH_INT


70 i‡–
™
<
«c
 )

72 
	`Ârötf
(
°dîr
,"[E::%s] Inc‹ª˘ AN/AC cou¡†© %s:%d\n", 
__func__
,
hódî
->
id
[
BCF_DT_CTG
][
löe
->
rid
].
key
,Üöe->
pos
+1);

73 
	`exô
(1);

75 
ac
[0] = 
™
 - 
«c
;

81 i‡–
which
&
BCF_UN_FMT
 )

83 
i
, 
gt_id
 = 
	`bcf_hdr_id2öt
(
hódî
,
BCF_DT_ID
,"GT");

84 i‡–
gt_id
<0 )  0;

85 
	`bcf_u≈ack
(
löe
, 
BCF_UN_FMT
);

86 
bcf_fmt_t
 *
fmt_gt
 = 
NULL
;

87 
i
=0; i<()
löe
->
n_fmt
; i++)

88 i‡–
löe
->
d
.
fmt
[
i
].
id
==
gt_id
 ) { 
fmt_gt
 = &line->d.fmt[i]; ; }

89 i‡–!
fmt_gt
 )  0;

90 
	#BRANCH_INT
(
ty≥_t
,
ve˘‹_íd
) { \

91 
i
=0; i<
löe
->
n_ßm∂e
; i++) \

93 
ty≥_t
 *
p
 = (ty≥_t*Ë(
fmt_gt
->∞+ 
i
*fmt_gt->
size
); \

94 
ül
; \

95 
ül
=0; iÆ<
fmt_gt
->
n
; ial++) \

97 i‡–
p
[
ül
]==
ve˘‹_íd
 ) ; \

98 i‡–
	`bcf_gt_is_missög
(
p
[
ül
]) ) ; \

99 i‡–
p
[
ül
]>>1 > 
löe
->
n_ÆÀÀ
 ) \

101 
	`Ârötf
(
°dîr
,"[E::%s] Inc‹ª˘áŒñê(\"%d\"Ëö %†© %s:%d\n", 
__func__
,(
p
[
ül
]>>1)-1, 
hódî
->
ßm∂es
[
i
],hódî->
id
[
BCF_DT_CTG
][
löe
->
rid
].
key
,Üöe->
pos
+1); \

102 
	`exô
(1); \

104 
ac
[(
p
[
ül
]>>1)-1]++; \

107 }

	)

108 
fmt_gt
->
ty≥
) {

109 
BCF_BT_INT8
: 
	`BRANCH_INT
(
öt8_t
, 
bcf_öt8_ve˘‹_íd
); ;

110 
BCF_BT_INT16
: 
	`BRANCH_INT
(
öt16_t
, 
bcf_öt16_ve˘‹_íd
); ;

111 
BCF_BT_INT32
: 
	`BRANCH_INT
(
öt32_t
, 
bcf_öt32_ve˘‹_íd
); ;

112 : 
	`Ârötf
(
°dîr
, "[E::%s]Åodo: %dáà%s:%d\n", 
__func__
, 
fmt_gt
->
ty≥
, 
hódî
->
id
[
BCF_DT_CTG
][
löe
->
rid
].
key
,Üöe->
pos
+1); 
	`exô
(1); ;

114 #unde‡
BRANCH_INT


118 
	}
}

120 
	$bcf_gt_ty≥
(
bcf_fmt_t
 *
fmt_±r
, 
ißm∂e
, *
_ül
, *
_jÆ
)

122 
i
, 
«ls
 = 0, 
has_ªf
 = 0, 
has_Æt
 = 0, 
ül
 = 0, 
jÆ
 = 0;

123 
	#BRANCH_INT
(
ty≥_t
,
ve˘‹_íd
) { \

124 
ty≥_t
 *
p
 = (ty≥_t*Ë(
fmt_±r
->∞+ 
ißm∂e
*fmt_±r->
size
); \

125 
i
=0; i<
fmt_±r
->
n
; i++) \

127 i‡–
p
[
i
] =
ve˘‹_íd
 ) ; \

128 i‡–
	`bcf_gt_is_missög
(
p
[
i
]ËË 
GT_UNKN
; \

129 
tmp
 = 
p
[
i
]>>1; \

130 i‡–
tmp
>1 ) \

132 i‡–!
ül
 ) { iÆ = 
tmp
; 
has_Æt
 = 1; } \

133 i‡–
tmp
!=
ül
 ) \

135 i‡–
tmp
<
ül
 ) \

137 
jÆ
 = 
ül
; \

138 
ül
 = 
tmp
; \

142 
jÆ
 = 
tmp
; \

144 
has_Æt
 = 2; \

147 
has_ªf
 = 1; \

148 
«ls
++; \

150 }

	)

151 
fmt_±r
->
ty≥
) {

152 
BCF_BT_INT8
: 
	`BRANCH_INT
(
öt8_t
, 
bcf_öt8_ve˘‹_íd
); ;

153 
BCF_BT_INT16
: 
	`BRANCH_INT
(
öt16_t
, 
bcf_öt16_ve˘‹_íd
); ;

154 
BCF_BT_INT32
: 
	`BRANCH_INT
(
öt32_t
, 
bcf_öt32_ve˘‹_íd
); ;

155 : 
	`Ârötf
(
°dîr
, "[E::%s]Åodo: fmt_ty≥ %d\n", 
__func__
, 
fmt_±r
->
ty≥
); 
	`exô
(1); ;

157 #unde‡
BRANCH_INT


159 i‡–
_ül
 ) *_ü»
ül
>0 ? ial-1 : ial;

160 i‡–
_jÆ
 ) *_jÆ = 
jÆ
>0 ? jal-1 : jal;

161 i‡–!
«ls
 )  
GT_UNKN
;

162 i‡–
«ls
==1 )

163  
has_ªf
 ? 
GT_HAPL_R
 : 
GT_HAPL_A
;

164 i‡–!
has_ªf
 )

165  
has_Æt
==1 ? 
GT_HOM_AA
 : 
GT_HET_AA
;

166 i‡–!
has_Æt
 )

167  
GT_HOM_RR
;

168  
GT_HET_RA
;

169 
	}
}

171 
	$bcf_åim_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
)

173 
i
, 
ªt
 = 0, 
ƒm
 = 0;

174 
kbô£t_t
 *
rm_£t
 = 
NULL
;

175 
bcf_fmt_t
 *
gt
 = 
	`bcf_gë_fmt
(
hódî
, 
löe
, "GT");

176 i‡–!
gt
 )  0;

178 *
ac
 = (*Ë
	`ˇŒoc
(
löe
->
n_ÆÀÀ
,());

181 
	#BRANCH
(
ty≥_t
,
ve˘‹_íd
) { \

182 
i
=0; i<
löe
->
n_ßm∂e
; i++) \

184 
ty≥_t
 *
p
 = (ty≥_t*Ë(
gt
->∞+ 
i
*gt->
size
); \

185 
ül
; \

186 
ül
=0; iÆ<
gt
->
n
; ial++) \

188 i‡–
p
[
ül
]==
ve˘‹_íd
 ) ; \

189 i‡–
	`bcf_gt_is_missög
(
p
[
ül
]) ) ; \

190 i‡–(
p
[
ül
]>>1)-1 >
löe
->
n_ÆÀÀ
 ) { \

191 i‡(
hts_vîbo£
>1Ë{ 
	`Ârötf
(
°dîr
, "[E::%s]áŒñêödex i†ouào‡bound†© %s:%d\n", 
__func__
, 
hódî
->
id
[
BCF_DT_CTG
][
löe
->
rid
].
key
,Üöe->
pos
+1); } \

192 
ªt
 = -1; \

193 
˛ón
; \

195 
ac
[(
p
[
ül
]>>1)-1]++; \

198 }

	)

199 
gt
->
ty≥
) {

200 
BCF_BT_INT8
: 
	`BRANCH
(
öt8_t
, 
bcf_öt8_ve˘‹_íd
); ;

201 
BCF_BT_INT16
: 
	`BRANCH
(
öt16_t
, 
bcf_öt16_ve˘‹_íd
); ;

202 
BCF_BT_INT32
: 
	`BRANCH
(
öt32_t
, 
bcf_öt32_ve˘‹_íd
); ;

203 : i‡(
hts_vîbo£
>1Ë{ 
	`Ârötf
(
°dîr
, "[E::%s]Åodo: %dáà%s:%d\n", 
__func__
, 
gt
->
ty≥
, 
hódî
->
id
[
BCF_DT_CTG
][
löe
->
rid
].
key
,Üöe->
pos
+1); } 
˛ón
; ;

205 #unde‡
BRANCH


207 
rm_£t
 = 
	`kbs_öô
(
löe
->
n_ÆÀÀ
);

208 
i
=1; i<
löe
->
n_ÆÀÀ
; i++)

210 i‡–!
ac
[
i
] ) { 
	`kbs_ö£π
(
rm_£t
, i); 
ƒm
++; }

213 i‡–
ƒm
 )

214 i‡–
	`bcf_ªmove_ÆÀÀ_£t
(
hódî
, 
löe
, 
rm_£t
) )

215 
ªt
 = -2;

217 
˛ón
:

218 
	`‰ì
(
ac
);

219 i‡(
rm_£t
Ë
	`kbs_de°roy
(rm_set);

220  
ªt
 ?Ñë : 
ƒm
;

221 
	}
}

223 
	$bcf_ªmove_ÆÀÀs
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
, 
rm_mask
)

225 
i
;

226 
kbô£t_t
 *
rm_£t
 = 
	`kbs_öô
(
löe
->
n_ÆÀÀ
);

227 
i
=1; i<
löe
->
n_ÆÀÀ
; i++)

228 i‡–
rm_mask
 & 1<<
i
 ) 
	`kbs_ö£π
(
rm_£t
, i);

230 
	`bcf_ªmove_ÆÀÀ_£t
(
hódî
, 
löe
, 
rm_£t
);

231 
	`kbs_de°roy
(
rm_£t
);

232 
	}
}

234 
	$bcf_ªmove_ÆÀÀ_£t
(c⁄° 
bcf_hdr_t
 *
hódî
, 
bcf1_t
 *
löe
, c⁄° 
kbô£t_t
 *
rm_£t
)

236 *
m≠
 = (*Ë
	`ˇŒoc
(
löe
->
n_ÆÀÀ
, ());

237 
uöt8_t
 *
d©
 = 
NULL
;

240 
k°rög_t
 
°r
 = {0,0,0};

241 
	`kputs
(
löe
->
d
.
ÆÀÀ
[0], &
°r
);

243 
ƒm
 = 0, 
i
,
j
;

244 
i
=1, 
j
=1; i<
löe
->
n_ÆÀÀ
; i++)

246 i‡–
	`kbs_exi°s
(
rm_£t
, 
i
) )

249 
löe
->
d
.
ÆÀÀ
[
i
] = 
NULL
;

250 
ƒm
++;

253 
	`kputc
(',', &
°r
);

254 
	`kputs
(
löe
->
d
.
ÆÀÀ
[
i
], &
°r
);

255 
m≠
[
i
] = 
j
;

256 
j
++;

258 i‡–!
ƒm
 ) 
˛ón
;

260 
nR_‹i
 = 
löe
->
n_ÆÀÀ
;

261 
nR_√w
 = 
löe
->
n_ÆÀÀ
-
ƒm
;

262 i‡–
nR_√w
<=0 )

264 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] C™nŸÑemovêª„ªn˚áŒñê© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

265 
	`bcf_£q«me
(
hódî
,
löe
),Üöe->
pos
+1, 
nR_√w
);

266 
îr
;

268 
nA_‹i
 = 
nR_‹i
-1;

269 
nA_√w
 = 
nR_√w
-1;

271 
nG_‹i
 = 
nR_‹i
*(nR_ori + 1)/2;

272 
nG_√w
 = 
nR_√w
*(nR_new + 1)/2;

274 
	`bcf_upd©e_ÆÀÀs_°r
(
hódî
, 
löe
, 
°r
.
s
);

277 
md©
 = 0, 
nd©
 = 0, 
md©_byãs
 = 0, 
ƒë
;

278 
i
=0; i<
löe
->
n_öfo
; i++)

280 
bcf_öfo_t
 *
öfo
 = &
löe
->
d
.öfo[
i
];

281 
vÀn
 = 
	`bcf_hdr_id2Àngth
(
hódî
,
BCF_HL_INFO
,
öfo
->
key
);

283 i‡–
vÀn
!=
BCF_VL_A
 && vÀn!=
BCF_VL_G
 && vÀn!=
BCF_VL_R
 ) ;

285 
ty≥
 = 
	`bcf_hdr_id2ty≥
(
hódî
,
BCF_HL_INFO
,
öfo
->
key
);

286 i‡–
ty≥
==
BCF_HT_FLAG
 ) ;

287 
size
 = 1;

288 i‡–
ty≥
==
BCF_HT_REAL
 ||Åy≥==
BCF_HT_INT
 ) 
size
 = 4;

290 
md©
 = 
md©_byãs
 / 
size
;

291 
ƒë
 = 
	`bcf_gë_öfo_vÆues
(
hódî
, 
löe
, 
	`bcf_hdr_öt2id
(hódî,
BCF_DT_ID
,
öfo
->
key
), (**)&
d©
, &
md©
, 
ty≥
);

292 
md©_byãs
 = 
md©
 * 
size
;

293 i‡–
ƒë
<0 )

295 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸác˚s†INFO/%†© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

296 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
ƒë
);

297 
îr
;

299 i‡–
ƒë
==0 ) ;

301 i‡–
ty≥
==
BCF_HT_STR
 )

303 
°r
.
l
 = 0;

304 *
ss
 = (*Ë
d©
, *
£
 = (*Ëd©, 
s
 = ss[0];

305 i‡–
vÀn
==
BCF_VL_A
 || vÀn==
BCF_VL_R
 )

307 
√xp
, 
öc
 = 0;

308 i‡–
vÀn
==
BCF_VL_A
 )

310 
√xp
 = 
nA_‹i
;

311 
öc
 = 1;

314 
√xp
 = 
nR_‹i
;

315 
j
=0; j<
√xp
; j++)

317 i‡–!*
£
 ) ;

318  *
£
 && *se!=',' ) se++;

319 i‡–
	`kbs_exi°s
(
rm_£t
, 
j
+
öc
) )

321 i‡–*
£
 ) se++;

322 
ss
 = 
£
;

325 i‡–
°r
.
l
 ) 
	`kputc
(',',&str);

326 
	`kput¢
(
ss
,
£
-ss,&
°r
);

327 i‡–*
£
 ) se++;

328 
ss
 = 
£
;

330 i‡–
j
==1 && 
s
 == '.' ) ;

331 i‡–
j
!=
√xp
 )

333 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö INFO/%†© %s:%d;Éx≥˘ed Numbî=%c=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

334 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
vÀn
==
BCF_VL_A
 ? 'A' : 'R', 
√xp
, 
j
);

335 
îr
;

340 
k
 = 0, 
n
 = 0;

341 
j
=0; j<
nR_‹i
; j++)

343 
k
=0; k<=
j
; k++)

345 i‡–!*
£
 ) ;

346  *
£
 && *se!=',' ) se++;

347 
n
++;

348 i‡–
	`kbs_exi°s
(
rm_£t
, 
j
Ë|| kbs_exi°s‘m_£t, 
k
) )

350 i‡–*
£
 ) se++;

351 
ss
 = 
£
;

354 i‡–
°r
.
l
 ) 
	`kputc
(',',&str);

355 
	`kput¢
(
ss
,
£
-ss,&
°r
);

356 i‡–*
£
 ) se++;

357 
ss
 = 
£
;

359 i‡–!*
£
 ) ;

361 i‡–
n
==1 && 
s
 == '.' ) ;

362 i‡–
n
!=
nG_‹i
 )

364 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö INFO/%†© %s:%d;Éx≥˘ed Numbî=G=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

365 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nG_‹i
, 
n
);

366 
îr
;

370 
ƒë
 = 
	`bcf_upd©e_öfo
(
hódî
, 
löe
, 
	`bcf_hdr_öt2id
(hódî,
BCF_DT_ID
,
öfo
->
key
), (*)
°r
.
s
, så.
l
, 
ty≥
);

371 i‡–
ƒë
<0 )

373 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ upd©êINFO/%†© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

374 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
ƒë
);

375 
îr
;

380 i‡(
ƒë
==1)

382 
missög
 = 0;

383 
	#BRANCH
(
ty≥_t
, 
is_missög
) { \

384 
ty≥_t
 *
p
 = (ty≥_à*Ë
öfo
->
v±r
; \

385 i‡–
is_missög
 ) 
missög
 = 1; \

386 }

	)

387 
öfo
->
ty≥
) {

388 
BCF_BT_INT8
: 
	`BRANCH
(
öt8_t
, 
p
[0]==
bcf_öt8_missög
); ;

389 
BCF_BT_INT16
: 
	`BRANCH
(
öt16_t
, 
p
[0]==
bcf_öt16_missög
); ;

390 
BCF_BT_INT32
: 
	`BRANCH
(
öt32_t
, 
p
[0]==
bcf_öt32_missög
); ;

391 
BCF_BT_FLOAT
: 
	`BRANCH
(, 
	`bcf_Êﬂt_is_missög
(
p
[0])); ;

392 : i‡(
hts_vîbo£
>1Ë{ 
	`Ârötf
(
°dîr
,"todo:Åy≥ %d\n", 
öfo
->
ty≥
); } 
îr
;; ;

394 #unde‡
BRANCH


395 i‡(
missög
) ;

398 i‡–
vÀn
==
BCF_VL_A
 || vÀn==
BCF_VL_R
 )

400 
öc
 = 0, 
¡›
;

401 i‡–
vÀn
==
BCF_VL_A
 )

403 i‡–
ƒë
!=
nA_‹i
 )

405 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö INFO/%†© %s:%d;Éx≥˘ed Numbî=A=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

406 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nA_‹i
, 
ƒë
);

407 
îr
;

409 
¡›
 = 
nA_‹i
;

410 
nd©
 = 
nA_√w
;

411 
öc
 = 1;

415 i‡–
ƒë
!=
nR_‹i
 )

417 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö INFO/%†© %s:%d;Éx≥˘ed Numbî=R=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

418 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nR_‹i
, 
ƒë
);

419 
îr
;

421 
¡›
 = 
nR_‹i
;

422 
nd©
 = 
nR_√w
;

424 
k
 = 0;

426 
	#BRANCH
(
ty≥_t
,
is_ve˘‹_íd
) \

428 
ty≥_t
 *
±r
 = (ty≥_t*Ë
d©
; \

429 
size
 = (
ty≥_t
); \

430 
j
=0; j<
¡›
; j++) \

432 i‡–
is_ve˘‹_íd
 ) { 
	`mem˝y
(
d©
+
k
*
size
, d©+
j
*size, size); ; } \

433 i‡–
	`kbs_exi°s
(
rm_£t
, 
j
+
öc
) ) ; \

434 i‡–
j
!=
k
 ) 
	`mem˝y
(
d©
+k*
size
, dat+j*size, size); \

435 
k
++; \

437 }

	)

438 
ty≥
)

440 
BCF_HT_INT
: 
	`BRANCH
(
öt32_t
,
±r
[
j
]==
bcf_öt32_ve˘‹_íd
); ;

441 
BCF_HT_REAL
: 
	`BRANCH
(,
	`bcf_Êﬂt_is_ve˘‹_íd
(
±r
[
j
])); ;

443 #unde‡
BRANCH


447 i‡–
ƒë
!=
nG_‹i
 )

449 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö INFO/%†© %s:%d;Éx≥˘ed Numbî=R=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

450 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nG_‹i
, 
ƒë
);

451 
îr
;

453 
k
, 
l_‹i
 = -1, 
l_√w
 = 0;

454 
nd©
 = 
nG_√w
;

456 
	#BRANCH
(
ty≥_t
,
is_ve˘‹_íd
) \

458 
ty≥_t
 *
±r
 = (ty≥_t*Ë
d©
; \

459 
size
 = (
ty≥_t
); \

460 
j
=0; j<
nR_‹i
; j++) \

462 
k
=0; k<=
j
; k++) \

464 
l_‹i
++; \

465 i‡–
is_ve˘‹_íd
 ) { 
	`mem˝y
(
d©
+
l_√w
*
size
, d©+
l_‹i
*size, size); ; } \

466 i‡–
	`kbs_exi°s
(
rm_£t
, 
j
Ë|| kbs_exi°s‘m_£t, 
k
) ) ; \

467 i‡–
l_‹i
!=
l_√w
 ) 
	`mem˝y
(
d©
+l_√w*
size
, dat+l_ori*size, size); \

468 
l_√w
++; \

471 }

	)

472 
ty≥
)

474 
BCF_HT_INT
: 
	`BRANCH
(
öt32_t
,
±r
[
l_‹i
]==
bcf_öt32_ve˘‹_íd
); ;

475 
BCF_HT_REAL
: 
	`BRANCH
(,
	`bcf_Êﬂt_is_ve˘‹_íd
(
±r
[
l_‹i
])); ;

477 #unde‡
BRANCH


480 
ƒë
 = 
	`bcf_upd©e_öfo
(
hódî
, 
löe
, 
	`bcf_hdr_öt2id
(hódî,
BCF_DT_ID
,
öfo
->
key
), (*)
d©
, 
nd©
, 
ty≥
);

481 i‡–
ƒë
<0 )

483 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ upd©êINFO/%†© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

484 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
öfo
->
key
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
ƒë
);

485 
îr
;

490 
i
=1; i<
löe
->
n_ÆÀÀ
; i++Ëi‡–
m≠
[i]!=i ) ;

491 i‡–
i
<
löe
->
n_ÆÀÀ
 )

493 
md©
 = 
md©_byãs
 / 4;

494 
ƒë
 = 
	`bcf_gë_gíŸy≥s
(
hódî
,
löe
,(**)&
d©
,&
md©
);

495 
md©_byãs
 = 
md©
 * 4;

496 i‡–
ƒë
>0 )

498 
ƒë
 /
löe
->
n_ßm∂e
;

499 
öt32_t
 *
±r
 = (öt32_t*Ë
d©
;

500 
i
=0; i<
löe
->
n_ßm∂e
; i++)

502 
j
=0; j<
ƒë
; j++)

504 i‡–
	`bcf_gt_is_missög
(
±r
[
j
]) ) ;

505 i‡–
±r
[
j
]==
bcf_öt32_ve˘‹_íd
 ) ;

506 
Æ
 = 
	`bcf_gt_ÆÀÀ
(
±r
[
j
]);

507 i‡–!–
Æ
<
nR_‹i
 && 
m≠
[al]>=0 ) )

509 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] ProbÀm upd©ög gíŸy≥†© %s:%d [ál<nR_‹ò&& m≠[Æ]>=0 ::ál=%d,nR_‹i=%d,m≠[Æ]=%d ]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

510 
	`bcf_£q«me
(
hódî
,
löe
),Üöe->
pos
+1, 
Æ
, 
nR_‹i
, 
m≠
[al]);

511 
îr
;

513 
±r
[
j
] = (
m≠
[
Æ
]+1)<<1 | (ptr[j]&1);

515 
±r
 +
ƒë
;

517 
ƒë
 = 
	`bcf_upd©e_gíŸy≥s
(
hódî
, 
löe
, (*)
d©
,Çªt*löe->
n_ßm∂e
);

518 i‡–
ƒë
<0 )

520 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ upd©êFORMAT/GTáà%s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

521 
	`bcf_£q«me
(
hódî
,
löe
),Üöe->
pos
+1, 
ƒë
);

522 
îr
;

529 
i
=0; i<
löe
->
n_fmt
; i++)

531 
bcf_fmt_t
 *
fmt
 = &
löe
->
d
.fmt[
i
];

532 
vÀn
 = 
	`bcf_hdr_id2Àngth
(
hódî
,
BCF_HL_FMT
,
fmt
->
id
);

534 i‡–
vÀn
!=
BCF_VL_A
 && vÀn!=
BCF_VL_G
 && vÀn!=
BCF_VL_R
 ) ;

536 
ty≥
 = 
	`bcf_hdr_id2ty≥
(
hódî
,
BCF_HL_FMT
,
fmt
->
id
);

537 i‡–
ty≥
==
BCF_HT_FLAG
 ) ;

539 
size
 = 1;

540 i‡–
ty≥
==
BCF_HT_REAL
 ||Åy≥==
BCF_HT_INT
 ) 
size
 = 4;

542 
md©
 = 
md©_byãs
 / 
size
;

543 
ƒë
 = 
	`bcf_gë_f‹m©_vÆues
(
hódî
, 
löe
, 
	`bcf_hdr_öt2id
(hódî,
BCF_DT_ID
,
fmt
->
id
), (**)&
d©
, &
md©
, 
ty≥
);

544 
md©_byãs
 = 
md©
 * 
size
;

545 i‡–
ƒë
<0 )

547 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸác˚s†FORMAT/%†© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

548 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
ƒë
);

549 
îr
;

551 i‡–
ƒë
 == 0 ) ;

553 i‡–
ty≥
==
BCF_HT_STR
 )

555 
size
 = 
ƒë
/
löe
->
n_ßm∂e
;

556 
°r
.
l
 = 0;

557 i‡–
vÀn
==
BCF_VL_A
 || vÀn==
BCF_VL_R
 )

559 
√xp
, 
öc
 = 0;

560 i‡–
vÀn
==
BCF_VL_A
 )

562 
√xp
 = 
nA_‹i
;

563 
öc
 = 1;

566 
√xp
 = 
nR_‹i
;

567 
j
=0; j<
löe
->
n_ßm∂e
; j++)

569 *
ss
 = ((*)
d©
Ë+ 
j
*
size
, *
£
 = s†+ size, *
±r
 = ss, 
s
 = ss[0];

570 
k_§c
 = 0, 
k_d°
 = 0, 
l
 = 
°r
.l;

571 
k_§c
=0; k_§c<
√xp
; k_src++)

573 i‡–
±r
>=
£
 || !*ptr) ;

574  
±r
<
£
 && *ptr && *ptr!=',' )Ötr++;

575 i‡–
	`kbs_exi°s
(
rm_£t
, 
k_§c
+
öc
) )

577 
ss
 = ++
±r
;

580 i‡–
k_d°
 ) 
	`kputc
(',',&
°r
);

581 
	`kput¢
(
ss
,
±r
-ss,&
°r
);

582 
ss
 = ++
±r
;

583 
k_d°
++;

585 i‡–
k_§c
==1 && 
s
 == '.' ) ;

586 i‡–
k_§c
!=
√xp
 )

588 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö FORMAT/%†© %s:%d;Éx≥˘ed Numbî=%c=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

589 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
vÀn
==
BCF_VL_A
 ? 'A' : 'R', 
√xp
, 
k_§c
);

590 
îr
;

592 
l
 = 
°r
.l -Ü;

593 ; 
l
<
size
;Ü++Ë
	`kputc
(0, &
°r
);

598 
j
=0; j<
löe
->
n_ßm∂e
; j++)

600 *
ss
 = ((*)
d©
Ë+ 
j
*
size
, *
£
 = s†+ size, *
±r
 = ss, 
s
 = ss[0];

601 
k_§c
 = 0, 
k_d°
 = 0, 
l
 = 
°r
.l;

602 
√xp
 = 0;

603  
±r
<
£
 )

605 i‡–!*
±r
 ) ;

606 i‡–*
±r
==',' ) 
√xp
++;

607 
±r
++;

609 i‡–
±r
!=
ss
 ) 
√xp
++;

610 i‡–
√xp
==1 && 
s
 == '.' ) ;

611 i‡–
√xp
!=
nG_‹i
 &&Çexp!=
nR_‹i
 )

613 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö FORMAT/%†© %s:%d;Éx≥˘ed Numbî=G=%d(dùloidË‹ %d(h≠loid), buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

614 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nG_‹i
, 
nR_‹i
, 
√xp
);

615 
îr
;

617 
±r
 = 
ss
;

618 i‡–
√xp
==
nG_‹i
 )

620 
ü
, 
ib
;

621 
ü
=0; ia<
nR_‹i
; ia++)

623 
ib
=0; ib<=
ü
; ib++)

625 i‡–
±r
>=
£
 || !*ptr ) ;

626  
±r
<
£
 && *ptr && *ptr!=',' )Ötr++;

627 i‡–
	`kbs_exi°s
(
rm_£t
, 
ü
Ë|| kbs_exi°s‘m_£t, 
ib
) )

629 
ss
 = ++
±r
;

632 i‡–
k_d°
 ) 
	`kputc
(',',&
°r
);

633 
	`kput¢
(
ss
,
±r
-ss,&
°r
);

634 
ss
 = ++
±r
;

635 
k_d°
++;

637 i‡–
±r
>=
£
 || !*ptr ) ;

642 
k_§c
=0; k_§c<
nR_‹i
; k_src++)

644 i‡–
±r
>=
£
 || !*ptr ) ;

645  
±r
<
£
 && *ptr && *ptr!=',' )Ötr++;

646 i‡–
	`kbs_exi°s
(
rm_£t
, 
k_§c
) )

648 
ss
 = ++
±r
;

651 i‡–
k_d°
 ) 
	`kputc
(',',&
°r
);

652 
	`kput¢
(
ss
,
±r
-ss,&
°r
);

653 
ss
 = ++
±r
;

654 
k_d°
++;

656 i‡–
k_§c
!=
nR_‹i
 )

658 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö FORMAT/%†© %s:%d;Éx≥˘ed Numbî=G=%d(h≠loid), buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

659 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nR_‹i
, 
k_§c
);

660 
îr
;

662 
l
 = 
°r
.l -Ü;

663 ; 
l
<
size
;Ü++Ë
	`kputc
(0, &
°r
);

667 
ƒë
 = 
	`bcf_upd©e_f‹m©
(
hódî
, 
löe
, 
	`bcf_hdr_öt2id
(hódî,
BCF_DT_ID
,
fmt
->
id
), (*)
°r
.
s
, så.
l
, 
ty≥
);

668 i‡–
ƒë
<0 )

670 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ upd©êFORMAT/%†© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

671 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
ƒë
);

672 
îr
;

677 
n‹i
 = 
ƒë
 / 
löe
->
n_ßm∂e
;

678 i‡–
n‹i
==1 && !(
vÀn
==
BCF_VL_A
 &&Ç‹i==
nA_‹i
) )

680 
Æl_missög
 = 1;

681 
	#BRANCH
(
ty≥_t
, 
is_missög
) { \

682 
j
=0; j<
löe
->
n_ßm∂e
; j++) \

684 
ty≥_t
 *
p
 = (ty≥_t*Ë(
fmt
->∞+ 
j
*fmt->
size
); \

685 i‡–!(
is_missög
)Ë{ 
Æl_missög
 = 0; ; } \

687 }

	)

688 
fmt
->
ty≥
) {

689 
BCF_BT_INT8
: 
	`BRANCH
(
öt8_t
, 
p
[0]==
bcf_öt8_missög
); ;

690 
BCF_BT_INT16
: 
	`BRANCH
(
öt16_t
, 
p
[0]==
bcf_öt16_missög
); ;

691 
BCF_BT_INT32
: 
	`BRANCH
(
öt32_t
, 
p
[0]==
bcf_öt32_missög
); ;

692 
BCF_BT_FLOAT
: 
	`BRANCH
(, 
	`bcf_Êﬂt_is_missög
(
p
[0])); ;

693 : i‡(
hts_vîbo£
>1Ë{ 
	`Ârötf
(
°dîr
,"todo:Åy≥ %d\n", 
fmt
->
ty≥
); } 
îr
; ;

695 #unde‡
BRANCH


696 i‡(
Æl_missög
) ;

699 i‡–
vÀn
==
BCF_VL_A
 || vÀn==
BCF_VL_R
 || (vÀn==
BCF_VL_G
 && 
n‹i
==
nR_‹i
) )

701 
öc
 = 0, 
¬ew
;

702 i‡–
vÀn
==
BCF_VL_A
 )

704 i‡–
n‹i
!=
nA_‹i
 )

706 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö FORMAT/%†© %s:%d;Éx≥˘ed Numbî=A=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

707 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nA_‹i
, 
n‹i
);

708 
îr
;

710 
nd©
 = 
nA_√w
*
löe
->
n_ßm∂e
;

711 
¬ew
 = 
nA_√w
;

712 
öc
 = 1;

716 i‡–
n‹i
!=
nR_‹i
 )

718 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö FORMAT/%†© %s:%d;Éx≥˘ed Numbî=R=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

719 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nR_‹i
, 
n‹i
);

720 
îr
;

722 
nd©
 = 
nR_√w
*
löe
->
n_ßm∂e
;

723 
¬ew
 = 
nR_√w
;

726 
	#BRANCH
(
ty≥_t
,
is_ve˘‹_íd
) \

728 
j
=0; j<
löe
->
n_ßm∂e
; j++) \

730 
ty≥_t
 *
±r_§c
 = (—y≥_t*)
d©
Ë+ 
j
*
n‹i
; \

731 
ty≥_t
 *
±r_d°
 = (—y≥_t*)
d©
Ë+ 
j
*
¬ew
; \

732 
size
 = (
ty≥_t
); \

733 
k_§c
, 
k_d°
 = 0; \

734 
k_§c
=0; k_§c<
n‹i
; k_src++) \

736 i‡–
is_ve˘‹_íd
 ) { 
	`mem˝y
(
±r_d°
+
k_d°
, 
±r_§c
+
k_§c
, 
size
); ; } \

737 i‡–
	`kbs_exi°s
(
rm_£t
, 
k_§c
+
öc
) ) ; \

738 
	`mem˝y
(
±r_d°
+
k_d°
, 
±r_§c
+
k_§c
, 
size
); \

739 
k_d°
++; \

742 }

	)

743 
ty≥
)

745 
BCF_HT_INT
: 
	`BRANCH
(
öt32_t
,
±r_§c
[
k_§c
]==
bcf_öt32_ve˘‹_íd
); ;

746 
BCF_HT_REAL
: 
	`BRANCH
(,
	`bcf_Êﬂt_is_ve˘‹_íd
(
±r_§c
[
k_§c
])); ;

748 #unde‡
BRANCH


752 i‡–
n‹i
!=
nG_‹i
 )

754 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] U√x≥˘edÇumbî o‡vÆue†ö FORMAT/%†© %s:%d;Éx≥˘ed Numbî=G=%d, buàfound %d\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

755 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
nG_‹i
, 
n‹i
);

756 
îr
;

758 
nd©
 = 
nG_√w
*
löe
->
n_ßm∂e
;

760 
	#BRANCH
(
ty≥_t
,
is_ve˘‹_íd
) \

762 
j
=0; j<
löe
->
n_ßm∂e
; j++) \

764 
ty≥_t
 *
±r_§c
 = (—y≥_t*)
d©
Ë+ 
j
*
n‹i
; \

765 
ty≥_t
 *
±r_d°
 = (—y≥_t*)
d©
Ë+ 
j
*
nG_√w
; \

766 
size
 = (
ty≥_t
); \

767 
ü
, 
ib
, 
k_d°
 = 0, 
k_§c
; \

768 
n£t
 = 0; \

769 
k_§c
=0; k_§c<
nG_‹i
; k_§c++Ë{ i‡–
is_ve˘‹_íd
 ) ; 
n£t
++; } \

770 i‡–
n£t
==
nR_‹i
 ) \

772 
k_§c
=0; k_§c<
nR_‹i
; k_src++) \

774 i‡–
	`kbs_exi°s
(
rm_£t
, 
k_§c
) ) ; \

775 
	`mem˝y
(
±r_d°
+
k_d°
, 
±r_§c
+
k_§c
, 
size
); \

776 
k_d°
++; \

778 
	`mem˝y
(
±r_d°
+
k_d°
, 
±r_§c
+
k_§c
, 
size
); \

782 
k_§c
 = -1; \

783 
ü
=0; ia<
nR_‹i
; ia++) \

785 
ib
=0; ib<=
ü
; ib++) \

787 
k_§c
++; \

788 i‡–
is_ve˘‹_íd
 ) { 
	`mem˝y
(
±r_d°
+
k_d°
, 
±r_§c
+
k_§c
, 
size
); 
ü
 = 
nR_‹i
; ; } \

789 i‡–
	`kbs_exi°s
(
rm_£t
, 
ü
Ë|| kbs_exi°s‘m_£t, 
ib
) ) ; \

790 
	`mem˝y
(
±r_d°
+
k_d°
, 
±r_§c
+
k_§c
, 
size
); \

791 
k_d°
++; \

796 }

	)

797 
ty≥
)

799 
BCF_HT_INT
: 
	`BRANCH
(
öt32_t
,
±r_§c
[
k_§c
]==
bcf_öt32_ve˘‹_íd
); ;

800 
BCF_HT_REAL
: 
	`BRANCH
(,
	`bcf_Êﬂt_is_ve˘‹_íd
(
±r_§c
[
k_§c
])); ;

802 #unde‡
BRANCH


804 
ƒë
 = 
	`bcf_upd©e_f‹m©
(
hódî
, 
löe
, 
	`bcf_hdr_öt2id
(hódî,
BCF_DT_ID
,
fmt
->
id
), (*)
d©
, 
nd©
, 
ty≥
);

805 i‡–
ƒë
<0 )

807 i‡(
hts_vîbo£
>1Ë
	`Ârötf
(
°dîr
,"[%s:%d %s] CouldÇŸ upd©êFORMAT/%†© %s:%d [%d]\n", 
__FILE__
,
__LINE__
,
__FUNCTION__
,

808 
	`bcf_hdr_öt2id
(
hódî
,
BCF_DT_ID
,
fmt
->
id
), 
	`bcf_£q«me
(hódî,
löe
),Üöe->
pos
+1, 
ƒë
);

809 
îr
;

813 
˛ón
:

814 
	`‰ì
(
°r
.
s
);

815 
	`‰ì
(
m≠
);

816 
	`‰ì
(
d©
);

819 
îr
:

820 
	`‰ì
(
°r
.
s
);

821 
	`‰ì
(
m≠
);

822 
	`‰ì
(
d©
);

824 
	}
}

	@kseq.h

28 #i‚de‡
AC_KSEQ_H


29 
	#AC_KSEQ_H


	)

31 
	~<˘y≥.h
>

32 
	~<°rög.h
>

33 
	~<°dlib.h
>

35 #ifde‡
USE_MALLOC_WRAPPERS


36 
	~"mÆloc_wøp.h
"

39 
	#KS_SEP_SPACE
 0

40 
	#KS_SEP_TAB
 1

41 
	#KS_SEP_LINE
 2

42 
	#KS_SEP_MAX
 2

	)

44 
	#__KS_TYPE
(
ty≥_t
) \

45 
	s__k°ªam_t
 { \

46 *
buf
; \

47 
begö
, 
íd
, 
is_eof
, 
œ°_ch¨
; \

48 
ty≥_t
 
f
; \

49 } 
	tk°ªam_t
;

	)

51 
	#ks_eof
(
ks
Ë((ks)->
is_eof
 && (ks)->
begö
 >(ks)->
íd
)

	)

52 
	#ks_ªwöd
(
ks
Ë((ks)->
is_eof
 = (ks)->
begö
 = (ks)->
íd
 = 0)

	)

54 
	#__KS_BASIC
(
ty≥_t
, 
__bufsize
) \

55 
ölöe
 
k°ªam_t
 *
	`ks_öô
(
ty≥_t
 
f
) \

57 
k°ªam_t
 *
ks
 = (k°ªam_t*)
	`ˇŒoc
(1, (kstream_t)); \

58 
ks
->
f
 = f; \

59 
ks
->
buf
 = (*)
	`mÆloc
(
__bufsize
); \

60  
ks
; \

62 
ölöe
 
	`ks_de°roy
(
k°ªam_t
 *
ks
) \

64 i‡(
ks
) { \

65 
	`‰ì
(
ks
->
buf
); \

66 
	`‰ì
(
ks
); \

68 }

	)

70 
	#__KS_GETC
(
__ªad
, 
__bufsize
) \

71 
ölöe
 
	`ks_gëc
(
k°ªam_t
 *
ks
) \

73 i‡(
ks
->
is_eof
 && ks->
begö
 >ks->
íd
)  -1; \

74 i‡(
ks
->
begö
 >ks->
íd
) { \

75 
ks
->
begö
 = 0; \

76 
ks
->
íd
 = 
	`__ªad
(ks->
f
, ks->
buf
, 
__bufsize
); \

77 i‡(
ks
->
íd
 =0Ë{ ks->
is_eof
 = 1;  -1;} \

79  ()
ks
->
buf
[ks->
begö
++]; \

80 }

	)

82 #i‚de‡
KSTRING_T


83 
	#KSTRING_T
 
k°rög_t


	)

84 
	s__k°rög_t
 {

85 
size_t
 
	ml
, 
	mm
;

86 *
	ms
;

87 } 
	tk°rög_t
;

90 #i‚de‡
kroundup32


91 
	#kroundup32
(
x
Ë(--(x), (x)|=(x)>>1, (x)|=(x)>>2, (x)|=(x)>>4, (x)|=(x)>>8, (x)|=(x)>>16, ++(x))

	)

94 
	#__KS_GETUNTIL
(
__ªad
, 
__bufsize
) \

95 
	`ks_gëu¡û2
(
k°ªam_t
 *
ks
, 
dñimôî
, 
k°rög_t
 *
°r
, *
dªt
, 
≠≥nd
) \

97 
gŸ™y
 = 0; \

98 i‡(
dªt
) *dret = 0; \

99 
°r
->
l
 = 
≠≥nd
? str->l : 0; \

101 
i
; \

102 i‡(
ks
->
begö
 >ks->
íd
) { \

103 i‡(!
ks
->
is_eof
) { \

104 
ks
->
begö
 = 0; \

105 
ks
->
íd
 = 
	`__ªad
(ks->
f
, ks->
buf
, 
__bufsize
); \

106 i‡(
ks
->
íd
 =0Ë{ ks->
is_eof
 = 1; ; } \

109 i‡(
dñimôî
 =
KS_SEP_LINE
) { \

110 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

111 i‡(
ks
->
buf
[
i
] == '\n') ; \

112 } i‡(
dñimôî
 > 
KS_SEP_MAX
) { \

113 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

114 i‡(
ks
->
buf
[
i
] =
dñimôî
) ; \

115 } i‡(
dñimôî
 =
KS_SEP_SPACE
) { \

116 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

117 i‡(
	`is•a˚
(
ks
->
buf
[
i
])) ; \

118 } i‡(
dñimôî
 =
KS_SEP_TAB
) { \

119 
i
 = 
ks
->
begö
; i < ks->
íd
; ++i) \

120 i‡(
	`is•a˚
(
ks
->
buf
[
i
]) && ks->buf[i] != ' ') ; \

121 } 
i
 = 0; \

122 i‡(
°r
->
m
 - så->
l
 < (
size_t
)(
i
 - 
ks
->
begö
 + 1)) { \

123 
°r
->
m
 = så->
l
 + (
i
 - 
ks
->
begö
) + 1; \

124 
	`kroundup32
(
°r
->
m
); \

125 
°r
->
s
 = (*)
	`ªÆloc
(°r->s, så->
m
); \

127 
gŸ™y
 = 1; \

128 
	`mem˝y
(
°r
->
s
 + så->
l
, 
ks
->
buf
 + ks->
begö
, 
i
 - ks->begin); \

129 
°r
->
l
 = så->»+ (
i
 - 
ks
->
begö
); \

130 
ks
->
begö
 = 
i
 + 1; \

131 i‡(
i
 < 
ks
->
íd
) { \

132 i‡(
dªt
Ë*dªà
ks
->
buf
[
i
]; \

136 i‡(!
gŸ™y
 && 
	`ks_eof
(
ks
))  -1; \

137 i‡(
°r
->
s
 == 0) { \

138 
°r
->
m
 = 1; \

139 
°r
->
s
 = (*)
	`ˇŒoc
(1, 1); \

140 } i‡(
dñimôî
 =
KS_SEP_LINE
 && 
°r
->
l
 > 1 && så->
s
[str->l-1] == '\r') --str->l; \

141 
°r
->
s
[°r->
l
] = '\0'; \

142  
°r
->
l
; \

144 
ölöe
 
	`ks_gëu¡û
(
k°ªam_t
 *
ks
, 
dñimôî
, 
k°rög_t
 *
°r
, *
dªt
) \

145 {  
	`ks_gëu¡û2
(
ks
, 
dñimôî
, 
°r
, 
dªt
, 0); }

	)

147 
	#KSTREAM_INIT
(
ty≥_t
, 
__ªad
, 
__bufsize
) \

148 
	`__KS_TYPE
(
ty≥_t
) \

149 
	`__KS_BASIC
(
ty≥_t
, 
__bufsize
) \

150 
	`__KS_GETC
(
__ªad
, 
__bufsize
) \

151 
	`__KS_GETUNTIL
(
__ªad
, 
__bufsize
)

	)

153 
	#k£q_ªwöd
(
ks
Ë((ks)->
f
->
œ°_ch¨
 = (ks)->f->
is_eof
 = (ks)->f->
begö
 = (ks)->f->
íd
 = 0)

	)

155 
	#__KSEQ_BASIC
(
SCOPE
, 
ty≥_t
) \

156 
SCOPE
 
k£q_t
 *
	`k£q_öô
(
ty≥_t
 
fd
) \

158 
k£q_t
 *
s
 = (k£q_t*)
	`ˇŒoc
(1, (kseq_t)); \

159 
s
->
f
 = 
	`ks_öô
(
fd
); \

160  
s
; \

162 
SCOPE
 
	`k£q_de°roy
(
k£q_t
 *
ks
) \

164 i‡(!
ks
) ; \

165 
	`‰ì
(
ks
->
«me
.
s
); fªe(ks->
commít
.s); fªe(ks->
£q
.s); fªe(ks->
quÆ
.s); \

166 
	`ks_de°roy
(
ks
->
f
); \

167 
	`‰ì
(
ks
); \

168 }

	)

175 
	#__KSEQ_READ
(
SCOPE
) \

176 
SCOPE
 
	`k£q_ªad
(
k£q_t
 *
£q
) \

178 
c
; \

179 
k°ªam_t
 *
ks
 = 
£q
->
f
; \

180 i‡(
ks
->
œ°_ch¨
 == 0) { \

181 (
c
 = 
	`ks_gëc
(
ks
)) != -1 && c != '>' && c != '@'); \

182 i‡(
c
 == -1)  -1; \

183 
ks
->
œ°_ch¨
 = 
c
; \

185 
£q
->
commít
.
l
 = seq->£q.»£q->
quÆ
.l = 0; \

186 i‡(
	`ks_gëu¡û
(
ks
, 0, &
£q
->
«me
, &
c
) < 0)  -1; \

187 i‡(
c
 !'\n'Ë
	`ks_gëu¡û
(
ks
, 
KS_SEP_LINE
, &
£q
->
commít
, 0); \

188 i‡(
£q
->£q.
s
 == 0) { \

189 
£q
->£q.
m
 = 256; \

190 
£q
->£q.
s
 = (*)
	`mÆloc
(£q->£q.
m
); \

192 (
c
 = 
	`ks_gëc
(
ks
)) != -1 && c != '>' && c != '+' && c != '@') { \

193 i‡(
c
 == '\n') ; \

194 
£q
->£q.
s
[£q->£q.
l
++] = 
c
; \

195 
	`ks_gëu¡û2
(
ks
, 
KS_SEP_LINE
, &
£q
->seq, 0, 1); \

197 i‡(
c
 ='>' || c ='@'Ë
ks
->
œ°_ch¨
 = c; \

198 i‡(
£q
->£q.
l
 + 1 >£q->£q.
m
) { \

199 
£q
->£q.
m
 = seq->£q.
l
 + 2; \

200 
	`kroundup32
(
£q
->£q.
m
); \

201 
£q
->£q.
s
 = (*)
	`ªÆloc
(£q->£q.s, seq->£q.
m
); \

203 
£q
->£q.
s
[£q->£q.
l
] = 0; \

204 i‡(
c
 !'+'Ë 
£q
->£q.
l
; \

205 i‡(
£q
->
quÆ
.
m
 < seq->seq.m) { \

206 
£q
->
quÆ
.
m
 = seq->seq.m; \

207 
£q
->
quÆ
.
s
 = (*)
	`ªÆloc
(£q->quÆ.s, seq->quÆ.
m
); \

209 (
c
 = 
	`ks_gëc
(
ks
)) != -1 && c != '\n'); \

210 i‡(
c
 == -1)  -2; \

211 
	`ks_gëu¡û2
(
ks
, 
KS_SEP_LINE
, &
£q
->
quÆ
, 0, 1Ë>0 && seq->quÆ.
l
 < seq->seq.l); \

212 
ks
->
œ°_ch¨
 = 0; \

213 i‡(
£q
->£q.
l
 !£q->
quÆ
.l)  -2; \

214  
£q
->£q.
l
; \

215 }

	)

216 
	#__KSEQ_COPY
(
SCOPE
) \

217 
SCOPE
 
	`k£q_c›y
(
k£q_t
 *
£q
, k£q_à
k£q
)\

219 
£q
->
«me
.
s
 = 
	`°rdup
(
k£q
.name.s); \

220 
£q
->£q.
s
 = 
	`°rdup
(
k£q
.seq.s); \

221 
£q
->£q.
l
 = 
k£q
.seq.l; \

222 }

	)

224 
	#__KSEQ_TYPE
(
ty≥_t
) \

226 
k°rög_t
 
«me
, 
commít
, 
£q
, 
quÆ
; \

227 
k°ªam_t
 *
f
; \

228 } 
	tk£q_t
;

	)

230 
	#KSEQ_INIT2
(
SCOPE
, 
ty≥_t
, 
__ªad
) \

231 
	`KSTREAM_INIT
(
ty≥_t
, 
__ªad
, 16384) \

232 
	`__KSEQ_TYPE
(
ty≥_t
) \

233 
	`__KSEQ_BASIC
(
SCOPE
, 
ty≥_t
) \

234 
	`__KSEQ_READ
(
SCOPE
) \

235 
	`__KSEQ_COPY
(
SCOPE
)

	)

237 
	#KSEQ_INIT
(
ty≥_t
, 
__ªad
Ë
	`KSEQ_INIT2
(,Åy≥_t, __ªad)

	)

239 
	#KSEQ_DECLARE
(
ty≥_t
) \

240 
	`__KS_TYPE
(
ty≥_t
) \

241 
	`__KSEQ_TYPE
(
ty≥_t
) \

242 
k£q_t
 *
	`k£q_öô
(
ty≥_t
 
fd
); \

243 
	`k£q_de°roy
(
k£q_t
 *
ks
); \

244 
	`k£q_ªad
(
k£q_t
 *
£q
); \

245 
	`k£q_c›y
(
k£q_t
 *
£q
, k£q_à
k£q
);

	)

	@ksort.h

55 #i‚de‡
AC_KSORT_H


56 
	#AC_KSORT_H


	)

58 
	~<°dlib.h
>

59 
	~<°rög.h
>

61 #ifde‡
USE_MALLOC_WRAPPERS


62 
	~"mÆloc_wøp.h
"

66 *
	mÀ·
, *
	mright
;

67 
	mdïth
;

68 } 
	tks_is‹t_°ack_t
;

70 
	#KSORT_SWAP
(
ty≥_t
, 
a
, 
b
Ë{ ty≥_à
t
=◊); (a)=(b); (b)Ò; }

	)

72 
	#KSORT_INIT
(
«me
, 
ty≥_t
, 
__s‹t_…
) \

73 
ks_mîges‹t_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
¨øy
[],Åy≥_à
ãmp
[]) \

75 
ty≥_t
 *
a2
[2], *
a
, *
b
; \

76 
cuº
, 
shi·
; \

78 
a2
[0] = 
¨øy
; \

79 
a2
[1] = 
ãmp
?Åem∞: (
ty≥_t
*)
	`mÆloc
(—y≥_tË* 
n
); \

80 
cuº
 = 0, 
shi·
 = 0; (1ul<<shi·Ë< 
n
; ++shift) { \

81 
a
 = 
a2
[
cuº
]; 
b
 =á2[1-curr]; \

82 i‡(
shi·
 == 0) { \

83 
ty≥_t
 *
p
 = 
b
, *
i
, *
eb
 = 
a
 + 
n
; \

84 
i
 = 
a
; i < 
eb
; i += 2) { \

85 i‡(
i
 =
eb
 - 1Ë*
p
++ = *i; \

87 i‡(
	`__s‹t_…
(*(
i
+1), *i)) { \

88 *
p
++ = *(
i
+1); *p++ = *i; \

90 *
p
++ = *
i
; *p++ = *(i+1); \

95 
size_t
 
i
, 
°ï
 = 1ul<<
shi·
; \

96 
i
 = 0; i < 
n
; i +
°ï
<<1) { \

97 
ty≥_t
 *
p
, *
j
, *
k
, *
ó
, *
eb
; \

98 i‡(
n
 < 
i
 + 
°ï
) { \

99 
ó
 = 
a
 + 
n
; 
eb
 =á; \

101 
ó
 = 
a
 + 
i
 + 
°ï
; \

102 
eb
 = 
a
 + (
n
 < 
i
 + (
°ï
<<1)?Ç : i + (step<<1)); \

104 
j
 = 
a
 + 
i
; 
k
 =á + i + 
°ï
; 
p
 = 
b
 + i; \

105 
j
 < 
ó
 && 
k
 < 
eb
) { \

106 i‡(
	`__s‹t_…
(*
k
, *
j
)Ë*
p
++ = *k++; \

107 *
p
++ = *
j
++; \

109 
j
 < 
ó
Ë*
p
++ = *j++; \

110 
k
 < 
eb
Ë*
p
++ = *k++; \

113 
cuº
 = 1 - curr; \

115 i‡(
cuº
 == 1) { \

116 
ty≥_t
 *
p
 = 
a2
[0], *
i
 =á2[1], *
eb
 = 
¨øy
 + 
n
; \

117 ; 
p
 < 
eb
; ++
i
) *p++ = *i; \

119 i‡(
ãmp
 =0Ë
	`‰ì
(
a2
[1]); \

121 
ks_hó∑dju°_
##
	`«me
(
size_t
 
i
, size_à
n
, 
ty≥_t
 
l
[]) \

123 
size_t
 
k
 = 
i
; \

124 
ty≥_t
 
tmp
 = 
l
[
i
]; \

125 (
k
 = (k << 1Ë+ 1Ë< 
n
) { \

126 i‡(
k
 !
n
 - 1 && 
	`__s‹t_…
(
l
[k],Ü[k+1])) ++k; \

127 i‡(
	`__s‹t_…
(
l
[
k
], 
tmp
)) ; \

128 
l
[
i
] =Ü[
k
]; i = k; \

130 
l
[
i
] = 
tmp
; \

132 
ks_hópmake_
##
	`«me
(
size_t
 
lsize
, 
ty≥_t
 
l
[]) \

134 
size_t
 
i
; \

135 
i
 = (
lsize
 >> 1Ë- 1; i !(
size_t
)(-1); --i) \

136 
ks_hó∑dju°_
##
	`«me
(
i
, 
lsize
, 
l
); \

138 
ks_hóps‹t_
##
	`«me
(
size_t
 
lsize
, 
ty≥_t
 
l
[]) \

140 
size_t
 
i
; \

141 
i
 = 
lsize
 - 1; i > 0; --i) { \

142 
ty≥_t
 
tmp
; \

143 
tmp
 = *
l
; *»l[
i
];Ü[i] =Åmp; 
ks_hó∑dju°_
##
	`«me
(0, i,Ü); \

146 
ölöe
 
__ks_ö£πs‹t_
##
	`«me
(
ty≥_t
 *
s
,Åy≥_à*
t
) \

148 
ty≥_t
 *
i
, *
j
, 
sw≠_tmp
; \

149 
i
 = 
s
 + 1; i < 
t
; ++i) \

150 
j
 = 
i
; j > 
s
 && 
	`__s‹t_…
(*j, *(j-1)); --j) { \

151 
sw≠_tmp
 = *
j
; *j = *(j-1); *(j-1) = swap_tmp; \

154 
ks_combs‹t_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
a
[]) \

156 c⁄° 
shrök_Á˘‹
 = 1.2473309501039786540366528676643; \

157 
do_sw≠
; \

158 
size_t
 
g≠
 = 
n
; \

159 
ty≥_t
 
tmp
, *
i
, *
j
; \

161 i‡(
g≠
 > 2) { \

162 
g≠
 = (
size_t
)(g≠ / 
shrök_Á˘‹
); \

163 i‡(
g≠
 == 9 || gap == 10) gap = 11; \

165 
do_sw≠
 = 0; \

166 
i
 = 
a
; i <á + 
n
 - 
g≠
; ++i) { \

167 
j
 = 
i
 + 
g≠
; \

168 i‡(
	`__s‹t_…
(*
j
, *
i
)) { \

169 
tmp
 = *
i
; *ò*
j
; *j =Åmp; \

170 
do_sw≠
 = 1; \

173 } 
do_sw≠
 || 
g≠
 > 2); \

174 i‡(
g≠
 !1Ë
__ks_ö£πs‹t_
##
	`«me
(
a
,á + 
n
); \

176 
ks_öåos‹t_
##
	`«me
(
size_t
 
n
, 
ty≥_t
 
a
[]) \

178 
d
; \

179 
ks_is‹t_°ack_t
 *
t›
, *
°ack
; \

180 
ty≥_t
 
Ω
, 
sw≠_tmp
; \

181 
ty≥_t
 *
s
, *
t
, *
i
, *
j
, *
k
; \

183 i‡(
n
 < 1) ; \

184 i‡(
n
 == 2) { \

185 i‡(
	`__s‹t_…
(
a
[1],á[0])Ë{ 
sw≠_tmp
 =á[0];á[0] =á[1];á[1] = swap_tmp; } \

188 
d
 = 2; 1ul<<d < 
n
; ++d); \

189 
°ack
 = (
ks_is‹t_°ack_t
*)
	`mÆloc
((ks_is‹t_°ack_tË* (((
size_t
)*
d
)+2)); \

190 
t›
 = 
°ack
; 
s
 = 
a
; 
t
 =á + (
n
-1); 
d
 <<= 1; \

192 i‡(
s
 < 
t
) { \

193 i‡(--
d
 == 0) { \

194 
ks_combs‹t_
##
	`«me
(
t
 - 
s
 + 1, s); \

195 
t
 = 
s
; \

198 
i
 = 
s
; 
j
 = 
t
; 
k
 = i + ((j-i)>>1) + 1; \

199 i‡(
	`__s‹t_…
(*
k
, *
i
)) { \

200 i‡(
	`__s‹t_…
(*
k
, *
j
)) k = j; \

201 } 
k
 = 
	`__s‹t_…
(*
j
, *
i
)? i : j; \

202 
Ω
 = *
k
; \

203 i‡(
k
 !
t
Ë{ 
sw≠_tmp
 = *k; *k = *t; *t = swap_tmp; } \

205 dÿ++
i
; 
	`__s‹t_…
(*i, 
Ω
)); \

206 dÿ--
j
; 
i
 <j && 
	`__s‹t_…
(
Ω
, *j)); \

207 i‡(
j
 <
i
) ; \

208 
sw≠_tmp
 = *
i
; *ò*
j
; *j = swap_tmp; \

210 
sw≠_tmp
 = *
i
; *ò*
t
; *t = swap_tmp; \

211 i‡(
i
-
s
 > 
t
-i) { \

212 i‡(
i
-
s
 > 16Ë{ 
t›
->
À·
 = s;Å›->
right
 = i-1;Å›->
dïth
 = 
d
; ++top; } \

213 
s
 = 
t
-
i
 > 16? i+1 :Å; \

215 i‡(
t
-
i
 > 16Ë{ 
t›
->
À·
 = i+1;Å›->
right
 =Å;Å›->
dïth
 = 
d
; ++top; } \

216 
t
 = 
i
-
s
 > 16? i-1 : s; \

219 i‡(
t›
 =
°ack
) { \

220 
	`‰ì
(
°ack
); \

221 
__ks_ö£πs‹t_
##
	`«me
(
a
,á+
n
); \

223 } { --
t›
; 
s
 = (
ty≥_t
*È›->
À·
; 
t
 = (ty≥_t*È›->
right
; 
d
 =Å›->
dïth
; } \

229 
ty≥_t
 
ks_ksmÆl_
##
	`«me
(
size_t
 
n
,Åy≥_à
¨r
[], size_à
kk
) \

231 
ty≥_t
 *
low
, *
high
, *
k
, *
Œ
, *
hh
, *
mid
; \

232 
low
 = 
¨r
; 
high
 =áº + 
n
 - 1; 
k
 =áº + 
kk
; \

234 i‡(
high
 <
low
Ë *
k
; \

235 i‡(
high
 =
low
 + 1) { \

236 i‡(
	`__s‹t_…
(*
high
, *
low
)Ë
	`KSORT_SWAP
(
ty≥_t
, *low, *high); \

237  *
k
; \

239 
mid
 = 
low
 + (
high
 -Üow) / 2; \

240 i‡(
	`__s‹t_…
(*
high
, *
mid
)Ë
	`KSORT_SWAP
(
ty≥_t
, *mid, *high); \

241 i‡(
	`__s‹t_…
(*
high
, *
low
)Ë
	`KSORT_SWAP
(
ty≥_t
, *low, *high); \

242 i‡(
	`__s‹t_…
(*
low
, *
mid
)Ë
	`KSORT_SWAP
(
ty≥_t
, *mid, *low); \

243 
	`KSORT_SWAP
(
ty≥_t
, *
mid
, *(
low
+1)); \

244 
Œ
 = 
low
 + 1; 
hh
 = 
high
; \

246 dÿ++
Œ
; 
	`__s‹t_…
(*Œ, *
low
)); \

247 dÿ--
hh
; 
	`__s‹t_…
(*
low
, *hh)); \

248 i‡(
hh
 < 
Œ
) ; \

249 
	`KSORT_SWAP
(
ty≥_t
, *
Œ
, *
hh
); \

251 
	`KSORT_SWAP
(
ty≥_t
, *
low
, *
hh
); \

252 i‡(
hh
 <
k
Ë
low
 = 
Œ
; \

253 i‡(
hh
 >
k
Ë
high
 = hh - 1; \

255 }

	)

257 
	#ks_mîges‹t
(
«me
, 
n
, 
a
, 
t
Ë
ks_mîges‹t_
##
	`«me
“,á,Å)

	)

258 
	#ks_öåos‹t
(
«me
, 
n
, 
a
Ë
ks_öåos‹t_
##
	`«me
“,á)

	)

259 
	#ks_combs‹t
(
«me
, 
n
, 
a
Ë
ks_combs‹t_
##
	`«me
“,á)

	)

260 
	#ks_hóps‹t
(
«me
, 
n
, 
a
Ë
ks_hóps‹t_
##
	`«me
“,á)

	)

261 
	#ks_hópmake
(
«me
, 
n
, 
a
Ë
ks_hópmake_
##
	`«me
“,á)

	)

262 
	#ks_hó∑dju°
(
«me
, 
i
, 
n
, 
a
Ë
ks_hó∑dju°_
##
	`«me
(i,Ç,á)

	)

263 
	#ks_ksmÆl
(
«me
, 
n
, 
a
, 
k
Ë
ks_ksmÆl_
##
	`«me
“,á, k)

	)

265 
	#ks_…_gíîic
(
a
, 
b
Ë(◊Ë< (b))

	)

266 
	#ks_…_°r
(
a
, 
b
Ë(
	`°rcmp
(◊), (b)Ë< 0)

	)

268 c⁄° *
	tks°r_t
;

270 
	#KSORT_INIT_GENERIC
(
ty≥_t
Ë
	`KSORT_INIT
—y≥_t,Åy≥_t, 
ks_…_gíîic
)

	)

271 
	#KSORT_INIT_STR
 
	`KSORT_INIT
(
°r
, 
ks°r_t
, 
ks_…_°r
)

	)

	@utils.c

27 
	#FSYNC_ON_FLUSH


	)

29 
	~<°dio.h
>

30 
	~<°d¨g.h
>

31 
	~<°dlib.h
>

32 
	~<°rög.h
>

33 
	~<zlib.h
>

34 
	~<î∫o.h
>

35 #ifde‡
FSYNC_ON_FLUSH


36 
	~<sys/ty≥s.h
>

37 
	~<sys/°©.h
>

38 
	~<uni°d.h
>

40 
	~<sys/ªsour˚.h
>

41 
	~<sys/time.h
>

42 
	~<time.h
>

43 
	~"utûs.h
"

45 
	~"ks‹t.h
"

46 
	#∑ú64_…
(
a
, 
b
Ë(◊).
x
 < (b).x || (◊).x =(b).x && (a).
y
 < (b).y))

	)

47 
	$KSORT_INIT
(128, 
∑ú64_t
, 
∑ú64_…
)

48 
	$KSORT_INIT
(64, 
uöt64_t
, 
ks_…_gíîic
)

50 
	~"k£q.h
"

51 
	$KSEQ_INIT2
(, 
gzFûe
, 
îr_gzªad
)

57 
FILE
 *
	$îr_x›í_c‹e
(c⁄° *
func
, c⁄° *
‚
, c⁄° *
mode
)

59 
FILE
 *
Â
 = 0;

60 i‡(
	`°rcmp
(
‚
, "-") == 0)

61  (
	`°r°r
(
mode
, "r"))? 
°dö
 : 
°dout
;

62 i‡((
Â
 = 
	`f›í
(
‚
, 
mode
)) == 0) {

63 
	`îr_Áèl
(
func
, "ÁûÅÿ›í fûê'%s' : %s", 
‚
, 
	`°ªº‹
(
î∫o
));

65  
Â
;

66 
	}
}

68 
FILE
 *
	$îr_xª›í_c‹e
(c⁄° *
func
, c⁄° *
‚
, c⁄° *
mode
, 
FILE
 *
Â
)

70 i‡(
	`‰e›í
(
‚
, 
mode
, 
Â
) == 0) {

71 
	`îr_Áèl
(
func
, "ÁûÅÿ›í fûê'%s' : %s", 
‚
, 
	`°ªº‹
(
î∫o
));

73  
Â
;

74 
	}
}

76 
gzFûe
 
	$îr_xz›í_c‹e
(c⁄° *
func
, c⁄° *
‚
, c⁄° *
mode
)

78 
gzFûe
 
Â
;

79 i‡(
	`°rcmp
(
‚
, "-") == 0) {

80 
Â
 = 
	`gzd›í
(
	`fûío
((
	`°r°r
(
mode
, "r"))? 
°dö
 : 
°dout
), mode);

82 i‡(!
Â
Ë
	`îr_Áèl
(
func
, "Out of memory");

83  
Â
;

85 i‡((
Â
 = 
	`gz›í
(
‚
, 
mode
)) == 0) {

86 
	`îr_Áèl
(
func
, "ÁûÅÿ›í fûê'%s' : %s", 
‚
, 
î∫o
 ? 
	`°ªº‹
(errno) : "Out of memory");

88  
Â
;

89 
	}
}

91 
	$îr_Áèl
(c⁄° *
hódî
, c⁄° *
fmt
, ...)

93 
va_li°
 
¨gs
;

94 
	`va_°¨t
(
¨gs
, 
fmt
);

95 
	`Ârötf
(
°dîr
, "[%s] ", 
hódî
);

96 
	`vÂrötf
(
°dîr
, 
fmt
, 
¨gs
);

97 
	`Ârötf
(
°dîr
, "\n");

98 
	`va_íd
(
¨gs
);

99 
	`exô
(
EXIT_FAILURE
);

100 
	}
}

102 
	$îr_Áèl_c‹e
(c⁄° *
hódî
, c⁄° *
fmt
, ...)

104 
va_li°
 
¨gs
;

105 
	`va_°¨t
(
¨gs
, 
fmt
);

106 
	`Ârötf
(
°dîr
, "[%s] ", 
hódî
);

107 
	`vÂrötf
(
°dîr
, 
fmt
, 
¨gs
);

108 
	`Ârötf
(
°dîr
, " Abort!\n");

109 
	`va_íd
(
¨gs
);

110 
	`ab‹t
();

111 
	}
}

113 
	$_îr_Áèl_sim∂e
(c⁄° *
func
, c⁄° *
msg
)

115 
	`Ârötf
(
°dîr
, "[%s] %s\n", 
func
, 
msg
);

116 
	`exô
(
EXIT_FAILURE
);

117 
	}
}

119 
	$_îr_Áèl_sim∂e_c‹e
(c⁄° *
func
, c⁄° *
msg
)

121 
	`Ârötf
(
°dîr
, "[%s] %†Ab‹t!\n", 
func
, 
msg
);

122 
	`ab‹t
();

123 
	}
}

125 
size_t
 
	$îr_fwrôe
(c⁄° *
±r
, 
size_t
 
size
, size_à
nmemb
, 
FILE
 *
°ªam
)

127 
size_t
 
ªt
 = 
	`fwrôe
(
±r
, 
size
, 
nmemb
, 
°ªam
);

128 i‡(
ªt
 !
nmemb
)

129 
	`_îr_Áèl_sim∂e
("fwrôe", 
	`°ªº‹
(
î∫o
));

130  
ªt
;

131 
	}
}

133 
size_t
 
	$îr_‰ód_n€of
(*
±r
, 
size_t
 
size
, size_à
nmemb
, 
FILE
 *
°ªam
)

135 
size_t
 
ªt
 = 
	`‰ód
(
±r
, 
size
, 
nmemb
, 
°ªam
);

136 i‡(
ªt
 !
nmemb
)

138 
	`_îr_Áèl_sim∂e
("‰ód", 
	`„º‹
(
°ªam
Ë? 
	`°ªº‹
(
î∫o
) : "UnexpectedÉnd of file");

140  
ªt
;

141 
	}
}

143 
	$îr_gzªad
(
gzFûe
 
fûe
, *
±r
, 
Àn
)

145 
ªt
 = 
	`gzªad
(
fûe
, 
±r
, 
Àn
);

147 i‡(
ªt
 < 0)

149 
î∫um
 = 0;

150 c⁄° *
msg
 = 
	`gzîr‹
(
fûe
, &
î∫um
);

151 
	`_îr_Áèl_sim∂e
("gzªad", 
Z_ERRNO
 =
î∫um
 ? 
	`°ªº‹
(
î∫o
Ë: 
msg
);

154  
ªt
;

155 
	}
}

157 
	$îr_f£ek
(
FILE
 *
°ªam
, 
off£t
, 
whí˚
)

159 
ªt
 = 
	`f£ek
(
°ªam
, 
off£t
, 
whí˚
);

160 i‡(0 !
ªt
)

162 
	`_îr_Áèl_sim∂e
("f£ek", 
	`°ªº‹
(
î∫o
));

164  
ªt
;

165 
	}
}

167 
	$îr_·ñl
(
FILE
 *
°ªam
)

169 
ªt
 = 
	`·ñl
(
°ªam
);

170 i‡(-1 =
ªt
)

172 
	`_îr_Áèl_sim∂e
("·ñl", 
	`°ªº‹
(
î∫o
));

174  
ªt
;

175 
	}
}

177 
	$îr_func_¥ötf
(c⁄° *
func
, c⁄° *
f‹m©
, ...)

179 
	`Ârötf
(
°dîr
, "[%s] ", 
func
);

180 
va_li°
 
¨g
;

181 
d⁄e
;

182 
	`va_°¨t
(
¨g
, 
f‹m©
);

183 
d⁄e
 = 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨g
);

184 
ßveEºno
 = 
î∫o
;

185 
	`va_íd
(
¨g
);

186 i‡(
d⁄e
 < 0Ë
	`_îr_Áèl_sim∂e
("vÂrötf(°dîr)", 
	`°ªº‹
(
ßveEºno
));

187  
d⁄e
;

189 
	}
}

191 
	$îr_¥ötf
(c⁄° *
f‹m©
, ...)

193 
va_li°
 
¨g
;

194 
d⁄e
;

195 
	`va_°¨t
(
¨g
, 
f‹m©
);

196 
d⁄e
 = 
	`vÂrötf
(
°dîr
, 
f‹m©
, 
¨g
);

197 
ßveEºno
 = 
î∫o
;

198 
	`va_íd
(
¨g
);

199 i‡(
d⁄e
 < 0Ë
	`_îr_Áèl_sim∂e
("vÂrötf(°dîr)", 
	`°ªº‹
(
ßveEºno
));

200  
d⁄e
;

201 
	}
}

203 
	$°dout_¥ötf
(c⁄° *
f‹m©
, ...)

205 
va_li°
 
¨g
;

206 
d⁄e
;

207 
	`va_°¨t
(
¨g
, 
f‹m©
);

208 
d⁄e
 = 
	`vÂrötf
(
°dout
, 
f‹m©
, 
¨g
);

209 
ßveEºno
 = 
î∫o
;

210 
	`va_íd
(
¨g
);

211 i‡(
d⁄e
 < 0Ë
	`_îr_Áèl_sim∂e
("vÂrötf(°dout)", 
	`°ªº‹
(
ßveEºno
));

212  
d⁄e
;

213 
	}
}

215 
	$îr_Ârötf
(
FILE
 *
°ªam
, c⁄° *
f‹m©
, ...)

217 
va_li°
 
¨g
;

218 
d⁄e
;

219 
	`va_°¨t
(
¨g
, 
f‹m©
);

220 
d⁄e
 = 
	`vÂrötf
(
°ªam
, 
f‹m©
, 
¨g
);

221 
ßveEºno
 = 
î∫o
;

222 
	`va_íd
(
¨g
);

223 i‡(
d⁄e
 < 0Ë
	`_îr_Áèl_sim∂e
("vÂrötf", 
	`°ªº‹
(
ßveEºno
));

224  
d⁄e
;

225 
	}
}

227 
	$îr_Âutc
(
c
, 
FILE
 *
°ªam
)

229 
ªt
 = 
	`putc
(
c
, 
°ªam
);

230 i‡(
EOF
 =
ªt
)

232 
	`_îr_Áèl_sim∂e
("Âutc", 
	`°ªº‹
(
î∫o
));

235  
ªt
;

236 
	}
}

238 
	$îr_Âuts
(c⁄° *
s
, 
FILE
 *
°ªam
)

240 
ªt
 = 
	`Âuts
(
s
, 
°ªam
);

241 i‡(
EOF
 =
ªt
)

243 
	`_îr_Áèl_sim∂e
("Âuts", 
	`°ªº‹
(
î∫o
));

246  
ªt
;

247 
	}
}

249 
	$îr_puts
(c⁄° *
s
)

251 
ªt
 = 
	`puts
(
s
);

252 i‡(
EOF
 =
ªt
)

254 
	`_îr_Áèl_sim∂e
("puts", 
	`°ªº‹
(
î∫o
));

257  
ªt
;

258 
	}
}

260 
	$îr_fÊush
(
FILE
 *
°ªam
)

262 
ªt
 = 
	`fÊush
(
°ªam
);

263 i‡(
ªt
 !0Ë
	`_îr_Áèl_sim∂e
("fÊush", 
	`°ªº‹
(
î∫o
));

265 #ifde‡
FSYNC_ON_FLUSH


273 
°©
 
sbuf
;

274 i‡(0 !
	`f°©
(
	`fûío
(
°ªam
), &
sbuf
))

275 
	`_îr_Áèl_sim∂e
("f°©", 
	`°ªº‹
(
î∫o
));

277 i‡(
	`S_ISREG
(
sbuf
.
°_mode
))

279 i‡(0 !
	`fsync
(
	`fûío
(
°ªam
)))

280 
	`_îr_Áèl_sim∂e
("fsync", 
	`°ªº‹
(
î∫o
));

284  
ªt
;

285 
	}
}

287 
	$îr_f˛o£
(
FILE
 *
°ªam
)

289 
ªt
 = 
	`f˛o£
(
°ªam
);

290 i‡(
ªt
 !0Ë
	`_îr_Áèl_sim∂e
("f˛o£", 
	`°ªº‹
(
î∫o
));

291  
ªt
;

292 
	}
}

294 
	$îr_gz˛o£
(
gzFûe
 
fûe
)

296 
ªt
 = 
	`gz˛o£
(
fûe
);

297 i‡(
Z_OK
 !
ªt
)

299 
	`_îr_Áèl_sim∂e
("gz˛o£", 
Z_ERRNO
 =
ªt
 ? 
	`°ªº‹
(
î∫o
Ë: 
	`zEº‹
(ret));

302  
ªt
;

303 
	}
}

308 *
	$îr_mÆloc
(c⁄° *
func
, 
size_t
 
s
)

310 *
ªt
 = (*)
	`mÆloc
(
s
);

311 i‡(
ªt
 =
NULL
Ë
	`îr_Áèl_c‹e
(
func
, "MÆlo¯Áû!\nSize: %Œd\n", 
s
);

312  
ªt
;

313 
	}
}

315 *
	$îr_ˇŒoc
(c⁄° *
func
, 
size_t
 
n
, size_à
s
)

317 *
ªt
 = (*)
	`ˇŒoc
(
n
, 
s
);

318 i‡(
ªt
 =
NULL
Ë
	`îr_Áèl_c‹e
(
func
, "CÆlo¯Áû!\nN: %d\tSize: %Œd\n", 
n
, 
s
);

319  
ªt
;

320 
	}
}

322 *
	$îr_ªÆloc
(c⁄° *
func
, *
p
, 
size_t
 
s
)

324 *
ªt
 = (*)
	`ªÆloc
(
p
, 
s
);

325 i‡(
ªt
 =
NULL
Ë
	`îr_Áèl_c‹e
(
func
, "RóŒo¯Áû!\nSize: %Œd\n", 
s
);

326  
ªt
;

327 
	}
}

333 
	$˝utime
()

335 
rußge
 
r
;

336 
	`gërußge
(
RUSAGE_SELF
, &
r
);

337  
r
.
ru_utime
.
tv_£c
 +Ñ.
ru_°ime
.tv_£¯+ 1e-6 * (r.ru_utime.
tv_u£c
 +Ñ.ru_stime.tv_usec);

338 
	}
}

340 
	$ªÆtime
()

342 
timevÆ
 
ç
;

343 
timez⁄e
 
tzp
;

344 
	`gëtimeofday
(&
ç
, &
tzp
);

345  
ç
.
tv_£c
 +Åp.
tv_u£c
 * 1e-6;

346 
	}
}

348 
	$gë_cur_time
(c⁄° *
¥efix
)

350 
time_t
 
now
 = 
	`time
(0);

351 
tm
 
ts
; 
buf
[1024];

352 
ts
 = *
	`loˇ…ime
(&
now
);

353 
	`îr_¥ötf
("[%s] ", 
¥efix
);

354 
	`°r·ime
(
buf
, (buf), "%Y-%m-%d-%s", &
ts
);

355 
	}
}

357 
	$¥öt_f‹m©_time
(
FILE
 *
out
)

359 
time_t
 
øwtime
;

360 
tm
 *
öfo
;

361 
buf„r
[80];

363 
	`time
(&
øwtime
);

364 
öfo
 = 
	`loˇ…ime
–&
øwtime
 );

365 
	`°r·ime
(
buf„r
,80,"%m-%d-%Y %X", 
öfo
);

366 
	`Ârötf
(
out
, "==%†==", 
buf„r
);

367 
	}
}

	@utils.h

28 #i‚de‡
LH3_UTILS_H


29 
	#LH3_UTILS_H


	)

31 
	~<°döt.h
>

32 
	~<°dio.h
>

33 
	~<zlib.h
>

35 #ifde‡
__GNUC__


37 
	#ATTRIBUTE
(
li°
Ë
	`__©åibuã__
 (li°)

	)

39 
	#ATTRIBUTE
(
li°
)

	)

42 
	#îr_Áèl_sim∂e
(
msg
Ë
	`_îr_Áèl_sim∂e
(
__func__
, msg)

	)

43 
	#îr_Áèl_sim∂e_c‹e
(
msg
Ë
	`_îr_Áèl_sim∂e_c‹e
(
__func__
, msg)

	)

45 
	#x›í
(
‚
, 
mode
Ë
	`îr_x›í_c‹e
(
__func__
, fn, mode)

	)

46 
	#xª›í
(
‚
, 
mode
, 
Â
Ë
	`îr_xª›í_c‹e
(
__func__
, fn, mode, fp)

	)

47 
	#xz›í
(
‚
, 
mode
Ë
	`îr_xz›í_c‹e
(
__func__
, fn, mode)

	)

49 
	#xas£π
(
c⁄d
, 
msg
Ëi‡((c⁄dË=0Ë
	`_îr_Áèl_sim∂e_c‹e
(
__func__
, msg)

	)

51 
	#_îr_func_¥ötf
(
msg
Ë
	`îr_func_¥ötf
(
__func__
, msg)

	)

54 
uöt64_t
 
	mx
, 
	my
;

55 } 
	t∑ú64_t
;

57 °ru˘ { 
size_t
 
	mn
, 
	mm
; 
uöt64_t
 *
	ma
; } 
	tuöt64_v
;

58 °ru˘ { 
size_t
 
	mn
, 
	mm
; 
∑ú64_t
 *
	ma
; } 
	t∑ú64_v
;

60 #ifde‡
__˝lu•lus


64 
îr_Áèl
(c⁄° *
hódî
, c⁄° *
fmt
, ...Ë
ATTRIBUTE
((
n‹ëu∫
));

65 
îr_Áèl_c‹e
(c⁄° *
hódî
, c⁄° *
fmt
, ...Ë
ATTRIBUTE
((
n‹ëu∫
));

66 
_îr_Áèl_sim∂e
(c⁄° *
func
, c⁄° *
msg
Ë
ATTRIBUTE
((
n‹ëu∫
));

67 
_îr_Áèl_sim∂e_c‹e
(c⁄° *
func
, c⁄° *
msg
Ë
ATTRIBUTE
((
n‹ëu∫
));

68 
FILE
 *
îr_x›í_c‹e
(c⁄° *
func
, c⁄° *
‚
, c⁄° *
mode
);

69 
FILE
 *
îr_xª›í_c‹e
(c⁄° *
func
, c⁄° *
‚
, c⁄° *
mode
, FILE *
Â
);

70 
gzFûe
 
îr_xz›í_c‹e
(c⁄° *
func
, c⁄° *
‚
, c⁄° *
mode
);

71 
size_t
 
îr_fwrôe
(c⁄° *
±r
, size_à
size
, size_à
nmemb
, 
FILE
 *
°ªam
);

72 
size_t
 
îr_‰ód_n€of
(*
±r
, size_à
size
, size_à
nmemb
, 
FILE
 *
°ªam
);

74 
îr_gzªad
(
gzFûe
 
fûe
, *
±r
, 
Àn
);

75 
îr_f£ek
(
FILE
 *
°ªam
, 
off£t
, 
whí˚
);

76 
	#îr_ªwöd
(
FP
Ë
	`îr_f£ek
((FP), 0, 
SEEK_SET
)

	)

77 
îr_·ñl
(
FILE
 *
°ªam
);

78 
îr_Ârötf
(
FILE
 *
°ªam
, c⁄° *
f‹m©
, ...)

79 
ATTRIBUTE
((
f‹m©
(
¥ötf
, 2, 3)));

80 
îr_¥ötf
(c⁄° *
f‹m©
, ...)

81 
ATTRIBUTE
((
f‹m©
(
¥ötf
, 1, 2)));

82 
îr_func_¥ötf
(c⁄° *
func
, c⁄° *
f‹m©
, ...)

83 
ATTRIBUTE
((
f‹m©
(
¥ötf
, 2, 3)));

84 
°dout_¥ötf
(c⁄° *
f‹m©
, ...)

85 
ATTRIBUTE
((
f‹m©
(
¥ötf
, 1, 2)));

86 
îr_Âutc
(
c
, 
FILE
 *
°ªam
);

87 
	#îr_putch¨
(
C
Ë
	`îr_Âutc
((C), 
°dout
)

	)

88 
îr_Âuts
(c⁄° *
s
, 
FILE
 *
°ªam
);

89 
îr_puts
(c⁄° *
s
);

90 
îr_fÊush
(
FILE
 *
°ªam
);

91 
îr_f˛o£
(
FILE
 *
°ªam
);

92 
îr_gz˛o£
(
gzFûe
 
fûe
);

94 
	#_îr_mÆloc
(
s
Ë
	`îr_mÆloc
(
__func__
, s)

	)

95 
	#_îr_ˇŒoc
(
n
, 
s
Ë
	`îr_ˇŒoc
(
__func__
,Ç, s)

	)

96 
	#_îr_ªÆloc
(
p
, 
s
Ë
	`îr_ªÆloc
(
__func__
,Ö, s)

	)

97 *
îr_mÆloc
(c⁄° * 
func
, 
size_t
 
s
);

98 *
îr_ˇŒoc
(c⁄° * 
func
, 
size_t
 
n
, size_à
s
);

99 *
îr_ªÆloc
(c⁄° * 
func
, *
p
, 
size_t
 
s
);

101 
˝utime
();

102 
ªÆtime
();

103 
¥öt_f‹m©_time
(
FILE
 *
out
);

105 
ks_öåos‹t_64
 (
size_t
 
n
, 
uöt64_t
 *
a
);

106 
ks_öåos‹t_128
(
size_t
 
n
, 
∑ú64_t
 *
a
);

108 
	#_ªÆloc
(
p
, 
m
, 
ty≥
Ë{m <<1;Ö = (ty≥*)
	`_îr_ªÆloc
’, m * —y≥));}

	)

110 #ifde‡
__˝lu•lus


115 
	#_sim_ö£π
(
v
, 
p
, 
n
, 
m
, 
ty≥
) { \

116 i‡(
n
 =
m
) { \

117 
	`_ªÆloc
(
p
, 
m
, 
ty≥
) \

119 
p
[
n
++] = 
v
; \

120 }

	)

122 
	#_ö£π
(
v
, 
p
, 
n
, 
m
, 
ty≥
) { \

123 
_i
, 
_Êag
=0; \

124 
_i
 = 0; _ò< 
n
; ++_i) { \

125 i‡(
p
[
_i
] =
v
) { \

126 
_Êag
 = 1; \

130 i‡(
_Êag
 == 0) { \

131 i‡(
n
 =
m
) { \

132 
	`_ªÆloc
(
p
, 
m
, 
ty≥
) \

134 
p
[
n
++] = 
v
; \

136 }

	)

138 
	#_bö_ö£π_idx
(
v
, 
p
, 
n
, 
m
, 
ty≥
, 
Êag
, 
k_i
) { \

139 
Êag
=0, 
k_i
=-1; \

140 
_À·
=0,
_right
=
n
-1,
_mid
; \

141 
ty≥
 
_mid_v
, 
_tmp_v
; \

142 i‡(
_right
 =-1Ë
k_i
 = 0; \

144 
_À·
 <
_right
) { \

145 
_mid
 = (
_À·
+
_right
) >> 1; \

146 
_mid_v
 = 
p
[
_mid
]; \

147 i‡(
_mid_v
 =
v
) { \

148 
k_i
 = 
_mid
; \

149 
Êag
 = 1; ; \

150 } i‡(
_mid_v
 > 
v
) { \

151 i‡(
_mid
 != 0) { \

152 
_tmp_v
 = 
p
[
_mid
-1]; \

154 i‡(
_mid
 =0 || 
v
 > 
_tmp_v
) { \

155 
k_i
 = 
_mid
; \

158 
_right
 = 
_mid
-1; \

159 } 
_À·
 = 
_mid
+1; \

162 i‡(
k_i
 =-1Ëk_ò
n
; \

163 }

	)

165 
	#_bö_ö£π
(
v
, 
p
, 
n
, 
m
, 
ty≥
) { \

166 
_k_i
, 
_Êag
; \

167 
	`_bö_ö£π_idx
(
v
, 
p
, 
n
, 
m
, 
ty≥
, 
_Êag
, 
_k_i
) \

168 i‡(
_Êag
 == 0) { \

169 i‡(
n
 =
m
) { \

170 
	`_ªÆloc
(
p
, 
m
, 
ty≥
) \

172 i‡(
_k_i
 <
n
-1) \

173 
	`memmove
(
p
+
_k_i
+1,Ö+_k_i, (
n
-_k_i)*(
ty≥
)); \

174 (
p
)[
_k_i
] = 
v
; \

175 (
n
)++; \

177 }

	)

179 
	#_bö_£¨ch
(
v
, 
p
, 
n
, 
ty≥
, 
hô
, 
i
) { \

180 
_À·
 =0,
_right
=
n
-1,
_mid
; \

181 
ty≥
 
_mid_v
; \

182 
hô
 = 0; \

183 i‡(
_right
 =-1Ë
hô
=0; \

185 
_À·
 <
_right
) { \

186 
_mid
 = (
_À·
+
_right
) >> 1; \

187 
_mid_v
 = 
p
[
_mid
]; \

188 i‡(
_mid_v
 =
v
) { \

189 
i
 = 
_mid
; \

190 
hô
 = 1; \

192 } i‡(
_mid_v
 > 
v
) { \

193 
_right
 = 
_mid
-1; \

195 
_À·
 = 
_mid
+1; \

199 }

	)

201 
ölöe
 
uöt64_t
 
	$hash_64
(
uöt64_t
 
key
)

203 
key
 += ~(key << 32);

204 
key
 ^= (key >> 22);

205 
key
 += ~(key << 13);

206 
key
 ^= (key >> 8);

207 
key
 += (key << 3);

208 
key
 ^= (key >> 15);

209 
key
 += ~(key << 27);

210 
key
 ^= (key >> 31);

211  
key
;

212 
	}
}

	@/usr/include/arpa/inet.h

18 #i‚de‡
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<√töë/ö.h
>

25 #i‚de‡
__sockÀn_t_deföed


26 
__sockÀn_t
 
	tsockÀn_t
;

27 
	#__sockÀn_t_deföed


	)

30 
__BEGIN_DECLS


34 
ö_addr_t
 
	$öë_addr
 (c⁄° *
__˝
Ë
__THROW
;

37 
ö_addr_t
 
	$öë_ aof
 (
ö_addr
 
__ö
Ë
__THROW
;

41 
ö_addr
 
	$öë_makóddr
 (
ö_addr_t
 
__√t
, in_addr_à
__ho°
)

42 
__THROW
;

45 
ö_addr_t
 
	$öë_√tof
 (
ö_addr
 
__ö
Ë
__THROW
;

49 
ö_addr_t
 
	$öë_√tw‹k
 (c⁄° *
__˝
Ë
__THROW
;

53 *
	$öë_¡ﬂ
 (
ö_addr
 
__ö
Ë
__THROW
;

58 
	$öë_±⁄
 (
__af
, c⁄° *
__ª°ri˘
 
__˝
,

59 *
__ª°ri˘
 
__buf
Ë
__THROW
;

64 c⁄° *
	$öë_¡›
 (
__af
, c⁄° *
__ª°ri˘
 
__˝
,

65 *
__ª°ri˘
 
__buf
, 
sockÀn_t
 
__Àn
)

66 
__THROW
;

70 #ifde‡
__USE_MISC


73 
	$öë_©⁄
 (c⁄° *
__˝
, 
ö_addr
 *
__öp
Ë
__THROW
;

77 *
	$öë_√è
 (
ö_addr_t
 
__√t
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

82 *
	$öë_√t_¡›
 (
__af
, c⁄° *
__˝
, 
__bôs
,

83 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

88 
	$öë_√t_±⁄
 (
__af
, c⁄° *
__˝
,

89 *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

94 
	$öë_nßp_addr
 (c⁄° *
__˝
,

95 *
__buf
, 
__Àn
Ë
__THROW
;

99 *
	$öë_nßp_¡ﬂ
 (
__Àn
, c⁄° *
__˝
,

100 *
__buf
Ë
__THROW
;

103 
__END_DECLS


	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #unde‡
_ASSERT_H


25 #unde‡
as£π


26 #unde‡
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #unde‡
as£π_≥º‹


34 
	#_ASSERT_H
 1

	)

35 
	~<„©uªs.h
>

37 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
°©ic_ˇ°
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£π
(
ex¥
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£π_≥º‹
(
î∫um
Ë(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #i‚de‡
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£π_Áû
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
,

70 
__löe
, c⁄° *
__fun˘i⁄
)

71 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

74 
	$__as£π_≥º‹_Áû
 (
__î∫um
, c⁄° *
__fûe
,

75 
__löe
, c⁄° *
__fun˘i⁄
)

76 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

81 
	$__as£π
 (c⁄° *
__as£πi⁄
, c⁄° *
__fûe
, 
__löe
)

82 
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

85 
__END_DECLS


88 
	#as£π
(
ex¥
) \

89 ((
ex¥
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£π_Áû
 (#ex¥, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£π_≥º‹
(
î∫um
) \

95 (!(
î∫um
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£π_≥º‹_Áû
 ((
î∫um
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #i‡
deföed
 
__˝lu•lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((c⁄° *Ë0)

	)

118 #i‡
deföed
 
__USE_ISOC11
 && !deföed 
__˝lu•lus


119 #unde‡
°©ic_as£π


120 
	#°©ic_as£π
 
_Sètic_as£π


	)

	@/usr/include/byteswap.h

18 #i‚de‡
_BYTESWAP_H


19 
	#_BYTESWAP_H
 1

	)

21 
	~<„©uªs.h
>

24 
	~<bôs/byãsw≠.h
>

31 
	#bsw≠_16
(
x
Ë
	`__bsw≠_16
 (x)

	)

34 
	#bsw≠_32
(
x
Ë
	`__bsw≠_32
 (x)

	)

37 
	#bsw≠_64
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/ctype.h

22 #i‚def 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 
	g__BEGIN_DECLS


30 #i‚de‡
_ISbô


39 
	~<ídün.h
>

40 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


41 
	#_ISbô
(
bô
Ë(1 << (bô))

	)

43 
	#_ISbô
(
bô
Ë((bôË< 8 ? ((1 << (bô)Ë<< 8Ë: ((1 << (bô)Ë>> 8))

	)

48 
	m_ISuµî
 = 
_ISbô
 (0),

49 
	m_ISlowî
 = 
_ISbô
 (1),

50 
	m_ISÆpha
 = 
_ISbô
 (2),

51 
	m_ISdigô
 = 
_ISbô
 (3),

52 
	m_ISxdigô
 = 
_ISbô
 (4),

53 
	m_IS•a˚
 = 
_ISbô
 (5),

54 
	m_IS¥öt
 = 
_ISbô
 (6),

55 
	m_ISgøph
 = 
_ISbô
 (7),

56 
	m_ISbœnk
 = 
_ISbô
 (8),

57 
	m_IS˙ål
 = 
_ISbô
 (9),

58 
	m_ISpun˘
 = 
_ISbô
 (10),

59 
	m_ISÆnum
 = 
_ISbô
 (11)

79 c⁄° **
	$__˘y≥_b_loc
 ()

80 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

81 c⁄° 
__öt32_t
 **
	$__˘y≥_tﬁowî_loc
 ()

82 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

83 c⁄° 
__öt32_t
 **
	$__˘y≥_touµî_loc
 ()

84 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

87 #i‚de‡
__˝lu•lus


88 
	#__is˘y≥
(
c
, 
ty≥
) \

89 ((*
	`__˘y≥_b_loc
 ())[(Ë(
c
)] & (Ë
ty≥
)

	)

90 #ñi‡
deföed
 
__USE_EXTERN_INLINES


91 
	#__is˘y≥_f
(
ty≥
) \

92 
__exã∫_ölöe
 \

93 
is
##
	`ty≥
 (
__c
Ë
__THROW
 \

95  (*
	`__˘y≥_b_loc
 ())[(Ë(
__c
)] & (Ë
_IS
##
ty≥
; \

96 
	}

	)
}

99 
	#__ißscii
(
c
Ë(((cË& ~0x7fË=0Ë

	)

100 
	#__tﬂscii
(
c
Ë((cË& 0x7fË

	)

102 
	#__ex˘y≥
(
«me
Ë
	`«me
 (Ë
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__ex˘y≥
 (
iß um
);

111 
__ex˘y≥
 (
ißÕha
);

112 
__ex˘y≥
 (
is˙ål
);

113 
__ex˘y≥
 (
isdigô
);

114 
__ex˘y≥
 (
i¶owî
);

115 
__ex˘y≥
 (
isgøph
);

116 
__ex˘y≥
 (
i•röt
);

117 
__ex˘y≥
 (
i•un˘
);

118 
__ex˘y≥
 (
is•a˚
);

119 
__ex˘y≥
 (
isuµî
);

120 
__ex˘y≥
 (
isxdigô
);

124 
	$tﬁowî
 (
__c
Ë
__THROW
;

127 
	$touµî
 (
__c
Ë
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__ex˘y≥
 (
isbœnk
);

138 
__END_NAMESPACE_C99


141 #ifde‡
__USE_GNU


143 
	$is˘y≥
 (
__c
, 
__mask
Ë
__THROW
;

146 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


150 
	$ißscii
 (
__c
Ë
__THROW
;

154 
	$tﬂscii
 (
__c
Ë
__THROW
;

158 
	`__ex˘y≥
 (
_touµî
);

159 
	`__ex˘y≥
 (
_tﬁowî
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¨gs
) \

164 (
__exãnsi⁄__
 \

165 ({ 
__ªs
; \

166 i‡( (
c
) > 1) \

168 i‡(
	`__buûtö_c⁄°™t_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__ªs
 = 
__c
 < -128 || __¯> 255 ? __¯: (
a
)[__c]; \

174 
__ªs
 = 
f
 
¨gs
; \

177 
__ªs
 = (
a
)[(Ë(
c
)]; \

178 
__ªs
; 
	}
}))

	)

180 #i‡!
deföed
 
__NO_CTYPE


181 #ifde‡
__is˘y≥_f


182 
	$__is˘y≥_f
 (
Ænum
)

183 
	$__is˘y≥_f
 (
Æpha
)

184 
	$__is˘y≥_f
 (
˙ål
)

185 
	$__is˘y≥_f
 (
digô
)

186 
	$__is˘y≥_f
 (
lowî
)

187 
	$__is˘y≥_f
 (
gøph
)

188 
	$__is˘y≥_f
 (
¥öt
)

189 
	$__is˘y≥_f
 (
pun˘
)

190 
	$__is˘y≥_f
 (
•a˚
)

191 
	$__is˘y≥_f
 (
uµî
)

192 
	$__is˘y≥_f
 (
xdigô
)

193 #ifde‡
__USE_ISOC99


194 
	$__is˘y≥_f
 (
bœnk
)

196 #ñi‡
deföed
 
__is˘y≥


197 
	#iß um
(
c
Ë
	`__is˘y≥
((c), 
_ISÆnum
)

	)

198 
	#ißÕha
(
c
Ë
	`__is˘y≥
((c), 
_ISÆpha
)

	)

199 
	#is˙ål
(
c
Ë
	`__is˘y≥
((c), 
_IS˙ål
)

	)

200 
	#isdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISdigô
)

	)

201 
	#i¶owî
(
c
Ë
	`__is˘y≥
((c), 
_ISlowî
)

	)

202 
	#isgøph
(
c
Ë
	`__is˘y≥
((c), 
_ISgøph
)

	)

203 
	#i•röt
(
c
Ë
	`__is˘y≥
((c), 
_IS¥öt
)

	)

204 
	#i•un˘
(
c
Ë
	`__is˘y≥
((c), 
_ISpun˘
)

	)

205 
	#is•a˚
(
c
Ë
	`__is˘y≥
((c), 
_IS•a˚
)

	)

206 
	#isuµî
(
c
Ë
	`__is˘y≥
((c), 
_ISuµî
)

	)

207 
	#isxdigô
(
c
Ë
	`__is˘y≥
((c), 
_ISxdigô
)

	)

208 #ifde‡
__USE_ISOC99


209 
	#isbœnk
(
c
Ë
	`__is˘y≥
((c), 
_ISbœnk
)

	)

213 #ifde‡
__USE_EXTERN_INLINES


214 
__exã∫_ölöe
 

215 
	`__NTH
 (
	$tﬁowî
 (
__c
))

217  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_tﬁowî_loc
 ())[__c] : __c;

218 
	}
}

220 
__exã∫_ölöe
 

221 
__NTH
 (
	$touµî
 (
__c
))

223  
__c
 >-128 && __¯< 256 ? (*
	`__˘y≥_touµî_loc
 ())[__c] : __c;

224 
	}
}

227 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


228 
	#tﬁowî
(
c
Ë
	`__tobody
 (c, 
tﬁowî
, *
	`__˘y≥_tﬁowî_loc
 (), (c))

	)

229 
	#touµî
(
c
Ë
	`__tobody
 (c, 
touµî
, *
	`__˘y≥_touµî_loc
 (), (c))

	)

232 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


233 
	#ißscii
(
c
Ë
	`__ißscii
 (c)

	)

234 
	#tﬂscii
(
c
Ë
	`__tﬂscii
 (c)

	)

236 
	#_tﬁowî
(
c
Ë((Ë(*
	`__˘y≥_tﬁowî_loc
 ())[(Ë(c)])

	)

237 
	#_touµî
(
c
Ë((Ë(*
	`__˘y≥_touµî_loc
 ())[(Ë(c)])

	)

243 #ifde‡
__USE_XOPEN2K8


257 
	~<xloˇÀ.h
>

261 
	#__is˘y≥_l
(
c
, 
ty≥
, 
loˇÀ
) \

262 ((
loˇÀ
)->
__˘y≥_b
[(Ë(
c
)] & (Ë
ty≥
)

	)

264 
	#__ex˘y≥_l
(
«me
) \

265 
	`«me
 (, 
__loˇÀ_t
Ë
__THROW


	)

271 
__ex˘y≥_l
 (
iß um_l
);

272 
__ex˘y≥_l
 (
ißÕha_l
);

273 
__ex˘y≥_l
 (
is˙ål_l
);

274 
__ex˘y≥_l
 (
isdigô_l
);

275 
__ex˘y≥_l
 (
i¶owî_l
);

276 
__ex˘y≥_l
 (
isgøph_l
);

277 
__ex˘y≥_l
 (
i•röt_l
);

278 
__ex˘y≥_l
 (
i•un˘_l
);

279 
__ex˘y≥_l
 (
is•a˚_l
);

280 
__ex˘y≥_l
 (
isuµî_l
);

281 
__ex˘y≥_l
 (
isxdigô_l
);

283 
__ex˘y≥_l
 (
isbœnk_l
);

287 
	$__tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

288 
	$tﬁowî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

291 
	$__touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

292 
	$touµî_l
 (
__c
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

294 #i‡
__GNUC__
 >2 && 
deföed
 
__OPTIMIZE__
 && !deföed 
__˝lu•lus


295 
	#__tﬁowî_l
(
c
, 
loˇÀ
) \

296 
	`__tobody
 (
c
, 
__tﬁowî_l
, (
loˇÀ
)->
__˘y≥_tﬁowî
, (c,ÜoˇÀ))

	)

297 
	#__touµî_l
(
c
, 
loˇÀ
) \

298 
	`__tobody
 (
c
, 
__touµî_l
, (
loˇÀ
)->
__˘y≥_touµî
, (c,ÜoˇÀ))

	)

299 
	#tﬁowî_l
(
c
, 
loˇÀ
Ë
	`__tﬁowî_l
 ((c), (loˇÀ))

	)

300 
	#touµî_l
(
c
, 
loˇÀ
Ë
	`__touµî_l
 ((c), (loˇÀ))

	)

304 #i‚de‡
__NO_CTYPE


305 
	#__iß um_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆnum
, (l))

	)

306 
	#__ißÕha_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISÆpha
, (l))

	)

307 
	#__is˙ål_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS˙ål
, (l))

	)

308 
	#__isdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISdigô
, (l))

	)

309 
	#__i¶owî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISlowî
, (l))

	)

310 
	#__isgøph_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISgøph
, (l))

	)

311 
	#__i•röt_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS¥öt
, (l))

	)

312 
	#__i•un˘_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISpun˘
, (l))

	)

313 
	#__is•a˚_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_IS•a˚
, (l))

	)

314 
	#__isuµî_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISuµî
, (l))

	)

315 
	#__isxdigô_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISxdigô
, (l))

	)

317 
	#__isbœnk_l
(
c
,
l
Ë
	`__is˘y≥_l
((c), 
_ISbœnk
, (l))

	)

319 #ifde‡
__USE_MISC


320 
	#__ißscii_l
(
c
,
l
Ë(÷), 
	`__ißscii
 (c))

	)

321 
	#__tﬂscii_l
(
c
,
l
Ë(÷), 
	`__tﬂscii
 (c))

	)

324 
	#iß um_l
(
c
,
l
Ë
	`__iß um_l
 ((c), (l))

	)

325 
	#ißÕha_l
(
c
,
l
Ë
	`__ißÕha_l
 ((c), (l))

	)

326 
	#is˙ål_l
(
c
,
l
Ë
	`__is˙ål_l
 ((c), (l))

	)

327 
	#isdigô_l
(
c
,
l
Ë
	`__isdigô_l
 ((c), (l))

	)

328 
	#i¶owî_l
(
c
,
l
Ë
	`__i¶owî_l
 ((c), (l))

	)

329 
	#isgøph_l
(
c
,
l
Ë
	`__isgøph_l
 ((c), (l))

	)

330 
	#i•röt_l
(
c
,
l
Ë
	`__i•röt_l
 ((c), (l))

	)

331 
	#i•un˘_l
(
c
,
l
Ë
	`__i•un˘_l
 ((c), (l))

	)

332 
	#is•a˚_l
(
c
,
l
Ë
	`__is•a˚_l
 ((c), (l))

	)

333 
	#isuµî_l
(
c
,
l
Ë
	`__isuµî_l
 ((c), (l))

	)

334 
	#isxdigô_l
(
c
,
l
Ë
	`__isxdigô_l
 ((c), (l))

	)

336 
	#isbœnk_l
(
c
,
l
Ë
	`__isbœnk_l
 ((c), (l))

	)

338 #ifde‡
__USE_MISC


339 
	#ißscii_l
(
c
,
l
Ë
	`__ißscii_l
 ((c), (l))

	)

340 
	#tﬂscii_l
(
c
,
l
Ë
	`__tﬂscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/dirent.h

22 #i‚def 
_DIRENT_H


23 
	#_DIRENT_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

31 #ifde‡
__USE_XOPEN


32 #i‚de‡
__öo_t_deföed


33 #i‚de‡
__USE_FILE_OFFSET64


34 
__öo_t
 
	töo_t
;

36 
__öo64_t
 
	töo_t
;

38 
	#__öo_t_deföed


	)

40 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__öo64_t_deföed


41 
__öo64_t
 
	töo64_t
;

42 
	#__öo64_t_deföed


	)

61 
	~<bôs/dúít.h
>

63 #i‡
deföed
 
__USE_MISC
 && !deföed 
d_fûío


64 
	#d_öo
 
d_fûío


	)

81 #ifde‡
_DIRENT_HAVE_D_NAMLEN


82 
	#_D_EXACT_NAMLEN
(
d
Ë((d)->
d_«mÀn
)

	)

83 
	#_D_ALLOC_NAMLEN
(
d
Ë(
	`_D_EXACT_NAMLEN
 (dË+ 1)

	)

85 
	#_D_EXACT_NAMLEN
(
d
Ë(
	`°æí
 ((d)->
d_«me
))

	)

86 #ifde‡
_DIRENT_HAVE_D_RECLEN


87 
	#_D_ALLOC_NAMLEN
(
d
Ë(((*Ë(dË+ (d)->
d_ª˛í
Ë- &(d)->
d_«me
[0])

	)

89 
	#_D_ALLOC_NAMLEN
(
d
Ë( (d)->
d_«me
 > 1 ?  (d)->d_name : \

90 
	`_D_EXACT_NAMLEN
 (
d
Ë+ 1)

	)

95 #ifde‡
__USE_MISC


99 
	mDT_UNKNOWN
 = 0,

100 
	#DT_UNKNOWN
 
DT_UNKNOWN


	)

101 
	mDT_FIFO
 = 1,

102 
	#DT_FIFO
 
DT_FIFO


	)

103 
	mDT_CHR
 = 2,

104 
	#DT_CHR
 
DT_CHR


	)

105 
	mDT_DIR
 = 4,

106 
	#DT_DIR
 
DT_DIR


	)

107 
	mDT_BLK
 = 6,

108 
	#DT_BLK
 
DT_BLK


	)

109 
	mDT_REG
 = 8,

110 
	#DT_REG
 
DT_REG


	)

111 
	mDT_LNK
 = 10,

112 
	#DT_LNK
 
DT_LNK


	)

113 
	mDT_SOCK
 = 12,

114 
	#DT_SOCK
 
DT_SOCK


	)

115 
	mDT_WHT
 = 14

116 
	#DT_WHT
 
DT_WHT


	)

120 
	#IFTODT
(
mode
Ë(((modeË& 0170000Ë>> 12)

	)

121 
	#DTTOIF
(
dúty≥
Ë((dúty≥Ë<< 12)

	)

127 
__dú°ªam
 
	tDIR
;

134 
DIR
 *
	$›ídú
 (c⁄° *
__«me
Ë
	`__n⁄nuŒ
 ((1));

136 #ifde‡
__USE_XOPEN2K8


141 
DIR
 *
	`fd›ídú
 (
__fd
);

149 
	$˛o£dú
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

161 #i‚de‡
__USE_FILE_OFFSET64


162 
dúít
 *
	$ªaddú
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

164 #ifde‡
__REDIRECT


165 
dúít
 *
	`__REDIRECT
 (
ªaddú
, (
DIR
 *
__dúp
), 
ªaddú64
)

166 
	`__n⁄nuŒ
 ((1));

168 
	#ªaddú
 
ªaddú64


	)

172 #ifde‡
__USE_LARGEFILE64


173 
dúít64
 *
	$ªaddú64
 (
DIR
 *
__dúp
Ë
	`__n⁄nuŒ
 ((1));

176 #ifde‡
__USE_POSIX


182 #i‚de‡
__USE_FILE_OFFSET64


183 
	$ªaddú_r
 (
DIR
 *
__ª°ri˘
 
__dúp
,

184 
dúít
 *
__ª°ri˘
 
__íåy
,

185 
dúít
 **
__ª°ri˘
 
__ªsu…
)

186 
	`__n⁄nuŒ
 ((1, 2, 3));

188 #ifde‡
__REDIRECT


189 
	`__REDIRECT
 (
ªaddú_r
,

190 (
DIR
 *
__ª°ri˘
 
__dúp
,

191 
dúít
 *
__ª°ri˘
 
__íåy
,

192 
dúít
 **
__ª°ri˘
 
__ªsu…
),

193 
ªaddú64_r
Ë
	`__n⁄nuŒ
 ((1, 2, 3));

195 
	#ªaddú_r
 
ªaddú64_r


	)

199 #ifde‡
__USE_LARGEFILE64


200 
	$ªaddú64_r
 (
DIR
 *
__ª°ri˘
 
__dúp
,

201 
dúít64
 *
__ª°ri˘
 
__íåy
,

202 
dúít64
 **
__ª°ri˘
 
__ªsu…
)

203 
	`__n⁄nuŒ
 ((1, 2, 3));

208 
	$ªwöddú
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

210 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


211 
	~<bôs/ty≥s.h
>

214 
	$£ekdú
 (
DIR
 *
__dúp
, 
__pos
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
	$ãŒdú
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

220 #ifde‡
__USE_XOPEN2K8


223 
	$dúfd
 (
DIR
 *
__dúp
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

225 #i‡
deföed
 
__OPTIMIZE__
 && deföed 
_DIR_dúfd


226 
	#dúfd
(
dúp
Ë
	`_DIR_dúfd
 (dúp)

	)

229 #ifde‡
__USE_MISC


230 #i‚de‡
MAXNAMLEN


232 
	~<bôs/posix1_lim.h
>

235 #ifde‡
NAME_MAX


236 
	#MAXNAMLEN
 
NAME_MAX


	)

238 
	#MAXNAMLEN
 255

	)

243 
	#__√ed_size_t


	)

244 
	~<°ddef.h
>

253 #i‚de‡
__USE_FILE_OFFSET64


254 
	$sˇndú
 (c⁄° *
__ª°ri˘
 
__dú
,

255 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

256 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

257 (*
__cmp
Ë(c⁄° 
dúít
 **,

258 c⁄° 
dúít
 **))

259 
	`__n⁄nuŒ
 ((1, 2));

261 #ifde‡
__REDIRECT


262 
	`__REDIRECT
 (
sˇndú
,

263 (c⁄° *
__ª°ri˘
 
__dú
,

264 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

265 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

266 (*
__cmp
Ë(c⁄° 
dúít
 **,

267 c⁄° 
dúít
 **)),

268 
sˇndú64
Ë
	`__n⁄nuŒ
 ((1, 2));

270 
	#sˇndú
 
sˇndú64


	)

274 #i‡
deföed
 
__USE_GNU
 && deföed 
__USE_LARGEFILE64


277 
	$sˇndú64
 (c⁄° *
__ª°ri˘
 
__dú
,

278 
dúít64
 ***
__ª°ri˘
 
__«mñi°
,

279 (*
__£À˘‹
Ë(c⁄° 
dúít64
 *),

280 (*
__cmp
Ë(c⁄° 
dúít64
 **,

281 c⁄° 
dúít64
 **))

282 
	`__n⁄nuŒ
 ((1, 2));

285 #ifde‡
__USE_GNU


291 #i‚de‡
__USE_FILE_OFFSET64


292 
	$sˇndú©
 (
__dfd
, c⁄° *
__ª°ri˘
 
__dú
,

293 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

294 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

295 (*
__cmp
Ë(c⁄° 
dúít
 **,

296 c⁄° 
dúít
 **))

297 
	`__n⁄nuŒ
 ((2, 3));

299 #ifde‡
__REDIRECT


300 
	`__REDIRECT
 (
sˇndú©
,

301 (
__dfd
, c⁄° *
__ª°ri˘
 
__dú
,

302 
dúít
 ***
__ª°ri˘
 
__«mñi°
,

303 (*
__£À˘‹
Ë(c⁄° 
dúít
 *),

304 (*
__cmp
Ë(c⁄° 
dúít
 **,

305 c⁄° 
dúít
 **)),

306 
sˇndú©64
Ë
	`__n⁄nuŒ
 ((2, 3));

308 
	#sˇndú©
 
sˇndú©64


	)

314 
	$sˇndú©64
 (
__dfd
, c⁄° *
__ª°ri˘
 
__dú
,

315 
dúít64
 ***
__ª°ri˘
 
__«mñi°
,

316 (*
__£À˘‹
Ë(c⁄° 
dúít64
 *),

317 (*
__cmp
Ë(c⁄° 
dúít64
 **,

318 c⁄° 
dúít64
 **))

319 
	`__n⁄nuŒ
 ((2, 3));

323 #i‚de‡
__USE_FILE_OFFSET64


324 
	$Æphas‹t
 (c⁄° 
dúít
 **
__e1
,

325 c⁄° 
dúít
 **
__e2
)

326 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

328 #ifde‡
__REDIRECT


329 
	`__REDIRECT_NTH
 (
Æphas‹t
,

330 (c⁄° 
dúít
 **
__e1
,

331 c⁄° 
dúít
 **
__e2
),

332 
Æphas‹t64
Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

334 
	#Æphas‹t
 
Æphas‹t64


	)

338 #i‡
deföed
 
__USE_GNU
 && deföed 
__USE_LARGEFILE64


339 
	$Æphas‹t64
 (c⁄° 
dúít64
 **
__e1
,

340 c⁄° 
dúít64
 **
__e2
)

341 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

346 #ifde‡
__USE_MISC


351 #i‚de‡
__USE_FILE_OFFSET64


352 
__ssize_t
 
	$gëdúíåõs
 (
__fd
, *
__ª°ri˘
 
__buf
,

353 
size_t
 
__nbyãs
,

354 
__off_t
 *
__ª°ri˘
 
__ba£p
)

355 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

357 #ifde‡
__REDIRECT


358 
__ssize_t
 
	`__REDIRECT_NTH
 (
gëdúíåõs
,

359 (
__fd
, *
__ª°ri˘
 
__buf
,

360 
size_t
 
__nbyãs
,

361 
__off64_t
 *
__ª°ri˘
 
__ba£p
),

362 
gëdúíåõs64
Ë
	`__n⁄nuŒ
 ((2, 4));

364 
	#gëdúíåõs
 
gëdúíåõs64


	)

368 #ifde‡
__USE_LARGEFILE64


369 
__ssize_t
 
	$gëdúíåõs64
 (
__fd
, *
__ª°ri˘
 
__buf
,

370 
size_t
 
__nbyãs
,

371 
__off64_t
 *
__ª°ri˘
 
__ba£p
)

372 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

376 #ifde‡
__USE_GNU


378 #i‚de‡
__USE_FILE_OFFSET64


379 
	$vîsi⁄s‹t
 (c⁄° 
dúít
 **
__e1
,

380 c⁄° 
dúít
 **
__e2
)

381 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

383 #ifde‡
__REDIRECT


384 
	`__REDIRECT_NTH
 (
vîsi⁄s‹t
,

385 (c⁄° 
dúít
 **
__e1
,

386 c⁄° 
dúít
 **
__e2
),

387 
vîsi⁄s‹t64
)

388 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

390 
	#vîsi⁄s‹t
 
vîsi⁄s‹t64


	)

394 #ifde‡
__USE_LARGEFILE64


395 
	$vîsi⁄s‹t64
 (c⁄° 
dúít64
 **
__e1
,

396 c⁄° 
dúít64
 **
__e2
)

397 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

401 
__END_DECLS


	@/usr/include/dlfcn.h

19 #i‚def 
_DLFCN_H


20 
	#_DLFCN_H
 1

	)

22 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

27 
	~<bôs/dlf˙.h
>

30 #ifde‡
__USE_GNU


35 
	#RTLD_NEXT
 ((*Ë-1l)

	)

40 
	#RTLD_DEFAULT
 ((*Ë0)

	)

44 
	tLmid_t
;

47 
	#LM_ID_BASE
 0

	)

48 
	#LM_ID_NEWLM
 -1

	)

52 
__BEGIN_DECLS


56 *
	$dl›í
 (c⁄° *
__fûe
, 
__mode
Ë
__THROWNL
;

60 
	$dl˛o£
 (*
__h™dÀ
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1));

64 *
	$dlsym
 (*
__ª°ri˘
 
__h™dÀ
,

65 c⁄° *
__ª°ri˘
 
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

67 #ifde‡
__USE_GNU


69 *
	$dlm›í
 (
Lmid_t
 
__nsid
, c⁄° *
__fûe
, 
__mode
Ë
__THROWNL
;

73 *
	$dlvsym
 (*
__ª°ri˘
 
__h™dÀ
,

74 c⁄° *
__ª°ri˘
 
__«me
,

75 c⁄° *
__ª°ri˘
 
__vîsi⁄
)

76 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

82 *
	$dÀº‹
 (Ë
__THROW
;

85 #ifde‡
__USE_GNU


90 c⁄° *
dli_‚ame
;

91 *
dli_fba£
;

92 c⁄° *
dli_¢ame
;

93 *
dli_ßddr
;

94 } 
	tDl_öfo
;

98 
	$dœddr
 (c⁄° *
__addªss
, 
Dl_öfo
 *
__öfo
)

99 
__THROW
 
	`__n⁄nuŒ
 ((2));

102 
	$dœddr1
 (c⁄° *
__addªss
, 
Dl_öfo
 *
__öfo
,

103 **
__exåa_öfo
, 
__Êags
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

111 
RTLD_DL_SYMENT
 = 1,

114 
RTLD_DL_LINKMAP
 = 2

123 
	$dlöfo
 (*
__ª°ri˘
 
__h™dÀ
,

124 
__ªque°
, *
__ª°ri˘
 
__¨g
)

125 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

131 
RTLD_DI_LMID
 = 1,

135 
RTLD_DI_LINKMAP
 = 2,

137 
RTLD_DI_CONFIGADDR
 = 3,

144 
RTLD_DI_SERINFO
 = 4,

145 
RTLD_DI_SERINFOSIZE
 = 5,

149 
RTLD_DI_ORIGIN
 = 6,

151 
RTLD_DI_PROFILENAME
 = 7,

152 
RTLD_DI_PROFILEOUT
 = 8,

157 
RTLD_DI_TLS_MODID
 = 9,

163 
RTLD_DI_TLS_DATA
 = 10,

165 
RTLD_DI_MAX
 = 10

173 *
dls_«me
;

174 
dls_Êags
;

175 } 
	tDl_£Ω©h
;

181 
size_t
 
dls_size
;

182 
dls_˙t
;

183 
Dl_£Ω©h
 
dls_£Ω©h
[1];

184 } 
	tDl_£röfo
;

188 
__END_DECLS


	@/usr/include/errno.h

22 #i‚def 
_ERRNO_H


26 #i‚def 
__√ed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<„©uªs.h
>

31 
	g__BEGIN_DECLS


35 
	~<bôs/î∫o.h
>

36 #unde‡
__√ed_Em©h


38 #ifdef 
_ERRNO_H


45 #i‚def 
î∫o


46 
î∫o
;

49 #ifde‡
__USE_GNU


54 *
¥ogøm_övoˇti⁄_«me
, *
¥ogøm_övoˇti⁄_sh‹t_«me
;

58 
	g__END_DECLS


66 #i‡
deföed
 
__USE_GNU
 || deföed 
__√ed_îr‹_t


67 #i‚de‡
__îr‹_t_deföed


68 
	tîr‹_t
;

69 
	#__îr‹_t_deföed
 1

	)

71 #unde‡
__√ed_îr‹_t


	@/usr/include/fcntl.h

22 #i‚def 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/ty≥s.h
>

35 
	~<bôs/f˙é.h
>

39 #ifde‡
__O_TMPFILE


40 
	#__OPEN_NEEDS_MODE
(
oÊag
) \

41 (((
oÊag
Ë& 
O_CREAT
Ë!0 || ((oÊagË& 
__O_TMPFILE
Ë=__O_TMPFILE)

	)

43 
	#__OPEN_NEEDS_MODE
(
oÊag
Ë(((oÊagË& 
O_CREAT
Ë!0)

	)

49 #i‚de‡
__mode_t_deföed


50 
__mode_t
 
	tmode_t
;

51 
	#__mode_t_deföed


	)

54 #i‚de‡
__off_t_deföed


55 #i‚de‡
__USE_FILE_OFFSET64


56 
__off_t
 
	toff_t
;

58 
__off64_t
 
	toff_t
;

60 
	#__off_t_deföed


	)

63 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_deföed


	)

68 #i‚de‡
__pid_t_deföed


69 
__pid_t
 
	tpid_t
;

70 
	#__pid_t_deföed


	)

74 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


75 
	#__√ed_time•ec


	)

76 
	~<time.h
>

77 
	~<bôs/°©.h
>

79 
	#S_IFMT
 
__S_IFMT


	)

80 
	#S_IFDIR
 
__S_IFDIR


	)

81 
	#S_IFCHR
 
__S_IFCHR


	)

82 
	#S_IFBLK
 
__S_IFBLK


	)

83 
	#S_IFREG
 
__S_IFREG


	)

84 #ifde‡
__S_IFIFO


85 
	#S_IFIFO
 
__S_IFIFO


	)

87 #ifde‡
__S_IFLNK


88 
	#S_IFLNK
 
__S_IFLNK


	)

90 #i‡(
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8
Ë&& deföed 
__S_IFSOCK


91 
	#S_IFSOCK
 
__S_IFSOCK


	)

96 
	#S_ISUID
 
__S_ISUID


	)

97 
	#S_ISGID
 
__S_ISGID


	)

99 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


101 
	#S_ISVTX
 
__S_ISVTX


	)

104 
	#S_IRUSR
 
__S_IREAD


	)

105 
	#S_IWUSR
 
__S_IWRITE


	)

106 
	#S_IXUSR
 
__S_IEXEC


	)

108 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

110 
	#S_IRGRP
 (
S_IRUSR
 >> 3Ë

	)

111 
	#S_IWGRP
 (
S_IWUSR
 >> 3Ë

	)

112 
	#S_IXGRP
 (
S_IXUSR
 >> 3Ë

	)

114 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

116 
	#S_IROTH
 (
S_IRGRP
 >> 3Ë

	)

117 
	#S_IWOTH
 (
S_IWGRP
 >> 3Ë

	)

118 
	#S_IXOTH
 (
S_IXGRP
 >> 3Ë

	)

120 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

123 #ifdef 
__USE_MISC


124 #i‚de‡
R_OK


127 
	#R_OK
 4

	)

128 
	#W_OK
 2

	)

129 
	#X_OK
 1

	)

130 
	#F_OK
 0

	)

135 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


136 
	#SEEK_SET
 0

	)

137 
	#SEEK_CUR
 1

	)

138 
	#SEEK_END
 2

	)

146 
f˙é
 (
__fd
, 
__cmd
, ...);

155 #i‚de‡
__USE_FILE_OFFSET64


156 
	$›í
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

158 #ifde‡
__REDIRECT


159 
	`__REDIRECT
 (
›í
, (c⁄° *
__fûe
, 
__oÊag
, ...), 
›í64
)

160 
	`__n⁄nuŒ
 ((1));

162 
	#›í
 
›í64


	)

165 #ifde‡
__USE_LARGEFILE64


166 
	$›í64
 (c⁄° *
__fûe
, 
__oÊag
, ...Ë
	`__n⁄nuŒ
 ((1));

169 #ifde‡
__USE_ATFILE


179 #i‚de‡
__USE_FILE_OFFSET64


180 
	$›í©
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

181 
	`__n⁄nuŒ
 ((2));

183 #ifde‡
__REDIRECT


184 
	`__REDIRECT
 (
›í©
, (
__fd
, c⁄° *
__fûe
, 
__oÊag
,

185 ...), 
›í©64
Ë
	`__n⁄nuŒ
 ((2));

187 
	#›í©
 
›í©64


	)

190 #ifde‡
__USE_LARGEFILE64


191 
	$›í©64
 (
__fd
, c⁄° *
__fûe
, 
__oÊag
, ...)

192 
	`__n⁄nuŒ
 ((2));

201 #i‚de‡
__USE_FILE_OFFSET64


202 
	$¸ót
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

204 #ifde‡
__REDIRECT


205 
	`__REDIRECT
 (
¸ót
, (c⁄° *
__fûe
, 
mode_t
 
__mode
),

206 
¸ót64
Ë
	`__n⁄nuŒ
 ((1));

208 
	#¸ót
 
¸ót64


	)

211 #ifde‡
__USE_LARGEFILE64


212 
	$¸ót64
 (c⁄° *
__fûe
, 
mode_t
 
__mode
Ë
	`__n⁄nuŒ
 ((1));

215 #i‡!
deföed
 
F_LOCK
 && (deföed 
__USE_MISC
 || (deföed 
__USE_XOPEN_EXTENDED
 \

216 && !
deföed
 
__USE_POSIX
))

225 
	#F_ULOCK
 0

	)

226 
	#F_LOCK
 1

	)

227 
	#F_TLOCK
 2

	)

228 
	#F_TEST
 3

	)

230 #i‚de‡
__USE_FILE_OFFSET64


231 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Àn
);

233 #ifde‡
__REDIRECT


234 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
), 
lockf64
);

236 
	#lockf
 
lockf64


	)

239 #ifde‡
__USE_LARGEFILE64


240 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Àn
);

244 #ifde‡
__USE_XOPEN2K


247 #i‚de‡
__USE_FILE_OFFSET64


248 
	$posix_Ádvi£
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
,

249 
__advi£
Ë
__THROW
;

251 #ifde‡
__REDIRECT_NTH


252 
	`__REDIRECT_NTH
 (
posix_Ádvi£
, (
__fd
, 
__off64_t
 
__off£t
,

253 
__off64_t
 
__Àn
, 
__advi£
),

254 
posix_Ádvi£64
);

256 
	#posix_Ádvi£
 
posix_Ádvi£64


	)

259 #ifde‡
__USE_LARGEFILE64


260 
	$posix_Ádvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
,

261 
__advi£
Ë
__THROW
;

269 #i‚de‡
__USE_FILE_OFFSET64


270 
	`posix_ÁŒoˇã
 (
__fd
, 
off_t
 
__off£t
, off_à
__Àn
);

272 #ifde‡
__REDIRECT


273 
	`__REDIRECT
 (
posix_ÁŒoˇã
, (
__fd
, 
__off64_t
 
__off£t
,

274 
__off64_t
 
__Àn
),

275 
posix_ÁŒoˇã64
);

277 
	#posix_ÁŒoˇã
 
posix_ÁŒoˇã64


	)

280 #ifde‡
__USE_LARGEFILE64


281 
	`posix_ÁŒoˇã64
 (
__fd
, 
off64_t
 
__off£t
, off64_à
__Àn
);

287 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄
 \

288 && 
deföed
 
__va_¨g_∑ck_Àn


289 
	~<bôs/f˙é2.h
>

292 
__END_DECLS


	@/usr/include/getopt.h

19 #i‚de‡
_GETOPT_H


21 #i‚de‡
__√ed_gë›t


22 
	#_GETOPT_H
 1

	)

32 #i‡!
deföed
 
__GNU_LIBRARY__


33 
	~<˘y≥.h
>

36 #i‚de‡
__THROW


37 #i‚de‡
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë(0)

	)

40 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__˝lu•lus


57 *
›èrg
;

71 
›töd
;

76 
›ãº
;

80 
›t›t
;

82 #i‚de‡
__√ed_gë›t


104 
	s›ti⁄


106 c⁄° *
	g«me
;

109 
	ghas_¨g
;

110 *
	gÊag
;

111 
	gvÆ
;

116 
	#no_¨gumít
 0

	)

117 
	#ªquúed_¨gumít
 1

	)

118 
	#›ti⁄Æ_¨gumít
 2

	)

146 #ifde‡
__GNU_LIBRARY__


150 
gë›t
 (
___¨gc
, *c⁄° *
___¨gv
, c⁄° *
__sh‹t›ts
)

151 
__THROW
;

153 #i‡
deföed
 
__√ed_gë›t
 && deföed 
__USE_POSIX2
 \

154 && !
deföed
 
	g__USE_POSIX_IMPLICITLY
 && !deföed 
	g__USE_GNU


158 #ifde‡
__REDIRECT


159 
__REDIRECT_NTH
 (
gë›t
, (
___¨gc
, *c⁄° *
___¨gv
,

160 c⁄° *
__sh‹t›ts
),

161 
__posix_gë›t
);

163 
__posix_gë›t
 (
___¨gc
, *c⁄° *
___¨gv
,

164 c⁄° *
__sh‹t›ts
Ë
__THROW
;

165 
	#gë›t
 
__posix_gë›t


	)

169 
gë›t
 ();

172 #i‚de‡
__√ed_gë›t


173 
gë›t_l⁄g
 (
___¨gc
, *c⁄° *
___¨gv
,

174 c⁄° *
__sh‹t›ts
,

175 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

176 
__THROW
;

177 
gë›t_l⁄g_⁄ly
 (
___¨gc
, *c⁄° *
___¨gv
,

178 c⁄° *
__sh‹t›ts
,

179 c⁄° 
›ti⁄
 *
__l⁄g›ts
, *
__l⁄göd
)

180 
__THROW
;

184 #ifdef 
__˝lu•lus


189 #unde‡
__√ed_gë›t


	@/usr/include/inttypes.h

22 #i‚de‡
_INTTYPES_H


23 
	#_INTTYPES_H
 1

	)

25 
	~<„©uªs.h
>

27 
	~<°döt.h
>

30 #i‚de‡
____gwch¨_t_deföed


31 #ifde‡
__˝lu•lus


32 
	#__gwch¨_t
 
wch¨_t


	)

33 #ñi‡
deföed
 
__WCHAR_TYPE__


34 
__WCHAR_TYPE__
 
	t__gwch¨_t
;

36 
	#__√ed_wch¨_t


	)

37 
	~<°ddef.h
>

38 
wch¨_t
 
	t__gwch¨_t
;

40 
	#____gwch¨_t_deföed
 1

	)

43 #i‡
__WORDSIZE
 == 64

44 
	#__PRI64_PREFIX
 "l"

	)

45 
	#__PRIPTR_PREFIX
 "l"

	)

47 
	#__PRI64_PREFIX
 "Œ"

	)

48 
	#__PRIPTR_PREFIX


	)

54 
	#PRId8
 "d"

	)

55 
	#PRId16
 "d"

	)

56 
	#PRId32
 "d"

	)

57 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

59 
	#PRIdLEAST8
 "d"

	)

60 
	#PRIdLEAST16
 "d"

	)

61 
	#PRIdLEAST32
 "d"

	)

62 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

64 
	#PRIdFAST8
 "d"

	)

65 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

66 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

67 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIi8
 "i"

	)

71 
	#PRIi16
 "i"

	)

72 
	#PRIi32
 "i"

	)

73 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

75 
	#PRIiLEAST8
 "i"

	)

76 
	#PRIiLEAST16
 "i"

	)

77 
	#PRIiLEAST32
 "i"

	)

78 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

80 
	#PRIiFAST8
 "i"

	)

81 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

82 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

83 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIo8
 "o"

	)

87 
	#PRIo16
 "o"

	)

88 
	#PRIo32
 "o"

	)

89 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

91 
	#PRIoLEAST8
 "o"

	)

92 
	#PRIoLEAST16
 "o"

	)

93 
	#PRIoLEAST32
 "o"

	)

94 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

96 
	#PRIoFAST8
 "o"

	)

97 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

98 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

99 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIu8
 "u"

	)

103 
	#PRIu16
 "u"

	)

104 
	#PRIu32
 "u"

	)

105 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

107 
	#PRIuLEAST8
 "u"

	)

108 
	#PRIuLEAST16
 "u"

	)

109 
	#PRIuLEAST32
 "u"

	)

110 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

112 
	#PRIuFAST8
 "u"

	)

113 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

114 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

115 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIx8
 "x"

	)

119 
	#PRIx16
 "x"

	)

120 
	#PRIx32
 "x"

	)

121 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

123 
	#PRIxLEAST8
 "x"

	)

124 
	#PRIxLEAST16
 "x"

	)

125 
	#PRIxLEAST32
 "x"

	)

126 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

128 
	#PRIxFAST8
 "x"

	)

129 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

130 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

131 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIX8
 "X"

	)

135 
	#PRIX16
 "X"

	)

136 
	#PRIX32
 "X"

	)

137 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

139 
	#PRIXLEAST8
 "X"

	)

140 
	#PRIXLEAST16
 "X"

	)

141 
	#PRIXLEAST32
 "X"

	)

142 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

144 
	#PRIXFAST8
 "X"

	)

145 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

146 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

147 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

151 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

152 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

153 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

154 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

155 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

156 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

160 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

161 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

162 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

163 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

164 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

165 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

171 
	#SCNd8
 "hhd"

	)

172 
	#SCNd16
 "hd"

	)

173 
	#SCNd32
 "d"

	)

174 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

176 
	#SCNdLEAST8
 "hhd"

	)

177 
	#SCNdLEAST16
 "hd"

	)

178 
	#SCNdLEAST32
 "d"

	)

179 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

181 
	#SCNdFAST8
 "hhd"

	)

182 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

183 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

184 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNi8
 "hhi"

	)

188 
	#SCNi16
 "hi"

	)

189 
	#SCNi32
 "i"

	)

190 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

192 
	#SCNiLEAST8
 "hhi"

	)

193 
	#SCNiLEAST16
 "hi"

	)

194 
	#SCNiLEAST32
 "i"

	)

195 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

197 
	#SCNiFAST8
 "hhi"

	)

198 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

199 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

200 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNu8
 "hhu"

	)

204 
	#SCNu16
 "hu"

	)

205 
	#SCNu32
 "u"

	)

206 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

208 
	#SCNuLEAST8
 "hhu"

	)

209 
	#SCNuLEAST16
 "hu"

	)

210 
	#SCNuLEAST32
 "u"

	)

211 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

213 
	#SCNuFAST8
 "hhu"

	)

214 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

215 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

216 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNo8
 "hho"

	)

220 
	#SCNo16
 "ho"

	)

221 
	#SCNo32
 "o"

	)

222 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

224 
	#SCNoLEAST8
 "hho"

	)

225 
	#SCNoLEAST16
 "ho"

	)

226 
	#SCNoLEAST32
 "o"

	)

227 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

229 
	#SCNoFAST8
 "hho"

	)

230 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

231 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

232 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNx8
 "hhx"

	)

236 
	#SCNx16
 "hx"

	)

237 
	#SCNx32
 "x"

	)

238 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

240 
	#SCNxLEAST8
 "hhx"

	)

241 
	#SCNxLEAST16
 "hx"

	)

242 
	#SCNxLEAST32
 "x"

	)

243 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

245 
	#SCNxFAST8
 "hhx"

	)

246 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

247 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

248 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

252 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

253 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

254 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

255 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

256 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

259 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

260 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

261 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

262 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

263 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

266 
	g__BEGIN_DECLS


268 #i‡
__WORDSIZE
 == 64

273 
	mquŸ
;

274 
	mªm
;

275 } 
	timaxdiv_t
;

282 
__exãnsi⁄__
 
	mquŸ
;

283 
__exãnsi⁄__
 
	mªm
;

284 } 
	timaxdiv_t
;

290 
ötmax_t
 
	$imaxabs
 (
ötmax_t
 
__n
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

293 
imaxdiv_t
 
	$imaxdiv
 (
ötmax_t
 
__numî
, i¡max_à
__díom
)

294 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

297 
ötmax_t
 
	$°πoimax
 (c⁄° *
__ª°ri˘
 
__≈å
,

298 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

301 
uötmax_t
 
	$°πoumax
 (c⁄° *
__ª°ri˘
 
__≈å
,

302 ** 
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

305 
ötmax_t
 
	$wc°oimax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

306 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

307 
__THROW
;

310 
uötmax_t
 
	$wc°oumax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

311 
__gwch¨_t
 ** 
__ª°ri˘
 
__íd±r
, 
__ba£
)

312 
__THROW
;

314 #ifde‡
__USE_EXTERN_INLINES


316 #i‡
__WORDSIZE
 == 64

318 
	$__°πﬁ_öã∫Æ
 (c⁄° *
__ª°ri˘
 
__≈å
,

319 **
__ª°ri˘
 
__íd±r
,

320 
__ba£
, 
__group
)

321 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

323 
__exã∫_ölöe
 
ötmax_t


324 
	`__NTH
 (
	$°πoimax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

325 
ba£
))

327  
	`__°πﬁ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

328 
	}
}

330 
	$__°πoul_öã∫Æ
 (c⁄° *
__ª°ri˘
 
__≈å
,

331 ** 
__ª°ri˘
 
__íd±r
,

332 
__ba£
, 
__group
)

333 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

335 
__exã∫_ölöe
 
uötmax_t


336 
	`__NTH
 (
	$°πoumax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

337 
ba£
))

339  
	`__°πoul_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

340 
	}
}

342 
	$__wc°ﬁ_öã∫Æ
 (c⁄° 
__gwch¨_t
 * 
__ª°ri˘
 
__≈å
,

343 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
,

344 
__ba£
, 
__group
)

345 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

347 
__exã∫_ölöe
 
ötmax_t


348 
	`__NTH
 (
	$wc°oimax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

349 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

351  
	`__wc°ﬁ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

352 
	}
}

354 
	$__wc°oul_öã∫Æ
 (c⁄° 
__gwch¨_t
 *

355 
__ª°ri˘
 
__≈å
,

356 
__gwch¨_t
 **

357 
__ª°ri˘
 
__íd±r
,

358 
__ba£
, 
__group
)

359 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

361 
__exã∫_ölöe
 
uötmax_t


362 
	`__NTH
 (
	$wc°oumax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

363 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

365  
	`__wc°oul_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

366 
	}
}

370 
__exãnsi⁄__


371 
	$__°πﬁl_öã∫Æ
 (c⁄° *
__ª°ri˘
 
__≈å
,

372 **
__ª°ri˘
 
__íd±r
,

373 
__ba£
, 
__group
)

374 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

376 
__exã∫_ölöe
 
ötmax_t


377 
	`__NTH
 (
	$°πoimax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

378 
ba£
))

380  
	`__°πﬁl_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

381 
	}
}

383 
__exãnsi⁄__


384 
	$__°πouŒ_öã∫Æ
 (const *

385 
__ª°ri˘
 
__≈å
,

387 
__ª°ri˘
 
__íd±r
,

388 
__ba£
,

389 
__group
)

390 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

392 
__exã∫_ölöe
 
uötmax_t


393 
	`__NTH
 (
	$°πoumax
 (c⁄° *
__ª°ri˘
 
≈å
, **__ª°ri˘ 
íd±r
,

394 
ba£
))

396  
	`__°πouŒ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

397 
	}
}

399 
__exãnsi⁄__


400 
	$__wc°ﬁl_öã∫Æ
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
__≈å
,

401 
__gwch¨_t
 **
__ª°ri˘
 
__íd±r
,

402 
__ba£
, 
__group
)

403 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

405 
__exã∫_ölöe
 
ötmax_t


406 
	`__NTH
 (
	$wc°oimax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

407 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

409  
	`__wc°ﬁl_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

410 
	}
}

413 
__exãnsi⁄__


414 
	$__wc°ouŒ_öã∫Æ
 (c⁄° 
__gwch¨_t
 *

415 
__ª°ri˘
 
__≈å
,

416 
__gwch¨_t
 **

417 
__ª°ri˘
 
__íd±r
,

418 
__ba£
,

419 
__group
)

420 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

422 
__exã∫_ölöe
 
uötmax_t


423 
	`__NTH
 (
	$wc°oumax
 (c⁄° 
__gwch¨_t
 *
__ª°ri˘
 
≈å
,

424 
__gwch¨_t
 **
__ª°ri˘
 
íd±r
, 
ba£
))

426  
	`__wc°ouŒ_öã∫Æ
 (
≈å
, 
íd±r
, 
ba£
, 0);

427 
	}
}

432 
	g__END_DECLS


	@/usr/include/limits.h

22 #i‚de‡
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<„©uªs.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

41 #i‚de‡
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<bôs/w‹dsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifde‡
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #i‡
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #i‡
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifde‡
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


123 #ö˛ude_√xà<
limôs
.
h
>

129 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


130 #i‚de‡
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #i‚de‡
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #i‚de‡
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<bôs/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<bôs/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<bôs/x›í_lim.h
>

	@/usr/include/math.h

23 #i‚def 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<„©uªs.h
>

28 
	g__BEGIN_DECLS


31 
	~<bôs/m©h-ve˘‹.h
>

35 
	~<bôs/huge_vÆ.h
>

36 #ifde‡
__USE_ISOC99


37 
	~<bôs/huge_vÆf.h
>

38 
	~<bôs/huge_vÆl.h
>

41 
	~<bôs/öf.h
>

44 
	~<bôs/«n.h
>

48 
	~<bôs/m©hdef.h
>

55 
	#__SIMD_DECL
(
fun˘i⁄
Ë
	`__CONCAT
 (
__DECL_SIMD_
, fun˘i⁄)

	)

57 
	#__MATHCALL_VEC
(
fun˘i⁄
, 
suffix
, 
¨gs
) \

58 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

59 
	`__MATHCALL
 (
fun˘i⁄
, 
suffix
, 
¨gs
)

	)

61 
	#__MATHDECL_VEC
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

62 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
fun˘i⁄
, 
suffix
)) \

63 
	`__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
)

	)

65 
	#__MATHCALL
(
fun˘i⁄
,
suffix
, 
¨gs
) \

66 
	`__MATHDECL
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
)

	)

67 
	#__MATHDECL
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

68 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
); \

69 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
)

	)

70 
	#__MATHCALLX
(
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

71 
	`__MATHDECLX
 (
_MdoubÀ_
,
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
)

	)

72 
	#__MATHDECLX
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
©åib
) \

73 
	`__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
); \

74 
	`__MATHDECL_1
(
ty≥
, 
	`__CONCAT
(
__
,
fun˘i⁄
),
suffix
, 
¨gs
Ë
	`__©åibuã__
 (
©åib
)

	)

75 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

76 
ty≥
 
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
Ë
¨gs
 
__THROW


	)

78 
	#_MdoubÀ_
 

	)

79 
	#__MATH_PRECNAME
(
«me
,
r
Ë
	`__CONCAT
“ame,r)

	)

80 
	#__MATH_DECLARING_DOUBLE
 1

	)

81 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

82 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

83 
	~<bôs/m©hˇŒs.h
>

84 #unde‡
_MdoubÀ_


85 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


86 #unde‡
_MdoubÀ_END_NAMESPACE


87 #unde‡
__MATH_PRECNAME


88 #unde‡
__MATH_DECLARING_DOUBLE


90 #ifde‡
__USE_ISOC99


96 #i‚de‡
_MÊﬂt_


97 
	#_MÊﬂt_
 

	)

99 
	#_MdoubÀ_
 
_MÊﬂt_


	)

100 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
f
##
	)
r

101 
	#__MATH_DECLARING_DOUBLE
 0

	)

102 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

103 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

104 
	~<bôs/m©hˇŒs.h
>

105 #unde‡
_MdoubÀ_


106 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


107 #unde‡
_MdoubÀ_END_NAMESPACE


108 #unde‡
__MATH_PRECNAME


109 #unde‡
__MATH_DECLARING_DOUBLE


111 #i‡!(
deföed
 
__NO_LONG_DOUBLE_MATH
 && deföed 
_LIBC
) \

112 || 
deföed
 
__LDBL_COMPAT
 \

113 || 
deföed
 
_LIBC_TEST


114 #ifde‡
__LDBL_COMPAT


116 #ifde‡
__USE_ISOC99


117 
	$__∆dbl_√xâow¨df
 (
__x
, 
__y
)

118 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

119 #ifde‡
__REDIRECT_NTH


120 
	`__REDIRECT_NTH
 (
√xâow¨df
, (
__x
, 
__y
),

121 
__∆dbl_√xâow¨df
)

122 
	`__©åibuã__
 ((
__c⁄°__
));

123 
	`__REDIRECT_NTH
 (
√xâow¨d
, (
__x
, 
__y
),

124 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

125 
	`__REDIRECT_NTH
 (
√xâow¨dl
,

126 (
__x
, 
__y
),

127 
√xè·î
Ë
	`__©åibuã__
 ((
__c⁄°__
));

131 #unde‡
__MATHDECL_1


132 
	#__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
Æüs
) \

133 
ty≥
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
fun˘i⁄
,
suffix
), \

134 
¨gs
, 
Æüs
)

	)

135 
	#__MATHDECL_1
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
) \

136 
	`__MATHDECL_2
(
ty≥
, 
fun˘i⁄
,
suffix
, 
¨gs
, 
	`__CONCAT
(fun˘i⁄,suffix))

	)

142 #i‚de‡
_Ml⁄g_doubÀ_


143 
	#_Ml⁄g_doubÀ_
 

	)

145 
	#_MdoubÀ_
 
_Ml⁄g_doubÀ_


	)

146 
	#__MATH_PRECNAME
(
«me
,
r
Ë«me##
l
##
	)
r

147 
	#__MATH_DECLARING_DOUBLE
 0

	)

148 
	#_MdoubÀ_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

149 
	#_MdoubÀ_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

150 
	#__MATH_DECLARE_LDOUBLE
 1

	)

151 
	~<bôs/m©hˇŒs.h
>

152 #unde‡
_MdoubÀ_


153 #unde‡
_MdoubÀ_BEGIN_NAMESPACE


154 #unde‡
_MdoubÀ_END_NAMESPACE


155 #unde‡
__MATH_PRECNAME


156 #unde‡
__MATH_DECLARING_DOUBLE


161 #unde‡
__MATHDECL_1


162 #unde‡
__MATHDECL


163 #unde‡
__MATHCALL


166 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


168 
signgam
;

173 #ifde‡
__USE_ISOC99


211 
FP_NAN
 =

212 
	#FP_NAN
 0

	)

213 
FP_NAN
,

214 
FP_INFINITE
 =

215 
	#FP_INFINITE
 1

	)

216 
FP_INFINITE
,

217 
FP_ZERO
 =

218 
	#FP_ZERO
 2

	)

219 
FP_ZERO
,

220 
FP_SUBNORMAL
 =

221 
	#FP_SUBNORMAL
 3

	)

222 
FP_SUBNORMAL
,

223 
FP_NORMAL
 =

224 
	#FP_NORMAL
 4

	)

225 
FP_NORMAL


233 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__
 \

234 && !
deföed
 
__OPTIMIZE_SIZE__


235 
	#Â˛assify
(
x
Ë
	`__buûtö_Â˛assify
 (
FP_NAN
, 
FP_INFINITE
, \

236 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

237 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


238 
	#Â˛assify
(
x
) \

239 ( (
x
Ë= (Ë? 
	`__Â˛assifyf
 (xË: 
	`__Â˛assify
 (x))

	)

241 
	#Â˛assify
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__Â˛assifyf
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__Â˛assify
 (
x
Ë: 
	`__Â˛assifyl
 (x))

	)

249 #i‡
	`__GNUC_PREREQ
 (4,0)

250 
	#signbô
(
x
) \

251 ( (
x
) ==  () \

252 ? 
	`__buûtö_signbôf
 (
x
) \

253 :  (
x
) ==  () \

254 ? 
	`__buûtö_signbô
 (
x
Ë: 
	`__buûtö_signbôl
 (x))

	)

256 #ifde‡
__NO_LONG_DOUBLE_MATH


257 
	#signbô
(
x
) \

258 ( (
x
Ë= (Ë? 
	`__signbôf
 (xË: 
	`__signbô
 (x))

	)

260 
	#signbô
(
x
) \

261 ( (
x
) ==  () \

262 ? 
	`__signbôf
 (
x
) \

263 :  (
x
) ==  () \

264 ? 
	`__signbô
 (
x
Ë: 
	`__signbôl
 (x))

	)

269 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


270 
	#isföôe
(
x
Ë
	`__buûtö_isföôe
 (x)

	)

271 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


272 
	#isföôe
(
x
) \

273 ( (
x
Ë= (Ë? 
	`__föôef
 (xË: 
	`__föôe
 (x))

	)

275 
	#isföôe
(
x
) \

276 ( (
x
) ==  () \

277 ? 
	`__föôef
 (
x
) \

278 :  (
x
) ==  () \

279 ? 
	`__föôe
 (
x
Ë: 
	`__föôñ
 (x))

	)

283 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


284 
	#i¢‹mÆ
(
x
Ë
	`__buûtö_i¢‹mÆ
 (x)

	)

286 
	#i¢‹mÆ
(
x
Ë(
	`Â˛assify
 (xË=
FP_NORMAL
)

	)

291 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


292 
	#i¢™
(
x
Ë
	`__buûtö_i¢™
 (x)

	)

293 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


294 
	#i¢™
(
x
) \

295 ( (
x
Ë= (Ë? 
	`__i¢™f
 (xË: 
	`__i¢™
 (x))

	)

297 
	#i¢™
(
x
) \

298 ( (
x
) ==  () \

299 ? 
	`__i¢™f
 (
x
) \

300 :  (
x
) ==  () \

301 ? 
	`__i¢™
 (
x
Ë: 
	`__i¢™l
 (x))

	)

305 #i‡
	`__GNUC_PREREQ
 (4,4Ë&& !
deföed
 
__SUPPORT_SNAN__


306 
	#isöf
(
x
Ë
	`__buûtö_isöf_sign
 (x)

	)

307 #ñi‡
deföed
 
__NO_LONG_DOUBLE_MATH


308 
	#isöf
(
x
) \

309 ( (
x
Ë= (Ë? 
	`__isöff
 (xË: 
	`__isöf
 (x))

	)

311 
	#isöf
(
x
) \

312 ( (
x
) ==  () \

313 ? 
	`__isöff
 (
x
) \

314 :  (
x
) ==  () \

315 ? 
	`__isöf
 (
x
Ë: 
	`__isöÊ
 (x))

	)

319 
	#MATH_ERRNO
 1

	)

320 
	#MATH_ERREXCEPT
 2

	)

325 #i‚de‡
__FAST_MATH__


326 
	#m©h_îrh™dlög
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

331 #ifde‡
__USE_GNU


333 #ifde‡
__NO_LONG_DOUBLE_MATH


334 
	#issig«lög
(
x
) \

335 ( (
x
Ë= (Ë? 
	`__issig«lögf
 (xË: 
	`__issig«lög
 (x))

	)

337 
	#issig«lög
(
x
) \

338 ( (
x
) ==  () \

339 ? 
	`__issig«lögf
 (
x
) \

340 :  (
x
) ==  () \

341 ? 
	`__issig«lög
 (
x
Ë: 
	`__issig«lögl
 (x))

	)

345 #ifdef 
__USE_MISC


349 
_IEEE_
 = -1,

350 
_SVID_
,

351 
_XOPEN_
,

352 
_POSIX_
,

353 
_ISOC_


354 } 
	t_LIB_VERSION_TYPE
;

359 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

363 #ifde‡
__USE_MISC


369 #ifde‡
__˝lu•lus


370 
__ex˚±i⁄


372 
ex˚±i⁄


375 
ty≥
;

376 *
«me
;

377 
¨g1
;

378 
¨g2
;

379 
ªtvÆ
;

380 
	}
};

382 #ifde‡
__˝lu•lus


383 
	$m©hîr
 (
__ex˚±i⁄
 *
__exc
Ë
	`throw
 ();

385 
	`m©hîr
 (
ex˚±i⁄
 *
__exc
);

388 
	#X_TLOSS
 1.41484755040568800000e+16

	)

391 
	#DOMAIN
 1

	)

392 
	#SING
 2

	)

393 
	#OVERFLOW
 3

	)

394 
	#UNDERFLOW
 4

	)

395 
	#TLOSS
 5

	)

396 
	#PLOSS
 6

	)

399 
	#HUGE
 3.40282347e+38F

	)

403 #ifde‡
__USE_XOPEN


405 
	#MAXFLOAT
 3.40282347e+38F

	)

412 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


413 
	#M_E
 2.7182818284590452354

	)

414 
	#M_LOG2E
 1.4426950408889634074

	)

415 
	#M_LOG10E
 0.43429448190325182765

	)

416 
	#M_LN2
 0.69314718055994530942

	)

417 
	#M_LN10
 2.30258509299404568402

	)

418 
	#M_PI
 3.14159265358979323846

	)

419 
	#M_PI_2
 1.57079632679489661923

	)

420 
	#M_PI_4
 0.78539816339744830962

	)

421 
	#M_1_PI
 0.31830988618379067154

	)

422 
	#M_2_PI
 0.63661977236758134308

	)

423 
	#M_2_SQRTPI
 1.12837916709551257390

	)

424 
	#M_SQRT2
 1.41421356237309504880

	)

425 
	#M_SQRT1_2
 0.70710678118654752440

	)

431 #ifde‡
__USE_GNU


432 
	#M_El
 2.718281828459045235360287471352662498L

	)

433 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

434 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

435 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

436 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

437 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

438 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

439 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

440 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

441 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

442 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

443 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

444 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

451 #i‡
deföed
 
__STRICT_ANSI__
 && !deföed 
__NO_MATH_INLINES


452 
	#__NO_MATH_INLINES
 1

	)

455 #i‡
deföed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

462 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
(x, y)

	)

463 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
(x, y)

	)

464 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
(x, y)

	)

465 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
(x, y)

	)

466 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
(x, y)

	)

467 
	#isun‹dîed
(
u
, 
v
Ë
	`__buûtö_isun‹dîed
(u, v)

	)

471 #ifde‡
__USE_EXTERN_INLINES


472 
	~<bôs/m©hölöe.h
>

477 #i‡
deföed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

478 
	~<bôs/m©h-föôe.h
>

481 #ifde‡
__USE_ISOC99


485 #i‚de‡
isgª©î


486 
	#isgª©î
(
x
, 
y
) \

487 (
__exãnsi⁄__
 \

488 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

489 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x > __y; 
	}
}))

	)

493 #i‚de‡
isgª©îequÆ


494 
	#isgª©îequÆ
(
x
, 
y
) \

495 (
__exãnsi⁄__
 \

496 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

497 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x >__y; }))

	)

501 #i‚de‡
i¶ess


502 
	#i¶ess
(
x
, 
y
) \

503 (
__exãnsi⁄__
 \

504 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

505 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x < __y; }))

	)

509 #i‚de‡
i¶es£quÆ


510 
	#i¶es£quÆ
(
x
, 
y
) \

511 (
__exãnsi⁄__
 \

512 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

513 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& __x <__y; }))

	)

517 #i‚de‡
i¶essgª©î


518 
	#i¶essgª©î
(
x
, 
y
) \

519 (
__exãnsi⁄__
 \

520 ({ 
	`__ty≥of__
(
x
Ë
__x
 = (x); __ty≥of__(
y
Ë
__y
 = (y); \

521 !
	`isun‹dîed
 (
__x
, 
__y
Ë&& (__x < __y || __y < __x); }))

	)

525 #i‚de‡
isun‹dîed


526 
	#isun‹dîed
(
u
, 
v
) \

527 (
__exãnsi⁄__
 \

528 ({ 
	`__ty≥of__
(
u
Ë
__u
 = (u); __ty≥of__(
v
Ë
__v
 = (v); \

529 
	`Â˛assify
 (
__u
Ë=
FP_NAN
 || fp˛assify (
__v
Ë=FP_NAN; }))

	)

534 
	g__END_DECLS


	@/usr/include/netdb.h

22 #i‚def 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<„©uªs.h
>

27 
	~<√töë/ö.h
>

28 
	~<°döt.h
>

29 #ifde‡
__USE_MISC


32 
	~<Ωc/√tdb.h
>

35 #ifde‡
__USE_GNU


36 
	#__√ed_sigevít_t


	)

37 
	~<bôs/sigöfo.h
>

38 
	#__√ed_time•ec


	)

39 
	~<time.h
>

42 
	~<bôs/√tdb.h
>

45 
	#_PATH_HEQUIV
 "/ëc/ho°s.equiv"

	)

46 
	#_PATH_HOSTS
 "/ëc/ho°s"

	)

47 
	#_PATH_NETWORKS
 "/ëc/√tw‹ks"

	)

48 
	#_PATH_NSSWITCH_CONF
 "/ëc/nsswôch.c⁄f"

	)

49 
	#_PATH_PROTOCOLS
 "/ëc/¥Ÿocﬁs"

	)

50 
	#_PATH_SERVICES
 "/ëc/£rvi˚s"

	)

53 
	g__BEGIN_DECLS


55 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


58 
	#h_î∫o
 (*
	`__h_î∫o_loˇti⁄
 ())

	)

61 *
	$__h_î∫o_loˇti⁄
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

65 
	#HOST_NOT_FOUND
 1

	)

66 
	#TRY_AGAIN
 2

	)

68 
	#NO_RECOVERY
 3

	)

70 
	#NO_DATA
 4

	)

73 #ifde‡
__USE_MISC


74 
	#NETDB_INTERNAL
 -1

	)

75 
	#NETDB_SUCCESS
 0

	)

76 
	#NO_ADDRESS
 
NO_DATA


	)

79 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_XOPEN_EXTENDED


81 
	#IPPORT_RESERVED
 1024

	)

84 #ifde‡
__USE_GNU


86 
	#SCOPE_DELIMITER
 '%'

	)

89 #ifde‡
__USE_MISC


92 
	$hîr‹
 (c⁄° *
__°r
Ë
__THROW
;

95 c⁄° *
	$h°ªº‹
 (
__îr_num
Ë
__THROW
;

100 
	sho°ít


102 *
h_«me
;

103 **
h_Æü£s
;

104 
h_addπy≥
;

105 
h_Àngth
;

106 **
h_addr_li°
;

107 #ifde‡
__USE_MISC


108 
	#h_addr
 
h_addr_li°
[0]

	)

117 
	`£tho°ít
 (
__°ay_›í
);

123 
	`ídho°ít
 ();

130 
ho°ít
 *
	`gëho°ít
 ();

137 
ho°ít
 *
	`gëho°byaddr
 (c⁄° *
__addr
, 
__sockÀn_t
 
__Àn
,

138 
__ty≥
);

144 
ho°ít
 *
	`gëho°by«me
 (c⁄° *
__«me
);

146 #ifde‡
__USE_MISC


155 
ho°ít
 *
	`gëho°by«me2
 (c⁄° *
__«me
, 
__af
);

167 
	`gëho°ít_r
 (
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

168 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

169 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

170 *
__ª°ri˘
 
__h_î∫›
);

172 
	`gëho°byaddr_r
 (c⁄° *
__ª°ri˘
 
__addr
, 
__sockÀn_t
 
__Àn
,

173 
__ty≥
,

174 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

175 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

176 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

177 *
__ª°ri˘
 
__h_î∫›
);

179 
	`gëho°by«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

180 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

181 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

182 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

183 *
__ª°ri˘
 
__h_î∫›
);

185 
	`gëho°by«me2_r
 (c⁄° *
__ª°ri˘
 
__«me
, 
__af
,

186 
ho°ít
 *
__ª°ri˘
 
__ªsu…_buf
,

187 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

188 
ho°ít
 **
__ª°ri˘
 
__ªsu…
,

189 *
__ª°ri˘
 
__h_î∫›
);

198 
	`£äëít
 (
__°ay_›í
);

204 
	`íd√ã¡
 ();

211 
√ã¡
 *
	`gë√ã¡
 ();

218 
√ã¡
 *
	`gë√tbyaddr
 (
uöt32_t
 
__√t
, 
__ty≥
);

224 
√ã¡
 *
	`gë√tby«me
 (c⁄° *
__«me
);

226 #ifdef 
__USE_MISC


237 
	`gë√ã¡_r
 (
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

238 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

239 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

240 *
__ª°ri˘
 
__h_î∫›
);

242 
	`gë√tbyaddr_r
 (
uöt32_t
 
__√t
, 
__ty≥
,

243 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

244 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

245 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

246 *
__ª°ri˘
 
__h_î∫›
);

248 
	`gë√tby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

249 
√ã¡
 *
__ª°ri˘
 
__ªsu…_buf
,

250 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

251 
√ã¡
 **
__ª°ri˘
 
__ªsu…
,

252 *
__ª°ri˘
 
__h_î∫›
);

257 
	s£rvít


259 *
s_«me
;

260 **
s_Æü£s
;

261 
s_p‹t
;

262 *
s_¥Ÿo
;

270 
	`£t£rvít
 (
__°ay_›í
);

276 
	`íd£rvít
 ();

283 
£rvít
 *
	`gë£rvít
 ();

290 
£rvít
 *
	`gë£rvby«me
 (c⁄° *
__«me
, c⁄° *
__¥Ÿo
);

297 
£rvít
 *
	`gë£rvbyp‹t
 (
__p‹t
, c⁄° *
__¥Ÿo
);

300 #ifdef 
__USE_MISC


308 
	`gë£rvít_r
 (
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

309 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

310 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

312 
	`gë£rvby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

313 c⁄° *
__ª°ri˘
 
__¥Ÿo
,

314 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

315 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

316 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

318 
	`gë£rvbyp‹t_r
 (
__p‹t
, c⁄° *
__ª°ri˘
 
__¥Ÿo
,

319 
£rvít
 *
__ª°ri˘
 
__ªsu…_buf
,

320 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

321 
£rvít
 **
__ª°ri˘
 
__ªsu…
);

326 
	s¥Ÿ€¡


328 *
p_«me
;

329 **
p_Æü£s
;

330 
p_¥Ÿo
;

338 
	`£çrŸ€¡
 (
__°ay_›í
);

344 
	`íd¥Ÿ€¡
 ();

351 
¥Ÿ€¡
 *
	`gë¥Ÿ€¡
 ();

357 
¥Ÿ€¡
 *
	`gë¥Ÿoby«me
 (c⁄° *
__«me
);

363 
¥Ÿ€¡
 *
	`gë¥Ÿobynumbî
 (
__¥Ÿo
);

366 #ifdef 
__USE_MISC


374 
	`gë¥Ÿ€¡_r
 (
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

375 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

376 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

378 
	`gë¥Ÿoby«me_r
 (c⁄° *
__ª°ri˘
 
__«me
,

379 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

380 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

381 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

383 
	`gë¥Ÿobynumbî_r
 (
__¥Ÿo
,

384 
¥Ÿ€¡
 *
__ª°ri˘
 
__ªsu…_buf
,

385 *
__ª°ri˘
 
__buf
, 
size_t
 
__buÊí
,

386 
¥Ÿ€¡
 **
__ª°ri˘
 
__ªsu…
);

395 
	`£äëgª¡
 (c⁄° *
__√tgroup
);

403 
	`íd√tgª¡
 ();

412 
	`gë√tgª¡
 (**
__ª°ri˘
 
__ho°p
,

413 **
__ª°ri˘
 
__u£Ω
,

414 **
__ª°ri˘
 
__domaöp
);

423 
	`ö√tgr
 (c⁄° *
__√tgroup
, c⁄° *
__ho°
,

424 c⁄° *
__u£r
, c⁄° *
__domaö
);

432 
	`gë√tgª¡_r
 (**
__ª°ri˘
 
__ho°p
,

433 **
__ª°ri˘
 
__u£Ω
,

434 **
__ª°ri˘
 
__domaöp
,

435 *
__ª°ri˘
 
__buf„r
, 
size_t
 
__buÊí
);

439 #ifde‡
__USE_MISC


451 
	`rcmd
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

452 c⁄° *
__ª°ri˘
 
__locu£r
,

453 c⁄° *
__ª°ri˘
 
__ªmu£r
,

454 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

463 
	`rcmd_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

464 c⁄° *
__ª°ri˘
 
__locu£r
,

465 c⁄° *
__ª°ri˘
 
__ªmu£r
,

466 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

467 
ß_Ámûy_t
 
__af
);

479 
	`ªxec
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

480 c⁄° *
__ª°ri˘
 
__«me
,

481 c⁄° *
__ª°ri˘
 
__∑ss
,

482 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
);

491 
	`ªxec_af
 (**
__ª°ri˘
 
__aho°
, 
__Ω‹t
,

492 c⁄° *
__ª°ri˘
 
__«me
,

493 c⁄° *
__ª°ri˘
 
__∑ss
,

494 c⁄° *
__ª°ri˘
 
__cmd
, *__ª°ri˘ 
__fd2p
,

495 
ß_Ámûy_t
 
__af
);

505 
	`ru£rok
 (c⁄° *
__rho°
, 
__su£r
,

506 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
);

515 
	`ru£rok_af
 (c⁄° *
__rho°
, 
__su£r
,

516 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
,

517 
ß_Ámûy_t
 
__af
);

528 
	`úu£rok
 (
uöt32_t
 
__øddr
, 
__su£r
,

529 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
);

539 
	`úu£rok_af
 (c⁄° *
__øddr
, 
__su£r
,

540 c⁄° *
__ªmu£r
, c⁄° *
__locu£r
,

541 
ß_Ámûy_t
 
__af
);

551 
	`ºesvp‹t
 (*
__Æp‹t
);

560 
	`ºesvp‹t_af
 (*
__Æp‹t
, 
ß_Ámûy_t
 
__af
);

565 #ifde‡
__USE_XOPEN2K


567 
	saddröfo


569 
ai_Êags
;

570 
ai_Ámûy
;

571 
ai_sockty≥
;

572 
ai_¥Ÿocﬁ
;

573 
sockÀn_t
 
ai_addæí
;

574 
sockaddr
 *
ai_addr
;

575 *
ai_ˇn⁄«me
;

576 
addröfo
 *
ai_√xt
;

579 #ifde‡
__USE_GNU


581 
	sgaicb


583 c⁄° *
¨_«me
;

584 c⁄° *
¨_£rvi˚
;

585 c⁄° 
addröfo
 *
¨_ªque°
;

586 
addröfo
 *
¨_ªsu…
;

588 
__ªtu∫
;

589 
__glibc_ª£rved
[5];

593 
	#GAI_WAIT
 0

	)

594 
	#GAI_NOWAIT
 1

	)

598 
	#AI_PASSIVE
 0x0001

	)

599 
	#AI_CANONNAME
 0x0002

	)

600 
	#AI_NUMERICHOST
 0x0004

	)

601 
	#AI_V4MAPPED
 0x0008

	)

602 
	#AI_ALL
 0x0010

	)

603 
	#AI_ADDRCONFIG
 0x0020

	)

605 #ifde‡
__USE_GNU


606 
	#AI_IDN
 0x0040

	)

609 
	#AI_CANONIDN
 0x0080

	)

610 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

612 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

615 
	#AI_NUMERICSERV
 0x0400

	)

618 
	#EAI_BADFLAGS
 -1

	)

619 
	#EAI_NONAME
 -2

	)

620 
	#EAI_AGAIN
 -3

	)

621 
	#EAI_FAIL
 -4

	)

622 
	#EAI_FAMILY
 -6

	)

623 
	#EAI_SOCKTYPE
 -7

	)

624 
	#EAI_SERVICE
 -8

	)

625 
	#EAI_MEMORY
 -10

	)

626 
	#EAI_SYSTEM
 -11

	)

627 
	#EAI_OVERFLOW
 -12

	)

628 #ifde‡
__USE_GNU


629 
	#EAI_NODATA
 -5

	)

630 
	#EAI_ADDRFAMILY
 -9

	)

631 
	#EAI_INPROGRESS
 -100

	)

632 
	#EAI_CANCELED
 -101

	)

633 
	#EAI_NOTCANCELED
 -102

	)

634 
	#EAI_ALLDONE
 -103

	)

635 
	#EAI_INTR
 -104

	)

636 
	#EAI_IDN_ENCODE
 -105

	)

639 #ifde‡
__USE_MISC


640 
	#NI_MAXHOST
 1025

	)

641 
	#NI_MAXSERV
 32

	)

644 
	#NI_NUMERICHOST
 1

	)

645 
	#NI_NUMERICSERV
 2

	)

646 
	#NI_NOFQDN
 4

	)

647 
	#NI_NAMEREQD
 8

	)

648 
	#NI_DGRAM
 16

	)

649 #ifde‡
__USE_GNU


650 
	#NI_IDN
 32

	)

651 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

653 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

662 
	`gëaddröfo
 (c⁄° *
__ª°ri˘
 
__«me
,

663 c⁄° *
__ª°ri˘
 
__£rvi˚
,

664 c⁄° 
addröfo
 *
__ª°ri˘
 
__ªq
,

665 
addröfo
 **
__ª°ri˘
 
__∑i
);

668 
	$‰ìaddröfo
 (
addröfo
 *
__ai
Ë
__THROW
;

671 c⁄° *
	$gai_°ªº‹
 (
__ecode
Ë
__THROW
;

677 
	`gë«meöfo
 (c⁄° 
sockaddr
 *
__ª°ri˘
 
__ß
,

678 
sockÀn_t
 
__ßÀn
, *
__ª°ri˘
 
__ho°
,

679 
sockÀn_t
 
__ho°Àn
, *
__ª°ri˘
 
__£rv
,

680 
sockÀn_t
 
__£rvÀn
, 
__Êags
);

683 #ifde‡
__USE_GNU


692 
	`gëaddröfo_a
 (
__mode
, 
gaicb
 *
__li°
[
__ª°ri˘_¨r
],

693 
__ít
, 
sigevít
 *
__ª°ri˘
 
__sig
);

703 
	`gai_su•íd
 (c⁄° 
gaicb
 *c⁄° 
__li°
[], 
__ít
,

704 c⁄° 
time•ec
 *
__timeout
);

707 
	$gai_îr‹
 (
gaicb
 *
__ªq
Ë
__THROW
;

710 
	$gai_ˇn˚l
 (
gaicb
 *
__gaicbp
Ë
__THROW
;

713 
__END_DECLS


	@/usr/include/pthread.h

18 #i‚de‡
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<ídün.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<bôs/±hªadty≥s.h
>

27 
	~<bôs/£tjmp.h
>

28 
	~<bôs/w‹dsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifde‡
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifde‡
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


85 #ifde‡
__PTHREAD_MUTEX_HAVE_PREV


86 
	#PTHREAD_MUTEX_INITIALIZER
 \

87 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

88 #ifde‡
__USE_GNU


89 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

90 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

91 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

92 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

93 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

94 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

98 
	#PTHREAD_MUTEX_INITIALIZER
 \

99 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

100 #ifde‡
__USE_GNU


101 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

102 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

103 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

105 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

113 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


116 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

117 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

119 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


125 #i‚de‡
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


126 #i‡
__WORDSIZE
 == 64

127 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

132 
	#PTHREAD_RWLOCK_INITIALIZER
 \

133 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

134 #ifde‡
__USE_GNU


135 #ifde‡
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


136 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

137 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, \

138 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

140 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


141 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

142 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

143 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

145 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

146 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

147 0 } }

	)

157 
	mPTHREAD_INHERIT_SCHED
,

158 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

159 
	mPTHREAD_EXPLICIT_SCHED


160 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

167 
	mPTHREAD_SCOPE_SYSTEM
,

168 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

169 
	mPTHREAD_SCOPE_PROCESS


170 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

177 
	mPTHREAD_PROCESS_PRIVATE
,

178 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

179 
	mPTHREAD_PROCESS_SHARED


180 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

186 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*Ë0, 0, 0 } }

	)

190 
	s_±hªad_˛ónup_buf„r


192 (*
	m__routöe
) (*);

193 *
	m__¨g
;

194 
	m__ˇn˚…y≥
;

195 
_±hªad_˛ónup_buf„r
 *
	m__¥ev
;

201 
	mPTHREAD_CANCEL_ENABLE
,

202 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

203 
	mPTHREAD_CANCEL_DISABLE


204 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

208 
	mPTHREAD_CANCEL_DEFERRED
,

209 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

210 
	mPTHREAD_CANCEL_ASYNCHRONOUS


211 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

213 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

217 
	#PTHREAD_ONCE_INIT
 0

	)

220 #ifde‡
__USE_XOPEN2K


224 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

228 
__BEGIN_DECLS


233 
	$±hªad_¸óã
 (
±hªad_t
 *
__ª°ri˘
 
__√wthªad
,

234 c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

235 *(*
__°¨t_routöe
) (*),

236 *
__ª°ri˘
 
__¨g
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 3));

242 
	$±hªad_exô
 (*
__ªtvÆ
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

250 
	`±hªad_joö
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
);

252 #ifde‡
__USE_GNU


255 
	$±hªad_åyjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
Ë
__THROW
;

263 
	`±hªad_timedjoö_≈
 (
±hªad_t
 
__th
, **
__thªad_ªtu∫
,

264 c⁄° 
time•ec
 *
__ab°ime
);

271 
	$±hªad_dëach
 (
±hªad_t
 
__th
Ë
__THROW
;

275 
±hªad_t
 
	$±hªad_£lf
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

278 
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
)

279 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

287 
	$±hªad_©å_öô
 (
±hªad_©å_t
 *
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

290 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 *
__©å
)

291 
__THROW
 
	`__n⁄nuŒ
 ((1));

294 
	$±hªad_©å_gëdëach°©e
 (c⁄° 
±hªad_©å_t
 *
__©å
,

295 *
__dëach°©e
)

296 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

299 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 *
__©å
,

300 
__dëach°©e
)

301 
__THROW
 
	`__n⁄nuŒ
 ((1));

305 
	$±hªad_©å_gëgu¨dsize
 (c⁄° 
±hªad_©å_t
 *
__©å
,

306 
size_t
 *
__gu¨dsize
)

307 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

310 
	$±hªad_©å_£tgu¨dsize
 (
±hªad_©å_t
 *
__©å
,

311 
size_t
 
__gu¨dsize
)

312 
__THROW
 
	`__n⁄nuŒ
 ((1));

316 
	$±hªad_©å_gësched∑øm
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

317 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

318 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

321 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

322 c⁄° 
sched_∑øm
 *
__ª°ri˘


323 
__∑øm
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

326 
	$±hªad_©å_gëschedpﬁicy
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


327 
__©å
, *
__ª°ri˘
 
__pﬁicy
)

328 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

331 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *
__©å
, 
__pﬁicy
)

332 
__THROW
 
	`__n⁄nuŒ
 ((1));

335 
	$±hªad_©å_gëöhîôsched
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


336 
__©å
, *
__ª°ri˘
 
__öhîô
)

337 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

340 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 *
__©å
,

341 
__öhîô
)

342 
__THROW
 
	`__n⁄nuŒ
 ((1));

346 
	$±hªad_©å_gësc›e
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

347 *
__ª°ri˘
 
__sc›e
)

348 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

351 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *
__©å
, 
__sc›e
)

352 
__THROW
 
	`__n⁄nuŒ
 ((1));

355 
	$±hªad_©å_gë°ackaddr
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


356 
__©å
, **
__ª°ri˘
 
__°ackaddr
)

357 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__©åibuã_dïªˇãd__
;

363 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 *
__©å
,

364 *
__°ackaddr
)

365 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
;

368 
	$±hªad_©å_gë°acksize
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘


369 
__©å
, 
size_t
 *
__ª°ri˘
 
__°acksize
)

370 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

375 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 *
__©å
,

376 
size_t
 
__°acksize
)

377 
__THROW
 
	`__n⁄nuŒ
 ((1));

379 #ifde‡
__USE_XOPEN2K


381 
	$±hªad_©å_gë°ack
 (c⁄° 
±hªad_©å_t
 *
__ª°ri˘
 
__©å
,

382 **
__ª°ri˘
 
__°ackaddr
,

383 
size_t
 *
__ª°ri˘
 
__°acksize
)

384 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

389 
	$±hªad_©å_£t°ack
 (
±hªad_©å_t
 *
__©å
, *
__°ackaddr
,

390 
size_t
 
__°acksize
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 #ifde‡
__USE_GNU


396 
	$±hªad_©å_£èfföôy_≈
 (
±hªad_©å_t
 *
__©å
,

397 
size_t
 
__˝u£tsize
,

398 c⁄° 
˝u_£t_t
 *
__˝u£t
)

399 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

403 
	$±hªad_©å_gëafföôy_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
,

404 
size_t
 
__˝u£tsize
,

405 
˝u_£t_t
 *
__˝u£t
)

406 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

409 
	$±hªad_gë©å_deÁu…_≈
 (
±hªad_©å_t
 *
__©å
)

410 
__THROW
 
	`__n⁄nuŒ
 ((1));

414 
	$±hªad_£èâr_deÁu…_≈
 (c⁄° 
±hªad_©å_t
 *
__©å
)

415 
__THROW
 
	`__n⁄nuŒ
 ((1));

420 
	$±hªad_gë©å_≈
 (
±hªad_t
 
__th
, 
±hªad_©å_t
 *
__©å
)

421 
__THROW
 
	`__n⁄nuŒ
 ((2));

429 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
__èrgë_thªad
, 
__pﬁicy
,

430 c⁄° 
sched_∑øm
 *
__∑øm
)

431 
__THROW
 
	`__n⁄nuŒ
 ((3));

434 
	$±hªad_gësched∑øm
 (
±hªad_t
 
__èrgë_thªad
,

435 *
__ª°ri˘
 
__pﬁicy
,

436 
sched_∑øm
 *
__ª°ri˘
 
__∑øm
)

437 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

440 
	$±hªad_£tsched¥io
 (
±hªad_t
 
__èrgë_thªad
, 
__¥io
)

441 
__THROW
;

444 #ifde‡
__USE_GNU


446 
	$±hªad_gë«me_≈
 (
±hªad_t
 
__èrgë_thªad
, *
__buf
,

447 
size_t
 
__buÊí
)

448 
__THROW
 
	`__n⁄nuŒ
 ((2));

451 
	$±hªad_£äame_≈
 (
±hªad_t
 
__èrgë_thªad
, c⁄° *
__«me
)

452 
__THROW
 
	`__n⁄nuŒ
 ((2));

456 #ifde‡
__USE_UNIX98


458 
	$±hªad_gëc⁄cuºícy
 (Ë
__THROW
;

461 
	$±hªad_£tc⁄cuºícy
 (
__Àvñ
Ë
__THROW
;

464 #ifde‡
__USE_GNU


469 
	$±hªad_yõld
 (Ë
__THROW
;

474 
	$±hªad_£èfföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

475 c⁄° 
˝u_£t_t
 *
__˝u£t
)

476 
__THROW
 
	`__n⁄nuŒ
 ((3));

479 
	$±hªad_gëafföôy_≈
 (
±hªad_t
 
__th
, 
size_t
 
__˝u£tsize
,

480 
˝u_£t_t
 *
__˝u£t
)

481 
__THROW
 
	`__n⁄nuŒ
 ((3));

494 
	$±hªad_⁄˚
 (
±hªad_⁄˚_t
 *
__⁄˚_c⁄åﬁ
,

495 (*
__öô_routöe
Ë()Ë
	`__n⁄nuŒ
 ((1, 2));

506 
	`±hªad_£tˇn˚l°©e
 (
__°©e
, *
__ﬁd°©e
);

510 
	`±hªad_£tˇn˚…y≥
 (
__ty≥
, *
__ﬁdty≥
);

513 
	`±hªad_ˇn˚l
 (
±hªad_t
 
__th
);

518 
	`±hªad_ã°ˇn˚l
 ();

527 
__jmp_buf
 
__ˇn˚l_jmp_buf
;

528 
__mask_was_ßved
;

529 } 
__ˇn˚l_jmp_buf
[1];

530 *
__∑d
[4];

531 } 
	t__±hªad_unwöd_buf_t
 
	t__©åibuã__
 ((
	t__Æig√d__
));

534 #i‚de‡
__˛ónup_f˘_©åibuã


535 
	#__˛ónup_f˘_©åibuã


	)

540 
	s__±hªad_˛ónup_‰ame


542 (*
__ˇn˚l_routöe
) (*);

543 *
__ˇn˚l_¨g
;

544 
__do_ô
;

545 
__ˇn˚l_ty≥
;

548 #i‡
deföed
 
__GNUC__
 && deföed 
__EXCEPTIONS


549 #ifde‡
__˝lu•lus


551 ˛as†
	c__±hªad_˛ónup_˛ass


553 (*
__ˇn˚l_routöe
) (*);

554 *
__ˇn˚l_¨g
;

555 
__do_ô
;

556 
__ˇn˚l_ty≥
;

558 
public
:

559 
	$__±hªad_˛ónup_˛ass
 ((*
__f˘
Ë(*), *
__¨g
)

560 : 
	`__ˇn˚l_routöe
 (
__f˘
), 
	`__ˇn˚l_¨g
 (
__¨g
), 
	$__do_ô
 (1) { }

561 ~
	$__±hªad_˛ónup_˛ass
 (Ë{ i‡(
__do_ô
Ë
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); 
	}
}

562 
	$__£tdoô
 (
__√wvÆ
Ë{ 
__do_ô
 = __√wvÆ; 
	}
}

563 
	$__de„r
 (Ë{ 
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
,

564 &
__ˇn˚l_ty≥
); 
	}
}

565 
	$__ª°‹e
 (Ëc⁄° { 
	`±hªad_£tˇn˚…y≥
 (
__ˇn˚l_ty≥
, 0); 
	}
}

575 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

577 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
)

	)

581 
	#±hªad_˛ónup_p›
(
execuã
) \

582 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

583 } 0)

	)

585 #ifde‡
__USE_GNU


589 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

591 
__±hªad_˛ónup_˛ass
 
	`__˛‰ame
 (
routöe
, 
¨g
); \

592 
__˛‰ame
.
	`__de„r
 ()

	)

597 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

598 
__˛‰ame
.
	`__ª°‹e
 (); \

599 
__˛‰ame
.
	`__£tdoô
 (
execuã
); \

600 } 0)

	)

607 
__exã∫_ölöe
 

608 
	$__±hªad_˛ónup_routöe
 (
__±hªad_˛ónup_‰ame
 *
__‰ame
)

610 i‡(
__‰ame
->
__do_ô
)

611 
__‰ame
->
	`__ˇn˚l_routöe
 (__‰ame->
__ˇn˚l_¨g
);

612 
	}
}

621 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

623 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

624 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

625 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

626 .
__do_ô
 = 1 };

	)

630 
	#±hªad_˛ónup_p›
(
execuã
) \

631 
__˛‰ame
.
__do_ô
 = (
execuã
); \

632 } 0)

	)

634 #ifde‡
__USE_GNU


638 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

640 
__±hªad_˛ónup_‰ame
 
__˛‰ame
 \

641 
	`__©åibuã__
 ((
	`__˛ónup__
 (
__±hªad_˛ónup_routöe
))) \

642 { .
__ˇn˚l_routöe
 = (
routöe
), .
__ˇn˚l_¨g
 = (
¨g
), \

643 .
__do_ô
 = 1 }; \

644 (Ë
	`±hªad_£tˇn˚…y≥
 (
PTHREAD_CANCEL_DEFERRED
, \

645 &
__˛‰ame
.
__ˇn˚l_ty≥
)

	)

650 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

651 (Ë
	`±hªad_£tˇn˚…y≥
 (
__˛‰ame
.
__ˇn˚l_ty≥
, 
NULL
); \

652 
__˛‰ame
.
__do_ô
 = (
execuã
); \

653 } 0)

	)

664 
	#±hªad_˛ónup_push
(
routöe
, 
¨g
) \

666 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

667 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

668 *
__ˇn˚l_¨g
 = (
¨g
); \

669 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

670 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

671 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

673 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

674 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

678 
	`__±hªad_ªgi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

679 dÿ{

	)

680 
__±hªad_ªgi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

681 
__˛ónup_f˘_©åibuã
;

685 
	#±hªad_˛ónup_p›
(
execuã
) \

688 
	`__±hªad_uƒegi°î_ˇn˚l
 (&
__ˇn˚l_buf
); \

689 i‡(
execuã
) \

690 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

691 } 0)

	)

692 
	$__±hªad_uƒegi°î_ˇn˚l
 (
__±hªad_unwöd_buf_t
 *
__buf
)

693 
__˛ónup_f˘_©åibuã
;

695 #ifde‡
__USE_GNU


699 
	#±hªad_˛ónup_push_de„r_≈
(
routöe
, 
¨g
) \

701 
__±hªad_unwöd_buf_t
 
__ˇn˚l_buf
; \

702 (*
__ˇn˚l_routöe
Ë(*Ë(
routöe
); \

703 *
__ˇn˚l_¨g
 = (
¨g
); \

704 
__nŸ_fú°_ˇŒ
 = 
	`__sig£tjmp
 ((
__jmp_buf_èg
 *) (*) \

705 
__ˇn˚l_buf
.
__ˇn˚l_jmp_buf
, 0); \

706 i‡(
	`__glibc_u∆ikñy
 (
__nŸ_fú°_ˇŒ
)) \

708 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

709 
	`__±hªad_unwöd_√xt
 (&
__ˇn˚l_buf
); \

713 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (&
__ˇn˚l_buf
); \

714 dÿ{

	)

715 
	`__±hªad_ªgi°î_ˇn˚l_de„r
 (
__±hªad_unwöd_buf_t
 *
__buf
)

716 
__˛ónup_f˘_©åibuã
;

721 
	#±hªad_˛ónup_p›_ª°‹e_≈
(
execuã
) \

724 
	`__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (&
__ˇn˚l_buf
); \

725 i‡(
execuã
) \

726 
	`__ˇn˚l_routöe
 (
__ˇn˚l_¨g
); \

727 
	}
} 0)

	)

728 
	$__±hªad_uƒegi°î_ˇn˚l_ª°‹e
 (
__±hªad_unwöd_buf_t
 *
__buf
)

729 
__˛ónup_f˘_©åibuã
;

733 
	$__±hªad_unwöd_√xt
 (
__±hªad_unwöd_buf_t
 *
__buf
)

734 
__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
__n‹ëu∫__
))

735 #i‚de‡
SHARED


736 
	`__©åibuã__
 ((
__wók__
))

742 
__jmp_buf_èg
;

743 
	$__sig£tjmp
 (
__jmp_buf_èg
 *
__ív
, 
__ßvemask
Ë
__THROWNL
;

749 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 *
__muãx
,

750 c⁄° 
±hªad_muãx©å_t
 *
__muãx©å
)

751 
__THROW
 
	`__n⁄nuŒ
 ((1));

754 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 *
__muãx
)

755 
__THROW
 
	`__n⁄nuŒ
 ((1));

758 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 *
__muãx
)

759 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

762 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 *
__muãx
)

763 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

765 #ifde‡
__USE_XOPEN2K


767 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

768 c⁄° 
time•ec
 *
__ª°ri˘


769 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

773 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 *
__muãx
)

774 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

778 
	$±hªad_muãx_gë¥io˚ûög
 (c⁄° 
±hªad_muãx_t
 *

779 
__ª°ri˘
 
__muãx
,

780 *
__ª°ri˘
 
__¥io˚ûög
)

781 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

785 
	$±hªad_muãx_£çrio˚ûög
 (
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

786 
__¥io˚ûög
,

787 *
__ª°ri˘
 
__ﬁd_˚ûög
)

788 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

791 #ifde‡
__USE_XOPEN2K8


793 
	$±hªad_muãx_c⁄si°ít
 (
±hªad_muãx_t
 *
__muãx
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1));

795 #ifde‡
__USE_GNU


796 
	$±hªad_muãx_c⁄si°ít_≈
 (
±hªad_muãx_t
 *
__muãx
)

797 
__THROW
 
	`__n⁄nuŒ
 ((1));

806 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 *
__©å
)

807 
__THROW
 
	`__n⁄nuŒ
 ((1));

810 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 *
__©å
)

811 
__THROW
 
	`__n⁄nuŒ
 ((1));

814 
	$±hªad_muãx©å_gëpsh¨ed
 (c⁄° 
±hªad_muãx©å_t
 *

815 
__ª°ri˘
 
__©å
,

816 *
__ª°ri˘
 
__psh¨ed
)

817 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

820 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 *
__©å
,

821 
__psh¨ed
)

822 
__THROW
 
	`__n⁄nuŒ
 ((1));

824 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


826 
	$±hªad_muãx©å_gëty≥
 (c⁄° 
±hªad_muãx©å_t
 *
__ª°ri˘


827 
__©å
, *
__ª°ri˘
 
__köd
)

828 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

833 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 *
__©å
, 
__köd
)

834 
__THROW
 
	`__n⁄nuŒ
 ((1));

838 
	$±hªad_muãx©å_gë¥Ÿocﬁ
 (c⁄° 
±hªad_muãx©å_t
 *

839 
__ª°ri˘
 
__©å
,

840 *
__ª°ri˘
 
__¥Ÿocﬁ
)

841 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

845 
	$±hªad_muãx©å_£çrŸocﬁ
 (
±hªad_muãx©å_t
 *
__©å
,

846 
__¥Ÿocﬁ
)

847 
__THROW
 
	`__n⁄nuŒ
 ((1));

850 
	$±hªad_muãx©å_gë¥io˚ûög
 (c⁄° 
±hªad_muãx©å_t
 *

851 
__ª°ri˘
 
__©å
,

852 *
__ª°ri˘
 
__¥io˚ûög
)

853 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

856 
	$±hªad_muãx©å_£çrio˚ûög
 (
±hªad_muãx©å_t
 *
__©å
,

857 
__¥io˚ûög
)

858 
__THROW
 
	`__n⁄nuŒ
 ((1));

860 #ifde‡
__USE_XOPEN2K


862 
	$±hªad_muãx©å_gërobu°
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

863 *
__robu°√ss
)

864 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

865 #ifde‡
__USE_GNU


866 
	$±hªad_muãx©å_gërobu°_≈
 (c⁄° 
±hªad_muãx©å_t
 *
__©å
,

867 *
__robu°√ss
)

868 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

872 
	$±hªad_muãx©å_£åobu°
 (
±hªad_muãx©å_t
 *
__©å
,

873 
__robu°√ss
)

874 
__THROW
 
	`__n⁄nuŒ
 ((1));

875 #ifde‡
__USE_GNU


876 
	$±hªad_muãx©å_£åobu°_≈
 (
±hªad_muãx©å_t
 *
__©å
,

877 
__robu°√ss
)

878 
__THROW
 
	`__n⁄nuŒ
 ((1));

883 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


888 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

889 c⁄° 
±hªad_rwlock©å_t
 *
__ª°ri˘


890 
__©å
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

893 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 *
__rwlock
)

894 
__THROW
 
	`__n⁄nuŒ
 ((1));

897 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

898 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

901 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 *
__rwlock
)

902 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

904 #ifde‡
__USE_XOPEN2K


906 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

907 c⁄° 
time•ec
 *
__ª°ri˘


908 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

912 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

916 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 *
__rwlock
)

917 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

919 #ifde‡
__USE_XOPEN2K


921 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 *
__ª°ri˘
 
__rwlock
,

922 c⁄° 
time•ec
 *
__ª°ri˘


923 
__ab°ime
Ë
__THROWNL
 
	`__n⁄nuŒ
 ((1, 2));

927 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

934 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 *
__©å
)

935 
__THROW
 
	`__n⁄nuŒ
 ((1));

938 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 *
__©å
)

939 
__THROW
 
	`__n⁄nuŒ
 ((1));

942 
	$±hªad_rwlock©å_gëpsh¨ed
 (c⁄° 
±hªad_rwlock©å_t
 *

943 
__ª°ri˘
 
__©å
,

944 *
__ª°ri˘
 
__psh¨ed
)

945 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

948 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 *
__©å
,

949 
__psh¨ed
)

950 
__THROW
 
	`__n⁄nuŒ
 ((1));

953 
	$±hªad_rwlock©å_gëköd_≈
 (c⁄° 
±hªad_rwlock©å_t
 *

954 
__ª°ri˘
 
__©å
,

955 *
__ª°ri˘
 
__¥ef
)

956 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

959 
	$±hªad_rwlock©å_£tköd_≈
 (
±hªad_rwlock©å_t
 *
__©å
,

960 
__¥ef
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

968 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

969 c⁄° 
±hªad_c⁄d©å_t
 *
__ª°ri˘
 
__c⁄d_©å
)

970 
__THROW
 
	`__n⁄nuŒ
 ((1));

973 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 *
__c⁄d
)

974 
__THROW
 
	`__n⁄nuŒ
 ((1));

977 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 *
__c⁄d
)

978 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

981 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 *
__c⁄d
)

982 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

989 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

990 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
)

991 
	`__n⁄nuŒ
 ((1, 2));

1000 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 *
__ª°ri˘
 
__c⁄d
,

1001 
±hªad_muãx_t
 *
__ª°ri˘
 
__muãx
,

1002 c⁄° 
time•ec
 *
__ª°ri˘
 
__ab°ime
)

1003 
	`__n⁄nuŒ
 ((1, 2, 3));

1008 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 *
__©å
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1));

1012 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 *
__©å
)

1013 
__THROW
 
	`__n⁄nuŒ
 ((1));

1016 
	$±hªad_c⁄d©å_gëpsh¨ed
 (c⁄° 
±hªad_c⁄d©å_t
 *

1017 
__ª°ri˘
 
__©å
,

1018 *
__ª°ri˘
 
__psh¨ed
)

1019 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1022 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 *
__©å
,

1023 
__psh¨ed
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

1025 #ifde‡
__USE_XOPEN2K


1027 
	$±hªad_c⁄d©å_gë˛ock
 (c⁄° 
±hªad_c⁄d©å_t
 *

1028 
__ª°ri˘
 
__©å
,

1029 
__˛ockid_t
 *
__ª°ri˘
 
__˛ock_id
)

1030 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1033 
	$±hªad_c⁄d©å_£t˛ock
 (
±hªad_c⁄d©å_t
 *
__©å
,

1034 
__˛ockid_t
 
__˛ock_id
)

1035 
__THROW
 
	`__n⁄nuŒ
 ((1));

1039 #ifde‡
__USE_XOPEN2K


1044 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 *
__lock
, 
__psh¨ed
)

1045 
__THROW
 
	`__n⁄nuŒ
 ((1));

1048 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 *
__lock
)

1049 
__THROW
 
	`__n⁄nuŒ
 ((1));

1052 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 *
__lock
)

1053 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1056 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 *
__lock
)

1057 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1060 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 *
__lock
)

1061 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1068 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 *
__ª°ri˘
 
__b¨rõr
,

1069 c⁄° 
±hªad_b¨rõøâr_t
 *
__ª°ri˘


1070 
__©å
, 
__cou¡
)

1071 
__THROW
 
	`__n⁄nuŒ
 ((1));

1074 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1075 
__THROW
 
	`__n⁄nuŒ
 ((1));

1078 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 *
__b¨rõr
)

1079 
__THROWNL
 
	`__n⁄nuŒ
 ((1));

1083 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1084 
__THROW
 
	`__n⁄nuŒ
 ((1));

1087 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 *
__©å
)

1088 
__THROW
 
	`__n⁄nuŒ
 ((1));

1091 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (c⁄° 
±hªad_b¨rõøâr_t
 *

1092 
__ª°ri˘
 
__©å
,

1093 *
__ª°ri˘
 
__psh¨ed
)

1094 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1097 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 *
__©å
,

1098 
__psh¨ed
)

1099 
__THROW
 
	`__n⁄nuŒ
 ((1));

1111 
	$±hªad_key_¸óã
 (
±hªad_key_t
 *
__key
,

1112 (*
__de°r_fun˘i⁄
) (*))

1113 
__THROW
 
	`__n⁄nuŒ
 ((1));

1116 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1119 *
	$±hªad_gë•ecific
 (
±hªad_key_t
 
__key
Ë
__THROW
;

1122 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
__key
,

1123 c⁄° *
__poöãr
Ë
__THROW
 ;

1126 #ifde‡
__USE_XOPEN2K


1128 
	$±hªad_gë˝u˛ockid
 (
±hªad_t
 
__thªad_id
,

1129 
__˛ockid_t
 *
__˛ock_id
)

1130 
__THROW
 
	`__n⁄nuŒ
 ((2));

1145 
	$±hªad_©f‹k
 ((*
__¥ï¨e
) (),

1146 (*
__∑ª¡
) (),

1147 (*
__chûd
Ë()Ë
__THROW
;

1150 #ifde‡
__USE_EXTERN_INLINES


1152 
__exã∫_ölöe
 

1153 
	`__NTH
 (
	$±hªad_equÆ
 (
±hªad_t
 
__thªad1
,Öthªad_à
__thªad2
))

1155  
__thªad1
 =
__thªad2
;

1156 
	}
}

1159 
	g__END_DECLS


	@/usr/include/signal.h

22 #i‚def 
_SIGNAL_H


24 #i‡!
deföed
 
__√ed_sig_©omic_t
 && !deföed 
__√ed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<„©uªs.h
>

30 
	g__BEGIN_DECLS


32 
	~<bôs/sig£t.h
>

36 #i‡
deföed
 
__√ed_sig_©omic_t
 || deföed 
_SIGNAL_H


37 #i‚de‡
__sig_©omic_t_deföed


38 
	#__sig_©omic_t_deföed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #unde‡
__√ed_sig_©omic_t


46 #i‡
deföed
 
__√ed_sig£t_t
 || (deföed 
_SIGNAL_H
 && deföed 
__USE_POSIX
)

47 #i‚de‡
__sig£t_t_deföed


48 
	#__sig£t_t_deföed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #unde‡
__√ed_sig£t_t


54 #ifde‡
_SIGNAL_H


56 
	~<bôs/ty≥s.h
>

57 
	~<bôs/signum.h
>

59 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


60 #i‚de‡
__pid_t_deföed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_deföed


	)

64 #ifde‡
__USE_XOPEN


66 #i‚de‡
__uid_t_deföed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_deföed


	)

72 #ifde‡
__USE_POSIX199309


74 
	#__√ed_time•ec


	)

75 
	~<time.h
>

78 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_XOPEN_EXTENDED


80 
	~<bôs/sigöfo.h
>

85 (*
	t__sigh™dÀr_t
) ();

90 
__sigh™dÀr_t
 
	$__sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

91 
__THROW
;

92 #ifde‡
__USE_GNU


93 
__sigh™dÀr_t
 
	$sysv_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifde‡
__USE_MISC


102 
__sigh™dÀr_t
 
	$sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

103 
__THROW
;

106 #ifde‡
__REDIRECT_NTH


107 
__sigh™dÀr_t
 
	`__REDIRECT_NTH
 (
sig«l
,

108 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
),

109 
__sysv_sig«l
);

111 
	#sig«l
 
__sysv_sig«l


	)

114 
__END_NAMESPACE_STD


116 #ifde‡
__USE_XOPEN


119 
__sigh™dÀr_t
 
	$bsd_sig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

120 
__THROW
;

126 #ifde‡
__USE_POSIX


127 
	$kûl
 (
__pid_t
 
__pid
, 
__sig
Ë
__THROW
;

130 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


134 
	$kûÕg
 (
__pid_t
 
__pgΩ
, 
__sig
Ë
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$øi£
 (
__sig
Ë
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifde‡
__USE_MISC


144 
__sigh™dÀr_t
 
	$ssig«l
 (
__sig
, 
__sigh™dÀr_t
 
__h™dÀr
)

145 
__THROW
;

146 
	$gsig«l
 (
__sig
Ë
__THROW
;

149 #ifde‡
__USE_XOPEN2K8


151 
	`psig«l
 (
__sig
, c⁄° *
__s
);

154 
	`psigöfo
 (c⁄° 
sigöfo_t
 *
__pöfo
, c⁄° *
__s
);

166 #ifde‡
__USE_XOPEN


167 #ifde‡
__GNUC__


168 
	$sig∑u£
 (
__sig
Ë
	`__asm__
 ("__xpg_sigpause");

170 
	`__sig∑u£
 (
__sig_‹_mask
, 
__is_sig
);

172 
	#sig∑u£
(
sig
Ë
	`__sig∑u£
 ((sig), 1)

	)

177 #ifde‡
__USE_MISC


184 
	#sigmask
(
sig
Ë
	`__sigmask
(sig)

	)

187 
	$sigblock
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

190 
	$sig£tmask
 (
__mask
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

193 
	$siggëmask
 (Ë
__THROW
 
__©åibuã_dïªˇãd__
;

197 #ifde‡
__USE_MISC


198 
	#NSIG
 
_NSIG


	)

201 #ifde‡
__USE_GNU


202 
__sigh™dÀr_t
 
	tsigh™dÀr_t
;

206 #ifde‡
__USE_MISC


207 
__sigh™dÀr_t
 
	tsig_t
;

210 #ifde‡
__USE_POSIX


213 
	$sigem±y£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

216 
	$sigfûl£t
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

219 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

222 
	$sigdñ£t
 (
sig£t_t
 *
__£t
, 
__signo
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

225 
	$sigismembî
 (c⁄° 
sig£t_t
 *
__£t
, 
__signo
)

226 
__THROW
 
	`__n⁄nuŒ
 ((1));

228 #ifde‡
__USE_GNU


230 
	$sigi£m±y£t
 (c⁄° 
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

233 
	$sig™d£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

234 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

237 
	$sig‹£t
 (
sig£t_t
 *
__£t
, c⁄° sig£t_à*
__À·
,

238 c⁄° 
sig£t_t
 *
__right
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3));

243 
	~<bôs/siga˘i⁄.h
>

246 
	$sig¥ocmask
 (
__how
, c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

247 
sig£t_t
 *
__ª°ri˘
 
__o£t
Ë
__THROW
;

254 
	$sigsu•íd
 (c⁄° 
sig£t_t
 *
__£t
Ë
	`__n⁄nuŒ
 ((1));

257 
	$siga˘i⁄
 (
__sig
, c⁄° 
siga˘i⁄
 *
__ª°ri˘
 
__a˘
,

258 
siga˘i⁄
 *
__ª°ri˘
 
__ﬂ˘
Ë
__THROW
;

261 
	$sig≥ndög
 (
sig£t_t
 *
__£t
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

268 
	$sigwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
, *__ª°ri˘ 
__sig
)

269 
	`__n⁄nuŒ
 ((1, 2));

271 #ifde‡
__USE_POSIX199309


276 
	$sigwaôöfo
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

277 
sigöfo_t
 *
__ª°ri˘
 
__öfo
Ë
	`__n⁄nuŒ
 ((1));

284 
	$sigtimedwaô
 (c⁄° 
sig£t_t
 *
__ª°ri˘
 
__£t
,

285 
sigöfo_t
 *
__ª°ri˘
 
__öfo
,

286 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
)

287 
	`__n⁄nuŒ
 ((1));

291 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, c⁄° 
sigvÆ
 
__vÆ
)

292 
__THROW
;

297 #ifde‡
__USE_MISC


301 c⁄° *c⁄° 
_sys_sigli°
[
_NSIG
];

302 c⁄° *c⁄° 
sys_sigli°
[
_NSIG
];

306 
	~<bôs/sigc⁄ãxt.h
>

309 
	$sigªtu∫
 (
sigc⁄ãxt
 *
__s˝
Ë
__THROW
;

314 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


315 
	#__√ed_size_t


	)

316 
	~<°ddef.h
>

321 
	$sigöãºu±
 (
__sig
, 
__öãºu±
Ë
__THROW
;

323 
	~<bôs/sig°ack.h
>

324 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


326 
	~<sys/uc⁄ãxt.h
>

332 
	$sig°ack
 (
sig°ack
 *
__ss
, sig°ack *
__oss
)

333 
__THROW
 
__©åibuã_dïªˇãd__
;

337 
	$sigÆt°ack
 (c⁄° 
sigÆt°ack
 *
__ª°ri˘
 
__ss
,

338 
sigÆt°ack
 *
__ª°ri˘
 
__oss
Ë
__THROW
;

342 #ifde‡
__USE_XOPEN_EXTENDED


346 
	$sighﬁd
 (
__sig
Ë
__THROW
;

349 
	$sigªl£
 (
__sig
Ë
__THROW
;

352 
	$sigign‹e
 (
__sig
Ë
__THROW
;

355 
__sigh™dÀr_t
 
	$sig£t
 (
__sig
, 
__sigh™dÀr_t
 
__di•
Ë
__THROW
;

358 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


361 
	~<bôs/±hªadty≥s.h
>

362 
	~<bôs/sigthªad.h
>

369 
	$__libc_cuºít_sigπmö
 (Ë
__THROW
;

371 
	$__libc_cuºít_sigπmax
 (Ë
__THROW
;

375 
__END_DECLS


	@/usr/include/stdint.h

22 #i‚de‡
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<„©uªs.h
>

26 
	~<bôs/wch¨.h
>

27 
	~<bôs/w‹dsize.h
>

34 #i‚de‡
__öt8_t_deföed


35 
	#__öt8_t_deföed


	)

36 sig√d 
	töt8_t
;

37 
	töt16_t
;

38 
	töt32_t
;

39 #i‡
__WORDSIZE
 == 64

40 
	töt64_t
;

42 
__exãnsi⁄__


43 
	töt64_t
;

48 
	tuöt8_t
;

49 
	tuöt16_t
;

50 #i‚de‡
__uöt32_t_deföed


51 
	tuöt32_t
;

52 
	#__uöt32_t_deföed


	)

54 #i‡
__WORDSIZE
 == 64

55 
	tuöt64_t
;

57 
__exãnsi⁄__


58 
	tuöt64_t
;

65 sig√d 
	töt_Àa°8_t
;

66 
	töt_Àa°16_t
;

67 
	töt_Àa°32_t
;

68 #i‡
__WORDSIZE
 == 64

69 
	töt_Àa°64_t
;

71 
__exãnsi⁄__


72 
	töt_Àa°64_t
;

76 
	tuöt_Àa°8_t
;

77 
	tuöt_Àa°16_t
;

78 
	tuöt_Àa°32_t
;

79 #i‡
__WORDSIZE
 == 64

80 
	tuöt_Àa°64_t
;

82 
__exãnsi⁄__


83 
	tuöt_Àa°64_t
;

90 sig√d 
	töt_Á°8_t
;

91 #i‡
__WORDSIZE
 == 64

92 
	töt_Á°16_t
;

93 
	töt_Á°32_t
;

94 
	töt_Á°64_t
;

96 
	töt_Á°16_t
;

97 
	töt_Á°32_t
;

98 
__exãnsi⁄__


99 
	töt_Á°64_t
;

103 
	tuöt_Á°8_t
;

104 #i‡
__WORDSIZE
 == 64

105 
	tuöt_Á°16_t
;

106 
	tuöt_Á°32_t
;

107 
	tuöt_Á°64_t
;

109 
	tuöt_Á°16_t
;

110 
	tuöt_Á°32_t
;

111 
__exãnsi⁄__


112 
	tuöt_Á°64_t
;

117 #i‡
__WORDSIZE
 == 64

118 #i‚de‡
__öçå_t_deföed


119 
	töçå_t
;

120 
	#__öçå_t_deföed


	)

122 
	tuöçå_t
;

124 #i‚de‡
__öçå_t_deföed


125 
	töçå_t
;

126 
	#__öçå_t_deföed


	)

128 
	tuöçå_t
;

133 #i‡
__WORDSIZE
 == 64

134 
	tötmax_t
;

135 
	tuötmax_t
;

137 
__exãnsi⁄__


138 
	tötmax_t
;

139 
__exãnsi⁄__


140 
	tuötmax_t
;

144 #i‡
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
Ë¯## 
L


	)

146 
	#__UINT64_C
(
c
Ë¯## 
UL


	)

148 
	#__INT64_C
(
c
Ë¯## 
LL


	)

149 
	#__UINT64_C
(
c
Ë¯## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #i‡
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #i‡
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #i‡
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #i‡
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #i‡
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #i‡
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 #ifde‡
__WORDSIZE32_SIZE_ULONG


264 
	#SIZE_MAX
 (4294967295UL)

	)

266 
	#SIZE_MAX
 (4294967295U)

	)

271 #i‚de‡
WCHAR_MIN


273 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

274 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

278 
	#WINT_MIN
 (0u)

	)

279 
	#WINT_MAX
 (4294967295u)

	)

282 
	#INT8_C
(
c
Ë
	)
c

283 
	#INT16_C
(
c
Ë
	)
c

284 
	#INT32_C
(
c
Ë
	)
c

285 #i‡
__WORDSIZE
 == 64

286 
	#INT64_C
(
c
Ë¯## 
L


	)

288 
	#INT64_C
(
c
Ë¯## 
LL


	)

292 
	#UINT8_C
(
c
Ë
	)
c

293 
	#UINT16_C
(
c
Ë
	)
c

294 
	#UINT32_C
(
c
Ë¯## 
U


	)

295 #i‡
__WORDSIZE
 == 64

296 
	#UINT64_C
(
c
Ë¯## 
UL


	)

298 
	#UINT64_C
(
c
Ë¯## 
ULL


	)

302 #i‡
__WORDSIZE
 == 64

303 
	#INTMAX_C
(
c
Ë¯## 
L


	)

304 
	#UINTMAX_C
(
c
Ë¯## 
UL


	)

306 
	#INTMAX_C
(
c
Ë¯## 
LL


	)

307 
	#UINTMAX_C
(
c
Ë¯## 
ULL


	)

	@/usr/include/stdio.h

23 #i‚de‡
_STDIO_H


25 #i‡!
deföed
 
__√ed_FILE
 && !deföed 
__√ed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


31 
	#__√ed_size_t


	)

32 
	#__√ed_NULL


	)

33 
	~<°ddef.h
>

35 
	~<bôs/ty≥s.h
>

36 
	#__√ed_FILE


	)

37 
	#__√ed___FILE


	)

41 #i‡!
deföed
 
__FILE_deföed
 && deföed 
__√ed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #i‡
deföed
 
__USE_LARGEFILE64
 || deföed 
__USE_POSIX
 \

51 || 
deföed
 
	g__USE_ISOC99
 || deföed 
	g__USE_XOPEN
 \

52 || 
deföed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_deföed
 1

	)

58 #unde‡
__√ed_FILE


61 #i‡!
deföed
 
____FILE_deföed
 && deföed 
__√ed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_deföed
 1

	)

68 #unde‡
__√ed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


77 #ifde‡
__GNUC__


78 #i‚de‡
_VA_LIST_DEFINED


79 
_G_va_li°
 
	tva_li°
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<°d¨g.h
>

87 #ifde‡
__USE_XOPEN2K8


88 #i‚de‡
__off_t_deföed


89 #i‚de‡
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_deföed


	)

96 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_deföed


	)

101 #i‚de‡
__ssize_t_deföed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_deföed


	)

108 
__BEGIN_NAMESPACE_STD


109 #i‚de‡
__USE_FILE_OFFSET64


110 
_G_Âos_t
 
	tÂos_t
;

112 
_G_Âos64_t
 
	tÂos_t
;

114 
__END_NAMESPACE_STD


115 #ifde‡
__USE_LARGEFILE64


116 
_G_Âos64_t
 
	tÂos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #i‚de‡
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #i‚de‡
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifde‡
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


151 
	#P_tmpdú
 "/tmp"

	)

164 
	~<bôs/°dio_lim.h
>

168 
_IO_FILE
 *
°dö
;

169 
_IO_FILE
 *
°dout
;

170 
_IO_FILE
 *
°dîr
;

172 
	#°dö
 
°dö


	)

173 
	#°dout
 
°dout


	)

174 
	#°dîr
 
°dîr


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$ªmove
 (c⁄° *
__fûíame
Ë
__THROW
;

180 
	$ª«me
 (c⁄° *
__ﬁd
, c⁄° *
__√w
Ë
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifde‡
__USE_ATFILE


185 
	$ª«mót
 (
__ﬁdfd
, c⁄° *
__ﬁd
, 
__√wfd
,

186 c⁄° *
__√w
Ë
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #i‚de‡
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfûe
 (Ë
__wur
;

197 #ifde‡
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfûe
, (), 
tmpfûe64
Ë
__wur
;

200 
	#tmpfûe
 
tmpfûe64


	)

204 #ifde‡
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfûe64
 (Ë
__wur
;

209 *
	$tm≤am
 (*
__s
Ë
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifde‡
__USE_MISC


215 *
	$tm≤am_r
 (*
__s
Ë
__THROW
 
__wur
;

219 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


227 *
	$ãm≤am
 (c⁄° *
__dú
, c⁄° *
__pfx
)

228 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`f˛o£
 (
FILE
 *
__°ªam
);

242 
	`fÊush
 (
FILE
 *
__°ªam
);

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_MISC


252 
	`fÊush_u∆ocked
 (
FILE
 *
__°ªam
);

255 #ifde‡
__USE_GNU


262 
	`f˛o£Æl
 ();

266 
__BEGIN_NAMESPACE_STD


267 #i‚de‡
__USE_FILE_OFFSET64


272 
FILE
 *
	$f›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

273 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

278 
FILE
 *
	$‰e›í
 (c⁄° *
__ª°ri˘
 
__fûíame
,

279 c⁄° *
__ª°ri˘
 
__modes
,

280 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

282 #ifde‡
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
f›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

284 c⁄° *
__ª°ri˘
 
__modes
), 
f›í64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
‰e›í
, (c⁄° *
__ª°ri˘
 
__fûíame
,

287 c⁄° *
__ª°ri˘
 
__modes
,

288 
FILE
 *
__ª°ri˘
 
__°ªam
), 
‰e›í64
)

289 
__wur
;

291 
	#f›í
 
f›í64


	)

292 
	#‰e›í
 
‰e›í64


	)

295 
__END_NAMESPACE_STD


296 #ifde‡
__USE_LARGEFILE64


297 
FILE
 *
	$f›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

298 c⁄° *
__ª°ri˘
 
__modes
Ë
__wur
;

299 
FILE
 *
	$‰e›í64
 (c⁄° *
__ª°ri˘
 
__fûíame
,

300 c⁄° *
__ª°ri˘
 
__modes
,

301 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fd›í
 (
__fd
, c⁄° *
__modes
Ë
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$f›ícookõ
 (*
__ª°ri˘
 
__magic_cookõ
,

313 c⁄° *
__ª°ri˘
 
__modes
,

314 
_IO_cookõ_io_fun˘i⁄s_t
 
__io_funcs
Ë
__THROW
 
__wur
;

317 #ifde‡
__USE_XOPEN2K8


319 
FILE
 *
	$fmem›í
 (*
__s
, 
size_t
 
__Àn
, c⁄° *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$›í_mem°ªam
 (**
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
Ë
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

337 
__modes
, 
size_t
 
__n
Ë
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_MISC


343 
	$£tbuf„r
 (
FILE
 *
__ª°ri˘
 
__°ªam
, *__ª°ri˘ 
__buf
,

344 
size_t
 
__size
Ë
__THROW
;

347 
	$£éöebuf
 (
FILE
 *
__°ªam
Ë
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`Ârötf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

357 c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

362 
	`¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...);

364 
	$•rötf
 (*
__ª°ri˘
 
__s
,

365 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROWNL
;

371 
	`vÂrötf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

372 
_G_va_li°
 
__¨g
);

377 
	`v¥ötf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
);

379 
	$v•rötf
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

380 
_G_va_li°
 
__¨g
Ë
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #i‡
deföed
 
__USE_ISOC99
 || deföed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

387 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

388 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 4)));

390 
	$v¢¥ötf
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxÀn
,

391 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

392 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifde‡
__USE_GNU


399 
	$va•rötf
 (**
__ª°ri˘
 
__±r
, c⁄° *__ª°ri˘ 
__f
,

400 
_G_va_li°
 
__¨g
)

401 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 0))Ë
__wur
;

402 
	$__a•rötf
 (**
__ª°ri˘
 
__±r
,

403 c⁄° *
__ª°ri˘
 
__fmt
, ...)

404 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

405 
	$a•rötf
 (**
__ª°ri˘
 
__±r
,

406 c⁄° *
__ª°ri˘
 
__fmt
, ...)

407 
__THROWNL
 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__¥ötf__
, 2, 3))Ë
__wur
;

410 #ifde‡
__USE_XOPEN2K8


412 
	$vd¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
,

413 
_G_va_li°
 
__¨g
)

414 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

415 
	$d¥ötf
 (
__fd
, c⁄° *
__ª°ri˘
 
__fmt
, ...)

416 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

426 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

431 
	$sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

433 
	$ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

434 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

436 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

437 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

438 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

439 #ifde‡
__REDIRECT


443 
	`__REDIRECT
 (
fsˇnf
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

444 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

445 
__isoc99_fsˇnf
Ë
__wur
;

446 
	`__REDIRECT
 (
sˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

447 
__isoc99_sˇnf
Ë
__wur
;

448 
	`__REDIRECT_NTH
 (
ssˇnf
, (c⁄° *
__ª°ri˘
 
__s
,

449 c⁄° *
__ª°ri˘
 
__f‹m©
, ...),

450 
__isoc99_ssˇnf
);

452 
	$__isoc99_fsˇnf
 (
FILE
 *
__ª°ri˘
 
__°ªam
,

453 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

454 
	$__isoc99_sˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__wur
;

455 
	$__isoc99_ssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

456 c⁄° *
__ª°ri˘
 
__f‹m©
, ...Ë
__THROW
;

457 
	#fsˇnf
 
__isoc99_fsˇnf


	)

458 
	#sˇnf
 
__isoc99_sˇnf


	)

459 
	#ssˇnf
 
__isoc99_ssˇnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__f‹m©
,

472 
_G_va_li°
 
__¨g
)

473 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

479 
	$vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

480 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

483 
	$vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

484 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
)

485 
__THROW
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

487 #i‡!
deföed
 
__USE_GNU
 \

488 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

489 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

490 #ifde‡
__REDIRECT


494 
	`__REDIRECT
 (
vfsˇnf
,

495 (
FILE
 *
__ª°ri˘
 
__s
,

496 c⁄° *
__ª°ri˘
 
__f‹m©
, 
_G_va_li°
 
__¨g
),

497 
__isoc99_vfsˇnf
)

498 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 2, 0))Ë
__wur
;

499 
	`__REDIRECT
 (
vsˇnf
, (c⁄° *
__ª°ri˘
 
__f‹m©
,

500 
_G_va_li°
 
__¨g
), 
__isoc99_vsˇnf
)

501 
	`__©åibuã__
 ((
	$__f‹m©__
 (
__sˇnf__
, 1, 0))Ë
__wur
;

502 
	`__REDIRECT_NTH
 (
vssˇnf
,

503 (c⁄° *
__ª°ri˘
 
__s
,

504 c⁄° *
__ª°ri˘
 
__f‹m©
,

505 
_G_va_li°
 
__¨g
), 
__isoc99_vssˇnf
)

506 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__sˇnf__
, 2, 0)));

508 
	$__isoc99_vfsˇnf
 (
FILE
 *
__ª°ri˘
 
__s
,

509 c⁄° *
__ª°ri˘
 
__f‹m©
,

510 
_G_va_li°
 
__¨g
Ë
__wur
;

511 
	$__isoc99_vsˇnf
 (c⁄° *
__ª°ri˘
 
__f‹m©
,

512 
_G_va_li°
 
__¨g
Ë
__wur
;

513 
	$__isoc99_vssˇnf
 (c⁄° *
__ª°ri˘
 
__s
,

514 c⁄° *
__ª°ri˘
 
__f‹m©
,

515 
_G_va_li°
 
__¨g
Ë
__THROW
;

516 
	#vfsˇnf
 
__isoc99_vfsˇnf


	)

517 
	#vsˇnf
 
__isoc99_vsˇnf


	)

518 
	#vssˇnf
 
__isoc99_vssˇnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fgëc
 (
FILE
 *
__°ªam
);

532 
	`gëc
 (
FILE
 *
__°ªam
);

538 
	`gëch¨
 ();

539 
__END_NAMESPACE_STD


543 
	#gëc
(
_Â
Ë
	`_IO_gëc
 (_Â)

	)

545 #ifde‡
__USE_POSIX


550 
	`gëc_u∆ocked
 (
FILE
 *
__°ªam
);

551 
	`gëch¨_u∆ocked
 ();

554 #ifde‡
__USE_MISC


561 
	`fgëc_u∆ocked
 (
FILE
 *
__°ªam
);

565 
__BEGIN_NAMESPACE_STD


573 
	`Âutc
 (
__c
, 
FILE
 *
__°ªam
);

574 
	`putc
 (
__c
, 
FILE
 *
__°ªam
);

580 
	`putch¨
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_Â
Ë
	`_IO_putc
 (_ch, _Â)

	)

587 #ifde‡
__USE_MISC


594 
	`Âutc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

597 #ifde‡
__USE_POSIX


602 
	`putc_u∆ocked
 (
__c
, 
FILE
 *
__°ªam
);

603 
	`putch¨_u∆ocked
 (
__c
);

607 #i‡
deföed
 
__USE_MISC
 \

608 || (
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

610 
	`gëw
 (
FILE
 *
__°ªam
);

613 
	`putw
 (
__w
, 
FILE
 *
__°ªam
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fgës
 (*
__ª°ri˘
 
__s
, 
__n
, 
FILE
 *__ª°ri˘ 
__°ªam
)

623 
__wur
;

625 #i‡!
deföed
 
__USE_ISOC11
 \

626 || (
deföed
 
__˝lu•lus
 && __cplusplus <= 201103L)

638 *
	$gës
 (*
__s
Ë
__wur
 
__©åibuã_dïªˇãd__
;

640 
__END_NAMESPACE_STD


642 #ifde‡
__USE_GNU


649 *
	$fgës_u∆ocked
 (*
__ª°ri˘
 
__s
, 
__n
,

650 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__gëdñim
 (**
__ª°ri˘
 
__löïå
,

666 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

667 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

668 
_IO_ssize_t
 
	$gëdñim
 (**
__ª°ri˘
 
__löïå
,

669 
size_t
 *
__ª°ri˘
 
__n
, 
__dñimôî
,

670 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

678 
_IO_ssize_t
 
	$gëlöe
 (**
__ª°ri˘
 
__löïå
,

679 
size_t
 *
__ª°ri˘
 
__n
,

680 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`Âuts
 (c⁄° *
__ª°ri˘
 
__s
, 
FILE
 *__ª°ri˘ 
__°ªam
);

695 
	`puts
 (c⁄° *
__s
);

702 
	`ungëc
 (
__c
, 
FILE
 *
__°ªam
);

709 
size_t
 
	$‰ód
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

715 
size_t
 
	`fwrôe
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

716 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifde‡
__USE_GNU


726 
	`Âuts_u∆ocked
 (c⁄° *
__ª°ri˘
 
__s
,

727 
FILE
 *
__ª°ri˘
 
__°ªam
);

730 #ifde‡
__USE_MISC


737 
size_t
 
	$‰ód_u∆ocked
 (*
__ª°ri˘
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
Ë
__wur
;

739 
size_t
 
	`fwrôe_u∆ocked
 (c⁄° *
__ª°ri˘
 
__±r
, size_à
__size
,

740 
size_t
 
__n
, 
FILE
 *
__ª°ri˘
 
__°ªam
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__°ªam
, 
__off
, 
__whí˚
);

754 
	$·ñl
 (
FILE
 *
__°ªam
Ë
__wur
;

759 
	`ªwöd
 (
FILE
 *
__°ªam
);

760 
__END_NAMESPACE_STD


767 #i‡
deföed
 
__USE_LARGEFILE
 || deföed 
__USE_XOPEN2K


768 #i‚de‡
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__°ªam
, 
__off_t
 
__off
, 
__whí˚
);

778 
__off_t
 
	$·ñlo
 (
FILE
 *
__°ªam
Ë
__wur
;

780 #ifde‡
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
·ñlo
, (
FILE
 *
__°ªam
), 
·ñlo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#·ñlo
 
·ñlo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #i‚de‡
__USE_FILE_OFFSET64


798 
	`fgëpos
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos_t
 *__ª°ri˘ 
__pos
);

803 
	`f£ços
 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
);

805 #ifde‡
__REDIRECT


806 
	`__REDIRECT
 (
fgëpos
, (
FILE
 *
__ª°ri˘
 
__°ªam
,

807 
Âos_t
 *
__ª°ri˘
 
__pos
), 
fgëpos64
);

808 
	`__REDIRECT
 (
f£ços
,

809 (
FILE
 *
__°ªam
, c⁄° 
Âos_t
 *
__pos
), 
f£ços64
);

811 
	#fgëpos
 
fgëpos64


	)

812 
	#f£ços
 
f£ços64


	)

815 
__END_NAMESPACE_STD


817 #ifde‡
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__°ªam
, 
__off64_t
 
__off
, 
__whí˚
);

819 
__off64_t
 
	$·ñlo64
 (
FILE
 *
__°ªam
Ë
__wur
;

820 
	`fgëpos64
 (
FILE
 *
__ª°ri˘
 
__°ªam
, 
Âos64_t
 *__ª°ri˘ 
__pos
);

821 
	`f£ços64
 (
FILE
 *
__°ªam
, c⁄° 
Âos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$˛óªº
 (
FILE
 *
__°ªam
Ë
__THROW
;

828 
	$„of
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

830 
	$„º‹
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifde‡
__USE_MISC


835 
	$˛óªº_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
;

836 
	$„of_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

837 
	$„º‹_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`≥º‹
 (c⁄° *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<bôs/sys_îæi°.h
>

856 #ifdef 
__USE_POSIX


858 
	$fûío
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

861 #ifde‡
__USE_MISC


863 
	$fûío_u∆ocked
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

867 #ifde‡
__USE_POSIX2


872 
FILE
 *
	$p›í
 (c⁄° *
__comm™d
, c⁄° *
__modes
Ë
__wur
;

878 
	`p˛o£
 (
FILE
 *
__°ªam
);

882 #ifdef 
__USE_POSIX


884 *
	$˘îmid
 (*
__s
Ë
__THROW
;

888 #ifde‡
__USE_XOPEN


890 *
	`cu£rid
 (*
__s
);

894 #ifdef 
__USE_GNU


895 
ob°ack
;

898 
	$ob°ack_¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

899 c⁄° *
__ª°ri˘
 
__f‹m©
, ...)

900 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 3)));

901 
	$ob°ack_v¥ötf
 (
ob°ack
 *
__ª°ri˘
 
__ob°ack
,

902 c⁄° *
__ª°ri˘
 
__f‹m©
,

903 
_G_va_li°
 
__¨gs
)

904 
__THROWNL
 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__¥ötf__
, 2, 0)));

908 #ifde‡
__USE_POSIX


912 
	$Êockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

916 
	$·rylockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
 
__wur
;

919 
	$fu∆ockfûe
 (
FILE
 *
__°ªam
Ë
__THROW
;

922 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


926 
	#__√ed_gë›t


	)

927 
	~<gë›t.h
>

932 #ifde‡
__USE_EXTERN_INLINES


933 
	~<bôs/°dio.h
>

935 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


936 
	~<bôs/°dio2.h
>

938 #ifde‡
__LDBL_COMPAT


939 
	~<bôs/°dio-ldbl.h
>

942 
__END_DECLS


	@/usr/include/stdlib.h

22 #i‚def 
_STDLIB_H


24 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


29 
	#__√ed_wch¨_t


	)

30 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

34 
	g__BEGIN_DECLS


36 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


37 
	#_STDLIB_H
 1

	)

39 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


41 
	~<bôs/waôÊags.h
>

42 
	~<bôs/waô°©us.h
>

44 #ifde‡
__USE_MISC


49 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


50 
	#__WAIT_INT
(
°©us
) \

51 (
	`__exãnsi⁄__
 (((uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; }) \

52 { .
__ö
 = (
°©us
Ë}).
__i
))

	)

54 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

62 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
waô
 *
	m__u±r
;

70 *
	m__ùå
;

71 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (°©us))

	)

85 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (
	`__WAIT_INT
 (°©us))

	)

86 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (
	`__WAIT_INT
 (°©us))

	)

87 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (
	`__WAIT_INT
 (°©us))

	)

88 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (°©us))

	)

89 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (°©us))

	)

90 #ifde‡
__WIFCONTINUED


91 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (°©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquŸ
;

100 
	mªm
;

101 } 
	tdiv_t
;

104 #i‚de‡
__ldiv_t_deföed


107 
	mquŸ
;

108 
	mªm
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_deföed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


115 
__BEGIN_NAMESPACE_C99


117 
__exãnsi⁄__
 struct

119 
	mquŸ
;

120 
	mªm
;

121 } 
	tŒdiv_t
;

122 
	#__Œdiv_t_deföed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

139 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (c⁄° *
__≈å
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

147 
	$©oi
 (c⁄° *
__≈å
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

150 
	$©ﬁ
 (c⁄° *
__≈å
)

151 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

152 
__END_NAMESPACE_STD


154 #ifde‡
__USE_ISOC99


155 
__BEGIN_NAMESPACE_C99


157 
__exãnsi⁄__
 
	$©ﬁl
 (c⁄° *
__≈å
)

158 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$°πod
 (c⁄° *
__ª°ri˘
 
__≈å
,

165 **
__ª°ri˘
 
__íd±r
)

166 
__THROW
 
	`__n⁄nuŒ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$°πof
 (c⁄° *
__ª°ri˘
 
__≈å
,

173 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

175 
	$°πﬁd
 (c⁄° *
__ª°ri˘
 
__≈å
,

176 **
__ª°ri˘
 
__íd±r
)

177 
__THROW
 
	`__n⁄nuŒ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$°πﬁ
 (c⁄° *
__ª°ri˘
 
__≈å
,

184 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

185 
__THROW
 
	`__n⁄nuŒ
 ((1));

187 
	$°πoul
 (c⁄° *
__ª°ri˘
 
__≈å
,

188 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

189 
__THROW
 
	`__n⁄nuŒ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifde‡
__USE_MISC


194 
__exãnsi⁄__


195 
	$°πoq
 (c⁄° *
__ª°ri˘
 
__≈å
,

196 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

197 
__THROW
 
	`__n⁄nuŒ
 ((1));

199 
__exãnsi⁄__


200 
	$°πouq
 (c⁄° *
__ª°ri˘
 
__≈å
,

201 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

202 
__THROW
 
	`__n⁄nuŒ
 ((1));

205 #ifde‡
__USE_ISOC99


206 
__BEGIN_NAMESPACE_C99


208 
__exãnsi⁄__


209 
	$°πﬁl
 (c⁄° *
__ª°ri˘
 
__≈å
,

210 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

211 
__THROW
 
	`__n⁄nuŒ
 ((1));

213 
__exãnsi⁄__


214 
	$°πouŒ
 (c⁄° *
__ª°ri˘
 
__≈å
,

215 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

216 
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifde‡
__USE_GNU


235 
	~<xloˇÀ.h
>

239 
	$°πﬁ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

240 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

241 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

243 
	$°πoul_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

244 **
__ª°ri˘
 
__íd±r
,

245 
__ba£
, 
__loˇÀ_t
 
__loc
)

246 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

248 
__exãnsi⁄__


249 
	$°πﬁl_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

250 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

251 
__loˇÀ_t
 
__loc
)

252 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

254 
__exãnsi⁄__


255 
	$°πouŒ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

256 **
__ª°ri˘
 
__íd±r
,

257 
__ba£
, 
__loˇÀ_t
 
__loc
)

258 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

260 
	$°πod_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

261 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

262 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

264 
	$°πof_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

265 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

266 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

268 
	$°πﬁd_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

269 **
__ª°ri˘
 
__íd±r
,

270 
__loˇÀ_t
 
__loc
)

271 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

275 #ifde‡
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__exã∫_ölöe
 

278 
	`__NTH
 (
	$©oi
 (c⁄° *
__≈å
))

280  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

281 
	}
}

282 
__exã∫_ölöe
 

283 
__NTH
 (
	$©ﬁ
 (c⁄° *
__≈å
))

285  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ifde‡
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__exãnsi⁄__
 
__exã∫_ölöe
 

292 
__NTH
 (
	$©ﬁl
 (c⁄° *
__≈å
))

294  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

308 
	$a64l
 (c⁄° *
__s
)

309 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

313 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


314 
	~<sys/ty≥s.h
>

321 
	$øndom
 (Ë
__THROW
;

324 
	$§™dom
 (
__£ed
Ë
__THROW
;

330 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

331 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

335 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

338 #ifde‡
__USE_MISC


343 
	søndom_d©a


345 
öt32_t
 *
Âå
;

346 
öt32_t
 *
Ωå
;

347 
öt32_t
 *
°©e
;

348 
ønd_ty≥
;

349 
ønd_deg
;

350 
ønd_£p
;

351 
öt32_t
 *
íd_±r
;

354 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

355 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

357 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

358 
__THROW
 
	`__n⁄nuŒ
 ((2));

360 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

361 
size_t
 
__°©ñí
,

362 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

363 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

365 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

366 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

367 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$ønd
 (Ë
__THROW
;

376 
	$§™d
 (
__£ed
Ë
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifde‡
__USE_POSIX


381 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

385 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


389 
	$dønd48
 (Ë
__THROW
;

390 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 
	$Ã™d48
 (Ë
__THROW
;

394 
	$ƒ™d48
 (
__xsubi
[3])

395 
__THROW
 
	`__n⁄nuŒ
 ((1));

398 
	$mønd48
 (Ë
__THROW
;

399 
	$jønd48
 (
__xsubi
[3])

400 
__THROW
 
	`__n⁄nuŒ
 ((1));

403 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__n⁄nuŒ
 ((1));

406 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

408 #ifde‡
__USE_MISC


412 
	sdønd48_d©a


414 
__x
[3];

415 
__ﬁd_x
[3];

416 
__c
;

417 
__öô
;

418 
__exãnsi⁄__
 
__a
;

423 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

424 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

425 
	$î™d48_r
 (
__xsubi
[3],

426 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

427 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

430 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

431 *
__ª°ri˘
 
__ªsu…
)

432 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

433 
	$ƒ™d48_r
 (
__xsubi
[3],

434 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

435 *
__ª°ri˘
 
__ªsu…
)

436 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

439 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

440 *
__ª°ri˘
 
__ªsu…
)

441 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

442 
	$jønd48_r
 (
__xsubi
[3],

443 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

444 *
__ª°ri˘
 
__ªsu…
)

445 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

448 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

449 
__THROW
 
	`__n⁄nuŒ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$lc⁄g48_r
 (
__∑øm
[7],

455 
dønd48_d©a
 *
__buf„r
)

456 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

462 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


463 
	#__mÆloc_™d_ˇŒoc_deföed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

468 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

469 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

483 
	$‰ì
 (*
__±r
Ë
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$c‰ì
 (*
__±r
Ë
__THROW
;

491 #ifde‡
__USE_MISC


492 
	~<Æloˇ.h
>

495 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

496 || 
deföed
 
__USE_MISC


498 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

501 #ifde‡
__USE_XOPEN2K


503 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

504 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

507 #ifde‡
__USE_ISOC11


509 *
	$Æig√d_Æloc
 (
size_t
 
__Æignmít
, size_à
__size
)

510 
__THROW
 
__©åibuã_mÆloc__
 
	`__©åibuã_Æloc_size__
 ((2)Ë
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

519 
	$©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

521 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


523 #ifde‡
__˝lu•lus


524 "C++" 
	$©_quick_exô
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

527 
	$©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	$⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

536 
__THROW
 
	`__n⁄nuŒ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

545 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


549 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

551 
__END_NAMESPACE_STD


553 #ifde‡
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$gëív
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

565 
__END_NAMESPACE_STD


567 #ifde‡
__USE_GNU


570 *
	$£cuª_gëív
 (c⁄° *
__«me
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

574 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


578 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

581 #ifde‡
__USE_XOPEN2K


584 
	$£ãnv
 (c⁄° *
__«me
, c⁄° *
__vÆue
, 
__ª∂a˚
)

585 
__THROW
 
	`__n⁄nuŒ
 ((2));

588 
	$un£ãnv
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$˛óªnv
 (Ë
__THROW
;

599 #i‡
deföed
 
__USE_MISC
 \

600 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
)

606 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

609 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


618 #i‚de‡
__USE_FILE_OFFSET64


619 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

621 #ifde‡
__REDIRECT


622 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

623 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

625 
	#mk°emp
 
mk°emp64


	)

628 #ifde‡
__USE_LARGEFILE64


629 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

633 #ifde‡
__USE_MISC


640 #i‚de‡
__USE_FILE_OFFSET64


641 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

643 #ifde‡
__REDIRECT


644 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

645 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

647 
	#mk°emps
 
mk°emps64


	)

650 #ifde‡
__USE_LARGEFILE64


651 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

652 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

656 #ifde‡
__USE_XOPEN2K8


662 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

665 #ifde‡
__USE_GNU


672 #i‚de‡
__USE_FILE_OFFSET64


673 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

675 #ifde‡
__REDIRECT


676 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

677 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

679 
	#mko°emp
 
mko°emp64


	)

682 #ifde‡
__USE_LARGEFILE64


683 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

692 #i‚de‡
__USE_FILE_OFFSET64


693 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

694 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

696 #ifde‡
__REDIRECT


697 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

698 
__Êags
), 
mko°emps64
)

699 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

701 
	#mko°emps
 
mko°emps64


	)

704 #ifde‡
__USE_LARGEFILE64


705 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

706 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$sy°em
 (c⁄° *
__comm™d
Ë
__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$ˇn⁄iˇlize_fûe_«me
 (c⁄° *
__«me
)

724 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

727 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


733 *
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
,

734 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

739 #i‚de‡
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__com∑r_‚_t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

747 #ifde‡
__USE_GNU


748 (*
	t__com∑r_d_‚_t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$b£¨ch
 (c⁄° *
__key
, c⁄° *
__ba£
,

755 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

756 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

758 #ifde‡
__USE_EXTERN_INLINES


759 
	~<bôs/°dlib-b£¨ch.h
>

764 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

765 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

766 #ifde‡
__USE_GNU


767 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

768 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

769 
	`__n⁄nuŒ
 ((1, 4));

774 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

775 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

776 
__END_NAMESPACE_STD


778 #ifde‡
__USE_ISOC99


779 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

780 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

784 
__BEGIN_NAMESPACE_STD


788 
div_t
 
	$div
 (
__numî
, 
__díom
)

789 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

790 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

791 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

792 
__END_NAMESPACE_STD


794 #ifde‡
__USE_ISOC99


795 
__BEGIN_NAMESPACE_C99


796 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

797 
__díom
)

798 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

799 
__END_NAMESPACE_C99


803 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

804 || 
deföed
 
__USE_MISC


811 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

812 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

817 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

818 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

823 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

824 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

827 #ifde‡
__USE_MISC


829 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

830 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

831 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

832 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

833 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

834 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

835 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

836 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

841 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

842 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

843 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

844 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

845 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

846 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

848 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

849 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

850 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

851 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

852 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

853 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

854 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

855 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

859 
__BEGIN_NAMESPACE_STD


862 
	$mbÀn
 (c⁄° *
__s
, 
size_t
 
__n
Ë
__THROW
;

865 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

866 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

869 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
;

873 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

874 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

876 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

877 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

878 
__THROW
;

879 
__END_NAMESPACE_STD


882 #ifde‡
__USE_MISC


887 
	$Ωm©ch
 (c⁄° *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

891 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


898 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

899 *c⁄° *
__ª°ri˘
 
__tokís
,

900 **
__ª°ri˘
 
__vÆuï
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

905 #ifde‡
__USE_XOPEN


907 
	$£tkey
 (c⁄° *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

913 #ifde‡
__USE_XOPEN2KXSI


915 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

918 #ifde‡
__USE_XOPEN


923 
	$gø¡±
 (
__fd
Ë
__THROW
;

927 
	$u∆ock±
 (
__fd
Ë
__THROW
;

932 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

935 #ifde‡
__USE_GNU


939 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

940 
__THROW
 
	`__n⁄nuŒ
 ((2));

943 
	`gë±
 ();

946 #ifde‡
__USE_MISC


950 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

951 
__THROW
 
	`__n⁄nuŒ
 ((1));

954 
	~<bôs/°dlib-Êﬂt.h
>

957 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


958 
	~<bôs/°dlib.h
>

960 #ifde‡
__LDBL_COMPAT


961 
	~<bôs/°dlib-ldbl.h
>

965 #unde‡
__√ed_mÆloc_™d_ˇŒoc


967 
__END_DECLS


	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


30 
	#__√ed_size_t


	)

31 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

35 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

43 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

46 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

47 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


54 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

65 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

69 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

74 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 #ifde‡
__OPTIMIZE__


78 
__exã∫_Æways_ölöe
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


81  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

84 
__exã∫_Æways_ölöe
 const *

85 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


87  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifde‡
__USE_GNU


100 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

103 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

106 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

107 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

111 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

114 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

117 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

126 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

128 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

129 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

130 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

133 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

134 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

136 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

137 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

140 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

141 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

143 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

147 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

150 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

151 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

152 
__THROW
 
	`__n⁄nuŒ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifde‡
__USE_XOPEN2K8


159 
	~<xloˇÀ.h
>

162 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

163 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

165 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

166 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

169 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


171 *
	$°rdup
 (c⁄° *
__s
)

172 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

178 #i‡
deföed
 
__USE_XOPEN2K8


179 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

180 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

183 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


185 
	#°rdu∑
(
s
) \

186 (
__exãnsi⁄__
 \

188 c⁄° *
__ﬁd
 = (
s
); \

189 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

190 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

191 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

192 
	}
}))

	)

195 
	#°∫du∑
(
s
, 
n
) \

196 (
__exãnsi⁄__
 \

198 c⁄° *
__ﬁd
 = (
s
); \

199 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

200 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

201 
__√w
[
__Àn
] = '\0'; \

202 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

203 }))

	)

206 
	g__BEGIN_NAMESPACE_STD


208 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


211 *
°rchr
 (*
__s
, 
__c
)

212 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

213 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

214 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

216 #ifde‡
__OPTIMIZE__


217 
__exã∫_Æways_ölöe
 *

218 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


220  
__buûtö_°rchr
 (
__s
, 
__c
);

223 
__exã∫_Æways_ölöe
 const *

224 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


226  
__buûtö_°rchr
 (
__s
, 
__c
);

231 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

232 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

235 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


238 *
	`°ºchr
 (*
__s
, 
__c
)

239 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

240 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

241 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

243 #ifde‡
__OPTIMIZE__


244 
__exã∫_Æways_ölöe
 *

245 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


247  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

250 
__exã∫_Æways_ölöe
 const *

251 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


253  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

256 
	}
}

258 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

259 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

261 
__END_NAMESPACE_STD


263 #ifde‡
__USE_GNU


266 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


267 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

268 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

269 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

270 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

272 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

273 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

277 
__BEGIN_NAMESPACE_STD


280 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

281 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

284 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

285 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

287 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


290 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

291 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

292 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

293 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

295 #ifde‡
__OPTIMIZE__


296 
__exã∫_Æways_ölöe
 *

297 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


299  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

302 
__exã∫_Æways_ölöe
 const *

303 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


305  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

308 
	}
}

310 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

311 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

314 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


317 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

318 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

319 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

320 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

322 #ifde‡
__OPTIMIZE__


323 
__exã∫_Æways_ölöe
 *

324 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


326  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

329 
__exã∫_Æways_ölöe
 const *

330 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


332  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

335 
	}
}

337 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

338 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

343 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

344 
__THROW
 
	`__n⁄nuŒ
 ((2));

345 
__END_NAMESPACE_STD


349 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

350 c⁄° *
__ª°ri˘
 
__dñim
,

351 **
__ª°ri˘
 
__ßve_±r
)

352 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

353 #ifde‡
__USE_POSIX


354 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

355 **
__ª°ri˘
 
__ßve_±r
)

356 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

359 #ifde‡
__USE_GNU


361 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


362 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

363 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

364 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

365 c⁄° *
__√edÀ
)

366 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

368 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

369 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

373 #ifde‡
__USE_GNU


377 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

378 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

379 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

383 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

384 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

385 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

386 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

387 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

388 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

392 
__BEGIN_NAMESPACE_STD


394 
size_t
 
	$°æí
 (c⁄° *
__s
)

395 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

396 
__END_NAMESPACE_STD


398 #ifdef 
__USE_XOPEN2K8


401 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

402 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

406 
__BEGIN_NAMESPACE_STD


408 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

409 
__END_NAMESPACE_STD


410 #ifde‡
__USE_XOPEN2K


418 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


421 #ifde‡
__REDIRECT_NTH


422 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

423 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

424 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

426 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

427 
__THROW
 
	`__n⁄nuŒ
 ((2));

428 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

433 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

434 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

438 #ifde‡
__USE_XOPEN2K8


440 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

446 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

448 #ifde‡
__USE_MISC


450 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

451 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

454 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

457 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

458 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

461 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


464 *
	`ödex
 (*
__s
, 
__c
)

465 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

466 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

467 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

469 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


470 
__exã∫_Æways_ölöe
 *

471 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


473  
	`__buûtö_ödex
 (
__s
, 
__c
);

476 
__exã∫_Æways_ölöe
 const *

477 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


479  
	`__buûtö_ödex
 (
__s
, 
__c
);

482 
	}
}

484 *
	$ödex
 (c⁄° *
__s
, 
__c
)

485 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

489 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


492 *
	`rödex
 (*
__s
, 
__c
)

493 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

494 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

495 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

497 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


498 
__exã∫_Æways_ölöe
 *

499 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


501  
	`__buûtö_rödex
 (
__s
, 
__c
);

504 
__exã∫_Æways_ölöe
 const *

505 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


507  
	`__buûtö_rödex
 (
__s
, 
__c
);

510 
	}
}

512 *
	$rödex
 (c⁄° *
__s
, 
__c
)

513 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

518 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

522 #ifdef 
__USE_GNU


523 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

524 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

525 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

529 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

530 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

533 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

534 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

537 #ifdef 
__USE_GNU


540 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

541 
__loˇÀ_t
 
__loc
)

542 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

544 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

545 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

546 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

549 #ifdef 
__USE_MISC


552 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

553 c⁄° *
__ª°ri˘
 
__dñim
)

554 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifdef 
__USE_XOPEN2K8


559 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

562 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

563 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

564 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

565 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

569 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

570 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

571 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

572 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

573 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

574 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

577 #ifdef 
__USE_GNU


579 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

580 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

583 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

586 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

588 #i‚de‡
ba£«me


593 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


594 "C++" *
	$ba£«me
 (*
__fûíame
)

595 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

596 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

597 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

599 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

605 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

606 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

607 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


627 
	~<bôs/°rög.h
>

630 
	~<bôs/°rög2.h
>

633 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


635 
	~<bôs/°rög3.h
>

639 #i‡
deföed
 
__USE_GNU
 && deföed 
__OPTIMIZE__
 \

640 && 
deföed
 
__exã∫_Æways_ölöe
 && 
	$__GNUC_PREREQ
 (3,2)

641 #i‡!
deföed
 
_FORCE_INLINES
 && !deföed 
_HAVE_STRING_ARCH_memp˝y


643 #unde‡
memp˝y


644 #unde‡
__memp˝y


645 
	#memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y_ölöe
 (de°, src,Ç)

	)

646 
	#__memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y_ölöe
 (de°, src,Ç)

	)

648 
__exã∫_Æways_ölöe
 *

649 
	$__memp˝y_ölöe
 (*
__ª°ri˘
 
__de°
,

650 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

652  (*Ë
	`mem˝y
 (
__de°
, 
__§c
, 
__n
) + __n;

653 
	}
}

658 
	g__END_DECLS


	@/usr/include/strings.h

18 #i‚def 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

24 #i‡!
deföed
 
_STRING_H
 || !deföed 
__USE_MISC


26 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 
	~<°ddef.h
>

31 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

32 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

35 
	g__BEGIN_DECLS


37 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8


39 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

40 
__THROW
 
__©åibuã_puª__
;

43 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
Ë
__THROW
;

46 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
;

49 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


52 *
	`ödex
 (*
__s
, 
__c
)

53 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

54 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

55 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

57 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRING_H_PROTO


58 
__exã∫_Æways_ölöe
 *

59 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


61  
	`__buûtö_ödex
 (
__s
, 
__c
);

64 
__exã∫_Æways_ölöe
 const *

65 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


67  
	`__buûtö_ödex
 (
__s
, 
__c
);

70 
	}
}

72 *
	$ödex
 (c⁄° *
__s
, 
__c
)

73 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 #ifde‡
__CORRECT_ISO_CPP_STRINGS_H_PROTO


80 *
	`rödex
 (*
__s
, 
__c
)

81 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

82 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

83 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

85 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRING_H_PROTO


86 
__exã∫_Æways_ölöe
 *

87 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


89  
	`__buûtö_rödex
 (
__s
, 
__c
);

92 
__exã∫_Æways_ölöe
 const *

93 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


95  
	`__buûtö_rödex
 (
__s
, 
__c
);

98 
	}
}

100 *
	$rödex
 (c⁄° *
__s
, 
__c
)

101 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

105 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K8
 || deföed 
__USE_XOPEN2K8XSI


108 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((const));

112 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

113 
__THROW
 
__©åibuã_puª__
;

116 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

117 
__THROW
 
__©åibuã_puª__
;

119 #ifdef 
__USE_XOPEN2K8


123 
	~<xloˇÀ.h
>

127 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__loc
)

128 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

130 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

131 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

132 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

135 
__END_DECLS


	@/usr/include/time.h

22 #i‚def 
_TIME_H


24 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

25 ! 
deföed
 
	g__√ed_time•ec
)

26 
	#_TIME_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__√ed_size_t


	)

36 
	#__√ed_NULL


	)

37 
	~<°ddef.h
>

41 
	~<bôs/time.h
>

44 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


45 #i‚de‡
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

53 
	#__˛ock_t_deföed
 1

	)

55 
	~<bôs/ty≥s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__˛ock_t
 
	t˛ock_t
;

60 
	g__END_NAMESPACE_STD


61 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX


62 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

66 #unde‡
__√ed_˛ock_t


68 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

69 
	#__time_t_deföed
 1

	)

71 
	~<bôs/ty≥s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ifde‡
__USE_POSIX


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #unde‡
__√ed_time_t


84 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

85 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

86 
	#__˛ockid_t_deföed
 1

	)

88 
	~<bôs/ty≥s.h
>

91 
__˛ockid_t
 
	t˛ockid_t
;

94 #unde‡
__˛ockid_time_t


96 #i‡!
deföed
 
__timî_t_deföed
 && \

97 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

98 
	#__timî_t_deföed
 1

	)

100 
	~<bôs/ty≥s.h
>

103 
__timî_t
 
	ttimî_t
;

106 #unde‡
__√ed_timî_t


109 #i‡(!
deföed
 
__time•ec_deföed
 \

110 && ((
deföed
 
_TIME_H
 \

111 && (
deföed
 
__USE_POSIX199309
 \

112 || 
deföed
 
__USE_ISOC11
)) \

113 || 
deföed
 
__√ed_time•ec
))

114 
	#__time•ec_deföed
 1

	)

116 
	~<bôs/ty≥s.h
>

120 
	stime•ec


122 
__time_t
 
tv_£c
;

123 
__sysˇŒ_¶⁄g_t
 
tv_n£c
;

127 #unde‡
__√ed_time•ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mö
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m⁄
;

140 
tm_yór
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd°
;

145 #ifdef 
__USE_MISC


146 
tm_gmtoff
;

147 c⁄° *
tm_z⁄e
;

149 
__tm_gmtoff
;

150 c⁄° *
__tm_z⁄e
;

153 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde‡
__USE_POSIX199309


161 
	sôimî•ec


163 
time•ec
 
ô_öãrvÆ
;

164 
time•ec
 
ô_vÆue
;

168 
sigevít
;

172 #ifde‡
__USE_XOPEN2K


173 #i‚de‡
__pid_t_deföed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_deföed


	)

180 #ifde‡
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

195 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

196 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

199 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

205 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

206 c⁄° *
__ª°ri˘
 
__f‹m©
,

207 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifde‡
__USE_XOPEN


213 *
	$°Ωtime
 (c⁄° *
__ª°ri˘
 
__s
,

214 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

215 
__THROW
;

218 #ifde‡
__USE_XOPEN2K8


221 
	~<xloˇÀ.h
>

223 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

224 c⁄° *
__ª°ri˘
 
__f‹m©
,

225 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

226 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 #ifde‡
__USE_GNU


230 *
	$°Ωtime_l
 (c⁄° *
__ª°ri˘
 
__s
,

231 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

232 
__loˇÀ_t
 
__loc
Ë
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

243 
tm
 *
	$loˇ…ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

244 
__END_NAMESPACE_STD


246 #ifde‡
__USE_POSIX


249 
tm
 *
	$gmtime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

250 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

254 
tm
 *
	$loˇ…ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

255 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$as˘ime
 (c⁄° 
tm
 *
__ç
Ë
__THROW
;

264 *
	$˘ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

265 
__END_NAMESPACE_STD


267 #ifde‡
__USE_POSIX


272 *
	$as˘ime_r
 (c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

273 *
__ª°ri˘
 
__buf
Ë
__THROW
;

276 *
	$˘ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

277 *
__ª°ri˘
 
__buf
Ë
__THROW
;

282 *
__tz«me
[2];

283 
__daylight
;

284 
__timez⁄e
;

287 #ifdef 
__USE_POSIX


289 *
tz«me
[2];

293 
	$tz£t
 (Ë
__THROW
;

296 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


297 
daylight
;

298 
timez⁄e
;

301 #ifde‡
__USE_MISC


304 
	$°ime
 (c⁄° 
time_t
 *
__whí
Ë
__THROW
;

310 
	#__i¶óp
(
yór
) \

311 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

314 #ifde‡
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

322 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

325 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

329 #ifde‡
__USE_POSIX199309


334 
	`«no¶ìp
 (c⁄° 
time•ec
 *
__ªque°ed_time
,

335 
time•ec
 *
__ªmaöög
);

339 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

342 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

345 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, c⁄° 
time•ec
 *
__ç
)

346 
__THROW
;

348 #ifde‡
__USE_XOPEN2K


353 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

354 c⁄° 
time•ec
 *
__ªq
,

355 
time•ec
 *
__ªm
);

358 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

363 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

364 
sigevít
 *
__ª°ri˘
 
__evp
,

365 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

368 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

371 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

372 c⁄° 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

373 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

376 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

377 
__THROW
;

380 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

384 #ifde‡
__USE_ISOC11


386 
	$time•ec_gë
 (
time•ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__n⁄nuŒ
 ((1));

391 #ifde‡
__USE_XOPEN_EXTENDED


403 
gëd©e_îr
;

412 
tm
 *
	`gëd©e
 (c⁄° *
__°rög
);

415 #ifde‡
__USE_GNU


426 
	`gëd©e_r
 (c⁄° *
__ª°ri˘
 
__°rög
,

427 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #i‚def 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


32 #ifde‡
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #ñi‡
deföed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #ñi‡
deföed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #ñi‡
deföed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifde‡
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #ñi‡
deföed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #ñi‡
deföed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifde‡
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #ñi‡
deföed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #ñi‡
deföed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<bôs/posix_›t.h
>

208 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


209 
	~<bôs/ívú⁄míts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<bôs/ty≥s.h
>

222 #i‚def 
__ssize_t_deföed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_deföed


	)

227 
	#__√ed_size_t


	)

228 
	#__√ed_NULL


	)

229 
	~<°ddef.h
>

231 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K


234 #i‚de‡
__gid_t_deföed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_deföed


	)

239 #i‚de‡
__uid_t_deföed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_deföed


	)

244 #i‚de‡
__off_t_deföed


245 #i‚de‡
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_deföed


	)

252 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_deföed


	)

257 #i‚de‡
__u£c⁄ds_t_deföed


258 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

259 
	#__u£c⁄ds_t_deföed


	)

262 #i‚de‡
__pid_t_deföed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_deföed


	)

268 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


269 #i‚de‡
__öçå_t_deföed


270 
__öçå_t
 
	töçå_t
;

271 
	#__öçå_t_deföed


	)

275 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


276 #i‚de‡
__sockÀn_t_deföed


277 
__sockÀn_t
 
	tsockÀn_t
;

278 
	#__sockÀn_t_deföed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$ac˚ss
 (c⁄° *
__«me
, 
__ty≥
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

292 #ifde‡
__USE_GNU


295 
	$euidac˚ss
 (c⁄° *
__«me
, 
__ty≥
)

296 
__THROW
 
	`__n⁄nuŒ
 ((1));

299 
	$óc˚ss
 (c⁄° *
__«me
, 
__ty≥
)

300 
__THROW
 
	`__n⁄nuŒ
 ((1));

303 #ifde‡
__USE_ATFILE


307 
	$Ác˚sßt
 (
__fd
, c⁄° *
__fûe
, 
__ty≥
, 
__Êag
)

308 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

313 #i‚def 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifde‡
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #i‡
deföed
 
__USE_MISC
 && !deföed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #i‚de‡
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__whí˚
Ë
__THROW
;

339 #ifde‡
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifde‡
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__whí˚
)

349 
__THROW
;

356 
	`˛o£
 (
__fd
);

363 
ssize_t
 
	$ªad
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
Ë
__wur
;

369 
ssize_t
 
	$wrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
Ë
__wur
;

371 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8


372 #i‚de‡
__USE_FILE_OFFSET64


379 
ssize_t
 
	$¥ód
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

380 
__off_t
 
__off£t
Ë
__wur
;

387 
ssize_t
 
	$pwrôe
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
Ë
__wur
;

390 #ifde‡
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
¥ód
, (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

392 
__off64_t
 
__off£t
),

393 
¥ód64
Ë
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwrôe
, (
__fd
, c⁄° *
__buf
,

395 
size_t
 
__nbyãs
, 
__off64_t
 
__off£t
),

396 
pwrôe64
Ë
__wur
;

398 
	#¥ód
 
¥ód64


	)

399 
	#pwrôe
 
pwrôe64


	)

403 #ifde‡
__USE_LARGEFILE64


407 
ssize_t
 
	$¥ód64
 (
__fd
, *
__buf
, 
size_t
 
__nbyãs
,

408 
__off64_t
 
__off£t
Ë
__wur
;

411 
ssize_t
 
	$pwrôe64
 (
__fd
, c⁄° *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
Ë
__wur
;

420 
	$pùe
 (
__pùedes
[2]Ë
__THROW
 
__wur
;

422 #ifde‡
__USE_GNU


425 
	$pùe2
 (
__pùedes
[2], 
__Êags
Ë
__THROW
 
__wur
;

435 
	$Æ¨m
 (
__£c⁄ds
Ë
__THROW
;

447 
	`¶ìp
 (
__£c⁄ds
);

449 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

450 || 
deföed
 
__USE_MISC


455 
__u£c⁄ds_t
 
	$uÆ¨m
 (
__u£c⁄ds_t
 
__vÆue
, __u£c⁄ds_à
__öãrvÆ
)

456 
__THROW
;

463 
	`u¶ìp
 (
__u£c⁄ds_t
 
__u£c⁄ds
);

472 
	`∑u£
 ();

476 
	$chown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

479 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
Ë
__THROW
 
__wur
;

486 
	$lchown
 (c⁄° *
__fûe
, 
__uid_t
 
__ow√r
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

491 #ifde‡
__USE_ATFILE


494 
	$fchow«t
 (
__fd
, c⁄° *
__fûe
, 
__uid_t
 
__ow√r
,

495 
__gid_t
 
__group
, 
__Êag
)

496 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

500 
	$chdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

502 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


504 
	$fchdú
 (
__fd
Ë
__THROW
 
__wur
;

514 *
	$gëcwd
 (*
__buf
, 
size_t
 
__size
Ë
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$gë_cuºít_dú_«me
 (Ë
__THROW
;

523 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

524 || 
deföed
 
__USE_MISC


528 *
	$gëwd
 (*
__buf
)

529 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__©åibuã_dïªˇãd__
 
__wur
;

534 
	$dup
 (
__fd
Ë
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
Ë
__THROW
;

539 #ifde‡
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__Êags
Ë
__THROW
;

546 **
__ívú⁄
;

547 #ifde‡
__USE_GNU


548 **
ívú⁄
;

554 
	$execve
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[],

555 *c⁄° 
__ívp
[]Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

557 #ifde‡
__USE_XOPEN2K8


560 
	$„xecve
 (
__fd
, *c⁄° 
__¨gv
[], *c⁄° 
__ívp
[])

561 
__THROW
 
	`__n⁄nuŒ
 ((2));

566 
	$execv
 (c⁄° *
__∑th
, *c⁄° 
__¨gv
[])

567 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

571 
	$exe˛e
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

572 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

576 
	$exe˛
 (c⁄° *
__∑th
, c⁄° *
__¨g
, ...)

577 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

581 
	$execvp
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[])

582 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

587 
	$exe˛p
 (c⁄° *
__fûe
, c⁄° *
__¨g
, ...)

588 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

590 #ifde‡
__USE_GNU


593 
	$execv≥
 (c⁄° *
__fûe
, *c⁄° 
__¨gv
[],

594 *c⁄° 
__ívp
[])

595 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

599 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN


601 
	$ni˚
 (
__öc
Ë
__THROW
 
__wur
;

606 
	$_exô
 (
__°©us
Ë
	`__©åibuã__
 ((
__n‹ëu∫__
));

612 
	~<bôs/c⁄‚ame.h
>

615 
	$∑thc⁄f
 (c⁄° *
__∑th
, 
__«me
)

616 
__THROW
 
	`__n⁄nuŒ
 ((1));

619 
	$Â©hc⁄f
 (
__fd
, 
__«me
Ë
__THROW
;

622 
	$sysc⁄f
 (
__«me
Ë
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$c⁄f°r
 (
__«me
, *
__buf
, 
size_t
 
__Àn
Ë
__THROW
;

631 
__pid_t
 
	$gëpid
 (Ë
__THROW
;

634 
__pid_t
 
	$gëµid
 (Ë
__THROW
;

637 
__pid_t
 
	$gëpgΩ
 (Ë
__THROW
;

640 
__pid_t
 
	$__gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

641 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


642 
__pid_t
 
	$gëpgid
 (
__pid_t
 
__pid
Ë
__THROW
;

649 
	$£çgid
 (
__pid_t
 
__pid
, __pid_à
__pgid
Ë
__THROW
;

651 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


663 
	$£çgΩ
 (Ë
__THROW
;

670 
__pid_t
 
	$£tsid
 (Ë
__THROW
;

672 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


674 
__pid_t
 
	$gësid
 (
__pid_t
 
__pid
Ë
__THROW
;

678 
__uid_t
 
	$gëuid
 (Ë
__THROW
;

681 
__uid_t
 
	$gëeuid
 (Ë
__THROW
;

684 
__gid_t
 
	$gëgid
 (Ë
__THROW
;

687 
__gid_t
 
	$gëegid
 (Ë
__THROW
;

692 
	$gëgroups
 (
__size
, 
__gid_t
 
__li°
[]Ë
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_membî
 (
__gid_t
 
__gid
Ë
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

705 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


708 
	$£åeuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
Ë
__THROW
 
__wur
;

711 #ifde‡
__USE_XOPEN2K


713 
	$£ãuid
 (
__uid_t
 
__uid
Ë
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

722 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


725 
	$£åegid
 (
__gid_t
 
__rgid
, __gid_à
__egid
Ë
__THROW
 
__wur
;

728 #ifde‡
__USE_XOPEN2K


730 
	$£ãgid
 (
__gid_t
 
__gid
Ë
__THROW
 
__wur
;

733 #ifde‡
__USE_GNU


736 
	$gëªsuid
 (
__uid_t
 *
__ruid
, __uid_à*
__euid
, __uid_à*
__suid
)

737 
__THROW
;

741 
	$gëªsgid
 (
__gid_t
 *
__rgid
, __gid_à*
__egid
, __gid_à*
__sgid
)

742 
__THROW
;

746 
	$£åesuid
 (
__uid_t
 
__ruid
, __uid_à
__euid
, __uid_à
__suid
)

747 
__THROW
 
__wur
;

751 
	$£åesgid
 (
__gid_t
 
__rgid
, __gid_à
__egid
, __gid_à
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$f‹k
 (Ë
__THROWNL
;

761 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

762 || 
deföed
 
__USE_MISC


767 
__pid_t
 
	$vf‹k
 (Ë
__THROW
;

773 *
	$ây«me
 (
__fd
Ë
__THROW
;

777 
	$ây«me_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

778 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

782 
	$ißây
 (
__fd
Ë
__THROW
;

784 #i‡
deföed
 
__USE_MISC
 \

785 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_UNIX98
)

788 
	$ây¶Ÿ
 (Ë
__THROW
;

793 
	$lök
 (c⁄° *
__‰om
, c⁄° *
__to
)

794 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

796 #ifde‡
__USE_ATFILE


799 
	$lök©
 (
__‰omfd
, c⁄° *
__‰om
, 
__tofd
,

800 c⁄° *
__to
, 
__Êags
)

801 
__THROW
 
	`__n⁄nuŒ
 ((2, 4)Ë
__wur
;

804 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


806 
	$symlök
 (c⁄° *
__‰om
, c⁄° *
__to
)

807 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

812 
ssize_t
 
	$ªadlök
 (c⁄° *
__ª°ri˘
 
__∑th
,

813 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

814 
__THROW
 
	`__n⁄nuŒ
 ((1, 2)Ë
__wur
;

817 #ifde‡
__USE_ATFILE


819 
	$symlök©
 (c⁄° *
__‰om
, 
__tofd
,

820 c⁄° *
__to
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 3)Ë
__wur
;

823 
ssize_t
 
	$ªadlök©
 (
__fd
, c⁄° *
__ª°ri˘
 
__∑th
,

824 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

825 
__THROW
 
	`__n⁄nuŒ
 ((2, 3)Ë
__wur
;

829 
	$u∆ök
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

831 #ifde‡
__USE_ATFILE


833 
	$u∆ök©
 (
__fd
, c⁄° *
__«me
, 
__Êag
)

834 
__THROW
 
	`__n⁄nuŒ
 ((2));

838 
	$rmdú
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

842 
__pid_t
 
	$tcgëpgΩ
 (
__fd
Ë
__THROW
;

845 
	$tc£çgΩ
 (
__fd
, 
__pid_t
 
__pgΩ_id
Ë
__THROW
;

852 *
	`gëlogö
 ();

853 #i‡
deföed
 
__USE_REENTRANT
 || deföed 
__USE_POSIX199506


860 
	$gëlogö_r
 (*
__«me
, 
size_t
 
__«me_Àn
Ë
	`__n⁄nuŒ
 ((1));

863 #ifdef 
__USE_MISC


865 
	$£éogö
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

869 #ifdef 
__USE_POSIX2


873 
	#__√ed_gë›t


	)

874 
	~<gë›t.h
>

878 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


882 
	$gëho°«me
 (*
__«me
, 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

886 #i‡
deföed
 
__USE_MISC


889 
	$£tho°«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

890 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

894 
	$£tho°id
 (
__id
Ë
__THROW
 
__wur
;

900 
	$gëdomaö«me
 (*
__«me
, 
size_t
 
__Àn
)

901 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

902 
	$£tdomaö«me
 (c⁄° *
__«me
, 
size_t
 
__Àn
)

903 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

909 
	$vh™gup
 (Ë
__THROW
;

912 
	$ªvoke
 (c⁄° *
__fûe
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

920 
	$¥ofû
 (*
__ßm∂e_buf„r
, 
size_t
 
__size
,

921 
size_t
 
__off£t
, 
__sˇÀ
)

922 
__THROW
 
	`__n⁄nuŒ
 ((1));

928 
	$ac˘
 (c⁄° *
__«me
Ë
__THROW
;

932 *
	$gëu£rshñl
 (Ë
__THROW
;

933 
	$ídu£rshñl
 (Ë
__THROW
;

934 
	$£tu£rshñl
 (Ë
__THROW
;

940 
	$d´m⁄
 (
__nochdú
, 
__no˛o£
Ë
__THROW
 
__wur
;

944 #i‡
deföed
 
__USE_MISC
 || (deföed 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K
)

947 
	$chroŸ
 (c⁄° *
__∑th
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

951 *
	$gë∑ss
 (c⁄° *
__¥om±
Ë
	`__n⁄nuŒ
 ((1));

959 
	`fsync
 (
__fd
);

962 #ifde‡
__USE_GNU


965 
	$syncfs
 (
__fd
Ë
__THROW
;

969 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED


972 
	`gëho°id
 ();

975 
	$sync
 (Ë
__THROW
;

978 #i‡
deföed
 
__USE_MISC
 || !deföed 
__USE_XOPEN2K


981 
	$gë∑gesize
 (Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

986 
	$gëdèbÀsize
 (Ë
__THROW
;

992 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


995 #i‚de‡
__USE_FILE_OFFSET64


996 
	$åunˇã
 (c⁄° *
__fûe
, 
__off_t
 
__Àngth
)

997 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

999 #ifde‡
__REDIRECT_NTH


1000 
	`__REDIRECT_NTH
 (
åunˇã
,

1001 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
),

1002 
åunˇã64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1004 
	#åunˇã
 
åunˇã64


	)

1007 #ifde‡
__USE_LARGEFILE64


1008 
	$åunˇã64
 (c⁄° *
__fûe
, 
__off64_t
 
__Àngth
)

1009 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

1014 #i‡
deföed
 
__USE_POSIX199309
 \

1015 || 
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K


1018 #i‚de‡
__USE_FILE_OFFSET64


1019 
	$·runˇã
 (
__fd
, 
__off_t
 
__Àngth
Ë
__THROW
 
__wur
;

1021 #ifde‡
__REDIRECT_NTH


1022 
	`__REDIRECT_NTH
 (
·runˇã
, (
__fd
, 
__off64_t
 
__Àngth
),

1023 
·runˇã64
Ë
__wur
;

1025 
	#·runˇã
 
·runˇã64


	)

1028 #ifde‡
__USE_LARGEFILE64


1029 
	$·runˇã64
 (
__fd
, 
__off64_t
 
__Àngth
Ë
__THROW
 
__wur
;

1035 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

1036 || 
deföed
 
__USE_MISC


1040 
	$brk
 (*
__addr
Ë
__THROW
 
__wur
;

1046 *
	$sbrk
 (
öçå_t
 
__dñè
Ë
__THROW
;

1050 #ifde‡
__USE_MISC


1061 
	$sysˇŒ
 (
__sy¢o
, ...Ë
__THROW
;

1066 #i‡(
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
Ë&& !deföed 
F_LOCK


1078 
	#F_ULOCK
 0

	)

1079 
	#F_LOCK
 1

	)

1080 
	#F_TLOCK
 2

	)

1081 
	#F_TEST
 3

	)

1083 #i‚de‡
__USE_FILE_OFFSET64


1084 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Àn
Ë
__wur
;

1086 #ifde‡
__REDIRECT


1087 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
),

1088 
lockf64
Ë
__wur
;

1090 
	#lockf
 
lockf64


	)

1093 #ifde‡
__USE_LARGEFILE64


1094 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Àn
Ë
__wur
;

1099 #ifde‡
__USE_GNU


1104 
	#TEMP_FAILURE_RETRY
(
ex¥essi⁄
) \

1105 (
__exãnsi⁄__
 \

1106 ({ 
__ªsu…
; \

1107 dÿ
__ªsu…
 = (Ë(
ex¥essi⁄
); \

1108 
__ªsu…
 =-1L && 
î∫o
 =
EINTR
); \

1109 
__ªsu…
; 
	}
}))

	)

1112 #i‡
deföed
 
__USE_POSIX199309
 || deföed 
__USE_UNIX98


1115 
fd©async
 (
__fûdes
);

1121 #ifdef 
__USE_XOPEN


1123 *
	$¸y±
 (c⁄° *
__key
, c⁄° *
__ß…
)

1124 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1128 
	$í¸y±
 (*
__glibc_block
, 
__edÊag
)

1129 
__THROW
 
	`__n⁄nuŒ
 ((1));

1136 
	$swab
 (c⁄° *
__ª°ri˘
 
__‰om
, *__ª°ri˘ 
__to
,

1137 
ssize_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

1143 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_XOPEN2K


1145 *
	$˘îmid
 (*
__s
Ë
__THROW
;

1150 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


1151 
	~<bôs/uni°d.h
>

1154 
__END_DECLS


	@/usr/include/zlib.h

31 #i‚de‡
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zc⁄f.h
"

36 #ifde‡
__˝lu•lus


40 
	#ZLIB_VERSION
 "1.2.8"

	)

41 
	#ZLIB_VERNUM
 0x1280

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 8

	)

45 
	#ZLIB_VER_SUBREVISION
 0

	)

80 
voidpf
 (*
	tÆloc_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, 
	tuI¡
 
	tôems
, uI¡ 
	tsize
));

81 (*
‰ì_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, voidp‡
	taddªss
));

83 
öã∫Æ_°©e
;

85 
	sz_°ªam_s
 {

86 
z_c⁄°
 
Byãf
 *
√xt_ö
;

87 
uI¡
 
avaû_ö
;

88 
uL⁄g
 
tŸÆ_ö
;

90 
Byãf
 *
√xt_out
;

91 
uI¡
 
avaû_out
;

92 
uL⁄g
 
tŸÆ_out
;

94 
z_c⁄°
 *
msg
;

95 
öã∫Æ_°©e
 
FAR
 *
°©e
;

97 
Æloc_func
 
zÆloc
;

98 
‰ì_func
 
z‰ì
;

99 
voidpf
 
›aque
;

101 
d©a_ty≥
;

102 
uL⁄g
 
adÀr
;

103 
uL⁄g
 
ª£rved
;

104 } 
	tz_°ªam
;

106 
z_°ªam
 
	tFAR
 *
	tz_°ªamp
;

112 
	sgz_hódî_s
 {

113 
ãxt
;

114 
uL⁄g
 
time
;

115 
xÊags
;

116 
os
;

117 
Byãf
 *
exåa
;

118 
uI¡
 
exåa_Àn
;

119 
uI¡
 
exåa_max
;

120 
Byãf
 *
«me
;

121 
uI¡
 
«me_max
;

122 
Byãf
 *
commít
;

123 
uI¡
 
comm_max
;

124 
h¸c
;

125 
d⁄e
;

127 } 
	tgz_hódî
;

129 
gz_hódî
 
	tFAR
 *
	tgz_hódîp
;

164 
	#Z_NO_FLUSH
 0

	)

165 
	#Z_PARTIAL_FLUSH
 1

	)

166 
	#Z_SYNC_FLUSH
 2

	)

167 
	#Z_FULL_FLUSH
 3

	)

168 
	#Z_FINISH
 4

	)

169 
	#Z_BLOCK
 5

	)

170 
	#Z_TREES
 6

	)

173 
	#Z_OK
 0

	)

174 
	#Z_STREAM_END
 1

	)

175 
	#Z_NEED_DICT
 2

	)

176 
	#Z_ERRNO
 (-1)

	)

177 
	#Z_STREAM_ERROR
 (-2)

	)

178 
	#Z_DATA_ERROR
 (-3)

	)

179 
	#Z_MEM_ERROR
 (-4)

	)

180 
	#Z_BUF_ERROR
 (-5)

	)

181 
	#Z_VERSION_ERROR
 (-6)

	)

186 
	#Z_NO_COMPRESSION
 0

	)

187 
	#Z_BEST_SPEED
 1

	)

188 
	#Z_BEST_COMPRESSION
 9

	)

189 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

192 
	#Z_FILTERED
 1

	)

193 
	#Z_HUFFMAN_ONLY
 2

	)

194 
	#Z_RLE
 3

	)

195 
	#Z_FIXED
 4

	)

196 
	#Z_DEFAULT_STRATEGY
 0

	)

199 
	#Z_BINARY
 0

	)

200 
	#Z_TEXT
 1

	)

201 
	#Z_ASCII
 
Z_TEXT


	)

202 
	#Z_UNKNOWN
 2

	)

205 
	#Z_DEFLATED
 8

	)

208 
	#Z_NULL
 0

	)

210 
	#zlib_vîsi⁄
 
	`zlibVîsi⁄
()

	)

216 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zlibVîsi⁄
 
OF
(());

246 
ZEXTERN
 
ZEXPORT
 
deÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

353 
ZEXTERN
 
ZEXPORT
 
deÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

392 
ZEXTERN
 
ZEXPORT
 
öÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

508 
ZEXTERN
 
ZEXPORT
 
öÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

587 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

588 c⁄° 
Byãf
 *
di˘i⁄¨y
,

589 
uI¡
 
di˘Lígth
));

631 
ZEXTERN
 
ZEXPORT
 
deÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

632 
z_°ªamp
 
sour˚
));

649 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

660 
ZEXTERN
 
ZEXPORT
 
deÊ©eP¨ams
 
OF
((
z_°ªamp
 
°rm
,

661 
Àvñ
,

662 
°øãgy
));

681 
ZEXTERN
 
ZEXPORT
 
deÊ©eTu√
 
OF
((
z_°ªamp
 
°rm
,

682 
good_Àngth
,

683 
max_œzy
,

684 
ni˚_Àngth
,

685 
max_chaö
));

698 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
deÊ©eBound
 
OF
((
z_°ªamp
 
°rm
,

699 
uL⁄g
 
sour˚Lí
));

713 
ZEXTERN
 
ZEXPORT
 
deÊ©ePídög
 
OF
((
z_°ªamp
 
°rm
,

714 *
≥ndög
,

715 *
bôs
));

728 
ZEXTERN
 
ZEXPORT
 
deÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

729 
bôs
,

730 
vÆue
));

745 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëHódî
 
OF
((
z_°ªamp
 
°rm
,

746 
gz_hódîp
 
hód
));

819 
ZEXTERN
 
ZEXPORT
 
öÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

820 c⁄° 
Byãf
 *
di˘i⁄¨y
,

821 
uI¡
 
di˘Lígth
));

842 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

843 
Byãf
 *
di˘i⁄¨y
,

844 
uI¡
 *
di˘Lígth
));

857 
ZEXTERN
 
ZEXPORT
 
öÊ©eSync
 
OF
((
z_°ªamp
 
°rm
));

876 
ZEXTERN
 
ZEXPORT
 
öÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

877 
z_°ªamp
 
sour˚
));

892 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

902 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t2
 
OF
((
z_°ªamp
 
°rm
,

903 
wödowBôs
));

914 
ZEXTERN
 
ZEXPORT
 
öÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

915 
bôs
,

916 
vÆue
));

935 
ZEXTERN
 
ZEXPORT
 
öÊ©eM¨k
 
OF
((
z_°ªamp
 
°rm
));

963 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëHódî
 
OF
((
z_°ªamp
 
°rm
,

964 
gz_hódîp
 
hód
));

1025 (*
ö_func
Ë
	tOF
((
	tFAR
 *,

1026 
	tz_c⁄°
 
	tFAR
 * FAR *));

1027 (*
out_func
Ë
	tOF
((
	tFAR
 *, FAR *, ));

1029 
ZEXTERN
 
ZEXPORT
 
öÊ©eBack
 
OF
((
z_°ªamp
 
°rm
,

1030 
ö_func
 
ö
, 
FAR
 *
ö_desc
,

1031 
out_func
 
out
, 
FAR
 *
out_desc
));

1099 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackEnd
 
OF
((
z_°ªamp
 
°rm
));

1107 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
zlibCompûeFœgs
 
OF
(());

1148 #i‚de‡
Z_SOLO


1160 
ZEXTERN
 
ZEXPORT
 
com¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1161 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1174 
ZEXTERN
 
ZEXPORT
 
com¥ess2
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1175 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
,

1176 
Àvñ
));

1190 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
com¥essBound
 
OF
((uL⁄g 
sour˚Lí
));

1197 
ZEXTERN
 
ZEXPORT
 
uncom¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1198 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1224 
gzFûe_s
 *
	tgzFûe
;

1264 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gzd›í
 
OF
((
fd
, c⁄° *
mode
));

1287 
ZEXTERN
 
ZEXPORT
 
gzbuf„r
 
OF
((
gzFûe
 
fûe
, 
size
));

1304 
ZEXTERN
 
ZEXPORT
 
gz£ç¨ams
 
OF
((
gzFûe
 
fûe
, 
Àvñ
, 
°øãgy
));

1313 
ZEXTERN
 
ZEXPORT
 
gzªad
 
OF
((
gzFûe
 
fûe
, 
voidp
 
buf
, 
Àn
));

1341 
ZEXTERN
 
ZEXPORT
 
gzwrôe
 
OF
((
gzFûe
 
fûe
,

1342 
voidpc
 
buf
, 
Àn
));

1349 
ZEXTERN
 
ZEXPORTVA
 
gz¥ötf
 
Z_ARG
((
gzFûe
 
fûe
, c⁄° *
f‹m©
, ...));

1364 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFûe
 
fûe
, c⁄° *
s
));

1372 
ZEXTERN
 * 
ZEXPORT
 
gzgës
 
OF
((
gzFûe
 
fûe
, *
buf
, 
Àn
));

1385 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFûe
 
fûe
, 
c
));

1391 
ZEXTERN
 
ZEXPORT
 
gzgëc
 
OF
((
gzFûe
 
fûe
));

1400 
ZEXTERN
 
ZEXPORT
 
gzungëc
 
OF
((
c
, 
gzFûe
 
fûe
));

1412 
ZEXTERN
 
ZEXPORT
 
gzÊush
 
OF
((
gzFûe
 
fûe
, 
Êush
));

1447 
ZEXTERN
 
ZEXPORT
 
gzªwöd
 
OF
((
gzFûe
 
fûe
));

1475 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFûe
 
fûe
));

1490 
ZEXTERN
 
ZEXPORT
 
gzdúe˘
 
OF
((
gzFûe
 
fûe
));

1511 
ZEXTERN
 
ZEXPORT
 
gz˛o£
 
OF
((
gzFûe
 
fûe
));

1524 
ZEXTERN
 
ZEXPORT
 
gz˛o£_r
 
OF
((
gzFûe
 
fûe
));

1525 
ZEXTERN
 
ZEXPORT
 
gz˛o£_w
 
OF
((
gzFûe
 
fûe
));

1536 
ZEXTERN
 c⁄° * 
ZEXPORT
 
gzîr‹
 
OF
((
gzFûe
 
fûe
, *
î∫um
));

1552 
ZEXTERN
 
ZEXPORT
 
gz˛óªº
 
OF
((
gzFûe
 
fûe
));

1569 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32
 
OF
((uL⁄g 
adÀr
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1600 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32
 
OF
((uL⁄g 
¸c
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1633 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
,

1634 c⁄° *
vîsi⁄
, 
°ªam_size
));

1635 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
,

1636 c⁄° *
vîsi⁄
, 
°ªam_size
));

1637 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
, 
mëhod
,

1638 
wödowBôs
, 
memLevñ
,

1639 
°øãgy
, c⁄° *
vîsi⁄
,

1640 
°ªam_size
));

1641 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1642 c⁄° *
vîsi⁄
, 
°ªam_size
));

1643 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackInô_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1644 
FAR
 *
wödow
,

1645 c⁄° *
vîsi⁄
,

1646 
°ªam_size
));

1647 
	#deÊ©eInô
(
°rm
, 
Àvñ
) \

1648 
	`deÊ©eInô_
((
°rm
), (
Àvñ
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1649 
	#öÊ©eInô
(
°rm
) \

1650 
	`öÊ©eInô_
((
°rm
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1651 
	#deÊ©eInô2
(
°rm
, 
Àvñ
, 
mëhod
, 
wödowBôs
, 
memLevñ
, 
°øãgy
) \

1652 
	`deÊ©eInô2_
((
°rm
),(
Àvñ
),(
mëhod
),(
wödowBôs
),(
memLevñ
),\

1653 (
°øãgy
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1654 
	#öÊ©eInô2
(
°rm
, 
wödowBôs
) \

1655 
	`öÊ©eInô2_
((
°rm
), (
wödowBôs
), 
ZLIB_VERSION
, \

1656 ()(
z_°ªam
))

	)

1657 
	#öÊ©eBackInô
(
°rm
, 
wödowBôs
, 
wödow
) \

1658 
	`öÊ©eBackInô_
((
°rm
), (
wödowBôs
), (
wödow
), \

1659 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1661 #i‚de‡
Z_SOLO


1670 
	sgzFûe_s
 {

1671 
have
;

1672 *
√xt
;

1673 
z_off64_t
 
pos
;

1675 
ZEXTERN
 
ZEXPORT
 
gzgëc_
 
OF
((
gzFûe
 
fûe
));

1676 #ifde‡
Z_PREFIX_SET


1677 #unde‡
z_gzgëc


1678 
	#z_gzgëc
(
g
) \

1679 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
√xt
)++Ë: 
	`gzgëc
(g))

	)

1681 
	#gzgëc
(
g
) \

1682 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
√xt
)++Ë: 
	`gzgëc
(g))

	)

1691 #ifde‡
Z_LARGE64


1692 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í64
 
OF
((const *, const *));

1693 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFûe
, z_off64_t, ));

1694 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzãŒ64
 
OF
((
gzFûe
));

1695 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFûe
));

1696 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off64_t
));

1697 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off64_t
));

1700 #i‡!
deföed
(
ZLIB_INTERNAL
Ë&& deföed(
Z_WANT64
)

1701 #ifde‡
Z_PREFIX_SET


1702 
	#z_gz›í
 
z_gz›í64


	)

1703 
	#z_gz£ek
 
z_gz£ek64


	)

1704 
	#z_gzãŒ
 
z_gzãŒ64


	)

1705 
	#z_gzoff£t
 
z_gzoff£t64


	)

1706 
	#z_adÀr32_comböe
 
z_adÀr32_comböe64


	)

1707 
	#z_¸c32_comböe
 
z_¸c32_comböe64


	)

1709 
	#gz›í
 
gz›í64


	)

1710 
	#gz£ek
 
gz£ek64


	)

1711 
	#gzãŒ
 
gzãŒ64


	)

1712 
	#gzoff£t
 
gzoff£t64


	)

1713 
	#adÀr32_comböe
 
adÀr32_comböe64


	)

1714 
	#¸c32_comböe
 
¸c32_comböe64


	)

1716 #i‚de‡
Z_LARGE64


1717 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í64
 
OF
((const *, const *));

1718 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFûe
, z_off_t, ));

1719 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ64
 
OF
((
gzFûe
));

1720 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFûe
));

1721 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1722 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1725 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í
 
OF
((const *, const *));

1726 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFûe
, z_off_t, ));

1727 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ
 
OF
((
gzFûe
));

1728 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t
 
OF
((
gzFûe
));

1729 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1730 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1735 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1736 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1741 #i‡!
deföed
(
ZUTIL_H
Ë&& !deföed(
NO_DUMMY_DECL
)

1742 
	söã∫Æ_°©e
 {
dummy
;};

1746 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zEº‹
 
OF
(());

1747 
ZEXTERN
 
ZEXPORT
 
öÊ©eSyncPoöt
 
OF
((
z_°ªamp
));

1748 
ZEXTERN
 c⁄° 
z_¸c_t
 
FAR
 * 
ZEXPORT
 
gë_¸c_èbÀ
 
OF
(());

1749 
ZEXTERN
 
ZEXPORT
 
öÊ©eUndîmöe
 
OF
((
z_°ªamp
, ));

1750 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£tKìp
 
OF
((
z_°ªamp
));

1751 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£tKìp
 
OF
((
z_°ªamp
));

1752 #i‡
deföed
(
_WIN32
Ë&& !deföed(
Z_SOLO
)

1753 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í_w
 
OF
((c⁄° 
wch¨_t
 *
∑th
,

1754 c⁄° *
mode
));

1756 #i‡
deföed
(
STDC
Ë|| deföed(
Z_HAVE_STDARG_H
)

1757 #i‚de‡
Z_SOLO


1758 
ZEXTERN
 
ZEXPORTVA
 
gzv¥ötf
 
Z_ARG
((
gzFûe
 
fûe
,

1759 c⁄° *
f‹m©
,

1760 
va_li°
 
va
));

1764 #ifde‡
__˝lu•lus


	@/usr/include/alloca.h

18 #i‚def 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde‡
Æloˇ


32 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

34 #ifdef 
__GNUC__


35 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

38 
__END_DECLS


	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bôs/ídün.h
>

40 #i‚de‡
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

53 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

58 #i‡
deföed
 
__USE_MISC
 && !deföed 
__ASSEMBLER__


60 
	~<bôs/byãsw≠.h
>

62 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

64 
	#htﬁe16
(
x
Ë(x)

	)

65 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

66 
	#À16toh
(
x
Ë(x)

	)

68 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

69 
	#htﬁe32
(
x
Ë(x)

	)

70 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

71 
	#À32toh
(
x
Ë(x)

	)

73 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

74 
	#htﬁe64
(
x
Ë(x)

	)

75 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

76 
	#À64toh
(
x
Ë(x)

	)

79 
	#htobe16
(
x
Ë(x)

	)

80 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

81 
	#be16toh
(
x
Ë(x)

	)

82 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

84 
	#htobe32
(
x
Ë(x)

	)

85 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

86 
	#be32toh
(
x
Ë(x)

	)

87 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

89 
	#htobe64
(
x
Ë(x)

	)

90 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

91 
	#be64toh
(
x
Ë(x)

	)

92 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #unde‡
__USE_ISOC11


98 #unde‡
__USE_ISOC99


99 #unde‡
__USE_ISOC95


100 #unde‡
__USE_ISOCXX11


101 #unde‡
__USE_POSIX


102 #unde‡
__USE_POSIX2


103 #unde‡
__USE_POSIX199309


104 #unde‡
__USE_POSIX199506


105 #unde‡
__USE_XOPEN


106 #unde‡
__USE_XOPEN_EXTENDED


107 #unde‡
__USE_UNIX98


108 #unde‡
__USE_XOPEN2K


109 #unde‡
__USE_XOPEN2KXSI


110 #unde‡
__USE_XOPEN2K8


111 #unde‡
__USE_XOPEN2K8XSI


112 #unde‡
__USE_LARGEFILE


113 #unde‡
__USE_LARGEFILE64


114 #unde‡
__USE_FILE_OFFSET64


115 #unde‡
__USE_MISC


116 #unde‡
__USE_ATFILE


117 #unde‡
__USE_GNU


118 #unde‡
__USE_REENTRANT


119 #unde‡
__USE_FORTIFY_LEVEL


120 #unde‡
__KERNEL_STRICT_NAMES


124 #i‚de‡
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

137 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

146 #i‡(
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE
) \

147 && !
deföed
 
	g_DEFAULT_SOURCE


152 #unde‡
_DEFAULT_SOURCE


153 
	#_DEFAULT_SOURCE
 1

	)

157 #ifde‡
_GNU_SOURCE


158 #unde‡
_ISOC95_SOURCE


159 
	#_ISOC95_SOURCE
 1

	)

160 #unde‡
_ISOC99_SOURCE


161 
	#_ISOC99_SOURCE
 1

	)

162 #unde‡
_ISOC11_SOURCE


163 
	#_ISOC11_SOURCE
 1

	)

164 #unde‡
_POSIX_SOURCE


165 
	#_POSIX_SOURCE
 1

	)

166 #unde‡
_POSIX_C_SOURCE


167 
	#_POSIX_C_SOURCE
 200809L

	)

168 #unde‡
_XOPEN_SOURCE


169 
	#_XOPEN_SOURCE
 700

	)

170 #unde‡
_XOPEN_SOURCE_EXTENDED


171 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

172 #unde‡
_LARGEFILE64_SOURCE


173 
	#_LARGEFILE64_SOURCE
 1

	)

174 #unde‡
_DEFAULT_SOURCE


175 
	#_DEFAULT_SOURCE
 1

	)

176 #unde‡
_ATFILE_SOURCE


177 
	#_ATFILE_SOURCE
 1

	)

182 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

183 || (!
deföed
 
	g__STRICT_ANSI__
 \

184 && !
deföed
 
	g_ISOC99_SOURCE
 \

185 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

186 && !
deföed
 
	g_XOPEN_SOURCE
))

187 #unde‡
_DEFAULT_SOURCE


188 
	#_DEFAULT_SOURCE
 1

	)

192 #i‡(
deföed
 
_ISOC11_SOURCE
 \

193 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

194 
	#__USE_ISOC11
 1

	)

198 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

199 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

200 
	#__USE_ISOC99
 1

	)

204 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

205 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

206 
	#__USE_ISOC95
 1

	)

213 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

214 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

215 
	#__USE_ISOCXX11
 1

	)

221 #ifde‡
_DEFAULT_SOURCE


222 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


223 
	#__USE_POSIX_IMPLICITLY
 1

	)

225 #unde‡
_POSIX_SOURCE


226 
	#_POSIX_SOURCE
 1

	)

227 #unde‡
_POSIX_C_SOURCE


228 
	#_POSIX_C_SOURCE
 200809L

	)

230 #i‡((!
deföed
 
__STRICT_ANSI__
 \

231 || (
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

232 && !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

233 
	#_POSIX_SOURCE
 1

	)

234 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

235 
	#_POSIX_C_SOURCE
 2

	)

236 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

237 
	#_POSIX_C_SOURCE
 199506L

	)

238 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

239 
	#_POSIX_C_SOURCE
 200112L

	)

241 
	#_POSIX_C_SOURCE
 200809L

	)

243 
	#__USE_POSIX_IMPLICITLY
 1

	)

246 #i‡(
deföed
 
_POSIX_SOURCE
 \

247 || (
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

248 || 
deföed
 
_XOPEN_SOURCE
)

249 
	#__USE_POSIX
 1

	)

252 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


253 
	#__USE_POSIX2
 1

	)

256 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

257 
	#__USE_POSIX199309
 1

	)

260 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

261 
	#__USE_POSIX199506
 1

	)

264 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

265 
	#__USE_XOPEN2K
 1

	)

266 #unde‡
__USE_ISOC95


267 
	#__USE_ISOC95
 1

	)

268 #unde‡
__USE_ISOC99


269 
	#__USE_ISOC99
 1

	)

272 #i‡
deföed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

273 
	#__USE_XOPEN2K8
 1

	)

274 #unde‡
_ATFILE_SOURCE


275 
	#_ATFILE_SOURCE
 1

	)

278 #ifdef 
_XOPEN_SOURCE


279 
	#__USE_XOPEN
 1

	)

280 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

281 
	#__USE_XOPEN_EXTENDED
 1

	)

282 
	#__USE_UNIX98
 1

	)

283 #unde‡
_LARGEFILE_SOURCE


284 
	#_LARGEFILE_SOURCE
 1

	)

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

286 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

287 
	#__USE_XOPEN2K8
 1

	)

288 
	#__USE_XOPEN2K8XSI
 1

	)

290 
	#__USE_XOPEN2K
 1

	)

291 
	#__USE_XOPEN2KXSI
 1

	)

292 #unde‡
__USE_ISOC95


293 
	#__USE_ISOC95
 1

	)

294 #unde‡
__USE_ISOC99


295 
	#__USE_ISOC99
 1

	)

298 #ifde‡
_XOPEN_SOURCE_EXTENDED


299 
	#__USE_XOPEN_EXTENDED
 1

	)

304 #ifde‡
_LARGEFILE_SOURCE


305 
	#__USE_LARGEFILE
 1

	)

308 #ifde‡
_LARGEFILE64_SOURCE


309 
	#__USE_LARGEFILE64
 1

	)

312 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

313 
	#__USE_FILE_OFFSET64
 1

	)

316 #i‡
deföed
 
_DEFAULT_SOURCE


317 
	#__USE_MISC
 1

	)

320 #ifdef 
_ATFILE_SOURCE


321 
	#__USE_ATFILE
 1

	)

324 #ifdef 
_GNU_SOURCE


325 
	#__USE_GNU
 1

	)

328 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


329 
	#__USE_REENTRANT
 1

	)

332 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

333 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

334 #i‡
_FORTIFY_SOURCE
 > 1

335 
	#__USE_FORTIFY_LEVEL
 2

	)

337 
	#__USE_FORTIFY_LEVEL
 1

	)

340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<°dc-¥edef.h
>

353 #unde‡
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 23

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

362 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

365 #i‚de‡
__ASSEMBLER__


366 #i‚de‡
_SYS_CDEFS_H


367 
	~<sys/cdefs.h
>

372 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


373 
	#__USE_LARGEFILE
 1

	)

374 
	#__USE_LARGEFILE64
 1

	)

380 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

381 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

382 && 
deföed
 
	g__exã∫_ölöe


383 
	#__USE_EXTERN_INLINES
 1

	)

391 
	~<gnu/°ubs.h
>

	@/usr/include/libio.h

28 #i‚de‡
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_c⁄fig.h
>

33 
	#_IO_Âos_t
 
_G_Âos_t


	)

34 
	#_IO_Âos64_t
 
_G_Âos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_ic⁄v_t
 
_G_ic⁄v_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li°
 
_G_va_li°


	)

45 
	#_IO_wöt_t
 
wöt_t


	)

48 
	#__√ed___va_li°


	)

49 
	~<°d¨g.h
>

50 #ifde‡
__GNUC_VA_LIST


51 #unde‡
_IO_va_li°


52 
	#_IO_va_li°
 
__gnuc_va_li°


	)

55 #i‚de‡
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #i‚de‡
EOF


62 
	#EOF
 (-1)

	)

64 #i‚de‡
NULL


65 #i‡
deföed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuŒ
)

	)

69 #i‡!
deföed
(
__˝lu•lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifde‡
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifde‡
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifde‡
_IO_MTSAFE_IO


150 
	t_IO_lock_t
;

156 
	s_IO_m¨kî
 {

157 
_IO_m¨kî
 *
	m_√xt
;

158 
_IO_FILE
 *
	m_sbuf
;

162 
	m_pos
;

164 
£t_°ªampos
(
°ªampos
 
•
Ë{ 
	m_•os
 = sp; }

165 
£t_off£t
(
off£t
Ë{ 
	m_pos
 = off£t; 
	m_•os
 = (
°ªampos
)(-2); }

166 
	mpublic
:

167 
°ªamm¨kî
(
°ªambuf
 *
sb
);

168 ~
°ªamm¨kî
();

169 
ßvög
(Ë{  
	m_•os
 == -2; }

170 
dñè
(
°ªamm¨kî
&);

171 
dñè
();

176 
	e__codecvt_ªsu…


178 
	m__codecvt_ok
,

179 
	m__codecvt_∑πül
,

180 
	m__codecvt_îr‹
,

181 
	m__codecvt_noc⁄v


184 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


187 
	s_IO_codecvt


189 (*
	m__codecvt_de°r
Ë(
	m_IO_codecvt
 *);

190 
__codecvt_ªsu…
 (*
__codecvt_do_out
Ë(
	m_IO_codecvt
 *,

191 
	m__mb°©e_t
 *,

192 c⁄° 
	mwch¨_t
 *,

193 c⁄° 
	mwch¨_t
 *,

194 c⁄° 
	mwch¨_t
 **, *,

196 
__codecvt_ªsu…
 (*
__codecvt_do_unshi·
Ë(
	m_IO_codecvt
 *,

197 
	m__mb°©e_t
 *, *,

199 
__codecvt_ªsu…
 (*
__codecvt_do_ö
Ë(
	m_IO_codecvt
 *,

200 
	m__mb°©e_t
 *,

202 c⁄° **, 
	mwch¨_t
 *,

203 
	mwch¨_t
 *, wchar_t **);

204 (*
	m__codecvt_do_ícodög
Ë(
	m_IO_codecvt
 *);

205 (*
	m__codecvt_do_Æways_noc⁄v
Ë(
	m_IO_codecvt
 *);

206 (*
	m__codecvt_do_Àngth
Ë(
	m_IO_codecvt
 *, 
	m__mb°©e_t
 *,

207 c⁄° *, c⁄° *, 
	m_IO_size_t
);

208 (*
	m__codecvt_do_max_Àngth
Ë(
	m_IO_codecvt
 *);

210 
_IO_ic⁄v_t
 
	m__cd_ö
;

211 
_IO_ic⁄v_t
 
	m__cd_out
;

215 
	s_IO_wide_d©a


217 
wch¨_t
 *
	m_IO_ªad_±r
;

218 
wch¨_t
 *
	m_IO_ªad_íd
;

219 
wch¨_t
 *
	m_IO_ªad_ba£
;

220 
wch¨_t
 *
	m_IO_wrôe_ba£
;

221 
wch¨_t
 *
	m_IO_wrôe_±r
;

222 
wch¨_t
 *
	m_IO_wrôe_íd
;

223 
wch¨_t
 *
	m_IO_buf_ba£
;

224 
wch¨_t
 *
	m_IO_buf_íd
;

226 
wch¨_t
 *
	m_IO_ßve_ba£
;

227 
wch¨_t
 *
	m_IO_backup_ba£
;

229 
wch¨_t
 *
	m_IO_ßve_íd
;

231 
__mb°©e_t
 
	m_IO_°©e
;

232 
__mb°©e_t
 
	m_IO_œ°_°©e
;

233 
_IO_codecvt
 
	m_codecvt
;

235 
wch¨_t
 
	m_sh‹tbuf
[1];

237 c⁄° 
_IO_jump_t
 *
	m_wide_vèbÀ
;

241 
	s_IO_FILE
 {

242 
	m_Êags
;

243 
	#_IO_fûe_Êags
 
_Êags


	)

247 * 
	m_IO_ªad_±r
;

248 * 
	m_IO_ªad_íd
;

249 * 
	m_IO_ªad_ba£
;

250 * 
	m_IO_wrôe_ba£
;

251 * 
	m_IO_wrôe_±r
;

252 * 
	m_IO_wrôe_íd
;

253 * 
	m_IO_buf_ba£
;

254 * 
	m_IO_buf_íd
;

256 *
	m_IO_ßve_ba£
;

257 *
	m_IO_backup_ba£
;

258 *
	m_IO_ßve_íd
;

260 
_IO_m¨kî
 *
	m_m¨kîs
;

262 
_IO_FILE
 *
	m_chaö
;

264 
	m_fûío
;

266 
	m_blksize
;

268 
	m_Êags2
;

270 
_IO_off_t
 
	m_ﬁd_off£t
;

272 
	#__HAVE_COLUMN


	)

274 
	m_cur_cﬁumn
;

275 sig√d 
	m_vèbÀ_off£t
;

276 
	m_sh‹tbuf
[1];

280 
_IO_lock_t
 *
	m_lock
;

281 #ifde‡
_IO_USE_OLD_IO_FILE


284 
	s_IO_FILE_com∂ëe


286 
_IO_FILE
 
	m_fûe
;

288 #i‡
deföed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

289 
_IO_off64_t
 
	m_off£t
;

290 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


292 
_IO_codecvt
 *
	m_codecvt
;

293 
_IO_wide_d©a
 *
	m_wide_d©a
;

294 
_IO_FILE
 *
	m_‰ìªs_li°
;

295 *
	m_‰ìªs_buf
;

297 *
	m__∑d1
;

298 *
	m__∑d2
;

299 *
	m__∑d3
;

300 *
	m__∑d4
;

302 
size_t
 
	m__∑d5
;

303 
	m_mode
;

305 
	m_unu£d2
[15 *  (Ë- 4 *  (*Ë-  (
size_t
)];

309 #i‚de‡
__˝lu•lus


310 
_IO_FILE
 
	t_IO_FILE
;

313 
	g_IO_FILE_∂us
;

315 
_IO_FILE_∂us
 
_IO_2_1_°dö_
;

316 
_IO_FILE_∂us
 
_IO_2_1_°dout_
;

317 
_IO_FILE_∂us
 
_IO_2_1_°dîr_
;

318 #i‚de‡
_LIBC


319 
	#_IO_°dö
 ((
_IO_FILE
*)(&
_IO_2_1_°dö_
))

	)

320 
	#_IO_°dout
 ((
_IO_FILE
*)(&
_IO_2_1_°dout_
))

	)

321 
	#_IO_°dîr
 ((
_IO_FILE
*)(&
_IO_2_1_°dîr_
))

	)

323 
_IO_FILE
 *
_IO_°dö
 
©åibuã_hiddí
;

324 
_IO_FILE
 *
_IO_°dout
 
©åibuã_hiddí
;

325 
_IO_FILE
 *
_IO_°dîr
 
©åibuã_hiddí
;

333 
__ssize_t
 
	t__io_ªad_‚
 (*
	t__cookõ
, *
	t__buf
, 
	tsize_t
 
	t__nbyãs
);

341 
__ssize_t
 
	t__io_wrôe_‚
 (*
	t__cookõ
, c⁄° *
	t__buf
,

342 
	tsize_t
 
	t__n
);

350 
	t__io_£ek_‚
 (*
	t__cookõ
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

353 
	t__io_˛o£_‚
 (*
	t__cookõ
);

356 #ifde‡
_GNU_SOURCE


358 
__io_ªad_‚
 
	tcookõ_ªad_fun˘i⁄_t
;

359 
__io_wrôe_‚
 
	tcookõ_wrôe_fun˘i⁄_t
;

360 
__io_£ek_‚
 
	tcookõ_£ek_fun˘i⁄_t
;

361 
__io_˛o£_‚
 
	tcookõ_˛o£_fun˘i⁄_t
;

366 
__io_ªad_‚
 *
	mªad
;

367 
__io_wrôe_‚
 *
	mwrôe
;

368 
__io_£ek_‚
 *
	m£ek
;

369 
__io_˛o£_‚
 *
	m˛o£
;

370 } 
	t_IO_cookõ_io_fun˘i⁄s_t
;

371 
_IO_cookõ_io_fun˘i⁄s_t
 
	tcookõ_io_fun˘i⁄s_t
;

373 
	g_IO_cookõ_fûe
;

376 
_IO_cookõ_öô
 (
_IO_cookõ_fûe
 *
__cfûe
, 
__ªad_wrôe
,

377 *
__cookõ
, 
_IO_cookõ_io_fun˘i⁄s_t
 
__‚s
);

381 #ifde‡
__˝lu•lus


385 
__undîÊow
 (
_IO_FILE
 *);

386 
__uÊow
 (
_IO_FILE
 *);

387 
__ovîÊow
 (
_IO_FILE
 *, );

388 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


389 
_IO_wöt_t
 
__wundîÊow
 (
_IO_FILE
 *);

390 
_IO_wöt_t
 
__wuÊow
 (
_IO_FILE
 *);

391 
_IO_wöt_t
 
__wovîÊow
 (
_IO_FILE
 *, _IO_wint_t);

394 #i‡ 
__GNUC__
 >= 3

395 
	#_IO_BE
(
ex¥
, 
ªs
Ë
	`__buûtö_ex≥˘
 (”x¥),Ñes)

	)

397 
	#_IO_BE
(
ex¥
, 
ªs
Ë”x¥)

	)

400 
	#_IO_gëc_u∆ocked
(
_Â
) \

401 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

402 ? 
	`__uÊow
 (
_Â
Ë: *(*Ë(_Â)->
_IO_ªad_±r
++)

	)

403 
	#_IO_≥ekc_u∆ocked
(
_Â
) \

404 (
	`_IO_BE
 ((
_Â
)->
_IO_ªad_±r
 >(_Â)->
_IO_ªad_íd
, 0) \

405 && 
	`__undîÊow
 (
_Â
Ë=
EOF
 ? EOF \

406 : *(*Ë(
_Â
)->
_IO_ªad_±r
)

	)

407 
	#_IO_putc_u∆ocked
(
_ch
, 
_Â
) \

408 (
	`_IO_BE
 ((
_Â
)->
_IO_wrôe_±r
 >(_Â)->
_IO_wrôe_íd
, 0) \

409 ? 
	`__ovîÊow
 (
_Â
, (Ë(
_ch
)) \

410 : (Ë(*(
_Â
)->
_IO_wrôe_±r
++ = (
_ch
)))

	)

412 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


413 
	#_IO_gëwc_u∆ocked
(
_Â
) \

414 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

415 || ((
_Â
)->
_wide_d©a
->
_IO_ªad_±r
 \

416 >(
_Â
)->
_wide_d©a
->
_IO_ªad_íd
), 0) \

417 ? 
	`__wuÊow
 (
_Â
Ë: (
_IO_wöt_t
Ë*(_Â)->
_wide_d©a
->
_IO_ªad_±r
++)

	)

418 
	#_IO_putwc_u∆ocked
(
_wch
, 
_Â
) \

419 (
	`_IO_BE
 ((
_Â
)->
_wide_d©a
 =
NULL
 \

420 || ((
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
 \

421 >(
_Â
)->
_wide_d©a
->
_IO_wrôe_íd
), 0) \

422 ? 
	`__wovîÊow
 (
_Â
, 
_wch
) \

423 : (
_IO_wöt_t
Ë(*(
_Â
)->
_wide_d©a
->
_IO_wrôe_±r
++ = (
_wch
)))

	)

426 
	#_IO_„of_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_EOF_SEEN
Ë!0)

	)

427 
	#_IO_„º‹_u∆ocked
(
__Â
Ë(((__Â)->
_Êags
 & 
_IO_ERR_SEEN
Ë!0)

	)

429 
_IO_gëc
 (
_IO_FILE
 *
__Â
);

430 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__Â
);

431 
_IO_„of
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

432 
_IO_„º‹
 (
_IO_FILE
 *
__Â
Ë
__THROW
;

434 
_IO_≥ekc_locked
 (
_IO_FILE
 *
__Â
);

437 
	#_IO_PENDING_OUTPUT_COUNT
(
_Â
) \

438 ((
_Â
)->
_IO_wrôe_±r
 - (_Â)->
_IO_wrôe_ba£
)

	)

440 
_IO_Êockfûe
 (
_IO_FILE
 *Ë
__THROW
;

441 
_IO_fu∆ockfûe
 (
_IO_FILE
 *Ë
__THROW
;

442 
_IO_·rylockfûe
 (
_IO_FILE
 *Ë
__THROW
;

444 #ifde‡
_IO_MTSAFE_IO


445 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_locked
 (_Â)

	)

446 
	#_IO_Êockfûe
(
_Â
) \

447 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_Êockfûe
 (_Â)

	)

448 
	#_IO_fu∆ockfûe
(
_Â
) \

449 i‡(((
_Â
)->
_Êags
 & 
_IO_USER_LOCK
Ë=0Ë
	`_IO_fu∆ockfûe
 (_Â)

	)

451 
	#_IO_≥ekc
(
_Â
Ë
	`_IO_≥ekc_u∆ocked
 (_Â)

	)

452 
	#_IO_Êockfûe
(
_Â
Ë

	)

453 
	#_IO_fu∆ockfûe
(
_Â
Ë

	)

454 
	#_IO_·rylockfûe
(
_Â
Ë

	)

455 
	#_IO_˛ónup_ªgi⁄_°¨t
(
_f˘
, 
_Â
Ë

	)

456 
	#_IO_˛ónup_ªgi⁄_íd
(
_Doô
Ë

	)

459 
_IO_vfsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, const * __restrict,

460 
_IO_va_li°
, *
__ª°ri˘
);

461 
_IO_vÂrötf
 (
_IO_FILE
 *
__ª°ri˘
, const *__restrict,

462 
_IO_va_li°
);

463 
_IO_ssize_t
 
_IO_∑dn
 (
_IO_FILE
 *, , _IO_ssize_t);

464 
_IO_size_t
 
_IO_sgën
 (
_IO_FILE
 *, *, _IO_size_t);

466 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

467 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

469 
_IO_‰ì_backup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

471 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


472 
_IO_wöt_t
 
_IO_gëwc
 (
_IO_FILE
 *
__Â
);

473 
_IO_wöt_t
 
_IO_putwc
 (
wch¨_t
 
__wc
, 
_IO_FILE
 *
__Â
);

474 
_IO_fwide
 (
_IO_FILE
 *
__Â
, 
__mode
Ë
__THROW
;

475 #i‡
__GNUC__
 >= 2

478 #i‡
deföed
 
_LIBC
 && deföed 
SHARED


479 
	~<shlib-com∑t.h
>

480 #i‡
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

481 
	#_IO_fwide_maybe_öcom∑tibÀ
 \

482 (
	`__buûtö_ex≥˘
 (&
_IO_°dö_u£d
 =
NULL
, 0))

	)

483 c⁄° 
_IO_°dö_u£d
;

484 
wók_exã∫
 (
_IO_°dö_u£d
);

487 #i‚de‡
_IO_fwide_maybe_öcom∑tibÀ


488 
	#_IO_fwide_maybe_öcom∑tibÀ
 (0)

	)

492 
	#_IO_fwide
(
__Â
, 
__mode
) \

493 ({ 
__ªsu…
 = (
__mode
); \

494 i‡(
__ªsu…
 < 0 && ! 
_IO_fwide_maybe_öcom∑tibÀ
) \

496 i‡((
__Â
)->
_mode
 == 0) \

498 (
__Â
)->
_mode
 = -1; \

499 
__ªsu…
 = (
__Â
)->
_mode
; \

501 i‡(
	`__buûtö_c⁄°™t_p
 (
__mode
) && (__mode) == 0) \

502 
__ªsu…
 = 
_IO_fwide_maybe_öcom∑tibÀ
 ? -1 : (
__Â
)->
_mode
; \

504 
__ªsu…
 = 
	`_IO_fwide
 (
__Â
, __result); \

505 
__ªsu…
; })

	)

508 
_IO_vfwsˇnf
 (
_IO_FILE
 * 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict,

509 
_IO_va_li°
, *
__ª°ri˘
);

510 
_IO_vfw¥ötf
 (
_IO_FILE
 *
__ª°ri˘
, c⁄° 
wch¨_t
 *__restrict,

511 
_IO_va_li°
);

512 
_IO_ssize_t
 
_IO_w∑dn
 (
_IO_FILE
 *, 
wöt_t
, _IO_ssize_t);

513 
_IO_‰ì_wbackup_¨ó
 (
_IO_FILE
 *Ë
__THROW
;

516 #ifde‡
__LDBL_COMPAT


517 
	~<bôs/libio-ldbl.h
>

520 #ifde‡
__˝lu•lus


	@/usr/include/netinet/in.h

18 #i‚def 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<„©uªs.h
>

22 
	~<°döt.h
>

23 
	~<sys/sockë.h
>

24 
	~<bôs/ty≥s.h
>

27 
__BEGIN_DECLS


30 
uöt32_t
 
	tö_addr_t
;

31 
	sö_addr


33 
ö_addr_t
 
	ms_addr
;

37 
	~<bôs/ö.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #i‚de‡
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
uöt16_t
 
	tö_p‹t_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
Ë((((
ö_addr_t
)◊)Ë& 0x80000000Ë=0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffff‡& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xc0000000Ë=0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffff‡& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffff‡& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
Ë
	`IN_CLASSD
◊)

	)

186 
	#IN_EXPERIMENTAL
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xe0000000Ë=0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
Ë((((
ö_addr_t
)◊)Ë& 0xf0000000Ë=0xf0000000)

	)

190 
	#INADDR_ANY
 ((
ö_addr_t
Ë0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
ö_addr_t
Ë0xffffffff)

	)

194 
	#INADDR_NONE
 ((
ö_addr_t
Ë0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #i‚de‡
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
ö_addr_t
Ë0x7f000001Ë

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
ö_addr_t
Ë0xe0000000Ë

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
ö_addr_t
Ë0xe0000001Ë

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
ö_addr_t
Ë0xe0000002Ë

	)

207 
	#INADDR_MAX_LOCAL_GROUP
 ((
ö_addr_t
Ë0xe00000ffË

	)

209 #i‚de‡
__USE_KERNEL_IPV6_DEFS


211 
	sö6_addr


215 
uöt8_t
 
	m__u6_addr8
[16];

216 #ifde‡
__USE_MISC


217 
uöt16_t
 
	m__u6_addr16
[8];

218 
uöt32_t
 
	m__u6_addr32
[4];

220 } 
	m__ö6_u
;

221 
	#s6_addr
 
__ö6_u
.
__u6_addr8


	)

222 #ifde‡
__USE_MISC


223 
	#s6_addr16
 
__ö6_u
.
__u6_addr16


	)

224 
	#s6_addr32
 
__ö6_u
.
__u6_addr32


	)

229 c⁄° 
ö6_addr
 
ö6addr_™y
;

230 c⁄° 
ö6_addr
 
ö6addr_lo›back
;

231 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

232 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

234 
	#INET_ADDRSTRLEN
 16

	)

235 
	#INET6_ADDRSTRLEN
 46

	)

239 
	ssockaddr_ö


241 
__SOCKADDR_COMMON
 (
sö_
);

242 
ö_p‹t_t
 
	msö_p‹t
;

243 
ö_addr
 
	msö_addr
;

246 
	msö_zîo
[ (
sockaddr
) -

247 
__SOCKADDR_COMMON_SIZE
 -

248  (
ö_p‹t_t
) -

249  (
ö_addr
)];

252 #i‚de‡
__USE_KERNEL_IPV6_DEFS


254 
	ssockaddr_ö6


256 
__SOCKADDR_COMMON
 (
sö6_
);

257 
ö_p‹t_t
 
	msö6_p‹t
;

258 
uöt32_t
 
	msö6_Êowöfo
;

259 
ö6_addr
 
	msö6_addr
;

260 
uöt32_t
 
	msö6_sc›e_id
;

264 #ifde‡
__USE_MISC


266 
	sù_mªq


269 
ö_addr
 
	mimr_mu…üddr
;

272 
ö_addr
 
	mimr_öãrÁ˚
;

275 
	sù_mªq_sour˚


278 
ö_addr
 
	mimr_mu…üddr
;

281 
ö_addr
 
	mimr_öãrÁ˚
;

284 
ö_addr
 
	mimr_sour˚addr
;

288 #i‚de‡
__USE_KERNEL_IPV6_DEFS


290 
	sùv6_mªq


293 
ö6_addr
 
	mùv6mr_mu…üddr
;

296 
	mùv6mr_öãrÁ˚
;

300 #ifde‡
__USE_MISC


302 
	sgroup_ªq


305 
uöt32_t
 
	mgr_öãrÁ˚
;

308 
sockaddr_°‹age
 
	mgr_group
;

311 
	sgroup_sour˚_ªq


314 
uöt32_t
 
	mg§_öãrÁ˚
;

317 
sockaddr_°‹age
 
	mg§_group
;

320 
sockaddr_°‹age
 
	mg§_sour˚
;

325 
	sù_msfûãr


328 
ö_addr
 
	mimsf_mu…üddr
;

331 
ö_addr
 
	mimsf_öãrÁ˚
;

334 
uöt32_t
 
	mimsf_fmode
;

337 
uöt32_t
 
	mimsf_num§c
;

339 
ö_addr
 
	mimsf_¶i°
[1];

342 
	#IP_MSFILTER_SIZE
(
num§c
Ë( (
ù_msfûãr
) \

343 -  (
ö_addr
) \

344 + (
num§c
Ë*  (
ö_addr
))

	)

346 
	sgroup_fûãr


349 
uöt32_t
 
	mgf_öãrÁ˚
;

352 
sockaddr_°‹age
 
	mgf_group
;

355 
uöt32_t
 
	mgf_fmode
;

358 
uöt32_t
 
	mgf_num§c
;

360 
sockaddr_°‹age
 
	mgf_¶i°
[1];

363 
	#GROUP_FILTER_SIZE
(
num§c
Ë( (
group_fûãr
) \

364 -  (
sockaddr_°‹age
) \

365 + ((
num§c
) \

366 *  (
sockaddr_°‹age
)))

	)

376 
uöt32_t
 
	$¡ohl
 (
uöt32_t
 
__√é⁄g
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

377 
uöt16_t
 
	$¡ohs
 (
uöt16_t
 
__√tsh‹t
)

378 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

379 
uöt32_t
 
	$ht⁄l
 (
uöt32_t
 
__ho°l⁄g
)

380 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

381 
uöt16_t
 
	$ht⁄s
 (
uöt16_t
 
__ho°sh‹t
)

382 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

384 
	~<ídün.h
>

387 
	~<bôs/byãsw≠.h
>

389 #ifde‡
__OPTIMIZE__


393 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


396 
	#¡ohl
(
x
Ë(x)

	)

397 
	#¡ohs
(
x
Ë(x)

	)

398 
	#ht⁄l
(
x
Ë(x)

	)

399 
	#ht⁄s
(
x
Ë(x)

	)

401 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


402 
	#¡ohl
(
x
Ë
	`__bsw≠_32
 (x)

	)

403 
	#¡ohs
(
x
Ë
	`__bsw≠_16
 (x)

	)

404 
	#ht⁄l
(
x
Ë
	`__bsw≠_32
 (x)

	)

405 
	#ht⁄s
(
x
Ë
	`__bsw≠_16
 (x)

	)

410 #ifde‡
__GNUC__


411 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

412 (
__exãnsi⁄__
 \

413 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

414 
__a
->
s6_addr32
[0] == 0 \

415 && 
__a
->
s6_addr32
[1] == 0 \

416 && 
__a
->
s6_addr32
[2] == 0 \

417 && 
__a
->
s6_addr32
[3] =0; 
	}
}))

	)

419 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

420 (
__exãnsi⁄__
 \

421 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

422 
__a
->
s6_addr32
[0] == 0 \

423 && 
__a
->
s6_addr32
[1] == 0 \

424 && 
__a
->
s6_addr32
[2] == 0 \

425 && 
__a
->
s6_addr32
[3] =
	`ht⁄l
 (1); }))

	)

427 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

428 (
__exãnsi⁄__
 \

429 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

430 (
__a
->
s6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„800000); }))

	)

432 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

433 (
__exãnsi⁄__
 \

434 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

435 (
__a
->
s6_addr32
[0] & 
	`ht⁄l
 (0xffc00000)Ë=ht⁄»(0x„c00000); }))

	)

437 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

438 (
__exãnsi⁄__
 \

439 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

440 
__a
->
s6_addr32
[0] == 0 \

441 && 
__a
->
s6_addr32
[1] == 0 \

442 && 
__a
->
s6_addr32
[2] =
	`ht⁄l
 (0xffff); }))

	)

444 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

445 (
__exãnsi⁄__
 \

446 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

447 
__a
->
s6_addr32
[0] == 0 \

448 && 
__a
->
s6_addr32
[1] == 0 \

449 && 
__a
->
s6_addr32
[2] == 0 \

450 && 
	`¡ohl
 (
__a
->
s6_addr32
[3]Ë> 1; }))

	)

452 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

453 (
__exãnsi⁄__
 \

454 ({ c⁄° 
ö6_addr
 *
__a
 = (c⁄° ö6_add∏*Ë(
a
); \

455 c⁄° 
ö6_addr
 *
__b
 = (c⁄° ö6_add∏*Ë(
b
); \

456 
__a
->
s6_addr32
[0] =
__b
->s6_addr32[0] \

457 && 
__a
->
s6_addr32
[1] =
__b
->s6_addr32[1] \

458 && 
__a
->
s6_addr32
[2] =
__b
->s6_addr32[2] \

459 && 
__a
->
s6_addr32
[3] =
__b
->s6_addr32[3]; }))

	)

461 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

462 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

463 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

464 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

465 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =0)

	)

467 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

468 (((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0 \

469 && ((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0 \

470 && ((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0 \

471 && ((c⁄° 
uöt32_t
 *Ë(
a
))[3] =
	`ht⁄l
 (1))

	)

473 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

474 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

475 =
	`ht⁄l
 (0x„800000))

	)

477 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

478 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] & 
	`ht⁄l
 (0xffc00000)) \

479 =
	`ht⁄l
 (0x„c00000))

	)

481 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

482 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

483 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

484 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =
	`ht⁄l
 (0xffff)))

	)

486 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

487 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] == 0) \

488 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] == 0) \

489 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] == 0) \

490 && (
	`¡ohl
 (((c⁄° 
uöt32_t
 *Ë(
a
))[3]Ë> 1))

	)

492 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

493 ((((c⁄° 
uöt32_t
 *Ë(
a
))[0] =((c⁄° uöt32_à*Ë(
b
))[0]) \

494 && (((c⁄° 
uöt32_t
 *Ë(
a
))[1] =((c⁄° uöt32_à*Ë(
b
))[1]) \

495 && (((c⁄° 
uöt32_t
 *Ë(
a
))[2] =((c⁄° uöt32_à*Ë(
b
))[2]) \

496 && (((c⁄° 
uöt32_t
 *Ë(
a
))[3] =((c⁄° uöt32_à*Ë(
b
))[3]))

	)

499 
	#IN6_IS_ADDR_MULTICAST
(
a
Ë(((c⁄° 
uöt8_t
 *Ë◊))[0] =0xff)

	)

501 #ifde‡
__USE_MISC


503 
	$bödªsvp‹t
 (
__sockfd
, 
sockaddr_ö
 *
__sock_ö
Ë
__THROW
;

506 
	$bödªsvp‹t6
 (
__sockfd
, 
sockaddr_ö6
 *
__sock_ö
)

507 
__THROW
;

511 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

512 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

513 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x1))

	)

515 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

516 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

517 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x2))

	)

519 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

520 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

521 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x5))

	)

523 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

524 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

525 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0x8))

	)

527 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

528 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

529 && ((((c⁄° 
uöt8_t
 *Ë(
a
))[1] & 0xfË=0xe))

	)

532 #ifde‡
__USE_GNU


533 
cmsghdr
;

535 #i‚de‡
__USE_KERNEL_IPV6_DEFS


537 
	sö6_pktöfo


539 
ö6_addr
 
ùi6_addr
;

540 
ùi6_ifödex
;

544 
	sù6_mtuöfo


546 
sockaddr_ö6
 
ù6m_addr
;

547 
uöt32_t
 
ù6m_mtu
;

552 
	$öë6_›ti⁄_•a˚
 (
__nbyãs
)

553 
__THROW
 
__©åibuã_dïªˇãd__
;

554 
	$öë6_›ti⁄_öô
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

555 
__ty≥
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

556 
	$öë6_›ti⁄_≠≥nd
 (
cmsghdr
 *
__cmsg
,

557 c⁄° 
uöt8_t
 *
__ty≥p
, 
__mu…x
,

558 
__∂usy
Ë
__THROW
 
__©åibuã_dïªˇãd__
;

559 
uöt8_t
 *
	$öë6_›ti⁄_Æloc
 (
cmsghdr
 *
__cmsg
, 
__d©Æí
,

560 
__mu…x
, 
__∂usy
)

561 
__THROW
 
__©åibuã_dïªˇãd__
;

562 
	$öë6_›ti⁄_√xt
 (c⁄° 
cmsghdr
 *
__cmsg
,

563 
uöt8_t
 **
__çåp
)

564 
__THROW
 
__©åibuã_dïªˇãd__
;

565 
	$öë6_›ti⁄_föd
 (c⁄° 
cmsghdr
 *
__cmsg
,

566 
uöt8_t
 **
__çåp
, 
__ty≥
)

567 
__THROW
 
__©åibuã_dïªˇãd__
;

571 
	$öë6_›t_öô
 (*
__extbuf
, 
sockÀn_t
 
__exéí
Ë
__THROW
;

572 
	$öë6_›t_≠≥nd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

573 
uöt8_t
 
__ty≥
, 
sockÀn_t
 
__Àn
, uöt8_à
__Æign
,

574 **
__d©abuÂ
Ë
__THROW
;

575 
	$öë6_›t_föish
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
)

576 
__THROW
;

577 
	$öë6_›t_£t_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

578 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

579 
	$öë6_›t_√xt
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

580 
uöt8_t
 *
__ty≥p
, 
sockÀn_t
 *
__À≈
,

581 **
__d©abuÂ
Ë
__THROW
;

582 
	$öë6_›t_föd
 (*
__extbuf
, 
sockÀn_t
 
__exéí
, 
__off£t
,

583 
uöt8_t
 
__ty≥
, 
sockÀn_t
 *
__À≈
,

584 **
__d©abuÂ
Ë
__THROW
;

585 
	$öë6_›t_gë_vÆ
 (*
__d©abuf
, 
__off£t
, *
__vÆ
,

586 
sockÀn_t
 
__vÆÀn
Ë
__THROW
;

590 
sockÀn_t
 
	$öë6_πh_•a˚
 (
__ty≥
, 
__£gmíts
Ë
__THROW
;

591 *
	$öë6_πh_öô
 (*
__bp
, 
sockÀn_t
 
__bp_Àn
, 
__ty≥
,

592 
__£gmíts
Ë
__THROW
;

593 
	$öë6_πh_add
 (*
__bp
, c⁄° 
ö6_addr
 *
__addr
Ë
__THROW
;

594 
	$öë6_πh_ªvî£
 (c⁄° *
__ö
, *
__out
Ë
__THROW
;

595 
	$öë6_πh_£gmíts
 (c⁄° *
__bp
Ë
__THROW
;

596 
ö6_addr
 *
	$öë6_πh_gëaddr
 (c⁄° *
__bp
, 
__ödex
)

597 
__THROW
;

603 
	$gëùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

604 
ö_addr
 
__group
, 
uöt32_t
 *
__fmode
,

605 
uöt32_t
 *
__num§c
, 
ö_addr
 *
__¶i°
)

606 
__THROW
;

609 
	$£tùv4sour˚fûãr
 (
__s
, 
ö_addr
 
__öãrÁ˚_addr
,

610 
ö_addr
 
__group
, 
uöt32_t
 
__fmode
,

611 
uöt32_t
 
__num§c
,

612 c⁄° 
ö_addr
 *
__¶i°
)

613 
__THROW
;

617 
	$gësour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

618 c⁄° 
sockaddr
 *
__group
,

619 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 *
__fmode
,

620 
uöt32_t
 *
__num§c
,

621 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

624 
	$£tsour˚fûãr
 (
__s
, 
uöt32_t
 
__öãrÁ˚_addr
,

625 c⁄° 
sockaddr
 *
__group
,

626 
sockÀn_t
 
__grou∂í
, 
uöt32_t
 
__fmode
,

627 
uöt32_t
 
__num§c
,

628 c⁄° 
sockaddr_°‹age
 *
__¶i°
Ë
__THROW
;

631 
__END_DECLS


	@/usr/include/rpc/netdb.h

36 #i‚de‡
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<„©uªs.h
>

41 
	#__√ed_size_t


	)

42 
	~<°ddef.h
>

44 
__BEGIN_DECLS


46 
	sΩ˚¡


48 *
	mr_«me
;

49 **
	mr_Æü£s
;

50 
	mr_numbî
;

53 
	$£åp˚¡
 (
__°ay›í
Ë
__THROW
;

54 
	$ídΩ˚¡
 (Ë
__THROW
;

55 
Ω˚¡
 *
	$gëΩcby«me
 (c⁄° *
__«me
Ë
__THROW
;

56 
Ω˚¡
 *
	$gëΩcbynumbî
 (
__numbî
Ë
__THROW
;

57 
Ω˚¡
 *
	$gëΩ˚¡
 (Ë
__THROW
;

59 #ifde‡
__USE_MISC


60 
	$gëΩcby«me_r
 (c⁄° *
__«me
, 
Ω˚¡
 *
__ªsu…_buf
,

61 *
__buf„r
, 
size_t
 
__buÊí
,

62 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

64 
	$gëΩcbynumbî_r
 (
__numbî
, 
Ω˚¡
 *
__ªsu…_buf
,

65 *
__buf„r
, 
size_t
 
__buÊí
,

66 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

68 
	$gëΩ˚¡_r
 (
Ω˚¡
 *
__ªsu…_buf
, *
__buf„r
,

69 
size_t
 
__buÊí
, 
Ω˚¡
 **
__ªsu…
Ë
__THROW
;

72 
__END_DECLS


	@/usr/include/sched.h

19 #i‚def 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<„©uªs.h
>

25 
	~<bôs/ty≥s.h
>

27 
	#__√ed_size_t


	)

28 
	~<°ddef.h
>

30 #ifde‡
__USE_XOPEN2K


31 
	#__√ed_time_t


	)

32 
	#__√ed_time•ec


	)

34 
	~<time.h
>

36 #i‚de‡
__pid_t_deföed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_deföed


	)

43 
	~<bôs/sched.h
>

45 
	#sched_¥i‹ôy
 
__sched_¥i‹ôy


	)

48 
__BEGIN_DECLS


51 
	$sched_£ç¨am
 (
__pid_t
 
__pid
, c⁄° 
sched_∑øm
 *
__∑øm
)

52 
__THROW
;

55 
	$sched_gë∑øm
 (
__pid_t
 
__pid
, 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

58 
	$sched_£tscheduÀr
 (
__pid_t
 
__pid
, 
__pﬁicy
,

59 c⁄° 
sched_∑øm
 *
__∑øm
Ë
__THROW
;

62 
	$sched_gëscheduÀr
 (
__pid_t
 
__pid
Ë
__THROW
;

65 
	$sched_yõld
 (Ë
__THROW
;

68 
	$sched_gë_¥i‹ôy_max
 (
__Æg‹ôhm
Ë
__THROW
;

71 
	$sched_gë_¥i‹ôy_mö
 (
__Æg‹ôhm
Ë
__THROW
;

74 
	$sched_º_gë_öãrvÆ
 (
__pid_t
 
__pid
, 
time•ec
 *
__t
Ë
__THROW
;

77 #ifde‡
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
˝u
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

81 
	#CPU_CLR
(
˝u
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u,  (
˝u_£t_t
), cpu£ç)

	)

82 
	#CPU_ISSET
(
˝u
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (˝u,  (
˝u_£t_t
), \

83 
˝u£ç
)

	)

84 
	#CPU_ZERO
(
˝u£ç
Ë
	`__CPU_ZERO_S
 ( (
˝u_£t_t
), cpu£ç)

	)

85 
	#CPU_COUNT
(
˝u£ç
Ë
	`__CPU_COUNT_S
 ( (
˝u_£t_t
), cpu£ç)

	)

87 
	#CPU_SET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_SET_S
 (˝u, sësize, cpu£ç)

	)

88 
	#CPU_CLR_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_CLR_S
 (˝u, sësize, cpu£ç)

	)

89 
	#CPU_ISSET_S
(
˝u
, 
£tsize
, 
˝u£ç
Ë
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
˝u£ç
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_ZERO_S
 (£tsize, cpu£ç)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
˝u£ç
Ë
	`__CPU_COUNT_S
 (£tsize, cpu£ç)

	)

94 
	#CPU_EQUAL
(
˝u£ç1
, 
˝u£ç2
) \

95 
	`__CPU_EQUAL_S
 ( (
˝u_£t_t
), 
˝u£ç1
, 
˝u£ç2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
˝u£ç1
, 
˝u£ç2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
˝u£ç1
, 
˝u£ç2
)

	)

99 
	#CPU_AND
(
de°£t
, 
§c£t1
, 
§c£t2
) \

100 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

101 
	#CPU_OR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

102 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

103 
	#CPU_XOR
(
de°£t
, 
§c£t1
, 
§c£t2
) \

104 
	`__CPU_OP_S
 ( (
˝u_£t_t
), 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de°£t
, 
§c£t1
, 
§c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
cou¡
Ë
	`__CPU_ALLOC_SIZE
 (cou¡)

	)

113 
	#CPU_ALLOC
(
cou¡
Ë
	`__CPU_ALLOC
 (cou¡)

	)

114 
	#CPU_FREE
(
˝u£t
Ë
	`__CPU_FREE
 (˝u£t)

	)

118 
	$sched_£èfföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

119 c⁄° 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

122 
	$sched_gëafföôy
 (
__pid_t
 
__pid
, 
size_t
 
__˝u£tsize
,

123 
˝u_£t_t
 *
__˝u£t
Ë
__THROW
;

126 
__END_DECLS


	@/usr/include/xlocale.h

20 #i‚de‡
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loˇÀ_°ru˘


30 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

33 c⁄° *
	m__˘y≥_b
;

34 c⁄° *
	m__˘y≥_tﬁowî
;

35 c⁄° *
	m__˘y≥_touµî
;

38 c⁄° *
	m__«mes
[13];

39 } *
	t__loˇÀ_t
;

42 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/_G_config.h

4 #i‚de‡
_G_c⁄fig_h


5 
	#_G_c⁄fig_h
 1

	)

9 
	~<bôs/ty≥s.h
>

10 
	#__√ed_size_t


	)

11 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


12 
	#__√ed_wch¨_t


	)

14 
	#__√ed_NULL


	)

15 
	~<°ddef.h
>

16 
	#__√ed_mb°©e_t


	)

17 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


18 
	#__√ed_wöt_t


	)

20 
	~<wch¨.h
>

23 
__off_t
 
	m__pos
;

24 
__mb°©e_t
 
	m__°©e
;

25 } 
	t_G_Âos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb°©e_t
 
	m__°©e
;

30 } 
	t_G_Âos64_t
;

31 #i‡
deföed
 
_LIBC
 || deföed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gc⁄v.h
>

35 
__gc⁄v_öfo
 
	m__cd
;

38 
__gc⁄v_öfo
 
	m__cd
;

39 
__gc⁄v_°ï_d©a
 
	m__d©a
;

40 } 
	m__comböed
;

41 } 
	t_G_ic⁄v_t
;

46 
	#_G_va_li°
 
__gnuc_va_li°


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`deföed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

55 
	#__STDC_ISO_10646__
 201505L

	)

58 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/gconv.h

22 #i‚de‡
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<„©uªs.h
>

26 
	#__√ed_mb°©e_t


	)

27 
	#__√ed_wöt_t


	)

28 
	~<wch¨.h
>

29 
	#__√ed_size_t


	)

30 
	#__√ed_wch¨_t


	)

31 
	~<°ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¨_t
Ë0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gc⁄v_°ï
;

66 
	g__gc⁄v_°ï_d©a
;

67 
	g__gc⁄v_lﬂded_obje˘
;

71 (*
	t__gc⁄v_f˘
Ë(
	t__gc⁄v_°ï
 *, 
	t__gc⁄v_°ï_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wöt_t
 (*
	t__gc⁄v_btowc_f˘
Ë(
	t__gc⁄v_°ï
 *, );

79 (*
	t__gc⁄v_öô_f˘
Ë(
	t__gc⁄v_°ï
 *);

80 (*
	t__gc⁄v_íd_f˘
Ë(
	t__gc⁄v_°ï
 *);

84 
	s__gc⁄v_°ï


86 
__gc⁄v_lﬂded_obje˘
 *
__shlib_h™dÀ
;

87 c⁄° *
__mod«me
;

89 
__cou¡î
;

91 *
__‰om_«me
;

92 *
__to_«me
;

94 
__gc⁄v_f˘
 
__f˘
;

95 
__gc⁄v_btowc_f˘
 
__btowc_f˘
;

96 
__gc⁄v_öô_f˘
 
__öô_f˘
;

97 
__gc⁄v_íd_f˘
 
__íd_f˘
;

101 
__mö_√eded_‰om
;

102 
__max_√eded_‰om
;

103 
__mö_√eded_to
;

104 
__max_√eded_to
;

107 
__°©eful
;

109 *
__d©a
;

114 
	s__gc⁄v_°ï_d©a


116 *
__outbuf
;

117 *
__outbu„nd
;

121 
__Êags
;

125 
__övoˇti⁄_cou¡î
;

129 
__öã∫Æ_u£
;

131 
__mb°©e_t
 *
__°©ï
;

132 
__mb°©e_t
 
__°©e
;

138 
	s__gc⁄v_öfo


140 
size_t
 
__n°ïs
;

141 
__gc⁄v_°ï
 *
__°ïs
;

142 
__exãnsi⁄__
 
__gc⁄v_°ï_d©a
 
__d©a
 
__Êex¨r
;

143 } *
	t__gc⁄v_t
;

146 
	`__gc⁄v_å™¶ôî©e
 (
__gc⁄v_°ï
 *
°ï
,

147 
__gc⁄v_°ï_d©a
 *
°ï_d©a
,

148 c⁄° *
öbuf°¨t
,

149 c⁄° **
öbuÂ
,

150 c⁄° *
öbu„nd
,

151 **
outbuf°¨t
,

152 
size_t
 *
úªvîsibÀ
);

	@/usr/include/wchar.h

23 #i‚de‡
_WCHAR_H


25 #i‡!
deföed
 
__√ed_mb°©e_t
 && !deföed 
__√ed_wöt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<„©uªs.h
>

30 #ifde‡
_WCHAR_H


32 
	#__√ed___FILE


	)

33 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


34 
	#__√ed_FILE


	)

36 
	~<°dio.h
>

38 
	#__√ed___va_li°


	)

39 
	~<°d¨g.h
>

41 
	~<bôs/wch¨.h
>

44 
	#__√ed_size_t


	)

45 
	#__√ed_wch¨_t


	)

46 
	#__√ed_NULL


	)

48 #i‡
deföed
 
_WCHAR_H
 || deföed 
__√ed_wöt_t
 || !deföed 
__WINT_TYPE__


49 #unde‡
__√ed_wöt_t


50 
	#__√ed_wöt_t


	)

51 
	~<°ddef.h
>

55 #i‚de‡
_WINT_T


60 
	#_WINT_T


	)

61 
	twöt_t
;

65 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
deföed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twöt_t
;

69 
	g__END_NAMESPACE_STD


74 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #i‡(
deföed
 
_WCHAR_H
 || deföed 
__√ed_mb°©e_t
Ë&& !deföed 
____mb°©e_t_deföed


80 
	#____mb°©e_t_deföed
 1

	)

84 
	m__cou¡
;

87 #ifde‡
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wöt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__vÆue
;

94 } 
	t__mb°©e_t
;

96 #unde‡
__√ed_mb°©e_t


101 #ifde‡
_WCHAR_H


103 #i‚de‡
__mb°©e_t_deföed


104 
__BEGIN_NAMESPACE_C99


106 
__mb°©e_t
 
	tmb°©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb°©e_t_deföed
 1

	)

111 #ifde‡
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb°©e_t
)

115 #i‚de‡
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #i‚de‡
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #i‡
deföed
 
__USE_XOPEN
 && !deföed 
__USE_UNIX98


128 
	~<w˘y≥.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¨_t
 *
	$wcs˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

148 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

149 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

152 
wch¨_t
 *
	$wc¢˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

153 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

154 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

157 
wch¨_t
 *
	$wcsˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

158 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
)

159 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

161 
wch¨_t
 *
	$wc¢ˇt
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

162 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

163 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

166 
	$wcscmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
)

167 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

169 
	$wc¢cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

170 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

171 
__END_NAMESPACE_STD


173 #ifde‡
__USE_XOPEN2K8


175 
	$wcsˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

178 
	$wc¢ˇ£cmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

179 
size_t
 
__n
Ë
__THROW
;

183 
	~<xloˇÀ.h
>

185 
	$wcsˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

186 
__loˇÀ_t
 
__loc
Ë
__THROW
;

188 
	$wc¢ˇ£cmp_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

189 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

192 
__BEGIN_NAMESPACE_STD


195 
	$wcscﬁl
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
Ë
__THROW
;

199 
size_t
 
	$wcsx‰m
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

200 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

201 
__END_NAMESPACE_STD


203 #ifde‡
__USE_XOPEN2K8


209 
	$wcscﬁl_l
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

210 
__loˇÀ_t
 
__loc
Ë
__THROW
;

215 
size_t
 
	$wcsx‰m_l
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
,

216 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

219 
wch¨_t
 *
	$wcsdup
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_mÆloc__
;

222 
__BEGIN_NAMESPACE_STD


224 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


225 "C++" 
wch¨_t
 *
	$wcschr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

226 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

227 "C++" c⁄° 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

228 
__THROW
 
	`__asm
 ("wcschr"Ë
__©åibuã_puª__
;

230 
wch¨_t
 *
	$wcschr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

231 
__THROW
 
__©åibuã_puª__
;

234 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


235 "C++" 
wch¨_t
 *
	$wc§chr
 (
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

236 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

237 "C++" c⁄° 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

238 
__THROW
 
	`__asm
 ("wc§chr"Ë
__©åibuã_puª__
;

240 
wch¨_t
 *
	$wc§chr
 (c⁄° 
wch¨_t
 *
__wcs
, wch¨_à
__wc
)

241 
__THROW
 
__©åibuã_puª__
;

243 
__END_NAMESPACE_STD


245 #ifde‡
__USE_GNU


248 
wch¨_t
 *
	$wcsch∫ul
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__wc
)

249 
__THROW
 
__©åibuã_puª__
;

252 
__BEGIN_NAMESPACE_STD


255 
size_t
 
	$wcsc•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ªje˘
)

256 
__THROW
 
__©åibuã_puª__
;

259 
size_t
 
	$wcs•n
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

260 
__THROW
 
__©åibuã_puª__
;

262 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


263 "C++" 
wch¨_t
 *
	$wc•brk
 (
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

264 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

265 "C++" c⁄° 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
,

266 c⁄° 
wch¨_t
 *
__ac˚±
)

267 
__THROW
 
	`__asm
 ("wc•brk"Ë
__©åibuã_puª__
;

269 
wch¨_t
 *
	$wc•brk
 (c⁄° 
wch¨_t
 *
__wcs
, c⁄° wch¨_à*
__ac˚±
)

270 
__THROW
 
__©åibuã_puª__
;

273 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


274 "C++" 
wch¨_t
 *
	$wcs°r
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

275 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

276 "C++" c⁄° 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
,

277 c⁄° 
wch¨_t
 *
__√edÀ
)

278 
__THROW
 
	`__asm
 ("wcs°r"Ë
__©åibuã_puª__
;

280 
wch¨_t
 *
	$wcs°r
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

281 
__THROW
 
__©åibuã_puª__
;

285 
wch¨_t
 *
	$wc°ok
 (
wch¨_t
 *
__ª°ri˘
 
__s
,

286 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__dñim
,

287 
wch¨_t
 **
__ª°ri˘
 
__±r
Ë
__THROW
;

290 
size_t
 
	$wc¶í
 (c⁄° 
wch¨_t
 *
__s
Ë
__THROW
 
__©åibuã_puª__
;

291 
__END_NAMESPACE_STD


293 #ifde‡
__USE_XOPEN


295 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


296 "C++" 
wch¨_t
 *
	$wcswcs
 (
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

297 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

298 "C++" c⁄° 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
,

299 c⁄° 
wch¨_t
 *
__√edÀ
)

300 
__THROW
 
	`__asm
 ("wcswcs"Ë
__©åibuã_puª__
;

302 
wch¨_t
 *
	$wcswcs
 (c⁄° 
wch¨_t
 *
__hay°ack
, c⁄° wch¨_à*
__√edÀ
)

303 
__THROW
 
__©åibuã_puª__
;

307 #ifde‡
__USE_XOPEN2K8


309 
size_t
 
	$wc¢Àn
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__maxÀn
)

310 
__THROW
 
__©åibuã_puª__
;

314 
__BEGIN_NAMESPACE_STD


316 #ifde‡
__CORRECT_ISO_CPP_WCHAR_H_PROTO


317 "C++" 
wch¨_t
 *
	$wmemchr
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

319 "C++" c⁄° 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
,

320 
size_t
 
__n
)

321 
__THROW
 
	`__asm
 ("wmemchr"Ë
__©åibuã_puª__
;

323 
wch¨_t
 *
	$wmemchr
 (c⁄° 
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
)

324 
__THROW
 
__©åibuã_puª__
;

328 
	$wmemcmp
 (c⁄° 
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

329 
__THROW
 
__©åibuã_puª__
;

332 
wch¨_t
 *
	$wmem˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

333 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
Ë
__THROW
;

337 
wch¨_t
 *
	$wmemmove
 (
wch¨_t
 *
__s1
, c⁄° wch¨_à*
__s2
, 
size_t
 
__n
)

338 
__THROW
;

341 
wch¨_t
 *
	$wmem£t
 (
wch¨_t
 *
__s
, wch¨_à
__c
, 
size_t
 
__n
Ë
__THROW
;

342 
__END_NAMESPACE_STD


344 #ifde‡
__USE_GNU


347 
wch¨_t
 *
	$wmemp˝y
 (
wch¨_t
 *
__ª°ri˘
 
__s1
,

348 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s2
, 
size_t
 
__n
)

349 
__THROW
;

353 
__BEGIN_NAMESPACE_STD


356 
wöt_t
 
	$btowc
 (
__c
Ë
__THROW
;

360 
	$w˘ob
 (
wöt_t
 
__c
Ë
__THROW
;

364 
	$mbsöô
 (c⁄° 
mb°©e_t
 *
__ps
Ë
__THROW
 
__©åibuã_puª__
;

368 
size_t
 
	$mbπowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

369 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

370 
mb°©e_t
 *
__ª°ri˘
 
__p
Ë
__THROW
;

373 
size_t
 
	$w¸tomb
 (*
__ª°ri˘
 
__s
, 
wch¨_t
 
__wc
,

374 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

377 
size_t
 
	$__mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

378 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

379 
size_t
 
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

380 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

381 
__END_NAMESPACE_STD


383 #ifde‡
__USE_EXTERN_INLINES


389 
wöt_t
 
	$__btowc_Æüs
 (
__c
Ë
	`__asm
 ("btowc");

390 
__exã∫_ölöe
 
wöt_t


391 
	`__NTH
 (
	$btowc
 (
__c
))

392 {  (
	`__buûtö_c⁄°™t_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

393 ? (
wöt_t
Ë
__c
 : 
	`__btowc_Æüs
 (__c)); 
	}
}

395 
	$__w˘ob_Æüs
 (
wöt_t
 
__c
Ë
	`__asm
 ("wctob");

396 
__exã∫_ölöe
 

397 
	`__NTH
 (
	$w˘ob
 (
wöt_t
 
__wc
))

398 {  (
	`__buûtö_c⁄°™t_p
 (
__wc
Ë&& __w¯>
L
'\0' && __wc <= L'\x7f'

399 ? (Ë
__wc
 : 
	`__w˘ob_Æüs
 (__wc)); 
	}
}

401 
__exã∫_ölöe
 
size_t


402 
__NTH
 (
	$mbæí
 (c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

403 
mb°©e_t
 *
__ª°ri˘
 
__ps
))

404 {  (
__ps
 !
NULL


405 ? 
	`mbπowc
 (
NULL
, 
__s
, 
__n
, 
__ps
Ë: 
	`__mbæí
 (__s, __n, NULL)); 
	}
}

408 
__BEGIN_NAMESPACE_STD


411 
size_t
 
	$mb§towcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

412 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

413 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

417 
size_t
 
	$wc§tombs
 (*
__ª°ri˘
 
__d°
,

418 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
, 
size_t
 
__Àn
,

419 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

420 
__END_NAMESPACE_STD


423 #ifdef 
__USE_XOPEN2K8


426 
size_t
 
	$mb¢πowcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

427 c⁄° **
__ª°ri˘
 
__§c
, 
size_t
 
__nmc
,

428 
size_t
 
__Àn
, 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

432 
size_t
 
	$wc¢πombs
 (*
__ª°ri˘
 
__d°
,

433 c⁄° 
wch¨_t
 **
__ª°ri˘
 
__§c
,

434 
size_t
 
__nwc
, size_à
__Àn
,

435 
mb°©e_t
 *
__ª°ri˘
 
__ps
Ë
__THROW
;

440 #ifde‡
__USE_XOPEN


442 
	$wcwidth
 (
wch¨_t
 
__c
Ë
__THROW
;

446 
	$wcswidth
 (c⁄° 
wch¨_t
 *
__s
, 
size_t
 
__n
Ë
__THROW
;

450 
__BEGIN_NAMESPACE_STD


453 
	$wc°od
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

454 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

455 
__END_NAMESPACE_STD


457 #ifde‡
__USE_ISOC99


458 
__BEGIN_NAMESPACE_C99


460 
	$wc°of
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

461 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

462 
	$wc°ﬁd
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

463 
wch¨_t
 **
__ª°ri˘
 
__íd±r
Ë
__THROW
;

464 
__END_NAMESPACE_C99


468 
__BEGIN_NAMESPACE_STD


471 
	$wc°ﬁ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

472 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
Ë
__THROW
;

476 
	$wc°oul
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

477 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

478 
__THROW
;

479 
__END_NAMESPACE_STD


481 #ifde‡
__USE_ISOC99


482 
__BEGIN_NAMESPACE_C99


485 
__exãnsi⁄__


486 
	$wc°ﬁl
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

487 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

488 
__THROW
;

492 
__exãnsi⁄__


493 
	$wc°ouŒ
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

494 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

495 
__ba£
Ë
__THROW
;

496 
__END_NAMESPACE_C99


499 #ifde‡
__USE_GNU


502 
__exãnsi⁄__


503 
	$wc°oq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

504 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

505 
__THROW
;

509 
__exãnsi⁄__


510 
	$wc°ouq
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

511 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

512 
__ba£
Ë
__THROW
;

515 #ifde‡
__USE_GNU


529 
	~<xloˇÀ.h
>

533 
	$wc°ﬁ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

534 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

535 
__loˇÀ_t
 
__loc
Ë
__THROW
;

537 
	$wc°oul_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

538 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

539 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

541 
__exãnsi⁄__


542 
	$wc°ﬁl_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

543 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

544 
__ba£
, 
__loˇÀ_t
 
__loc
Ë
__THROW
;

546 
__exãnsi⁄__


547 
	$wc°ouŒ_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

548 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

549 
__ba£
, 
__loˇÀ_t
 
__loc
)

550 
__THROW
;

552 
	$wc°od_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

553 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

554 
__THROW
;

556 
	$wc°of_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

557 
wch¨_t
 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

558 
__THROW
;

560 
	$wc°ﬁd_l
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__≈å
,

561 
wch¨_t
 **
__ª°ri˘
 
__íd±r
,

562 
__loˇÀ_t
 
__loc
Ë
__THROW
;

566 #ifde‡
__USE_XOPEN2K8


569 
wch¨_t
 *
	$w˝˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

570 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
Ë
__THROW
;

574 
wch¨_t
 *
	$w˝n˝y
 (
wch¨_t
 *
__ª°ri˘
 
__de°
,

575 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

576 
__THROW
;

583 
__FILE
 *
	$›í_wmem°ªam
 (
wch¨_t
 **
__buÊoc
, 
size_t
 *
__sizñoc
Ë
__THROW
;

586 #i‡
deföed
 
__USE_ISOC95
 || deföed 
__USE_UNIX98


587 
__BEGIN_NAMESPACE_STD


590 
	$fwide
 (
__FILE
 *
__Â
, 
__mode
Ë
__THROW
;

597 
	`fw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

598 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

604 
	`w¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

607 
	$sw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

608 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

609 
__THROW
 ;

615 
	`vfw¥ötf
 (
__FILE
 *
__ª°ri˘
 
__s
,

616 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

617 
__gnuc_va_li°
 
__¨g
)

623 
	`vw¥ötf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

624 
__gnuc_va_li°
 
__¨g
)

628 
	$vsw¥ötf
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__n
,

629 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

630 
__gnuc_va_li°
 
__¨g
)

631 
__THROW
 ;

638 
	`fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

639 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

645 
	`wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

648 
	$swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

649 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

650 
__THROW
 ;

652 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__USE_GNU
 \

653 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

654 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

655 #ifde‡
__REDIRECT


659 
	`__REDIRECT
 (
fwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__°ªam
,

660 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

661 
__isoc99_fwsˇnf
)

663 
	`__REDIRECT
 (
wsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...),

664 
__isoc99_wsˇnf
)

666 
	`__REDIRECT_NTH
 (
swsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

667 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

668 ...), 
__isoc99_swsˇnf
)

671 
	`__isoc99_fwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__°ªam
,

672 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

673 
	`__isoc99_wsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...);

674 
	$__isoc99_swsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

675 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
, ...)

676 
__THROW
;

677 
	#fwsˇnf
 
__isoc99_fwsˇnf


	)

678 
	#wsˇnf
 
__isoc99_wsˇnf


	)

679 
	#swsˇnf
 
__isoc99_swsˇnf


	)

683 
__END_NAMESPACE_STD


686 #ifde‡
__USE_ISOC99


687 
__BEGIN_NAMESPACE_C99


692 
	`vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

693 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

694 
__gnuc_va_li°
 
__¨g
)

700 
	`vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

701 
__gnuc_va_li°
 
__¨g
)

704 
	$vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

705 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

706 
__gnuc_va_li°
 
__¨g
)

707 
__THROW
 ;

709 #i‡!
deföed
 
__USE_GNU
 \

710 && (!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT
) \

711 && (
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_XOPEN2K
)

712 #ifde‡
__REDIRECT


713 
	`__REDIRECT
 (
vfwsˇnf
, (
__FILE
 *
__ª°ri˘
 
__s
,

714 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

715 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vfwsˇnf
)

717 
	`__REDIRECT
 (
vwsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

718 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vwsˇnf
)

720 
	`__REDIRECT_NTH
 (
vswsˇnf
, (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

721 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

722 
__gnuc_va_li°
 
__¨g
), 
__isoc99_vswsˇnf
)

725 
	`__isoc99_vfwsˇnf
 (
__FILE
 *
__ª°ri˘
 
__s
,

726 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

727 
__gnuc_va_li°
 
__¨g
);

728 
	`__isoc99_vwsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

729 
__gnuc_va_li°
 
__¨g
);

730 
	$__isoc99_vswsˇnf
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__s
,

731 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

732 
__gnuc_va_li°
 
__¨g
Ë
__THROW
;

733 
	#vfwsˇnf
 
__isoc99_vfwsˇnf


	)

734 
	#vwsˇnf
 
__isoc99_vwsˇnf


	)

735 
	#vswsˇnf
 
__isoc99_vswsˇnf


	)

739 
__END_NAMESPACE_C99


743 
__BEGIN_NAMESPACE_STD


748 
wöt_t
 
	`fgëwc
 (
__FILE
 *
__°ªam
);

749 
wöt_t
 
	`gëwc
 (
__FILE
 *
__°ªam
);

755 
wöt_t
 
	`gëwch¨
 ();

762 
wöt_t
 
	`Âutwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

763 
wöt_t
 
	`putwc
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

769 
wöt_t
 
	`putwch¨
 (
wch¨_t
 
__wc
);

777 
wch¨_t
 *
	`fgëws
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

778 
__FILE
 *
__ª°ri˘
 
__°ªam
);

784 
	`Âutws
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

785 
__FILE
 *
__ª°ri˘
 
__°ªam
);

792 
wöt_t
 
	`ungëwc
 (wöt_à
__wc
, 
__FILE
 *
__°ªam
);

793 
__END_NAMESPACE_STD


796 #ifde‡
__USE_GNU


804 
wöt_t
 
	`gëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

805 
wöt_t
 
	`gëwch¨_u∆ocked
 ();

813 
wöt_t
 
	`fgëwc_u∆ocked
 (
__FILE
 *
__°ªam
);

821 
wöt_t
 
	`Âutwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

830 
wöt_t
 
	`putwc_u∆ocked
 (
wch¨_t
 
__wc
, 
__FILE
 *
__°ªam
);

831 
wöt_t
 
	`putwch¨_u∆ocked
 (
wch¨_t
 
__wc
);

840 
wch¨_t
 *
	`fgëws_u∆ocked
 (wch¨_à*
__ª°ri˘
 
__ws
, 
__n
,

841 
__FILE
 *
__ª°ri˘
 
__°ªam
);

849 
	`Âutws_u∆ocked
 (c⁄° 
wch¨_t
 *
__ª°ri˘
 
__ws
,

850 
__FILE
 *
__ª°ri˘
 
__°ªam
);

854 
__BEGIN_NAMESPACE_C99


858 
size_t
 
	$wcs·ime
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

859 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

860 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

861 
__END_NAMESPACE_C99


863 #ifde‡
__USE_GNU


864 
	~<xloˇÀ.h
>

868 
size_t
 
	$wcs·ime_l
 (
wch¨_t
 *
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

869 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__f‹m©
,

870 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

871 
__loˇÀ_t
 
__loc
Ë
__THROW
;

880 #i‡
deföed
 
__USE_UNIX98
 && !deföed 
__USE_GNU


881 
	#__√ed_iswxxx


	)

882 
	~<w˘y≥.h
>

886 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


887 
	~<bôs/wch¨2.h
>

890 #ifde‡
__LDBL_COMPAT


891 
	~<bôs/wch¨-ldbl.h
>

894 
__END_DECLS


902 #unde‡
__√ed_mb°©e_t


903 #unde‡
__√ed_wöt_t


	@/usr/include/wctype.h

23 #i‚de‡
_WCTYPE_H


25 
	~<„©uªs.h
>

26 
	~<bôs/ty≥s.h
>

28 #i‚de‡
__√ed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__√ed_wöt_t


	)

33 
	~<wch¨.h
>

37 #i‚de‡
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #unde‡
__√ed_iswxxx


46 #i‚de‡
__iswxxx_deföed


47 
	#__iswxxx_deföed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	tw˘y≥_t
;

53 
	g__END_NAMESPACE_C99


55 #i‚de‡
_ISwbô


60 
	~<ídün.h
>

61 #i‡
__BYTE_ORDER
 =
__BIG_ENDIAN


62 
	#_ISwbô
(
bô
Ë(1 << (bô))

	)

64 
	#_ISwbô
(
bô
) \

65 ((
bô
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
bô
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
bô
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (Ë((1UL << (
bô
)Ë>> 24))))

	)

73 
	m__ISwuµî
 = 0,

74 
	m__ISwlowî
 = 1,

75 
	m__ISwÆpha
 = 2,

76 
	m__ISwdigô
 = 3,

77 
	m__ISwxdigô
 = 4,

78 
	m__ISw•a˚
 = 5,

79 
	m__ISw¥öt
 = 6,

80 
	m__ISwgøph
 = 7,

81 
	m__ISwbœnk
 = 8,

82 
	m__ISw˙ål
 = 9,

83 
	m__ISwpun˘
 = 10,

84 
	m__ISwÆnum
 = 11,

86 
	m_ISwuµî
 = 
_ISwbô
 (
__ISwuµî
),

87 
	m_ISwlowî
 = 
_ISwbô
 (
__ISwlowî
),

88 
	m_ISwÆpha
 = 
_ISwbô
 (
__ISwÆpha
),

89 
	m_ISwdigô
 = 
_ISwbô
 (
__ISwdigô
),

90 
	m_ISwxdigô
 = 
_ISwbô
 (
__ISwxdigô
),

91 
	m_ISw•a˚
 = 
_ISwbô
 (
__ISw•a˚
),

92 
	m_ISw¥öt
 = 
_ISwbô
 (
__ISw¥öt
),

93 
	m_ISwgøph
 = 
_ISwbô
 (
__ISwgøph
),

94 
	m_ISwbœnk
 = 
_ISwbô
 (
__ISwbœnk
),

95 
	m_ISw˙ål
 = 
_ISwbô
 (
__ISw˙ål
),

96 
	m_ISwpun˘
 = 
_ISwbô
 (
__ISwpun˘
),

97 
	m_ISwÆnum
 = 
_ISwbô
 (
__ISwÆnum
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$iswÆnum
 (
wöt_t
 
__wc
Ë
__THROW
;

117 
	$iswÆpha
 (
wöt_t
 
__wc
Ë
__THROW
;

120 
	$isw˙ål
 (
wöt_t
 
__wc
Ë
__THROW
;

124 
	$iswdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

128 
	$iswgøph
 (
wöt_t
 
__wc
Ë
__THROW
;

133 
	$iswlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

136 
	$isw¥öt
 (
wöt_t
 
__wc
Ë
__THROW
;

141 
	$iswpun˘
 (
wöt_t
 
__wc
Ë
__THROW
;

146 
	$isw•a˚
 (
wöt_t
 
__wc
Ë
__THROW
;

151 
	$iswuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

156 
	$iswxdigô
 (
wöt_t
 
__wc
Ë
__THROW
;

161 #ifde‡
__USE_ISOC99


162 
	$iswbœnk
 (
wöt_t
 
__wc
Ë
__THROW
;

171 
w˘y≥_t
 
	$w˘y≥
 (c⁄° *
__¥›îty
Ë
__THROW
;

175 
	$isw˘y≥
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
Ë
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 c⁄° 
	t__öt32_t
 *
	tw˘øns_t
;

187 
__END_NAMESPACE_C99


188 #ifde‡
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
w˘øns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wöt_t
 
	$towlowî
 (
wöt_t
 
__wc
Ë
__THROW
;

197 
wöt_t
 
	$towuµî
 (
wöt_t
 
__wc
Ë
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifde‡
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
w˘øns_t
 
	$w˘øns
 (c⁄° *
__¥›îty
Ë
__THROW
;

221 
wöt_t
 
	$tow˘øns
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
Ë
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifde‡
__USE_XOPEN2K8


226 
	~<xloˇÀ.h
>

230 
	$iswÆnum_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

236 
	$iswÆpha_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

239 
	$isw˙ål_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

243 
	$iswdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

247 
	$iswgøph_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

252 
	$iswlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

255 
	$isw¥öt_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

260 
	$iswpun˘_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

265 
	$isw•a˚_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

270 
	$iswuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

275 
	$iswxdigô_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

280 
	$iswbœnk_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

284 
w˘y≥_t
 
	$w˘y≥_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

285 
__THROW
;

289 
	$isw˘y≥_l
 (
wöt_t
 
__wc
, 
w˘y≥_t
 
__desc
, 
__loˇÀ_t
 
__loˇÀ
)

290 
__THROW
;

298 
wöt_t
 
	$towlowî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

301 
wöt_t
 
	$towuµî_l
 (
wöt_t
 
__wc
, 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

305 
w˘øns_t
 
	$w˘øns_l
 (c⁄° *
__¥›îty
, 
__loˇÀ_t
 
__loˇÀ
)

306 
__THROW
;

309 
wöt_t
 
	$tow˘øns_l
 (
wöt_t
 
__wc
, 
w˘øns_t
 
__desc
,

310 
__loˇÀ_t
 
__loˇÀ
Ë
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
153
3346
fxtools.c
fxtools.h
htslib/bcf_sr_sort.c
htslib/bcf_sr_sort.h
htslib/bgzf.c
htslib/bgzip.c
htslib/cram/cram.h
htslib/cram/cram_codecs.c
htslib/cram/cram_codecs.h
htslib/cram/cram_decode.c
htslib/cram/cram_decode.h
htslib/cram/cram_encode.c
htslib/cram/cram_encode.h
htslib/cram/cram_external.c
htslib/cram/cram_index.c
htslib/cram/cram_index.h
htslib/cram/cram_io.c
htslib/cram/cram_io.h
htslib/cram/cram_samtools.c
htslib/cram/cram_samtools.h
htslib/cram/cram_stats.c
htslib/cram/cram_stats.h
htslib/cram/cram_structs.h
htslib/cram/files.c
htslib/cram/mFILE.c
htslib/cram/mFILE.h
htslib/cram/misc.h
htslib/cram/open_trace_file.c
htslib/cram/open_trace_file.h
htslib/cram/os.h
htslib/cram/pooled_alloc.c
htslib/cram/pooled_alloc.h
htslib/cram/rANS_byte.h
htslib/cram/rANS_static.c
htslib/cram/rANS_static.h
htslib/cram/sam_header.c
htslib/cram/sam_header.h
htslib/cram/string_alloc.c
htslib/cram/string_alloc.h
htslib/cram/vlen.c
htslib/cram/vlen.h
htslib/cram/zfio.c
htslib/cram/zfio.h
htslib/errmod.c
htslib/faidx.c
htslib/hfile.c
htslib/hfile_gcs.c
htslib/hfile_internal.h
htslib/hfile_libcurl.c
htslib/hfile_net.c
htslib/hfile_s3.c
htslib/hts.c
htslib/hts_internal.h
htslib/htsfile.c
htslib/htslib/bgzf.h
htslib/htslib/cram.h
htslib/htslib/faidx.h
htslib/htslib/hfile.h
htslib/htslib/hts.h
htslib/htslib/hts_defs.h
htslib/htslib/hts_endian.h
htslib/htslib/kbitset.h
htslib/htslib/kfunc.h
htslib/htslib/khash.h
htslib/htslib/khash_str2int.h
htslib/htslib/klist.h
htslib/htslib/knetfile.h
htslib/htslib/kseq.h
htslib/htslib/ksort.h
htslib/htslib/kstring.h
htslib/htslib/regidx.h
htslib/htslib/sam.h
htslib/htslib/synced_bcf_reader.h
htslib/htslib/tbx.h
htslib/htslib/thread_pool.h
htslib/htslib/vcf.h
htslib/htslib/vcf_sweep.h
htslib/htslib/vcfutils.h
htslib/kfunc.c
htslib/knetfile.c
htslib/kstring.c
htslib/md5.c
htslib/multipart.c
htslib/plugin.c
htslib/probaln.c
htslib/realn.c
htslib/regidx.c
htslib/sam.c
htslib/synced_bcf_reader.c
htslib/tabix.c
htslib/tbx.c
htslib/test/fieldarith.c
htslib/test/hfile.c
htslib/test/hts_endian.c
htslib/test/sam.c
htslib/test/test-bcf-sr.c
htslib/test/test-regidx.c
htslib/test/test-vcf-api.c
htslib/test/test-vcf-sweep.c
htslib/test/test_bgzf.c
htslib/test/test_view.c
htslib/test/thrash_threads1.c
htslib/test/thrash_threads2.c
htslib/test/thrash_threads3.c
htslib/test/thrash_threads4.c
htslib/test/thrash_threads5.c
htslib/test/thrash_threads6.c
htslib/textutils.c
htslib/thread_pool.c
htslib/thread_pool_internal.h
htslib/vcf.c
htslib/vcf_sweep.c
htslib/vcfutils.c
kseq.h
ksort.h
utils.c
utils.h
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/byteswap.h
/usr/include/ctype.h
/usr/include/dirent.h
/usr/include/dlfcn.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/getopt.h
/usr/include/inttypes.h
/usr/include/limits.h
/usr/include/math.h
/usr/include/netdb.h
/usr/include/pthread.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/zlib.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/libio.h
/usr/include/netinet/in.h
/usr/include/rpc/netdb.h
/usr/include/sched.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/stdc-predef.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
